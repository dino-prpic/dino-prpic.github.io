var Gn=Object.defineProperty;var Xn=(m,n,u)=>n in m?Gn(m,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):m[n]=u;var oe=(m,n,u)=>(Xn(m,typeof n!="symbol"?n+"":n,u),u),Ii=(m,n,u)=>{if(!n.has(m))throw TypeError("Cannot "+u)};var t=(m,n,u)=>(Ii(m,n,"read from private field"),u?u.call(m):n.get(m)),$=(m,n,u)=>{if(n.has(m))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(m):n.set(m,u)},ot=(m,n,u,y)=>(Ii(m,n,"write to private field"),y?y.call(m,u):n.set(m,u),u);var ze=(m,n,u,y)=>({set _(P){ot(m,n,P,u)},get _(){return t(m,n,y)}}),Z=(m,n,u)=>(Ii(m,n,"access private method"),u);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const P of document.querySelectorAll('link[rel="modulepreload"]'))y(P);new MutationObserver(P=>{for(const ct of P)if(ct.type==="childList")for(const U of ct.addedNodes)U.tagName==="LINK"&&U.rel==="modulepreload"&&y(U)}).observe(document,{childList:!0,subtree:!0});function u(P){const ct={};return P.integrity&&(ct.integrity=P.integrity),P.referrerPolicy&&(ct.referrerPolicy=P.referrerPolicy),P.crossOrigin==="use-credentials"?ct.credentials="include":P.crossOrigin==="anonymous"?ct.credentials="omit":ct.credentials="same-origin",ct}function y(P){if(P.ep)return;P.ep=!0;const ct=u(P);fetch(P.href,ct)}})();/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const fi=globalThis,Cs=fi.ShadowRoot&&(fi.ShadyCSS===void 0||fi.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Ts=Symbol(),Os=new WeakMap;let Js=class{constructor(n,u,y){if(this._$cssResult$=!0,y!==Ts)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=n,this.t=u}get styleSheet(){let n=this.o;const u=this.t;if(Cs&&n===void 0){const y=u!==void 0&&u.length===1;y&&(n=Os.get(u)),n===void 0&&((this.o=n=new CSSStyleSheet).replaceSync(this.cssText),y&&Os.set(u,n))}return n}toString(){return this.cssText}};const Vn=m=>new Js(typeof m=="string"?m:m+"",void 0,Ts),ve=(m,...n)=>{const u=m.length===1?m[0]:n.reduce((y,P,ct)=>y+(U=>{if(U._$cssResult$===!0)return U.cssText;if(typeof U=="number")return U;throw Error("Value passed to 'css' function must be a 'css' function result: "+U+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(P)+m[ct+1],m[0]);return new Js(u,m,Ts)},qn=(m,n)=>{if(Cs)m.adoptedStyleSheets=n.map(u=>u instanceof CSSStyleSheet?u:u.styleSheet);else for(const u of n){const y=document.createElement("style"),P=fi.litNonce;P!==void 0&&y.setAttribute("nonce",P),y.textContent=u.cssText,m.appendChild(y)}},Is=Cs?m=>m:m=>m instanceof CSSStyleSheet?(n=>{let u="";for(const y of n.cssRules)u+=y.cssText;return Vn(u)})(m):m;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:Yn,defineProperty:Kn,getOwnPropertyDescriptor:Jn,getOwnPropertyNames:Qn,getOwnPropertySymbols:Zn,getPrototypeOf:tr}=Object,Te=globalThis,Ls=Te.trustedTypes,er=Ls?Ls.emptyScript:"",Li=Te.reactiveElementPolyfillSupport,Ze=(m,n)=>m,ki={toAttribute(m,n){switch(n){case Boolean:m=m?er:null;break;case Object:case Array:m=m==null?m:JSON.stringify(m)}return m},fromAttribute(m,n){let u=m;switch(n){case Boolean:u=m!==null;break;case Number:u=m===null?null:Number(m);break;case Object:case Array:try{u=JSON.parse(m)}catch{u=null}}return u}},Ps=(m,n)=>!Yn(m,n),Ns={attribute:!0,type:String,converter:ki,reflect:!1,hasChanged:Ps};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Te.litPropertyMetadata??(Te.litPropertyMetadata=new WeakMap);let Ie=class extends HTMLElement{static addInitializer(n){this._$Ei(),(this.l??(this.l=[])).push(n)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(n,u=Ns){if(u.state&&(u.attribute=!1),this._$Ei(),this.elementProperties.set(n,u),!u.noAccessor){const y=Symbol(),P=this.getPropertyDescriptor(n,y,u);P!==void 0&&Kn(this.prototype,n,P)}}static getPropertyDescriptor(n,u,y){const{get:P,set:ct}=Jn(this.prototype,n)??{get(){return this[u]},set(U){this[u]=U}};return{get(){return P==null?void 0:P.call(this)},set(U){const o=P==null?void 0:P.call(this);ct.call(this,U),this.requestUpdate(n,o,y)},configurable:!0,enumerable:!0}}static getPropertyOptions(n){return this.elementProperties.get(n)??Ns}static _$Ei(){if(this.hasOwnProperty(Ze("elementProperties")))return;const n=tr(this);n.finalize(),n.l!==void 0&&(this.l=[...n.l]),this.elementProperties=new Map(n.elementProperties)}static finalize(){if(this.hasOwnProperty(Ze("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Ze("properties"))){const u=this.properties,y=[...Qn(u),...Zn(u)];for(const P of y)this.createProperty(P,u[P])}const n=this[Symbol.metadata];if(n!==null){const u=litPropertyMetadata.get(n);if(u!==void 0)for(const[y,P]of u)this.elementProperties.set(y,P)}this._$Eh=new Map;for(const[u,y]of this.elementProperties){const P=this._$Eu(u,y);P!==void 0&&this._$Eh.set(P,u)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(n){const u=[];if(Array.isArray(n)){const y=new Set(n.flat(1/0).reverse());for(const P of y)u.unshift(Is(P))}else n!==void 0&&u.push(Is(n));return u}static _$Eu(n,u){const y=u.attribute;return y===!1?void 0:typeof y=="string"?y:typeof n=="string"?n.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var n;this._$ES=new Promise(u=>this.enableUpdating=u),this._$AL=new Map,this._$E_(),this.requestUpdate(),(n=this.constructor.l)==null||n.forEach(u=>u(this))}addController(n){var u;(this._$EO??(this._$EO=new Set)).add(n),this.renderRoot!==void 0&&this.isConnected&&((u=n.hostConnected)==null||u.call(n))}removeController(n){var u;(u=this._$EO)==null||u.delete(n)}_$E_(){const n=new Map,u=this.constructor.elementProperties;for(const y of u.keys())this.hasOwnProperty(y)&&(n.set(y,this[y]),delete this[y]);n.size>0&&(this._$Ep=n)}createRenderRoot(){const n=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return qn(n,this.constructor.elementStyles),n}connectedCallback(){var n;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(n=this._$EO)==null||n.forEach(u=>{var y;return(y=u.hostConnected)==null?void 0:y.call(u)})}enableUpdating(n){}disconnectedCallback(){var n;(n=this._$EO)==null||n.forEach(u=>{var y;return(y=u.hostDisconnected)==null?void 0:y.call(u)})}attributeChangedCallback(n,u,y){this._$AK(n,y)}_$EC(n,u){var ct;const y=this.constructor.elementProperties.get(n),P=this.constructor._$Eu(n,y);if(P!==void 0&&y.reflect===!0){const U=(((ct=y.converter)==null?void 0:ct.toAttribute)!==void 0?y.converter:ki).toAttribute(u,y.type);this._$Em=n,U==null?this.removeAttribute(P):this.setAttribute(P,U),this._$Em=null}}_$AK(n,u){var ct;const y=this.constructor,P=y._$Eh.get(n);if(P!==void 0&&this._$Em!==P){const U=y.getPropertyOptions(P),o=typeof U.converter=="function"?{fromAttribute:U.converter}:((ct=U.converter)==null?void 0:ct.fromAttribute)!==void 0?U.converter:ki;this._$Em=P,this[P]=o.fromAttribute(u,U.type),this._$Em=null}}requestUpdate(n,u,y){if(n!==void 0){if(y??(y=this.constructor.getPropertyOptions(n)),!(y.hasChanged??Ps)(this[n],u))return;this.P(n,u,y)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(n,u,y){this._$AL.has(n)||this._$AL.set(n,u),y.reflect===!0&&this._$Em!==n&&(this._$Ej??(this._$Ej=new Set)).add(n)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(u){Promise.reject(u)}const n=this.scheduleUpdate();return n!=null&&await n,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var y;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[ct,U]of this._$Ep)this[ct]=U;this._$Ep=void 0}const P=this.constructor.elementProperties;if(P.size>0)for(const[ct,U]of P)U.wrapped!==!0||this._$AL.has(ct)||this[ct]===void 0||this.P(ct,this[ct],U)}let n=!1;const u=this._$AL;try{n=this.shouldUpdate(u),n?(this.willUpdate(u),(y=this._$EO)==null||y.forEach(P=>{var ct;return(ct=P.hostUpdate)==null?void 0:ct.call(P)}),this.update(u)):this._$EU()}catch(P){throw n=!1,this._$EU(),P}n&&this._$AE(u)}willUpdate(n){}_$AE(n){var u;(u=this._$EO)==null||u.forEach(y=>{var P;return(P=y.hostUpdated)==null?void 0:P.call(y)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(n)),this.updated(n)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(n){return!0}update(n){this._$Ej&&(this._$Ej=this._$Ej.forEach(u=>this._$EC(u,this[u]))),this._$EU()}updated(n){}firstUpdated(n){}};Ie.elementStyles=[],Ie.shadowRootOptions={mode:"open"},Ie[Ze("elementProperties")]=new Map,Ie[Ze("finalized")]=new Map,Li==null||Li({ReactiveElement:Ie}),(Te.reactiveElementVersions??(Te.reactiveElementVersions=[])).push("2.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ti=globalThis,Mi=ti.trustedTypes,$s=Mi?Mi.createPolicy("lit-html",{createHTML:m=>m}):void 0,Qs="$lit$",Ce=`lit$${(Math.random()+"").slice(9)}$`,Zs="?"+Ce,ir=`<${Zs}>`,Me=document,ii=()=>Me.createComment(""),si=m=>m===null||typeof m!="object"&&typeof m!="function",tn=Array.isArray,sr=m=>tn(m)||typeof(m==null?void 0:m[Symbol.iterator])=="function",Ni=`[ 	
\f\r]`,Ge=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Us=/-->/g,Bs=/>/g,Pe=RegExp(`>|${Ni}(?:([^\\s"'>=/]+)(${Ni}*=${Ni}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Hs=/'/g,js=/"/g,en=/^(?:script|style|textarea|title)$/i,nr=m=>(n,...u)=>({_$litType$:m,strings:n,values:u}),pe=nr(1),He=Symbol.for("lit-noChange"),ue=Symbol.for("lit-nothing"),Ws=new WeakMap,ke=Me.createTreeWalker(Me,129);function sn(m,n){if(!Array.isArray(m)||!m.hasOwnProperty("raw"))throw Error("invalid template strings array");return $s!==void 0?$s.createHTML(n):n}const rr=(m,n)=>{const u=m.length-1,y=[];let P,ct=n===2?"<svg>":"",U=Ge;for(let o=0;o<u;o++){const V=m[o];let r,x,q=-1,Y=0;for(;Y<V.length&&(U.lastIndex=Y,x=U.exec(V),x!==null);)Y=U.lastIndex,U===Ge?x[1]==="!--"?U=Us:x[1]!==void 0?U=Bs:x[2]!==void 0?(en.test(x[2])&&(P=RegExp("</"+x[2],"g")),U=Pe):x[3]!==void 0&&(U=Pe):U===Pe?x[0]===">"?(U=P??Ge,q=-1):x[1]===void 0?q=-2:(q=U.lastIndex-x[2].length,r=x[1],U=x[3]===void 0?Pe:x[3]==='"'?js:Hs):U===js||U===Hs?U=Pe:U===Us||U===Bs?U=Ge:(U=Pe,P=void 0);const gt=U===Pe&&m[o+1].startsWith("/>")?" ":"";ct+=U===Ge?V+ir:q>=0?(y.push(r),V.slice(0,q)+Qs+V.slice(q)+Ce+gt):V+Ce+(q===-2?o:gt)}return[sn(m,ct+(m[u]||"<?>")+(n===2?"</svg>":"")),y]};class ni{constructor({strings:n,_$litType$:u},y){let P;this.parts=[];let ct=0,U=0;const o=n.length-1,V=this.parts,[r,x]=rr(n,u);if(this.el=ni.createElement(r,y),ke.currentNode=this.el.content,u===2){const q=this.el.content.firstChild;q.replaceWith(...q.childNodes)}for(;(P=ke.nextNode())!==null&&V.length<o;){if(P.nodeType===1){if(P.hasAttributes())for(const q of P.getAttributeNames())if(q.endsWith(Qs)){const Y=x[U++],gt=P.getAttribute(q).split(Ce),z=/([.?@])?(.*)/.exec(Y);V.push({type:1,index:ct,name:z[2],strings:gt,ctor:z[1]==="."?or:z[1]==="?"?lr:z[1]==="@"?cr:Di}),P.removeAttribute(q)}else q.startsWith(Ce)&&(V.push({type:6,index:ct}),P.removeAttribute(q));if(en.test(P.tagName)){const q=P.textContent.split(Ce),Y=q.length-1;if(Y>0){P.textContent=Mi?Mi.emptyScript:"";for(let gt=0;gt<Y;gt++)P.append(q[gt],ii()),ke.nextNode(),V.push({type:2,index:++ct});P.append(q[Y],ii())}}}else if(P.nodeType===8)if(P.data===Zs)V.push({type:2,index:ct});else{let q=-1;for(;(q=P.data.indexOf(Ce,q+1))!==-1;)V.push({type:7,index:ct}),q+=Ce.length-1}ct++}}static createElement(n,u){const y=Me.createElement("template");return y.innerHTML=n,y}}function je(m,n,u=m,y){var U,o;if(n===He)return n;let P=y!==void 0?(U=u._$Co)==null?void 0:U[y]:u._$Cl;const ct=si(n)?void 0:n._$litDirective$;return(P==null?void 0:P.constructor)!==ct&&((o=P==null?void 0:P._$AO)==null||o.call(P,!1),ct===void 0?P=void 0:(P=new ct(m),P._$AT(m,u,y)),y!==void 0?(u._$Co??(u._$Co=[]))[y]=P:u._$Cl=P),P!==void 0&&(n=je(m,P._$AS(m,n.values),P,y)),n}class ar{constructor(n,u){this._$AV=[],this._$AN=void 0,this._$AD=n,this._$AM=u}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(n){const{el:{content:u},parts:y}=this._$AD,P=((n==null?void 0:n.creationScope)??Me).importNode(u,!0);ke.currentNode=P;let ct=ke.nextNode(),U=0,o=0,V=y[0];for(;V!==void 0;){if(U===V.index){let r;V.type===2?r=new li(ct,ct.nextSibling,this,n):V.type===1?r=new V.ctor(ct,V.name,V.strings,this,n):V.type===6&&(r=new hr(ct,this,n)),this._$AV.push(r),V=y[++o]}U!==(V==null?void 0:V.index)&&(ct=ke.nextNode(),U++)}return ke.currentNode=Me,P}p(n){let u=0;for(const y of this._$AV)y!==void 0&&(y.strings!==void 0?(y._$AI(n,y,u),u+=y.strings.length-2):y._$AI(n[u])),u++}}class li{get _$AU(){var n;return((n=this._$AM)==null?void 0:n._$AU)??this._$Cv}constructor(n,u,y,P){this.type=2,this._$AH=ue,this._$AN=void 0,this._$AA=n,this._$AB=u,this._$AM=y,this.options=P,this._$Cv=(P==null?void 0:P.isConnected)??!0}get parentNode(){let n=this._$AA.parentNode;const u=this._$AM;return u!==void 0&&(n==null?void 0:n.nodeType)===11&&(n=u.parentNode),n}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(n,u=this){n=je(this,n,u),si(n)?n===ue||n==null||n===""?(this._$AH!==ue&&this._$AR(),this._$AH=ue):n!==this._$AH&&n!==He&&this._(n):n._$litType$!==void 0?this.$(n):n.nodeType!==void 0?this.T(n):sr(n)?this.k(n):this._(n)}S(n){return this._$AA.parentNode.insertBefore(n,this._$AB)}T(n){this._$AH!==n&&(this._$AR(),this._$AH=this.S(n))}_(n){this._$AH!==ue&&si(this._$AH)?this._$AA.nextSibling.data=n:this.T(Me.createTextNode(n)),this._$AH=n}$(n){var ct;const{values:u,_$litType$:y}=n,P=typeof y=="number"?this._$AC(n):(y.el===void 0&&(y.el=ni.createElement(sn(y.h,y.h[0]),this.options)),y);if(((ct=this._$AH)==null?void 0:ct._$AD)===P)this._$AH.p(u);else{const U=new ar(P,this),o=U.u(this.options);U.p(u),this.T(o),this._$AH=U}}_$AC(n){let u=Ws.get(n.strings);return u===void 0&&Ws.set(n.strings,u=new ni(n)),u}k(n){tn(this._$AH)||(this._$AH=[],this._$AR());const u=this._$AH;let y,P=0;for(const ct of n)P===u.length?u.push(y=new li(this.S(ii()),this.S(ii()),this,this.options)):y=u[P],y._$AI(ct),P++;P<u.length&&(this._$AR(y&&y._$AB.nextSibling,P),u.length=P)}_$AR(n=this._$AA.nextSibling,u){var y;for((y=this._$AP)==null?void 0:y.call(this,!1,!0,u);n&&n!==this._$AB;){const P=n.nextSibling;n.remove(),n=P}}setConnected(n){var u;this._$AM===void 0&&(this._$Cv=n,(u=this._$AP)==null||u.call(this,n))}}class Di{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(n,u,y,P,ct){this.type=1,this._$AH=ue,this._$AN=void 0,this.element=n,this.name=u,this._$AM=P,this.options=ct,y.length>2||y[0]!==""||y[1]!==""?(this._$AH=Array(y.length-1).fill(new String),this.strings=y):this._$AH=ue}_$AI(n,u=this,y,P){const ct=this.strings;let U=!1;if(ct===void 0)n=je(this,n,u,0),U=!si(n)||n!==this._$AH&&n!==He,U&&(this._$AH=n);else{const o=n;let V,r;for(n=ct[0],V=0;V<ct.length-1;V++)r=je(this,o[y+V],u,V),r===He&&(r=this._$AH[V]),U||(U=!si(r)||r!==this._$AH[V]),r===ue?n=ue:n!==ue&&(n+=(r??"")+ct[V+1]),this._$AH[V]=r}U&&!P&&this.j(n)}j(n){n===ue?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,n??"")}}let or=class extends Di{constructor(){super(...arguments),this.type=3}j(n){this.element[this.name]=n===ue?void 0:n}};class lr extends Di{constructor(){super(...arguments),this.type=4}j(n){this.element.toggleAttribute(this.name,!!n&&n!==ue)}}class cr extends Di{constructor(n,u,y,P,ct){super(n,u,y,P,ct),this.type=5}_$AI(n,u=this){if((n=je(this,n,u,0)??ue)===He)return;const y=this._$AH,P=n===ue&&y!==ue||n.capture!==y.capture||n.once!==y.once||n.passive!==y.passive,ct=n!==ue&&(y===ue||P);P&&this.element.removeEventListener(this.name,this,y),ct&&this.element.addEventListener(this.name,this,n),this._$AH=n}handleEvent(n){var u;typeof this._$AH=="function"?this._$AH.call(((u=this.options)==null?void 0:u.host)??this.element,n):this._$AH.handleEvent(n)}}class hr{constructor(n,u,y){this.element=n,this.type=6,this._$AN=void 0,this._$AM=u,this.options=y}get _$AU(){return this._$AM._$AU}_$AI(n){je(this,n)}}const $i=ti.litHtmlPolyfillSupport;$i==null||$i(ni,li),(ti.litHtmlVersions??(ti.litHtmlVersions=[])).push("3.1.2");const dr=(m,n,u)=>{const y=(u==null?void 0:u.renderBefore)??n;let P=y._$litPart$;if(P===void 0){const ct=(u==null?void 0:u.renderBefore)??null;y._$litPart$=P=new li(n.insertBefore(ii(),ct),ct,void 0,u??{})}return P._$AI(m),P};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let be=class extends Ie{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var u;const n=super.createRenderRoot();return(u=this.renderOptions).renderBefore??(u.renderBefore=n.firstChild),n}update(n){const u=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(n),this._$Do=dr(u,this.renderRoot,this.renderOptions)}connectedCallback(){var n;super.connectedCallback(),(n=this._$Do)==null||n.setConnected(!0)}disconnectedCallback(){var n;super.disconnectedCallback(),(n=this._$Do)==null||n.setConnected(!1)}render(){return He}};var Ks;be._$litElement$=!0,be.finalized=!0,(Ks=globalThis.litElementHydrateSupport)==null||Ks.call(globalThis,{LitElement:be});const Ui=globalThis.litElementPolyfillSupport;Ui==null||Ui({LitElement:be});(globalThis.litElementVersions??(globalThis.litElementVersions=[])).push("4.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const we=m=>(n,u)=>{u!==void 0?u.addInitializer(()=>{customElements.define(m,n)}):customElements.define(m,n)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ur={attribute:!0,type:String,converter:ki,reflect:!1,hasChanged:Ps},fr=(m=ur,n,u)=>{const{kind:y,metadata:P}=u;let ct=globalThis.litPropertyMetadata.get(P);if(ct===void 0&&globalThis.litPropertyMetadata.set(P,ct=new Map),ct.set(u.name,m),y==="accessor"){const{name:U}=u;return{set(o){const V=n.get.call(this);n.set.call(this,o),this.requestUpdate(U,V,m)},init(o){return o!==void 0&&this.P(U,void 0,m),o}}}if(y==="setter"){const{name:U}=u;return function(o){const V=this[U];n.call(this,o),this.requestUpdate(U,V,m)}}throw Error("Unsupported decorator location: "+y)};function he(m){return(n,u)=>typeof u=="object"?fr(m,n,u):((y,P,ct)=>{const U=P.hasOwnProperty(ct);return P.constructor.createProperty(ct,U?{...y,wrapped:!0}:y),U?Object.getOwnPropertyDescriptor(P,ct):void 0})(m,n,u)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const zs=(m,n,u)=>(u.configurable=!0,u.enumerable=!0,Reflect.decorate&&typeof n!="object"&&Object.defineProperty(m,n,u),u);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function ye(m,n){return(u,y,P)=>{const ct=U=>{var o;return((o=U.renderRoot)==null?void 0:o.querySelector(m))??null};if(n){const{get:U,set:o}=typeof y=="object"?u:P??(()=>{const V=Symbol();return{get(){return this[V]},set(r){this[V]=r}}})();return zs(u,y,{get(){let V=U.call(this);return V===void 0&&(V=ct(this),(V!==null||this.hasUpdated)&&o.call(this,V)),V}})}return zs(u,y,{get(){return ct(this)}})}}var pr=Object.defineProperty,gr=Object.getOwnPropertyDescriptor,xs=(m,n,u,y)=>{for(var P=y>1?void 0:y?gr(n,u):n,ct=m.length-1,U;ct>=0;ct--)(U=m[ct])&&(P=(y?U(n,u,P):U(P))||P);return y&&P&&pr(n,u,P),P};let ri=class extends be{constructor(){super(...arguments),this.title="",this.description=""}render(){return pe`
      <div class="header">
        <div class="info" @click=${()=>{this.getAttribute("open")!==null?this.removeAttribute("open"):this.setAttribute("open","")}}>
          <h3 class="title">${this.title}</h3>
          <p class="description">${this.description}</p>
        </div>
        <div class="tools">
          <slot name="header"></slot>
        </div>
      </div>

      <div class="content" @focusin=${()=>this.setAttribute("open","")}>
        <slot></slot>
      </div>
    `}};ri.styles=ve`
    :host {
      display: grid;
      grid-template-rows: auto 0fr;
      grid-template-columns: 1fr;
      box-sizing: border-box;
      border-top: 1px solid var(--theme-color-background-light);
      transition: grid-template-rows 0.2s;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1em;
    }
    .info {
      font-size: .9em;
      cursor: pointer;
      flex: 1;
    }
    .title, .description {
      display: block;
      margin: 0;
    }
    .tools {
      display: flex;
      gap: .5em;
    }

    .content {
      opacity: 0;
      transition: opacity 0.5s;
      overflow: hidden;
      padding: 0 1em;
      box-sizing: border-box;
      transition: padding 0.5s;
    }

    :host([open]) {
      grid-template-rows: auto 1fr;
    }
    :host([open]) .content {
      opacity: 1;
      padding: 0 1em 1em;
    }

    :host([hidden]) {
      display: none;
    }

  `;xs([he({type:String})],ri.prototype,"title",2);xs([he({type:String})],ri.prototype,"description",2);ri=xs([we("collapsable-container")],ri);const ks=ve`
  button {
    background: var(--theme-color-background-light);
    border: none;
    outline: none;
    border-radius: 0.5em;
    padding: 0.5em 1em;
    color: var(--theme-color-text);
    cursor: pointer;
    font-weight: bold;
    text-transform: uppercase;
  }
  button:hover {
    scale: 1.05;
  }
  button:focus {
    box-shadow: 0 0 0 2px var(--theme-color-text-light);
  }
`;var mr=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),br=async(m,n)=>await(await fetch(m,n)).arrayBuffer(),Ar=async({url:m,simdUrl:n},u)=>{const y=await mr()?n:m;return await br(y,u)},yr="@sapphi-red/web-noise-suppressor/rnnoise",vr=class extends AudioWorkletNode{constructor(m,{maxChannels:n,wasmBinary:u}){const y={processorOptions:{maxChannels:n,wasmBinary:u}};super(m,yr,y)}destroy(){this.port.postMessage("destroy")}};const _r="/assets/workletProcessor-aE81tT0U.js",Sr="/assets/rnnoise-JVVcIJtG.wasm",Er="/assets/rnnoise-JVVcIJtG.wasm";var wr=Object.defineProperty,Cr=Object.getOwnPropertyDescriptor,nn=(m,n,u,y)=>{for(var P=y>1?void 0:y?Cr(n,u):n,ct=m.length-1,U;ct>=0;ct--)(U=m[ct])&&(P=(y?U(n,u,P):U(P))||P);return y&&P&&wr(n,u,P),P};let Ri=class extends be{constructor(){super(...arguments),this.pct=.125,this.recording=!1}async connect(){this.stream=await navigator.mediaDevices.getUserMedia({audio:{noiseSuppression:!0,echoCancellation:!0,autoGainControl:!1}});const m=new AudioContext;this.source=m.createMediaStreamSource(this.stream),this.gain=new GainNode(m,{gain:1}),await m.audioWorklet.addModule(_r);const n=await Ar({url:Sr,simdUrl:Er});this.rnnoise=new vr(m,{wasmBinary:n,maxChannels:2}),this.source.connect(this.rnnoise),this.rnnoise.connect(this.gain),this.analyser=m.createAnalyser(),this.source.connect(this.analyser),this.analyser.fftSize=Math.pow(2,12),this.analyser.smoothingTimeConstant=0}disconnect(){var m,n,u,y,P;(m=this.stream)==null||m.getTracks().forEach(ct=>ct.stop()),(n=this.source)==null||n.disconnect(),(u=this.gain)==null||u.disconnect(),(y=this.rnnoise)==null||y.destroy(),(P=this.rnnoise)==null||P.disconnect()}capture(){const m=this.analyser.frequencyBinCount,n=new Uint8Array(Math.floor(m*this.pct));return this.analyser.getByteFrequencyData(n),n}loop(){this.frameID=requestAnimationFrame(()=>this.loop());const m=this.capture();this.dispatchEvent(new CustomEvent("data",{detail:m}))}start(){this.recording||this.connect().then(()=>{this.dispatchEvent(new CustomEvent("start")),setTimeout(()=>{this.loop(),this.recording=!0},100)}).catch(m=>{console.error(m),alert("Could not start recording")})}stop(){this.recording&&(cancelAnimationFrame(this.frameID),this.disconnect(),this.dispatchEvent(new CustomEvent("stop")),this.recording=!1)}toggle(){this.recording?this.stop():this.start()}render(){return pe`
      <button @click=${this.toggle} class=${this.recording?"active":""}>
        <slot></slot>
      </button>
    `}};Ri.styles=[ks,ve`
      :host {
        display: block;
      }
      button.active {
        background: var(--color-orange);
      }
    `];nn([he({type:Boolean})],Ri.prototype,"recording",2);Ri=nn([we("frequency-recorder")],Ri);function rn(m){return`hsla(${360-m*360}, 100%, 50%, ${m})`}var Tr=Object.defineProperty,Pr=Object.getOwnPropertyDescriptor,Ms=(m,n,u,y)=>{for(var P=y>1?void 0:y?Pr(n,u):n,ct=m.length-1,U;ct>=0;ct--)(U=m[ct])&&(P=(y?U(n,u,P):U(P))||P);return y&&P&&Tr(n,u,P),P};let ai=class extends be{render(){return pe`<canvas width="0" height="0"></canvas>`}updated(){const m=this.canvas,n=m.getContext("2d");if(!this.data){m.width=0,m.height=0;return}m.width=this.data.length,m.height=5,this.data.forEach((u,y)=>{n.fillStyle=rn(u/255),n.fillRect(y,0,1,5)})}};ai.styles=ve`
    :host {
      display: block;
    }
    canvas {
      display: block;
    }
  `;Ms([he({type:Object})],ai.prototype,"data",2);Ms([ye("canvas")],ai.prototype,"canvas",2);ai=Ms([we("graph-1d")],ai);var xr=Object.defineProperty,kr=Object.getOwnPropertyDescriptor,Rs=(m,n,u,y)=>{for(var P=y>1?void 0:y?kr(n,u):n,ct=m.length-1,U;ct>=0;ct--)(U=m[ct])&&(P=(y?U(n,u,P):U(P))||P);return y&&P&&xr(n,u,P),P};let oi=class extends be{render(){return pe`<canvas width="0" height="0" @pointerdown=${m=>{const n=this.canvas.getBoundingClientRect(),u=m.clientX-n.left,y=m.clientY-n.top,P=u/n.width,ct=y/n.height,U=Math.floor(P*this.data.length||0),o=Math.floor((1-ct)*this.data[0].length);this.dispatchEvent(new CustomEvent("select",{detail:{column:U,row:o,x:u,y}}))}}></canvas>`}updated(){var U;if(!this.data||!this.data.length)return;const m=this.canvas,n=m.getContext("2d"),u=((U=this.data[0])==null?void 0:U.length)||0;m.width=this.data.length,m.height=u;let y=0;const P=50,ct=()=>{for(let o=y;o<Math.min(y+P,this.data.length);o++)for(let V=0;V<u;V++)n.fillStyle=rn(this.data[o][V]/255),n.fillRect(o,u-V,1,1);y+=P,y<this.data.length&&requestAnimationFrame(ct)};ct()}};oi.styles=ve`
    :host {
      display: block;
    }
    canvas {
      display: block;
    }
  `;Rs([he({type:Array})],oi.prototype,"data",2);Rs([ye("canvas")],oi.prototype,"canvas",2);oi=Rs([we("graph-2d")],oi);function Mr(m){if(m.__esModule)return m;var n=m.default;if(typeof n=="function"){var u=function y(){return this instanceof y?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};u.prototype=n.prototype}else u={};return Object.defineProperty(u,"__esModule",{value:!0}),Object.keys(m).forEach(function(y){var P=Object.getOwnPropertyDescriptor(m,y);Object.defineProperty(u,y,P.get?P:{enumerable:!0,get:function(){return m[y]}})}),u}function Bi(m){throw new Error('Could not dynamically require "'+m+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var an={exports:{}};const Rr={},Fr=Object.freeze(Object.defineProperty({__proto__:null,default:Rr},Symbol.toStringTag,{value:"Module"})),Se=Mr(Fr);(function(m,n){(function(y,P){m.exports=y.pdfjsLib=P()})(globalThis,()=>(()=>{var u=[,(U,o)=>{var X;Object.defineProperty(o,"__esModule",{value:!0}),o.VerbosityLevel=o.Util=o.UnknownErrorException=o.UnexpectedResponseException=o.TextRenderingMode=o.RenderingIntentFlag=o.PromiseCapability=o.PermissionFlag=o.PasswordResponses=o.PasswordException=o.PageActionEventType=o.OPS=o.MissingPDFException=o.MAX_IMAGE_SIZE_TO_CACHE=o.LINE_FACTOR=o.LINE_DESCENT_FACTOR=o.InvalidPDFException=o.ImageKind=o.IDENTITY_MATRIX=o.FormatError=o.FeatureTest=o.FONT_IDENTITY_MATRIX=o.DocumentActionEventType=o.CMapCompressionType=o.BaseException=o.BASELINE_FACTOR=o.AnnotationType=o.AnnotationReplyType=o.AnnotationPrefix=o.AnnotationMode=o.AnnotationFlag=o.AnnotationFieldFlag=o.AnnotationEditorType=o.AnnotationEditorPrefix=o.AnnotationEditorParamsType=o.AnnotationBorderStyleType=o.AnnotationActionEventType=o.AbortException=void 0,o.assert=bt,o.bytesToString=B,o.createValidAbsoluteUrl=Ut,o.getModificationDate=Ot,o.getUuid=pt,o.getVerbosityLevel=ut,o.info=Et,o.isArrayBuffer=vt,o.isArrayEqual=Ft,o.isNodeJS=void 0,o.normalizeUnicode=Zt,o.objectFromMap=mt,o.objectSize=ft,o.setVerbosityLevel=j,o.shadow=$t,o.string32=nt,o.stringToBytes=lt,o.stringToPDFString=St,o.stringToUTF8String=it,o.unreachable=et,o.utf8StringToString=st,o.warn=yt;const V=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");o.isNodeJS=V;const r=[1,0,0,1,0,0];o.IDENTITY_MATRIX=r;const x=[.001,0,0,.001,0,0];o.FONT_IDENTITY_MATRIX=x;const q=1e7;o.MAX_IMAGE_SIZE_TO_CACHE=q;const Y=1.35;o.LINE_FACTOR=Y;const gt=.35;o.LINE_DESCENT_FACTOR=gt;const z=gt/Y;o.BASELINE_FACTOR=z;const F={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};o.RenderingIntentFlag=F;const g={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};o.AnnotationMode=g;const H="pdfjs_internal_editor_";o.AnnotationEditorPrefix=H;const W={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};o.AnnotationEditorType=W;const L={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};o.AnnotationEditorParamsType=L;const E={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};o.PermissionFlag=E;const w={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};o.TextRenderingMode=w;const f={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};o.ImageKind=f;const A={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};o.AnnotationType=A;const M={GROUP:"Group",REPLY:"R"};o.AnnotationReplyType=M;const k={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};o.AnnotationFlag=k;const v={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};o.AnnotationFieldFlag=v;const l={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};o.AnnotationBorderStyleType=l;const h={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};o.AnnotationActionEventType=h;const I={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};o.DocumentActionEventType=I;const Q={O:"PageOpen",C:"PageClose"};o.PageActionEventType=Q;const J={ERRORS:0,WARNINGS:1,INFOS:5};o.VerbosityLevel=J;const _t={NONE:0,BINARY:1};o.CMapCompressionType=_t;const at={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};o.OPS=at;const xt={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};o.PasswordResponses=xt;let Ct=J.WARNINGS;function j(_){Number.isInteger(_)&&(Ct=_)}function ut(){return Ct}function Et(_){Ct>=J.INFOS&&console.log(`Info: ${_}`)}function yt(_){Ct>=J.WARNINGS&&console.log(`Warning: ${_}`)}function et(_){throw new Error(_)}function bt(_,S){_||et(S)}function Rt(_){switch(_==null?void 0:_.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Ut(_,S=null,C=null){if(!_)return null;try{if(C&&typeof _=="string"){if(C.addDefaultProtocol&&_.startsWith("www.")){const dt=_.match(/\./g);(dt==null?void 0:dt.length)>=2&&(_=`http://${_}`)}if(C.tryConvertEncoding)try{_=it(_)}catch{}}const rt=S?new URL(_,S):new URL(_);if(Rt(rt))return rt}catch{}return null}function $t(_,S,C,rt=!1){return Object.defineProperty(_,S,{value:C,enumerable:!rt,configurable:!0,writable:!1}),C}const T=function(){function S(C,rt){this.constructor===S&&et("Cannot initialize BaseException."),this.message=C,this.name=rt}return S.prototype=new Error,S.constructor=S,S}();o.BaseException=T;class i extends T{constructor(S,C){super(S,"PasswordException"),this.code=C}}o.PasswordException=i;class a extends T{constructor(S,C){super(S,"UnknownErrorException"),this.details=C}}o.UnknownErrorException=a;class s extends T{constructor(S){super(S,"InvalidPDFException")}}o.InvalidPDFException=s;class c extends T{constructor(S){super(S,"MissingPDFException")}}o.MissingPDFException=c;class d extends T{constructor(S,C){super(S,"UnexpectedResponseException"),this.status=C}}o.UnexpectedResponseException=d;class b extends T{constructor(S){super(S,"FormatError")}}o.FormatError=b;class R extends T{constructor(S){super(S,"AbortException")}}o.AbortException=R;function B(_){(typeof _!="object"||(_==null?void 0:_.length)===void 0)&&et("Invalid argument for bytesToString");const S=_.length,C=8192;if(S<C)return String.fromCharCode.apply(null,_);const rt=[];for(let dt=0;dt<S;dt+=C){const qt=Math.min(dt+C,S),ie=_.subarray(dt,qt);rt.push(String.fromCharCode.apply(null,ie))}return rt.join("")}function lt(_){typeof _!="string"&&et("Invalid argument for stringToBytes");const S=_.length,C=new Uint8Array(S);for(let rt=0;rt<S;++rt)C[rt]=_.charCodeAt(rt)&255;return C}function nt(_){return String.fromCharCode(_>>24&255,_>>16&255,_>>8&255,_&255)}function ft(_){return Object.keys(_).length}function mt(_){const S=Object.create(null);for(const[C,rt]of _)S[C]=rt;return S}function Mt(){const _=new Uint8Array(4);return _[0]=1,new Uint32Array(_.buffer,0,1)[0]===1}function At(){try{return new Function(""),!0}catch{return!1}}class Bt{static get isLittleEndian(){return $t(this,"isLittleEndian",Mt())}static get isEvalSupported(){return $t(this,"isEvalSupported",At())}static get isOffscreenCanvasSupported(){return $t(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?$t(this,"platform",{isWin:!1,isMac:!1}):$t(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){var S,C;return $t(this,"isCSSRoundSupported",(C=(S=globalThis.CSS)==null?void 0:S.supports)==null?void 0:C.call(S,"width: round(1.5px, 1px)"))}}o.FeatureTest=Bt;const Vt=[...Array(256).keys()].map(_=>_.toString(16).padStart(2,"0"));class kt{static makeHexColor(S,C,rt){return`#${Vt[S]}${Vt[C]}${Vt[rt]}`}static scaleMinMax(S,C){let rt;S[0]?(S[0]<0&&(rt=C[0],C[0]=C[1],C[1]=rt),C[0]*=S[0],C[1]*=S[0],S[3]<0&&(rt=C[2],C[2]=C[3],C[3]=rt),C[2]*=S[3],C[3]*=S[3]):(rt=C[0],C[0]=C[2],C[2]=rt,rt=C[1],C[1]=C[3],C[3]=rt,S[1]<0&&(rt=C[2],C[2]=C[3],C[3]=rt),C[2]*=S[1],C[3]*=S[1],S[2]<0&&(rt=C[0],C[0]=C[1],C[1]=rt),C[0]*=S[2],C[1]*=S[2]),C[0]+=S[4],C[1]+=S[4],C[2]+=S[5],C[3]+=S[5]}static transform(S,C){return[S[0]*C[0]+S[2]*C[1],S[1]*C[0]+S[3]*C[1],S[0]*C[2]+S[2]*C[3],S[1]*C[2]+S[3]*C[3],S[0]*C[4]+S[2]*C[5]+S[4],S[1]*C[4]+S[3]*C[5]+S[5]]}static applyTransform(S,C){const rt=S[0]*C[0]+S[1]*C[2]+C[4],dt=S[0]*C[1]+S[1]*C[3]+C[5];return[rt,dt]}static applyInverseTransform(S,C){const rt=C[0]*C[3]-C[1]*C[2],dt=(S[0]*C[3]-S[1]*C[2]+C[2]*C[5]-C[4]*C[3])/rt,qt=(-S[0]*C[1]+S[1]*C[0]+C[4]*C[1]-C[5]*C[0])/rt;return[dt,qt]}static getAxialAlignedBoundingBox(S,C){const rt=this.applyTransform(S,C),dt=this.applyTransform(S.slice(2,4),C),qt=this.applyTransform([S[0],S[3]],C),ie=this.applyTransform([S[2],S[1]],C);return[Math.min(rt[0],dt[0],qt[0],ie[0]),Math.min(rt[1],dt[1],qt[1],ie[1]),Math.max(rt[0],dt[0],qt[0],ie[0]),Math.max(rt[1],dt[1],qt[1],ie[1])]}static inverseTransform(S){const C=S[0]*S[3]-S[1]*S[2];return[S[3]/C,-S[1]/C,-S[2]/C,S[0]/C,(S[2]*S[5]-S[4]*S[3])/C,(S[4]*S[1]-S[5]*S[0])/C]}static singularValueDecompose2dScale(S){const C=[S[0],S[2],S[1],S[3]],rt=S[0]*C[0]+S[1]*C[2],dt=S[0]*C[1]+S[1]*C[3],qt=S[2]*C[0]+S[3]*C[2],ie=S[2]*C[1]+S[3]*C[3],K=(rt+ie)/2,Tt=Math.sqrt((rt+ie)**2-4*(rt*ie-qt*dt))/2,Nt=K+Tt||1,Dt=K-Tt||1;return[Math.sqrt(Nt),Math.sqrt(Dt)]}static normalizeRect(S){const C=S.slice(0);return S[0]>S[2]&&(C[0]=S[2],C[2]=S[0]),S[1]>S[3]&&(C[1]=S[3],C[3]=S[1]),C}static intersect(S,C){const rt=Math.max(Math.min(S[0],S[2]),Math.min(C[0],C[2])),dt=Math.min(Math.max(S[0],S[2]),Math.max(C[0],C[2]));if(rt>dt)return null;const qt=Math.max(Math.min(S[1],S[3]),Math.min(C[1],C[3])),ie=Math.min(Math.max(S[1],S[3]),Math.max(C[1],C[3]));return qt>ie?null:[rt,qt,dt,ie]}static bezierBoundingBox(S,C,rt,dt,qt,ie,K,Tt){const Nt=[],Dt=[[],[]];let Xt,Gt,ne,Pt,se,Wt,D,e;for(let tt=0;tt<2;++tt){if(tt===0?(Gt=6*S-12*rt+6*qt,Xt=-3*S+9*rt-9*qt+3*K,ne=3*rt-3*S):(Gt=6*C-12*dt+6*ie,Xt=-3*C+9*dt-9*ie+3*Tt,ne=3*dt-3*C),Math.abs(Xt)<1e-12){if(Math.abs(Gt)<1e-12)continue;Pt=-ne/Gt,0<Pt&&Pt<1&&Nt.push(Pt);continue}D=Gt*Gt-4*ne*Xt,e=Math.sqrt(D),!(D<0)&&(se=(-Gt+e)/(2*Xt),0<se&&se<1&&Nt.push(se),Wt=(-Gt-e)/(2*Xt),0<Wt&&Wt<1&&Nt.push(Wt))}let p=Nt.length,N;const G=p;for(;p--;)Pt=Nt[p],N=1-Pt,Dt[0][p]=N*N*N*S+3*N*N*Pt*rt+3*N*Pt*Pt*qt+Pt*Pt*Pt*K,Dt[1][p]=N*N*N*C+3*N*N*Pt*dt+3*N*Pt*Pt*ie+Pt*Pt*Pt*Tt;return Dt[0][G]=S,Dt[1][G]=C,Dt[0][G+1]=K,Dt[1][G+1]=Tt,Dt[0].length=Dt[1].length=G+2,[Math.min(...Dt[0]),Math.min(...Dt[1]),Math.max(...Dt[0]),Math.max(...Dt[1])]}}o.Util=kt;const jt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function St(_){if(_[0]>="ï"){let C;if(_[0]==="þ"&&_[1]==="ÿ"?C="utf-16be":_[0]==="ÿ"&&_[1]==="þ"?C="utf-16le":_[0]==="ï"&&_[1]==="»"&&_[2]==="¿"&&(C="utf-8"),C)try{const rt=new TextDecoder(C,{fatal:!0}),dt=lt(_);return rt.decode(dt)}catch(rt){yt(`stringToPDFString: "${rt}".`)}}const S=[];for(let C=0,rt=_.length;C<rt;C++){const dt=jt[_.charCodeAt(C)];S.push(dt?String.fromCharCode(dt):_.charAt(C))}return S.join("")}function it(_){return decodeURIComponent(escape(_))}function st(_){return unescape(encodeURIComponent(_))}function vt(_){return typeof _=="object"&&(_==null?void 0:_.byteLength)!==void 0}function Ft(_,S){if(_.length!==S.length)return!1;for(let C=0,rt=_.length;C<rt;C++)if(_[C]!==S[C])return!1;return!0}function Ot(_=new Date){return[_.getUTCFullYear().toString(),(_.getUTCMonth()+1).toString().padStart(2,"0"),_.getUTCDate().toString().padStart(2,"0"),_.getUTCHours().toString().padStart(2,"0"),_.getUTCMinutes().toString().padStart(2,"0"),_.getUTCSeconds().toString().padStart(2,"0")].join("")}class te{constructor(){$(this,X,!1);this.promise=new Promise((S,C)=>{this.resolve=rt=>{ot(this,X,!0),S(rt)},this.reject=rt=>{ot(this,X,!0),C(rt)}})}get settled(){return t(this,X)}}X=new WeakMap,o.PromiseCapability=te;let Kt=null,Jt=null;function Zt(_){return Kt||(Kt=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Jt=new Map([["ﬅ","ſt"]])),_.replaceAll(Kt,(S,C,rt)=>C?C.normalize("NFKC"):Jt.get(rt))}function pt(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const _=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(_);else for(let S=0;S<32;S++)_[S]=Math.floor(Math.random()*255);return B(_)}const O="pdfjs_internal_id_";o.AnnotationPrefix=O},(U,o,V)=>{var c,b,R,B,Le,nt,pi,mt,Mt,At,Bt,kt,jt,St,it,st,gi,Ft,Ot,zi,Kt,Jt;Object.defineProperty(o,"__esModule",{value:!0}),o.RenderTask=o.PDFWorkerUtil=o.PDFWorker=o.PDFPageProxy=o.PDFDocumentProxy=o.PDFDocumentLoadingTask=o.PDFDataRangeTransport=o.LoopbackPort=o.DefaultStandardFontDataFactory=o.DefaultFilterFactory=o.DefaultCanvasFactory=o.DefaultCMapReaderFactory=void 0,Object.defineProperty(o,"SVGGraphics",{enumerable:!0,get:function(){return A.SVGGraphics}}),o.build=void 0,o.getDocument=_t,o.version=void 0;var r=V(1),x=V(3),q=V(6),Y=V(9),gt=V(10),z=V(11),F=V(14),g=V(15),H=V(16),W=V(17),L=V(18),E=V(19),w=V(22),f=V(23),A=V(24),M=V(25);const k=65536,v=100,l=5e3,h=r.isNodeJS?gt.NodeCanvasFactory:q.DOMCanvasFactory;o.DefaultCanvasFactory=h;const I=r.isNodeJS?gt.NodeCMapReaderFactory:q.DOMCMapReaderFactory;o.DefaultCMapReaderFactory=I;const Q=r.isNodeJS?gt.NodeFilterFactory:q.DOMFilterFactory;o.DefaultFilterFactory=Q;const J=r.isNodeJS?gt.NodeStandardFontDataFactory:q.DOMStandardFontDataFactory;o.DefaultStandardFontDataFactory=J;function _t(pt){if(typeof pt=="string"||pt instanceof URL?pt={url:pt}:(0,r.isArrayBuffer)(pt)&&(pt={data:pt}),typeof pt!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!pt.url&&!pt.data&&!pt.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const O=new j,{docId:X}=O,_=pt.url?xt(pt.url):null,S=pt.data?Ct(pt.data):null,C=pt.httpHeaders||null,rt=pt.withCredentials===!0,dt=pt.password??null,qt=pt.range instanceof ut?pt.range:null,ie=Number.isInteger(pt.rangeChunkSize)&&pt.rangeChunkSize>0?pt.rangeChunkSize:k;let K=pt.worker instanceof Rt?pt.worker:null;const Tt=pt.verbosity,Nt=typeof pt.docBaseUrl=="string"&&!(0,q.isDataScheme)(pt.docBaseUrl)?pt.docBaseUrl:null,Dt=typeof pt.cMapUrl=="string"?pt.cMapUrl:null,Xt=pt.cMapPacked!==!1,Gt=pt.CMapReaderFactory||I,ne=typeof pt.standardFontDataUrl=="string"?pt.standardFontDataUrl:null,Pt=pt.StandardFontDataFactory||J,se=pt.stopAtErrors!==!0,Wt=Number.isInteger(pt.maxImageSize)&&pt.maxImageSize>-1?pt.maxImageSize:-1,D=pt.isEvalSupported!==!1,e=typeof pt.isOffscreenCanvasSupported=="boolean"?pt.isOffscreenCanvasSupported:!r.isNodeJS,p=Number.isInteger(pt.canvasMaxAreaInBytes)?pt.canvasMaxAreaInBytes:-1,N=typeof pt.disableFontFace=="boolean"?pt.disableFontFace:r.isNodeJS,G=pt.fontExtraProperties===!0,tt=pt.enableXfa===!0,ht=pt.ownerDocument||globalThis.document,wt=pt.disableRange===!0,Lt=pt.disableStream===!0,It=pt.disableAutoFetch===!0,Qt=pt.pdfBug===!0,Ht=qt?qt.length:pt.length??NaN,zt=typeof pt.useSystemFonts=="boolean"?pt.useSystemFonts:!r.isNodeJS&&!N,Yt=typeof pt.useWorkerFetch=="boolean"?pt.useWorkerFetch:Gt===q.DOMCMapReaderFactory&&Pt===q.DOMStandardFontDataFactory&&Dt&&ne&&(0,q.isValidFetchUrl)(Dt,document.baseURI)&&(0,q.isValidFetchUrl)(ne,document.baseURI),ee=pt.canvasFactory||new h({ownerDocument:ht}),re=pt.filterFactory||new Q({docId:X,ownerDocument:ht}),ae=null;(0,r.setVerbosityLevel)(Tt);const ce={canvasFactory:ee,filterFactory:re};if(Yt||(ce.cMapReaderFactory=new Gt({baseUrl:Dt,isCompressed:Xt}),ce.standardFontDataFactory=new Pt({baseUrl:ne})),!K){const me={verbosity:Tt,port:F.GlobalWorkerOptions.workerPort};K=me.port?Rt.fromPort(me):new Rt(me),O._worker=K}const le={docId:X,apiVersion:"3.11.174",data:S,password:dt,disableAutoFetch:It,rangeChunkSize:ie,length:Ht,docBaseUrl:Nt,enableXfa:tt,evaluatorOptions:{maxImageSize:Wt,disableFontFace:N,ignoreErrors:se,isEvalSupported:D,isOffscreenCanvasSupported:e,canvasMaxAreaInBytes:p,fontExtraProperties:G,useSystemFonts:zt,cMapUrl:Yt?Dt:null,standardFontDataUrl:Yt?ne:null}},ge={ignoreErrors:se,isEvalSupported:D,disableFontFace:N,fontExtraProperties:G,enableXfa:tt,ownerDocument:ht,disableAutoFetch:It,pdfBug:Qt,styleElement:ae};return K.promise.then(function(){if(O.destroyed)throw new Error("Loading aborted");const me=at(K,le),_e=new Promise(function(De){let We;qt?We=new L.PDFDataTransportStream({length:Ht,initialData:qt.initialData,progressiveDone:qt.progressiveDone,contentDispositionFilename:qt.contentDispositionFilename,disableRange:wt,disableStream:Lt},qt):S||(We=(Oe=>r.isNodeJS?new f.PDFNodeStream(Oe):(0,q.isValidFetchUrl)(Oe.url)?new E.PDFFetchStream(Oe):new w.PDFNetworkStream(Oe))({url:_,length:Ht,httpHeaders:C,withCredentials:rt,rangeChunkSize:ie,disableRange:wt,disableStream:Lt})),De(We)});return Promise.all([me,_e]).then(function([De,We]){if(O.destroyed)throw new Error("Loading aborted");const Oi=new g.MessageHandler(X,De,K.port),Oe=new Ut(Oi,O,We,ge,ce);O._transport=Oe,Oi.send("Ready",null)})}).catch(O._capability.reject),O}async function at(pt,O){if(pt.destroyed)throw new Error("Worker was destroyed");const X=await pt.messageHandler.sendWithPromise("GetDocRequest",O,O.data?[O.data.buffer]:null);if(pt.destroyed)throw new Error("Worker was destroyed");return X}function xt(pt){if(pt instanceof URL)return pt.href;try{return new URL(pt,window.location).href}catch{if(r.isNodeJS&&typeof pt=="string")return pt}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Ct(pt){if(r.isNodeJS&&typeof Buffer<"u"&&pt instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(pt instanceof Uint8Array&&pt.byteLength===pt.buffer.byteLength)return pt;if(typeof pt=="string")return(0,r.stringToBytes)(pt);if(typeof pt=="object"&&!isNaN(pt==null?void 0:pt.length)||(0,r.isArrayBuffer)(pt))return new Uint8Array(pt);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const d=class d{constructor(){this._capability=new r.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${ze(d,c)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var O,X,_;this.destroyed=!0;try{(O=this._worker)!=null&&O.port&&(this._worker._pendingDestroy=!0),await((X=this._transport)==null?void 0:X.destroy())}catch(S){throw(_=this._worker)!=null&&_.port&&delete this._worker._pendingDestroy,S}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};c=new WeakMap,$(d,c,0);let j=d;o.PDFDocumentLoadingTask=j;class ut{constructor(O,X,_=!1,S=null){this.length=O,this.initialData=X,this.progressiveDone=_,this.contentDispositionFilename=S,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new r.PromiseCapability}addRangeListener(O){this._rangeListeners.push(O)}addProgressListener(O){this._progressListeners.push(O)}addProgressiveReadListener(O){this._progressiveReadListeners.push(O)}addProgressiveDoneListener(O){this._progressiveDoneListeners.push(O)}onDataRange(O,X){for(const _ of this._rangeListeners)_(O,X)}onDataProgress(O,X){this._readyCapability.promise.then(()=>{for(const _ of this._progressListeners)_(O,X)})}onDataProgressiveRead(O){this._readyCapability.promise.then(()=>{for(const X of this._progressiveReadListeners)X(O)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const O of this._progressiveDoneListeners)O()})}transportReady(){this._readyCapability.resolve()}requestDataRange(O,X){(0,r.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}o.PDFDataRangeTransport=ut;class Et{constructor(O,X){this._pdfInfo=O,this._transport=X,Object.defineProperty(this,"getJavaScript",{value:()=>((0,q.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(_=>{if(!_)return _;const S=[];for(const C in _)S.push(..._[C]);return S}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,r.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(O){return this._transport.getPage(O)}getPageIndex(O){return this._transport.getPageIndex(O)}getDestinations(){return this._transport.getDestinations()}getDestination(O){return this._transport.getDestination(O)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(O=!1){return this._transport.startCleanup(O||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}o.PDFDocumentProxy=Et;class yt{constructor(O,X,_,S=!1){$(this,B);$(this,nt);$(this,b,null);$(this,R,!1);this._pageIndex=O,this._pageInfo=X,this._transport=_,this._stats=S?new q.StatTimer:null,this._pdfBug=S,this.commonObjs=_.commonObjs,this.objs=new $t,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:O,rotation:X=this.rotate,offsetX:_=0,offsetY:S=0,dontFlip:C=!1}={}){return new q.PageViewport({viewBox:this.view,scale:O,rotation:X,offsetX:_,offsetY:S,dontFlip:C})}getAnnotations({intent:O="display"}={}){const X=this._transport.getRenderingIntent(O);return this._transport.getAnnotations(this._pageIndex,X.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,r.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var O;return((O=this._transport._htmlForXfa)==null?void 0:O.children[this._pageIndex])||null}render({canvasContext:O,viewport:X,intent:_="display",annotationMode:S=r.AnnotationMode.ENABLE,transform:C=null,background:rt=null,optionalContentConfigPromise:dt=null,annotationCanvasMap:qt=null,pageColors:ie=null,printAnnotationStorage:K=null}){var Pt,se;(Pt=this._stats)==null||Pt.time("Overall");const Tt=this._transport.getRenderingIntent(_,S,K);ot(this,R,!1),Z(this,nt,pi).call(this),dt||(dt=this._transport.getOptionalContentConfig());let Nt=this._intentStates.get(Tt.cacheKey);Nt||(Nt=Object.create(null),this._intentStates.set(Tt.cacheKey,Nt)),Nt.streamReaderCancelTimeout&&(clearTimeout(Nt.streamReaderCancelTimeout),Nt.streamReaderCancelTimeout=null);const Dt=!!(Tt.renderingIntent&r.RenderingIntentFlag.PRINT);Nt.displayReadyCapability||(Nt.displayReadyCapability=new r.PromiseCapability,Nt.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(se=this._stats)==null||se.time("Page Request"),this._pumpOperatorList(Tt));const Xt=Wt=>{var D,e;Nt.renderTasks.delete(Gt),(this._maybeCleanupAfterRender||Dt)&&ot(this,R,!0),Z(this,B,Le).call(this,!Dt),Wt?(Gt.capability.reject(Wt),this._abortOperatorList({intentState:Nt,reason:Wt instanceof Error?Wt:new Error(Wt)})):Gt.capability.resolve(),(D=this._stats)==null||D.timeEnd("Rendering"),(e=this._stats)==null||e.timeEnd("Overall")},Gt=new i({callback:Xt,params:{canvasContext:O,viewport:X,transform:C,background:rt},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:qt,operatorList:Nt.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!Dt,pdfBug:this._pdfBug,pageColors:ie});(Nt.renderTasks||(Nt.renderTasks=new Set)).add(Gt);const ne=Gt.task;return Promise.all([Nt.displayReadyCapability.promise,dt]).then(([Wt,D])=>{var e;if(this.destroyed){Xt();return}(e=this._stats)==null||e.time("Rendering"),Gt.initializeGraphics({transparency:Wt,optionalContentConfig:D}),Gt.operatorListChanged()}).catch(Xt),ne}getOperatorList({intent:O="display",annotationMode:X=r.AnnotationMode.ENABLE,printAnnotationStorage:_=null}={}){var qt;function S(){rt.operatorList.lastChunk&&(rt.opListReadCapability.resolve(rt.operatorList),rt.renderTasks.delete(dt))}const C=this._transport.getRenderingIntent(O,X,_,!0);let rt=this._intentStates.get(C.cacheKey);rt||(rt=Object.create(null),this._intentStates.set(C.cacheKey,rt));let dt;return rt.opListReadCapability||(dt=Object.create(null),dt.operatorListChanged=S,rt.opListReadCapability=new r.PromiseCapability,(rt.renderTasks||(rt.renderTasks=new Set)).add(dt),rt.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(qt=this._stats)==null||qt.time("Page Request"),this._pumpOperatorList(C)),rt.opListReadCapability.promise}streamTextContent({includeMarkedContent:O=!1,disableNormalization:X=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:O===!0,disableNormalization:X===!0},{highWaterMark:100,size(S){return S.items.length}})}getTextContent(O={}){if(this._transport._htmlForXfa)return this.getXfa().then(_=>M.XfaText.textContent(_));const X=this.streamTextContent(O);return new Promise(function(_,S){function C(){rt.read().then(function({value:qt,done:ie}){if(ie){_(dt);return}Object.assign(dt.styles,qt.styles),dt.items.push(...qt.items),C()},S)}const rt=X.getReader(),dt={items:[],styles:Object.create(null)};C()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const O=[];for(const X of this._intentStates.values())if(this._abortOperatorList({intentState:X,reason:new Error("Page was destroyed."),force:!0}),!X.opListReadCapability)for(const _ of X.renderTasks)O.push(_.completed),_.cancel();return this.objs.clear(),ot(this,R,!1),Z(this,nt,pi).call(this),Promise.all(O)}cleanup(O=!1){ot(this,R,!0);const X=Z(this,B,Le).call(this,!1);return O&&X&&this._stats&&(this._stats=new q.StatTimer),X}_startRenderPage(O,X){var S,C;const _=this._intentStates.get(X);_&&((S=this._stats)==null||S.timeEnd("Page Request"),(C=_.displayReadyCapability)==null||C.resolve(O))}_renderPageChunk(O,X){for(let _=0,S=O.length;_<S;_++)X.operatorList.fnArray.push(O.fnArray[_]),X.operatorList.argsArray.push(O.argsArray[_]);X.operatorList.lastChunk=O.lastChunk,X.operatorList.separateAnnots=O.separateAnnots;for(const _ of X.renderTasks)_.operatorListChanged();O.lastChunk&&Z(this,B,Le).call(this,!0)}_pumpOperatorList({renderingIntent:O,cacheKey:X,annotationStorageSerializable:_}){const{map:S,transfers:C}=_,dt=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:O,cacheKey:X,annotationStorage:S},C).getReader(),qt=this._intentStates.get(X);qt.streamReader=dt;const ie=()=>{dt.read().then(({value:K,done:Tt})=>{if(Tt){qt.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(K,qt),ie())},K=>{if(qt.streamReader=null,!this._transport.destroyed){if(qt.operatorList){qt.operatorList.lastChunk=!0;for(const Tt of qt.renderTasks)Tt.operatorListChanged();Z(this,B,Le).call(this,!0)}if(qt.displayReadyCapability)qt.displayReadyCapability.reject(K);else if(qt.opListReadCapability)qt.opListReadCapability.reject(K);else throw K}})};ie()}_abortOperatorList({intentState:O,reason:X,force:_=!1}){if(O.streamReader){if(O.streamReaderCancelTimeout&&(clearTimeout(O.streamReaderCancelTimeout),O.streamReaderCancelTimeout=null),!_){if(O.renderTasks.size>0)return;if(X instanceof q.RenderingCancelledException){let S=v;X.extraDelay>0&&X.extraDelay<1e3&&(S+=X.extraDelay),O.streamReaderCancelTimeout=setTimeout(()=>{O.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:O,reason:X,force:!0})},S);return}}if(O.streamReader.cancel(new r.AbortException(X.message)).catch(()=>{}),O.streamReader=null,!this._transport.destroyed){for(const[S,C]of this._intentStates)if(C===O){this._intentStates.delete(S);break}this.cleanup()}}}get stats(){return this._stats}}b=new WeakMap,R=new WeakMap,B=new WeakSet,Le=function(O=!1){if(Z(this,nt,pi).call(this),!t(this,R)||this.destroyed)return!1;if(O)return ot(this,b,setTimeout(()=>{ot(this,b,null),Z(this,B,Le).call(this,!1)},l)),!1;for(const{renderTasks:X,operatorList:_}of this._intentStates.values())if(X.size>0||!_.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),ot(this,R,!1),!0},nt=new WeakSet,pi=function(){t(this,b)&&(clearTimeout(t(this,b)),ot(this,b,null))},o.PDFPageProxy=yt;class et{constructor(){$(this,mt,new Set);$(this,Mt,Promise.resolve())}postMessage(O,X){const _={data:structuredClone(O,X?{transfer:X}:null)};t(this,Mt).then(()=>{for(const S of t(this,mt))S.call(this,_)})}addEventListener(O,X){t(this,mt).add(X)}removeEventListener(O,X){t(this,mt).delete(X)}terminate(){t(this,mt).clear()}}mt=new WeakMap,Mt=new WeakMap,o.LoopbackPort=et;const bt={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};o.PDFWorkerUtil=bt;{if(r.isNodeJS&&typeof Bi=="function")bt.isWorkerDisabled=!0,bt.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const pt=(At=document==null?void 0:document.currentScript)==null?void 0:At.src;pt&&(bt.fallbackWorkerSrc=pt.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}bt.isSameOrigin=function(pt,O){let X;try{if(X=new URL(pt),!X.origin||X.origin==="null")return!1}catch{return!1}const _=new URL(O,X);return X.origin===_.origin},bt.createCDNWrapper=function(pt){const O=`importScripts("${pt}");`;return URL.createObjectURL(new Blob([O]))}}const Vt=class Vt{constructor({name:O=null,port:X=null,verbosity:_=(0,r.getVerbosityLevel)()}={}){var S;if(this.name=O,this.destroyed=!1,this.verbosity=_,this._readyCapability=new r.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,X){if((S=t(Vt,Bt))!=null&&S.has(X))throw new Error("Cannot use more than one PDFWorker per port.");(t(Vt,Bt)||ot(Vt,Bt,new WeakMap)).set(X,this),this._initializeFromPort(X);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(O){this._port=O,this._messageHandler=new g.MessageHandler("main","worker",O),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!bt.isWorkerDisabled&&!Vt._mainThreadWorkerMessageHandler){let{workerSrc:O}=Vt;try{bt.isSameOrigin(window.location.href,O)||(O=bt.createCDNWrapper(new URL(O,window.location).href));const X=new Worker(O),_=new g.MessageHandler("main","worker",X),S=()=>{X.removeEventListener("error",C),_.destroy(),X.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},C=()=>{this._webWorker||S()};X.addEventListener("error",C),_.on("test",dt=>{if(X.removeEventListener("error",C),this.destroyed){S();return}dt?(this._messageHandler=_,this._port=X,this._webWorker=X,this._readyCapability.resolve(),_.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),_.destroy(),X.terminate())}),_.on("ready",dt=>{if(X.removeEventListener("error",C),this.destroyed){S();return}try{rt()}catch{this._setupFakeWorker()}});const rt=()=>{const dt=new Uint8Array;_.send("test",dt,[dt.buffer])};rt();return}catch{(0,r.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){bt.isWorkerDisabled||((0,r.warn)("Setting up fake worker."),bt.isWorkerDisabled=!0),Vt._setupFakeWorkerGlobal.then(O=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const X=new et;this._port=X;const _=`fake${bt.fakeWorkerId++}`,S=new g.MessageHandler(_+"_worker",_,X);O.setup(S,X);const C=new g.MessageHandler(_,_+"_worker",X);this._messageHandler=C,this._readyCapability.resolve(),C.send("configure",{verbosity:this.verbosity})}).catch(O=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${O.message}".`))})}destroy(){var O;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(O=t(Vt,Bt))==null||O.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(O){var _;if(!(O!=null&&O.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const X=(_=t(this,Bt))==null?void 0:_.get(O.port);if(X){if(X._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return X}return new Vt(O)}static get workerSrc(){if(F.GlobalWorkerOptions.workerSrc)return F.GlobalWorkerOptions.workerSrc;if(bt.fallbackWorkerSrc!==null)return r.isNodeJS||(0,q.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),bt.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var O;try{return((O=globalThis.pdfjsWorker)==null?void 0:O.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const O=async()=>{const X=this._mainThreadWorkerMessageHandler;return X||(r.isNodeJS&&typeof Bi=="function"?Bi(this.workerSrc).WorkerMessageHandler:(await(0,q.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler))};return(0,r.shadow)(this,"_setupFakeWorkerGlobal",O())}};Bt=new WeakMap,$(Vt,Bt,void 0);let Rt=Vt;o.PDFWorker=Rt;class Ut{constructor(O,X,_,S,C){$(this,st);$(this,kt,new Map);$(this,jt,new Map);$(this,St,new Map);$(this,it,null);this.messageHandler=O,this.loadingTask=X,this.commonObjs=new $t,this.fontLoader=new Y.FontLoader({ownerDocument:S.ownerDocument,styleElement:S.styleElement}),this._params=S,this.canvasFactory=C.canvasFactory,this.filterFactory=C.filterFactory,this.cMapReaderFactory=C.cMapReaderFactory,this.standardFontDataFactory=C.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=_,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new r.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,r.shadow)(this,"annotationStorage",new x.AnnotationStorage)}getRenderingIntent(O,X=r.AnnotationMode.ENABLE,_=null,S=!1){let C=r.RenderingIntentFlag.DISPLAY,rt=x.SerializableEmpty;switch(O){case"any":C=r.RenderingIntentFlag.ANY;break;case"display":break;case"print":C=r.RenderingIntentFlag.PRINT;break;default:(0,r.warn)(`getRenderingIntent - invalid intent: ${O}`)}switch(X){case r.AnnotationMode.DISABLE:C+=r.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case r.AnnotationMode.ENABLE:break;case r.AnnotationMode.ENABLE_FORMS:C+=r.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case r.AnnotationMode.ENABLE_STORAGE:C+=r.RenderingIntentFlag.ANNOTATIONS_STORAGE,rt=(C&r.RenderingIntentFlag.PRINT&&_ instanceof x.PrintAnnotationStorage?_:this.annotationStorage).serializable;break;default:(0,r.warn)(`getRenderingIntent - invalid annotationMode: ${X}`)}return S&&(C+=r.RenderingIntentFlag.OPLIST),{renderingIntent:C,cacheKey:`${C}_${rt.hash}`,annotationStorageSerializable:rt}}destroy(){var _;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new r.PromiseCapability,(_=t(this,it))==null||_.reject(new Error("Worker was destroyed during onPassword callback"));const O=[];for(const S of t(this,jt).values())O.push(S._destroy());t(this,jt).clear(),t(this,St).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const X=this.messageHandler.sendWithPromise("Terminate",null);return O.push(X),Promise.all(O).then(()=>{var S;this.commonObjs.clear(),this.fontLoader.clear(),t(this,kt).clear(),this.filterFactory.destroy(),(S=this._networkStream)==null||S.cancelAllRequests(new r.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:O,loadingTask:X}=this;O.on("GetReader",(_,S)=>{(0,r.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=C=>{this._lastProgress={loaded:C.loaded,total:C.total}},S.onPull=()=>{this._fullReader.read().then(function({value:C,done:rt}){if(rt){S.close();return}(0,r.assert)(C instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),S.enqueue(new Uint8Array(C),1,[C])}).catch(C=>{S.error(C)})},S.onCancel=C=>{this._fullReader.cancel(C),S.ready.catch(rt=>{if(!this.destroyed)throw rt})}}),O.on("ReaderHeadersReady",_=>{const S=new r.PromiseCapability,C=this._fullReader;return C.headersReady.then(()=>{var rt;(!C.isStreamingSupported||!C.isRangeSupported)&&(this._lastProgress&&((rt=X.onProgress)==null||rt.call(X,this._lastProgress)),C.onProgress=dt=>{var qt;(qt=X.onProgress)==null||qt.call(X,{loaded:dt.loaded,total:dt.total})}),S.resolve({isStreamingSupported:C.isStreamingSupported,isRangeSupported:C.isRangeSupported,contentLength:C.contentLength})},S.reject),S.promise}),O.on("GetRangeReader",(_,S)=>{(0,r.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const C=this._networkStream.getRangeReader(_.begin,_.end);if(!C){S.close();return}S.onPull=()=>{C.read().then(function({value:rt,done:dt}){if(dt){S.close();return}(0,r.assert)(rt instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),S.enqueue(new Uint8Array(rt),1,[rt])}).catch(rt=>{S.error(rt)})},S.onCancel=rt=>{C.cancel(rt),S.ready.catch(dt=>{if(!this.destroyed)throw dt})}}),O.on("GetDoc",({pdfInfo:_})=>{this._numPages=_.numPages,this._htmlForXfa=_.htmlForXfa,delete _.htmlForXfa,X._capability.resolve(new Et(_,this))}),O.on("DocException",function(_){let S;switch(_.name){case"PasswordException":S=new r.PasswordException(_.message,_.code);break;case"InvalidPDFException":S=new r.InvalidPDFException(_.message);break;case"MissingPDFException":S=new r.MissingPDFException(_.message);break;case"UnexpectedResponseException":S=new r.UnexpectedResponseException(_.message,_.status);break;case"UnknownErrorException":S=new r.UnknownErrorException(_.message,_.details);break;default:(0,r.unreachable)("DocException - expected a valid Error.")}X._capability.reject(S)}),O.on("PasswordRequest",_=>{if(ot(this,it,new r.PromiseCapability),X.onPassword){const S=C=>{C instanceof Error?t(this,it).reject(C):t(this,it).resolve({password:C})};try{X.onPassword(S,_.code)}catch(C){t(this,it).reject(C)}}else t(this,it).reject(new r.PasswordException(_.message,_.code));return t(this,it).promise}),O.on("DataLoaded",_=>{var S;(S=X.onProgress)==null||S.call(X,{loaded:_.length,total:_.length}),this.downloadInfoCapability.resolve(_)}),O.on("StartRenderPage",_=>{if(this.destroyed)return;t(this,jt).get(_.pageIndex)._startRenderPage(_.transparency,_.cacheKey)}),O.on("commonobj",([_,S,C])=>{var rt;if(!this.destroyed&&!this.commonObjs.has(_))switch(S){case"Font":const dt=this._params;if("error"in C){const K=C.error;(0,r.warn)(`Error during font loading: ${K}`),this.commonObjs.resolve(_,K);break}const qt=dt.pdfBug&&((rt=globalThis.FontInspector)!=null&&rt.enabled)?(K,Tt)=>globalThis.FontInspector.fontAdded(K,Tt):null,ie=new Y.FontFaceObject(C,{isEvalSupported:dt.isEvalSupported,disableFontFace:dt.disableFontFace,ignoreErrors:dt.ignoreErrors,inspectFont:qt});this.fontLoader.bind(ie).catch(K=>O.sendWithPromise("FontFallback",{id:_})).finally(()=>{!dt.fontExtraProperties&&ie.data&&(ie.data=null),this.commonObjs.resolve(_,ie)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(_,C);break;default:throw new Error(`Got unknown common object type ${S}`)}}),O.on("obj",([_,S,C,rt])=>{var qt;if(this.destroyed)return;const dt=t(this,jt).get(S);if(!dt.objs.has(_))switch(C){case"Image":if(dt.objs.resolve(_,rt),rt){let ie;if(rt.bitmap){const{width:K,height:Tt}=rt;ie=K*Tt*4}else ie=((qt=rt.data)==null?void 0:qt.length)||0;ie>r.MAX_IMAGE_SIZE_TO_CACHE&&(dt._maybeCleanupAfterRender=!0)}break;case"Pattern":dt.objs.resolve(_,rt);break;default:throw new Error(`Got unknown object type ${C}`)}}),O.on("DocProgress",_=>{var S;this.destroyed||(S=X.onProgress)==null||S.call(X,{loaded:_.loaded,total:_.total})}),O.on("FetchBuiltInCMap",_=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(_):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),O.on("FetchStandardFontData",_=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(_):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var _;this.annotationStorage.size<=0&&(0,r.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:O,transfers:X}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:O,filename:((_=this._fullReader)==null?void 0:_.filename)??null},X).finally(()=>{this.annotationStorage.resetModified()})}getPage(O){if(!Number.isInteger(O)||O<=0||O>this._numPages)return Promise.reject(new Error("Invalid page request."));const X=O-1,_=t(this,St).get(X);if(_)return _;const S=this.messageHandler.sendWithPromise("GetPage",{pageIndex:X}).then(C=>{if(this.destroyed)throw new Error("Transport destroyed");const rt=new yt(X,C,this,this._params.pdfBug);return t(this,jt).set(X,rt),rt});return t(this,St).set(X,S),S}getPageIndex(O){return typeof O!="object"||O===null||!Number.isInteger(O.num)||O.num<0||!Number.isInteger(O.gen)||O.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:O.num,gen:O.gen})}getAnnotations(O,X){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:O,intent:X})}getFieldObjects(){return Z(this,st,gi).call(this,"GetFieldObjects")}hasJSActions(){return Z(this,st,gi).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(O){return typeof O!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:O})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return Z(this,st,gi).call(this,"GetDocJSActions")}getPageJSActions(O){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:O})}getStructTree(O){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:O})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(O=>new W.OptionalContentConfig(O))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const O="GetMetadata",X=t(this,kt).get(O);if(X)return X;const _=this.messageHandler.sendWithPromise(O,null).then(S=>{var C,rt;return{info:S[0],metadata:S[1]?new H.Metadata(S[1]):null,contentDispositionFilename:((C=this._fullReader)==null?void 0:C.filename)??null,contentLength:((rt=this._fullReader)==null?void 0:rt.contentLength)??null}});return t(this,kt).set(O,_),_}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(O=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const X of t(this,jt).values())if(!X.cleanup())throw new Error(`startCleanup: Page ${X.pageNumber} is currently rendering.`);this.commonObjs.clear(),O||this.fontLoader.clear(),t(this,kt).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:O,enableXfa:X}=this._params;return(0,r.shadow)(this,"loadingParams",{disableAutoFetch:O,enableXfa:X})}}kt=new WeakMap,jt=new WeakMap,St=new WeakMap,it=new WeakMap,st=new WeakSet,gi=function(O,X=null){const _=t(this,kt).get(O);if(_)return _;const S=this.messageHandler.sendWithPromise(O,X);return t(this,kt).set(O,S),S};class $t{constructor(){$(this,Ot);$(this,Ft,Object.create(null))}get(O,X=null){if(X){const S=Z(this,Ot,zi).call(this,O);return S.capability.promise.then(()=>X(S.data)),null}const _=t(this,Ft)[O];if(!(_!=null&&_.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${O}.`);return _.data}has(O){const X=t(this,Ft)[O];return(X==null?void 0:X.capability.settled)||!1}resolve(O,X=null){const _=Z(this,Ot,zi).call(this,O);_.data=X,_.capability.resolve()}clear(){var O;for(const X in t(this,Ft)){const{data:_}=t(this,Ft)[X];(O=_==null?void 0:_.bitmap)==null||O.close()}ot(this,Ft,Object.create(null))}}Ft=new WeakMap,Ot=new WeakSet,zi=function(O){var X;return(X=t(this,Ft))[O]||(X[O]={capability:new r.PromiseCapability,data:null})};class T{constructor(O){$(this,Kt,null);ot(this,Kt,O),this.onContinue=null}get promise(){return t(this,Kt).capability.promise}cancel(O=0){t(this,Kt).cancel(null,O)}get separateAnnots(){const{separateAnnots:O}=t(this,Kt).operatorList;if(!O)return!1;const{annotationCanvasMap:X}=t(this,Kt);return O.form||O.canvas&&(X==null?void 0:X.size)>0}}Kt=new WeakMap,o.RenderTask=T;const Zt=class Zt{constructor({callback:O,params:X,objs:_,commonObjs:S,annotationCanvasMap:C,operatorList:rt,pageIndex:dt,canvasFactory:qt,filterFactory:ie,useRequestAnimationFrame:K=!1,pdfBug:Tt=!1,pageColors:Nt=null}){this.callback=O,this.params=X,this.objs=_,this.commonObjs=S,this.annotationCanvasMap=C,this.operatorListIdx=null,this.operatorList=rt,this._pageIndex=dt,this.canvasFactory=qt,this.filterFactory=ie,this._pdfBug=Tt,this.pageColors=Nt,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=K===!0&&typeof window<"u",this.cancelled=!1,this.capability=new r.PromiseCapability,this.task=new T(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=X.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:O=!1,optionalContentConfig:X}){var dt,qt;if(this.cancelled)return;if(this._canvas){if(t(Zt,Jt).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");t(Zt,Jt).add(this._canvas)}this._pdfBug&&((dt=globalThis.StepperManager)!=null&&dt.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:_,viewport:S,transform:C,background:rt}=this.params;this.gfx=new z.CanvasGraphics(_,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:X},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:C,viewport:S,transparency:O,background:rt}),this.operatorListIdx=0,this.graphicsReady=!0,(qt=this.graphicsReadyCallback)==null||qt.call(this)}cancel(O=null,X=0){var _;this.running=!1,this.cancelled=!0,(_=this.gfx)==null||_.endDrawing(),t(Zt,Jt).delete(this._canvas),this.callback(O||new q.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,X))}operatorListChanged(){var O;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(O=this.stepper)==null||O.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),t(Zt,Jt).delete(this._canvas),this.callback())))}};Jt=new WeakMap,$(Zt,Jt,new WeakSet);let i=Zt;const a="3.11.174";o.version=a;const s="ce8716743";o.build=s},(U,o,V)=>{var F,g,H,on,L;Object.defineProperty(o,"__esModule",{value:!0}),o.SerializableEmpty=o.PrintAnnotationStorage=o.AnnotationStorage=void 0;var r=V(1),x=V(4),q=V(8);const Y=Object.freeze({map:null,hash:"",transfers:void 0});o.SerializableEmpty=Y;class gt{constructor(){$(this,H);$(this,F,!1);$(this,g,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(w,f){const A=t(this,g).get(w);return A===void 0?f:Object.assign(f,A)}getRawValue(w){return t(this,g).get(w)}remove(w){if(t(this,g).delete(w),t(this,g).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const f of t(this,g).values())if(f instanceof x.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(w,f){const A=t(this,g).get(w);let M=!1;if(A!==void 0)for(const[k,v]of Object.entries(f))A[k]!==v&&(M=!0,A[k]=v);else M=!0,t(this,g).set(w,f);M&&Z(this,H,on).call(this),f instanceof x.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(f.constructor._type)}has(w){return t(this,g).has(w)}getAll(){return t(this,g).size>0?(0,r.objectFromMap)(t(this,g)):null}setAll(w){for(const[f,A]of Object.entries(w))this.setValue(f,A)}get size(){return t(this,g).size}resetModified(){t(this,F)&&(ot(this,F,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new z(this)}get serializable(){if(t(this,g).size===0)return Y;const w=new Map,f=new q.MurmurHash3_64,A=[],M=Object.create(null);let k=!1;for(const[v,l]of t(this,g)){const h=l instanceof x.AnnotationEditor?l.serialize(!1,M):l;h&&(w.set(v,h),f.update(`${v}:${JSON.stringify(h)}`),k||(k=!!h.bitmap))}if(k)for(const v of w.values())v.bitmap&&A.push(v.bitmap);return w.size>0?{map:w,hash:f.hexdigest(),transfers:A}:Y}}F=new WeakMap,g=new WeakMap,H=new WeakSet,on=function(){t(this,F)||(ot(this,F,!0),typeof this.onSetModified=="function"&&this.onSetModified())},o.AnnotationStorage=gt;class z extends gt{constructor(f){super();$(this,L,void 0);const{map:A,hash:M,transfers:k}=f.serializable,v=structuredClone(A,k?{transfer:k}:null);ot(this,L,{map:v,hash:M,transfers:k})}get print(){(0,r.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return t(this,L)}}L=new WeakMap,o.PrintAnnotationStorage=z},(U,o,V)=>{var z,F,g,H,W,L,E,w,f,A,M,k,v,l,h,Gi,Q,Xi,_t,Vi,xt,qi,j,ln,Et,cn,et,hn,Rt,Yi,$t,dn;Object.defineProperty(o,"__esModule",{value:!0}),o.AnnotationEditor=void 0;var r=V(5),x=V(1),q=V(6);const i=class i{constructor(s){$(this,h);$(this,Q);$(this,xt);$(this,j);$(this,Et);$(this,et);$(this,Rt);$(this,$t);$(this,z,"");$(this,F,!1);$(this,g,null);$(this,H,null);$(this,W,null);$(this,L,!1);$(this,E,null);$(this,w,this.focusin.bind(this));$(this,f,this.focusout.bind(this));$(this,A,!1);$(this,M,!1);$(this,k,!1);oe(this,"_initialOptions",Object.create(null));oe(this,"_uiManager",null);oe(this,"_focusEventsAllowed",!0);oe(this,"_l10nPromise",null);$(this,v,!1);$(this,l,i._zIndex++);this.constructor===i&&(0,x.unreachable)("Cannot initialize AnnotationEditor."),this.parent=s.parent,this.id=s.id,this.width=this.height=null,this.pageIndex=s.parent.pageIndex,this.name=s.name,this.div=null,this._uiManager=s.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=s.isCentered,this._structTreeParentId=null;const{rotation:c,rawDims:{pageWidth:d,pageHeight:b,pageX:R,pageY:B}}=this.parent.viewport;this.rotation=c,this.pageRotation=(360+c-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[d,b],this.pageTranslation=[R,B];const[lt,nt]=this.parentDimensions;this.x=s.x/lt,this.y=s.y/nt,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,x.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(s){const c=new gt({id:s.parent.getNextId(),parent:s.parent,uiManager:s._uiManager});c.annotationElementId=s.annotationElementId,c.deleted=!0,c._uiManager.addToAnnotationStorage(c)}static initialize(s,c=null){if(i._l10nPromise||(i._l10nPromise=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(b=>[b,s.get(b)]))),c!=null&&c.strings)for(const b of c.strings)i._l10nPromise.set(b,s.get(b));if(i._borderLineWidth!==-1)return;const d=getComputedStyle(document.documentElement);i._borderLineWidth=parseFloat(d.getPropertyValue("--outline-width"))||0}static updateDefaultParams(s,c){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(s){return!1}static paste(s,c){(0,x.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return t(this,v)}set _isDraggable(s){var c;ot(this,v,s),(c=this.div)==null||c.classList.toggle("draggable",s)}center(){const[s,c]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*c/(s*2),this.y+=this.width*s/(c*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*c/(s*2),this.y-=this.width*s/(c*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(s){this._uiManager.addCommands(s)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=t(this,l)}setParent(s){s!==null&&(this.pageIndex=s.pageIndex,this.pageDimensions=s.pageDimensions),this.parent=s}focusin(s){this._focusEventsAllowed&&(t(this,A)?ot(this,A,!1):this.parent.setSelected(this))}focusout(s){var d;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const c=s.relatedTarget;c!=null&&c.closest(`#${this.id}`)||(s.preventDefault(),(d=this.parent)!=null&&d.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(s,c,d,b){const[R,B]=this.parentDimensions;[d,b]=this.screenToPageTranslation(d,b),this.x=(s+d)/R,this.y=(c+b)/B,this.fixAndSetPosition()}translate(s,c){Z(this,h,Gi).call(this,this.parentDimensions,s,c)}translateInPage(s,c){Z(this,h,Gi).call(this,this.pageDimensions,s,c),this.div.scrollIntoView({block:"nearest"})}drag(s,c){const[d,b]=this.parentDimensions;if(this.x+=s/d,this.y+=c/b,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:ft,y:mt}=this.div.getBoundingClientRect();this.parent.findNewParent(this,ft,mt)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:R,y:B}=this;const[lt,nt]=Z(this,Q,Xi).call(this);R+=lt,B+=nt,this.div.style.left=`${(100*R).toFixed(2)}%`,this.div.style.top=`${(100*B).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[s,c]=this.pageDimensions;let{x:d,y:b,width:R,height:B}=this;switch(R*=s,B*=c,d*=s,b*=c,this.rotation){case 0:d=Math.max(0,Math.min(s-R,d)),b=Math.max(0,Math.min(c-B,b));break;case 90:d=Math.max(0,Math.min(s-B,d)),b=Math.min(c,Math.max(R,b));break;case 180:d=Math.min(s,Math.max(R,d)),b=Math.min(c,Math.max(B,b));break;case 270:d=Math.min(s,Math.max(B,d)),b=Math.max(0,Math.min(c-R,b));break}this.x=d/=s,this.y=b/=c;const[lt,nt]=Z(this,Q,Xi).call(this);d+=lt,b+=nt;const{style:ft}=this.div;ft.left=`${(100*d).toFixed(2)}%`,ft.top=`${(100*b).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(s,c){var d;return Z(d=i,_t,Vi).call(d,s,c,this.parentRotation)}pageTranslationToScreen(s,c){var d;return Z(d=i,_t,Vi).call(d,s,c,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:s,pageDimensions:[c,d]}=this,b=c*s,R=d*s;return x.FeatureTest.isCSSRoundSupported?[Math.round(b),Math.round(R)]:[b,R]}setDims(s,c){var R;const[d,b]=this.parentDimensions;this.div.style.width=`${(100*s/d).toFixed(2)}%`,t(this,L)||(this.div.style.height=`${(100*c/b).toFixed(2)}%`),(R=t(this,g))==null||R.classList.toggle("small",s<i.SMALL_EDITOR_SIZE||c<i.SMALL_EDITOR_SIZE)}fixDims(){const{style:s}=this.div,{height:c,width:d}=s,b=d.endsWith("%"),R=!t(this,L)&&c.endsWith("%");if(b&&R)return;const[B,lt]=this.parentDimensions;b||(s.width=`${(100*parseFloat(d)/B).toFixed(2)}%`),!t(this,L)&&!R&&(s.height=`${(100*parseFloat(c)/lt).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}async addAltTextButton(){if(t(this,g))return;const s=ot(this,g,document.createElement("button"));s.className="altText";const c=await i._l10nPromise.get("editor_alt_text_button_label");s.textContent=c,s.setAttribute("aria-label",c),s.tabIndex="0",s.addEventListener("contextmenu",q.noContextMenu),s.addEventListener("pointerdown",d=>d.stopPropagation()),s.addEventListener("click",d=>{d.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),s.addEventListener("keydown",d=>{d.target===s&&d.key==="Enter"&&(d.preventDefault(),this._uiManager.editAltText(this))}),Z(this,Rt,Yi).call(this),this.div.append(s),i.SMALL_EDITOR_SIZE||(i.SMALL_EDITOR_SIZE=Math.min(128,Math.round(s.getBoundingClientRect().width*1.4)))}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:t(this,z),decorative:t(this,F)}}set altTextData({altText:s,decorative:c}){t(this,z)===s&&t(this,F)===c||(ot(this,z,s),ot(this,F,c),Z(this,Rt,Yi).call(this))}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",t(this,w)),this.div.addEventListener("focusout",t(this,f));const[s,c]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*c/s).toFixed(2)}%`,this.div.style.maxHeight=`${(100*s/c).toFixed(2)}%`);const[d,b]=this.getInitialTranslation();return this.translate(d,b),(0,r.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(s){const{isMac:c}=x.FeatureTest.platform;if(s.button!==0||s.ctrlKey&&c){s.preventDefault();return}ot(this,A,!0),Z(this,$t,dn).call(this,s)}moveInDOM(){var s;(s=this.parent)==null||s.moveEditorInDOM(this)}_setParentAndPosition(s,c,d){s.changeParent(this),this.x=c,this.y=d,this.fixAndSetPosition()}getRect(s,c){const d=this.parentScale,[b,R]=this.pageDimensions,[B,lt]=this.pageTranslation,nt=s/d,ft=c/d,mt=this.x*b,Mt=this.y*R,At=this.width*b,Bt=this.height*R;switch(this.rotation){case 0:return[mt+nt+B,R-Mt-ft-Bt+lt,mt+nt+At+B,R-Mt-ft+lt];case 90:return[mt+ft+B,R-Mt+nt+lt,mt+ft+Bt+B,R-Mt+nt+At+lt];case 180:return[mt-nt-At+B,R-Mt+ft+lt,mt-nt+B,R-Mt+ft+Bt+lt];case 270:return[mt-ft-Bt+B,R-Mt-nt-At+lt,mt-ft+B,R-Mt-nt+lt];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(s,c){const[d,b,R,B]=s,lt=R-d,nt=B-b;switch(this.rotation){case 0:return[d,c-B,lt,nt];case 90:return[d,c-b,nt,lt];case 180:return[R,c-b,lt,nt];case 270:return[R,c-B,nt,lt];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){ot(this,k,!0)}disableEditMode(){ot(this,k,!1)}isInEditMode(){return t(this,k)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var s,c;(s=this.div)==null||s.addEventListener("focusin",t(this,w)),(c=this.div)==null||c.addEventListener("focusout",t(this,f))}serialize(s=!1,c=null){(0,x.unreachable)("An editor must be serializable")}static deserialize(s,c,d){const b=new this.prototype.constructor({parent:c,id:c.getNextId(),uiManager:d});b.rotation=s.rotation;const[R,B]=b.pageDimensions,[lt,nt,ft,mt]=b.getRectInCurrentCoords(s.rect,B);return b.x=lt/R,b.y=nt/B,b.width=ft/R,b.height=mt/B,b}remove(){var s;this.div.removeEventListener("focusin",t(this,w)),this.div.removeEventListener("focusout",t(this,f)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),(s=t(this,g))==null||s.remove(),ot(this,g,null),ot(this,H,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(Z(this,j,ln).call(this),t(this,E).classList.remove("hidden"))}select(){var s;this.makeResizable(),(s=this.div)==null||s.classList.add("selectedEditor")}unselect(){var s,c,d;(s=t(this,E))==null||s.classList.add("hidden"),(c=this.div)==null||c.classList.remove("selectedEditor"),(d=this.div)!=null&&d.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(s,c){}disableEditing(){t(this,g)&&(t(this,g).hidden=!0)}enableEditing(){t(this,g)&&(t(this,g).hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return t(this,M)}set isEditing(s){ot(this,M,s),this.parent&&(s?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(s,c){ot(this,L,!0);const d=s/c,{style:b}=this.div;b.aspectRatio=d,b.height="auto"}static get MIN_SIZE(){return 16}};z=new WeakMap,F=new WeakMap,g=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakMap,E=new WeakMap,w=new WeakMap,f=new WeakMap,A=new WeakMap,M=new WeakMap,k=new WeakMap,v=new WeakMap,l=new WeakMap,h=new WeakSet,Gi=function([s,c],d,b){[d,b]=this.screenToPageTranslation(d,b),this.x+=d/s,this.y+=b/c,this.fixAndSetPosition()},Q=new WeakSet,Xi=function(){const[s,c]=this.parentDimensions,{_borderLineWidth:d}=i,b=d/s,R=d/c;switch(this.rotation){case 90:return[-b,R];case 180:return[b,R];case 270:return[b,-R];default:return[-b,-R]}},_t=new WeakSet,Vi=function(s,c,d){switch(d){case 90:return[c,-s];case 180:return[-s,-c];case 270:return[-c,s];default:return[s,c]}},xt=new WeakSet,qi=function(s){switch(s){case 90:{const[c,d]=this.pageDimensions;return[0,-c/d,d/c,0]}case 180:return[-1,0,0,-1];case 270:{const[c,d]=this.pageDimensions;return[0,c/d,-d/c,0]}default:return[1,0,0,1]}},j=new WeakSet,ln=function(){if(t(this,E))return;ot(this,E,document.createElement("div")),t(this,E).classList.add("resizers");const s=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||s.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const c of s){const d=document.createElement("div");t(this,E).append(d),d.classList.add("resizer",c),d.addEventListener("pointerdown",Z(this,Et,cn).bind(this,c)),d.addEventListener("contextmenu",q.noContextMenu)}this.div.prepend(t(this,E))},Et=new WeakSet,cn=function(s,c){c.preventDefault();const{isMac:d}=x.FeatureTest.platform;if(c.button!==0||c.ctrlKey&&d)return;const b=Z(this,et,hn).bind(this,s),R=this._isDraggable;this._isDraggable=!1;const B={passive:!0,capture:!0};window.addEventListener("pointermove",b,B);const lt=this.x,nt=this.y,ft=this.width,mt=this.height,Mt=this.parent.div.style.cursor,At=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(c.target).cursor;const Bt=()=>{this._isDraggable=R,window.removeEventListener("pointerup",Bt),window.removeEventListener("blur",Bt),window.removeEventListener("pointermove",b,B),this.parent.div.style.cursor=Mt,this.div.style.cursor=At;const Vt=this.x,kt=this.y,jt=this.width,St=this.height;Vt===lt&&kt===nt&&jt===ft&&St===mt||this.addCommands({cmd:()=>{this.width=jt,this.height=St,this.x=Vt,this.y=kt;const[it,st]=this.parentDimensions;this.setDims(it*jt,st*St),this.fixAndSetPosition()},undo:()=>{this.width=ft,this.height=mt,this.x=lt,this.y=nt;const[it,st]=this.parentDimensions;this.setDims(it*ft,st*mt),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",Bt),window.addEventListener("blur",Bt)},et=new WeakSet,hn=function(s,c){const[d,b]=this.parentDimensions,R=this.x,B=this.y,lt=this.width,nt=this.height,ft=i.MIN_SIZE/d,mt=i.MIN_SIZE/b,Mt=rt=>Math.round(rt*1e4)/1e4,At=Z(this,xt,qi).call(this,this.rotation),Bt=(rt,dt)=>[At[0]*rt+At[2]*dt,At[1]*rt+At[3]*dt],Vt=Z(this,xt,qi).call(this,360-this.rotation),kt=(rt,dt)=>[Vt[0]*rt+Vt[2]*dt,Vt[1]*rt+Vt[3]*dt];let jt,St,it=!1,st=!1;switch(s){case"topLeft":it=!0,jt=(rt,dt)=>[0,0],St=(rt,dt)=>[rt,dt];break;case"topMiddle":jt=(rt,dt)=>[rt/2,0],St=(rt,dt)=>[rt/2,dt];break;case"topRight":it=!0,jt=(rt,dt)=>[rt,0],St=(rt,dt)=>[0,dt];break;case"middleRight":st=!0,jt=(rt,dt)=>[rt,dt/2],St=(rt,dt)=>[0,dt/2];break;case"bottomRight":it=!0,jt=(rt,dt)=>[rt,dt],St=(rt,dt)=>[0,0];break;case"bottomMiddle":jt=(rt,dt)=>[rt/2,dt],St=(rt,dt)=>[rt/2,0];break;case"bottomLeft":it=!0,jt=(rt,dt)=>[0,dt],St=(rt,dt)=>[rt,0];break;case"middleLeft":st=!0,jt=(rt,dt)=>[0,dt/2],St=(rt,dt)=>[rt,dt/2];break}const vt=jt(lt,nt),Ft=St(lt,nt);let Ot=Bt(...Ft);const te=Mt(R+Ot[0]),Kt=Mt(B+Ot[1]);let Jt=1,Zt=1,[pt,O]=this.screenToPageTranslation(c.movementX,c.movementY);if([pt,O]=kt(pt/d,O/b),it){const rt=Math.hypot(lt,nt);Jt=Zt=Math.max(Math.min(Math.hypot(Ft[0]-vt[0]-pt,Ft[1]-vt[1]-O)/rt,1/lt,1/nt),ft/lt,mt/nt)}else st?Jt=Math.max(ft,Math.min(1,Math.abs(Ft[0]-vt[0]-pt)))/lt:Zt=Math.max(mt,Math.min(1,Math.abs(Ft[1]-vt[1]-O)))/nt;const X=Mt(lt*Jt),_=Mt(nt*Zt);Ot=Bt(...St(X,_));const S=te-Ot[0],C=Kt-Ot[1];this.width=X,this.height=_,this.x=S,this.y=C,this.setDims(d*X,b*_),this.fixAndSetPosition()},Rt=new WeakSet,Yi=async function(){var d;const s=t(this,g);if(!s)return;if(!t(this,z)&&!t(this,F)){s.classList.remove("done"),(d=t(this,H))==null||d.remove();return}i._l10nPromise.get("editor_alt_text_edit_button_label").then(b=>{s.setAttribute("aria-label",b)});let c=t(this,H);if(!c){ot(this,H,c=document.createElement("span")),c.className="tooltip",c.setAttribute("role","tooltip");const b=c.id=`alt-text-tooltip-${this.id}`;s.setAttribute("aria-describedby",b);const R=100;s.addEventListener("mouseenter",()=>{ot(this,W,setTimeout(()=>{ot(this,W,null),t(this,H).classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},R))}),s.addEventListener("mouseleave",()=>{var B;clearTimeout(t(this,W)),ot(this,W,null),(B=t(this,H))==null||B.classList.remove("show")})}s.classList.add("done"),c.innerText=t(this,F)?await i._l10nPromise.get("editor_alt_text_decorative_tooltip"):t(this,z),c.parentNode||s.append(c)},$t=new WeakSet,dn=function(s){if(!this._isDraggable)return;const c=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let d,b;c&&(d={passive:!0,capture:!0},b=B=>{const[lt,nt]=this.screenToPageTranslation(B.movementX,B.movementY);this._uiManager.dragSelectedEditors(lt,nt)},window.addEventListener("pointermove",b,d));const R=()=>{if(window.removeEventListener("pointerup",R),window.removeEventListener("blur",R),c&&window.removeEventListener("pointermove",b,d),ot(this,A,!1),!this._uiManager.endDragSession()){const{isMac:B}=x.FeatureTest.platform;s.ctrlKey&&!B||s.shiftKey||s.metaKey&&B?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",R),window.addEventListener("blur",R)},$(i,_t),oe(i,"_borderLineWidth",-1),oe(i,"_colorManager",new r.ColorManager),oe(i,"_zIndex",1),oe(i,"SMALL_EDITOR_SIZE",0);let Y=i;o.AnnotationEditor=Y;class gt extends Y{constructor(s){super(s),this.annotationElementId=s.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(U,o,V)=>{var L,E,w,f,A,Ki,v,l,h,I,Q,un,at,xt,Ct,j,ut,Et,yt,et,bt,Rt,Ut,$t,T,i,a,s,c,d,b,R,B,lt,nt,ft,mt,Mt,At,Bt,Vt,kt,jt,St,it,st,vt,fn,Ot,Ji,Kt,Qi,Zt,mi,O,Zi,_,ts,C,Ae,dt,Xe,ie,pn,Tt,gn,Dt,es,Gt,Ve,Pt,is;Object.defineProperty(o,"__esModule",{value:!0}),o.KeyboardManager=o.CommandManager=o.ColorManager=o.AnnotationEditorUIManager=void 0,o.bindEvents=q,o.opacityToHex=Y;var r=V(1),x=V(6);function q(D,e,p){for(const N of p)e.addEventListener(N,D[N].bind(D))}function Y(D){return Math.round(Math.min(255,Math.max(1,255*D))).toString(16).padStart(2,"0")}class gt{constructor(){$(this,L,0)}getId(){return`${r.AnnotationEditorPrefix}${ze(this,L)._++}`}}L=new WeakMap;const k=class k{constructor(){$(this,A);$(this,E,(0,r.getUuid)());$(this,w,0);$(this,f,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',N=new OffscreenCanvas(1,3).getContext("2d"),G=new Image;G.src=e;const tt=G.decode().then(()=>(N.drawImage(G,0,0,1,1,0,0,1,3),new Uint32Array(N.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,r.shadow)(this,"_isSVGFittingCanvas",tt)}async getFromFile(e){const{lastModified:p,name:N,size:G,type:tt}=e;return Z(this,A,Ki).call(this,`${p}_${N}_${G}_${tt}`,e)}async getFromUrl(e){return Z(this,A,Ki).call(this,e,e)}async getFromId(e){t(this,f)||ot(this,f,new Map);const p=t(this,f).get(e);return p?p.bitmap?(p.refCounter+=1,p):p.file?this.getFromFile(p.file):this.getFromUrl(p.url):null}getSvgUrl(e){const p=t(this,f).get(e);return p!=null&&p.isSvg?p.svgUrl:null}deleteId(e){t(this,f)||ot(this,f,new Map);const p=t(this,f).get(e);p&&(p.refCounter-=1,p.refCounter===0&&(p.bitmap=null))}isValidId(e){return e.startsWith(`image_${t(this,E)}_`)}};E=new WeakMap,w=new WeakMap,f=new WeakMap,A=new WeakSet,Ki=async function(e,p){t(this,f)||ot(this,f,new Map);let N=t(this,f).get(e);if(N===null)return null;if(N!=null&&N.bitmap)return N.refCounter+=1,N;try{N||(N={bitmap:null,id:`image_${t(this,E)}_${ze(this,w)._++}`,refCounter:0,isSvg:!1});let G;if(typeof p=="string"){N.url=p;const tt=await fetch(p);if(!tt.ok)throw new Error(tt.statusText);G=await tt.blob()}else G=N.file=p;if(G.type==="image/svg+xml"){const tt=k._isSVGFittingCanvas,ht=new FileReader,wt=new Image,Lt=new Promise((It,Qt)=>{wt.onload=()=>{N.bitmap=wt,N.isSvg=!0,It()},ht.onload=async()=>{const Ht=N.svgUrl=ht.result;wt.src=await tt?`${Ht}#svgView(preserveAspectRatio(none))`:Ht},wt.onerror=ht.onerror=Qt});ht.readAsDataURL(G),await Lt}else N.bitmap=await createImageBitmap(G);N.refCounter=1}catch(G){console.error(G),N=null}return t(this,f).set(e,N),N&&t(this,f).set(N.id,N),N};let z=k;class F{constructor(e=128){$(this,v,[]);$(this,l,!1);$(this,h,void 0);$(this,I,-1);ot(this,h,e)}add({cmd:e,undo:p,mustExec:N,type:G=NaN,overwriteIfSameType:tt=!1,keepUndo:ht=!1}){if(N&&e(),t(this,l))return;const wt={cmd:e,undo:p,type:G};if(t(this,I)===-1){t(this,v).length>0&&(t(this,v).length=0),ot(this,I,0),t(this,v).push(wt);return}if(tt&&t(this,v)[t(this,I)].type===G){ht&&(wt.undo=t(this,v)[t(this,I)].undo),t(this,v)[t(this,I)]=wt;return}const Lt=t(this,I)+1;Lt===t(this,h)?t(this,v).splice(0,1):(ot(this,I,Lt),Lt<t(this,v).length&&t(this,v).splice(Lt)),t(this,v).push(wt)}undo(){t(this,I)!==-1&&(ot(this,l,!0),t(this,v)[t(this,I)].undo(),ot(this,l,!1),ot(this,I,t(this,I)-1))}redo(){t(this,I)<t(this,v).length-1&&(ot(this,I,t(this,I)+1),ot(this,l,!0),t(this,v)[t(this,I)].cmd(),ot(this,l,!1))}hasSomethingToUndo(){return t(this,I)!==-1}hasSomethingToRedo(){return t(this,I)<t(this,v).length-1}destroy(){ot(this,v,null)}}v=new WeakMap,l=new WeakMap,h=new WeakMap,I=new WeakMap,o.CommandManager=F;class g{constructor(e){$(this,Q);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:p}=r.FeatureTest.platform;for(const[N,G,tt={}]of e)for(const ht of N){const wt=ht.startsWith("mac+");p&&wt?(this.callbacks.set(ht.slice(4),{callback:G,options:tt}),this.allKeys.add(ht.split("+").at(-1))):!p&&!wt&&(this.callbacks.set(ht,{callback:G,options:tt}),this.allKeys.add(ht.split("+").at(-1)))}}exec(e,p){if(!this.allKeys.has(p.key))return;const N=this.callbacks.get(Z(this,Q,un).call(this,p));if(!N)return;const{callback:G,options:{bubbles:tt=!1,args:ht=[],checker:wt=null}}=N;wt&&!wt(e,p)||(G.bind(e,...ht)(),tt||(p.stopPropagation(),p.preventDefault()))}}Q=new WeakSet,un=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const p=this.buffer.join("+");return this.buffer.length=0,p},o.KeyboardManager=g;const _t=class _t{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return(0,x.getColorValues)(e),(0,r.shadow)(this,"_colors",e)}convert(e){const p=(0,x.getRGB)(e);if(!window.matchMedia("(forced-colors: active)").matches)return p;for(const[N,G]of this._colors)if(G.every((tt,ht)=>tt===p[ht]))return _t._colorsMapping.get(N);return p}getHexCode(e){const p=this._colors.get(e);return p?r.Util.makeHexColor(...p):e}};oe(_t,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let H=_t;o.ColorManager=H;const Wt=class Wt{constructor(e,p,N,G,tt,ht){$(this,vt);$(this,Ot);$(this,Kt);$(this,Zt);$(this,O);$(this,_);$(this,C);$(this,dt);$(this,ie);$(this,Tt);$(this,Dt);$(this,Gt);$(this,Pt);$(this,at,null);$(this,xt,new Map);$(this,Ct,new Map);$(this,j,null);$(this,ut,null);$(this,Et,new F);$(this,yt,0);$(this,et,new Set);$(this,bt,null);$(this,Rt,null);$(this,Ut,new Set);$(this,$t,null);$(this,T,new gt);$(this,i,!1);$(this,a,!1);$(this,s,null);$(this,c,r.AnnotationEditorType.NONE);$(this,d,new Set);$(this,b,null);$(this,R,this.blur.bind(this));$(this,B,this.focus.bind(this));$(this,lt,this.copy.bind(this));$(this,nt,this.cut.bind(this));$(this,ft,this.paste.bind(this));$(this,mt,this.keydown.bind(this));$(this,Mt,this.onEditingAction.bind(this));$(this,At,this.onPageChanging.bind(this));$(this,Bt,this.onScaleChanging.bind(this));$(this,Vt,this.onRotationChanging.bind(this));$(this,kt,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});$(this,jt,[0,0]);$(this,St,null);$(this,it,null);$(this,st,null);ot(this,it,e),ot(this,st,p),ot(this,j,N),this._eventBus=G,this._eventBus._on("editingaction",t(this,Mt)),this._eventBus._on("pagechanging",t(this,At)),this._eventBus._on("scalechanging",t(this,Bt)),this._eventBus._on("rotationchanging",t(this,Vt)),ot(this,ut,tt.annotationStorage),ot(this,$t,tt.filterFactory),ot(this,b,ht),this.viewParameters={realScale:x.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const e=Wt.prototype,p=tt=>{const{activeElement:ht}=document;return ht&&t(tt,it).contains(ht)&&tt.hasSomethingToControl()},N=this.TRANSLATE_SMALL,G=this.TRANSLATE_BIG;return(0,r.shadow)(this,"_keyboardManager",new g([[["ctrl+a","mac+meta+a"],e.selectAll],[["ctrl+z","mac+meta+z"],e.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-N,0],checker:p}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-G,0],checker:p}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[N,0],checker:p}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[G,0],checker:p}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-N],checker:p}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-G],checker:p}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,N],checker:p}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,G],checker:p}]]))}destroy(){Z(this,Zt,mi).call(this),Z(this,Ot,Ji).call(this),this._eventBus._off("editingaction",t(this,Mt)),this._eventBus._off("pagechanging",t(this,At)),this._eventBus._off("scalechanging",t(this,Bt)),this._eventBus._off("rotationchanging",t(this,Vt));for(const e of t(this,Ct).values())e.destroy();t(this,Ct).clear(),t(this,xt).clear(),t(this,Ut).clear(),ot(this,at,null),t(this,d).clear(),t(this,Et).destroy(),t(this,j).destroy()}get hcmFilter(){return(0,r.shadow)(this,"hcmFilter",t(this,b)?t(this,$t).addHCMFilter(t(this,b).foreground,t(this,b).background):"none")}get direction(){return(0,r.shadow)(this,"direction",getComputedStyle(t(this,it)).direction)}editAltText(e){var p;(p=t(this,j))==null||p.editAltText(this,e)}onPageChanging({pageNumber:e}){ot(this,yt,e-1)}focusMainContainer(){t(this,it).focus()}findParent(e,p){for(const N of t(this,Ct).values()){const{x:G,y:tt,width:ht,height:wt}=N.div.getBoundingClientRect();if(e>=G&&e<=G+ht&&p>=tt&&p<=tt+wt)return N}return null}disableUserSelect(e=!1){t(this,st).classList.toggle("noUserSelect",e)}addShouldRescale(e){t(this,Ut).add(e)}removeShouldRescale(e){t(this,Ut).delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*x.PixelsPerInch.PDF_TO_CSS_UNITS;for(const p of t(this,Ut))p.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}addToAnnotationStorage(e){!e.isEmpty()&&t(this,ut)&&!t(this,ut).has(e.id)&&t(this,ut).setValue(e.id,e)}blur(){if(!this.hasSelection)return;const{activeElement:e}=document;for(const p of t(this,d))if(p.div.contains(e)){ot(this,s,[p,e]),p._focusEventsAllowed=!1;break}}focus(){if(!t(this,s))return;const[e,p]=t(this,s);ot(this,s,null),p.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0}),p.focus()}addEditListeners(){Z(this,Kt,Qi).call(this),Z(this,O,Zi).call(this)}removeEditListeners(){Z(this,Zt,mi).call(this),Z(this,_,ts).call(this)}copy(e){var N;if(e.preventDefault(),(N=t(this,at))==null||N.commitOrRemove(),!this.hasSelection)return;const p=[];for(const G of t(this,d)){const tt=G.serialize(!0);tt&&p.push(tt)}p.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(p))}cut(e){this.copy(e),this.delete()}paste(e){e.preventDefault();const{clipboardData:p}=e;for(const tt of p.items)for(const ht of t(this,Rt))if(ht.isHandlingMimeForPasting(tt.type)){ht.paste(tt,this.currentLayer);return}let N=p.getData("application/pdfjs");if(!N)return;try{N=JSON.parse(N)}catch(tt){(0,r.warn)(`paste: "${tt.message}".`);return}if(!Array.isArray(N))return;this.unselectAll();const G=this.currentLayer;try{const tt=[];for(const Lt of N){const It=G.deserialize(Lt);if(!It)return;tt.push(It)}const ht=()=>{for(const Lt of tt)Z(this,Dt,es).call(this,Lt);Z(this,Pt,is).call(this,tt)},wt=()=>{for(const Lt of tt)Lt.remove()};this.addCommands({cmd:ht,undo:wt,mustExec:!0})}catch(tt){(0,r.warn)(`paste: "${tt.message}".`)}}keydown(e){var p;(p=this.getActive())!=null&&p.shouldGetKeyboardEvents()||Wt._keyboardManager.exec(this,e)}onEditingAction(e){["undo","redo","delete","selectAll"].includes(e.name)&&this[e.name]()}setEditingState(e){e?(Z(this,vt,fn).call(this),Z(this,Kt,Qi).call(this),Z(this,O,Zi).call(this),Z(this,C,Ae).call(this,{isEditing:t(this,c)!==r.AnnotationEditorType.NONE,isEmpty:Z(this,Gt,Ve).call(this),hasSomethingToUndo:t(this,Et).hasSomethingToUndo(),hasSomethingToRedo:t(this,Et).hasSomethingToRedo(),hasSelectedEditor:!1})):(Z(this,Ot,Ji).call(this),Z(this,Zt,mi).call(this),Z(this,_,ts).call(this),Z(this,C,Ae).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!t(this,Rt)){ot(this,Rt,e);for(const p of t(this,Rt))Z(this,dt,Xe).call(this,p.defaultPropertiesToUpdate)}}getId(){return t(this,T).getId()}get currentLayer(){return t(this,Ct).get(t(this,yt))}getLayer(e){return t(this,Ct).get(e)}get currentPageIndex(){return t(this,yt)}addLayer(e){t(this,Ct).set(e.pageIndex,e),t(this,i)?e.enable():e.disable()}removeLayer(e){t(this,Ct).delete(e.pageIndex)}updateMode(e,p=null){if(t(this,c)!==e){if(ot(this,c,e),e===r.AnnotationEditorType.NONE){this.setEditingState(!1),Z(this,Tt,gn).call(this);return}this.setEditingState(!0),Z(this,ie,pn).call(this),this.unselectAll();for(const N of t(this,Ct).values())N.updateMode(e);if(p){for(const N of t(this,xt).values())if(N.annotationElementId===p){this.setSelected(N),N.enterInEditMode();break}}}}updateToolbar(e){e!==t(this,c)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,p){if(t(this,Rt)){if(e===r.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(e);return}for(const N of t(this,d))N.updateParams(e,p);for(const N of t(this,Rt))N.updateDefaultParams(e,p)}}enableWaiting(e=!1){if(t(this,a)!==e){ot(this,a,e);for(const p of t(this,Ct).values())e?p.disableClick():p.enableClick(),p.div.classList.toggle("waiting",e)}}getEditors(e){const p=[];for(const N of t(this,xt).values())N.pageIndex===e&&p.push(N);return p}getEditor(e){return t(this,xt).get(e)}addEditor(e){t(this,xt).set(e.id,e)}removeEditor(e){var p;t(this,xt).delete(e.id),this.unselect(e),(!e.annotationElementId||!t(this,et).has(e.annotationElementId))&&((p=t(this,ut))==null||p.remove(e.id))}addDeletedAnnotationElement(e){t(this,et).add(e.annotationElementId),e.deleted=!0}isDeletedAnnotationElement(e){return t(this,et).has(e)}removeDeletedAnnotationElement(e){t(this,et).delete(e.annotationElementId),e.deleted=!1}setActiveEditor(e){t(this,at)!==e&&(ot(this,at,e),e&&Z(this,dt,Xe).call(this,e.propertiesToUpdate))}toggleSelected(e){if(t(this,d).has(e)){t(this,d).delete(e),e.unselect(),Z(this,C,Ae).call(this,{hasSelectedEditor:this.hasSelection});return}t(this,d).add(e),e.select(),Z(this,dt,Xe).call(this,e.propertiesToUpdate),Z(this,C,Ae).call(this,{hasSelectedEditor:!0})}setSelected(e){for(const p of t(this,d))p!==e&&p.unselect();t(this,d).clear(),t(this,d).add(e),e.select(),Z(this,dt,Xe).call(this,e.propertiesToUpdate),Z(this,C,Ae).call(this,{hasSelectedEditor:!0})}isSelected(e){return t(this,d).has(e)}unselect(e){e.unselect(),t(this,d).delete(e),Z(this,C,Ae).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return t(this,d).size!==0}undo(){t(this,Et).undo(),Z(this,C,Ae).call(this,{hasSomethingToUndo:t(this,Et).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:Z(this,Gt,Ve).call(this)})}redo(){t(this,Et).redo(),Z(this,C,Ae).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:t(this,Et).hasSomethingToRedo(),isEmpty:Z(this,Gt,Ve).call(this)})}addCommands(e){t(this,Et).add(e),Z(this,C,Ae).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:Z(this,Gt,Ve).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const e=[...t(this,d)],p=()=>{for(const G of e)G.remove()},N=()=>{for(const G of e)Z(this,Dt,es).call(this,G)};this.addCommands({cmd:p,undo:N,mustExec:!0})}commitOrRemove(){var e;(e=t(this,at))==null||e.commitOrRemove()}hasSomethingToControl(){return t(this,at)||this.hasSelection}selectAll(){for(const e of t(this,d))e.commit();Z(this,Pt,is).call(this,t(this,xt).values())}unselectAll(){if(t(this,at)){t(this,at).commitOrRemove();return}if(this.hasSelection){for(const e of t(this,d))e.unselect();t(this,d).clear(),Z(this,C,Ae).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,p,N=!1){if(N||this.commitOrRemove(),!this.hasSelection)return;t(this,jt)[0]+=e,t(this,jt)[1]+=p;const[G,tt]=t(this,jt),ht=[...t(this,d)],wt=1e3;t(this,St)&&clearTimeout(t(this,St)),ot(this,St,setTimeout(()=>{ot(this,St,null),t(this,jt)[0]=t(this,jt)[1]=0,this.addCommands({cmd:()=>{for(const Lt of ht)t(this,xt).has(Lt.id)&&Lt.translateInPage(G,tt)},undo:()=>{for(const Lt of ht)t(this,xt).has(Lt.id)&&Lt.translateInPage(-G,-tt)},mustExec:!1})},wt));for(const Lt of ht)Lt.translateInPage(e,p)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),ot(this,bt,new Map);for(const e of t(this,d))t(this,bt).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!t(this,bt))return!1;this.disableUserSelect(!1);const e=t(this,bt);ot(this,bt,null);let p=!1;for(const[{x:G,y:tt,pageIndex:ht},wt]of e)wt.newX=G,wt.newY=tt,wt.newPageIndex=ht,p||(p=G!==wt.savedX||tt!==wt.savedY||ht!==wt.savedPageIndex);if(!p)return!1;const N=(G,tt,ht,wt)=>{if(t(this,xt).has(G.id)){const Lt=t(this,Ct).get(wt);Lt?G._setParentAndPosition(Lt,tt,ht):(G.pageIndex=wt,G.x=tt,G.y=ht)}};return this.addCommands({cmd:()=>{for(const[G,{newX:tt,newY:ht,newPageIndex:wt}]of e)N(G,tt,ht,wt)},undo:()=>{for(const[G,{savedX:tt,savedY:ht,savedPageIndex:wt}]of e)N(G,tt,ht,wt)},mustExec:!0}),!0}dragSelectedEditors(e,p){if(t(this,bt))for(const N of t(this,bt).keys())N.drag(e,p)}rebuild(e){if(e.parent===null){const p=this.getLayer(e.pageIndex);p?(p.changeParent(e),p.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}isActive(e){return t(this,at)===e}getActive(){return t(this,at)}getMode(){return t(this,c)}get imageManager(){return(0,r.shadow)(this,"imageManager",new z)}};at=new WeakMap,xt=new WeakMap,Ct=new WeakMap,j=new WeakMap,ut=new WeakMap,Et=new WeakMap,yt=new WeakMap,et=new WeakMap,bt=new WeakMap,Rt=new WeakMap,Ut=new WeakMap,$t=new WeakMap,T=new WeakMap,i=new WeakMap,a=new WeakMap,s=new WeakMap,c=new WeakMap,d=new WeakMap,b=new WeakMap,R=new WeakMap,B=new WeakMap,lt=new WeakMap,nt=new WeakMap,ft=new WeakMap,mt=new WeakMap,Mt=new WeakMap,At=new WeakMap,Bt=new WeakMap,Vt=new WeakMap,kt=new WeakMap,jt=new WeakMap,St=new WeakMap,it=new WeakMap,st=new WeakMap,vt=new WeakSet,fn=function(){window.addEventListener("focus",t(this,B)),window.addEventListener("blur",t(this,R))},Ot=new WeakSet,Ji=function(){window.removeEventListener("focus",t(this,B)),window.removeEventListener("blur",t(this,R))},Kt=new WeakSet,Qi=function(){window.addEventListener("keydown",t(this,mt),{capture:!0})},Zt=new WeakSet,mi=function(){window.removeEventListener("keydown",t(this,mt),{capture:!0})},O=new WeakSet,Zi=function(){document.addEventListener("copy",t(this,lt)),document.addEventListener("cut",t(this,nt)),document.addEventListener("paste",t(this,ft))},_=new WeakSet,ts=function(){document.removeEventListener("copy",t(this,lt)),document.removeEventListener("cut",t(this,nt)),document.removeEventListener("paste",t(this,ft))},C=new WeakSet,Ae=function(e){Object.entries(e).some(([N,G])=>t(this,kt)[N]!==G)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(t(this,kt),e)})},dt=new WeakSet,Xe=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},ie=new WeakSet,pn=function(){if(!t(this,i)){ot(this,i,!0);for(const e of t(this,Ct).values())e.enable()}},Tt=new WeakSet,gn=function(){if(this.unselectAll(),t(this,i)){ot(this,i,!1);for(const e of t(this,Ct).values())e.disable()}},Dt=new WeakSet,es=function(e){const p=t(this,Ct).get(e.pageIndex);p?p.addOrRebuild(e):this.addEditor(e)},Gt=new WeakSet,Ve=function(){if(t(this,xt).size===0)return!0;if(t(this,xt).size===1)for(const e of t(this,xt).values())return e.isEmpty();return!1},Pt=new WeakSet,is=function(e){t(this,d).clear();for(const p of e)p.isEmpty()||(t(this,d).add(p),p.select());Z(this,C,Ae).call(this,{hasSelectedEditor:!0})},oe(Wt,"TRANSLATE_SMALL",1),oe(Wt,"TRANSLATE_BIG",10);let W=Wt;o.AnnotationEditorUIManager=W},(U,o,V)=>{var yt,et,bt,Rt,Ut,$t,T,i,a,s,c,d,Ne,R,$e,lt,ss,ft,bi,Mt,Ai,Bt,qe,kt,Ye;Object.defineProperty(o,"__esModule",{value:!0}),o.StatTimer=o.RenderingCancelledException=o.PixelsPerInch=o.PageViewport=o.PDFDateString=o.DOMStandardFontDataFactory=o.DOMSVGFactory=o.DOMFilterFactory=o.DOMCanvasFactory=o.DOMCMapReaderFactory=void 0,o.deprecated=I,o.getColorValues=xt,o.getCurrentTransform=Ct,o.getCurrentTransformInverse=j,o.getFilenameFromUrl=A,o.getPdfFilenameFromUrl=M,o.getRGB=at,o.getXfaPageViewport=_t,o.isDataScheme=w,o.isPdfFile=f,o.isValidFetchUrl=v,o.loadScript=h,o.noContextMenu=l,o.setLayerDimensions=ut;var r=V(7),x=V(1);const q="http://www.w3.org/2000/svg",Et=class Et{};oe(Et,"CSS",96),oe(Et,"PDF",72),oe(Et,"PDF_TO_CSS_UNITS",Et.CSS/Et.PDF);let Y=Et;o.PixelsPerInch=Y;class gt extends r.BaseFilterFactory{constructor({docId:st,ownerDocument:vt=globalThis.document}={}){super();$(this,d);$(this,R);$(this,lt);$(this,ft);$(this,Mt);$(this,Bt);$(this,kt);$(this,yt,void 0);$(this,et,void 0);$(this,bt,void 0);$(this,Rt,void 0);$(this,Ut,void 0);$(this,$t,void 0);$(this,T,void 0);$(this,i,void 0);$(this,a,void 0);$(this,s,void 0);$(this,c,0);ot(this,bt,st),ot(this,Rt,vt)}addFilter(st){if(!st)return"none";let vt=t(this,d,Ne).get(st);if(vt)return vt;let Ft,Ot,te,Kt;if(st.length===1){const O=st[0],X=new Array(256);for(let _=0;_<256;_++)X[_]=O[_]/255;Kt=Ft=Ot=te=X.join(",")}else{const[O,X,_]=st,S=new Array(256),C=new Array(256),rt=new Array(256);for(let dt=0;dt<256;dt++)S[dt]=O[dt]/255,C[dt]=X[dt]/255,rt[dt]=_[dt]/255;Ft=S.join(","),Ot=C.join(","),te=rt.join(","),Kt=`${Ft}${Ot}${te}`}if(vt=t(this,d,Ne).get(Kt),vt)return t(this,d,Ne).set(st,vt),vt;const Jt=`g_${t(this,bt)}_transfer_map_${ze(this,c)._++}`,Zt=`url(#${Jt})`;t(this,d,Ne).set(st,Zt),t(this,d,Ne).set(Kt,Zt);const pt=Z(this,ft,bi).call(this,Jt);return Z(this,Bt,qe).call(this,Ft,Ot,te,pt),Zt}addHCMFilter(st,vt){var X;const Ft=`${st}-${vt}`;if(t(this,$t)===Ft)return t(this,T);if(ot(this,$t,Ft),ot(this,T,"none"),(X=t(this,Ut))==null||X.remove(),!st||!vt)return t(this,T);const Ot=Z(this,kt,Ye).call(this,st);st=x.Util.makeHexColor(...Ot);const te=Z(this,kt,Ye).call(this,vt);if(vt=x.Util.makeHexColor(...te),t(this,R,$e).style.color="",st==="#000000"&&vt==="#ffffff"||st===vt)return t(this,T);const Kt=new Array(256);for(let _=0;_<=255;_++){const S=_/255;Kt[_]=S<=.03928?S/12.92:((S+.055)/1.055)**2.4}const Jt=Kt.join(","),Zt=`g_${t(this,bt)}_hcm_filter`,pt=ot(this,i,Z(this,ft,bi).call(this,Zt));Z(this,Bt,qe).call(this,Jt,Jt,Jt,pt),Z(this,lt,ss).call(this,pt);const O=(_,S)=>{const C=Ot[_]/255,rt=te[_]/255,dt=new Array(S+1);for(let qt=0;qt<=S;qt++)dt[qt]=C+qt/S*(rt-C);return dt.join(",")};return Z(this,Bt,qe).call(this,O(0,5),O(1,5),O(2,5),pt),ot(this,T,`url(#${Zt})`),t(this,T)}addHighlightHCMFilter(st,vt,Ft,Ot){var rt;const te=`${st}-${vt}-${Ft}-${Ot}`;if(t(this,a)===te)return t(this,s);if(ot(this,a,te),ot(this,s,"none"),(rt=t(this,i))==null||rt.remove(),!st||!vt)return t(this,s);const[Kt,Jt]=[st,vt].map(Z(this,kt,Ye).bind(this));let Zt=Math.round(.2126*Kt[0]+.7152*Kt[1]+.0722*Kt[2]),pt=Math.round(.2126*Jt[0]+.7152*Jt[1]+.0722*Jt[2]),[O,X]=[Ft,Ot].map(Z(this,kt,Ye).bind(this));pt<Zt&&([Zt,pt,O,X]=[pt,Zt,X,O]),t(this,R,$e).style.color="";const _=(dt,qt,ie)=>{const K=new Array(256),Tt=(pt-Zt)/ie,Nt=dt/255,Dt=(qt-dt)/(255*ie);let Xt=0;for(let Gt=0;Gt<=ie;Gt++){const ne=Math.round(Zt+Gt*Tt),Pt=Nt+Gt*Dt;for(let se=Xt;se<=ne;se++)K[se]=Pt;Xt=ne+1}for(let Gt=Xt;Gt<256;Gt++)K[Gt]=K[Xt-1];return K.join(",")},S=`g_${t(this,bt)}_hcm_highlight_filter`,C=ot(this,i,Z(this,ft,bi).call(this,S));return Z(this,lt,ss).call(this,C),Z(this,Bt,qe).call(this,_(O[0],X[0],5),_(O[1],X[1],5),_(O[2],X[2],5),C),ot(this,s,`url(#${S})`),t(this,s)}destroy(st=!1){st&&(t(this,T)||t(this,s))||(t(this,et)&&(t(this,et).parentNode.parentNode.remove(),ot(this,et,null)),t(this,yt)&&(t(this,yt).clear(),ot(this,yt,null)),ot(this,c,0))}}yt=new WeakMap,et=new WeakMap,bt=new WeakMap,Rt=new WeakMap,Ut=new WeakMap,$t=new WeakMap,T=new WeakMap,i=new WeakMap,a=new WeakMap,s=new WeakMap,c=new WeakMap,d=new WeakSet,Ne=function(){return t(this,yt)||ot(this,yt,new Map)},R=new WeakSet,$e=function(){if(!t(this,et)){const st=t(this,Rt).createElement("div"),{style:vt}=st;vt.visibility="hidden",vt.contain="strict",vt.width=vt.height=0,vt.position="absolute",vt.top=vt.left=0,vt.zIndex=-1;const Ft=t(this,Rt).createElementNS(q,"svg");Ft.setAttribute("width",0),Ft.setAttribute("height",0),ot(this,et,t(this,Rt).createElementNS(q,"defs")),st.append(Ft),Ft.append(t(this,et)),t(this,Rt).body.append(st)}return t(this,et)},lt=new WeakSet,ss=function(st){const vt=t(this,Rt).createElementNS(q,"feColorMatrix");vt.setAttribute("type","matrix"),vt.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),st.append(vt)},ft=new WeakSet,bi=function(st){const vt=t(this,Rt).createElementNS(q,"filter");return vt.setAttribute("color-interpolation-filters","sRGB"),vt.setAttribute("id",st),t(this,R,$e).append(vt),vt},Mt=new WeakSet,Ai=function(st,vt,Ft){const Ot=t(this,Rt).createElementNS(q,vt);Ot.setAttribute("type","discrete"),Ot.setAttribute("tableValues",Ft),st.append(Ot)},Bt=new WeakSet,qe=function(st,vt,Ft,Ot){const te=t(this,Rt).createElementNS(q,"feComponentTransfer");Ot.append(te),Z(this,Mt,Ai).call(this,te,"feFuncR",st),Z(this,Mt,Ai).call(this,te,"feFuncG",vt),Z(this,Mt,Ai).call(this,te,"feFuncB",Ft)},kt=new WeakSet,Ye=function(st){return t(this,R,$e).style.color=st,at(getComputedStyle(t(this,R,$e)).getPropertyValue("color"))},o.DOMFilterFactory=gt;class z extends r.BaseCanvasFactory{constructor({ownerDocument:it=globalThis.document}={}){super(),this._document=it}_createCanvas(it,st){const vt=this._document.createElement("canvas");return vt.width=it,vt.height=st,vt}}o.DOMCanvasFactory=z;async function F(St,it=!1){if(v(St,document.baseURI)){const st=await fetch(St);if(!st.ok)throw new Error(st.statusText);return it?new Uint8Array(await st.arrayBuffer()):(0,x.stringToBytes)(await st.text())}return new Promise((st,vt)=>{const Ft=new XMLHttpRequest;Ft.open("GET",St,!0),it&&(Ft.responseType="arraybuffer"),Ft.onreadystatechange=()=>{if(Ft.readyState===XMLHttpRequest.DONE){if(Ft.status===200||Ft.status===0){let Ot;if(it&&Ft.response?Ot=new Uint8Array(Ft.response):!it&&Ft.responseText&&(Ot=(0,x.stringToBytes)(Ft.responseText)),Ot){st(Ot);return}}vt(new Error(Ft.statusText))}},Ft.send(null)})}class g extends r.BaseCMapReaderFactory{_fetchData(it,st){return F(it,this.isCompressed).then(vt=>({cMapData:vt,compressionType:st}))}}o.DOMCMapReaderFactory=g;class H extends r.BaseStandardFontDataFactory{_fetchData(it){return F(it,!0)}}o.DOMStandardFontDataFactory=H;class W extends r.BaseSVGFactory{_createSVG(it){return document.createElementNS(q,it)}}o.DOMSVGFactory=W;class L{constructor({viewBox:it,scale:st,rotation:vt,offsetX:Ft=0,offsetY:Ot=0,dontFlip:te=!1}){this.viewBox=it,this.scale=st,this.rotation=vt,this.offsetX=Ft,this.offsetY=Ot;const Kt=(it[2]+it[0])/2,Jt=(it[3]+it[1])/2;let Zt,pt,O,X;switch(vt%=360,vt<0&&(vt+=360),vt){case 180:Zt=-1,pt=0,O=0,X=1;break;case 90:Zt=0,pt=1,O=1,X=0;break;case 270:Zt=0,pt=-1,O=-1,X=0;break;case 0:Zt=1,pt=0,O=0,X=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}te&&(O=-O,X=-X);let _,S,C,rt;Zt===0?(_=Math.abs(Jt-it[1])*st+Ft,S=Math.abs(Kt-it[0])*st+Ot,C=(it[3]-it[1])*st,rt=(it[2]-it[0])*st):(_=Math.abs(Kt-it[0])*st+Ft,S=Math.abs(Jt-it[1])*st+Ot,C=(it[2]-it[0])*st,rt=(it[3]-it[1])*st),this.transform=[Zt*st,pt*st,O*st,X*st,_-Zt*st*Kt-O*st*Jt,S-pt*st*Kt-X*st*Jt],this.width=C,this.height=rt}get rawDims(){const{viewBox:it}=this;return(0,x.shadow)(this,"rawDims",{pageWidth:it[2]-it[0],pageHeight:it[3]-it[1],pageX:it[0],pageY:it[1]})}clone({scale:it=this.scale,rotation:st=this.rotation,offsetX:vt=this.offsetX,offsetY:Ft=this.offsetY,dontFlip:Ot=!1}={}){return new L({viewBox:this.viewBox.slice(),scale:it,rotation:st,offsetX:vt,offsetY:Ft,dontFlip:Ot})}convertToViewportPoint(it,st){return x.Util.applyTransform([it,st],this.transform)}convertToViewportRectangle(it){const st=x.Util.applyTransform([it[0],it[1]],this.transform),vt=x.Util.applyTransform([it[2],it[3]],this.transform);return[st[0],st[1],vt[0],vt[1]]}convertToPdfPoint(it,st){return x.Util.applyInverseTransform([it,st],this.transform)}}o.PageViewport=L;class E extends x.BaseException{constructor(it,st=0){super(it,"RenderingCancelledException"),this.extraDelay=st}}o.RenderingCancelledException=E;function w(St){const it=St.length;let st=0;for(;st<it&&St[st].trim()==="";)st++;return St.substring(st,st+5).toLowerCase()==="data:"}function f(St){return typeof St=="string"&&/\.pdf$/i.test(St)}function A(St,it=!1){return it||([St]=St.split(/[#?]/,1)),St.substring(St.lastIndexOf("/")+1)}function M(St,it="document.pdf"){if(typeof St!="string")return it;if(w(St))return(0,x.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),it;const st=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,vt=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,Ft=st.exec(St);let Ot=vt.exec(Ft[1])||vt.exec(Ft[2])||vt.exec(Ft[3]);if(Ot&&(Ot=Ot[0],Ot.includes("%")))try{Ot=vt.exec(decodeURIComponent(Ot))[0]}catch{}return Ot||it}class k{constructor(){oe(this,"started",Object.create(null));oe(this,"times",[])}time(it){it in this.started&&(0,x.warn)(`Timer is already running for ${it}`),this.started[it]=Date.now()}timeEnd(it){it in this.started||(0,x.warn)(`Timer has not been started for ${it}`),this.times.push({name:it,start:this.started[it],end:Date.now()}),delete this.started[it]}toString(){const it=[];let st=0;for(const{name:vt}of this.times)st=Math.max(vt.length,st);for(const{name:vt,start:Ft,end:Ot}of this.times)it.push(`${vt.padEnd(st)} ${Ot-Ft}ms
`);return it.join("")}}o.StatTimer=k;function v(St,it){try{const{protocol:st}=it?new URL(St,it):new URL(St);return st==="http:"||st==="https:"}catch{return!1}}function l(St){St.preventDefault()}function h(St,it=!1){return new Promise((st,vt)=>{const Ft=document.createElement("script");Ft.src=St,Ft.onload=function(Ot){it&&Ft.remove(),st(Ot)},Ft.onerror=function(){vt(new Error(`Cannot load script at: ${Ft.src}`))},(document.head||document.documentElement).append(Ft)})}function I(St){console.log("Deprecated API usage: "+St)}let Q;class J{static toDateObject(it){if(!it||typeof it!="string")return null;Q||(Q=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const st=Q.exec(it);if(!st)return null;const vt=parseInt(st[1],10);let Ft=parseInt(st[2],10);Ft=Ft>=1&&Ft<=12?Ft-1:0;let Ot=parseInt(st[3],10);Ot=Ot>=1&&Ot<=31?Ot:1;let te=parseInt(st[4],10);te=te>=0&&te<=23?te:0;let Kt=parseInt(st[5],10);Kt=Kt>=0&&Kt<=59?Kt:0;let Jt=parseInt(st[6],10);Jt=Jt>=0&&Jt<=59?Jt:0;const Zt=st[7]||"Z";let pt=parseInt(st[8],10);pt=pt>=0&&pt<=23?pt:0;let O=parseInt(st[9],10)||0;return O=O>=0&&O<=59?O:0,Zt==="-"?(te+=pt,Kt+=O):Zt==="+"&&(te-=pt,Kt-=O),new Date(Date.UTC(vt,Ft,Ot,te,Kt,Jt))}}o.PDFDateString=J;function _t(St,{scale:it=1,rotation:st=0}){const{width:vt,height:Ft}=St.attributes.style,Ot=[0,0,parseInt(vt),parseInt(Ft)];return new L({viewBox:Ot,scale:it,rotation:st})}function at(St){if(St.startsWith("#")){const it=parseInt(St.slice(1),16);return[(it&16711680)>>16,(it&65280)>>8,it&255]}return St.startsWith("rgb(")?St.slice(4,-1).split(",").map(it=>parseInt(it)):St.startsWith("rgba(")?St.slice(5,-1).split(",").map(it=>parseInt(it)).slice(0,3):((0,x.warn)(`Not a valid color format: "${St}"`),[0,0,0])}function xt(St){const it=document.createElement("span");it.style.visibility="hidden",document.body.append(it);for(const st of St.keys()){it.style.color=st;const vt=window.getComputedStyle(it).color;St.set(st,at(vt))}it.remove()}function Ct(St){const{a:it,b:st,c:vt,d:Ft,e:Ot,f:te}=St.getTransform();return[it,st,vt,Ft,Ot,te]}function j(St){const{a:it,b:st,c:vt,d:Ft,e:Ot,f:te}=St.getTransform().invertSelf();return[it,st,vt,Ft,Ot,te]}function ut(St,it,st=!1,vt=!0){if(it instanceof L){const{pageWidth:Ft,pageHeight:Ot}=it.rawDims,{style:te}=St,Kt=x.FeatureTest.isCSSRoundSupported,Jt=`var(--scale-factor) * ${Ft}px`,Zt=`var(--scale-factor) * ${Ot}px`,pt=Kt?`round(${Jt}, 1px)`:`calc(${Jt})`,O=Kt?`round(${Zt}, 1px)`:`calc(${Zt})`;!st||it.rotation%180===0?(te.width=pt,te.height=O):(te.width=O,te.height=pt)}vt&&St.setAttribute("data-main-rotation",it.rotation)}},(U,o,V)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BaseStandardFontDataFactory=o.BaseSVGFactory=o.BaseFilterFactory=o.BaseCanvasFactory=o.BaseCMapReaderFactory=void 0;var r=V(1);class x{constructor(){this.constructor===x&&(0,r.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(g){return"none"}addHCMFilter(g,H){return"none"}addHighlightHCMFilter(g,H,W,L){return"none"}destroy(g=!1){}}o.BaseFilterFactory=x;class q{constructor(){this.constructor===q&&(0,r.unreachable)("Cannot initialize BaseCanvasFactory.")}create(g,H){if(g<=0||H<=0)throw new Error("Invalid canvas size");const W=this._createCanvas(g,H);return{canvas:W,context:W.getContext("2d")}}reset(g,H,W){if(!g.canvas)throw new Error("Canvas is not specified");if(H<=0||W<=0)throw new Error("Invalid canvas size");g.canvas.width=H,g.canvas.height=W}destroy(g){if(!g.canvas)throw new Error("Canvas is not specified");g.canvas.width=0,g.canvas.height=0,g.canvas=null,g.context=null}_createCanvas(g,H){(0,r.unreachable)("Abstract method `_createCanvas` called.")}}o.BaseCanvasFactory=q;class Y{constructor({baseUrl:g=null,isCompressed:H=!0}){this.constructor===Y&&(0,r.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=g,this.isCompressed=H}async fetch({name:g}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!g)throw new Error("CMap name must be specified.");const H=this.baseUrl+g+(this.isCompressed?".bcmap":""),W=this.isCompressed?r.CMapCompressionType.BINARY:r.CMapCompressionType.NONE;return this._fetchData(H,W).catch(L=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${H}`)})}_fetchData(g,H){(0,r.unreachable)("Abstract method `_fetchData` called.")}}o.BaseCMapReaderFactory=Y;class gt{constructor({baseUrl:g=null}){this.constructor===gt&&(0,r.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=g}async fetch({filename:g}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!g)throw new Error("Font filename must be specified.");const H=`${this.baseUrl}${g}`;return this._fetchData(H).catch(W=>{throw new Error(`Unable to load font data at: ${H}`)})}_fetchData(g){(0,r.unreachable)("Abstract method `_fetchData` called.")}}o.BaseStandardFontDataFactory=gt;class z{constructor(){this.constructor===z&&(0,r.unreachable)("Cannot initialize BaseSVGFactory.")}create(g,H,W=!1){if(g<=0||H<=0)throw new Error("Invalid SVG dimensions");const L=this._createSVG("svg:svg");return L.setAttribute("version","1.1"),W||(L.setAttribute("width",`${g}px`),L.setAttribute("height",`${H}px`)),L.setAttribute("preserveAspectRatio","none"),L.setAttribute("viewBox",`0 0 ${g} ${H}`),L}createElement(g){if(typeof g!="string")throw new Error("Invalid SVG element type");return this._createSVG(g)}_createSVG(g){(0,r.unreachable)("Abstract method `_createSVG` called.")}}o.BaseSVGFactory=z},(U,o,V)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.MurmurHash3_64=void 0;var r=V(1);const x=3285377520,q=4294901760,Y=65535;class gt{constructor(F){this.h1=F?F&4294967295:x,this.h2=F?F&4294967295:x}update(F){let g,H;if(typeof F=="string"){g=new Uint8Array(F.length*2),H=0;for(let I=0,Q=F.length;I<Q;I++){const J=F.charCodeAt(I);J<=255?g[H++]=J:(g[H++]=J>>>8,g[H++]=J&255)}}else if((0,r.isArrayBuffer)(F))g=F.slice(),H=g.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const W=H>>2,L=H-W*4,E=new Uint32Array(g.buffer,0,W);let w=0,f=0,A=this.h1,M=this.h2;const k=3432918353,v=461845907,l=k&Y,h=v&Y;for(let I=0;I<W;I++)I&1?(w=E[I],w=w*k&q|w*l&Y,w=w<<15|w>>>17,w=w*v&q|w*h&Y,A^=w,A=A<<13|A>>>19,A=A*5+3864292196):(f=E[I],f=f*k&q|f*l&Y,f=f<<15|f>>>17,f=f*v&q|f*h&Y,M^=f,M=M<<13|M>>>19,M=M*5+3864292196);switch(w=0,L){case 3:w^=g[W*4+2]<<16;case 2:w^=g[W*4+1]<<8;case 1:w^=g[W*4],w=w*k&q|w*l&Y,w=w<<15|w>>>17,w=w*v&q|w*h&Y,W&1?A^=w:M^=w}this.h1=A,this.h2=M}hexdigest(){let F=this.h1,g=this.h2;return F^=g>>>1,F=F*3981806797&q|F*36045&Y,g=g*4283543511&q|((g<<16|F>>>16)*2950163797&q)>>>16,F^=g>>>1,F=F*444984403&q|F*60499&Y,g=g*3301882366&q|((g<<16|F>>>16)*3120437893&q)>>>16,F^=g>>>1,(F>>>0).toString(16).padStart(8,"0")+(g>>>0).toString(16).padStart(8,"0")}}o.MurmurHash3_64=gt},(U,o,V)=>{var Y;Object.defineProperty(o,"__esModule",{value:!0}),o.FontLoader=o.FontFaceObject=void 0;var r=V(1);class x{constructor({ownerDocument:z=globalThis.document,styleElement:F=null}){$(this,Y,new Set);this._document=z,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(z){this.nativeFontFaces.add(z),this._document.fonts.add(z)}removeNativeFontFace(z){this.nativeFontFaces.delete(z),this._document.fonts.delete(z)}insertRule(z){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const F=this.styleElement.sheet;F.insertRule(z,F.cssRules.length)}clear(){for(const z of this.nativeFontFaces)this._document.fonts.delete(z);this.nativeFontFaces.clear(),t(this,Y).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(z){if(!(!z||t(this,Y).has(z.loadedName))){if((0,r.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:F,src:g,style:H}=z,W=new FontFace(F,g,H);this.addNativeFontFace(W);try{await W.load(),t(this,Y).add(F)}catch{(0,r.warn)(`Cannot load system font: ${z.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(W)}return}(0,r.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(z){if(z.attached||z.missingFile&&!z.systemFontInfo)return;if(z.attached=!0,z.systemFontInfo){await this.loadSystemFont(z.systemFontInfo);return}if(this.isFontLoadingAPISupported){const g=z.createNativeFontFace();if(g){this.addNativeFontFace(g);try{await g.loaded}catch(H){throw(0,r.warn)(`Failed to load font '${g.family}': '${H}'.`),z.disableFontFace=!0,H}}return}const F=z.createFontFaceRule();if(F){if(this.insertRule(F),this.isSyncFontLoadingSupported)return;await new Promise(g=>{const H=this._queueLoadingCallback(g);this._prepareFontLoadEvent(z,H)})}}get isFontLoadingAPISupported(){var F;const z=!!((F=this._document)!=null&&F.fonts);return(0,r.shadow)(this,"isFontLoadingAPISupported",z)}get isSyncFontLoadingSupported(){let z=!1;return(r.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(z=!0),(0,r.shadow)(this,"isSyncFontLoadingSupported",z)}_queueLoadingCallback(z){function F(){for((0,r.assert)(!H.done,"completeRequest() cannot be called twice."),H.done=!0;g.length>0&&g[0].done;){const W=g.shift();setTimeout(W.callback,0)}}const{loadingRequests:g}=this,H={done:!1,complete:F,callback:z};return g.push(H),H}get _loadTestFont(){const z=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,r.shadow)(this,"_loadTestFont",z)}_prepareFontLoadEvent(z,F){function g(at,xt){return at.charCodeAt(xt)<<24|at.charCodeAt(xt+1)<<16|at.charCodeAt(xt+2)<<8|at.charCodeAt(xt+3)&255}function H(at,xt,Ct,j){const ut=at.substring(0,xt),Et=at.substring(xt+Ct);return ut+j+Et}let W,L;const E=this._document.createElement("canvas");E.width=1,E.height=1;const w=E.getContext("2d");let f=0;function A(at,xt){if(++f>30){(0,r.warn)("Load test font never loaded."),xt();return}if(w.font="30px "+at,w.fillText(".",0,20),w.getImageData(0,0,1,1).data[3]>0){xt();return}setTimeout(A.bind(null,at,xt))}const M=`lt${Date.now()}${this.loadTestFontId++}`;let k=this._loadTestFont;k=H(k,976,M.length,M);const l=16,h=1482184792;let I=g(k,l);for(W=0,L=M.length-3;W<L;W+=4)I=I-h+g(M,W)|0;W<M.length&&(I=I-h+g(M+"XXX",W)|0),k=H(k,l,4,(0,r.string32)(I));const Q=`url(data:font/opentype;base64,${btoa(k)});`,J=`@font-face {font-family:"${M}";src:${Q}}`;this.insertRule(J);const _t=this._document.createElement("div");_t.style.visibility="hidden",_t.style.width=_t.style.height="10px",_t.style.position="absolute",_t.style.top=_t.style.left="0px";for(const at of[z.loadedName,M]){const xt=this._document.createElement("span");xt.textContent="Hi",xt.style.fontFamily=at,_t.append(xt)}this._document.body.append(_t),A(M,()=>{_t.remove(),F.complete()})}}Y=new WeakMap,o.FontLoader=x;class q{constructor(z,{isEvalSupported:F=!0,disableFontFace:g=!1,ignoreErrors:H=!1,inspectFont:W=null}){this.compiledGlyphs=Object.create(null);for(const L in z)this[L]=z[L];this.isEvalSupported=F!==!1,this.disableFontFace=g===!0,this.ignoreErrors=H===!0,this._inspectFont=W}createNativeFontFace(){var F;if(!this.data||this.disableFontFace)return null;let z;if(!this.cssFontInfo)z=new FontFace(this.loadedName,this.data,{});else{const g={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(g.style=`oblique ${this.cssFontInfo.italicAngle}deg`),z=new FontFace(this.cssFontInfo.fontFamily,this.data,g)}return(F=this._inspectFont)==null||F.call(this,this),z}createFontFaceRule(){var H;if(!this.data||this.disableFontFace)return null;const z=(0,r.bytesToString)(this.data),F=`url(data:${this.mimetype};base64,${btoa(z)});`;let g;if(!this.cssFontInfo)g=`@font-face {font-family:"${this.loadedName}";src:${F}}`;else{let W=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(W+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),g=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${W}src:${F}}`}return(H=this._inspectFont)==null||H.call(this,this,F),g}getPathGenerator(z,F){if(this.compiledGlyphs[F]!==void 0)return this.compiledGlyphs[F];let g;try{g=z.get(this.loadedName+"_path_"+F)}catch(H){if(!this.ignoreErrors)throw H;return(0,r.warn)(`getPathGenerator - ignoring character: "${H}".`),this.compiledGlyphs[F]=function(W,L){}}if(this.isEvalSupported&&r.FeatureTest.isEvalSupported){const H=[];for(const W of g){const L=W.args!==void 0?W.args.join(","):"";H.push("c.",W.cmd,"(",L,`);
`)}return this.compiledGlyphs[F]=new Function("c","size",H.join(""))}return this.compiledGlyphs[F]=function(H,W){for(const L of g)L.cmd==="scale"&&(L.args=[W,-W]),H[L.cmd].apply(H,L.args)}}}o.FontFaceObject=q},(U,o,V)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.NodeStandardFontDataFactory=o.NodeFilterFactory=o.NodeCanvasFactory=o.NodeCMapReaderFactory=void 0;var r=V(7);V(1);const x=function(F){return new Promise((g,H)=>{Se.readFile(F,(L,E)=>{if(L||!E){H(new Error(L));return}g(new Uint8Array(E))})})};class q extends r.BaseFilterFactory{}o.NodeFilterFactory=q;class Y extends r.BaseCanvasFactory{_createCanvas(g,H){return Se.createCanvas(g,H)}}o.NodeCanvasFactory=Y;class gt extends r.BaseCMapReaderFactory{_fetchData(g,H){return x(g).then(W=>({cMapData:W,compressionType:H}))}}o.NodeCMapReaderFactory=gt;class z extends r.BaseStandardFontDataFactory{_fetchData(g){return x(g)}}o.NodeStandardFontDataFactory=z},(U,o,V)=>{var et,ns,Rt,rs;Object.defineProperty(o,"__esModule",{value:!0}),o.CanvasGraphics=void 0;var r=V(1),x=V(6),q=V(12),Y=V(13);const gt=16,z=100,F=4096,g=15,H=10,W=1e3,L=16;function E(T,i){if(T._removeMirroring)throw new Error("Context is already forwarding operations.");T.__originalSave=T.save,T.__originalRestore=T.restore,T.__originalRotate=T.rotate,T.__originalScale=T.scale,T.__originalTranslate=T.translate,T.__originalTransform=T.transform,T.__originalSetTransform=T.setTransform,T.__originalResetTransform=T.resetTransform,T.__originalClip=T.clip,T.__originalMoveTo=T.moveTo,T.__originalLineTo=T.lineTo,T.__originalBezierCurveTo=T.bezierCurveTo,T.__originalRect=T.rect,T.__originalClosePath=T.closePath,T.__originalBeginPath=T.beginPath,T._removeMirroring=()=>{T.save=T.__originalSave,T.restore=T.__originalRestore,T.rotate=T.__originalRotate,T.scale=T.__originalScale,T.translate=T.__originalTranslate,T.transform=T.__originalTransform,T.setTransform=T.__originalSetTransform,T.resetTransform=T.__originalResetTransform,T.clip=T.__originalClip,T.moveTo=T.__originalMoveTo,T.lineTo=T.__originalLineTo,T.bezierCurveTo=T.__originalBezierCurveTo,T.rect=T.__originalRect,T.closePath=T.__originalClosePath,T.beginPath=T.__originalBeginPath,delete T._removeMirroring},T.save=function(){i.save(),this.__originalSave()},T.restore=function(){i.restore(),this.__originalRestore()},T.translate=function(s,c){i.translate(s,c),this.__originalTranslate(s,c)},T.scale=function(s,c){i.scale(s,c),this.__originalScale(s,c)},T.transform=function(s,c,d,b,R,B){i.transform(s,c,d,b,R,B),this.__originalTransform(s,c,d,b,R,B)},T.setTransform=function(s,c,d,b,R,B){i.setTransform(s,c,d,b,R,B),this.__originalSetTransform(s,c,d,b,R,B)},T.resetTransform=function(){i.resetTransform(),this.__originalResetTransform()},T.rotate=function(s){i.rotate(s),this.__originalRotate(s)},T.clip=function(s){i.clip(s),this.__originalClip(s)},T.moveTo=function(a,s){i.moveTo(a,s),this.__originalMoveTo(a,s)},T.lineTo=function(a,s){i.lineTo(a,s),this.__originalLineTo(a,s)},T.bezierCurveTo=function(a,s,c,d,b,R){i.bezierCurveTo(a,s,c,d,b,R),this.__originalBezierCurveTo(a,s,c,d,b,R)},T.rect=function(a,s,c,d){i.rect(a,s,c,d),this.__originalRect(a,s,c,d)},T.closePath=function(){i.closePath(),this.__originalClosePath()},T.beginPath=function(){i.beginPath(),this.__originalBeginPath()}}class w{constructor(i){this.canvasFactory=i,this.cache=Object.create(null)}getCanvas(i,a,s){let c;return this.cache[i]!==void 0?(c=this.cache[i],this.canvasFactory.reset(c,a,s)):(c=this.canvasFactory.create(a,s),this.cache[i]=c),c}delete(i){delete this.cache[i]}clear(){for(const i in this.cache){const a=this.cache[i];this.canvasFactory.destroy(a),delete this.cache[i]}}}function f(T,i,a,s,c,d,b,R,B,lt){const[nt,ft,mt,Mt,At,Bt]=(0,x.getCurrentTransform)(T);if(ft===0&&mt===0){const jt=b*nt+At,St=Math.round(jt),it=R*Mt+Bt,st=Math.round(it),vt=(b+B)*nt+At,Ft=Math.abs(Math.round(vt)-St)||1,Ot=(R+lt)*Mt+Bt,te=Math.abs(Math.round(Ot)-st)||1;return T.setTransform(Math.sign(nt),0,0,Math.sign(Mt),St,st),T.drawImage(i,a,s,c,d,0,0,Ft,te),T.setTransform(nt,ft,mt,Mt,At,Bt),[Ft,te]}if(nt===0&&Mt===0){const jt=R*mt+At,St=Math.round(jt),it=b*ft+Bt,st=Math.round(it),vt=(R+lt)*mt+At,Ft=Math.abs(Math.round(vt)-St)||1,Ot=(b+B)*ft+Bt,te=Math.abs(Math.round(Ot)-st)||1;return T.setTransform(0,Math.sign(ft),Math.sign(mt),0,St,st),T.drawImage(i,a,s,c,d,0,0,te,Ft),T.setTransform(nt,ft,mt,Mt,At,Bt),[te,Ft]}T.drawImage(i,a,s,c,d,b,R,B,lt);const Vt=Math.hypot(nt,ft),kt=Math.hypot(mt,Mt);return[Vt*B,kt*lt]}function A(T){const{width:i,height:a}=T;if(i>W||a>W)return null;const s=1e3,c=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),d=i+1;let b=new Uint8Array(d*(a+1)),R,B,lt;const nt=i+7&-8;let ft=new Uint8Array(nt*a),mt=0;for(const kt of T.data){let jt=128;for(;jt>0;)ft[mt++]=kt&jt?0:255,jt>>=1}let Mt=0;for(mt=0,ft[mt]!==0&&(b[0]=1,++Mt),B=1;B<i;B++)ft[mt]!==ft[mt+1]&&(b[B]=ft[mt]?2:1,++Mt),mt++;for(ft[mt]!==0&&(b[B]=2,++Mt),R=1;R<a;R++){mt=R*nt,lt=R*d,ft[mt-nt]!==ft[mt]&&(b[lt]=ft[mt]?1:8,++Mt);let kt=(ft[mt]?4:0)+(ft[mt-nt]?8:0);for(B=1;B<i;B++)kt=(kt>>2)+(ft[mt+1]?4:0)+(ft[mt-nt+1]?8:0),c[kt]&&(b[lt+B]=c[kt],++Mt),mt++;if(ft[mt-nt]!==ft[mt]&&(b[lt+B]=ft[mt]?2:4,++Mt),Mt>s)return null}for(mt=nt*(a-1),lt=R*d,ft[mt]!==0&&(b[lt]=8,++Mt),B=1;B<i;B++)ft[mt]!==ft[mt+1]&&(b[lt+B]=ft[mt]?4:8,++Mt),mt++;if(ft[mt]!==0&&(b[lt+B]=4,++Mt),Mt>s)return null;const At=new Int32Array([0,d,-1,0,-d,0,0,0,1]),Bt=new Path2D;for(R=0;Mt&&R<=a;R++){let kt=R*d;const jt=kt+i;for(;kt<jt&&!b[kt];)kt++;if(kt===jt)continue;Bt.moveTo(kt%d,R);const St=kt;let it=b[kt];do{const st=At[it];do kt+=st;while(!b[kt]);const vt=b[kt];vt!==5&&vt!==10?(it=vt,b[kt]=0):(it=vt&51*it>>4,b[kt]&=it>>2|it<<2),Bt.lineTo(kt%d,kt/d|0),b[kt]||--Mt}while(St!==kt);--R}return ft=null,b=null,function(kt){kt.save(),kt.scale(1/i,-1/a),kt.translate(0,-a),kt.fill(Bt),kt.beginPath(),kt.restore()}}class M{constructor(i,a){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=r.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=r.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=r.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,i,a])}clone(){const i=Object.create(this);return i.clipBox=this.clipBox.slice(),i}setCurrentPoint(i,a){this.x=i,this.y=a}updatePathMinMax(i,a,s){[a,s]=r.Util.applyTransform([a,s],i),this.minX=Math.min(this.minX,a),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,a),this.maxY=Math.max(this.maxY,s)}updateRectMinMax(i,a){const s=r.Util.applyTransform(a,i),c=r.Util.applyTransform(a.slice(2),i);this.minX=Math.min(this.minX,s[0],c[0]),this.minY=Math.min(this.minY,s[1],c[1]),this.maxX=Math.max(this.maxX,s[0],c[0]),this.maxY=Math.max(this.maxY,s[1],c[1])}updateScalingPathMinMax(i,a){r.Util.scaleMinMax(i,a),this.minX=Math.min(this.minX,a[0]),this.maxX=Math.max(this.maxX,a[1]),this.minY=Math.min(this.minY,a[2]),this.maxY=Math.max(this.maxY,a[3])}updateCurvePathMinMax(i,a,s,c,d,b,R,B,lt,nt){const ft=r.Util.bezierBoundingBox(a,s,c,d,b,R,B,lt);if(nt){nt[0]=Math.min(nt[0],ft[0],ft[2]),nt[1]=Math.max(nt[1],ft[0],ft[2]),nt[2]=Math.min(nt[2],ft[1],ft[3]),nt[3]=Math.max(nt[3],ft[1],ft[3]);return}this.updateRectMinMax(i,ft)}getPathBoundingBox(i=q.PathType.FILL,a=null){const s=[this.minX,this.minY,this.maxX,this.maxY];if(i===q.PathType.STROKE){a||(0,r.unreachable)("Stroke bounding box must include transform.");const c=r.Util.singularValueDecompose2dScale(a),d=c[0]*this.lineWidth/2,b=c[1]*this.lineWidth/2;s[0]-=d,s[1]-=b,s[2]+=d,s[3]+=b}return s}updateClipFromPath(){const i=r.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(i||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(i){this.clipBox=i,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(i=q.PathType.FILL,a=null){return r.Util.intersect(this.clipBox,this.getPathBoundingBox(i,a))}}function k(T,i){if(typeof ImageData<"u"&&i instanceof ImageData){T.putImageData(i,0,0);return}const a=i.height,s=i.width,c=a%L,d=(a-c)/L,b=c===0?d:d+1,R=T.createImageData(s,L);let B=0,lt;const nt=i.data,ft=R.data;let mt,Mt,At,Bt;if(i.kind===r.ImageKind.GRAYSCALE_1BPP){const Vt=nt.byteLength,kt=new Uint32Array(ft.buffer,0,ft.byteLength>>2),jt=kt.length,St=s+7>>3,it=4294967295,st=r.FeatureTest.isLittleEndian?4278190080:255;for(mt=0;mt<b;mt++){for(At=mt<d?L:c,lt=0,Mt=0;Mt<At;Mt++){const vt=Vt-B;let Ft=0;const Ot=vt>St?s:vt*8-7,te=Ot&-8;let Kt=0,Jt=0;for(;Ft<te;Ft+=8)Jt=nt[B++],kt[lt++]=Jt&128?it:st,kt[lt++]=Jt&64?it:st,kt[lt++]=Jt&32?it:st,kt[lt++]=Jt&16?it:st,kt[lt++]=Jt&8?it:st,kt[lt++]=Jt&4?it:st,kt[lt++]=Jt&2?it:st,kt[lt++]=Jt&1?it:st;for(;Ft<Ot;Ft++)Kt===0&&(Jt=nt[B++],Kt=128),kt[lt++]=Jt&Kt?it:st,Kt>>=1}for(;lt<jt;)kt[lt++]=0;T.putImageData(R,0,mt*L)}}else if(i.kind===r.ImageKind.RGBA_32BPP){for(Mt=0,Bt=s*L*4,mt=0;mt<d;mt++)ft.set(nt.subarray(B,B+Bt)),B+=Bt,T.putImageData(R,0,Mt),Mt+=L;mt<b&&(Bt=s*c*4,ft.set(nt.subarray(B,B+Bt)),T.putImageData(R,0,Mt))}else if(i.kind===r.ImageKind.RGB_24BPP)for(At=L,Bt=s*At,mt=0;mt<b;mt++){for(mt>=d&&(At=c,Bt=s*At),lt=0,Mt=Bt;Mt--;)ft[lt++]=nt[B++],ft[lt++]=nt[B++],ft[lt++]=nt[B++],ft[lt++]=255;T.putImageData(R,0,mt*L)}else throw new Error(`bad image kind: ${i.kind}`)}function v(T,i){if(i.bitmap){T.drawImage(i.bitmap,0,0);return}const a=i.height,s=i.width,c=a%L,d=(a-c)/L,b=c===0?d:d+1,R=T.createImageData(s,L);let B=0;const lt=i.data,nt=R.data;for(let ft=0;ft<b;ft++){const mt=ft<d?L:c;({srcPos:B}=(0,Y.convertBlackAndWhiteToRGBA)({src:lt,srcPos:B,dest:nt,width:s,height:mt,nonBlackColor:0})),T.putImageData(R,0,ft*L)}}function l(T,i){const a=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of a)T[s]!==void 0&&(i[s]=T[s]);T.setLineDash!==void 0&&(i.setLineDash(T.getLineDash()),i.lineDashOffset=T.lineDashOffset)}function h(T){if(T.strokeStyle=T.fillStyle="#000000",T.fillRule="nonzero",T.globalAlpha=1,T.lineWidth=1,T.lineCap="butt",T.lineJoin="miter",T.miterLimit=10,T.globalCompositeOperation="source-over",T.font="10px sans-serif",T.setLineDash!==void 0&&(T.setLineDash([]),T.lineDashOffset=0),!r.isNodeJS){const{filter:i}=T;i!=="none"&&i!==""&&(T.filter="none")}}function I(T,i,a,s){const c=T.length;for(let d=3;d<c;d+=4){const b=T[d];if(b===0)T[d-3]=i,T[d-2]=a,T[d-1]=s;else if(b<255){const R=255-b;T[d-3]=T[d-3]*b+i*R>>8,T[d-2]=T[d-2]*b+a*R>>8,T[d-1]=T[d-1]*b+s*R>>8}}}function Q(T,i,a){const s=T.length,c=1/255;for(let d=3;d<s;d+=4){const b=a?a[T[d]]:T[d];i[d]=i[d]*b*c|0}}function J(T,i,a){const s=T.length;for(let c=3;c<s;c+=4){const d=T[c-3]*77+T[c-2]*152+T[c-1]*28;i[c]=a?i[c]*a[d>>8]>>8:i[c]*d>>16}}function _t(T,i,a,s,c,d,b,R,B,lt,nt){const ft=!!d,mt=ft?d[0]:0,Mt=ft?d[1]:0,At=ft?d[2]:0,Bt=c==="Luminosity"?J:Q,kt=Math.min(s,Math.ceil(1048576/a));for(let jt=0;jt<s;jt+=kt){const St=Math.min(kt,s-jt),it=T.getImageData(R-lt,jt+(B-nt),a,St),st=i.getImageData(R,jt+B,a,St);ft&&I(it.data,mt,Mt,At),Bt(it.data,st.data,b),i.putImageData(st,R,jt+B)}}function at(T,i,a,s){const c=s[0],d=s[1],b=s[2]-c,R=s[3]-d;b===0||R===0||(_t(i.context,a,b,R,i.subtype,i.backdrop,i.transferMap,c,d,i.offsetX,i.offsetY),T.save(),T.globalAlpha=1,T.globalCompositeOperation="source-over",T.setTransform(1,0,0,1,0,0),T.drawImage(a.canvas,0,0),T.restore())}function xt(T,i){const a=r.Util.singularValueDecompose2dScale(T);a[0]=Math.fround(a[0]),a[1]=Math.fround(a[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*x.PixelsPerInch.PDF_TO_CSS_UNITS);return i!==void 0?i:a[0]<=s||a[1]<=s}const Ct=["butt","round","square"],j=["miter","round","bevel"],ut={},Et={},$t=class $t{constructor(i,a,s,c,d,{optionalContentConfig:b,markedContentStack:R=null},B,lt){$(this,et);$(this,Rt);this.ctx=i,this.current=new M(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=a,this.objs=s,this.canvasFactory=c,this.filterFactory=d,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=R||[],this.optionalContentConfig=b,this.cachedCanvases=new w(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=B,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=lt,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(i,a=null){return typeof i=="string"?i.startsWith("g_")?this.commonObjs.get(i):this.objs.get(i):a}beginDrawing({transform:i,viewport:a,transparency:s=!1,background:c=null}){const d=this.ctx.canvas.width,b=this.ctx.canvas.height,R=this.ctx.fillStyle;if(this.ctx.fillStyle=c||"#ffffff",this.ctx.fillRect(0,0,d,b),this.ctx.fillStyle=R,s){const B=this.cachedCanvases.getCanvas("transparent",d,b);this.compositeCtx=this.ctx,this.transparentCanvas=B.canvas,this.ctx=B.context,this.ctx.save(),this.ctx.transform(...(0,x.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),h(this.ctx),i&&(this.ctx.transform(...i),this.outputScaleX=i[0],this.outputScaleY=i[0]),this.ctx.transform(...a.transform),this.viewportScale=a.scale,this.baseTransform=(0,x.getCurrentTransform)(this.ctx)}executeOperatorList(i,a,s,c){const d=i.argsArray,b=i.fnArray;let R=a||0;const B=d.length;if(B===R)return R;const lt=B-R>H&&typeof s=="function",nt=lt?Date.now()+g:0;let ft=0;const mt=this.commonObjs,Mt=this.objs;let At;for(;;){if(c!==void 0&&R===c.nextBreakPoint)return c.breakIt(R,s),R;if(At=b[R],At!==r.OPS.dependency)this[At].apply(this,d[R]);else for(const Bt of d[R]){const Vt=Bt.startsWith("g_")?mt:Mt;if(!Vt.has(Bt))return Vt.get(Bt,s),R}if(R++,R===B)return R;if(lt&&++ft>H){if(Date.now()>nt)return s(),R;ft=0}}}endDrawing(){Z(this,et,ns).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const i of this._cachedBitmapsMap.values()){for(const a of i.values())typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement&&(a.width=a.height=0);i.clear()}this._cachedBitmapsMap.clear(),Z(this,Rt,rs).call(this)}_scaleImage(i,a){const s=i.width,c=i.height;let d=Math.max(Math.hypot(a[0],a[1]),1),b=Math.max(Math.hypot(a[2],a[3]),1),R=s,B=c,lt="prescale1",nt,ft;for(;d>2&&R>1||b>2&&B>1;){let mt=R,Mt=B;d>2&&R>1&&(mt=R>=16384?Math.floor(R/2)-1||1:Math.ceil(R/2),d/=R/mt),b>2&&B>1&&(Mt=B>=16384?Math.floor(B/2)-1||1:Math.ceil(B)/2,b/=B/Mt),nt=this.cachedCanvases.getCanvas(lt,mt,Mt),ft=nt.context,ft.clearRect(0,0,mt,Mt),ft.drawImage(i,0,0,R,B,0,0,mt,Mt),i=nt.canvas,R=mt,B=Mt,lt=lt==="prescale1"?"prescale2":"prescale1"}return{img:i,paintWidth:R,paintHeight:B}}_createMaskCanvas(i){const a=this.ctx,{width:s,height:c}=i,d=this.current.fillColor,b=this.current.patternFill,R=(0,x.getCurrentTransform)(a);let B,lt,nt,ft;if((i.bitmap||i.data)&&i.count>1){const Ft=i.bitmap||i.data.buffer;lt=JSON.stringify(b?R:[R.slice(0,4),d]),B=this._cachedBitmapsMap.get(Ft),B||(B=new Map,this._cachedBitmapsMap.set(Ft,B));const Ot=B.get(lt);if(Ot&&!b){const te=Math.round(Math.min(R[0],R[2])+R[4]),Kt=Math.round(Math.min(R[1],R[3])+R[5]);return{canvas:Ot,offsetX:te,offsetY:Kt}}nt=Ot}nt||(ft=this.cachedCanvases.getCanvas("maskCanvas",s,c),v(ft.context,i));let mt=r.Util.transform(R,[1/s,0,0,-1/c,0,0]);mt=r.Util.transform(mt,[1,0,0,1,0,-c]);const Mt=r.Util.applyTransform([0,0],mt),At=r.Util.applyTransform([s,c],mt),Bt=r.Util.normalizeRect([Mt[0],Mt[1],At[0],At[1]]),Vt=Math.round(Bt[2]-Bt[0])||1,kt=Math.round(Bt[3]-Bt[1])||1,jt=this.cachedCanvases.getCanvas("fillCanvas",Vt,kt),St=jt.context,it=Math.min(Mt[0],At[0]),st=Math.min(Mt[1],At[1]);St.translate(-it,-st),St.transform(...mt),nt||(nt=this._scaleImage(ft.canvas,(0,x.getCurrentTransformInverse)(St)),nt=nt.img,B&&b&&B.set(lt,nt)),St.imageSmoothingEnabled=xt((0,x.getCurrentTransform)(St),i.interpolate),f(St,nt,0,0,nt.width,nt.height,0,0,s,c),St.globalCompositeOperation="source-in";const vt=r.Util.transform((0,x.getCurrentTransformInverse)(St),[1,0,0,1,-it,-st]);return St.fillStyle=b?d.getPattern(a,this,vt,q.PathType.FILL):d,St.fillRect(0,0,s,c),B&&!b&&(this.cachedCanvases.delete("fillCanvas"),B.set(lt,jt.canvas)),{canvas:jt.canvas,offsetX:Math.round(it),offsetY:Math.round(st)}}setLineWidth(i){i!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=i,this.ctx.lineWidth=i}setLineCap(i){this.ctx.lineCap=Ct[i]}setLineJoin(i){this.ctx.lineJoin=j[i]}setMiterLimit(i){this.ctx.miterLimit=i}setDash(i,a){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(i),s.lineDashOffset=a)}setRenderingIntent(i){}setFlatness(i){}setGState(i){for(const[a,s]of i)switch(a){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.current.fillAlpha=s,this.ctx.globalAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const i=this.inSMaskMode;this.current.activeSMask&&!i?this.beginSMaskMode():!this.current.activeSMask&&i&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const i=this.ctx.canvas.width,a=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,c=this.cachedCanvases.getCanvas(s,i,a);this.suspendedCtx=this.ctx,this.ctx=c.context;const d=this.ctx;d.setTransform(...(0,x.getCurrentTransform)(this.suspendedCtx)),l(this.suspendedCtx,d),E(d,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),l(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(i){if(!this.current.activeSMask)return;i?(i[0]=Math.floor(i[0]),i[1]=Math.floor(i[1]),i[2]=Math.ceil(i[2]),i[3]=Math.ceil(i[3])):i=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const a=this.current.activeSMask,s=this.suspendedCtx;at(s,a,this.ctx,i),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(l(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const i=this.current;this.stateStack.push(i),this.current=i.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),l(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(i,a,s,c,d,b){this.ctx.transform(i,a,s,c,d,b),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(i,a,s){const c=this.ctx,d=this.current;let b=d.x,R=d.y,B,lt;const nt=(0,x.getCurrentTransform)(c),ft=nt[0]===0&&nt[3]===0||nt[1]===0&&nt[2]===0,mt=ft?s.slice(0):null;for(let Mt=0,At=0,Bt=i.length;Mt<Bt;Mt++)switch(i[Mt]|0){case r.OPS.rectangle:b=a[At++],R=a[At++];const Vt=a[At++],kt=a[At++],jt=b+Vt,St=R+kt;c.moveTo(b,R),Vt===0||kt===0?c.lineTo(jt,St):(c.lineTo(jt,R),c.lineTo(jt,St),c.lineTo(b,St)),ft||d.updateRectMinMax(nt,[b,R,jt,St]),c.closePath();break;case r.OPS.moveTo:b=a[At++],R=a[At++],c.moveTo(b,R),ft||d.updatePathMinMax(nt,b,R);break;case r.OPS.lineTo:b=a[At++],R=a[At++],c.lineTo(b,R),ft||d.updatePathMinMax(nt,b,R);break;case r.OPS.curveTo:B=b,lt=R,b=a[At+4],R=a[At+5],c.bezierCurveTo(a[At],a[At+1],a[At+2],a[At+3],b,R),d.updateCurvePathMinMax(nt,B,lt,a[At],a[At+1],a[At+2],a[At+3],b,R,mt),At+=6;break;case r.OPS.curveTo2:B=b,lt=R,c.bezierCurveTo(b,R,a[At],a[At+1],a[At+2],a[At+3]),d.updateCurvePathMinMax(nt,B,lt,b,R,a[At],a[At+1],a[At+2],a[At+3],mt),b=a[At+2],R=a[At+3],At+=4;break;case r.OPS.curveTo3:B=b,lt=R,b=a[At+2],R=a[At+3],c.bezierCurveTo(a[At],a[At+1],b,R,b,R),d.updateCurvePathMinMax(nt,B,lt,a[At],a[At+1],b,R,b,R,mt),At+=4;break;case r.OPS.closePath:c.closePath();break}ft&&d.updateScalingPathMinMax(nt,mt),d.setCurrentPoint(b,R)}closePath(){this.ctx.closePath()}stroke(i=!0){const a=this.ctx,s=this.current.strokeColor;a.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof s=="object"&&(s!=null&&s.getPattern)?(a.save(),a.strokeStyle=s.getPattern(a,this,(0,x.getCurrentTransformInverse)(a),q.PathType.STROKE),this.rescaleAndStroke(!1),a.restore()):this.rescaleAndStroke(!0)),i&&this.consumePath(this.current.getClippedPathBoundingBox()),a.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(i=!0){const a=this.ctx,s=this.current.fillColor,c=this.current.patternFill;let d=!1;c&&(a.save(),a.fillStyle=s.getPattern(a,this,(0,x.getCurrentTransformInverse)(a),q.PathType.FILL),d=!0);const b=this.current.getClippedPathBoundingBox();this.contentVisible&&b!==null&&(this.pendingEOFill?(a.fill("evenodd"),this.pendingEOFill=!1):a.fill()),d&&a.restore(),i&&this.consumePath(b)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=ut}eoClip(){this.pendingClip=Et}beginText(){this.current.textMatrix=r.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const i=this.pendingTextPaths,a=this.ctx;if(i===void 0){a.beginPath();return}a.save(),a.beginPath();for(const s of i)a.setTransform(...s.transform),a.translate(s.x,s.y),s.addToPath(a,s.fontSize);a.restore(),a.clip(),a.beginPath(),delete this.pendingTextPaths}setCharSpacing(i){this.current.charSpacing=i}setWordSpacing(i){this.current.wordSpacing=i}setHScale(i){this.current.textHScale=i/100}setLeading(i){this.current.leading=-i}setFont(i,a){var nt;const s=this.commonObjs.get(i),c=this.current;if(!s)throw new Error(`Can't find font for ${i}`);if(c.fontMatrix=s.fontMatrix||r.FONT_IDENTITY_MATRIX,(c.fontMatrix[0]===0||c.fontMatrix[3]===0)&&(0,r.warn)("Invalid font matrix for font "+i),a<0?(a=-a,c.fontDirection=-1):c.fontDirection=1,this.current.font=s,this.current.fontSize=a,s.isType3Font)return;const d=s.loadedName||"sans-serif",b=((nt=s.systemFontInfo)==null?void 0:nt.css)||`"${d}", ${s.fallbackName}`;let R="normal";s.black?R="900":s.bold&&(R="bold");const B=s.italic?"italic":"normal";let lt=a;a<gt?lt=gt:a>z&&(lt=z),this.current.fontSizeScale=a/lt,this.ctx.font=`${B} ${R} ${lt}px ${b}`}setTextRenderingMode(i){this.current.textRenderingMode=i}setTextRise(i){this.current.textRise=i}moveText(i,a){this.current.x=this.current.lineX+=i,this.current.y=this.current.lineY+=a}setLeadingMoveText(i,a){this.setLeading(-a),this.moveText(i,a)}setTextMatrix(i,a,s,c,d,b){this.current.textMatrix=[i,a,s,c,d,b],this.current.textMatrixScale=Math.hypot(i,a),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(i,a,s,c){const d=this.ctx,b=this.current,R=b.font,B=b.textRenderingMode,lt=b.fontSize/b.fontSizeScale,nt=B&r.TextRenderingMode.FILL_STROKE_MASK,ft=!!(B&r.TextRenderingMode.ADD_TO_PATH_FLAG),mt=b.patternFill&&!R.missingFile;let Mt;(R.disableFontFace||ft||mt)&&(Mt=R.getPathGenerator(this.commonObjs,i)),R.disableFontFace||mt?(d.save(),d.translate(a,s),d.beginPath(),Mt(d,lt),c&&d.setTransform(...c),(nt===r.TextRenderingMode.FILL||nt===r.TextRenderingMode.FILL_STROKE)&&d.fill(),(nt===r.TextRenderingMode.STROKE||nt===r.TextRenderingMode.FILL_STROKE)&&d.stroke(),d.restore()):((nt===r.TextRenderingMode.FILL||nt===r.TextRenderingMode.FILL_STROKE)&&d.fillText(i,a,s),(nt===r.TextRenderingMode.STROKE||nt===r.TextRenderingMode.FILL_STROKE)&&d.strokeText(i,a,s)),ft&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,x.getCurrentTransform)(d),x:a,y:s,fontSize:lt,addToPath:Mt})}get isFontSubpixelAAEnabled(){const{context:i}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);i.scale(1.5,1),i.fillText("I",0,10);const a=i.getImageData(0,0,10,10).data;let s=!1;for(let c=3;c<a.length;c+=4)if(a[c]>0&&a[c]<255){s=!0;break}return(0,r.shadow)(this,"isFontSubpixelAAEnabled",s)}showText(i){const a=this.current,s=a.font;if(s.isType3Font)return this.showType3Text(i);const c=a.fontSize;if(c===0)return;const d=this.ctx,b=a.fontSizeScale,R=a.charSpacing,B=a.wordSpacing,lt=a.fontDirection,nt=a.textHScale*lt,ft=i.length,mt=s.vertical,Mt=mt?1:-1,At=s.defaultVMetrics,Bt=c*a.fontMatrix[0],Vt=a.textRenderingMode===r.TextRenderingMode.FILL&&!s.disableFontFace&&!a.patternFill;d.save(),d.transform(...a.textMatrix),d.translate(a.x,a.y+a.textRise),lt>0?d.scale(nt,-1):d.scale(nt,1);let kt;if(a.patternFill){d.save();const vt=a.fillColor.getPattern(d,this,(0,x.getCurrentTransformInverse)(d),q.PathType.FILL);kt=(0,x.getCurrentTransform)(d),d.restore(),d.fillStyle=vt}let jt=a.lineWidth;const St=a.textMatrixScale;if(St===0||jt===0){const vt=a.textRenderingMode&r.TextRenderingMode.FILL_STROKE_MASK;(vt===r.TextRenderingMode.STROKE||vt===r.TextRenderingMode.FILL_STROKE)&&(jt=this.getSinglePixelWidth())}else jt/=St;if(b!==1&&(d.scale(b,b),jt/=b),d.lineWidth=jt,s.isInvalidPDFjsFont){const vt=[];let Ft=0;for(const Ot of i)vt.push(Ot.unicode),Ft+=Ot.width;d.fillText(vt.join(""),0,0),a.x+=Ft*Bt*nt,d.restore(),this.compose();return}let it=0,st;for(st=0;st<ft;++st){const vt=i[st];if(typeof vt=="number"){it+=Mt*vt*c/1e3;continue}let Ft=!1;const Ot=(vt.isSpace?B:0)+R,te=vt.fontChar,Kt=vt.accent;let Jt,Zt,pt=vt.width;if(mt){const X=vt.vmetric||At,_=-(vt.vmetric?X[1]:pt*.5)*Bt,S=X[2]*Bt;pt=X?-X[0]:pt,Jt=_/b,Zt=(it+S)/b}else Jt=it/b,Zt=0;if(s.remeasure&&pt>0){const X=d.measureText(te).width*1e3/c*b;if(pt<X&&this.isFontSubpixelAAEnabled){const _=pt/X;Ft=!0,d.save(),d.scale(_,1),Jt/=_}else pt!==X&&(Jt+=(pt-X)/2e3*c/b)}if(this.contentVisible&&(vt.isInFont||s.missingFile)){if(Vt&&!Kt)d.fillText(te,Jt,Zt);else if(this.paintChar(te,Jt,Zt,kt),Kt){const X=Jt+c*Kt.offset.x/b,_=Zt-c*Kt.offset.y/b;this.paintChar(Kt.fontChar,X,_,kt)}}const O=mt?pt*Bt-Ot*lt:pt*Bt+Ot*lt;it+=O,Ft&&d.restore()}mt?a.y-=it:a.x+=it*nt,d.restore(),this.compose()}showType3Text(i){const a=this.ctx,s=this.current,c=s.font,d=s.fontSize,b=s.fontDirection,R=c.vertical?1:-1,B=s.charSpacing,lt=s.wordSpacing,nt=s.textHScale*b,ft=s.fontMatrix||r.FONT_IDENTITY_MATRIX,mt=i.length,Mt=s.textRenderingMode===r.TextRenderingMode.INVISIBLE;let At,Bt,Vt,kt;if(!(Mt||d===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,a.save(),a.transform(...s.textMatrix),a.translate(s.x,s.y),a.scale(nt,b),At=0;At<mt;++At){if(Bt=i[At],typeof Bt=="number"){kt=R*Bt*d/1e3,this.ctx.translate(kt,0),s.x+=kt*nt;continue}const jt=(Bt.isSpace?lt:0)+B,St=c.charProcOperatorList[Bt.operatorListId];if(!St){(0,r.warn)(`Type3 character "${Bt.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=Bt,this.save(),a.scale(d,d),a.transform(...ft),this.executeOperatorList(St),this.restore()),Vt=r.Util.applyTransform([Bt.width,0],ft)[0]*d+jt,a.translate(Vt,0),s.x+=Vt*nt}a.restore(),this.processingType3=null}}setCharWidth(i,a){}setCharWidthAndBounds(i,a,s,c,d,b){this.ctx.rect(s,c,d-s,b-c),this.ctx.clip(),this.endPath()}getColorN_Pattern(i){let a;if(i[0]==="TilingPattern"){const s=i[1],c=this.baseTransform||(0,x.getCurrentTransform)(this.ctx),d={createCanvasGraphics:b=>new $t(b,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};a=new q.TilingPattern(i,s,this.ctx,d,c)}else a=this._getPattern(i[1],i[2]);return a}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(i,a,s){const c=r.Util.makeHexColor(i,a,s);this.ctx.strokeStyle=c,this.current.strokeColor=c}setFillRGBColor(i,a,s){const c=r.Util.makeHexColor(i,a,s);this.ctx.fillStyle=c,this.current.fillColor=c,this.current.patternFill=!1}_getPattern(i,a=null){let s;return this.cachedPatterns.has(i)?s=this.cachedPatterns.get(i):(s=(0,q.getShadingPattern)(this.getObject(i)),this.cachedPatterns.set(i,s)),a&&(s.matrix=a),s}shadingFill(i){if(!this.contentVisible)return;const a=this.ctx;this.save();const s=this._getPattern(i);a.fillStyle=s.getPattern(a,this,(0,x.getCurrentTransformInverse)(a),q.PathType.SHADING);const c=(0,x.getCurrentTransformInverse)(a);if(c){const{width:d,height:b}=a.canvas,[R,B,lt,nt]=r.Util.getAxialAlignedBoundingBox([0,0,d,b],c);this.ctx.fillRect(R,B,lt-R,nt-B)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,r.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,r.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(i,a){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(i)&&i.length===6&&this.transform(...i),this.baseTransform=(0,x.getCurrentTransform)(this.ctx),a)){const s=a[2]-a[0],c=a[3]-a[1];this.ctx.rect(a[0],a[1],s,c),this.current.updateRectMinMax((0,x.getCurrentTransform)(this.ctx),a),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(i){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const a=this.ctx;i.isolated||(0,r.info)("TODO: Support non-isolated groups."),i.knockout&&(0,r.warn)("Knockout groups not supported.");const s=(0,x.getCurrentTransform)(a);if(i.matrix&&a.transform(...i.matrix),!i.bbox)throw new Error("Bounding box is required.");let c=r.Util.getAxialAlignedBoundingBox(i.bbox,(0,x.getCurrentTransform)(a));const d=[0,0,a.canvas.width,a.canvas.height];c=r.Util.intersect(c,d)||[0,0,0,0];const b=Math.floor(c[0]),R=Math.floor(c[1]);let B=Math.max(Math.ceil(c[2])-b,1),lt=Math.max(Math.ceil(c[3])-R,1),nt=1,ft=1;B>F&&(nt=B/F,B=F),lt>F&&(ft=lt/F,lt=F),this.current.startNewPathAndClipBox([0,0,B,lt]);let mt="groupAt"+this.groupLevel;i.smask&&(mt+="_smask_"+this.smaskCounter++%2);const Mt=this.cachedCanvases.getCanvas(mt,B,lt),At=Mt.context;At.scale(1/nt,1/ft),At.translate(-b,-R),At.transform(...s),i.smask?this.smaskStack.push({canvas:Mt.canvas,context:At,offsetX:b,offsetY:R,scaleX:nt,scaleY:ft,subtype:i.smask.subtype,backdrop:i.smask.backdrop,transferMap:i.smask.transferMap||null,startTransformInverse:null}):(a.setTransform(1,0,0,1,0,0),a.translate(b,R),a.scale(nt,ft),a.save()),l(a,At),this.ctx=At,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(a),this.groupLevel++}endGroup(i){if(!this.contentVisible)return;this.groupLevel--;const a=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,i.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const c=(0,x.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...c);const d=r.Util.getAxialAlignedBoundingBox([0,0,a.canvas.width,a.canvas.height],c);this.ctx.drawImage(a.canvas,0,0),this.ctx.restore(),this.compose(d)}}beginAnnotation(i,a,s,c,d){if(Z(this,et,ns).call(this),h(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(a)&&a.length===4){const b=a[2]-a[0],R=a[3]-a[1];if(d&&this.annotationCanvasMap){s=s.slice(),s[4]-=a[0],s[5]-=a[1],a=a.slice(),a[0]=a[1]=0,a[2]=b,a[3]=R;const[B,lt]=r.Util.singularValueDecompose2dScale((0,x.getCurrentTransform)(this.ctx)),{viewportScale:nt}=this,ft=Math.ceil(b*this.outputScaleX*nt),mt=Math.ceil(R*this.outputScaleY*nt);this.annotationCanvas=this.canvasFactory.create(ft,mt);const{canvas:Mt,context:At}=this.annotationCanvas;this.annotationCanvasMap.set(i,Mt),this.annotationCanvas.savedCtx=this.ctx,this.ctx=At,this.ctx.save(),this.ctx.setTransform(B,0,0,-lt,0,R*lt),h(this.ctx)}else h(this.ctx),this.ctx.rect(a[0],a[1],b,R),this.ctx.clip(),this.endPath()}this.current=new M(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...c)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),Z(this,Rt,rs).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(i){if(!this.contentVisible)return;const a=i.count;i=this.getObject(i.data,i),i.count=a;const s=this.ctx,c=this.processingType3;if(c&&(c.compiled===void 0&&(c.compiled=A(i)),c.compiled)){c.compiled(s);return}const d=this._createMaskCanvas(i),b=d.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(b,d.offsetX,d.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(i,a,s=0,c=0,d,b){if(!this.contentVisible)return;i=this.getObject(i.data,i);const R=this.ctx;R.save();const B=(0,x.getCurrentTransform)(R);R.transform(a,s,c,d,0,0);const lt=this._createMaskCanvas(i);R.setTransform(1,0,0,1,lt.offsetX-B[4],lt.offsetY-B[5]);for(let nt=0,ft=b.length;nt<ft;nt+=2){const mt=r.Util.transform(B,[a,s,c,d,b[nt],b[nt+1]]),[Mt,At]=r.Util.applyTransform([0,0],mt);R.drawImage(lt.canvas,Mt,At)}R.restore(),this.compose()}paintImageMaskXObjectGroup(i){if(!this.contentVisible)return;const a=this.ctx,s=this.current.fillColor,c=this.current.patternFill;for(const d of i){const{data:b,width:R,height:B,transform:lt}=d,nt=this.cachedCanvases.getCanvas("maskCanvas",R,B),ft=nt.context;ft.save();const mt=this.getObject(b,d);v(ft,mt),ft.globalCompositeOperation="source-in",ft.fillStyle=c?s.getPattern(ft,this,(0,x.getCurrentTransformInverse)(a),q.PathType.FILL):s,ft.fillRect(0,0,R,B),ft.restore(),a.save(),a.transform(...lt),a.scale(1,-1),f(a,nt.canvas,0,0,R,B,0,-1,1,1),a.restore()}this.compose()}paintImageXObject(i){if(!this.contentVisible)return;const a=this.getObject(i);if(!a){(0,r.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(a)}paintImageXObjectRepeat(i,a,s,c){if(!this.contentVisible)return;const d=this.getObject(i);if(!d){(0,r.warn)("Dependent image isn't ready yet");return}const b=d.width,R=d.height,B=[];for(let lt=0,nt=c.length;lt<nt;lt+=2)B.push({transform:[a,0,0,s,c[lt],c[lt+1]],x:0,y:0,w:b,h:R});this.paintInlineImageXObjectGroup(d,B)}applyTransferMapsToCanvas(i){return this.current.transferMaps!=="none"&&(i.filter=this.current.transferMaps,i.drawImage(i.canvas,0,0),i.filter="none"),i.canvas}applyTransferMapsToBitmap(i){if(this.current.transferMaps==="none")return i.bitmap;const{bitmap:a,width:s,height:c}=i,d=this.cachedCanvases.getCanvas("inlineImage",s,c),b=d.context;return b.filter=this.current.transferMaps,b.drawImage(a,0,0),b.filter="none",d.canvas}paintInlineImageXObject(i){if(!this.contentVisible)return;const a=i.width,s=i.height,c=this.ctx;if(this.save(),!r.isNodeJS){const{filter:R}=c;R!=="none"&&R!==""&&(c.filter="none")}c.scale(1/a,-1/s);let d;if(i.bitmap)d=this.applyTransferMapsToBitmap(i);else if(typeof HTMLElement=="function"&&i instanceof HTMLElement||!i.data)d=i;else{const B=this.cachedCanvases.getCanvas("inlineImage",a,s).context;k(B,i),d=this.applyTransferMapsToCanvas(B)}const b=this._scaleImage(d,(0,x.getCurrentTransformInverse)(c));c.imageSmoothingEnabled=xt((0,x.getCurrentTransform)(c),i.interpolate),f(c,b.img,0,0,b.paintWidth,b.paintHeight,0,-s,a,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(i,a){if(!this.contentVisible)return;const s=this.ctx;let c;if(i.bitmap)c=i.bitmap;else{const d=i.width,b=i.height,B=this.cachedCanvases.getCanvas("inlineImage",d,b).context;k(B,i),c=this.applyTransferMapsToCanvas(B)}for(const d of a)s.save(),s.transform(...d.transform),s.scale(1,-1),f(s,c,d.x,d.y,d.w,d.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(i){}markPointProps(i,a){}beginMarkedContent(i){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(i,a){i==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(a)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(i){const a=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(i);const s=this.ctx;this.pendingClip&&(a||(this.pendingClip===Et?s.clip("evenodd"):s.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const i=(0,x.getCurrentTransform)(this.ctx);if(i[1]===0&&i[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(i[0]),Math.abs(i[3]));else{const a=Math.abs(i[0]*i[3]-i[2]*i[1]),s=Math.hypot(i[0],i[2]),c=Math.hypot(i[1],i[3]);this._cachedGetSinglePixelWidth=Math.max(s,c)/a}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:i}=this.current,{a,b:s,c,d}=this.ctx.getTransform();let b,R;if(s===0&&c===0){const B=Math.abs(a),lt=Math.abs(d);if(B===lt)if(i===0)b=R=1/B;else{const nt=B*i;b=R=nt<1?1/nt:1}else if(i===0)b=1/B,R=1/lt;else{const nt=B*i,ft=lt*i;b=nt<1?1/nt:1,R=ft<1?1/ft:1}}else{const B=Math.abs(a*d-s*c),lt=Math.hypot(a,s),nt=Math.hypot(c,d);if(i===0)b=nt/B,R=lt/B;else{const ft=i*B;b=nt>ft?nt/ft:1,R=lt>ft?lt/ft:1}}this._cachedScaleForStroking[0]=b,this._cachedScaleForStroking[1]=R}return this._cachedScaleForStroking}rescaleAndStroke(i){const{ctx:a}=this,{lineWidth:s}=this.current,[c,d]=this.getScaleForStroking();if(a.lineWidth=s||1,c===1&&d===1){a.stroke();return}const b=a.getLineDash();if(i&&a.save(),a.scale(c,d),b.length>0){const R=Math.max(c,d);a.setLineDash(b.map(B=>B/R)),a.lineDashOffset/=R}a.stroke(),i&&a.restore()}isContentVisible(){for(let i=this.markedContentStack.length-1;i>=0;i--)if(!this.markedContentStack[i].visible)return!1;return!0}};et=new WeakSet,ns=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Rt=new WeakSet,rs=function(){if(this.pageColors){const i=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(i!=="none"){const a=this.ctx.filter;this.ctx.filter=i,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=a}}};let yt=$t;o.CanvasGraphics=yt;for(const T in r.OPS)yt.prototype[T]!==void 0&&(yt.prototype[r.OPS[T]]=yt.prototype[T])},(U,o,V)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TilingPattern=o.PathType=void 0,o.getShadingPattern=L;var r=V(1),x=V(6);const q={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};o.PathType=q;function Y(A,M){if(!M)return;const k=M[2]-M[0],v=M[3]-M[1],l=new Path2D;l.rect(M[0],M[1],k,v),A.clip(l)}class gt{constructor(){this.constructor===gt&&(0,r.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,r.unreachable)("Abstract method `getPattern` called.")}}class z extends gt{constructor(M){super(),this._type=M[1],this._bbox=M[2],this._colorStops=M[3],this._p0=M[4],this._p1=M[5],this._r0=M[6],this._r1=M[7],this.matrix=null}_createGradient(M){let k;this._type==="axial"?k=M.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(k=M.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const v of this._colorStops)k.addColorStop(v[0],v[1]);return k}getPattern(M,k,v,l){let h;if(l===q.STROKE||l===q.FILL){const I=k.current.getClippedPathBoundingBox(l,(0,x.getCurrentTransform)(M))||[0,0,0,0],Q=Math.ceil(I[2]-I[0])||1,J=Math.ceil(I[3]-I[1])||1,_t=k.cachedCanvases.getCanvas("pattern",Q,J,!0),at=_t.context;at.clearRect(0,0,at.canvas.width,at.canvas.height),at.beginPath(),at.rect(0,0,at.canvas.width,at.canvas.height),at.translate(-I[0],-I[1]),v=r.Util.transform(v,[1,0,0,1,I[0],I[1]]),at.transform(...k.baseTransform),this.matrix&&at.transform(...this.matrix),Y(at,this._bbox),at.fillStyle=this._createGradient(at),at.fill(),h=M.createPattern(_t.canvas,"no-repeat");const xt=new DOMMatrix(v);h.setTransform(xt)}else Y(M,this._bbox),h=this._createGradient(M);return h}}function F(A,M,k,v,l,h,I,Q){const J=M.coords,_t=M.colors,at=A.data,xt=A.width*4;let Ct;J[k+1]>J[v+1]&&(Ct=k,k=v,v=Ct,Ct=h,h=I,I=Ct),J[v+1]>J[l+1]&&(Ct=v,v=l,l=Ct,Ct=I,I=Q,Q=Ct),J[k+1]>J[v+1]&&(Ct=k,k=v,v=Ct,Ct=h,h=I,I=Ct);const j=(J[k]+M.offsetX)*M.scaleX,ut=(J[k+1]+M.offsetY)*M.scaleY,Et=(J[v]+M.offsetX)*M.scaleX,yt=(J[v+1]+M.offsetY)*M.scaleY,et=(J[l]+M.offsetX)*M.scaleX,bt=(J[l+1]+M.offsetY)*M.scaleY;if(ut>=bt)return;const Rt=_t[h],Ut=_t[h+1],$t=_t[h+2],T=_t[I],i=_t[I+1],a=_t[I+2],s=_t[Q],c=_t[Q+1],d=_t[Q+2],b=Math.round(ut),R=Math.round(bt);let B,lt,nt,ft,mt,Mt,At,Bt;for(let Vt=b;Vt<=R;Vt++){if(Vt<yt){const st=Vt<ut?0:(ut-Vt)/(ut-yt);B=j-(j-Et)*st,lt=Rt-(Rt-T)*st,nt=Ut-(Ut-i)*st,ft=$t-($t-a)*st}else{let st;Vt>bt?st=1:yt===bt?st=0:st=(yt-Vt)/(yt-bt),B=Et-(Et-et)*st,lt=T-(T-s)*st,nt=i-(i-c)*st,ft=a-(a-d)*st}let kt;Vt<ut?kt=0:Vt>bt?kt=1:kt=(ut-Vt)/(ut-bt),mt=j-(j-et)*kt,Mt=Rt-(Rt-s)*kt,At=Ut-(Ut-c)*kt,Bt=$t-($t-d)*kt;const jt=Math.round(Math.min(B,mt)),St=Math.round(Math.max(B,mt));let it=xt*Vt+jt*4;for(let st=jt;st<=St;st++)kt=(B-st)/(B-mt),kt<0?kt=0:kt>1&&(kt=1),at[it++]=lt-(lt-Mt)*kt|0,at[it++]=nt-(nt-At)*kt|0,at[it++]=ft-(ft-Bt)*kt|0,at[it++]=255}}function g(A,M,k){const v=M.coords,l=M.colors;let h,I;switch(M.type){case"lattice":const Q=M.verticesPerRow,J=Math.floor(v.length/Q)-1,_t=Q-1;for(h=0;h<J;h++){let at=h*Q;for(let xt=0;xt<_t;xt++,at++)F(A,k,v[at],v[at+1],v[at+Q],l[at],l[at+1],l[at+Q]),F(A,k,v[at+Q+1],v[at+1],v[at+Q],l[at+Q+1],l[at+1],l[at+Q])}break;case"triangles":for(h=0,I=v.length;h<I;h+=3)F(A,k,v[h],v[h+1],v[h+2],l[h],l[h+1],l[h+2]);break;default:throw new Error("illegal figure")}}class H extends gt{constructor(M){super(),this._coords=M[2],this._colors=M[3],this._figures=M[4],this._bounds=M[5],this._bbox=M[7],this._background=M[8],this.matrix=null}_createMeshCanvas(M,k,v){const Q=Math.floor(this._bounds[0]),J=Math.floor(this._bounds[1]),_t=Math.ceil(this._bounds[2])-Q,at=Math.ceil(this._bounds[3])-J,xt=Math.min(Math.ceil(Math.abs(_t*M[0]*1.1)),3e3),Ct=Math.min(Math.ceil(Math.abs(at*M[1]*1.1)),3e3),j=_t/xt,ut=at/Ct,Et={coords:this._coords,colors:this._colors,offsetX:-Q,offsetY:-J,scaleX:1/j,scaleY:1/ut},yt=xt+2*2,et=Ct+2*2,bt=v.getCanvas("mesh",yt,et,!1),Rt=bt.context,Ut=Rt.createImageData(xt,Ct);if(k){const T=Ut.data;for(let i=0,a=T.length;i<a;i+=4)T[i]=k[0],T[i+1]=k[1],T[i+2]=k[2],T[i+3]=255}for(const T of this._figures)g(Ut,T,Et);return Rt.putImageData(Ut,2,2),{canvas:bt.canvas,offsetX:Q-2*j,offsetY:J-2*ut,scaleX:j,scaleY:ut}}getPattern(M,k,v,l){Y(M,this._bbox);let h;if(l===q.SHADING)h=r.Util.singularValueDecompose2dScale((0,x.getCurrentTransform)(M));else if(h=r.Util.singularValueDecompose2dScale(k.baseTransform),this.matrix){const Q=r.Util.singularValueDecompose2dScale(this.matrix);h=[h[0]*Q[0],h[1]*Q[1]]}const I=this._createMeshCanvas(h,l===q.SHADING?null:this._background,k.cachedCanvases);return l!==q.SHADING&&(M.setTransform(...k.baseTransform),this.matrix&&M.transform(...this.matrix)),M.translate(I.offsetX,I.offsetY),M.scale(I.scaleX,I.scaleY),M.createPattern(I.canvas,"no-repeat")}}class W extends gt{getPattern(){return"hotpink"}}function L(A){switch(A[0]){case"RadialAxial":return new z(A);case"Mesh":return new H(A);case"Dummy":return new W}throw new Error(`Unknown IR type: ${A[0]}`)}const E={COLORED:1,UNCOLORED:2},f=class f{constructor(M,k,v,l,h){this.operatorList=M[2],this.matrix=M[3]||[1,0,0,1,0,0],this.bbox=M[4],this.xstep=M[5],this.ystep=M[6],this.paintType=M[7],this.tilingType=M[8],this.color=k,this.ctx=v,this.canvasGraphicsFactory=l,this.baseTransform=h}createPatternCanvas(M){const k=this.operatorList,v=this.bbox,l=this.xstep,h=this.ystep,I=this.paintType,Q=this.tilingType,J=this.color,_t=this.canvasGraphicsFactory;(0,r.info)("TilingType: "+Q);const at=v[0],xt=v[1],Ct=v[2],j=v[3],ut=r.Util.singularValueDecompose2dScale(this.matrix),Et=r.Util.singularValueDecompose2dScale(this.baseTransform),yt=[ut[0]*Et[0],ut[1]*Et[1]],et=this.getSizeAndScale(l,this.ctx.canvas.width,yt[0]),bt=this.getSizeAndScale(h,this.ctx.canvas.height,yt[1]),Rt=M.cachedCanvases.getCanvas("pattern",et.size,bt.size,!0),Ut=Rt.context,$t=_t.createCanvasGraphics(Ut);$t.groupLevel=M.groupLevel,this.setFillAndStrokeStyleToContext($t,I,J);let T=at,i=xt,a=Ct,s=j;return at<0&&(T=0,a+=Math.abs(at)),xt<0&&(i=0,s+=Math.abs(xt)),Ut.translate(-(et.scale*T),-(bt.scale*i)),$t.transform(et.scale,0,0,bt.scale,0,0),Ut.save(),this.clipBbox($t,T,i,a,s),$t.baseTransform=(0,x.getCurrentTransform)($t.ctx),$t.executeOperatorList(k),$t.endDrawing(),{canvas:Rt.canvas,scaleX:et.scale,scaleY:bt.scale,offsetX:T,offsetY:i}}getSizeAndScale(M,k,v){M=Math.abs(M);const l=Math.max(f.MAX_PATTERN_SIZE,k);let h=Math.ceil(M*v);return h>=l?h=l:v=h/M,{scale:v,size:h}}clipBbox(M,k,v,l,h){const I=l-k,Q=h-v;M.ctx.rect(k,v,I,Q),M.current.updateRectMinMax((0,x.getCurrentTransform)(M.ctx),[k,v,l,h]),M.clip(),M.endPath()}setFillAndStrokeStyleToContext(M,k,v){const l=M.ctx,h=M.current;switch(k){case E.COLORED:const I=this.ctx;l.fillStyle=I.fillStyle,l.strokeStyle=I.strokeStyle,h.fillColor=I.fillStyle,h.strokeColor=I.strokeStyle;break;case E.UNCOLORED:const Q=r.Util.makeHexColor(v[0],v[1],v[2]);l.fillStyle=Q,l.strokeStyle=Q,h.fillColor=Q,h.strokeColor=Q;break;default:throw new r.FormatError(`Unsupported paint type: ${k}`)}}getPattern(M,k,v,l){let h=v;l!==q.SHADING&&(h=r.Util.transform(h,k.baseTransform),this.matrix&&(h=r.Util.transform(h,this.matrix)));const I=this.createPatternCanvas(k);let Q=new DOMMatrix(h);Q=Q.translate(I.offsetX,I.offsetY),Q=Q.scale(1/I.scaleX,1/I.scaleY);const J=M.createPattern(I.canvas,"repeat");return J.setTransform(Q),J}};oe(f,"MAX_PATTERN_SIZE",3e3);let w=f;o.TilingPattern=w},(U,o,V)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.convertBlackAndWhiteToRGBA=q,o.convertToRGBA=x,o.grayToRGBA=gt;var r=V(1);function x(z){switch(z.kind){case r.ImageKind.GRAYSCALE_1BPP:return q(z);case r.ImageKind.RGB_24BPP:return Y(z)}return null}function q({src:z,srcPos:F=0,dest:g,width:H,height:W,nonBlackColor:L=4294967295,inverseDecode:E=!1}){const w=r.FeatureTest.isLittleEndian?4278190080:255,[f,A]=E?[L,w]:[w,L],M=H>>3,k=H&7,v=z.length;g=new Uint32Array(g.buffer);let l=0;for(let h=0;h<W;h++){for(const Q=F+M;F<Q;F++){const J=F<v?z[F]:255;g[l++]=J&128?A:f,g[l++]=J&64?A:f,g[l++]=J&32?A:f,g[l++]=J&16?A:f,g[l++]=J&8?A:f,g[l++]=J&4?A:f,g[l++]=J&2?A:f,g[l++]=J&1?A:f}if(k===0)continue;const I=F<v?z[F++]:255;for(let Q=0;Q<k;Q++)g[l++]=I&1<<7-Q?A:f}return{srcPos:F,destPos:l}}function Y({src:z,srcPos:F=0,dest:g,destPos:H=0,width:W,height:L}){let E=0;const w=z.length>>2,f=new Uint32Array(z.buffer,F,w);if(r.FeatureTest.isLittleEndian){for(;E<w-2;E+=3,H+=4){const A=f[E],M=f[E+1],k=f[E+2];g[H]=A|4278190080,g[H+1]=A>>>24|M<<8|4278190080,g[H+2]=M>>>16|k<<16|4278190080,g[H+3]=k>>>8|4278190080}for(let A=E*4,M=z.length;A<M;A+=3)g[H++]=z[A]|z[A+1]<<8|z[A+2]<<16|4278190080}else{for(;E<w-2;E+=3,H+=4){const A=f[E],M=f[E+1],k=f[E+2];g[H]=A|255,g[H+1]=A<<24|M>>>8|255,g[H+2]=M<<16|k>>>16|255,g[H+3]=k<<8|255}for(let A=E*4,M=z.length;A<M;A+=3)g[H++]=z[A]<<24|z[A+1]<<16|z[A+2]<<8|255}return{srcPos:F,destPos:H}}function gt(z,F){if(r.FeatureTest.isLittleEndian)for(let g=0,H=z.length;g<H;g++)F[g]=z[g]*65793|4278190080;else for(let g=0,H=z.length;g<H;g++)F[g]=z[g]*16843008|255}},(U,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.GlobalWorkerOptions=void 0;const V=Object.create(null);o.GlobalWorkerOptions=V,V.workerPort=null,V.workerSrc=""},(U,o,V)=>{var z,mn,g,bn,W,yi;Object.defineProperty(o,"__esModule",{value:!0}),o.MessageHandler=void 0;var r=V(1);const x={UNKNOWN:0,DATA:1,ERROR:2},q={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Y(E){switch(E instanceof Error||typeof E=="object"&&E!==null||(0,r.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),E.name){case"AbortException":return new r.AbortException(E.message);case"MissingPDFException":return new r.MissingPDFException(E.message);case"PasswordException":return new r.PasswordException(E.message,E.code);case"UnexpectedResponseException":return new r.UnexpectedResponseException(E.message,E.status);case"UnknownErrorException":return new r.UnknownErrorException(E.message,E.details);default:return new r.UnknownErrorException(E.message,E.toString())}}class gt{constructor(w,f,A){$(this,z);$(this,g);$(this,W);this.sourceName=w,this.targetName=f,this.comObj=A,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=M=>{const k=M.data;if(k.targetName!==this.sourceName)return;if(k.stream){Z(this,g,bn).call(this,k);return}if(k.callback){const l=k.callbackId,h=this.callbackCapabilities[l];if(!h)throw new Error(`Cannot resolve callback ${l}`);if(delete this.callbackCapabilities[l],k.callback===x.DATA)h.resolve(k.data);else if(k.callback===x.ERROR)h.reject(Y(k.reason));else throw new Error("Unexpected callback case");return}const v=this.actionHandler[k.action];if(!v)throw new Error(`Unknown action from worker: ${k.action}`);if(k.callbackId){const l=this.sourceName,h=k.sourceName;new Promise(function(I){I(v(k.data))}).then(function(I){A.postMessage({sourceName:l,targetName:h,callback:x.DATA,callbackId:k.callbackId,data:I})},function(I){A.postMessage({sourceName:l,targetName:h,callback:x.ERROR,callbackId:k.callbackId,reason:Y(I)})});return}if(k.streamId){Z(this,z,mn).call(this,k);return}v(k.data)},A.addEventListener("message",this._onComObjOnMessage)}on(w,f){const A=this.actionHandler;if(A[w])throw new Error(`There is already an actionName called "${w}"`);A[w]=f}send(w,f,A){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:w,data:f},A)}sendWithPromise(w,f,A){const M=this.callbackId++,k=new r.PromiseCapability;this.callbackCapabilities[M]=k;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:w,callbackId:M,data:f},A)}catch(v){k.reject(v)}return k.promise}sendWithStream(w,f,A,M){const k=this.streamId++,v=this.sourceName,l=this.targetName,h=this.comObj;return new ReadableStream({start:I=>{const Q=new r.PromiseCapability;return this.streamControllers[k]={controller:I,startCall:Q,pullCall:null,cancelCall:null,isClosed:!1},h.postMessage({sourceName:v,targetName:l,action:w,streamId:k,data:f,desiredSize:I.desiredSize},M),Q.promise},pull:I=>{const Q=new r.PromiseCapability;return this.streamControllers[k].pullCall=Q,h.postMessage({sourceName:v,targetName:l,stream:q.PULL,streamId:k,desiredSize:I.desiredSize}),Q.promise},cancel:I=>{(0,r.assert)(I instanceof Error,"cancel must have a valid reason");const Q=new r.PromiseCapability;return this.streamControllers[k].cancelCall=Q,this.streamControllers[k].isClosed=!0,h.postMessage({sourceName:v,targetName:l,stream:q.CANCEL,streamId:k,reason:Y(I)}),Q.promise}},A)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}z=new WeakSet,mn=function(w){const f=w.streamId,A=this.sourceName,M=w.sourceName,k=this.comObj,v=this,l=this.actionHandler[w.action],h={enqueue(I,Q=1,J){if(this.isCancelled)return;const _t=this.desiredSize;this.desiredSize-=Q,_t>0&&this.desiredSize<=0&&(this.sinkCapability=new r.PromiseCapability,this.ready=this.sinkCapability.promise),k.postMessage({sourceName:A,targetName:M,stream:q.ENQUEUE,streamId:f,chunk:I},J)},close(){this.isCancelled||(this.isCancelled=!0,k.postMessage({sourceName:A,targetName:M,stream:q.CLOSE,streamId:f}),delete v.streamSinks[f])},error(I){(0,r.assert)(I instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,k.postMessage({sourceName:A,targetName:M,stream:q.ERROR,streamId:f,reason:Y(I)}))},sinkCapability:new r.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:w.desiredSize,ready:null};h.sinkCapability.resolve(),h.ready=h.sinkCapability.promise,this.streamSinks[f]=h,new Promise(function(I){I(l(w.data,h))}).then(function(){k.postMessage({sourceName:A,targetName:M,stream:q.START_COMPLETE,streamId:f,success:!0})},function(I){k.postMessage({sourceName:A,targetName:M,stream:q.START_COMPLETE,streamId:f,reason:Y(I)})})},g=new WeakSet,bn=function(w){const f=w.streamId,A=this.sourceName,M=w.sourceName,k=this.comObj,v=this.streamControllers[f],l=this.streamSinks[f];switch(w.stream){case q.START_COMPLETE:w.success?v.startCall.resolve():v.startCall.reject(Y(w.reason));break;case q.PULL_COMPLETE:w.success?v.pullCall.resolve():v.pullCall.reject(Y(w.reason));break;case q.PULL:if(!l){k.postMessage({sourceName:A,targetName:M,stream:q.PULL_COMPLETE,streamId:f,success:!0});break}l.desiredSize<=0&&w.desiredSize>0&&l.sinkCapability.resolve(),l.desiredSize=w.desiredSize,new Promise(function(h){var I;h((I=l.onPull)==null?void 0:I.call(l))}).then(function(){k.postMessage({sourceName:A,targetName:M,stream:q.PULL_COMPLETE,streamId:f,success:!0})},function(h){k.postMessage({sourceName:A,targetName:M,stream:q.PULL_COMPLETE,streamId:f,reason:Y(h)})});break;case q.ENQUEUE:if((0,r.assert)(v,"enqueue should have stream controller"),v.isClosed)break;v.controller.enqueue(w.chunk);break;case q.CLOSE:if((0,r.assert)(v,"close should have stream controller"),v.isClosed)break;v.isClosed=!0,v.controller.close(),Z(this,W,yi).call(this,v,f);break;case q.ERROR:(0,r.assert)(v,"error should have stream controller"),v.controller.error(Y(w.reason)),Z(this,W,yi).call(this,v,f);break;case q.CANCEL_COMPLETE:w.success?v.cancelCall.resolve():v.cancelCall.reject(Y(w.reason)),Z(this,W,yi).call(this,v,f);break;case q.CANCEL:if(!l)break;new Promise(function(h){var I;h((I=l.onCancel)==null?void 0:I.call(l,Y(w.reason)))}).then(function(){k.postMessage({sourceName:A,targetName:M,stream:q.CANCEL_COMPLETE,streamId:f,success:!0})},function(h){k.postMessage({sourceName:A,targetName:M,stream:q.CANCEL_COMPLETE,streamId:f,reason:Y(h)})}),l.sinkCapability.reject(Y(w.reason)),l.isCancelled=!0,delete this.streamSinks[f];break;default:throw new Error("Unexpected stream case")}},W=new WeakSet,yi=async function(w,f){var A,M,k;await Promise.allSettled([(A=w.startCall)==null?void 0:A.promise,(M=w.pullCall)==null?void 0:M.promise,(k=w.cancelCall)==null?void 0:k.promise]),delete this.streamControllers[f]},o.MessageHandler=gt},(U,o,V)=>{var q,Y;Object.defineProperty(o,"__esModule",{value:!0}),o.Metadata=void 0;var r=V(1);class x{constructor({parsedData:z,rawData:F}){$(this,q,void 0);$(this,Y,void 0);ot(this,q,z),ot(this,Y,F)}getRaw(){return t(this,Y)}get(z){return t(this,q).get(z)??null}getAll(){return(0,r.objectFromMap)(t(this,q))}has(z){return t(this,q).has(z)}}q=new WeakMap,Y=new WeakMap,o.Metadata=x},(U,o,V)=>{var z,F,g,H,W,L,as;Object.defineProperty(o,"__esModule",{value:!0}),o.OptionalContentConfig=void 0;var r=V(1),x=V(8);const q=Symbol("INTERNAL");class Y{constructor(f,A){$(this,z,!0);this.name=f,this.intent=A}get visible(){return t(this,z)}_setVisible(f,A){f!==q&&(0,r.unreachable)("Internal method `_setVisible` called."),ot(this,z,A)}}z=new WeakMap;class gt{constructor(f){$(this,L);$(this,F,null);$(this,g,new Map);$(this,H,null);$(this,W,null);if(this.name=null,this.creator=null,f!==null){this.name=f.name,this.creator=f.creator,ot(this,W,f.order);for(const A of f.groups)t(this,g).set(A.id,new Y(A.name,A.intent));if(f.baseState==="OFF")for(const A of t(this,g).values())A._setVisible(q,!1);for(const A of f.on)t(this,g).get(A)._setVisible(q,!0);for(const A of f.off)t(this,g).get(A)._setVisible(q,!1);ot(this,H,this.getHash())}}isVisible(f){if(t(this,g).size===0)return!0;if(!f)return(0,r.warn)("Optional content group not defined."),!0;if(f.type==="OCG")return t(this,g).has(f.id)?t(this,g).get(f.id).visible:((0,r.warn)(`Optional content group not found: ${f.id}`),!0);if(f.type==="OCMD"){if(f.expression)return Z(this,L,as).call(this,f.expression);if(!f.policy||f.policy==="AnyOn"){for(const A of f.ids){if(!t(this,g).has(A))return(0,r.warn)(`Optional content group not found: ${A}`),!0;if(t(this,g).get(A).visible)return!0}return!1}else if(f.policy==="AllOn"){for(const A of f.ids){if(!t(this,g).has(A))return(0,r.warn)(`Optional content group not found: ${A}`),!0;if(!t(this,g).get(A).visible)return!1}return!0}else if(f.policy==="AnyOff"){for(const A of f.ids){if(!t(this,g).has(A))return(0,r.warn)(`Optional content group not found: ${A}`),!0;if(!t(this,g).get(A).visible)return!0}return!1}else if(f.policy==="AllOff"){for(const A of f.ids){if(!t(this,g).has(A))return(0,r.warn)(`Optional content group not found: ${A}`),!0;if(t(this,g).get(A).visible)return!1}return!0}return(0,r.warn)(`Unknown optional content policy ${f.policy}.`),!0}return(0,r.warn)(`Unknown group type ${f.type}.`),!0}setVisibility(f,A=!0){if(!t(this,g).has(f)){(0,r.warn)(`Optional content group not found: ${f}`);return}t(this,g).get(f)._setVisible(q,!!A),ot(this,F,null)}get hasInitialVisibility(){return t(this,H)===null||this.getHash()===t(this,H)}getOrder(){return t(this,g).size?t(this,W)?t(this,W).slice():[...t(this,g).keys()]:null}getGroups(){return t(this,g).size>0?(0,r.objectFromMap)(t(this,g)):null}getGroup(f){return t(this,g).get(f)||null}getHash(){if(t(this,F)!==null)return t(this,F);const f=new x.MurmurHash3_64;for(const[A,M]of t(this,g))f.update(`${A}:${M.visible}`);return ot(this,F,f.hexdigest())}}F=new WeakMap,g=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakSet,as=function(f){const A=f.length;if(A<2)return!0;const M=f[0];for(let k=1;k<A;k++){const v=f[k];let l;if(Array.isArray(v))l=Z(this,L,as).call(this,v);else if(t(this,g).has(v))l=t(this,g).get(v).visible;else return(0,r.warn)(`Optional content group not found: ${v}`),!0;switch(M){case"And":if(!l)return!1;break;case"Or":if(l)return!0;break;case"Not":return!l;default:return!0}}return M==="And"},o.OptionalContentConfig=gt},(U,o,V)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PDFDataTransportStream=void 0;var r=V(1),x=V(6);class q{constructor({length:F,initialData:g,progressiveDone:H=!1,contentDispositionFilename:W=null,disableRange:L=!1,disableStream:E=!1},w){if((0,r.assert)(w,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=H,this._contentDispositionFilename=W,(g==null?void 0:g.length)>0){const f=g instanceof Uint8Array&&g.byteLength===g.buffer.byteLength?g.buffer:new Uint8Array(g).buffer;this._queuedChunks.push(f)}this._pdfDataRangeTransport=w,this._isStreamingSupported=!E,this._isRangeSupported=!L,this._contentLength=F,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((f,A)=>{this._onReceiveData({begin:f,chunk:A})}),this._pdfDataRangeTransport.addProgressListener((f,A)=>{this._onProgress({loaded:f,total:A})}),this._pdfDataRangeTransport.addProgressiveReadListener(f=>{this._onReceiveData({chunk:f})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:F,chunk:g}){const H=g instanceof Uint8Array&&g.byteLength===g.buffer.byteLength?g.buffer:new Uint8Array(g).buffer;if(F===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(H):this._queuedChunks.push(H);else{const W=this._rangeReaders.some(function(L){return L._begin!==F?!1:(L._enqueue(H),!0)});(0,r.assert)(W,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var F;return((F=this._fullRequestReader)==null?void 0:F._loaded)??0}_onProgress(F){var g,H,W,L;F.total===void 0?(H=(g=this._rangeReaders[0])==null?void 0:g.onProgress)==null||H.call(g,{loaded:F.loaded}):(L=(W=this._fullRequestReader)==null?void 0:W.onProgress)==null||L.call(W,{loaded:F.loaded,total:F.total})}_onProgressiveDone(){var F;(F=this._fullRequestReader)==null||F.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(F){const g=this._rangeReaders.indexOf(F);g>=0&&this._rangeReaders.splice(g,1)}getFullReader(){(0,r.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const F=this._queuedChunks;return this._queuedChunks=null,new Y(this,F,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(F,g){if(g<=this._progressiveDataLength)return null;const H=new gt(this,F,g);return this._pdfDataRangeTransport.requestDataRange(F,g),this._rangeReaders.push(H),H}cancelAllRequests(F){var g;(g=this._fullRequestReader)==null||g.cancel(F);for(const H of this._rangeReaders.slice(0))H.cancel(F);this._pdfDataRangeTransport.abort()}}o.PDFDataTransportStream=q;class Y{constructor(F,g,H=!1,W=null){this._stream=F,this._done=H||!1,this._filename=(0,x.isPdfFile)(W)?W:null,this._queuedChunks=g||[],this._loaded=0;for(const L of this._queuedChunks)this._loaded+=L.byteLength;this._requests=[],this._headersReady=Promise.resolve(),F._fullRequestReader=this,this.onProgress=null}_enqueue(F){this._done||(this._requests.length>0?this._requests.shift().resolve({value:F,done:!1}):this._queuedChunks.push(F),this._loaded+=F.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const F=new r.PromiseCapability;return this._requests.push(F),F.promise}cancel(F){this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class gt{constructor(F,g,H){this._stream=F,this._begin=g,this._end=H,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(F){if(!this._done){if(this._requests.length===0)this._queuedChunk=F;else{this._requests.shift().resolve({value:F,done:!1});for(const H of this._requests)H.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const g=this._queuedChunk;return this._queuedChunk=null,{value:g,done:!1}}if(this._done)return{value:void 0,done:!0};const F=new r.PromiseCapability;return this._requests.push(F),F.promise}cancel(F){this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(U,o,V)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PDFFetchStream=void 0;var r=V(1),x=V(20);function q(H,W,L){return{method:"GET",headers:H,signal:L.signal,mode:"cors",credentials:W?"include":"same-origin",redirect:"follow"}}function Y(H){const W=new Headers;for(const L in H){const E=H[L];E!==void 0&&W.append(L,E)}return W}function gt(H){return H instanceof Uint8Array?H.buffer:H instanceof ArrayBuffer?H:((0,r.warn)(`getArrayBuffer - unexpected data format: ${H}`),new Uint8Array(H).buffer)}class z{constructor(W){this.source=W,this.isHttp=/^https?:/i.test(W.url),this.httpHeaders=this.isHttp&&W.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var W;return((W=this._fullRequestReader)==null?void 0:W._loaded)??0}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new F(this),this._fullRequestReader}getRangeReader(W,L){if(L<=this._progressiveDataLength)return null;const E=new g(this,W,L);return this._rangeRequestReaders.push(E),E}cancelAllRequests(W){var L;(L=this._fullRequestReader)==null||L.cancel(W);for(const E of this._rangeRequestReaders.slice(0))E.cancel(W)}}o.PDFFetchStream=z;class F{constructor(W){this._stream=W,this._reader=null,this._loaded=0,this._filename=null;const L=W.source;this._withCredentials=L.withCredentials||!1,this._contentLength=L.length,this._headersCapability=new r.PromiseCapability,this._disableRange=L.disableRange||!1,this._rangeChunkSize=L.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!L.disableStream,this._isRangeSupported=!L.disableRange,this._headers=Y(this._stream.httpHeaders);const E=L.url;fetch(E,q(this._headers,this._withCredentials,this._abortController)).then(w=>{if(!(0,x.validateResponseStatus)(w.status))throw(0,x.createResponseStatusError)(w.status,E);this._reader=w.body.getReader(),this._headersCapability.resolve();const f=k=>w.headers.get(k),{allowRangeRequests:A,suggestedLength:M}=(0,x.validateRangeRequestCapabilities)({getResponseHeader:f,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=A,this._contentLength=M||this._contentLength,this._filename=(0,x.extractFilenameFromHeader)(f),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new r.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var E;await this._headersCapability.promise;const{value:W,done:L}=await this._reader.read();return L?{value:W,done:L}:(this._loaded+=W.byteLength,(E=this.onProgress)==null||E.call(this,{loaded:this._loaded,total:this._contentLength}),{value:gt(W),done:!1})}cancel(W){var L;(L=this._reader)==null||L.cancel(W),this._abortController.abort()}}class g{constructor(W,L,E){this._stream=W,this._reader=null,this._loaded=0;const w=W.source;this._withCredentials=w.withCredentials||!1,this._readCapability=new r.PromiseCapability,this._isStreamingSupported=!w.disableStream,this._abortController=new AbortController,this._headers=Y(this._stream.httpHeaders),this._headers.append("Range",`bytes=${L}-${E-1}`);const f=w.url;fetch(f,q(this._headers,this._withCredentials,this._abortController)).then(A=>{if(!(0,x.validateResponseStatus)(A.status))throw(0,x.createResponseStatusError)(A.status,f);this._readCapability.resolve(),this._reader=A.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var E;await this._readCapability.promise;const{value:W,done:L}=await this._reader.read();return L?{value:W,done:L}:(this._loaded+=W.byteLength,(E=this.onProgress)==null||E.call(this,{loaded:this._loaded}),{value:gt(W),done:!1})}cancel(W){var L;(L=this._reader)==null||L.cancel(W),this._abortController.abort()}}},(U,o,V)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.createResponseStatusError=z,o.extractFilenameFromHeader=gt,o.validateRangeRequestCapabilities=Y,o.validateResponseStatus=F;var r=V(1),x=V(21),q=V(6);function Y({getResponseHeader:g,isHttp:H,rangeChunkSize:W,disableRange:L}){const E={allowRangeRequests:!1,suggestedLength:void 0},w=parseInt(g("Content-Length"),10);return!Number.isInteger(w)||(E.suggestedLength=w,w<=2*W)||L||!H||g("Accept-Ranges")!=="bytes"||(g("Content-Encoding")||"identity")!=="identity"||(E.allowRangeRequests=!0),E}function gt(g){const H=g("Content-Disposition");if(H){let W=(0,x.getFilenameFromContentDispositionHeader)(H);if(W.includes("%"))try{W=decodeURIComponent(W)}catch{}if((0,q.isPdfFile)(W))return W}return null}function z(g,H){return g===404||g===0&&H.startsWith("file:")?new r.MissingPDFException('Missing PDF "'+H+'".'):new r.UnexpectedResponseException(`Unexpected server response (${g}) while retrieving PDF "${H}".`,g)}function F(g){return g===200||g===206}},(U,o,V)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.getFilenameFromContentDispositionHeader=x;var r=V(1);function x(q){let Y=!0,gt=z("filename\\*","i").exec(q);if(gt){gt=gt[1];let w=W(gt);return w=unescape(w),w=L(w),w=E(w),g(w)}if(gt=H(q),gt){const w=E(gt);return g(w)}if(gt=z("filename","i").exec(q),gt){gt=gt[1];let w=W(gt);return w=E(w),g(w)}function z(w,f){return new RegExp("(?:^|;)\\s*"+w+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',f)}function F(w,f){if(w){if(!/^[\x00-\xFF]+$/.test(f))return f;try{const A=new TextDecoder(w,{fatal:!0}),M=(0,r.stringToBytes)(f);f=A.decode(M),Y=!1}catch{}}return f}function g(w){return Y&&/[\x80-\xff]/.test(w)&&(w=F("utf-8",w),Y&&(w=F("iso-8859-1",w))),w}function H(w){const f=[];let A;const M=z("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(A=M.exec(w))!==null;){let[,v,l,h]=A;if(v=parseInt(v,10),v in f){if(v===0)break;continue}f[v]=[l,h]}const k=[];for(let v=0;v<f.length&&v in f;++v){let[l,h]=f[v];h=W(h),l&&(h=unescape(h),v===0&&(h=L(h))),k.push(h)}return k.join("")}function W(w){if(w.startsWith('"')){const f=w.slice(1).split('\\"');for(let A=0;A<f.length;++A){const M=f[A].indexOf('"');M!==-1&&(f[A]=f[A].slice(0,M),f.length=A+1),f[A]=f[A].replaceAll(/\\(.)/g,"$1")}w=f.join('"')}return w}function L(w){const f=w.indexOf("'");if(f===-1)return w;const A=w.slice(0,f),k=w.slice(f+1).replace(/^[^']*'/,"");return F(A,k)}function E(w){return!w.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(w)?w:w.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(f,A,M,k){if(M==="q"||M==="Q")return k=k.replaceAll("_"," "),k=k.replaceAll(/=([0-9a-fA-F]{2})/g,function(v,l){return String.fromCharCode(parseInt(l,16))}),F(A,k);try{k=atob(k)}catch{}return F(A,k)})}return""}},(U,o,V)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PDFNetworkStream=void 0;var r=V(1),x=V(20);const q=200,Y=206;function gt(W){const L=W.response;return typeof L!="string"?L:(0,r.stringToBytes)(L).buffer}class z{constructor(L,E={}){this.url=L,this.isHttp=/^https?:/i.test(L),this.httpHeaders=this.isHttp&&E.httpHeaders||Object.create(null),this.withCredentials=E.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(L,E,w){const f={begin:L,end:E};for(const A in w)f[A]=w[A];return this.request(f)}requestFull(L){return this.request(L)}request(L){const E=new XMLHttpRequest,w=this.currXhrId++,f=this.pendingRequests[w]={xhr:E};E.open("GET",this.url),E.withCredentials=this.withCredentials;for(const A in this.httpHeaders){const M=this.httpHeaders[A];M!==void 0&&E.setRequestHeader(A,M)}return this.isHttp&&"begin"in L&&"end"in L?(E.setRequestHeader("Range",`bytes=${L.begin}-${L.end-1}`),f.expectedStatus=Y):f.expectedStatus=q,E.responseType="arraybuffer",L.onError&&(E.onerror=function(A){L.onError(E.status)}),E.onreadystatechange=this.onStateChange.bind(this,w),E.onprogress=this.onProgress.bind(this,w),f.onHeadersReceived=L.onHeadersReceived,f.onDone=L.onDone,f.onError=L.onError,f.onProgress=L.onProgress,E.send(null),w}onProgress(L,E){var f;const w=this.pendingRequests[L];w&&((f=w.onProgress)==null||f.call(w,E))}onStateChange(L,E){var v,l,h;const w=this.pendingRequests[L];if(!w)return;const f=w.xhr;if(f.readyState>=2&&w.onHeadersReceived&&(w.onHeadersReceived(),delete w.onHeadersReceived),f.readyState!==4||!(L in this.pendingRequests))return;if(delete this.pendingRequests[L],f.status===0&&this.isHttp){(v=w.onError)==null||v.call(w,f.status);return}const A=f.status||q;if(!(A===q&&w.expectedStatus===Y)&&A!==w.expectedStatus){(l=w.onError)==null||l.call(w,f.status);return}const k=gt(f);if(A===Y){const I=f.getResponseHeader("Content-Range"),Q=/bytes (\d+)-(\d+)\/(\d+)/.exec(I);w.onDone({begin:parseInt(Q[1],10),chunk:k})}else k?w.onDone({begin:0,chunk:k}):(h=w.onError)==null||h.call(w,f.status)}getRequestXhr(L){return this.pendingRequests[L].xhr}isPendingRequest(L){return L in this.pendingRequests}abortRequest(L){const E=this.pendingRequests[L].xhr;delete this.pendingRequests[L],E.abort()}}class F{constructor(L){this._source=L,this._manager=new z(L.url,{httpHeaders:L.httpHeaders,withCredentials:L.withCredentials}),this._rangeChunkSize=L.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(L){const E=this._rangeRequestReaders.indexOf(L);E>=0&&this._rangeRequestReaders.splice(E,1)}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new g(this._manager,this._source),this._fullRequestReader}getRangeReader(L,E){const w=new H(this._manager,L,E);return w.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(w),w}cancelAllRequests(L){var E;(E=this._fullRequestReader)==null||E.cancel(L);for(const w of this._rangeRequestReaders.slice(0))w.cancel(L)}}o.PDFNetworkStream=F;class g{constructor(L,E){this._manager=L;const w={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=E.url,this._fullRequestId=L.requestFull(w),this._headersReceivedCapability=new r.PromiseCapability,this._disableRange=E.disableRange||!1,this._contentLength=E.length,this._rangeChunkSize=E.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const L=this._fullRequestId,E=this._manager.getRequestXhr(L),w=M=>E.getResponseHeader(M),{allowRangeRequests:f,suggestedLength:A}=(0,x.validateRangeRequestCapabilities)({getResponseHeader:w,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});f&&(this._isRangeSupported=!0),this._contentLength=A||this._contentLength,this._filename=(0,x.extractFilenameFromHeader)(w),this._isRangeSupported&&this._manager.abortRequest(L),this._headersReceivedCapability.resolve()}_onDone(L){if(L&&(this._requests.length>0?this._requests.shift().resolve({value:L.chunk,done:!1}):this._cachedChunks.push(L.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const E of this._requests)E.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(L){this._storedError=(0,x.createResponseStatusError)(L,this._url),this._headersReceivedCapability.reject(this._storedError);for(const E of this._requests)E.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(L){var E;(E=this.onProgress)==null||E.call(this,{loaded:L.loaded,total:L.lengthComputable?L.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const L=new r.PromiseCapability;return this._requests.push(L),L.promise}cancel(L){this._done=!0,this._headersReceivedCapability.reject(L);for(const E of this._requests)E.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class H{constructor(L,E,w){this._manager=L;const f={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=L.url,this._requestId=L.requestRange(E,w,f),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var L;(L=this.onClosed)==null||L.call(this,this)}_onDone(L){const E=L.chunk;this._requests.length>0?this._requests.shift().resolve({value:E,done:!1}):this._queuedChunk=E,this._done=!0;for(const w of this._requests)w.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(L){this._storedError=(0,x.createResponseStatusError)(L,this._url);for(const E of this._requests)E.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(L){var E;this.isStreamingSupported||(E=this.onProgress)==null||E.call(this,{loaded:L.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const E=this._queuedChunk;return this._queuedChunk=null,{value:E,done:!1}}if(this._done)return{value:void 0,done:!0};const L=new r.PromiseCapability;return this._requests.push(L),L.promise}cancel(L){this._done=!0;for(const E of this._requests)E.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(U,o,V)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PDFNodeStream=void 0;var r=V(1),x=V(20);const q=/^file:\/\/\/[a-zA-Z]:\//;function Y(w){const f=Se,A=f.parse(w);return A.protocol==="file:"||A.host?A:/^[a-z]:[/\\]/i.test(w)?f.parse(`file:///${w}`):(A.host||(A.protocol="file:"),A)}class gt{constructor(f){this.source=f,this.url=Y(f.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&f.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var f;return((f=this._fullRequestReader)==null?void 0:f._loaded)??0}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new L(this):new H(this),this._fullRequestReader}getRangeReader(f,A){if(A<=this._progressiveDataLength)return null;const M=this.isFsUrl?new E(this,f,A):new W(this,f,A);return this._rangeRequestReaders.push(M),M}cancelAllRequests(f){var A;(A=this._fullRequestReader)==null||A.cancel(f);for(const M of this._rangeRequestReaders.slice(0))M.cancel(f)}}o.PDFNodeStream=gt;class z{constructor(f){this._url=f.url,this._done=!1,this._storedError=null,this.onProgress=null;const A=f.source;this._contentLength=A.length,this._loaded=0,this._filename=null,this._disableRange=A.disableRange||!1,this._rangeChunkSize=A.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!A.disableStream,this._isRangeSupported=!A.disableRange,this._readableStream=null,this._readCapability=new r.PromiseCapability,this._headersCapability=new r.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var M;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const f=this._readableStream.read();return f===null?(this._readCapability=new r.PromiseCapability,this.read()):(this._loaded+=f.length,(M=this.onProgress)==null||M.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(f).buffer,done:!1})}cancel(f){if(!this._readableStream){this._error(f);return}this._readableStream.destroy(f)}_error(f){this._storedError=f,this._readCapability.resolve()}_setReadableStream(f){this._readableStream=f,f.on("readable",()=>{this._readCapability.resolve()}),f.on("end",()=>{f.destroy(),this._done=!0,this._readCapability.resolve()}),f.on("error",A=>{this._error(A)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new r.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class F{constructor(f){this._url=f.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new r.PromiseCapability;const A=f.source;this._isStreamingSupported=!A.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var M;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const f=this._readableStream.read();return f===null?(this._readCapability=new r.PromiseCapability,this.read()):(this._loaded+=f.length,(M=this.onProgress)==null||M.call(this,{loaded:this._loaded}),{value:new Uint8Array(f).buffer,done:!1})}cancel(f){if(!this._readableStream){this._error(f);return}this._readableStream.destroy(f)}_error(f){this._storedError=f,this._readCapability.resolve()}_setReadableStream(f){this._readableStream=f,f.on("readable",()=>{this._readCapability.resolve()}),f.on("end",()=>{f.destroy(),this._done=!0,this._readCapability.resolve()}),f.on("error",A=>{this._error(A)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function g(w,f){return{protocol:w.protocol,auth:w.auth,host:w.hostname,port:w.port,path:w.path,method:"GET",headers:f}}class H extends z{constructor(f){super(f);const A=M=>{if(M.statusCode===404){const h=new r.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=h,this._headersCapability.reject(h);return}this._headersCapability.resolve(),this._setReadableStream(M);const k=h=>this._readableStream.headers[h.toLowerCase()],{allowRangeRequests:v,suggestedLength:l}=(0,x.validateRangeRequestCapabilities)({getResponseHeader:k,isHttp:f.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=v,this._contentLength=l||this._contentLength,this._filename=(0,x.extractFilenameFromHeader)(k)};if(this._request=null,this._url.protocol==="http:"){const M=Se;this._request=M.request(g(this._url,f.httpHeaders),A)}else{const M=Se;this._request=M.request(g(this._url,f.httpHeaders),A)}this._request.on("error",M=>{this._storedError=M,this._headersCapability.reject(M)}),this._request.end()}}class W extends F{constructor(f,A,M){super(f),this._httpHeaders={};for(const v in f.httpHeaders){const l=f.httpHeaders[v];l!==void 0&&(this._httpHeaders[v]=l)}this._httpHeaders.Range=`bytes=${A}-${M-1}`;const k=v=>{if(v.statusCode===404){const l=new r.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=l;return}this._setReadableStream(v)};if(this._request=null,this._url.protocol==="http:"){const v=Se;this._request=v.request(g(this._url,this._httpHeaders),k)}else{const v=Se;this._request=v.request(g(this._url,this._httpHeaders),k)}this._request.on("error",v=>{this._storedError=v}),this._request.end()}}class L extends z{constructor(f){super(f);let A=decodeURIComponent(this._url.path);q.test(this._url.href)&&(A=A.replace(/^\//,""));const M=Se;M.lstat(A,(k,v)=>{if(k){k.code==="ENOENT"&&(k=new r.MissingPDFException(`Missing PDF "${A}".`)),this._storedError=k,this._headersCapability.reject(k);return}this._contentLength=v.size,this._setReadableStream(M.createReadStream(A)),this._headersCapability.resolve()})}}class E extends F{constructor(f,A,M){super(f);let k=decodeURIComponent(this._url.path);q.test(this._url.href)&&(k=k.replace(/^\//,""));const v=Se;this._setReadableStream(v.createReadStream(k,{start:A,end:M-1}))}}},(U,o,V)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.SVGGraphics=void 0;var r=V(6),x=V(1);const q={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},Y="http://www.w3.org/XML/1998/namespace",gt="http://www.w3.org/1999/xlink",z=["butt","round","square"],F=["miter","round","bevel"],g=function(v,l="",h=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!h)return URL.createObjectURL(new Blob([v],{type:l}));const I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let Q=`data:${l};base64,`;for(let J=0,_t=v.length;J<_t;J+=3){const at=v[J]&255,xt=v[J+1]&255,Ct=v[J+2]&255,j=at>>2,ut=(at&3)<<4|xt>>4,Et=J+1<_t?(xt&15)<<2|Ct>>6:64,yt=J+2<_t?Ct&63:64;Q+=I[j]+I[ut]+I[Et]+I[yt]}return Q},H=function(){const v=new Uint8Array([137,80,78,71,13,10,26,10]),l=12,h=new Int32Array(256);for(let Ct=0;Ct<256;Ct++){let j=Ct;for(let ut=0;ut<8;ut++)j=j&1?3988292384^j>>1&2147483647:j>>1&2147483647;h[Ct]=j}function I(Ct,j,ut){let Et=-1;for(let yt=j;yt<ut;yt++){const et=(Et^Ct[yt])&255,bt=h[et];Et=Et>>>8^bt}return Et^-1}function Q(Ct,j,ut,Et){let yt=Et;const et=j.length;ut[yt]=et>>24&255,ut[yt+1]=et>>16&255,ut[yt+2]=et>>8&255,ut[yt+3]=et&255,yt+=4,ut[yt]=Ct.charCodeAt(0)&255,ut[yt+1]=Ct.charCodeAt(1)&255,ut[yt+2]=Ct.charCodeAt(2)&255,ut[yt+3]=Ct.charCodeAt(3)&255,yt+=4,ut.set(j,yt),yt+=j.length;const bt=I(ut,Et+4,yt);ut[yt]=bt>>24&255,ut[yt+1]=bt>>16&255,ut[yt+2]=bt>>8&255,ut[yt+3]=bt&255}function J(Ct,j,ut){let Et=1,yt=0;for(let et=j;et<ut;++et)Et=(Et+(Ct[et]&255))%65521,yt=(yt+Et)%65521;return yt<<16|Et}function _t(Ct){if(!x.isNodeJS)return at(Ct);try{const j=parseInt(process.versions.node)>=8?Ct:Buffer.from(Ct),ut=Se.deflateSync(j,{level:9});return ut instanceof Uint8Array?ut:new Uint8Array(ut)}catch(j){(0,x.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+j)}return at(Ct)}function at(Ct){let j=Ct.length;const ut=65535,Et=Math.ceil(j/ut),yt=new Uint8Array(2+j+Et*5+4);let et=0;yt[et++]=120,yt[et++]=156;let bt=0;for(;j>ut;)yt[et++]=0,yt[et++]=255,yt[et++]=255,yt[et++]=0,yt[et++]=0,yt.set(Ct.subarray(bt,bt+ut),et),et+=ut,bt+=ut,j-=ut;yt[et++]=1,yt[et++]=j&255,yt[et++]=j>>8&255,yt[et++]=~j&65535&255,yt[et++]=(~j&65535)>>8&255,yt.set(Ct.subarray(bt),et),et+=Ct.length-bt;const Rt=J(Ct,0,Ct.length);return yt[et++]=Rt>>24&255,yt[et++]=Rt>>16&255,yt[et++]=Rt>>8&255,yt[et++]=Rt&255,yt}function xt(Ct,j,ut,Et){const yt=Ct.width,et=Ct.height;let bt,Rt,Ut;const $t=Ct.data;switch(j){case x.ImageKind.GRAYSCALE_1BPP:Rt=0,bt=1,Ut=yt+7>>3;break;case x.ImageKind.RGB_24BPP:Rt=2,bt=8,Ut=yt*3;break;case x.ImageKind.RGBA_32BPP:Rt=6,bt=8,Ut=yt*4;break;default:throw new Error("invalid format")}const T=new Uint8Array((1+Ut)*et);let i=0,a=0;for(let B=0;B<et;++B)T[i++]=0,T.set($t.subarray(a,a+Ut),i),a+=Ut,i+=Ut;if(j===x.ImageKind.GRAYSCALE_1BPP&&Et){i=0;for(let B=0;B<et;B++){i++;for(let lt=0;lt<Ut;lt++)T[i++]^=255}}const s=new Uint8Array([yt>>24&255,yt>>16&255,yt>>8&255,yt&255,et>>24&255,et>>16&255,et>>8&255,et&255,bt,Rt,0,0,0]),c=_t(T),d=v.length+l*3+s.length+c.length,b=new Uint8Array(d);let R=0;return b.set(v,R),R+=v.length,Q("IHDR",s,b,R),R+=l+s.length,Q("IDATA",c,b,R),R+=l+c.length,Q("IEND",new Uint8Array(0),b,R),g(b,"image/png",ut)}return function(j,ut,Et){const yt=j.kind===void 0?x.ImageKind.GRAYSCALE_1BPP:j.kind;return xt(j,yt,ut,Et)}}();class W{constructor(){this.fontSizeScale=1,this.fontWeight=q.fontWeight,this.fontSize=0,this.textMatrix=x.IDENTITY_MATRIX,this.fontMatrix=x.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=x.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=q.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(l,h){this.x=l,this.y=h}}function L(v){let l=[];const h=[];for(const I of v){if(I.fn==="save"){l.push({fnId:92,fn:"group",items:[]}),h.push(l),l=l.at(-1).items;continue}I.fn==="restore"?l=h.pop():l.push(I)}return l}function E(v){if(Number.isInteger(v))return v.toString();const l=v.toFixed(10);let h=l.length-1;if(l[h]!=="0")return l;do h--;while(l[h]==="0");return l.substring(0,l[h]==="."?h:h+1)}function w(v){if(v[4]===0&&v[5]===0){if(v[1]===0&&v[2]===0)return v[0]===1&&v[3]===1?"":`scale(${E(v[0])} ${E(v[3])})`;if(v[0]===v[3]&&v[1]===-v[2]){const l=Math.acos(v[0])*180/Math.PI;return`rotate(${E(l)})`}}else if(v[0]===1&&v[1]===0&&v[2]===0&&v[3]===1)return`translate(${E(v[4])} ${E(v[5])})`;return`matrix(${E(v[0])} ${E(v[1])} ${E(v[2])} ${E(v[3])} ${E(v[4])} ${E(v[5])})`}let f=0,A=0,M=0;class k{constructor(l,h,I=!1){(0,r.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new r.DOMSVGFactory,this.current=new W,this.transformMatrix=x.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=l,this.objs=h,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!I,this._operatorIdMapping=[];for(const Q in x.OPS)this._operatorIdMapping[x.OPS[Q]]=Q}getObject(l,h=null){return typeof l=="string"?l.startsWith("g_")?this.commonObjs.get(l):this.objs.get(l):h}save(){this.transformStack.push(this.transformMatrix);const l=this.current;this.extraStack.push(l),this.current=l.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(l){this.save(),this.executeOpTree(l),this.restore()}loadDependencies(l){const h=l.fnArray,I=l.argsArray;for(let Q=0,J=h.length;Q<J;Q++)if(h[Q]===x.OPS.dependency)for(const _t of I[Q]){const at=_t.startsWith("g_")?this.commonObjs:this.objs,xt=new Promise(Ct=>{at.get(_t,Ct)});this.current.dependencies.push(xt)}return Promise.all(this.current.dependencies)}transform(l,h,I,Q,J,_t){const at=[l,h,I,Q,J,_t];this.transformMatrix=x.Util.transform(this.transformMatrix,at),this.tgrp=null}getSVG(l,h){this.viewport=h;const I=this._initialize(h);return this.loadDependencies(l).then(()=>(this.transformMatrix=x.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(l)),I))}convertOpList(l){const h=this._operatorIdMapping,I=l.argsArray,Q=l.fnArray,J=[];for(let _t=0,at=Q.length;_t<at;_t++){const xt=Q[_t];J.push({fnId:xt,fn:h[xt],args:I[_t]})}return L(J)}executeOpTree(l){for(const h of l){const I=h.fn,Q=h.fnId,J=h.args;switch(Q|0){case x.OPS.beginText:this.beginText();break;case x.OPS.dependency:break;case x.OPS.setLeading:this.setLeading(J);break;case x.OPS.setLeadingMoveText:this.setLeadingMoveText(J[0],J[1]);break;case x.OPS.setFont:this.setFont(J);break;case x.OPS.showText:this.showText(J[0]);break;case x.OPS.showSpacedText:this.showText(J[0]);break;case x.OPS.endText:this.endText();break;case x.OPS.moveText:this.moveText(J[0],J[1]);break;case x.OPS.setCharSpacing:this.setCharSpacing(J[0]);break;case x.OPS.setWordSpacing:this.setWordSpacing(J[0]);break;case x.OPS.setHScale:this.setHScale(J[0]);break;case x.OPS.setTextMatrix:this.setTextMatrix(J[0],J[1],J[2],J[3],J[4],J[5]);break;case x.OPS.setTextRise:this.setTextRise(J[0]);break;case x.OPS.setTextRenderingMode:this.setTextRenderingMode(J[0]);break;case x.OPS.setLineWidth:this.setLineWidth(J[0]);break;case x.OPS.setLineJoin:this.setLineJoin(J[0]);break;case x.OPS.setLineCap:this.setLineCap(J[0]);break;case x.OPS.setMiterLimit:this.setMiterLimit(J[0]);break;case x.OPS.setFillRGBColor:this.setFillRGBColor(J[0],J[1],J[2]);break;case x.OPS.setStrokeRGBColor:this.setStrokeRGBColor(J[0],J[1],J[2]);break;case x.OPS.setStrokeColorN:this.setStrokeColorN(J);break;case x.OPS.setFillColorN:this.setFillColorN(J);break;case x.OPS.shadingFill:this.shadingFill(J[0]);break;case x.OPS.setDash:this.setDash(J[0],J[1]);break;case x.OPS.setRenderingIntent:this.setRenderingIntent(J[0]);break;case x.OPS.setFlatness:this.setFlatness(J[0]);break;case x.OPS.setGState:this.setGState(J[0]);break;case x.OPS.fill:this.fill();break;case x.OPS.eoFill:this.eoFill();break;case x.OPS.stroke:this.stroke();break;case x.OPS.fillStroke:this.fillStroke();break;case x.OPS.eoFillStroke:this.eoFillStroke();break;case x.OPS.clip:this.clip("nonzero");break;case x.OPS.eoClip:this.clip("evenodd");break;case x.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case x.OPS.paintImageXObject:this.paintImageXObject(J[0]);break;case x.OPS.paintInlineImageXObject:this.paintInlineImageXObject(J[0]);break;case x.OPS.paintImageMaskXObject:this.paintImageMaskXObject(J[0]);break;case x.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(J[0],J[1]);break;case x.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case x.OPS.closePath:this.closePath();break;case x.OPS.closeStroke:this.closeStroke();break;case x.OPS.closeFillStroke:this.closeFillStroke();break;case x.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case x.OPS.nextLine:this.nextLine();break;case x.OPS.transform:this.transform(J[0],J[1],J[2],J[3],J[4],J[5]);break;case x.OPS.constructPath:this.constructPath(J[0],J[1]);break;case x.OPS.endPath:this.endPath();break;case 92:this.group(h.items);break;default:(0,x.warn)(`Unimplemented operator ${I}`);break}}}setWordSpacing(l){this.current.wordSpacing=l}setCharSpacing(l){this.current.charSpacing=l}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(l,h,I,Q,J,_t){const at=this.current;at.textMatrix=at.lineMatrix=[l,h,I,Q,J,_t],at.textMatrixScale=Math.hypot(l,h),at.x=at.lineX=0,at.y=at.lineY=0,at.xcoords=[],at.ycoords=[],at.tspan=this.svgFactory.createElement("svg:tspan"),at.tspan.setAttributeNS(null,"font-family",at.fontFamily),at.tspan.setAttributeNS(null,"font-size",`${E(at.fontSize)}px`),at.tspan.setAttributeNS(null,"y",E(-at.y)),at.txtElement=this.svgFactory.createElement("svg:text"),at.txtElement.append(at.tspan)}beginText(){const l=this.current;l.x=l.lineX=0,l.y=l.lineY=0,l.textMatrix=x.IDENTITY_MATRIX,l.lineMatrix=x.IDENTITY_MATRIX,l.textMatrixScale=1,l.tspan=this.svgFactory.createElement("svg:tspan"),l.txtElement=this.svgFactory.createElement("svg:text"),l.txtgrp=this.svgFactory.createElement("svg:g"),l.xcoords=[],l.ycoords=[]}moveText(l,h){const I=this.current;I.x=I.lineX+=l,I.y=I.lineY+=h,I.xcoords=[],I.ycoords=[],I.tspan=this.svgFactory.createElement("svg:tspan"),I.tspan.setAttributeNS(null,"font-family",I.fontFamily),I.tspan.setAttributeNS(null,"font-size",`${E(I.fontSize)}px`),I.tspan.setAttributeNS(null,"y",E(-I.y))}showText(l){const h=this.current,I=h.font,Q=h.fontSize;if(Q===0)return;const J=h.fontSizeScale,_t=h.charSpacing,at=h.wordSpacing,xt=h.fontDirection,Ct=h.textHScale*xt,j=I.vertical,ut=j?1:-1,Et=I.defaultVMetrics,yt=Q*h.fontMatrix[0];let et=0;for(const Ut of l){if(Ut===null){et+=xt*at;continue}else if(typeof Ut=="number"){et+=ut*Ut*Q/1e3;continue}const $t=(Ut.isSpace?at:0)+_t,T=Ut.fontChar;let i,a,s=Ut.width;if(j){let d;const b=Ut.vmetric||Et;d=Ut.vmetric?b[1]:s*.5,d=-d*yt;const R=b[2]*yt;s=b?-b[0]:s,i=d/J,a=(et+R)/J}else i=et/J,a=0;(Ut.isInFont||I.missingFile)&&(h.xcoords.push(h.x+i),j&&h.ycoords.push(-h.y+a),h.tspan.textContent+=T);const c=j?s*yt-$t*xt:s*yt+$t*xt;et+=c}h.tspan.setAttributeNS(null,"x",h.xcoords.map(E).join(" ")),j?h.tspan.setAttributeNS(null,"y",h.ycoords.map(E).join(" ")):h.tspan.setAttributeNS(null,"y",E(-h.y)),j?h.y-=et:h.x+=et*Ct,h.tspan.setAttributeNS(null,"font-family",h.fontFamily),h.tspan.setAttributeNS(null,"font-size",`${E(h.fontSize)}px`),h.fontStyle!==q.fontStyle&&h.tspan.setAttributeNS(null,"font-style",h.fontStyle),h.fontWeight!==q.fontWeight&&h.tspan.setAttributeNS(null,"font-weight",h.fontWeight);const bt=h.textRenderingMode&x.TextRenderingMode.FILL_STROKE_MASK;if(bt===x.TextRenderingMode.FILL||bt===x.TextRenderingMode.FILL_STROKE?(h.fillColor!==q.fillColor&&h.tspan.setAttributeNS(null,"fill",h.fillColor),h.fillAlpha<1&&h.tspan.setAttributeNS(null,"fill-opacity",h.fillAlpha)):h.textRenderingMode===x.TextRenderingMode.ADD_TO_PATH?h.tspan.setAttributeNS(null,"fill","transparent"):h.tspan.setAttributeNS(null,"fill","none"),bt===x.TextRenderingMode.STROKE||bt===x.TextRenderingMode.FILL_STROKE){const Ut=1/(h.textMatrixScale||1);this._setStrokeAttributes(h.tspan,Ut)}let Rt=h.textMatrix;h.textRise!==0&&(Rt=Rt.slice(),Rt[5]+=h.textRise),h.txtElement.setAttributeNS(null,"transform",`${w(Rt)} scale(${E(Ct)}, -1)`),h.txtElement.setAttributeNS(Y,"xml:space","preserve"),h.txtElement.append(h.tspan),h.txtgrp.append(h.txtElement),this._ensureTransformGroup().append(h.txtElement)}setLeadingMoveText(l,h){this.setLeading(-h),this.moveText(l,h)}addFontStyle(l){if(!l.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const h=g(l.data,l.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${l.loadedName}"; src: url(${h}); }
`}setFont(l){const h=this.current,I=this.commonObjs.get(l[0]);let Q=l[1];h.font=I,this.embedFonts&&!I.missingFile&&!this.embeddedFonts[I.loadedName]&&(this.addFontStyle(I),this.embeddedFonts[I.loadedName]=I),h.fontMatrix=I.fontMatrix||x.FONT_IDENTITY_MATRIX;let J="normal";I.black?J="900":I.bold&&(J="bold");const _t=I.italic?"italic":"normal";Q<0?(Q=-Q,h.fontDirection=-1):h.fontDirection=1,h.fontSize=Q,h.fontFamily=I.loadedName,h.fontWeight=J,h.fontStyle=_t,h.tspan=this.svgFactory.createElement("svg:tspan"),h.tspan.setAttributeNS(null,"y",E(-h.y)),h.xcoords=[],h.ycoords=[]}endText(){var h;const l=this.current;l.textRenderingMode&x.TextRenderingMode.ADD_TO_PATH_FLAG&&((h=l.txtElement)!=null&&h.hasChildNodes())&&(l.element=l.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(l){l>0&&(this.current.lineWidth=l)}setLineCap(l){this.current.lineCap=z[l]}setLineJoin(l){this.current.lineJoin=F[l]}setMiterLimit(l){this.current.miterLimit=l}setStrokeAlpha(l){this.current.strokeAlpha=l}setStrokeRGBColor(l,h,I){this.current.strokeColor=x.Util.makeHexColor(l,h,I)}setFillAlpha(l){this.current.fillAlpha=l}setFillRGBColor(l,h,I){this.current.fillColor=x.Util.makeHexColor(l,h,I),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(l){this.current.strokeColor=this._makeColorN_Pattern(l)}setFillColorN(l){this.current.fillColor=this._makeColorN_Pattern(l)}shadingFill(l){const{width:h,height:I}=this.viewport,Q=x.Util.inverseTransform(this.transformMatrix),[J,_t,at,xt]=x.Util.getAxialAlignedBoundingBox([0,0,h,I],Q),Ct=this.svgFactory.createElement("svg:rect");Ct.setAttributeNS(null,"x",J),Ct.setAttributeNS(null,"y",_t),Ct.setAttributeNS(null,"width",at-J),Ct.setAttributeNS(null,"height",xt-_t),Ct.setAttributeNS(null,"fill",this._makeShadingPattern(l)),this.current.fillAlpha<1&&Ct.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(Ct)}_makeColorN_Pattern(l){return l[0]==="TilingPattern"?this._makeTilingPattern(l):this._makeShadingPattern(l)}_makeTilingPattern(l){const h=l[1],I=l[2],Q=l[3]||x.IDENTITY_MATRIX,[J,_t,at,xt]=l[4],Ct=l[5],j=l[6],ut=l[7],Et=`shading${M++}`,[yt,et,bt,Rt]=x.Util.normalizeRect([...x.Util.applyTransform([J,_t],Q),...x.Util.applyTransform([at,xt],Q)]),[Ut,$t]=x.Util.singularValueDecompose2dScale(Q),T=Ct*Ut,i=j*$t,a=this.svgFactory.createElement("svg:pattern");a.setAttributeNS(null,"id",Et),a.setAttributeNS(null,"patternUnits","userSpaceOnUse"),a.setAttributeNS(null,"width",T),a.setAttributeNS(null,"height",i),a.setAttributeNS(null,"x",`${yt}`),a.setAttributeNS(null,"y",`${et}`);const s=this.svg,c=this.transformMatrix,d=this.current.fillColor,b=this.current.strokeColor,R=this.svgFactory.create(bt-yt,Rt-et);if(this.svg=R,this.transformMatrix=Q,ut===2){const B=x.Util.makeHexColor(...h);this.current.fillColor=B,this.current.strokeColor=B}return this.executeOpTree(this.convertOpList(I)),this.svg=s,this.transformMatrix=c,this.current.fillColor=d,this.current.strokeColor=b,a.append(R.childNodes[0]),this.defs.append(a),`url(#${Et})`}_makeShadingPattern(l){switch(typeof l=="string"&&(l=this.objs.get(l)),l[0]){case"RadialAxial":const h=`shading${M++}`,I=l[3];let Q;switch(l[1]){case"axial":const J=l[4],_t=l[5];Q=this.svgFactory.createElement("svg:linearGradient"),Q.setAttributeNS(null,"id",h),Q.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),Q.setAttributeNS(null,"x1",J[0]),Q.setAttributeNS(null,"y1",J[1]),Q.setAttributeNS(null,"x2",_t[0]),Q.setAttributeNS(null,"y2",_t[1]);break;case"radial":const at=l[4],xt=l[5],Ct=l[6],j=l[7];Q=this.svgFactory.createElement("svg:radialGradient"),Q.setAttributeNS(null,"id",h),Q.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),Q.setAttributeNS(null,"cx",xt[0]),Q.setAttributeNS(null,"cy",xt[1]),Q.setAttributeNS(null,"r",j),Q.setAttributeNS(null,"fx",at[0]),Q.setAttributeNS(null,"fy",at[1]),Q.setAttributeNS(null,"fr",Ct);break;default:throw new Error(`Unknown RadialAxial type: ${l[1]}`)}for(const J of I){const _t=this.svgFactory.createElement("svg:stop");_t.setAttributeNS(null,"offset",J[0]),_t.setAttributeNS(null,"stop-color",J[1]),Q.append(_t)}return this.defs.append(Q),`url(#${h})`;case"Mesh":return(0,x.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${l[0]}`)}}setDash(l,h){this.current.dashArray=l,this.current.dashPhase=h}constructPath(l,h){const I=this.current;let Q=I.x,J=I.y,_t=[],at=0;for(const xt of l)switch(xt|0){case x.OPS.rectangle:Q=h[at++],J=h[at++];const Ct=h[at++],j=h[at++],ut=Q+Ct,Et=J+j;_t.push("M",E(Q),E(J),"L",E(ut),E(J),"L",E(ut),E(Et),"L",E(Q),E(Et),"Z");break;case x.OPS.moveTo:Q=h[at++],J=h[at++],_t.push("M",E(Q),E(J));break;case x.OPS.lineTo:Q=h[at++],J=h[at++],_t.push("L",E(Q),E(J));break;case x.OPS.curveTo:Q=h[at+4],J=h[at+5],_t.push("C",E(h[at]),E(h[at+1]),E(h[at+2]),E(h[at+3]),E(Q),E(J)),at+=6;break;case x.OPS.curveTo2:_t.push("C",E(Q),E(J),E(h[at]),E(h[at+1]),E(h[at+2]),E(h[at+3])),Q=h[at+2],J=h[at+3],at+=4;break;case x.OPS.curveTo3:Q=h[at+2],J=h[at+3],_t.push("C",E(h[at]),E(h[at+1]),E(Q),E(J),E(Q),E(J)),at+=4;break;case x.OPS.closePath:_t.push("Z");break}_t=_t.join(" "),I.path&&l.length>0&&l[0]!==x.OPS.rectangle&&l[0]!==x.OPS.moveTo?_t=I.path.getAttributeNS(null,"d")+_t:(I.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(I.path)),I.path.setAttributeNS(null,"d",_t),I.path.setAttributeNS(null,"fill","none"),I.element=I.path,I.setCurrentPoint(Q,J)}endPath(){const l=this.current;if(l.path=null,!this.pendingClip)return;if(!l.element){this.pendingClip=null;return}const h=`clippath${f++}`,I=this.svgFactory.createElement("svg:clipPath");I.setAttributeNS(null,"id",h),I.setAttributeNS(null,"transform",w(this.transformMatrix));const Q=l.element.cloneNode(!0);if(this.pendingClip==="evenodd"?Q.setAttributeNS(null,"clip-rule","evenodd"):Q.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,I.append(Q),this.defs.append(I),l.activeClipUrl){l.clipGroup=null;for(const J of this.extraStack)J.clipGroup=null;I.setAttributeNS(null,"clip-path",l.activeClipUrl)}l.activeClipUrl=`url(#${h})`,this.tgrp=null}clip(l){this.pendingClip=l}closePath(){const l=this.current;if(l.path){const h=`${l.path.getAttributeNS(null,"d")}Z`;l.path.setAttributeNS(null,"d",h)}}setLeading(l){this.current.leading=-l}setTextRise(l){this.current.textRise=l}setTextRenderingMode(l){this.current.textRenderingMode=l}setHScale(l){this.current.textHScale=l/100}setRenderingIntent(l){}setFlatness(l){}setGState(l){for(const[h,I]of l)switch(h){case"LW":this.setLineWidth(I);break;case"LC":this.setLineCap(I);break;case"LJ":this.setLineJoin(I);break;case"ML":this.setMiterLimit(I);break;case"D":this.setDash(I[0],I[1]);break;case"RI":this.setRenderingIntent(I);break;case"FL":this.setFlatness(I);break;case"Font":this.setFont(I);break;case"CA":this.setStrokeAlpha(I);break;case"ca":this.setFillAlpha(I);break;default:(0,x.warn)(`Unimplemented graphic state operator ${h}`);break}}fill(){const l=this.current;l.element&&(l.element.setAttributeNS(null,"fill",l.fillColor),l.element.setAttributeNS(null,"fill-opacity",l.fillAlpha),this.endPath())}stroke(){const l=this.current;l.element&&(this._setStrokeAttributes(l.element),l.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(l,h=1){const I=this.current;let Q=I.dashArray;h!==1&&Q.length>0&&(Q=Q.map(function(J){return h*J})),l.setAttributeNS(null,"stroke",I.strokeColor),l.setAttributeNS(null,"stroke-opacity",I.strokeAlpha),l.setAttributeNS(null,"stroke-miterlimit",E(I.miterLimit)),l.setAttributeNS(null,"stroke-linecap",I.lineCap),l.setAttributeNS(null,"stroke-linejoin",I.lineJoin),l.setAttributeNS(null,"stroke-width",E(h*I.lineWidth)+"px"),l.setAttributeNS(null,"stroke-dasharray",Q.map(E).join(" ")),l.setAttributeNS(null,"stroke-dashoffset",E(h*I.dashPhase)+"px")}eoFill(){var l;(l=this.current.element)==null||l.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var l;(l=this.current.element)==null||l.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const l=this.svgFactory.createElement("svg:rect");l.setAttributeNS(null,"x","0"),l.setAttributeNS(null,"y","0"),l.setAttributeNS(null,"width","1px"),l.setAttributeNS(null,"height","1px"),l.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(l)}paintImageXObject(l){const h=this.getObject(l);if(!h){(0,x.warn)(`Dependent image with object ID ${l} is not ready yet`);return}this.paintInlineImageXObject(h)}paintInlineImageXObject(l,h){const I=l.width,Q=l.height,J=H(l,this.forceDataSchema,!!h),_t=this.svgFactory.createElement("svg:rect");_t.setAttributeNS(null,"x","0"),_t.setAttributeNS(null,"y","0"),_t.setAttributeNS(null,"width",E(I)),_t.setAttributeNS(null,"height",E(Q)),this.current.element=_t,this.clip("nonzero");const at=this.svgFactory.createElement("svg:image");at.setAttributeNS(gt,"xlink:href",J),at.setAttributeNS(null,"x","0"),at.setAttributeNS(null,"y",E(-Q)),at.setAttributeNS(null,"width",E(I)+"px"),at.setAttributeNS(null,"height",E(Q)+"px"),at.setAttributeNS(null,"transform",`scale(${E(1/I)} ${E(-1/Q)})`),h?h.append(at):this._ensureTransformGroup().append(at)}paintImageMaskXObject(l){const h=this.getObject(l.data,l);if(h.bitmap){(0,x.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const I=this.current,Q=h.width,J=h.height,_t=I.fillColor;I.maskId=`mask${A++}`;const at=this.svgFactory.createElement("svg:mask");at.setAttributeNS(null,"id",I.maskId);const xt=this.svgFactory.createElement("svg:rect");xt.setAttributeNS(null,"x","0"),xt.setAttributeNS(null,"y","0"),xt.setAttributeNS(null,"width",E(Q)),xt.setAttributeNS(null,"height",E(J)),xt.setAttributeNS(null,"fill",_t),xt.setAttributeNS(null,"mask",`url(#${I.maskId})`),this.defs.append(at),this._ensureTransformGroup().append(xt),this.paintInlineImageXObject(h,at)}paintFormXObjectBegin(l,h){if(Array.isArray(l)&&l.length===6&&this.transform(l[0],l[1],l[2],l[3],l[4],l[5]),h){const I=h[2]-h[0],Q=h[3]-h[1],J=this.svgFactory.createElement("svg:rect");J.setAttributeNS(null,"x",h[0]),J.setAttributeNS(null,"y",h[1]),J.setAttributeNS(null,"width",E(I)),J.setAttributeNS(null,"height",E(Q)),this.current.element=J,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(l){const h=this.svgFactory.create(l.width,l.height),I=this.svgFactory.createElement("svg:defs");h.append(I),this.defs=I;const Q=this.svgFactory.createElement("svg:g");return Q.setAttributeNS(null,"transform",w(l.transform)),h.append(Q),this.svg=Q,h}_ensureClipGroup(){if(!this.current.clipGroup){const l=this.svgFactory.createElement("svg:g");l.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(l),this.current.clipGroup=l}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",w(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}o.SVGGraphics=k},(U,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.XfaText=void 0;class V{static textContent(x){const q=[],Y={items:q,styles:Object.create(null)};function gt(z){var H;if(!z)return;let F=null;const g=z.name;if(g==="#text")F=z.value;else if(V.shouldBuildText(g))(H=z==null?void 0:z.attributes)!=null&&H.textContent?F=z.attributes.textContent:z.value&&(F=z.value);else return;if(F!==null&&q.push({str:F}),!!z.children)for(const W of z.children)gt(W)}return gt(x),Y}static shouldBuildText(x){return!(x==="textarea"||x==="input"||x==="option"||x==="select")}}o.XfaText=V},(U,o,V)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TextLayerRenderTask=void 0,o.renderTextLayer=w,o.updateTextLayer=f;var r=V(1),x=V(6);const q=1e5,Y=30,gt=.8,z=new Map;function F(A,M){let k;if(M&&r.FeatureTest.isOffscreenCanvasSupported)k=new OffscreenCanvas(A,A).getContext("2d",{alpha:!1});else{const v=document.createElement("canvas");v.width=v.height=A,k=v.getContext("2d",{alpha:!1})}return k}function g(A,M){const k=z.get(A);if(k)return k;const v=F(Y,M);v.font=`${Y}px ${A}`;const l=v.measureText("");let h=l.fontBoundingBoxAscent,I=Math.abs(l.fontBoundingBoxDescent);if(h){const J=h/(h+I);return z.set(A,J),v.canvas.width=v.canvas.height=0,J}v.strokeStyle="red",v.clearRect(0,0,Y,Y),v.strokeText("g",0,0);let Q=v.getImageData(0,0,Y,Y).data;I=0;for(let J=Q.length-1-3;J>=0;J-=4)if(Q[J]>0){I=Math.ceil(J/4/Y);break}v.clearRect(0,0,Y,Y),v.strokeText("A",0,Y),Q=v.getImageData(0,0,Y,Y).data,h=0;for(let J=0,_t=Q.length;J<_t;J+=4)if(Q[J]>0){h=Y-Math.floor(J/4/Y);break}if(v.canvas.width=v.canvas.height=0,h){const J=h/(h+I);return z.set(A,J),J}return z.set(A,gt),gt}function H(A,M,k){const v=document.createElement("span"),l={angle:0,canvasWidth:0,hasText:M.str!=="",hasEOL:M.hasEOL,fontSize:0};A._textDivs.push(v);const h=r.Util.transform(A._transform,M.transform);let I=Math.atan2(h[1],h[0]);const Q=k[M.fontName];Q.vertical&&(I+=Math.PI/2);const J=Math.hypot(h[2],h[3]),_t=J*g(Q.fontFamily,A._isOffscreenCanvasSupported);let at,xt;I===0?(at=h[4],xt=h[5]-_t):(at=h[4]+_t*Math.sin(I),xt=h[5]-_t*Math.cos(I));const Ct="calc(var(--scale-factor)*",j=v.style;A._container===A._rootContainer?(j.left=`${(100*at/A._pageWidth).toFixed(2)}%`,j.top=`${(100*xt/A._pageHeight).toFixed(2)}%`):(j.left=`${Ct}${at.toFixed(2)}px)`,j.top=`${Ct}${xt.toFixed(2)}px)`),j.fontSize=`${Ct}${J.toFixed(2)}px)`,j.fontFamily=Q.fontFamily,l.fontSize=J,v.setAttribute("role","presentation"),v.textContent=M.str,v.dir=M.dir,A._fontInspectorEnabled&&(v.dataset.fontName=M.fontName),I!==0&&(l.angle=I*(180/Math.PI));let ut=!1;if(M.str.length>1)ut=!0;else if(M.str!==" "&&M.transform[0]!==M.transform[3]){const Et=Math.abs(M.transform[0]),yt=Math.abs(M.transform[3]);Et!==yt&&Math.max(Et,yt)/Math.min(Et,yt)>1.5&&(ut=!0)}ut&&(l.canvasWidth=Q.vertical?M.height:M.width),A._textDivProperties.set(v,l),A._isReadableStream&&A._layoutText(v)}function W(A){const{div:M,scale:k,properties:v,ctx:l,prevFontSize:h,prevFontFamily:I}=A,{style:Q}=M;let J="";if(v.canvasWidth!==0&&v.hasText){const{fontFamily:_t}=Q,{canvasWidth:at,fontSize:xt}=v;(h!==xt||I!==_t)&&(l.font=`${xt*k}px ${_t}`,A.prevFontSize=xt,A.prevFontFamily=_t);const{width:Ct}=l.measureText(M.textContent);Ct>0&&(J=`scaleX(${at*k/Ct})`)}v.angle!==0&&(J=`rotate(${v.angle}deg) ${J}`),J.length>0&&(Q.transform=J)}function L(A){if(A._canceled)return;const M=A._textDivs,k=A._capability;if(M.length>q){k.resolve();return}if(!A._isReadableStream)for(const l of M)A._layoutText(l);k.resolve()}class E{constructor({textContentSource:M,container:k,viewport:v,textDivs:l,textDivProperties:h,textContentItemsStr:I,isOffscreenCanvasSupported:Q}){var Ct;this._textContentSource=M,this._isReadableStream=M instanceof ReadableStream,this._container=this._rootContainer=k,this._textDivs=l||[],this._textContentItemsStr=I||[],this._isOffscreenCanvasSupported=Q,this._fontInspectorEnabled=!!((Ct=globalThis.FontInspector)!=null&&Ct.enabled),this._reader=null,this._textDivProperties=h||new WeakMap,this._canceled=!1,this._capability=new r.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:v.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:F(0,Q)};const{pageWidth:J,pageHeight:_t,pageX:at,pageY:xt}=v.rawDims;this._transform=[1,0,0,-1,-at,xt+_t],this._pageWidth=J,this._pageHeight=_t,(0,x.setLayerDimensions)(k,v),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new r.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new r.AbortException("TextLayer task cancelled."))}_processItems(M,k){for(const v of M){if(v.str===void 0){if(v.type==="beginMarkedContentProps"||v.type==="beginMarkedContent"){const l=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),v.id!==null&&this._container.setAttribute("id",`${v.id}`),l.append(this._container)}else v.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(v.str),H(this,v,k)}}_layoutText(M){const k=this._layoutTextParams.properties=this._textDivProperties.get(M);if(this._layoutTextParams.div=M,W(this._layoutTextParams),k.hasText&&this._container.append(M),k.hasEOL){const v=document.createElement("br");v.setAttribute("role","presentation"),this._container.append(v)}}_render(){const M=new r.PromiseCapability;let k=Object.create(null);if(this._isReadableStream){const v=()=>{this._reader.read().then(({value:l,done:h})=>{if(h){M.resolve();return}Object.assign(k,l.styles),this._processItems(l.items,k),v()},M.reject)};this._reader=this._textContentSource.getReader(),v()}else if(this._textContentSource){const{items:v,styles:l}=this._textContentSource;this._processItems(v,l),M.resolve()}else throw new Error('No "textContentSource" parameter specified.');M.promise.then(()=>{k=null,L(this)},this._capability.reject)}}o.TextLayerRenderTask=E;function w(A){!A.textContentSource&&(A.textContent||A.textContentStream)&&((0,x.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),A.textContentSource=A.textContent||A.textContentStream);const{container:M,viewport:k}=A,v=getComputedStyle(M),l=v.getPropertyValue("visibility"),h=parseFloat(v.getPropertyValue("--scale-factor"));l==="visible"&&(!h||Math.abs(h-k.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const I=new E(A);return I._render(),I}function f({container:A,viewport:M,textDivs:k,textDivProperties:v,isOffscreenCanvasSupported:l,mustRotate:h=!0,mustRescale:I=!0}){if(h&&(0,x.setLayerDimensions)(A,{rotation:M.rotation}),I){const Q=F(0,l),_t={prevFontSize:null,prevFontFamily:null,div:null,scale:M.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:Q};for(const at of k)_t.properties=v.get(at),_t.div=at,W(_t)}}},(U,o,V)=>{var g,H,W,L,E,w,f,A,M,k,v,os,h,vi,Q,ls,_t,cs;Object.defineProperty(o,"__esModule",{value:!0}),o.AnnotationEditorLayer=void 0;var r=V(1),x=V(4),q=V(28),Y=V(33),gt=V(6),z=V(34);const xt=class xt{constructor({uiManager:j,pageIndex:ut,div:Et,accessibilityManager:yt,annotationLayer:et,viewport:bt,l10n:Rt}){$(this,v);$(this,h);$(this,Q);$(this,_t);$(this,g,void 0);$(this,H,!1);$(this,W,null);$(this,L,this.pointerup.bind(this));$(this,E,this.pointerdown.bind(this));$(this,w,new Map);$(this,f,!1);$(this,A,!1);$(this,M,!1);$(this,k,void 0);const Ut=[q.FreeTextEditor,Y.InkEditor,z.StampEditor];if(!xt._initialized){xt._initialized=!0;for(const $t of Ut)$t.initialize(Rt)}j.registerEditorTypes(Ut),ot(this,k,j),this.pageIndex=ut,this.div=Et,ot(this,g,yt),ot(this,W,et),this.viewport=bt,t(this,k).addLayer(this)}get isEmpty(){return t(this,w).size===0}updateToolbar(j){t(this,k).updateToolbar(j)}updateMode(j=t(this,k).getMode()){Z(this,_t,cs).call(this),j===r.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),j!==r.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",j===r.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",j===r.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",j===r.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(j){if(!j&&t(this,k).getMode()!==r.AnnotationEditorType.INK)return;if(!j){for(const Et of t(this,w).values())if(Et.isEmpty()){Et.setInBackground();return}}Z(this,h,vi).call(this,{offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(j){t(this,k).setEditingState(j)}addCommands(j){t(this,k).addCommands(j)}enable(){this.div.style.pointerEvents="auto";const j=new Set;for(const Et of t(this,w).values())Et.enableEditing(),Et.annotationElementId&&j.add(Et.annotationElementId);if(!t(this,W))return;const ut=t(this,W).getEditableAnnotations();for(const Et of ut){if(Et.hide(),t(this,k).isDeletedAnnotationElement(Et.data.id)||j.has(Et.data.id))continue;const yt=this.deserialize(Et);yt&&(this.addOrRebuild(yt),yt.enableEditing())}}disable(){var ut;ot(this,M,!0),this.div.style.pointerEvents="none";const j=new Set;for(const Et of t(this,w).values()){if(Et.disableEditing(),!Et.annotationElementId||Et.serialize()!==null){j.add(Et.annotationElementId);continue}(ut=this.getEditableAnnotation(Et.annotationElementId))==null||ut.show(),Et.remove()}if(t(this,W)){const Et=t(this,W).getEditableAnnotations();for(const yt of Et){const{id:et}=yt.data;j.has(et)||t(this,k).isDeletedAnnotationElement(et)||yt.show()}}Z(this,_t,cs).call(this),this.isEmpty&&(this.div.hidden=!0),ot(this,M,!1)}getEditableAnnotation(j){var ut;return((ut=t(this,W))==null?void 0:ut.getEditableAnnotation(j))||null}setActiveEditor(j){t(this,k).getActive()!==j&&t(this,k).setActiveEditor(j)}enableClick(){this.div.addEventListener("pointerdown",t(this,E)),this.div.addEventListener("pointerup",t(this,L))}disableClick(){this.div.removeEventListener("pointerdown",t(this,E)),this.div.removeEventListener("pointerup",t(this,L))}attach(j){t(this,w).set(j.id,j);const{annotationElementId:ut}=j;ut&&t(this,k).isDeletedAnnotationElement(ut)&&t(this,k).removeDeletedAnnotationElement(j)}detach(j){var ut;t(this,w).delete(j.id),(ut=t(this,g))==null||ut.removePointerInTextLayer(j.contentDiv),!t(this,M)&&j.annotationElementId&&t(this,k).addDeletedAnnotationElement(j)}remove(j){this.detach(j),t(this,k).removeEditor(j),j.div.contains(document.activeElement)&&setTimeout(()=>{t(this,k).focusMainContainer()},0),j.div.remove(),j.isAttachedToDOM=!1,t(this,A)||this.addInkEditorIfNeeded(!1)}changeParent(j){var ut;j.parent!==this&&(j.annotationElementId&&(t(this,k).addDeletedAnnotationElement(j.annotationElementId),x.AnnotationEditor.deleteAnnotationElement(j),j.annotationElementId=null),this.attach(j),(ut=j.parent)==null||ut.detach(j),j.setParent(this),j.div&&j.isAttachedToDOM&&(j.div.remove(),this.div.append(j.div)))}add(j){if(this.changeParent(j),t(this,k).addEditor(j),this.attach(j),!j.isAttachedToDOM){const ut=j.render();this.div.append(ut),j.isAttachedToDOM=!0}j.fixAndSetPosition(),j.onceAdded(),t(this,k).addToAnnotationStorage(j)}moveEditorInDOM(j){var Et;if(!j.isAttachedToDOM)return;const{activeElement:ut}=document;j.div.contains(ut)&&(j._focusEventsAllowed=!1,setTimeout(()=>{j.div.contains(document.activeElement)?j._focusEventsAllowed=!0:(j.div.addEventListener("focusin",()=>{j._focusEventsAllowed=!0},{once:!0}),ut.focus())},0)),j._structTreeParentId=(Et=t(this,g))==null?void 0:Et.moveElementInDOM(this.div,j.div,j.contentDiv,!0)}addOrRebuild(j){j.needsToBeRebuilt()?j.rebuild():this.add(j)}addUndoableEditor(j){const ut=()=>j._uiManager.rebuild(j),Et=()=>{j.remove()};this.addCommands({cmd:ut,undo:Et,mustExec:!1})}getNextId(){return t(this,k).getId()}pasteEditor(j,ut){t(this,k).updateToolbar(j),t(this,k).updateMode(j);const{offsetX:Et,offsetY:yt}=Z(this,Q,ls).call(this),et=this.getNextId(),bt=Z(this,v,os).call(this,{parent:this,id:et,x:Et,y:yt,uiManager:t(this,k),isCentered:!0,...ut});bt&&this.add(bt)}deserialize(j){switch(j.annotationType??j.annotationEditorType){case r.AnnotationEditorType.FREETEXT:return q.FreeTextEditor.deserialize(j,this,t(this,k));case r.AnnotationEditorType.INK:return Y.InkEditor.deserialize(j,this,t(this,k));case r.AnnotationEditorType.STAMP:return z.StampEditor.deserialize(j,this,t(this,k))}return null}addNewEditor(){Z(this,h,vi).call(this,Z(this,Q,ls).call(this),!0)}setSelected(j){t(this,k).setSelected(j)}toggleSelected(j){t(this,k).toggleSelected(j)}isSelected(j){return t(this,k).isSelected(j)}unselect(j){t(this,k).unselect(j)}pointerup(j){const{isMac:ut}=r.FeatureTest.platform;if(!(j.button!==0||j.ctrlKey&&ut)&&j.target===this.div&&t(this,f)){if(ot(this,f,!1),!t(this,H)){ot(this,H,!0);return}if(t(this,k).getMode()===r.AnnotationEditorType.STAMP){t(this,k).unselectAll();return}Z(this,h,vi).call(this,j,!1)}}pointerdown(j){if(t(this,f)){ot(this,f,!1);return}const{isMac:ut}=r.FeatureTest.platform;if(j.button!==0||j.ctrlKey&&ut||j.target!==this.div)return;ot(this,f,!0);const Et=t(this,k).getActive();ot(this,H,!Et||Et.isEmpty())}findNewParent(j,ut,Et){const yt=t(this,k).findParent(ut,Et);return yt===null||yt===this?!1:(yt.changeParent(j),!0)}destroy(){var j,ut;((j=t(this,k).getActive())==null?void 0:j.parent)===this&&(t(this,k).commitOrRemove(),t(this,k).setActiveEditor(null));for(const Et of t(this,w).values())(ut=t(this,g))==null||ut.removePointerInTextLayer(Et.contentDiv),Et.setParent(null),Et.isAttachedToDOM=!1,Et.div.remove();this.div=null,t(this,w).clear(),t(this,k).removeLayer(this)}render({viewport:j}){this.viewport=j,(0,gt.setLayerDimensions)(this.div,j);for(const ut of t(this,k).getEditors(this.pageIndex))this.add(ut);this.updateMode()}update({viewport:j}){t(this,k).commitOrRemove(),this.viewport=j,(0,gt.setLayerDimensions)(this.div,{rotation:j.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:j,pageHeight:ut}=this.viewport.rawDims;return[j,ut]}};g=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakMap,E=new WeakMap,w=new WeakMap,f=new WeakMap,A=new WeakMap,M=new WeakMap,k=new WeakMap,v=new WeakSet,os=function(j){switch(t(this,k).getMode()){case r.AnnotationEditorType.FREETEXT:return new q.FreeTextEditor(j);case r.AnnotationEditorType.INK:return new Y.InkEditor(j);case r.AnnotationEditorType.STAMP:return new z.StampEditor(j)}return null},h=new WeakSet,vi=function(j,ut){const Et=this.getNextId(),yt=Z(this,v,os).call(this,{parent:this,id:Et,x:j.offsetX,y:j.offsetY,uiManager:t(this,k),isCentered:ut});return yt&&this.add(yt),yt},Q=new WeakSet,ls=function(){const{x:j,y:ut,width:Et,height:yt}=this.div.getBoundingClientRect(),et=Math.max(0,j),bt=Math.max(0,ut),Rt=Math.min(window.innerWidth,j+Et),Ut=Math.min(window.innerHeight,ut+yt),$t=(et+Rt)/2-j,T=(bt+Ut)/2-ut,[i,a]=this.viewport.rotation%180===0?[$t,T]:[T,$t];return{offsetX:i,offsetY:a}},_t=new WeakSet,cs=function(){ot(this,A,!0);for(const j of t(this,w).values())j.isEmpty()&&j.remove();ot(this,A,!1)},oe(xt,"_initialized",!1);let F=xt;o.AnnotationEditorLayer=F},(U,o,V)=>{var z,F,g,H,W,L,E,w,f,A,An,k,yn,l,vn,I,Ke,J,hs,at,_n,Ct,ds;Object.defineProperty(o,"__esModule",{value:!0}),o.FreeTextEditor=void 0;var r=V(1),x=V(5),q=V(4),Y=V(29);const ut=class ut extends q.AnnotationEditor{constructor(et){super({...et,name:"freeTextEditor"});$(this,A);$(this,k);$(this,l);$(this,I);$(this,J);$(this,at);$(this,Ct);$(this,z,this.editorDivBlur.bind(this));$(this,F,this.editorDivFocus.bind(this));$(this,g,this.editorDivInput.bind(this));$(this,H,this.editorDivKeydown.bind(this));$(this,W,void 0);$(this,L,"");$(this,E,`${this.id}-editor`);$(this,w,void 0);$(this,f,null);ot(this,W,et.color||ut._defaultColor||q.AnnotationEditor._defaultLineColor),ot(this,w,et.fontSize||ut._defaultFontSize)}static get _keyboardManager(){const et=ut.prototype,bt=$t=>$t.isEmpty(),Rt=x.AnnotationEditorUIManager.TRANSLATE_SMALL,Ut=x.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,r.shadow)(this,"_keyboardManager",new x.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],et.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],et.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],et._translateEmpty,{args:[-Rt,0],checker:bt}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],et._translateEmpty,{args:[-Ut,0],checker:bt}],[["ArrowRight","mac+ArrowRight"],et._translateEmpty,{args:[Rt,0],checker:bt}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],et._translateEmpty,{args:[Ut,0],checker:bt}],[["ArrowUp","mac+ArrowUp"],et._translateEmpty,{args:[0,-Rt],checker:bt}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],et._translateEmpty,{args:[0,-Ut],checker:bt}],[["ArrowDown","mac+ArrowDown"],et._translateEmpty,{args:[0,Rt],checker:bt}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],et._translateEmpty,{args:[0,Ut],checker:bt}]]))}static initialize(et){q.AnnotationEditor.initialize(et,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const bt=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(bt.getPropertyValue("--freetext-padding"))}static updateDefaultParams(et,bt){switch(et){case r.AnnotationEditorParamsType.FREETEXT_SIZE:ut._defaultFontSize=bt;break;case r.AnnotationEditorParamsType.FREETEXT_COLOR:ut._defaultColor=bt;break}}updateParams(et,bt){switch(et){case r.AnnotationEditorParamsType.FREETEXT_SIZE:Z(this,A,An).call(this,bt);break;case r.AnnotationEditorParamsType.FREETEXT_COLOR:Z(this,k,yn).call(this,bt);break}}static get defaultPropertiesToUpdate(){return[[r.AnnotationEditorParamsType.FREETEXT_SIZE,ut._defaultFontSize],[r.AnnotationEditorParamsType.FREETEXT_COLOR,ut._defaultColor||q.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[r.AnnotationEditorParamsType.FREETEXT_SIZE,t(this,w)],[r.AnnotationEditorParamsType.FREETEXT_COLOR,t(this,W)]]}_translateEmpty(et,bt){this._uiManager.translateSelectedEditors(et,bt,!0)}getInitialTranslation(){const et=this.parentScale;return[-ut._internalPadding*et,-(ut._internalPadding+t(this,w))*et]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(r.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",t(this,H)),this.editorDiv.addEventListener("focus",t(this,F)),this.editorDiv.addEventListener("blur",t(this,z)),this.editorDiv.addEventListener("input",t(this,g)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",t(this,E)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",t(this,H)),this.editorDiv.removeEventListener("focus",t(this,F)),this.editorDiv.removeEventListener("blur",t(this,z)),this.editorDiv.removeEventListener("input",t(this,g)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(et){this._focusEventsAllowed&&(super.focusin(et),et.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var et;if(this.width){Z(this,Ct,ds).call(this);return}this.enableEditMode(),this.editorDiv.focus(),(et=this._initialOptions)!=null&&et.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const et=t(this,L),bt=ot(this,L,Z(this,l,vn).call(this).trimEnd());if(et===bt)return;const Rt=Ut=>{if(ot(this,L,Ut),!Ut){this.remove();return}Z(this,J,hs).call(this),this._uiManager.rebuild(this),Z(this,I,Ke).call(this)};this.addCommands({cmd:()=>{Rt(bt)},undo:()=>{Rt(et)},mustExec:!1}),Z(this,I,Ke).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(et){this.enterInEditMode()}keydown(et){et.target===this.div&&et.key==="Enter"&&(this.enterInEditMode(),et.preventDefault())}editorDivKeydown(et){ut._keyboardManager.exec(this,et)}editorDivFocus(et){this.isEditing=!0}editorDivBlur(et){this.isEditing=!1}editorDivInput(et){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let et,bt;this.width&&(et=this.x,bt=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",t(this,E)),this.enableEditing(),q.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(Ut=>{var $t;return($t=this.editorDiv)==null?void 0:$t.setAttribute("aria-label",Ut)}),q.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(Ut=>{var $t;return($t=this.editorDiv)==null?void 0:$t.setAttribute("default-content",Ut)}),this.editorDiv.contentEditable=!0;const{style:Rt}=this.editorDiv;if(Rt.fontSize=`calc(${t(this,w)}px * var(--scale-factor))`,Rt.color=t(this,W),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,x.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[Ut,$t]=this.parentDimensions;if(this.annotationElementId){const{position:T}=t(this,f);let[i,a]=this.getInitialTranslation();[i,a]=this.pageTranslationToScreen(i,a);const[s,c]=this.pageDimensions,[d,b]=this.pageTranslation;let R,B;switch(this.rotation){case 0:R=et+(T[0]-d)/s,B=bt+this.height-(T[1]-b)/c;break;case 90:R=et+(T[0]-d)/s,B=bt-(T[1]-b)/c,[i,a]=[a,-i];break;case 180:R=et-this.width+(T[0]-d)/s,B=bt-(T[1]-b)/c,[i,a]=[-i,-a];break;case 270:R=et+(T[0]-d-this.height*c)/s,B=bt+(T[1]-b-this.width*s)/c,[i,a]=[-a,i];break}this.setAt(R*Ut,B*$t,i,a)}else this.setAt(et*Ut,bt*$t,this.width*Ut,this.height*$t);Z(this,J,hs).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(et,bt,Rt){let Ut=null;if(et instanceof Y.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:T,fontColor:i},rect:a,rotation:s,id:c},textContent:d,textPosition:b,parent:{page:{pageNumber:R}}}=et;if(!d||d.length===0)return null;Ut=et={annotationType:r.AnnotationEditorType.FREETEXT,color:Array.from(i),fontSize:T,value:d.join(`
`),position:b,pageIndex:R-1,rect:a,rotation:s,id:c,deleted:!1}}const $t=super.deserialize(et,bt,Rt);return ot($t,w,et.fontSize),ot($t,W,r.Util.makeHexColor(...et.color)),ot($t,L,et.value),$t.annotationElementId=et.id||null,ot($t,f,Ut),$t}serialize(et=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const bt=ut._internalPadding*this.parentScale,Rt=this.getRect(bt,bt),Ut=q.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:t(this,W)),$t={annotationType:r.AnnotationEditorType.FREETEXT,color:Ut,fontSize:t(this,w),value:t(this,L),pageIndex:this.pageIndex,rect:Rt,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return et?$t:this.annotationElementId&&!Z(this,at,_n).call(this,$t)?null:($t.id=this.annotationElementId,$t)}};z=new WeakMap,F=new WeakMap,g=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakMap,E=new WeakMap,w=new WeakMap,f=new WeakMap,A=new WeakSet,An=function(et){const bt=Ut=>{this.editorDiv.style.fontSize=`calc(${Ut}px * var(--scale-factor))`,this.translate(0,-(Ut-t(this,w))*this.parentScale),ot(this,w,Ut),Z(this,I,Ke).call(this)},Rt=t(this,w);this.addCommands({cmd:()=>{bt(et)},undo:()=>{bt(Rt)},mustExec:!0,type:r.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},k=new WeakSet,yn=function(et){const bt=t(this,W);this.addCommands({cmd:()=>{ot(this,W,this.editorDiv.style.color=et)},undo:()=>{ot(this,W,this.editorDiv.style.color=bt)},mustExec:!0,type:r.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},l=new WeakSet,vn=function(){const et=this.editorDiv.getElementsByTagName("div");if(et.length===0)return this.editorDiv.innerText;const bt=[];for(const Rt of et)bt.push(Rt.innerText.replace(/\r\n?|\n/,""));return bt.join(`
`)},I=new WeakSet,Ke=function(){const[et,bt]=this.parentDimensions;let Rt;if(this.isAttachedToDOM)Rt=this.div.getBoundingClientRect();else{const{currentLayer:Ut,div:$t}=this,T=$t.style.display;$t.style.display="hidden",Ut.div.append(this.div),Rt=$t.getBoundingClientRect(),$t.remove(),$t.style.display=T}this.rotation%180===this.parentRotation%180?(this.width=Rt.width/et,this.height=Rt.height/bt):(this.width=Rt.height/et,this.height=Rt.width/bt),this.fixAndSetPosition()},J=new WeakSet,hs=function(){if(this.editorDiv.replaceChildren(),!!t(this,L))for(const et of t(this,L).split(`
`)){const bt=document.createElement("div");bt.append(et?document.createTextNode(et):document.createElement("br")),this.editorDiv.append(bt)}},at=new WeakSet,_n=function(et){const{value:bt,fontSize:Rt,color:Ut,rect:$t,pageIndex:T}=t(this,f);return et.value!==bt||et.fontSize!==Rt||et.rect.some((i,a)=>Math.abs(i-$t[a])>=1)||et.color.some((i,a)=>i!==Ut[a])||et.pageIndex!==T},Ct=new WeakSet,ds=function(et=!1){if(!this.annotationElementId)return;if(Z(this,I,Ke).call(this),!et&&(this.width===0||this.height===0)){setTimeout(()=>Z(this,Ct,ds).call(this,!0),0);return}const bt=ut._internalPadding*this.parentScale;t(this,f).rect=this.getRect(bt,bt)},oe(ut,"_freeTextDefaultContent",""),oe(ut,"_internalPadding",0),oe(ut,"_defaultColor",null),oe(ut,"_defaultFontSize",10),oe(ut,"_type","freetext");let gt=ut;o.FreeTextEditor=gt},(U,o,V)=>{var a,c,xe,b,Sn,B,lt,nt,ft,mt,Mt,At,Bt,Vt,kt,jt,St,it,st,vt,Ft,Ot,te,En,Jt,_i,pt,us,X,fs,S,C,rt,dt,qt,ie,K,ps,Nt,Dt,Xt,Gt,wn,Pt,gs;Object.defineProperty(o,"__esModule",{value:!0}),o.StampAnnotationElement=o.InkAnnotationElement=o.FreeTextAnnotationElement=o.AnnotationLayer=void 0;var r=V(1),x=V(6),q=V(3),Y=V(30),gt=V(31),z=V(32);const F=1e3,g=9,H=new WeakSet;function W(Wt){return{width:Wt[2]-Wt[0],height:Wt[3]-Wt[1]}}class L{static create(D){switch(D.data.annotationType){case r.AnnotationType.LINK:return new w(D);case r.AnnotationType.TEXT:return new f(D);case r.AnnotationType.WIDGET:switch(D.data.fieldType){case"Tx":return new M(D);case"Btn":return D.data.radioButton?new l(D):D.data.checkBox?new v(D):new h(D);case"Ch":return new I(D);case"Sig":return new k(D)}return new A(D);case r.AnnotationType.POPUP:return new Q(D);case r.AnnotationType.FREETEXT:return new _t(D);case r.AnnotationType.LINE:return new at(D);case r.AnnotationType.SQUARE:return new xt(D);case r.AnnotationType.CIRCLE:return new Ct(D);case r.AnnotationType.POLYLINE:return new j(D);case r.AnnotationType.CARET:return new Et(D);case r.AnnotationType.INK:return new yt(D);case r.AnnotationType.POLYGON:return new ut(D);case r.AnnotationType.HIGHLIGHT:return new et(D);case r.AnnotationType.UNDERLINE:return new bt(D);case r.AnnotationType.SQUIGGLY:return new Rt(D);case r.AnnotationType.STRIKEOUT:return new Ut(D);case r.AnnotationType.STAMP:return new $t(D);case r.AnnotationType.FILEATTACHMENT:return new T(D);default:return new E(D)}}}const s=class s{constructor(D,{isRenderable:e=!1,ignoreBorder:p=!1,createQuadrilaterals:N=!1}={}){$(this,a,!1);this.isRenderable=e,this.data=D.data,this.layer=D.layer,this.linkService=D.linkService,this.downloadManager=D.downloadManager,this.imageResourcesPath=D.imageResourcesPath,this.renderForms=D.renderForms,this.svgFactory=D.svgFactory,this.annotationStorage=D.annotationStorage,this.enableScripting=D.enableScripting,this.hasJSActions=D.hasJSActions,this._fieldObjects=D.fieldObjects,this.parent=D.parent,e&&(this.container=this._createContainer(p)),N&&this._createQuadrilaterals()}static _hasPopupData({titleObj:D,contentsObj:e,richText:p}){return!!(D!=null&&D.str||e!=null&&e.str||p!=null&&p.str)}get hasPopupData(){return s._hasPopupData(this.data)}_createContainer(D){const{data:e,parent:{page:p,viewport:N}}=this,G=document.createElement("section");G.setAttribute("data-annotation-id",e.id),this instanceof A||(G.tabIndex=F),G.style.zIndex=this.parent.zIndex++,this.data.popupRef&&G.setAttribute("aria-haspopup","dialog"),e.noRotate&&G.classList.add("norotate");const{pageWidth:tt,pageHeight:ht,pageX:wt,pageY:Lt}=N.rawDims;if(!e.rect||this instanceof Q){const{rotation:Yt}=e;return!e.hasOwnCanvas&&Yt!==0&&this.setRotation(Yt,G),G}const{width:It,height:Qt}=W(e.rect),Ht=r.Util.normalizeRect([e.rect[0],p.view[3]-e.rect[1]+p.view[1],e.rect[2],p.view[3]-e.rect[3]+p.view[1]]);if(!D&&e.borderStyle.width>0){G.style.borderWidth=`${e.borderStyle.width}px`;const Yt=e.borderStyle.horizontalCornerRadius,ee=e.borderStyle.verticalCornerRadius;if(Yt>0||ee>0){const ae=`calc(${Yt}px * var(--scale-factor)) / calc(${ee}px * var(--scale-factor))`;G.style.borderRadius=ae}else if(this instanceof l){const ae=`calc(${It}px * var(--scale-factor)) / calc(${Qt}px * var(--scale-factor))`;G.style.borderRadius=ae}switch(e.borderStyle.style){case r.AnnotationBorderStyleType.SOLID:G.style.borderStyle="solid";break;case r.AnnotationBorderStyleType.DASHED:G.style.borderStyle="dashed";break;case r.AnnotationBorderStyleType.BEVELED:(0,r.warn)("Unimplemented border style: beveled");break;case r.AnnotationBorderStyleType.INSET:(0,r.warn)("Unimplemented border style: inset");break;case r.AnnotationBorderStyleType.UNDERLINE:G.style.borderBottomStyle="solid";break}const re=e.borderColor||null;re?(ot(this,a,!0),G.style.borderColor=r.Util.makeHexColor(re[0]|0,re[1]|0,re[2]|0)):G.style.borderWidth=0}G.style.left=`${100*(Ht[0]-wt)/tt}%`,G.style.top=`${100*(Ht[1]-Lt)/ht}%`;const{rotation:zt}=e;return e.hasOwnCanvas||zt===0?(G.style.width=`${100*It/tt}%`,G.style.height=`${100*Qt/ht}%`):this.setRotation(zt,G),G}setRotation(D,e=this.container){if(!this.data.rect)return;const{pageWidth:p,pageHeight:N}=this.parent.viewport.rawDims,{width:G,height:tt}=W(this.data.rect);let ht,wt;D%180===0?(ht=100*G/p,wt=100*tt/N):(ht=100*tt/p,wt=100*G/N),e.style.width=`${ht}%`,e.style.height=`${wt}%`,e.setAttribute("data-main-rotation",(360-D)%360)}get _commonActions(){const D=(e,p,N)=>{const G=N.detail[e],tt=G[0],ht=G.slice(1);N.target.style[p]=Y.ColorConverters[`${tt}_HTML`](ht),this.annotationStorage.setValue(this.data.id,{[p]:Y.ColorConverters[`${tt}_rgb`](ht)})};return(0,r.shadow)(this,"_commonActions",{display:e=>{const{display:p}=e.detail,N=p%2===1;this.container.style.visibility=N?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:N,noPrint:p===1||p===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:p}=e.detail;this.container.style.visibility=p?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:p,noView:p})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{D("bgColor","backgroundColor",e)},fillColor:e=>{D("fillColor","backgroundColor",e)},fgColor:e=>{D("fgColor","color",e)},textColor:e=>{D("textColor","color",e)},borderColor:e=>{D("borderColor","borderColor",e)},strokeColor:e=>{D("strokeColor","borderColor",e)},rotation:e=>{const p=e.detail.rotation;this.setRotation(p),this.annotationStorage.setValue(this.data.id,{rotation:p})}})}_dispatchEventFromSandbox(D,e){const p=this._commonActions;for(const N of Object.keys(e.detail)){const G=D[N]||p[N];G==null||G(e)}}_setDefaultPropertiesFromJS(D){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const p=this._commonActions;for(const[N,G]of Object.entries(e)){const tt=p[N];if(tt){const ht={detail:{[N]:G},target:D};tt(ht),delete e[N]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:D}=this.data;if(!D)return;const[e,p,N,G]=this.data.rect;if(D.length===1){const[,{x:ee,y:re},{x:ae,y:ce}]=D[0];if(N===ee&&G===re&&e===ae&&p===ce)return}const{style:tt}=this.container;let ht;if(t(this,a)){const{borderColor:ee,borderWidth:re}=tt;tt.borderWidth=0,ht=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${ee}" stroke-width="${re}">`],this.container.classList.add("hasBorder")}const wt=N-e,Lt=G-p,{svgFactory:It}=this,Qt=It.createElement("svg");Qt.classList.add("quadrilateralsContainer"),Qt.setAttribute("width",0),Qt.setAttribute("height",0);const Ht=It.createElement("defs");Qt.append(Ht);const zt=It.createElement("clipPath"),Yt=`clippath_${this.data.id}`;zt.setAttribute("id",Yt),zt.setAttribute("clipPathUnits","objectBoundingBox"),Ht.append(zt);for(const[,{x:ee,y:re},{x:ae,y:ce}]of D){const le=It.createElement("rect"),ge=(ae-e)/wt,me=(G-re)/Lt,_e=(ee-ae)/wt,De=(re-ce)/Lt;le.setAttribute("x",ge),le.setAttribute("y",me),le.setAttribute("width",_e),le.setAttribute("height",De),zt.append(le),ht==null||ht.push(`<rect vector-effect="non-scaling-stroke" x="${ge}" y="${me}" width="${_e}" height="${De}"/>`)}t(this,a)&&(ht.push("</g></svg>')"),tt.backgroundImage=ht.join("")),this.container.append(Qt),this.container.style.clipPath=`url(#${Yt})`}_createPopup(){const{container:D,data:e}=this;D.setAttribute("aria-haspopup","dialog");const p=new Q({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]});this.parent.div.append(p.render())}render(){(0,r.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(D,e=null){const p=[];if(this._fieldObjects){const N=this._fieldObjects[D];if(N)for(const{page:G,id:tt,exportValues:ht}of N){if(G===-1||tt===e)continue;const wt=typeof ht=="string"?ht:null,Lt=document.querySelector(`[data-element-id="${tt}"]`);if(Lt&&!H.has(Lt)){(0,r.warn)(`_getElementsByName - element not allowed: ${tt}`);continue}p.push({id:tt,exportValue:wt,domElement:Lt})}return p}for(const N of document.getElementsByName(D)){const{exportValue:G}=N,tt=N.getAttribute("data-element-id");tt!==e&&H.has(N)&&p.push({id:tt,exportValue:G,domElement:N})}return p}show(){var D;this.container&&(this.container.hidden=!1),(D=this.popup)==null||D.maybeShow()}hide(){var D;this.container&&(this.container.hidden=!0),(D=this.popup)==null||D.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const D=this.getElementsToTriggerPopup();if(Array.isArray(D))for(const e of D)e.classList.add("highlightArea");else D.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:D,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{var p;(p=this.linkService.eventBus)==null||p.dispatch("switchannotationeditormode",{source:this,mode:D,editId:e})})}};a=new WeakMap;let E=s;class w extends E{constructor(e,p=null){super(e,{isRenderable:!0,ignoreBorder:!!(p!=null&&p.ignoreBorder),createQuadrilaterals:!0});$(this,c);$(this,b);this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:p}=this,N=document.createElement("a");N.setAttribute("data-element-id",e.id);let G=!1;return e.url?(p.addLinkAttributes(N,e.url,e.newWindow),G=!0):e.action?(this._bindNamedAction(N,e.action),G=!0):e.attachment?(this._bindAttachment(N,e.attachment),G=!0):e.setOCGState?(Z(this,b,Sn).call(this,N,e.setOCGState),G=!0):e.dest?(this._bindLink(N,e.dest),G=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(N,e),G=!0),e.resetForm?(this._bindResetFormAction(N,e.resetForm),G=!0):this.isTooltipOnly&&!G&&(this._bindLink(N,""),G=!0)),this.container.classList.add("linkAnnotation"),G&&this.container.append(N),this.container}_bindLink(e,p){e.href=this.linkService.getDestinationHash(p),e.onclick=()=>(p&&this.linkService.goToDestination(p),!1),(p||p==="")&&Z(this,c,xe).call(this)}_bindNamedAction(e,p){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(p),!1),Z(this,c,xe).call(this)}_bindAttachment(e,p){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>{var N;return(N=this.downloadManager)==null||N.openOrDownloadData(this.container,p.content,p.filename),!1},Z(this,c,xe).call(this)}_bindJSAction(e,p){e.href=this.linkService.getAnchorUrl("");const N=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const G of Object.keys(p.actions)){const tt=N.get(G);tt&&(e[tt]=()=>{var ht;return(ht=this.linkService.eventBus)==null||ht.dispatch("dispatcheventinsandbox",{source:this,detail:{id:p.id,name:G}}),!1})}e.onclick||(e.onclick=()=>!1),Z(this,c,xe).call(this)}_bindResetFormAction(e,p){const N=e.onclick;if(N||(e.href=this.linkService.getAnchorUrl("")),Z(this,c,xe).call(this),!this._fieldObjects){(0,r.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),N||(e.onclick=()=>!1);return}e.onclick=()=>{var Qt;N==null||N();const{fields:G,refs:tt,include:ht}=p,wt=[];if(G.length!==0||tt.length!==0){const Ht=new Set(tt);for(const zt of G){const Yt=this._fieldObjects[zt]||[];for(const{id:ee}of Yt)Ht.add(ee)}for(const zt of Object.values(this._fieldObjects))for(const Yt of zt)Ht.has(Yt.id)===ht&&wt.push(Yt)}else for(const Ht of Object.values(this._fieldObjects))wt.push(...Ht);const Lt=this.annotationStorage,It=[];for(const Ht of wt){const{id:zt}=Ht;switch(It.push(zt),Ht.type){case"text":{const ee=Ht.defaultValue||"";Lt.setValue(zt,{value:ee});break}case"checkbox":case"radiobutton":{const ee=Ht.defaultValue===Ht.exportValues;Lt.setValue(zt,{value:ee});break}case"combobox":case"listbox":{const ee=Ht.defaultValue||"";Lt.setValue(zt,{value:ee});break}default:continue}const Yt=document.querySelector(`[data-element-id="${zt}"]`);if(Yt){if(!H.has(Yt)){(0,r.warn)(`_bindResetFormAction - element not allowed: ${zt}`);continue}}else continue;Yt.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((Qt=this.linkService.eventBus)==null||Qt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:It,name:"ResetForm"}})),!1}}}c=new WeakSet,xe=function(){this.container.setAttribute("data-internal-link","")},b=new WeakSet,Sn=function(e,p){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(p),!1),Z(this,c,xe).call(this)};class f extends E{constructor(D){super(D,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const D=document.createElement("img");return D.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",D.alt="[{{type}} Annotation]",D.dataset.l10nId="text_annotation_type",D.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(D),this.container}}class A extends E{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(D){var e;this.data.hasOwnCanvas&&(((e=D.previousSibling)==null?void 0:e.nodeName)==="CANVAS"&&(D.previousSibling.hidden=!0),D.hidden=!1)}_getKeyModifier(D){const{isWin:e,isMac:p}=r.FeatureTest.platform;return e&&D.ctrlKey||p&&D.metaKey}_setEventListener(D,e,p,N,G){p.includes("mouse")?D.addEventListener(p,tt=>{var ht;(ht=this.linkService.eventBus)==null||ht.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:N,value:G(tt),shift:tt.shiftKey,modifier:this._getKeyModifier(tt)}})}):D.addEventListener(p,tt=>{var ht;if(p==="blur"){if(!e.focused||!tt.relatedTarget)return;e.focused=!1}else if(p==="focus"){if(e.focused)return;e.focused=!0}G&&((ht=this.linkService.eventBus)==null||ht.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:N,value:G(tt)}}))})}_setEventListeners(D,e,p,N){var G,tt,ht;for(const[wt,Lt]of p)(Lt==="Action"||(G=this.data.actions)!=null&&G[Lt])&&((Lt==="Focus"||Lt==="Blur")&&(e||(e={focused:!1})),this._setEventListener(D,e,wt,Lt,N),Lt==="Focus"&&!((tt=this.data.actions)!=null&&tt.Blur)?this._setEventListener(D,e,"blur","Blur",null):Lt==="Blur"&&!((ht=this.data.actions)!=null&&ht.Focus)&&this._setEventListener(D,e,"focus","Focus",null))}_setBackgroundColor(D){const e=this.data.backgroundColor||null;D.style.backgroundColor=e===null?"transparent":r.Util.makeHexColor(e[0],e[1],e[2])}_setTextStyle(D){const e=["left","center","right"],{fontColor:p}=this.data.defaultAppearanceData,N=this.data.defaultAppearanceData.fontSize||g,G=D.style;let tt;const ht=2,wt=Lt=>Math.round(10*Lt)/10;if(this.data.multiLine){const Lt=Math.abs(this.data.rect[3]-this.data.rect[1]-ht),It=Math.round(Lt/(r.LINE_FACTOR*N))||1,Qt=Lt/It;tt=Math.min(N,wt(Qt/r.LINE_FACTOR))}else{const Lt=Math.abs(this.data.rect[3]-this.data.rect[1]-ht);tt=Math.min(N,wt(Lt/r.LINE_FACTOR))}G.fontSize=`calc(${tt}px * var(--scale-factor))`,G.color=r.Util.makeHexColor(p[0],p[1],p[2]),this.data.textAlignment!==null&&(G.textAlign=e[this.data.textAlignment])}_setRequired(D,e){e?D.setAttribute("required",!0):D.removeAttribute("required"),D.setAttribute("aria-required",e)}}class M extends A{constructor(D){const e=D.renderForms||!D.data.hasAppearance&&!!D.data.fieldValue;super(D,{isRenderable:e})}setPropertyOnSiblings(D,e,p,N){const G=this.annotationStorage;for(const tt of this._getElementsByName(D.name,D.id))tt.domElement&&(tt.domElement[e]=p),G.setValue(tt.id,{[N]:p})}render(){var N,G;const D=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let p=null;if(this.renderForms){const tt=D.getValue(e,{value:this.data.fieldValue});let ht=tt.value||"";const wt=D.getValue(e,{charLimit:this.data.maxLen}).charLimit;wt&&ht.length>wt&&(ht=ht.slice(0,wt));let Lt=tt.formattedValue||((N=this.data.textContent)==null?void 0:N.join(`
`))||null;Lt&&this.data.comb&&(Lt=Lt.replaceAll(/\s+/g,""));const It={userValue:ht,formattedValue:Lt,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(p=document.createElement("textarea"),p.textContent=Lt??ht,this.data.doNotScroll&&(p.style.overflowY="hidden")):(p=document.createElement("input"),p.type="text",p.setAttribute("value",Lt??ht),this.data.doNotScroll&&(p.style.overflowX="hidden")),this.data.hasOwnCanvas&&(p.hidden=!0),H.add(p),p.setAttribute("data-element-id",e),p.disabled=this.data.readOnly,p.name=this.data.fieldName,p.tabIndex=F,this._setRequired(p,this.data.required),wt&&(p.maxLength=wt),p.addEventListener("input",Ht=>{D.setValue(e,{value:Ht.target.value}),this.setPropertyOnSiblings(p,"value",Ht.target.value,"value"),It.formattedValue=null}),p.addEventListener("resetform",Ht=>{const zt=this.data.defaultFieldValue??"";p.value=It.userValue=zt,It.formattedValue=null});let Qt=Ht=>{const{formattedValue:zt}=It;zt!=null&&(Ht.target.value=zt),Ht.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){p.addEventListener("focus",zt=>{if(It.focused)return;const{target:Yt}=zt;It.userValue&&(Yt.value=It.userValue),It.lastCommittedValue=Yt.value,It.commitKey=1,It.focused=!0}),p.addEventListener("updatefromsandbox",zt=>{this.showElementAndHideCanvas(zt.target);const Yt={value(ee){It.userValue=ee.detail.value??"",D.setValue(e,{value:It.userValue.toString()}),ee.target.value=It.userValue},formattedValue(ee){const{formattedValue:re}=ee.detail;It.formattedValue=re,re!=null&&ee.target!==document.activeElement&&(ee.target.value=re),D.setValue(e,{formattedValue:re})},selRange(ee){ee.target.setSelectionRange(...ee.detail.selRange)},charLimit:ee=>{var le;const{charLimit:re}=ee.detail,{target:ae}=ee;if(re===0){ae.removeAttribute("maxLength");return}ae.setAttribute("maxLength",re);let ce=It.userValue;!ce||ce.length<=re||(ce=ce.slice(0,re),ae.value=It.userValue=ce,D.setValue(e,{value:ce}),(le=this.linkService.eventBus)==null||le.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:ce,willCommit:!0,commitKey:1,selStart:ae.selectionStart,selEnd:ae.selectionEnd}}))}};this._dispatchEventFromSandbox(Yt,zt)}),p.addEventListener("keydown",zt=>{var re;It.commitKey=1;let Yt=-1;if(zt.key==="Escape"?Yt=0:zt.key==="Enter"&&!this.data.multiLine?Yt=2:zt.key==="Tab"&&(It.commitKey=3),Yt===-1)return;const{value:ee}=zt.target;It.lastCommittedValue!==ee&&(It.lastCommittedValue=ee,It.userValue=ee,(re=this.linkService.eventBus)==null||re.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:ee,willCommit:!0,commitKey:Yt,selStart:zt.target.selectionStart,selEnd:zt.target.selectionEnd}}))});const Ht=Qt;Qt=null,p.addEventListener("blur",zt=>{var ee;if(!It.focused||!zt.relatedTarget)return;It.focused=!1;const{value:Yt}=zt.target;It.userValue=Yt,It.lastCommittedValue!==Yt&&((ee=this.linkService.eventBus)==null||ee.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:Yt,willCommit:!0,commitKey:It.commitKey,selStart:zt.target.selectionStart,selEnd:zt.target.selectionEnd}})),Ht(zt)}),(G=this.data.actions)!=null&&G.Keystroke&&p.addEventListener("beforeinput",zt=>{var me;It.lastCommittedValue=null;const{data:Yt,target:ee}=zt,{value:re,selectionStart:ae,selectionEnd:ce}=ee;let le=ae,ge=ce;switch(zt.inputType){case"deleteWordBackward":{const _e=re.substring(0,ae).match(/\w*[^\w]*$/);_e&&(le-=_e[0].length);break}case"deleteWordForward":{const _e=re.substring(ae).match(/^[^\w]*\w*/);_e&&(ge+=_e[0].length);break}case"deleteContentBackward":ae===ce&&(le-=1);break;case"deleteContentForward":ae===ce&&(ge+=1);break}zt.preventDefault(),(me=this.linkService.eventBus)==null||me.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:re,change:Yt||"",willCommit:!1,selStart:le,selEnd:ge}})}),this._setEventListeners(p,It,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],zt=>zt.target.value)}if(Qt&&p.addEventListener("blur",Qt),this.data.comb){const zt=(this.data.rect[2]-this.data.rect[0])/wt;p.classList.add("comb"),p.style.letterSpacing=`calc(${zt}px * var(--scale-factor) - 1ch)`}}else p=document.createElement("div"),p.textContent=this.data.fieldValue,p.style.verticalAlign="middle",p.style.display="table-cell";return this._setTextStyle(p),this._setBackgroundColor(p),this._setDefaultPropertiesFromJS(p),this.container.append(p),this.container}}class k extends A{constructor(D){super(D,{isRenderable:!!D.data.hasOwnCanvas})}}class v extends A{constructor(D){super(D,{isRenderable:D.renderForms})}render(){const D=this.annotationStorage,e=this.data,p=e.id;let N=D.getValue(p,{value:e.exportValue===e.fieldValue}).value;typeof N=="string"&&(N=N!=="Off",D.setValue(p,{value:N})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const G=document.createElement("input");return H.add(G),G.setAttribute("data-element-id",p),G.disabled=e.readOnly,this._setRequired(G,this.data.required),G.type="checkbox",G.name=e.fieldName,N&&G.setAttribute("checked",!0),G.setAttribute("exportValue",e.exportValue),G.tabIndex=F,G.addEventListener("change",tt=>{const{name:ht,checked:wt}=tt.target;for(const Lt of this._getElementsByName(ht,p)){const It=wt&&Lt.exportValue===e.exportValue;Lt.domElement&&(Lt.domElement.checked=It),D.setValue(Lt.id,{value:It})}D.setValue(p,{value:wt})}),G.addEventListener("resetform",tt=>{const ht=e.defaultFieldValue||"Off";tt.target.checked=ht===e.exportValue}),this.enableScripting&&this.hasJSActions&&(G.addEventListener("updatefromsandbox",tt=>{const ht={value(wt){wt.target.checked=wt.detail.value!=="Off",D.setValue(p,{value:wt.target.checked})}};this._dispatchEventFromSandbox(ht,tt)}),this._setEventListeners(G,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],tt=>tt.target.checked)),this._setBackgroundColor(G),this._setDefaultPropertiesFromJS(G),this.container.append(G),this.container}}class l extends A{constructor(D){super(D,{isRenderable:D.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const D=this.annotationStorage,e=this.data,p=e.id;let N=D.getValue(p,{value:e.fieldValue===e.buttonValue}).value;typeof N=="string"&&(N=N!==e.buttonValue,D.setValue(p,{value:N}));const G=document.createElement("input");if(H.add(G),G.setAttribute("data-element-id",p),G.disabled=e.readOnly,this._setRequired(G,this.data.required),G.type="radio",G.name=e.fieldName,N&&G.setAttribute("checked",!0),G.tabIndex=F,G.addEventListener("change",tt=>{const{name:ht,checked:wt}=tt.target;for(const Lt of this._getElementsByName(ht,p))D.setValue(Lt.id,{value:!1});D.setValue(p,{value:wt})}),G.addEventListener("resetform",tt=>{const ht=e.defaultFieldValue;tt.target.checked=ht!=null&&ht===e.buttonValue}),this.enableScripting&&this.hasJSActions){const tt=e.buttonValue;G.addEventListener("updatefromsandbox",ht=>{const wt={value:Lt=>{const It=tt===Lt.detail.value;for(const Qt of this._getElementsByName(Lt.target.name)){const Ht=It&&Qt.id===p;Qt.domElement&&(Qt.domElement.checked=Ht),D.setValue(Qt.id,{value:Ht})}}};this._dispatchEventFromSandbox(wt,ht)}),this._setEventListeners(G,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ht=>ht.target.checked)}return this._setBackgroundColor(G),this._setDefaultPropertiesFromJS(G),this.container.append(G),this.container}}class h extends w{constructor(D){super(D,{ignoreBorder:D.data.hasAppearance})}render(){const D=super.render();D.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(D.title=this.data.alternativeText);const e=D.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",p=>{this._dispatchEventFromSandbox({},p)})),D}}class I extends A{constructor(D){super(D,{isRenderable:D.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const D=this.annotationStorage,e=this.data.id,p=D.getValue(e,{value:this.data.fieldValue}),N=document.createElement("select");H.add(N),N.setAttribute("data-element-id",e),N.disabled=this.data.readOnly,this._setRequired(N,this.data.required),N.name=this.data.fieldName,N.tabIndex=F;let G=this.data.combo&&this.data.options.length>0;this.data.combo||(N.size=this.data.options.length,this.data.multiSelect&&(N.multiple=!0)),N.addEventListener("resetform",It=>{const Qt=this.data.defaultFieldValue;for(const Ht of N.options)Ht.selected=Ht.value===Qt});for(const It of this.data.options){const Qt=document.createElement("option");Qt.textContent=It.displayValue,Qt.value=It.exportValue,p.value.includes(It.exportValue)&&(Qt.setAttribute("selected",!0),G=!1),N.append(Qt)}let tt=null;if(G){const It=document.createElement("option");It.value=" ",It.setAttribute("hidden",!0),It.setAttribute("selected",!0),N.prepend(It),tt=()=>{It.remove(),N.removeEventListener("input",tt),tt=null},N.addEventListener("input",tt)}const ht=It=>{const Qt=It?"value":"textContent",{options:Ht,multiple:zt}=N;return zt?Array.prototype.filter.call(Ht,Yt=>Yt.selected).map(Yt=>Yt[Qt]):Ht.selectedIndex===-1?null:Ht[Ht.selectedIndex][Qt]};let wt=ht(!1);const Lt=It=>{const Qt=It.target.options;return Array.prototype.map.call(Qt,Ht=>({displayValue:Ht.textContent,exportValue:Ht.value}))};return this.enableScripting&&this.hasJSActions?(N.addEventListener("updatefromsandbox",It=>{const Qt={value(Ht){tt==null||tt();const zt=Ht.detail.value,Yt=new Set(Array.isArray(zt)?zt:[zt]);for(const ee of N.options)ee.selected=Yt.has(ee.value);D.setValue(e,{value:ht(!0)}),wt=ht(!1)},multipleSelection(Ht){N.multiple=!0},remove(Ht){const zt=N.options,Yt=Ht.detail.remove;zt[Yt].selected=!1,N.remove(Yt),zt.length>0&&Array.prototype.findIndex.call(zt,re=>re.selected)===-1&&(zt[0].selected=!0),D.setValue(e,{value:ht(!0),items:Lt(Ht)}),wt=ht(!1)},clear(Ht){for(;N.length!==0;)N.remove(0);D.setValue(e,{value:null,items:[]}),wt=ht(!1)},insert(Ht){const{index:zt,displayValue:Yt,exportValue:ee}=Ht.detail.insert,re=N.children[zt],ae=document.createElement("option");ae.textContent=Yt,ae.value=ee,re?re.before(ae):N.append(ae),D.setValue(e,{value:ht(!0),items:Lt(Ht)}),wt=ht(!1)},items(Ht){const{items:zt}=Ht.detail;for(;N.length!==0;)N.remove(0);for(const Yt of zt){const{displayValue:ee,exportValue:re}=Yt,ae=document.createElement("option");ae.textContent=ee,ae.value=re,N.append(ae)}N.options.length>0&&(N.options[0].selected=!0),D.setValue(e,{value:ht(!0),items:Lt(Ht)}),wt=ht(!1)},indices(Ht){const zt=new Set(Ht.detail.indices);for(const Yt of Ht.target.options)Yt.selected=zt.has(Yt.index);D.setValue(e,{value:ht(!0)}),wt=ht(!1)},editable(Ht){Ht.target.disabled=!Ht.detail.editable}};this._dispatchEventFromSandbox(Qt,It)}),N.addEventListener("input",It=>{var Ht;const Qt=ht(!0);D.setValue(e,{value:Qt}),It.preventDefault(),(Ht=this.linkService.eventBus)==null||Ht.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:wt,changeEx:Qt,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(N,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],It=>It.target.value)):N.addEventListener("input",function(It){D.setValue(e,{value:ht(!0)})}),this.data.combo&&this._setTextStyle(N),this._setBackgroundColor(N),this._setDefaultPropertiesFromJS(N),this.container.append(N),this.container}}class Q extends E{constructor(D){const{data:e,elements:p}=D;super(D,{isRenderable:E._hasPopupData(e)}),this.elements=p}render(){this.container.classList.add("popupAnnotation");const D=new J({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(const p of this.elements)p.popup=D,e.push(p.data.id),p.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(p=>`${r.AnnotationPrefix}${p}`).join(",")),this.container}}class J{constructor({container:D,color:e,elements:p,titleObj:N,modificationDate:G,contentsObj:tt,richText:ht,parent:wt,rect:Lt,parentRect:It,open:Qt}){$(this,te);$(this,Jt);$(this,pt);$(this,X);$(this,B,null);$(this,lt,Z(this,te,En).bind(this));$(this,nt,Z(this,X,fs).bind(this));$(this,ft,Z(this,pt,us).bind(this));$(this,mt,Z(this,Jt,_i).bind(this));$(this,Mt,null);$(this,At,null);$(this,Bt,null);$(this,Vt,null);$(this,kt,null);$(this,jt,null);$(this,St,!1);$(this,it,null);$(this,st,null);$(this,vt,null);$(this,Ft,null);$(this,Ot,!1);var zt;ot(this,At,D),ot(this,Ft,N),ot(this,Bt,tt),ot(this,vt,ht),ot(this,kt,wt),ot(this,Mt,e),ot(this,st,Lt),ot(this,jt,It),ot(this,Vt,p);const Ht=x.PDFDateString.toDateObject(G);Ht&&ot(this,B,wt.l10n.get("annotation_date_string",{date:Ht.toLocaleDateString(),time:Ht.toLocaleTimeString()})),this.trigger=p.flatMap(Yt=>Yt.getElementsToTriggerPopup());for(const Yt of this.trigger)Yt.addEventListener("click",t(this,mt)),Yt.addEventListener("mouseenter",t(this,ft)),Yt.addEventListener("mouseleave",t(this,nt)),Yt.classList.add("popupTriggerArea");for(const Yt of p)(zt=Yt.container)==null||zt.addEventListener("keydown",t(this,lt));t(this,At).hidden=!0,Qt&&Z(this,Jt,_i).call(this)}render(){if(t(this,it))return;const{page:{view:D},viewport:{rawDims:{pageWidth:e,pageHeight:p,pageX:N,pageY:G}}}=t(this,kt),tt=ot(this,it,document.createElement("div"));if(tt.className="popup",t(this,Mt)){const le=tt.style.outlineColor=r.Util.makeHexColor(...t(this,Mt));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?tt.style.backgroundColor=`color-mix(in srgb, ${le} 30%, white)`:tt.style.backgroundColor=r.Util.makeHexColor(...t(this,Mt).map(me=>Math.floor(.7*(255-me)+me)))}const ht=document.createElement("span");ht.className="header";const wt=document.createElement("h1");if(ht.append(wt),{dir:wt.dir,str:wt.textContent}=t(this,Ft),tt.append(ht),t(this,B)){const le=document.createElement("span");le.classList.add("popupDate"),t(this,B).then(ge=>{le.textContent=ge}),ht.append(le)}const Lt=t(this,Bt),It=t(this,vt);if(It!=null&&It.str&&(!(Lt!=null&&Lt.str)||Lt.str===It.str))z.XfaLayer.render({xfaHtml:It.html,intent:"richText",div:tt}),tt.lastChild.classList.add("richText","popupContent");else{const le=this._formatContents(Lt);tt.append(le)}let Qt=!!t(this,jt),Ht=Qt?t(this,jt):t(this,st);for(const le of t(this,Vt))if(!Ht||r.Util.intersect(le.data.rect,Ht)!==null){Ht=le.data.rect,Qt=!0;break}const zt=r.Util.normalizeRect([Ht[0],D[3]-Ht[1]+D[1],Ht[2],D[3]-Ht[3]+D[1]]),ee=Qt?Ht[2]-Ht[0]+5:0,re=zt[0]+ee,ae=zt[1],{style:ce}=t(this,At);ce.left=`${100*(re-N)/e}%`,ce.top=`${100*(ae-G)/p}%`,t(this,At).append(tt)}_formatContents({str:D,dir:e}){const p=document.createElement("p");p.classList.add("popupContent"),p.dir=e;const N=D.split(/(?:\r\n?|\n)/);for(let G=0,tt=N.length;G<tt;++G){const ht=N[G];p.append(document.createTextNode(ht)),G<tt-1&&p.append(document.createElement("br"))}return p}forceHide(){ot(this,Ot,this.isVisible),t(this,Ot)&&(t(this,At).hidden=!0)}maybeShow(){t(this,Ot)&&(ot(this,Ot,!1),t(this,At).hidden=!1)}get isVisible(){return t(this,At).hidden===!1}}B=new WeakMap,lt=new WeakMap,nt=new WeakMap,ft=new WeakMap,mt=new WeakMap,Mt=new WeakMap,At=new WeakMap,Bt=new WeakMap,Vt=new WeakMap,kt=new WeakMap,jt=new WeakMap,St=new WeakMap,it=new WeakMap,st=new WeakMap,vt=new WeakMap,Ft=new WeakMap,Ot=new WeakMap,te=new WeakSet,En=function(D){D.altKey||D.shiftKey||D.ctrlKey||D.metaKey||(D.key==="Enter"||D.key==="Escape"&&t(this,St))&&Z(this,Jt,_i).call(this)},Jt=new WeakSet,_i=function(){ot(this,St,!t(this,St)),t(this,St)?(Z(this,pt,us).call(this),t(this,At).addEventListener("click",t(this,mt)),t(this,At).addEventListener("keydown",t(this,lt))):(Z(this,X,fs).call(this),t(this,At).removeEventListener("click",t(this,mt)),t(this,At).removeEventListener("keydown",t(this,lt)))},pt=new WeakSet,us=function(){t(this,it)||this.render(),this.isVisible?t(this,St)&&t(this,At).classList.add("focused"):(t(this,At).hidden=!1,t(this,At).style.zIndex=parseInt(t(this,At).style.zIndex)+1e3)},X=new WeakSet,fs=function(){t(this,At).classList.remove("focused"),!(t(this,St)||!this.isVisible)&&(t(this,At).hidden=!0,t(this,At).style.zIndex=parseInt(t(this,At).style.zIndex)-1e3)};class _t extends E{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0}),this.textContent=D.data.textContent,this.textPosition=D.data.textPosition,this.annotationEditorType=r.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const D=document.createElement("div");D.classList.add("annotationTextContent"),D.setAttribute("role","comment");for(const e of this.textContent){const p=document.createElement("span");p.textContent=e,D.append(p)}this.container.append(D)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}o.FreeTextAnnotationElement=_t;class at extends E{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});$(this,S,null)}render(){this.container.classList.add("lineAnnotation");const e=this.data,{width:p,height:N}=W(e.rect),G=this.svgFactory.create(p,N,!0),tt=ot(this,S,this.svgFactory.createElement("svg:line"));return tt.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),tt.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),tt.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),tt.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),tt.setAttribute("stroke-width",e.borderStyle.width||1),tt.setAttribute("stroke","transparent"),tt.setAttribute("fill","transparent"),G.append(tt),this.container.append(G),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,S)}addHighlightArea(){this.container.classList.add("highlightArea")}}S=new WeakMap;class xt extends E{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});$(this,C,null)}render(){this.container.classList.add("squareAnnotation");const e=this.data,{width:p,height:N}=W(e.rect),G=this.svgFactory.create(p,N,!0),tt=e.borderStyle.width,ht=ot(this,C,this.svgFactory.createElement("svg:rect"));return ht.setAttribute("x",tt/2),ht.setAttribute("y",tt/2),ht.setAttribute("width",p-tt),ht.setAttribute("height",N-tt),ht.setAttribute("stroke-width",tt||1),ht.setAttribute("stroke","transparent"),ht.setAttribute("fill","transparent"),G.append(ht),this.container.append(G),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,C)}addHighlightArea(){this.container.classList.add("highlightArea")}}C=new WeakMap;class Ct extends E{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});$(this,rt,null)}render(){this.container.classList.add("circleAnnotation");const e=this.data,{width:p,height:N}=W(e.rect),G=this.svgFactory.create(p,N,!0),tt=e.borderStyle.width,ht=ot(this,rt,this.svgFactory.createElement("svg:ellipse"));return ht.setAttribute("cx",p/2),ht.setAttribute("cy",N/2),ht.setAttribute("rx",p/2-tt/2),ht.setAttribute("ry",N/2-tt/2),ht.setAttribute("stroke-width",tt||1),ht.setAttribute("stroke","transparent"),ht.setAttribute("fill","transparent"),G.append(ht),this.container.append(G),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,rt)}addHighlightArea(){this.container.classList.add("highlightArea")}}rt=new WeakMap;class j extends E{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});$(this,dt,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const e=this.data,{width:p,height:N}=W(e.rect),G=this.svgFactory.create(p,N,!0);let tt=[];for(const wt of e.vertices){const Lt=wt.x-e.rect[0],It=e.rect[3]-wt.y;tt.push(Lt+","+It)}tt=tt.join(" ");const ht=ot(this,dt,this.svgFactory.createElement(this.svgElementName));return ht.setAttribute("points",tt),ht.setAttribute("stroke-width",e.borderStyle.width||1),ht.setAttribute("stroke","transparent"),ht.setAttribute("fill","transparent"),G.append(ht),this.container.append(G),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,dt)}addHighlightArea(){this.container.classList.add("highlightArea")}}dt=new WeakMap;class ut extends j{constructor(D){super(D),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Et extends E{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class yt extends E{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});$(this,qt,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=r.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const e=this.data,{width:p,height:N}=W(e.rect),G=this.svgFactory.create(p,N,!0);for(const tt of e.inkLists){let ht=[];for(const Lt of tt){const It=Lt.x-e.rect[0],Qt=e.rect[3]-Lt.y;ht.push(`${It},${Qt}`)}ht=ht.join(" ");const wt=this.svgFactory.createElement(this.svgElementName);t(this,qt).push(wt),wt.setAttribute("points",ht),wt.setAttribute("stroke-width",e.borderStyle.width||1),wt.setAttribute("stroke","transparent"),wt.setAttribute("fill","transparent"),!e.popupRef&&this.hasPopupData&&this._createPopup(),G.append(wt)}return this.container.append(G),this.container}getElementsToTriggerPopup(){return t(this,qt)}addHighlightArea(){this.container.classList.add("highlightArea")}}qt=new WeakMap,o.InkAnnotationElement=yt;class et extends E{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class bt extends E{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Rt extends E{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Ut extends E{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class $t extends E{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}o.StampAnnotationElement=$t;class T extends E{constructor(e){var G;super(e,{isRenderable:!0});$(this,K);$(this,ie,null);const{filename:p,content:N}=this.data.file;this.filename=(0,x.getFilenameFromUrl)(p,!0),this.content=N,(G=this.linkService.eventBus)==null||G.dispatch("fileattachmentannotation",{source:this,filename:p,content:N})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:p}=this;let N;p.hasAppearance||p.fillAlpha===0?N=document.createElement("div"):(N=document.createElement("img"),N.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(p.name)?"paperclip":"pushpin"}.svg`,p.fillAlpha&&p.fillAlpha<1&&(N.style=`filter: opacity(${Math.round(p.fillAlpha*100)}%);`)),N.addEventListener("dblclick",Z(this,K,ps).bind(this)),ot(this,ie,N);const{isMac:G}=r.FeatureTest.platform;return e.addEventListener("keydown",tt=>{tt.key==="Enter"&&(G?tt.metaKey:tt.ctrlKey)&&Z(this,K,ps).call(this)}),!p.popupRef&&this.hasPopupData?this._createPopup():N.classList.add("popupTriggerArea"),e.append(N),e}getElementsToTriggerPopup(){return t(this,ie)}addHighlightArea(){this.container.classList.add("highlightArea")}}ie=new WeakMap,K=new WeakSet,ps=function(){var e;(e=this.downloadManager)==null||e.openOrDownloadData(this.container,this.content,this.filename)};class i{constructor({div:D,accessibilityManager:e,annotationCanvasMap:p,l10n:N,page:G,viewport:tt}){$(this,Gt);$(this,Pt);$(this,Nt,null);$(this,Dt,null);$(this,Xt,new Map);this.div=D,ot(this,Nt,e),ot(this,Dt,p),this.l10n=N,this.page=G,this.viewport=tt,this.zIndex=0,this.l10n||(this.l10n=gt.NullL10n)}async render(D){const{annotations:e}=D,p=this.div;(0,x.setLayerDimensions)(p,this.viewport);const N=new Map,G={data:null,layer:p,linkService:D.linkService,downloadManager:D.downloadManager,imageResourcesPath:D.imageResourcesPath||"",renderForms:D.renderForms!==!1,svgFactory:new x.DOMSVGFactory,annotationStorage:D.annotationStorage||new q.AnnotationStorage,enableScripting:D.enableScripting===!0,hasJSActions:D.hasJSActions,fieldObjects:D.fieldObjects,parent:this,elements:null};for(const tt of e){if(tt.noHTML)continue;const ht=tt.annotationType===r.AnnotationType.POPUP;if(ht){const It=N.get(tt.id);if(!It)continue;G.elements=It}else{const{width:It,height:Qt}=W(tt.rect);if(It<=0||Qt<=0)continue}G.data=tt;const wt=L.create(G);if(!wt.isRenderable)continue;if(!ht&&tt.popupRef){const It=N.get(tt.popupRef);It?It.push(wt):N.set(tt.popupRef,[wt])}wt.annotationEditorType>0&&t(this,Xt).set(wt.data.id,wt);const Lt=wt.render();tt.hidden&&(Lt.style.visibility="hidden"),Z(this,Gt,wn).call(this,Lt,tt.id)}Z(this,Pt,gs).call(this),await this.l10n.translate(p)}update({viewport:D}){const e=this.div;this.viewport=D,(0,x.setLayerDimensions)(e,{rotation:D.rotation}),Z(this,Pt,gs).call(this),e.hidden=!1}getEditableAnnotations(){return Array.from(t(this,Xt).values())}getEditableAnnotation(D){return t(this,Xt).get(D)}}Nt=new WeakMap,Dt=new WeakMap,Xt=new WeakMap,Gt=new WeakSet,wn=function(D,e){var N;const p=D.firstChild||D;p.id=`${r.AnnotationPrefix}${e}`,this.div.append(D),(N=t(this,Nt))==null||N.moveElementInDOM(this.div,D,p,!1)},Pt=new WeakSet,gs=function(){if(!t(this,Dt))return;const D=this.div;for(const[e,p]of t(this,Dt)){const N=D.querySelector(`[data-annotation-id="${e}"]`);if(!N)continue;const{firstChild:G}=N;G?G.nodeName==="CANVAS"?G.replaceWith(p):G.before(p):N.append(p)}t(this,Dt).clear()},o.AnnotationLayer=i},(U,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ColorConverters=void 0;function V(q){return Math.floor(Math.max(0,Math.min(1,q))*255).toString(16).padStart(2,"0")}function r(q){return Math.max(0,Math.min(255,255*q))}class x{static CMYK_G([Y,gt,z,F]){return["G",1-Math.min(1,.3*Y+.59*z+.11*gt+F)]}static G_CMYK([Y]){return["CMYK",0,0,0,1-Y]}static G_RGB([Y]){return["RGB",Y,Y,Y]}static G_rgb([Y]){return Y=r(Y),[Y,Y,Y]}static G_HTML([Y]){const gt=V(Y);return`#${gt}${gt}${gt}`}static RGB_G([Y,gt,z]){return["G",.3*Y+.59*gt+.11*z]}static RGB_rgb(Y){return Y.map(r)}static RGB_HTML(Y){return`#${Y.map(V).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([Y,gt,z,F]){return["RGB",1-Math.min(1,Y+F),1-Math.min(1,z+F),1-Math.min(1,gt+F)]}static CMYK_rgb([Y,gt,z,F]){return[r(1-Math.min(1,Y+F)),r(1-Math.min(1,z+F)),r(1-Math.min(1,gt+F))]}static CMYK_HTML(Y){const gt=this.CMYK_RGB(Y).slice(1);return this.RGB_HTML(gt)}static RGB_CMYK([Y,gt,z]){const F=1-Y,g=1-gt,H=1-z,W=Math.min(F,g,H);return["CMYK",F,g,H,W]}}o.ColorConverters=x},(U,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.NullL10n=void 0,o.getL10nFallback=r;const V={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};V.print_progress_percent="{{progress}}%";function r(Y,gt){switch(Y){case"find_match_count":Y=`find_match_count[${gt.total===1?"one":"other"}]`;break;case"find_match_count_limit":Y=`find_match_count_limit[${gt.limit===1?"one":"other"}]`;break}return V[Y]||""}function x(Y,gt){return gt?Y.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(z,F)=>F in gt?gt[F]:"{{"+F+"}}"):Y}const q={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(Y,gt=null,z=r(Y,gt)){return x(z,gt)},async translate(Y){}};o.NullL10n=q},(U,o,V)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.XfaLayer=void 0;var r=V(25);class x{static setupStorage(Y,gt,z,F,g){const H=F.getValue(gt,{value:null});switch(z.name){case"textarea":if(H.value!==null&&(Y.textContent=H.value),g==="print")break;Y.addEventListener("input",W=>{F.setValue(gt,{value:W.target.value})});break;case"input":if(z.attributes.type==="radio"||z.attributes.type==="checkbox"){if(H.value===z.attributes.xfaOn?Y.setAttribute("checked",!0):H.value===z.attributes.xfaOff&&Y.removeAttribute("checked"),g==="print")break;Y.addEventListener("change",W=>{F.setValue(gt,{value:W.target.checked?W.target.getAttribute("xfaOn"):W.target.getAttribute("xfaOff")})})}else{if(H.value!==null&&Y.setAttribute("value",H.value),g==="print")break;Y.addEventListener("input",W=>{F.setValue(gt,{value:W.target.value})})}break;case"select":if(H.value!==null){Y.setAttribute("value",H.value);for(const W of z.children)W.attributes.value===H.value?W.attributes.selected=!0:W.attributes.hasOwnProperty("selected")&&delete W.attributes.selected}Y.addEventListener("input",W=>{const L=W.target.options,E=L.selectedIndex===-1?"":L[L.selectedIndex].value;F.setValue(gt,{value:E})});break}}static setAttributes({html:Y,element:gt,storage:z=null,intent:F,linkService:g}){const{attributes:H}=gt,W=Y instanceof HTMLAnchorElement;H.type==="radio"&&(H.name=`${H.name}-${F}`);for(const[L,E]of Object.entries(H))if(E!=null)switch(L){case"class":E.length&&Y.setAttribute(L,E.join(" "));break;case"dataId":break;case"id":Y.setAttribute("data-element-id",E);break;case"style":Object.assign(Y.style,E);break;case"textContent":Y.textContent=E;break;default:(!W||L!=="href"&&L!=="newWindow")&&Y.setAttribute(L,E)}W&&g.addLinkAttributes(Y,H.href,H.newWindow),z&&H.dataId&&this.setupStorage(Y,H.dataId,gt,z)}static render(Y){var w;const gt=Y.annotationStorage,z=Y.linkService,F=Y.xfaHtml,g=Y.intent||"display",H=document.createElement(F.name);F.attributes&&this.setAttributes({html:H,element:F,intent:g,linkService:z});const W=[[F,-1,H]],L=Y.div;if(L.append(H),Y.viewport){const f=`matrix(${Y.viewport.transform.join(",")})`;L.style.transform=f}g!=="richText"&&L.setAttribute("class","xfaLayer xfaFont");const E=[];for(;W.length>0;){const[f,A,M]=W.at(-1);if(A+1===f.children.length){W.pop();continue}const k=f.children[++W.at(-1)[1]];if(k===null)continue;const{name:v}=k;if(v==="#text"){const h=document.createTextNode(k.value);E.push(h),M.append(h);continue}const l=(w=k==null?void 0:k.attributes)!=null&&w.xmlns?document.createElementNS(k.attributes.xmlns,v):document.createElement(v);if(M.append(l),k.attributes&&this.setAttributes({html:l,element:k,storage:gt,intent:g,linkService:z}),k.children&&k.children.length>0)W.push([k,-1,l]);else if(k.value){const h=document.createTextNode(k.value);r.XfaText.shouldBuildText(v)&&E.push(h),l.append(h)}}for(const f of L.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))f.setAttribute("readOnly",!0);return{textDivs:E}}static update(Y){const gt=`matrix(${Y.viewport.transform.join(",")})`;Y.div.style.transform=gt,Y.div.hidden=!1}}o.XfaLayer=x},(U,o,V)=>{var F,g,H,W,L,E,w,f,A,M,k,v,l,h,I,Cn,J,Tn,at,Pn,Ct,xn,ut,ms,yt,kn,bt,bs,Ut,Mn,T,Rn,a,Fn,c,Dn,b,On,B,Ee,nt,As,mt,Si,At,Ei,Vt,Ue,jt,ys,it,wi,vt,In,Ot,vs,Kt,Ln,Zt,Nn,O,_s,_,Ci,C,Be;Object.defineProperty(o,"__esModule",{value:!0}),o.InkEditor=void 0;var r=V(1),x=V(4),q=V(29),Y=V(6),gt=V(5);const dt=class dt extends x.AnnotationEditor{constructor(K){super({...K,name:"inkEditor"});$(this,I);$(this,J);$(this,at);$(this,Ct);$(this,ut);$(this,yt);$(this,bt);$(this,Ut);$(this,T);$(this,a);$(this,c);$(this,b);$(this,B);$(this,nt);$(this,mt);$(this,At);$(this,Vt);$(this,jt);$(this,it);$(this,Zt);$(this,O);$(this,_);$(this,C);$(this,F,0);$(this,g,0);$(this,H,this.canvasPointermove.bind(this));$(this,W,this.canvasPointerleave.bind(this));$(this,L,this.canvasPointerup.bind(this));$(this,E,this.canvasPointerdown.bind(this));$(this,w,new Path2D);$(this,f,!1);$(this,A,!1);$(this,M,!1);$(this,k,null);$(this,v,0);$(this,l,0);$(this,h,null);this.color=K.color||null,this.thickness=K.thickness||null,this.opacity=K.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(K){x.AnnotationEditor.initialize(K,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(K,Tt){switch(K){case r.AnnotationEditorParamsType.INK_THICKNESS:dt._defaultThickness=Tt;break;case r.AnnotationEditorParamsType.INK_COLOR:dt._defaultColor=Tt;break;case r.AnnotationEditorParamsType.INK_OPACITY:dt._defaultOpacity=Tt/100;break}}updateParams(K,Tt){switch(K){case r.AnnotationEditorParamsType.INK_THICKNESS:Z(this,I,Cn).call(this,Tt);break;case r.AnnotationEditorParamsType.INK_COLOR:Z(this,J,Tn).call(this,Tt);break;case r.AnnotationEditorParamsType.INK_OPACITY:Z(this,at,Pn).call(this,Tt);break}}static get defaultPropertiesToUpdate(){return[[r.AnnotationEditorParamsType.INK_THICKNESS,dt._defaultThickness],[r.AnnotationEditorParamsType.INK_COLOR,dt._defaultColor||x.AnnotationEditor._defaultLineColor],[r.AnnotationEditorParamsType.INK_OPACITY,Math.round(dt._defaultOpacity*100)]]}get propertiesToUpdate(){return[[r.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||dt._defaultThickness],[r.AnnotationEditorParamsType.INK_COLOR,this.color||dt._defaultColor||x.AnnotationEditor._defaultLineColor],[r.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??dt._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(Z(this,mt,Si).call(this),Z(this,At,Ei).call(this)),this.isAttachedToDOM||(this.parent.add(this),Z(this,Vt,Ue).call(this)),Z(this,C,Be).call(this)))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,t(this,k).disconnect(),ot(this,k,null),super.remove())}setParent(K){!this.parent&&K?this._uiManager.removeShouldRescale(this):this.parent&&K===null&&this._uiManager.addShouldRescale(this),super.setParent(K)}onScaleChanging(){const[K,Tt]=this.parentDimensions,Nt=this.width*K,Dt=this.height*Tt;this.setDimensions(Nt,Dt)}enableEditMode(){t(this,f)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",t(this,E)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",t(this,E)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){t(this,f)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),ot(this,f,!0),this.div.classList.add("disabled"),Z(this,C,Be).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(K){this._focusEventsAllowed&&(super.focusin(K),this.enableEditMode())}canvasPointerdown(K){K.button!==0||!this.isInEditMode()||t(this,f)||(this.setInForeground(),K.preventDefault(),K.type!=="mouse"&&this.div.focus(),Z(this,yt,kn).call(this,K.offsetX,K.offsetY))}canvasPointermove(K){K.preventDefault(),Z(this,bt,bs).call(this,K.offsetX,K.offsetY)}canvasPointerup(K){K.preventDefault(),Z(this,nt,As).call(this,K)}canvasPointerleave(K){Z(this,nt,As).call(this,K)}get isResizable(){return!this.isEmpty()&&t(this,f)}render(){if(this.div)return this.div;let K,Tt;this.width&&(K=this.x,Tt=this.y),super.render(),x.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(ne=>{var Pt;return(Pt=this.div)==null?void 0:Pt.setAttribute("aria-label",ne)});const[Nt,Dt,Xt,Gt]=Z(this,Ct,xn).call(this);if(this.setAt(Nt,Dt,0,0),this.setDims(Xt,Gt),Z(this,mt,Si).call(this),this.width){const[ne,Pt]=this.parentDimensions;this.setAspectRatio(this.width*ne,this.height*Pt),this.setAt(K*ne,Tt*Pt,this.width*ne,this.height*Pt),ot(this,M,!0),Z(this,Vt,Ue).call(this),this.setDims(this.width*ne,this.height*Pt),Z(this,B,Ee).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return Z(this,At,Ei).call(this),this.div}setDimensions(K,Tt){const Nt=Math.round(K),Dt=Math.round(Tt);if(t(this,v)===Nt&&t(this,l)===Dt)return;ot(this,v,Nt),ot(this,l,Dt),this.canvas.style.visibility="hidden";const[Xt,Gt]=this.parentDimensions;this.width=K/Xt,this.height=Tt/Gt,this.fixAndSetPosition(),t(this,f)&&Z(this,jt,ys).call(this,K,Tt),Z(this,Vt,Ue).call(this),Z(this,B,Ee).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(K,Tt,Nt){var G,tt,ht;if(K instanceof q.InkAnnotationElement)return null;const Dt=super.deserialize(K,Tt,Nt);Dt.thickness=K.thickness,Dt.color=r.Util.makeHexColor(...K.color),Dt.opacity=K.opacity;const[Xt,Gt]=Dt.pageDimensions,ne=Dt.width*Xt,Pt=Dt.height*Gt,se=Dt.parentScale,Wt=K.thickness/2;ot(Dt,f,!0),ot(Dt,v,Math.round(ne)),ot(Dt,l,Math.round(Pt));const{paths:D,rect:e,rotation:p}=K;for(let{bezier:wt}of D){wt=Z(G=dt,Kt,Ln).call(G,wt,e,p);const Lt=[];Dt.paths.push(Lt);let It=se*(wt[0]-Wt),Qt=se*(wt[1]-Wt);for(let zt=2,Yt=wt.length;zt<Yt;zt+=6){const ee=se*(wt[zt]-Wt),re=se*(wt[zt+1]-Wt),ae=se*(wt[zt+2]-Wt),ce=se*(wt[zt+3]-Wt),le=se*(wt[zt+4]-Wt),ge=se*(wt[zt+5]-Wt);Lt.push([[It,Qt],[ee,re],[ae,ce],[le,ge]]),It=le,Qt=ge}const Ht=Z(this,vt,In).call(this,Lt);Dt.bezierPath2D.push(Ht)}const N=Z(tt=Dt,O,_s).call(tt);return ot(Dt,g,Math.max(x.AnnotationEditor.MIN_SIZE,N[2]-N[0])),ot(Dt,F,Math.max(x.AnnotationEditor.MIN_SIZE,N[3]-N[1])),Z(ht=Dt,jt,ys).call(ht,ne,Pt),Dt}serialize(){if(this.isEmpty())return null;const K=this.getRect(0,0),Tt=x.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:r.AnnotationEditorType.INK,color:Tt,thickness:this.thickness,opacity:this.opacity,paths:Z(this,Zt,Nn).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,K),pageIndex:this.pageIndex,rect:K,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};F=new WeakMap,g=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakMap,E=new WeakMap,w=new WeakMap,f=new WeakMap,A=new WeakMap,M=new WeakMap,k=new WeakMap,v=new WeakMap,l=new WeakMap,h=new WeakMap,I=new WeakSet,Cn=function(K){const Tt=this.thickness;this.addCommands({cmd:()=>{this.thickness=K,Z(this,C,Be).call(this)},undo:()=>{this.thickness=Tt,Z(this,C,Be).call(this)},mustExec:!0,type:r.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},J=new WeakSet,Tn=function(K){const Tt=this.color;this.addCommands({cmd:()=>{this.color=K,Z(this,B,Ee).call(this)},undo:()=>{this.color=Tt,Z(this,B,Ee).call(this)},mustExec:!0,type:r.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},at=new WeakSet,Pn=function(K){K/=100;const Tt=this.opacity;this.addCommands({cmd:()=>{this.opacity=K,Z(this,B,Ee).call(this)},undo:()=>{this.opacity=Tt,Z(this,B,Ee).call(this)},mustExec:!0,type:r.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},Ct=new WeakSet,xn=function(){const{parentRotation:K,parentDimensions:[Tt,Nt]}=this;switch(K){case 90:return[0,Nt,Nt,Tt];case 180:return[Tt,Nt,Tt,Nt];case 270:return[Tt,0,Nt,Tt];default:return[0,0,Tt,Nt]}},ut=new WeakSet,ms=function(){const{ctx:K,color:Tt,opacity:Nt,thickness:Dt,parentScale:Xt,scaleFactor:Gt}=this;K.lineWidth=Dt*Xt/Gt,K.lineCap="round",K.lineJoin="round",K.miterLimit=10,K.strokeStyle=`${Tt}${(0,gt.opacityToHex)(Nt)}`},yt=new WeakSet,kn=function(K,Tt){this.canvas.addEventListener("contextmenu",Y.noContextMenu),this.canvas.addEventListener("pointerleave",t(this,W)),this.canvas.addEventListener("pointermove",t(this,H)),this.canvas.addEventListener("pointerup",t(this,L)),this.canvas.removeEventListener("pointerdown",t(this,E)),this.isEditing=!0,t(this,M)||(ot(this,M,!0),Z(this,Vt,Ue).call(this),this.thickness||(this.thickness=dt._defaultThickness),this.color||(this.color=dt._defaultColor||x.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=dt._defaultOpacity)),this.currentPath.push([K,Tt]),ot(this,A,!1),Z(this,ut,ms).call(this),ot(this,h,()=>{Z(this,a,Fn).call(this),t(this,h)&&window.requestAnimationFrame(t(this,h))}),window.requestAnimationFrame(t(this,h))},bt=new WeakSet,bs=function(K,Tt){const[Nt,Dt]=this.currentPath.at(-1);if(this.currentPath.length>1&&K===Nt&&Tt===Dt)return;const Xt=this.currentPath;let Gt=t(this,w);if(Xt.push([K,Tt]),ot(this,A,!0),Xt.length<=2){Gt.moveTo(...Xt[0]),Gt.lineTo(K,Tt);return}Xt.length===3&&(ot(this,w,Gt=new Path2D),Gt.moveTo(...Xt[0])),Z(this,c,Dn).call(this,Gt,...Xt.at(-3),...Xt.at(-2),K,Tt)},Ut=new WeakSet,Mn=function(){if(this.currentPath.length===0)return;const K=this.currentPath.at(-1);t(this,w).lineTo(...K)},T=new WeakSet,Rn=function(K,Tt){ot(this,h,null),K=Math.min(Math.max(K,0),this.canvas.width),Tt=Math.min(Math.max(Tt,0),this.canvas.height),Z(this,bt,bs).call(this,K,Tt),Z(this,Ut,Mn).call(this);let Nt;if(this.currentPath.length!==1)Nt=Z(this,b,On).call(this);else{const Pt=[K,Tt];Nt=[[Pt,Pt.slice(),Pt.slice(),Pt]]}const Dt=t(this,w),Xt=this.currentPath;this.currentPath=[],ot(this,w,new Path2D);const Gt=()=>{this.allRawPaths.push(Xt),this.paths.push(Nt),this.bezierPath2D.push(Dt),this.rebuild()},ne=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(Z(this,mt,Si).call(this),Z(this,At,Ei).call(this)),Z(this,C,Be).call(this))};this.addCommands({cmd:Gt,undo:ne,mustExec:!0})},a=new WeakSet,Fn=function(){if(!t(this,A))return;ot(this,A,!1);const K=Math.ceil(this.thickness*this.parentScale),Tt=this.currentPath.slice(-3),Nt=Tt.map(Gt=>Gt[0]),Dt=Tt.map(Gt=>Gt[1]);Math.min(...Nt)-K,Math.max(...Nt)+K,Math.min(...Dt)-K,Math.max(...Dt)+K;const{ctx:Xt}=this;Xt.save(),Xt.clearRect(0,0,this.canvas.width,this.canvas.height);for(const Gt of this.bezierPath2D)Xt.stroke(Gt);Xt.stroke(t(this,w)),Xt.restore()},c=new WeakSet,Dn=function(K,Tt,Nt,Dt,Xt,Gt,ne){const Pt=(Tt+Dt)/2,se=(Nt+Xt)/2,Wt=(Dt+Gt)/2,D=(Xt+ne)/2;K.bezierCurveTo(Pt+2*(Dt-Pt)/3,se+2*(Xt-se)/3,Wt+2*(Dt-Wt)/3,D+2*(Xt-D)/3,Wt,D)},b=new WeakSet,On=function(){const K=this.currentPath;if(K.length<=2)return[[K[0],K[0],K.at(-1),K.at(-1)]];const Tt=[];let Nt,[Dt,Xt]=K[0];for(Nt=1;Nt<K.length-2;Nt++){const[e,p]=K[Nt],[N,G]=K[Nt+1],tt=(e+N)/2,ht=(p+G)/2,wt=[Dt+2*(e-Dt)/3,Xt+2*(p-Xt)/3],Lt=[tt+2*(e-tt)/3,ht+2*(p-ht)/3];Tt.push([[Dt,Xt],wt,Lt,[tt,ht]]),[Dt,Xt]=[tt,ht]}const[Gt,ne]=K[Nt],[Pt,se]=K[Nt+1],Wt=[Dt+2*(Gt-Dt)/3,Xt+2*(ne-Xt)/3],D=[Pt+2*(Gt-Pt)/3,se+2*(ne-se)/3];return Tt.push([[Dt,Xt],Wt,D,[Pt,se]]),Tt},B=new WeakSet,Ee=function(){if(this.isEmpty()){Z(this,it,wi).call(this);return}Z(this,ut,ms).call(this);const{canvas:K,ctx:Tt}=this;Tt.setTransform(1,0,0,1,0,0),Tt.clearRect(0,0,K.width,K.height),Z(this,it,wi).call(this);for(const Nt of this.bezierPath2D)Tt.stroke(Nt)},nt=new WeakSet,As=function(K){this.canvas.removeEventListener("pointerleave",t(this,W)),this.canvas.removeEventListener("pointermove",t(this,H)),this.canvas.removeEventListener("pointerup",t(this,L)),this.canvas.addEventListener("pointerdown",t(this,E)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",Y.noContextMenu)},10),Z(this,T,Rn).call(this,K.offsetX,K.offsetY),this.addToAnnotationStorage(),this.setInBackground()},mt=new WeakSet,Si=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",x.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(K=>{var Tt;return(Tt=this.canvas)==null?void 0:Tt.setAttribute("aria-label",K)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},At=new WeakSet,Ei=function(){ot(this,k,new ResizeObserver(K=>{const Tt=K[0].contentRect;Tt.width&&Tt.height&&this.setDimensions(Tt.width,Tt.height)})),t(this,k).observe(this.div)},Vt=new WeakSet,Ue=function(){if(!t(this,M))return;const[K,Tt]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*K),this.canvas.height=Math.ceil(this.height*Tt),Z(this,it,wi).call(this)},jt=new WeakSet,ys=function(K,Tt){const Nt=Z(this,_,Ci).call(this),Dt=(K-Nt)/t(this,g),Xt=(Tt-Nt)/t(this,F);this.scaleFactor=Math.min(Dt,Xt)},it=new WeakSet,wi=function(){const K=Z(this,_,Ci).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+K,this.translationY*this.scaleFactor+K)},vt=new WeakSet,In=function(K){const Tt=new Path2D;for(let Nt=0,Dt=K.length;Nt<Dt;Nt++){const[Xt,Gt,ne,Pt]=K[Nt];Nt===0&&Tt.moveTo(...Xt),Tt.bezierCurveTo(Gt[0],Gt[1],ne[0],ne[1],Pt[0],Pt[1])}return Tt},Ot=new WeakSet,vs=function(K,Tt,Nt){const[Dt,Xt,Gt,ne]=Tt;switch(Nt){case 0:for(let Pt=0,se=K.length;Pt<se;Pt+=2)K[Pt]+=Dt,K[Pt+1]=ne-K[Pt+1];break;case 90:for(let Pt=0,se=K.length;Pt<se;Pt+=2){const Wt=K[Pt];K[Pt]=K[Pt+1]+Dt,K[Pt+1]=Wt+Xt}break;case 180:for(let Pt=0,se=K.length;Pt<se;Pt+=2)K[Pt]=Gt-K[Pt],K[Pt+1]+=Xt;break;case 270:for(let Pt=0,se=K.length;Pt<se;Pt+=2){const Wt=K[Pt];K[Pt]=Gt-K[Pt+1],K[Pt+1]=ne-Wt}break;default:throw new Error("Invalid rotation")}return K},Kt=new WeakSet,Ln=function(K,Tt,Nt){const[Dt,Xt,Gt,ne]=Tt;switch(Nt){case 0:for(let Pt=0,se=K.length;Pt<se;Pt+=2)K[Pt]-=Dt,K[Pt+1]=ne-K[Pt+1];break;case 90:for(let Pt=0,se=K.length;Pt<se;Pt+=2){const Wt=K[Pt];K[Pt]=K[Pt+1]-Xt,K[Pt+1]=Wt-Dt}break;case 180:for(let Pt=0,se=K.length;Pt<se;Pt+=2)K[Pt]=Gt-K[Pt],K[Pt+1]-=Xt;break;case 270:for(let Pt=0,se=K.length;Pt<se;Pt+=2){const Wt=K[Pt];K[Pt]=ne-K[Pt+1],K[Pt+1]=Gt-Wt}break;default:throw new Error("Invalid rotation")}return K},Zt=new WeakSet,Nn=function(K,Tt,Nt,Dt){var se,Wt;const Xt=[],Gt=this.thickness/2,ne=K*Tt+Gt,Pt=K*Nt+Gt;for(const D of this.paths){const e=[],p=[];for(let N=0,G=D.length;N<G;N++){const[tt,ht,wt,Lt]=D[N],It=K*tt[0]+ne,Qt=K*tt[1]+Pt,Ht=K*ht[0]+ne,zt=K*ht[1]+Pt,Yt=K*wt[0]+ne,ee=K*wt[1]+Pt,re=K*Lt[0]+ne,ae=K*Lt[1]+Pt;N===0&&(e.push(It,Qt),p.push(It,Qt)),e.push(Ht,zt,Yt,ee,re,ae),p.push(Ht,zt),N===G-1&&p.push(re,ae)}Xt.push({bezier:Z(se=dt,Ot,vs).call(se,e,Dt,this.rotation),points:Z(Wt=dt,Ot,vs).call(Wt,p,Dt,this.rotation)})}return Xt},O=new WeakSet,_s=function(){let K=1/0,Tt=-1/0,Nt=1/0,Dt=-1/0;for(const Xt of this.paths)for(const[Gt,ne,Pt,se]of Xt){const Wt=r.Util.bezierBoundingBox(...Gt,...ne,...Pt,...se);K=Math.min(K,Wt[0]),Nt=Math.min(Nt,Wt[1]),Tt=Math.max(Tt,Wt[2]),Dt=Math.max(Dt,Wt[3])}return[K,Nt,Tt,Dt]},_=new WeakSet,Ci=function(){return t(this,f)?Math.ceil(this.thickness*this.parentScale):0},C=new WeakSet,Be=function(K=!1){if(this.isEmpty())return;if(!t(this,f)){Z(this,B,Ee).call(this);return}const Tt=Z(this,O,_s).call(this),Nt=Z(this,_,Ci).call(this);ot(this,g,Math.max(x.AnnotationEditor.MIN_SIZE,Tt[2]-Tt[0])),ot(this,F,Math.max(x.AnnotationEditor.MIN_SIZE,Tt[3]-Tt[1]));const Dt=Math.ceil(Nt+t(this,g)*this.scaleFactor),Xt=Math.ceil(Nt+t(this,F)*this.scaleFactor),[Gt,ne]=this.parentDimensions;this.width=Dt/Gt,this.height=Xt/ne,this.setAspectRatio(Dt,Xt);const Pt=this.translationX,se=this.translationY;this.translationX=-Tt[0],this.translationY=-Tt[1],Z(this,Vt,Ue).call(this),Z(this,B,Ee).call(this),ot(this,v,Dt),ot(this,l,Xt),this.setDims(Dt,Xt);const Wt=K?Nt/this.scaleFactor/2:0;this.translate(Pt-this.translationX-Wt,se-this.translationY-Wt)},$(dt,vt),$(dt,Ot),$(dt,Kt),oe(dt,"_defaultColor",null),oe(dt,"_defaultOpacity",1),oe(dt,"_defaultThickness",1),oe(dt,"_type","ink");let z=dt;o.InkEditor=z},(U,o,V)=>{var z,F,g,H,W,L,E,w,f,A,M,Je,v,Qe,h,Ti,Q,Ss,_t,$n,xt,Un,j,Es,Et,Pi,et,Bn;Object.defineProperty(o,"__esModule",{value:!0}),o.StampEditor=void 0;var r=V(1),x=V(4),q=V(6),Y=V(29);const Rt=class Rt extends x.AnnotationEditor{constructor(T){super({...T,name:"stampEditor"});$(this,M);$(this,v);$(this,h);$(this,Q);$(this,_t);$(this,xt);$(this,j);$(this,Et);$(this,et);$(this,z,null);$(this,F,null);$(this,g,null);$(this,H,null);$(this,W,null);$(this,L,null);$(this,E,null);$(this,w,null);$(this,f,!1);$(this,A,!1);ot(this,H,T.bitmapUrl),ot(this,W,T.bitmapFile)}static initialize(T){x.AnnotationEditor.initialize(T)}static get supportedTypes(){const T=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,r.shadow)(this,"supportedTypes",T.map(i=>`image/${i}`))}static get supportedTypesStr(){return(0,r.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(T){return this.supportedTypes.includes(T)}static paste(T,i){i.pasteEditor(r.AnnotationEditorType.STAMP,{bitmapFile:T.getAsFile()})}remove(){var T,i;t(this,F)&&(ot(this,z,null),this._uiManager.imageManager.deleteId(t(this,F)),(T=t(this,L))==null||T.remove(),ot(this,L,null),(i=t(this,E))==null||i.disconnect(),ot(this,E,null)),super.remove()}rebuild(){if(!this.parent){t(this,F)&&Z(this,h,Ti).call(this);return}super.rebuild(),this.div!==null&&(t(this,F)&&Z(this,h,Ti).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(t(this,g)||t(this,z)||t(this,H)||t(this,W))}get isResizable(){return!0}render(){if(this.div)return this.div;let T,i;if(this.width&&(T=this.x,i=this.y),super.render(),this.div.hidden=!0,t(this,z)?Z(this,Q,Ss).call(this):Z(this,h,Ti).call(this),this.width){const[a,s]=this.parentDimensions;this.setAt(T*a,i*s,this.width*a,this.height*s)}return this.div}static deserialize(T,i,a){if(T instanceof Y.StampAnnotationElement)return null;const s=super.deserialize(T,i,a),{rect:c,bitmapUrl:d,bitmapId:b,isSvg:R,accessibilityData:B}=T;b&&a.imageManager.isValidId(b)?ot(s,F,b):ot(s,H,d),ot(s,f,R);const[lt,nt]=s.pageDimensions;return s.width=(c[2]-c[0])/lt,s.height=(c[3]-c[1])/nt,B&&(s.altTextData=B),s}serialize(T=!1,i=null){if(this.isEmpty())return null;const a={annotationType:r.AnnotationEditorType.STAMP,bitmapId:t(this,F),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:t(this,f),structTreeParentId:this._structTreeParentId};if(T)return a.bitmapUrl=Z(this,Et,Pi).call(this,!0),a.accessibilityData=this.altTextData,a;const{decorative:s,altText:c}=this.altTextData;if(!s&&c&&(a.accessibilityData={type:"Figure",alt:c}),i===null)return a;i.stamps||(i.stamps=new Map);const d=t(this,f)?(a.rect[2]-a.rect[0])*(a.rect[3]-a.rect[1]):null;if(!i.stamps.has(t(this,F)))i.stamps.set(t(this,F),{area:d,serialized:a}),a.bitmap=Z(this,Et,Pi).call(this,!1);else if(t(this,f)){const b=i.stamps.get(t(this,F));d>b.area&&(b.area=d,b.serialized.bitmap.close(),b.serialized.bitmap=Z(this,Et,Pi).call(this,!1))}return a}};z=new WeakMap,F=new WeakMap,g=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakMap,E=new WeakMap,w=new WeakMap,f=new WeakMap,A=new WeakMap,M=new WeakSet,Je=function(T,i=!1){if(!T){this.remove();return}ot(this,z,T.bitmap),i||(ot(this,F,T.id),ot(this,f,T.isSvg)),Z(this,Q,Ss).call(this)},v=new WeakSet,Qe=function(){ot(this,g,null),this._uiManager.enableWaiting(!1),t(this,L)&&this.div.focus()},h=new WeakSet,Ti=function(){if(t(this,F)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(t(this,F)).then(i=>Z(this,M,Je).call(this,i,!0)).finally(()=>Z(this,v,Qe).call(this));return}if(t(this,H)){const i=t(this,H);ot(this,H,null),this._uiManager.enableWaiting(!0),ot(this,g,this._uiManager.imageManager.getFromUrl(i).then(a=>Z(this,M,Je).call(this,a)).finally(()=>Z(this,v,Qe).call(this)));return}if(t(this,W)){const i=t(this,W);ot(this,W,null),this._uiManager.enableWaiting(!0),ot(this,g,this._uiManager.imageManager.getFromFile(i).then(a=>Z(this,M,Je).call(this,a)).finally(()=>Z(this,v,Qe).call(this)));return}const T=document.createElement("input");T.type="file",T.accept=Rt.supportedTypesStr,ot(this,g,new Promise(i=>{T.addEventListener("change",async()=>{if(!T.files||T.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const a=await this._uiManager.imageManager.getFromFile(T.files[0]);Z(this,M,Je).call(this,a)}i()}),T.addEventListener("cancel",()=>{this.remove(),i()})}).finally(()=>Z(this,v,Qe).call(this))),T.click()},Q=new WeakSet,Ss=function(){const{div:T}=this;let{width:i,height:a}=t(this,z);const[s,c]=this.pageDimensions,d=.75;if(this.width)i=this.width*s,a=this.height*c;else if(i>d*s||a>d*c){const lt=Math.min(d*s/i,d*c/a);i*=lt,a*=lt}const[b,R]=this.parentDimensions;this.setDims(i*b/s,a*R/c),this._uiManager.enableWaiting(!1);const B=ot(this,L,document.createElement("canvas"));T.append(B),T.hidden=!1,Z(this,j,Es).call(this,i,a),Z(this,et,Bn).call(this),t(this,A)||(this.parent.addUndoableEditor(this),ot(this,A,!0)),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()},_t=new WeakSet,$n=function(T,i){var d;const[a,s]=this.parentDimensions;this.width=T/a,this.height=i/s,this.setDims(T,i),(d=this._initialOptions)!=null&&d.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,t(this,w)!==null&&clearTimeout(t(this,w)),ot(this,w,setTimeout(()=>{ot(this,w,null),Z(this,j,Es).call(this,T,i)},200))},xt=new WeakSet,Un=function(T,i){const{width:a,height:s}=t(this,z);let c=a,d=s,b=t(this,z);for(;c>2*T||d>2*i;){const R=c,B=d;c>2*T&&(c=c>=16384?Math.floor(c/2)-1:Math.ceil(c/2)),d>2*i&&(d=d>=16384?Math.floor(d/2)-1:Math.ceil(d/2));const lt=new OffscreenCanvas(c,d);lt.getContext("2d").drawImage(b,0,0,R,B,0,0,c,d),b=lt.transferToImageBitmap()}return b},j=new WeakSet,Es=function(T,i){T=Math.ceil(T),i=Math.ceil(i);const a=t(this,L);if(!a||a.width===T&&a.height===i)return;a.width=T,a.height=i;const s=t(this,f)?t(this,z):Z(this,xt,Un).call(this,T,i),c=a.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(s,0,0,s.width,s.height,0,0,T,i)},Et=new WeakSet,Pi=function(T){if(T){if(t(this,f)){const s=this._uiManager.imageManager.getSvgUrl(t(this,F));if(s)return s}const i=document.createElement("canvas");return{width:i.width,height:i.height}=t(this,z),i.getContext("2d").drawImage(t(this,z),0,0),i.toDataURL()}if(t(this,f)){const[i,a]=this.pageDimensions,s=Math.round(this.width*i*q.PixelsPerInch.PDF_TO_CSS_UNITS),c=Math.round(this.height*a*q.PixelsPerInch.PDF_TO_CSS_UNITS),d=new OffscreenCanvas(s,c);return d.getContext("2d").drawImage(t(this,z),0,0,t(this,z).width,t(this,z).height,0,0,s,c),d.transferToImageBitmap()}return structuredClone(t(this,z))},et=new WeakSet,Bn=function(){ot(this,E,new ResizeObserver(T=>{const i=T[0].contentRect;i.width&&i.height&&Z(this,_t,$n).call(this,i.width,i.height)})),t(this,E).observe(this.div)},oe(Rt,"_type","stamp");let gt=Rt;o.StampEditor=gt}],y={};function P(U){var o=y[U];if(o!==void 0)return o.exports;var V=y[U]={exports:{}};return u[U](V,V.exports,P),V.exports}var ct={};return(()=>{var U=ct;Object.defineProperty(U,"__esModule",{value:!0}),Object.defineProperty(U,"AbortException",{enumerable:!0,get:function(){return o.AbortException}}),Object.defineProperty(U,"AnnotationEditorLayer",{enumerable:!0,get:function(){return q.AnnotationEditorLayer}}),Object.defineProperty(U,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return o.AnnotationEditorParamsType}}),Object.defineProperty(U,"AnnotationEditorType",{enumerable:!0,get:function(){return o.AnnotationEditorType}}),Object.defineProperty(U,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return Y.AnnotationEditorUIManager}}),Object.defineProperty(U,"AnnotationLayer",{enumerable:!0,get:function(){return gt.AnnotationLayer}}),Object.defineProperty(U,"AnnotationMode",{enumerable:!0,get:function(){return o.AnnotationMode}}),Object.defineProperty(U,"CMapCompressionType",{enumerable:!0,get:function(){return o.CMapCompressionType}}),Object.defineProperty(U,"DOMSVGFactory",{enumerable:!0,get:function(){return r.DOMSVGFactory}}),Object.defineProperty(U,"FeatureTest",{enumerable:!0,get:function(){return o.FeatureTest}}),Object.defineProperty(U,"GlobalWorkerOptions",{enumerable:!0,get:function(){return z.GlobalWorkerOptions}}),Object.defineProperty(U,"ImageKind",{enumerable:!0,get:function(){return o.ImageKind}}),Object.defineProperty(U,"InvalidPDFException",{enumerable:!0,get:function(){return o.InvalidPDFException}}),Object.defineProperty(U,"MissingPDFException",{enumerable:!0,get:function(){return o.MissingPDFException}}),Object.defineProperty(U,"OPS",{enumerable:!0,get:function(){return o.OPS}}),Object.defineProperty(U,"PDFDataRangeTransport",{enumerable:!0,get:function(){return V.PDFDataRangeTransport}}),Object.defineProperty(U,"PDFDateString",{enumerable:!0,get:function(){return r.PDFDateString}}),Object.defineProperty(U,"PDFWorker",{enumerable:!0,get:function(){return V.PDFWorker}}),Object.defineProperty(U,"PasswordResponses",{enumerable:!0,get:function(){return o.PasswordResponses}}),Object.defineProperty(U,"PermissionFlag",{enumerable:!0,get:function(){return o.PermissionFlag}}),Object.defineProperty(U,"PixelsPerInch",{enumerable:!0,get:function(){return r.PixelsPerInch}}),Object.defineProperty(U,"PromiseCapability",{enumerable:!0,get:function(){return o.PromiseCapability}}),Object.defineProperty(U,"RenderingCancelledException",{enumerable:!0,get:function(){return r.RenderingCancelledException}}),Object.defineProperty(U,"SVGGraphics",{enumerable:!0,get:function(){return V.SVGGraphics}}),Object.defineProperty(U,"UnexpectedResponseException",{enumerable:!0,get:function(){return o.UnexpectedResponseException}}),Object.defineProperty(U,"Util",{enumerable:!0,get:function(){return o.Util}}),Object.defineProperty(U,"VerbosityLevel",{enumerable:!0,get:function(){return o.VerbosityLevel}}),Object.defineProperty(U,"XfaLayer",{enumerable:!0,get:function(){return F.XfaLayer}}),Object.defineProperty(U,"build",{enumerable:!0,get:function(){return V.build}}),Object.defineProperty(U,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return o.createValidAbsoluteUrl}}),Object.defineProperty(U,"getDocument",{enumerable:!0,get:function(){return V.getDocument}}),Object.defineProperty(U,"getFilenameFromUrl",{enumerable:!0,get:function(){return r.getFilenameFromUrl}}),Object.defineProperty(U,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return r.getPdfFilenameFromUrl}}),Object.defineProperty(U,"getXfaPageViewport",{enumerable:!0,get:function(){return r.getXfaPageViewport}}),Object.defineProperty(U,"isDataScheme",{enumerable:!0,get:function(){return r.isDataScheme}}),Object.defineProperty(U,"isPdfFile",{enumerable:!0,get:function(){return r.isPdfFile}}),Object.defineProperty(U,"loadScript",{enumerable:!0,get:function(){return r.loadScript}}),Object.defineProperty(U,"noContextMenu",{enumerable:!0,get:function(){return r.noContextMenu}}),Object.defineProperty(U,"normalizeUnicode",{enumerable:!0,get:function(){return o.normalizeUnicode}}),Object.defineProperty(U,"renderTextLayer",{enumerable:!0,get:function(){return x.renderTextLayer}}),Object.defineProperty(U,"setLayerDimensions",{enumerable:!0,get:function(){return r.setLayerDimensions}}),Object.defineProperty(U,"shadow",{enumerable:!0,get:function(){return o.shadow}}),Object.defineProperty(U,"updateTextLayer",{enumerable:!0,get:function(){return x.updateTextLayer}}),Object.defineProperty(U,"version",{enumerable:!0,get:function(){return V.version}});var o=P(1),V=P(2),r=P(6),x=P(26),q=P(27),Y=P(5),gt=P(29),z=P(14),F=P(32)})(),ct})())})(an);var Hn=an.exports,Dr=Object.defineProperty,Or=Object.getOwnPropertyDescriptor,Ir=(m,n,u,y)=>{for(var P=y>1?void 0:y?Or(n,u):n,ct=m.length-1,U;ct>=0;ct--)(U=m[ct])&&(P=(y?U(n,u,P):U(P))||P);return y&&P&&Dr(n,u,P),P};Hn.GlobalWorkerOptions.workerSrc="pdf.worker.js";let ws=class extends be{constructor(){super(...arguments),this.tabIndex=0,this._onkeydown=m=>{m.key==="ArrowRight"?(this.currentPage++,this.fireSelectEvent()):m.key==="ArrowLeft"&&(this.currentPage--,this.fireSelectEvent())},this._touchStartX=0,this._onTouchStart=m=>{this._touchStartX=m.touches[0].clientX},this._onTouchEnd=m=>{const n=m.changedTouches[0].clientX,u=50;this._touchStartX-n>u?(this.currentPage++,this.fireSelectEvent()):n-this._touchStartX>u&&(this.currentPage--,this.fireSelectEvent())}}render(){return pe`
      <slot>
        <p>
          Get your sheet together!
          <br>
          Load a PDF ⬆️
          <br>
          or try <a href="#" @click=${()=>this.load("martin.pdf")}>Bratec Martin</a> example
        </p>
      </slot>
    `}async load(m){this.innerHTML="";const n=window.devicePixelRatio||1,u=await Hn.getDocument(m).promise;for(let y=0;y<u.numPages;y++){const P=await u.getPage(y+1),ct=P.getViewport({scale:1}),U=document.createElement("canvas"),o=U.getContext("2d");U.height=ct.height*n,U.width=ct.width*n,this.appendChild(U),U.onclick=()=>{this.currentPage=y,this.fireSelectEvent()};const V=n!==1?[n,0,0,n,0,0]:void 0;await P.render({canvasContext:o,viewport:ct,transform:V}).promise}}set currentPage(m){const n=[...this.children];m=Math.max(0,Math.min(n.length-1,m));const u=n[m];n.forEach(y=>y.removeAttribute("selected")),u.setAttribute("selected",""),u.scrollIntoView({block:"center"})}get currentPage(){return[...this.children].findIndex(m=>m.hasAttribute("selected"))}connectedCallback(){super.connectedCallback(),this.addEventListener("keydown",this._onkeydown),this.addEventListener("touchstart",this._onTouchStart),this.addEventListener("touchend",this._onTouchEnd)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("keydown",this._onkeydown),this.removeEventListener("touchstart",this._onTouchStart),this.removeEventListener("touchend",this._onTouchEnd)}fireSelectEvent(){this.dispatchEvent(new CustomEvent("select",{detail:this.currentPage}))}};ws.styles=ve`
    :host {
      min-height: 50px;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      align-items: center;
      overflow: auto;
      padding: 0.5rem;
      outline: none;
    }
    :host:focus {
      background: var(--theme-color-background-light);
    }
    :host:fullscreen {
      background: black;
    }
    ::slotted(canvas) {
      max-height: 100%;
      max-width: 100%;
    }
    ::slotted(canvas[selected]) {
      box-shadow: 0 0 0 5px var(--theme-color-primary);
    }
    p {
      text-align: center;
    }
  `;ws=Ir([we("pdf-viewer")],ws);var Lr=Object.defineProperty,Nr=Object.getOwnPropertyDescriptor,ci=(m,n,u,y)=>{for(var P=y>1?void 0:y?Nr(n,u):n,ct=m.length-1,U;ct>=0;ct--)(U=m[ct])&&(P=(y?U(n,u,P):U(P))||P);return y&&P&&Lr(n,u,P),P};const Gs=localStorage.getItem("recognitionOptions"),di=Gs?JSON.parse(Gs):{minDistance:7,maxDistance:42,seekStep:2.6,treshold:100},ui={minDistance:"Shortest seek distance from current frame.",maxDistance:"Longest seek distance from current frame.",seekStep:"How many frames to add to seek distance when recognizer predicts the same frame as before.",treshold:"How different a frame from recording can be to be considered a match. 0 means identical, 255 means completely different."};let Re=class extends be{constructor(){super(...arguments),this.minDistance=di.minDistance,this.maxDistance=di.maxDistance,this.seekStep=di.seekStep,this.treshold=di.treshold}render(){return pe`
      <div>
        <label for="minDistance" title=${ui.minDistance}>Min Distance</label>
        <input 
          type="number" id="minDistance"
          min="1" max=${this.maxDistance-1}
          .value=${this.minDistance.toString()} 
          @change=${m=>{this.minDistance=Number(m.target.value),this.maxDistance=Math.max(this.minDistance+1,this.maxDistance)}} />
      </div>
      <div>
        <label for="maxDistance" title=${ui.maxDistance}>Max Distance</label>
        <input 
          type="number" id="maxDistance" 
          min=${this.minDistance+1}
          .value=${this.maxDistance.toString()}
          @change=${m=>{this.maxDistance=Number(m.target.value),this.minDistance=Math.max(0,Math.min(this.maxDistance-1,this.minDistance))}} />
      </div>
      <div>
        <label for="seekStep" title=${ui.seekStep}>Seek Step</label>
        <input 
          type="number" id="seekStep"
          step=".1" min="1"
          .value=${this.seekStep.toString()} 
          @change=${m=>this.seekStep=Number(m.target.value)} />
      </div>
      <div>
        <label for="treshold" title=${ui.treshold}>Treshold</label>
        <input 
          type="number" id="treshold" 
          min="0" max="255" 
          .value=${this.treshold.toString()} 
          @input=${m=>this.treshold=Number(m.target.value)} 
        />
      </div>
    `}updated(){localStorage.setItem("recognitionOptions",JSON.stringify({minDistance:this.minDistance,maxDistance:this.maxDistance,seekStep:this.seekStep,treshold:this.treshold}))}};Re.styles=ve`
    :host {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 1em;
      justify-content: center;
      margin: 0 auto;
    }
    div {
      min-width: 120px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
    }
    input {
      margin: 0.5em 0;
      width: 6ch;
    }

  `;ci([he({type:Number})],Re.prototype,"minDistance",2);ci([he({type:Number})],Re.prototype,"maxDistance",2);ci([he({type:Number})],Re.prototype,"seekStep",2);ci([he({type:Number})],Re.prototype,"treshold",2);Re=ci([we("recognition-options")],Re);var $r=Object.defineProperty,Ur=Object.getOwnPropertyDescriptor,jn=(m,n,u,y)=>{for(var P=y>1?void 0:y?Ur(n,u):n,ct=m.length-1,U;ct>=0;ct--)(U=m[ct])&&(P=(y?U(n,u,P):U(P))||P);return y&&P&&$r(n,u,P),P};let Hi=1,Fi=class extends be{constructor(){super(...arguments),this.position=0}render(){return this.recording?pe`
      <div class="container">
        ${this.recording.markings.map((m,n)=>{const[u,y]=m;return pe`
            <div
              class="mark"
              style="left: ${u/this.recording.data.length*100}%"
              @click=${()=>{this.dispatchEvent(new CustomEvent("select",{detail:{position:u,mark:y}}))}}
              @dblclick=${()=>{this.recording.markings.splice(n,1),this.requestUpdate(),this.fireChangeEvent(),Hi=y}}
            >${y.toString()}</div>
          `})}
      </div>

      <button
        @click=${()=>{const m=parseInt(prompt("Input page number",Hi.toString())||"0");!m||m<1||(Hi=m+1,this.recording.markings.push([this.position,m]),this.recording.markings.sort((n,u)=>n[0]-u[0]),this.requestUpdate(),this.fireChangeEvent())}}
      >Add Mark</button> 

      Double tap to remove
    `:null}fireChangeEvent(){this.dispatchEvent(new CustomEvent("change"))}};Fi.styles=[ks,ve`
      :host {
        display: block;
        text-align: center;
      }
      .container {
        position: relative;
        height: 1rem;
        margin-bottom: .5rem;
      }
      .mark {
        position: absolute;
        transform: translateX(-50%);
        border-radius: 50%;
        background: var(--theme-color-background-light);
        width: 1rem;
        height: 1rem;
        font-size: .7rem;
        line-height: 1rem;
        text-align: center;
        cursor: pointer;
        user-select: none;
      }
      .mark::before {
        content: '';
        position: absolute;
        top: 0;
        left: 50%;
        transform: translate(-50%, -20%) rotate(45deg);
        width: .5rem;
        height: .5rem;
        background: var(--theme-color-background-light);
        z-index: -1;
      }
    `];jn([he({type:Object})],Fi.prototype,"recording",2);Fi=jn([we("markings-editor")],Fi);function Xs(m,n,u){return m+(n-m)*u}function Br(m,n,u){return(u-m)/(n-m)}function Hr(m,n){return Math.abs(m-n)}var jr=Object.defineProperty,Wr=Object.getOwnPropertyDescriptor,hi=(m,n,u,y)=>{for(var P=y>1?void 0:y?Wr(n,u):n,ct=m.length-1,U;ct>=0;ct--)(U=m[ct])&&(P=(y?U(n,u,P):U(P))||P);return y&&P&&jr(n,u,P),P};let Fe=class extends be{constructor(){super(...arguments),this.value=0,this.min=0,this.max=100,this.step=1}render(){return pe`
      <div 
        class="container"
        tabindex="0"
        @pointerdown=${this._handlePointer}
        @keydown=${this._handleKey}
      >
        <div class="track"></div>
        <div class="thumb" style="left: ${Xs(0,100,Br(this.min,this.max,this.value))}%"></div>
      </div>
    `}_handlePointer(m){const n=y=>{const P=this.getBoundingClientRect(),ct=(y.clientX-P.left)/P.width,U=Xs(this.min,this.max,ct);this.value=Math.max(this.min,Math.min(this.max,Math.round(U/this.step)*this.step)),this._fireChangeEvent()},u=y=>{n(y),document.removeEventListener("pointermove",n),document.removeEventListener("pointerup",u),document.removeEventListener("pointercancel",u)};n(m),document.addEventListener("pointermove",n),document.addEventListener("pointerup",u),document.addEventListener("pointercancel",u)}_handleKey(m){switch(m.key){case"ArrowLeft":case"ArrowDown":this.value=Math.max(this.min,this.value-this.step),this._fireChangeEvent();break;case"ArrowRight":case"ArrowUp":this.value=Math.min(this.max,this.value+this.step),this._fireChangeEvent();break;case"Home":this.value=this.min,this._fireChangeEvent();break;case"End":this.value=this.max,this._fireChangeEvent();break}}_fireChangeEvent(){this.dispatchEvent(new CustomEvent("change",{detail:this.value}))}};Fe.styles=ve`
    :host {
      display: block;
      width: 100%;
    }
    .container {
      position: relative;
      width: 100%;
      height: 1em;
    }
    .track {
      position: absolute;
      top: 50%;
      left: 0;
      width: 100%;
      height: .1em;
      background: var(--theme-color-background-light);
      transform: translateY(-50%);
      border-radius: .1em;
      pointer-events: none;
    }
    .thumb {
      position: absolute;
      top: 50%;
      left: 0;
      width: .8em;
      height: .8em;
      background: var(--theme-color-primary);
      transform: translate(-50%, -50%);
      border-radius: .5em;
      /* pass clicks trough */
      pointer-events: none;
    }
    .container:focus .thumb {
      width: 1em;
      height: 1em;
    }
  `;hi([he({type:Number})],Fe.prototype,"value",2);hi([he({type:Number})],Fe.prototype,"min",2);hi([he({type:Number})],Fe.prototype,"max",2);hi([he({type:Number})],Fe.prototype,"step",2);Fe=hi([we("input-slider")],Fe);const zr=ve`
  input {
    background: var(--theme-color-background-light);
    border: none;
    outline: none;
    display: block;
    /* box-sizing: border-box; */
  }

  input[type="range"] {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    margin: .4em 0;
    border-radius: .1em;
    cursor: pointer;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    width: .2em;
    height: .2em;
    border-radius: .1em;
    background: var(--theme-color-primary);
    transform: scale(5);
  }
  input[type="range"]:focus::-webkit-slider-thumb {
    transform: scale(6);
  }

`;class Gr{constructor(n){this.recording=n,this.position=0,this.searchDistance=1}getDifferences(n,u=0,y=this.recording.data.length){return new Uint8Array(this.recording.data.slice(u,y).map(P=>new Uint8Array(P.map((ct,U)=>Hr(ct,n[U])))).map(P=>Math.max(...P)))}guess(n,{treshold:u=100,minDistance:y=7,maxDistance:P=42,seekStep:ct=1.618}={}){if(this.position>=this.recording.data.length-this.searchDistance)return{over:!0};const U=this.getDifferences(n,this.position,this.position+Math.max(Math.round(this.searchDistance),y)),o=Math.min(...U),V=this.position+U.lastIndexOf(o);o>u||V===this.position?this.searchDistance=Math.min(this.searchDistance+ct,P):(this.searchDistance=1,this.position=V);const r=this.recording.markings.length?this.recording.markings.reduce((x,q)=>q[0]<=this.position?q:x)[1]:void 0;return{position:this.position,mark:r,differences:U}}}class ei{constructor(){this.data=[],this.markings=[]}clear(){this.data.length=0,this.markings.length=0}export(){return{data:this.data.map(u=>{const y=[];let P=u[0],ct=1;for(let U=1;U<u.length;U++)u[U]===P?ct++:(ct>1?y.push([P,ct]):y.push(P),P=u[U],ct=1);return ct>1?y.push([P,ct]):y.push(P),y}),markings:this.markings}}static import({data:n,markings:u}){const y=new ei;for(const P of n){const ct=[];for(const U of P)if(Array.isArray(U)){const[o,V]=U;ct.push(...new Array(V).fill(o))}else ct.push(U);y.data.push(new Uint8Array(ct))}return y.markings=u,y}createFollower(){return new Gr(this)}}const Fs=(()=>{if(typeof self>"u")return!1;if("top"in self&&self!==top)try{top.window.document._=0}catch{return!1}return"showOpenFilePicker"in self})(),Xr=Fs?Promise.resolve().then(function(){return Jr}):Promise.resolve().then(function(){return sa});async function Vs(...m){return(await Xr).default(...m)}Fs?Promise.resolve().then(function(){return Zr}):Promise.resolve().then(function(){return ra});const Vr=Fs?Promise.resolve().then(function(){return ea}):Promise.resolve().then(function(){return oa});async function qr(...m){return(await Vr).default(...m)}const Yr=async m=>{const n=await m.getFile();return n.handle=m,n};var Kr=async(m=[{}])=>{Array.isArray(m)||(m=[m]);const n=[];m.forEach((P,ct)=>{n[ct]={description:P.description||"Files",accept:{}},P.mimeTypes?P.mimeTypes.map(U=>{n[ct].accept[U]=P.extensions||[]}):n[ct].accept["*/*"]=P.extensions||[]});const u=await window.showOpenFilePicker({id:m[0].id,startIn:m[0].startIn,types:n,multiple:m[0].multiple||!1,excludeAcceptAllOption:m[0].excludeAcceptAllOption||!1}),y=await Promise.all(u.map(Yr));return m[0].multiple?y:y[0]},Jr={__proto__:null,default:Kr};function xi(m){function n(u){if(Object(u)!==u)return Promise.reject(new TypeError(u+" is not an object."));var y=u.done;return Promise.resolve(u.value).then(function(P){return{value:P,done:y}})}return xi=function(u){this.s=u,this.n=u.next},xi.prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(u){var y=this.s.return;return y===void 0?Promise.resolve({value:u,done:!0}):n(y.apply(this.s,arguments))},throw:function(u){var y=this.s.return;return y===void 0?Promise.reject(u):n(y.apply(this.s,arguments))}},new xi(m)}const Wn=async(m,n,u=m.name,y)=>{const P=[],ct=[];var U,o=!1,V=!1;try{for(var r,x=function(q){var Y,gt,z,F=2;for(typeof Symbol<"u"&&(gt=Symbol.asyncIterator,z=Symbol.iterator);F--;){if(gt&&(Y=q[gt])!=null)return Y.call(q);if(z&&(Y=q[z])!=null)return new xi(Y.call(q));gt="@@asyncIterator",z="@@iterator"}throw new TypeError("Object is not async iterable")}(m.values());o=!(r=await x.next()).done;o=!1){const q=r.value,Y=`${u}/${q.name}`;q.kind==="file"?ct.push(q.getFile().then(gt=>(gt.directoryHandle=m,gt.handle=q,Object.defineProperty(gt,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>Y})))):q.kind!=="directory"||!n||y&&y(q)||P.push(Wn(q,n,Y,y))}}catch(q){V=!0,U=q}finally{try{o&&x.return!=null&&await x.return()}finally{if(V)throw U}}return[...(await Promise.all(P)).flat(),...await Promise.all(ct)]};var Qr=async(m={})=>{m.recursive=m.recursive||!1,m.mode=m.mode||"read";const n=await window.showDirectoryPicker({id:m.id,startIn:m.startIn,mode:m.mode});return(await(await n.values()).next()).done?[n]:Wn(n,m.recursive,void 0,m.skipDirectory)},Zr={__proto__:null,default:Qr},ta=async(m,n=[{}],u=null,y=!1,P=null)=>{Array.isArray(n)||(n=[n]),n[0].fileName=n[0].fileName||"Untitled";const ct=[];let U=null;if(m instanceof Blob&&m.type?U=m.type:m.headers&&m.headers.get("content-type")&&(U=m.headers.get("content-type")),n.forEach((r,x)=>{ct[x]={description:r.description||"Files",accept:{}},r.mimeTypes?(x===0&&U&&r.mimeTypes.push(U),r.mimeTypes.map(q=>{ct[x].accept[q]=r.extensions||[]})):U?ct[x].accept[U]=r.extensions||[]:ct[x].accept["*/*"]=r.extensions||[]}),u)try{await u.getFile()}catch(r){if(u=null,y)throw r}const o=u||await window.showSaveFilePicker({suggestedName:n[0].fileName,id:n[0].id,startIn:n[0].startIn,types:ct,excludeAcceptAllOption:n[0].excludeAcceptAllOption||!1});!u&&P&&P(o);const V=await o.createWritable();return"stream"in m?(await m.stream().pipeTo(V),o):"body"in m?(await m.body.pipeTo(V),o):(await V.write(await m),await V.close(),o)},ea={__proto__:null,default:ta},ia=async(m=[{}])=>(Array.isArray(m)||(m=[m]),new Promise((n,u)=>{const y=document.createElement("input");y.type="file";const P=[...m.map(V=>V.mimeTypes||[]),...m.map(V=>V.extensions||[])].join();y.multiple=m[0].multiple||!1,y.accept=P||"",y.style.display="none",document.body.append(y);const ct=V=>{typeof U=="function"&&U(),n(V)},U=m[0].legacySetup&&m[0].legacySetup(ct,()=>U(u),y),o=()=>{window.removeEventListener("focus",o),y.remove()};y.addEventListener("click",()=>{window.addEventListener("focus",o)}),y.addEventListener("change",()=>{window.removeEventListener("focus",o),y.remove(),ct(y.multiple?Array.from(y.files):y.files[0])}),"showPicker"in HTMLInputElement.prototype?y.showPicker():y.click()})),sa={__proto__:null,default:ia},na=async(m=[{}])=>(Array.isArray(m)||(m=[m]),m[0].recursive=m[0].recursive||!1,new Promise((n,u)=>{const y=document.createElement("input");y.type="file",y.webkitdirectory=!0;const P=U=>{typeof ct=="function"&&ct(),n(U)},ct=m[0].legacySetup&&m[0].legacySetup(P,()=>ct(u),y);y.addEventListener("change",()=>{let U=Array.from(y.files);m[0].recursive?m[0].recursive&&m[0].skipDirectory&&(U=U.filter(o=>o.webkitRelativePath.split("/").every(V=>!m[0].skipDirectory({name:V,kind:"directory"})))):U=U.filter(o=>o.webkitRelativePath.split("/").length===2),P(U)}),"showPicker"in HTMLInputElement.prototype?y.showPicker():y.click()})),ra={__proto__:null,default:na},aa=async(m,n={})=>{Array.isArray(n)&&(n=n[0]);const u=document.createElement("a");let y=m;"body"in m&&(y=await async function(U,o){const V=U.getReader(),r=new ReadableStream({start:Y=>async function gt(){return V.read().then(({done:z,value:F})=>{if(!z)return Y.enqueue(F),gt();Y.close()})}()}),x=new Response(r),q=await x.blob();return V.releaseLock(),new Blob([q],{type:o})}(m.body,m.headers.get("content-type"))),u.download=n.fileName||"Untitled",u.href=URL.createObjectURL(await y);const P=()=>{typeof ct=="function"&&ct()},ct=n.legacySetup&&n.legacySetup(P,()=>ct(),u);return u.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(u.href),3e4),P()}),u.click(),null},oa={__proto__:null,default:aa};function Ds(m){return new Promise((n,u)=>{m.oncomplete=m.onsuccess=()=>n(m.result),m.onabort=m.onerror=()=>u(m.error)})}function la(m,n){const u=indexedDB.open(m);u.onupgradeneeded=()=>u.result.createObjectStore(n);const y=Ds(u);return(P,ct)=>y.then(U=>ct(U.transaction(n,P).objectStore(n)))}let ji;function zn(){return ji||(ji=la("keyval-store","keyval")),ji}function qs(m,n=zn()){return n("readonly",u=>Ds(u.get(m)))}function Wi(m,n,u=zn()){return u("readwrite",y=>(y.put(n,m),Ds(y.transaction)))}var ca=Object.defineProperty,ha=Object.getOwnPropertyDescriptor,fe=(m,n,u,y)=>{for(var P=y>1?void 0:y?ha(n,u):n,ct=m.length-1,U;ct>=0;ct--)(U=m[ct])&&(P=(y?U(n,u,P):U(P))||P);return y&&P&&ca(n,u,P),P};let de=class extends be{constructor(){super(...arguments),this.savedState=!0,this.recentAvailable=!1,this.position=0}render(){return[this.renderHeader(),this.renderViewer(),this.renderRecording(),this.renderPageTurner()]}updated(m){if(m.has("position")){if(this.follower&&(this.follower.position=this.position),!this.scrollable)return;const n=this.scrollable.scrollWidth-this.scrollable.clientWidth,u=this.position/this.recording.data.length;this.scrollable.scrollTo({left:u*n,behavior:"auto"})}}connectedCallback(){super.connectedCallback(),this.loadRecent()}async loadRecent(){this.recentPDF=await qs("pdf"),this.recentRecording=await qs("recording")}renderHeader(){var m;return pe`
      <header>

        <button
          title="Open PDF"
          @click=${async()=>{const n=await Vs({mimeTypes:["application/pdf"]}),u=await n.arrayBuffer();this.viewer.load(u),n.handle&&Wi("pdf",n.handle)}}
        >
          📄 Sheet
        </button>

        <button
          ?hidden=${!this.recentPDF}
          title="Open Recent PDF - ${(m=this.recentPDF)==null?void 0:m.name}"
          @click=${async()=>{if(!this.recentPDF||!await Ys(this.recentPDF))return;const u=await(await this.recentPDF.getFile()).arrayBuffer();await this.viewer.load(u),this.recentPDF=void 0}}
        >
          🕒
        </button>

        <button
          title="Fullscreen"
          @click=${()=>{this.viewer.requestFullscreen(),this.viewer.focus()}}
        >
          ↗️
        </button>

      </header>
    `}renderViewer(){return pe`
      <pdf-viewer
        @select=${m=>{if(!this.recording)return;const n=this.recording.markings.filter(y=>y[1]===m.detail+1);if(n.length===0)return;const u=n.reduce((y,P)=>Math.abs(P[0]-this.position)<Math.abs(y[0]-this.position)?P:y);this.position=u[0]}}
      ></pdf-viewer>
    `}renderRecording(){var m,n;return pe`
      <collapsable-container
        id="recording"
        .title=${"Recording"+(this.recordingFile?" - "+this.recordingFile.name.replace(/\.json$/,""):"")}
        .description=${this.savedState?"":"Unsaved changes"}
      >
        <frequency-recorder
          id="recorder"
          title="Record"
          slot="header"
          @data=${u=>{this.recording.data.push(u.detail)}}
          @start=${()=>{this.recognizer.stop(),this.recording=new ei}}
          @stop=${()=>{this.spectrogram.requestUpdate(),this.markings.requestUpdate(),this.savedState=!1,this.recordingFile=void 0,this.recordingElement.setAttribute("open",""),this.position=0}}
        >
          🎙 Record
        </frequency-recorder>

        <button
          title="Open Recording"
          slot="header"
          @click=${async()=>{const u=await Vs({mimeTypes:["application/json"]}),y=await u.text();this.recordingElement.setAttribute("open",""),u.handle&&(this.recordingFile=u.handle,Wi("recording",u.handle)),this.recording=ei.import(JSON.parse(y)),this.savedState=!0,this.position=0}}
        >
          📂
        </button>

        <button
          ?hidden=${!this.recentRecording}
          title="Open Recent Recording - ${(m=this.recentRecording)==null?void 0:m.name}"
          slot="header"
          @click=${async()=>{if(!this.recentRecording||!await Ys(this.recentRecording))return;const y=await(await this.recentRecording.getFile()).text();this.recordingElement.setAttribute("open",""),this.recording=ei.import(JSON.parse(y)),this.recordingFile=this.recentRecording,this.recentRecording=void 0,this.savedState=!0,this.position=0}}
        >
          🕒
        </button>

        <button
          title="Save Recording"
          slot="header"
          ?hidden=${this.savedState}
          @click=${async()=>{if(!this.recording)return;const u=JSON.stringify(this.recording.export()),y=new Blob([u],{type:"application/json"}),P=await qr(y,{fileName:"Recording.json",extensions:[".json"]},this.recordingFile);this.savedState=!0,P&&(this.recordingFile=P,Wi("recording",P))}}
        >
          💾
        </button>

        ${this.recording?pe`
              <div class="container">
                <div
                  id="scrollable"
                  @mousewheel=${u=>{this.recording&&(u.preventDefault(),this.position=Math.max(0,Math.min(this.recording.data.length,this.position+u.deltaX+u.deltaY)))}}
                >
                  <graph-2d
                    id="spectrogram"
                    .data=${((n=this.recording)==null?void 0:n.data)||[]}
                    @select=${u=>{if(!this.recording)return;const{column:y,row:P}=u.detail;console.log(`Frame: ${y}, Row: ${P}, Value: ${this.recording.data[y][P]}`),this.position=y}}
                  ></graph-2d>

                  <graph-1d id="similarity"></graph-1d>
                </div>

                <input-slider
                  id="position"
                  .max=${this.recording.data.length}
                  .value=${this.position}
                  @change=${u=>{this.recording&&(this.position=u.detail)}}
                ></input-slider>
                
                <markings-editor
                  .recording=${this.recording}
                  .position=${this.position}
                  @select=${u=>{const{position:y}=u.detail;this.position=y}}
                  @change=${()=>{this.recording&&(this.savedState=!1)}}
                ></markings-editor>

              </div>
            `:pe`
              <p>Make a recording to use the automatic page turner feature.</p>
            `}

      </collapsable-container>
    `}renderPageTurner(){return pe`
      <collapsable-container .title=${"Page Turner"} ?hidden=${!this.recording}>

        <frequency-recorder
          id="recognizer"
          title="Recognize"
          slot="header"
          @data=${m=>{if(!this.follower||!this.recording)return;const{position:n,mark:u,differences:y,over:P}=this.follower.guess(m.detail,this.recognitionOptions);if(P)return this.recognizer.stop();this.position=n||0;const ct=new Uint8Array(this.recording.data.length);y==null||y.forEach((U,o)=>ct[o+this.position]=U),this.similarity.data=ct,u&&(this.viewer.currentPage=u-1)}}
          @start=${()=>{this.recording&&(this.follower=this.recording.createFollower(),this.recorder.stop(),this.position=0,this.follower.searchDistance=0)}}
        >
          🔎 Recognize
        </frequency-recorder>

        <recognition-options></recognition-options>

      </collapsable-container>
    `}};de.styles=[zr,ks,ve`
      :host {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100%;
      }

      header {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.5em;
        margin: 10px;
      }

      pdf-viewer {
        flex: 1;
      }

      #position {
        width: 100%;
      }

      #scrollable {
        overflow: hidden;
        border: 1px solid grey;
        background: var(--color-black);
      }

      .container {
        width: min-content;
        max-width: 100%;
        margin: 0 auto;
      }
    `];fe([ye("pdf-viewer")],de.prototype,"viewer",2);fe([ye("#recording")],de.prototype,"recordingElement",2);fe([ye("#recorder")],de.prototype,"recorder",2);fe([ye("#scrollable")],de.prototype,"scrollable",2);fe([ye("#spectrogram")],de.prototype,"spectrogram",2);fe([ye("#similarity")],de.prototype,"similarity",2);fe([ye("#position")],de.prototype,"positionSlider",2);fe([ye("markings-editor")],de.prototype,"markings",2);fe([ye("#recognizer")],de.prototype,"recognizer",2);fe([ye("recognition-options")],de.prototype,"recognitionOptions",2);fe([he({type:Object})],de.prototype,"recording",2);fe([he({type:Object})],de.prototype,"recordingFile",2);fe([he({type:Boolean})],de.prototype,"savedState",2);fe([he({type:Boolean})],de.prototype,"recentAvailable",2);fe([he({type:Object})],de.prototype,"recentPDF",2);fe([he({type:Object})],de.prototype,"recentRecording",2);fe([he({type:Number})],de.prototype,"position",2);de=fe([we("my-app")],de);async function Ys(m,n=!1){const u=n?{mode:"readwrite"}:{};return await m.queryPermission(u)==="granted"||await m.requestPermission(u)==="granted"}
