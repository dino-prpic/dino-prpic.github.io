var Kn=Object.defineProperty;var Jn=(f,n,h)=>n in f?Kn(f,n,{enumerable:!0,configurable:!0,writable:!0,value:h}):f[n]=h;var oe=(f,n,h)=>(Jn(f,typeof n!="symbol"?n+"":n,h),h),Ni=(f,n,h)=>{if(!n.has(f))throw TypeError("Cannot "+h)};var t=(f,n,h)=>(Ni(f,n,"read from private field"),h?h.call(f):n.get(f)),U=(f,n,h)=>{if(n.has(f))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(f):n.set(f,h)},ot=(f,n,h,b)=>(Ni(f,n,"write to private field"),b?b.call(f,h):n.set(f,h),h);var Ge=(f,n,h,b)=>({set _(E){ot(f,n,E,h)},get _(){return t(f,n,b)}}),Z=(f,n,h)=>(Ni(f,n,"access private method"),h);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))b(E);new MutationObserver(E=>{for(const lt of E)if(lt.type==="childList")for(const $ of lt.addedNodes)$.tagName==="LINK"&&$.rel==="modulepreload"&&b($)}).observe(document,{childList:!0,subtree:!0});function h(E){const lt={};return E.integrity&&(lt.integrity=E.integrity),E.referrerPolicy&&(lt.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?lt.credentials="include":E.crossOrigin==="anonymous"?lt.credentials="omit":lt.credentials="same-origin",lt}function b(E){if(E.ep)return;E.ep=!0;const lt=h(E);fetch(E.href,lt)}})();/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const fi=globalThis,xs=fi.ShadowRoot&&(fi.ShadyCSS===void 0||fi.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Ps=Symbol(),Ls=new WeakMap;let tn=class{constructor(n,h,b){if(this._$cssResult$=!0,b!==Ps)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=n,this.t=h}get styleSheet(){let n=this.o;const h=this.t;if(xs&&n===void 0){const b=h!==void 0&&h.length===1;b&&(n=Ls.get(h)),n===void 0&&((this.o=n=new CSSStyleSheet).replaceSync(this.cssText),b&&Ls.set(h,n))}return n}toString(){return this.cssText}};const Qn=f=>new tn(typeof f=="string"?f:f+"",void 0,Ps),ve=(f,...n)=>{const h=f.length===1?f[0]:n.reduce((b,E,lt)=>b+($=>{if($._$cssResult$===!0)return $.cssText;if(typeof $=="number")return $;throw Error("Value passed to 'css' function must be a 'css' function result: "+$+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(E)+f[lt+1],f[0]);return new tn(h,f,Ps)},Zn=(f,n)=>{if(xs)f.adoptedStyleSheets=n.map(h=>h instanceof CSSStyleSheet?h:h.styleSheet);else for(const h of n){const b=document.createElement("style"),E=fi.litNonce;E!==void 0&&b.setAttribute("nonce",E),b.textContent=h.cssText,f.appendChild(b)}},Ns=xs?f=>f:f=>f instanceof CSSStyleSheet?(n=>{let h="";for(const b of n.cssRules)h+=b.cssText;return Qn(h)})(f):f;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:tr,defineProperty:er,getOwnPropertyDescriptor:ir,getOwnPropertyNames:sr,getOwnPropertySymbols:nr,getPrototypeOf:rr}=Object,Te=globalThis,$s=Te.trustedTypes,ar=$s?$s.emptyScript:"",$i=Te.reactiveElementPolyfillSupport,ti=(f,n)=>f,Mi={toAttribute(f,n){switch(n){case Boolean:f=f?ar:null;break;case Object:case Array:f=f==null?f:JSON.stringify(f)}return f},fromAttribute(f,n){let h=f;switch(n){case Boolean:h=f!==null;break;case Number:h=f===null?null:Number(f);break;case Object:case Array:try{h=JSON.parse(f)}catch{h=null}}return h}},ks=(f,n)=>!tr(f,n),Us={attribute:!0,type:String,converter:Mi,reflect:!1,hasChanged:ks};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Te.litPropertyMetadata??(Te.litPropertyMetadata=new WeakMap);let Ie=class extends HTMLElement{static addInitializer(n){this._$Ei(),(this.l??(this.l=[])).push(n)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(n,h=Us){if(h.state&&(h.attribute=!1),this._$Ei(),this.elementProperties.set(n,h),!h.noAccessor){const b=Symbol(),E=this.getPropertyDescriptor(n,b,h);E!==void 0&&er(this.prototype,n,E)}}static getPropertyDescriptor(n,h,b){const{get:E,set:lt}=ir(this.prototype,n)??{get(){return this[h]},set($){this[h]=$}};return{get(){return E==null?void 0:E.call(this)},set($){const o=E==null?void 0:E.call(this);lt.call(this,$),this.requestUpdate(n,o,b)},configurable:!0,enumerable:!0}}static getPropertyOptions(n){return this.elementProperties.get(n)??Us}static _$Ei(){if(this.hasOwnProperty(ti("elementProperties")))return;const n=rr(this);n.finalize(),n.l!==void 0&&(this.l=[...n.l]),this.elementProperties=new Map(n.elementProperties)}static finalize(){if(this.hasOwnProperty(ti("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(ti("properties"))){const h=this.properties,b=[...sr(h),...nr(h)];for(const E of b)this.createProperty(E,h[E])}const n=this[Symbol.metadata];if(n!==null){const h=litPropertyMetadata.get(n);if(h!==void 0)for(const[b,E]of h)this.elementProperties.set(b,E)}this._$Eh=new Map;for(const[h,b]of this.elementProperties){const E=this._$Eu(h,b);E!==void 0&&this._$Eh.set(E,h)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(n){const h=[];if(Array.isArray(n)){const b=new Set(n.flat(1/0).reverse());for(const E of b)h.unshift(Ns(E))}else n!==void 0&&h.push(Ns(n));return h}static _$Eu(n,h){const b=h.attribute;return b===!1?void 0:typeof b=="string"?b:typeof n=="string"?n.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var n;this._$ES=new Promise(h=>this.enableUpdating=h),this._$AL=new Map,this._$E_(),this.requestUpdate(),(n=this.constructor.l)==null||n.forEach(h=>h(this))}addController(n){var h;(this._$EO??(this._$EO=new Set)).add(n),this.renderRoot!==void 0&&this.isConnected&&((h=n.hostConnected)==null||h.call(n))}removeController(n){var h;(h=this._$EO)==null||h.delete(n)}_$E_(){const n=new Map,h=this.constructor.elementProperties;for(const b of h.keys())this.hasOwnProperty(b)&&(n.set(b,this[b]),delete this[b]);n.size>0&&(this._$Ep=n)}createRenderRoot(){const n=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Zn(n,this.constructor.elementStyles),n}connectedCallback(){var n;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(n=this._$EO)==null||n.forEach(h=>{var b;return(b=h.hostConnected)==null?void 0:b.call(h)})}enableUpdating(n){}disconnectedCallback(){var n;(n=this._$EO)==null||n.forEach(h=>{var b;return(b=h.hostDisconnected)==null?void 0:b.call(h)})}attributeChangedCallback(n,h,b){this._$AK(n,b)}_$EC(n,h){var lt;const b=this.constructor.elementProperties.get(n),E=this.constructor._$Eu(n,b);if(E!==void 0&&b.reflect===!0){const $=(((lt=b.converter)==null?void 0:lt.toAttribute)!==void 0?b.converter:Mi).toAttribute(h,b.type);this._$Em=n,$==null?this.removeAttribute(E):this.setAttribute(E,$),this._$Em=null}}_$AK(n,h){var lt;const b=this.constructor,E=b._$Eh.get(n);if(E!==void 0&&this._$Em!==E){const $=b.getPropertyOptions(E),o=typeof $.converter=="function"?{fromAttribute:$.converter}:((lt=$.converter)==null?void 0:lt.fromAttribute)!==void 0?$.converter:Mi;this._$Em=E,this[E]=o.fromAttribute(h,$.type),this._$Em=null}}requestUpdate(n,h,b){if(n!==void 0){if(b??(b=this.constructor.getPropertyOptions(n)),!(b.hasChanged??ks)(this[n],h))return;this.P(n,h,b)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(n,h,b){this._$AL.has(n)||this._$AL.set(n,h),b.reflect===!0&&this._$Em!==n&&(this._$Ej??(this._$Ej=new Set)).add(n)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(h){Promise.reject(h)}const n=this.scheduleUpdate();return n!=null&&await n,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var b;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[lt,$]of this._$Ep)this[lt]=$;this._$Ep=void 0}const E=this.constructor.elementProperties;if(E.size>0)for(const[lt,$]of E)$.wrapped!==!0||this._$AL.has(lt)||this[lt]===void 0||this.P(lt,this[lt],$)}let n=!1;const h=this._$AL;try{n=this.shouldUpdate(h),n?(this.willUpdate(h),(b=this._$EO)==null||b.forEach(E=>{var lt;return(lt=E.hostUpdate)==null?void 0:lt.call(E)}),this.update(h)):this._$EU()}catch(E){throw n=!1,this._$EU(),E}n&&this._$AE(h)}willUpdate(n){}_$AE(n){var h;(h=this._$EO)==null||h.forEach(b=>{var E;return(E=b.hostUpdated)==null?void 0:E.call(b)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(n)),this.updated(n)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(n){return!0}update(n){this._$Ej&&(this._$Ej=this._$Ej.forEach(h=>this._$EC(h,this[h]))),this._$EU()}updated(n){}firstUpdated(n){}};Ie.elementStyles=[],Ie.shadowRootOptions={mode:"open"},Ie[ti("elementProperties")]=new Map,Ie[ti("finalized")]=new Map,$i==null||$i({ReactiveElement:Ie}),(Te.reactiveElementVersions??(Te.reactiveElementVersions=[])).push("2.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ei=globalThis,Ri=ei.trustedTypes,Bs=Ri?Ri.createPolicy("lit-html",{createHTML:f=>f}):void 0,en="$lit$",Ce=`lit$${(Math.random()+"").slice(9)}$`,sn="?"+Ce,or=`<${sn}>`,Me=document,ii=()=>Me.createComment(""),si=f=>f===null||typeof f!="object"&&typeof f!="function",nn=Array.isArray,lr=f=>nn(f)||typeof(f==null?void 0:f[Symbol.iterator])=="function",Ui=`[ 	
\f\r]`,Xe=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Hs=/-->/g,js=/>/g,xe=RegExp(`>|${Ui}(?:([^\\s"'>=/]+)(${Ui}*=${Ui}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Ws=/'/g,zs=/"/g,rn=/^(?:script|style|textarea|title)$/i,cr=f=>(n,...h)=>({_$litType$:f,strings:n,values:h}),pe=cr(1),je=Symbol.for("lit-noChange"),ue=Symbol.for("lit-nothing"),Gs=new WeakMap,ke=Me.createTreeWalker(Me,129);function an(f,n){if(!Array.isArray(f)||!f.hasOwnProperty("raw"))throw Error("invalid template strings array");return Bs!==void 0?Bs.createHTML(n):n}const hr=(f,n)=>{const h=f.length-1,b=[];let E,lt=n===2?"<svg>":"",$=Xe;for(let o=0;o<h;o++){const X=f[o];let r,x,q=-1,Y=0;for(;Y<X.length&&($.lastIndex=Y,x=$.exec(X),x!==null);)Y=$.lastIndex,$===Xe?x[1]==="!--"?$=Hs:x[1]!==void 0?$=js:x[2]!==void 0?(rn.test(x[2])&&(E=RegExp("</"+x[2],"g")),$=xe):x[3]!==void 0&&($=xe):$===xe?x[0]===">"?($=E??Xe,q=-1):x[1]===void 0?q=-2:(q=$.lastIndex-x[2].length,r=x[1],$=x[3]===void 0?xe:x[3]==='"'?zs:Ws):$===zs||$===Ws?$=xe:$===Hs||$===js?$=Xe:($=xe,E=void 0);const gt=$===xe&&f[o+1].startsWith("/>")?" ":"";lt+=$===Xe?X+or:q>=0?(b.push(r),X.slice(0,q)+en+X.slice(q)+Ce+gt):X+Ce+(q===-2?o:gt)}return[an(f,lt+(f[h]||"<?>")+(n===2?"</svg>":"")),b]};class ni{constructor({strings:n,_$litType$:h},b){let E;this.parts=[];let lt=0,$=0;const o=n.length-1,X=this.parts,[r,x]=hr(n,h);if(this.el=ni.createElement(r,b),ke.currentNode=this.el.content,h===2){const q=this.el.content.firstChild;q.replaceWith(...q.childNodes)}for(;(E=ke.nextNode())!==null&&X.length<o;){if(E.nodeType===1){if(E.hasAttributes())for(const q of E.getAttributeNames())if(q.endsWith(en)){const Y=x[$++],gt=E.getAttribute(q).split(Ce),z=/([.?@])?(.*)/.exec(Y);X.push({type:1,index:lt,name:z[2],strings:gt,ctor:z[1]==="."?ur:z[1]==="?"?fr:z[1]==="@"?pr:Ii}),E.removeAttribute(q)}else q.startsWith(Ce)&&(X.push({type:6,index:lt}),E.removeAttribute(q));if(rn.test(E.tagName)){const q=E.textContent.split(Ce),Y=q.length-1;if(Y>0){E.textContent=Ri?Ri.emptyScript:"";for(let gt=0;gt<Y;gt++)E.append(q[gt],ii()),ke.nextNode(),X.push({type:2,index:++lt});E.append(q[Y],ii())}}}else if(E.nodeType===8)if(E.data===sn)X.push({type:2,index:lt});else{let q=-1;for(;(q=E.data.indexOf(Ce,q+1))!==-1;)X.push({type:7,index:lt}),q+=Ce.length-1}lt++}}static createElement(n,h){const b=Me.createElement("template");return b.innerHTML=n,b}}function We(f,n,h=f,b){var $,o;if(n===je)return n;let E=b!==void 0?($=h._$Co)==null?void 0:$[b]:h._$Cl;const lt=si(n)?void 0:n._$litDirective$;return(E==null?void 0:E.constructor)!==lt&&((o=E==null?void 0:E._$AO)==null||o.call(E,!1),lt===void 0?E=void 0:(E=new lt(f),E._$AT(f,h,b)),b!==void 0?(h._$Co??(h._$Co=[]))[b]=E:h._$Cl=E),E!==void 0&&(n=We(f,E._$AS(f,n.values),E,b)),n}class dr{constructor(n,h){this._$AV=[],this._$AN=void 0,this._$AD=n,this._$AM=h}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(n){const{el:{content:h},parts:b}=this._$AD,E=((n==null?void 0:n.creationScope)??Me).importNode(h,!0);ke.currentNode=E;let lt=ke.nextNode(),$=0,o=0,X=b[0];for(;X!==void 0;){if($===X.index){let r;X.type===2?r=new li(lt,lt.nextSibling,this,n):X.type===1?r=new X.ctor(lt,X.name,X.strings,this,n):X.type===6&&(r=new gr(lt,this,n)),this._$AV.push(r),X=b[++o]}$!==(X==null?void 0:X.index)&&(lt=ke.nextNode(),$++)}return ke.currentNode=Me,E}p(n){let h=0;for(const b of this._$AV)b!==void 0&&(b.strings!==void 0?(b._$AI(n,b,h),h+=b.strings.length-2):b._$AI(n[h])),h++}}class li{get _$AU(){var n;return((n=this._$AM)==null?void 0:n._$AU)??this._$Cv}constructor(n,h,b,E){this.type=2,this._$AH=ue,this._$AN=void 0,this._$AA=n,this._$AB=h,this._$AM=b,this.options=E,this._$Cv=(E==null?void 0:E.isConnected)??!0}get parentNode(){let n=this._$AA.parentNode;const h=this._$AM;return h!==void 0&&(n==null?void 0:n.nodeType)===11&&(n=h.parentNode),n}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(n,h=this){n=We(this,n,h),si(n)?n===ue||n==null||n===""?(this._$AH!==ue&&this._$AR(),this._$AH=ue):n!==this._$AH&&n!==je&&this._(n):n._$litType$!==void 0?this.$(n):n.nodeType!==void 0?this.T(n):lr(n)?this.k(n):this._(n)}S(n){return this._$AA.parentNode.insertBefore(n,this._$AB)}T(n){this._$AH!==n&&(this._$AR(),this._$AH=this.S(n))}_(n){this._$AH!==ue&&si(this._$AH)?this._$AA.nextSibling.data=n:this.T(Me.createTextNode(n)),this._$AH=n}$(n){var lt;const{values:h,_$litType$:b}=n,E=typeof b=="number"?this._$AC(n):(b.el===void 0&&(b.el=ni.createElement(an(b.h,b.h[0]),this.options)),b);if(((lt=this._$AH)==null?void 0:lt._$AD)===E)this._$AH.p(h);else{const $=new dr(E,this),o=$.u(this.options);$.p(h),this.T(o),this._$AH=$}}_$AC(n){let h=Gs.get(n.strings);return h===void 0&&Gs.set(n.strings,h=new ni(n)),h}k(n){nn(this._$AH)||(this._$AH=[],this._$AR());const h=this._$AH;let b,E=0;for(const lt of n)E===h.length?h.push(b=new li(this.S(ii()),this.S(ii()),this,this.options)):b=h[E],b._$AI(lt),E++;E<h.length&&(this._$AR(b&&b._$AB.nextSibling,E),h.length=E)}_$AR(n=this._$AA.nextSibling,h){var b;for((b=this._$AP)==null?void 0:b.call(this,!1,!0,h);n&&n!==this._$AB;){const E=n.nextSibling;n.remove(),n=E}}setConnected(n){var h;this._$AM===void 0&&(this._$Cv=n,(h=this._$AP)==null||h.call(this,n))}}class Ii{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(n,h,b,E,lt){this.type=1,this._$AH=ue,this._$AN=void 0,this.element=n,this.name=h,this._$AM=E,this.options=lt,b.length>2||b[0]!==""||b[1]!==""?(this._$AH=Array(b.length-1).fill(new String),this.strings=b):this._$AH=ue}_$AI(n,h=this,b,E){const lt=this.strings;let $=!1;if(lt===void 0)n=We(this,n,h,0),$=!si(n)||n!==this._$AH&&n!==je,$&&(this._$AH=n);else{const o=n;let X,r;for(n=lt[0],X=0;X<lt.length-1;X++)r=We(this,o[b+X],h,X),r===je&&(r=this._$AH[X]),$||($=!si(r)||r!==this._$AH[X]),r===ue?n=ue:n!==ue&&(n+=(r??"")+lt[X+1]),this._$AH[X]=r}$&&!E&&this.j(n)}j(n){n===ue?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,n??"")}}let ur=class extends Ii{constructor(){super(...arguments),this.type=3}j(n){this.element[this.name]=n===ue?void 0:n}};class fr extends Ii{constructor(){super(...arguments),this.type=4}j(n){this.element.toggleAttribute(this.name,!!n&&n!==ue)}}class pr extends Ii{constructor(n,h,b,E,lt){super(n,h,b,E,lt),this.type=5}_$AI(n,h=this){if((n=We(this,n,h,0)??ue)===je)return;const b=this._$AH,E=n===ue&&b!==ue||n.capture!==b.capture||n.once!==b.once||n.passive!==b.passive,lt=n!==ue&&(b===ue||E);E&&this.element.removeEventListener(this.name,this,b),lt&&this.element.addEventListener(this.name,this,n),this._$AH=n}handleEvent(n){var h;typeof this._$AH=="function"?this._$AH.call(((h=this.options)==null?void 0:h.host)??this.element,n):this._$AH.handleEvent(n)}}class gr{constructor(n,h,b){this.element=n,this.type=6,this._$AN=void 0,this._$AM=h,this.options=b}get _$AU(){return this._$AM._$AU}_$AI(n){We(this,n)}}const Bi=ei.litHtmlPolyfillSupport;Bi==null||Bi(ni,li),(ei.litHtmlVersions??(ei.litHtmlVersions=[])).push("3.1.2");const mr=(f,n,h)=>{const b=(h==null?void 0:h.renderBefore)??n;let E=b._$litPart$;if(E===void 0){const lt=(h==null?void 0:h.renderBefore)??null;b._$litPart$=E=new li(n.insertBefore(ii(),lt),lt,void 0,h??{})}return E._$AI(f),E};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let be=class extends Ie{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var h;const n=super.createRenderRoot();return(h=this.renderOptions).renderBefore??(h.renderBefore=n.firstChild),n}update(n){const h=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(n),this._$Do=mr(h,this.renderRoot,this.renderOptions)}connectedCallback(){var n;super.connectedCallback(),(n=this._$Do)==null||n.setConnected(!0)}disconnectedCallback(){var n;super.disconnectedCallback(),(n=this._$Do)==null||n.setConnected(!1)}render(){return je}};var Zs;be._$litElement$=!0,be.finalized=!0,(Zs=globalThis.litElementHydrateSupport)==null||Zs.call(globalThis,{LitElement:be});const Hi=globalThis.litElementPolyfillSupport;Hi==null||Hi({LitElement:be});(globalThis.litElementVersions??(globalThis.litElementVersions=[])).push("4.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const we=f=>(n,h)=>{h!==void 0?h.addInitializer(()=>{customElements.define(f,n)}):customElements.define(f,n)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const br={attribute:!0,type:String,converter:Mi,reflect:!1,hasChanged:ks},Ar=(f=br,n,h)=>{const{kind:b,metadata:E}=h;let lt=globalThis.litPropertyMetadata.get(E);if(lt===void 0&&globalThis.litPropertyMetadata.set(E,lt=new Map),lt.set(h.name,f),b==="accessor"){const{name:$}=h;return{set(o){const X=n.get.call(this);n.set.call(this,o),this.requestUpdate($,X,f)},init(o){return o!==void 0&&this.P($,void 0,f),o}}}if(b==="setter"){const{name:$}=h;return function(o){const X=this[$];n.call(this,o),this.requestUpdate($,X,f)}}throw Error("Unsupported decorator location: "+b)};function he(f){return(n,h)=>typeof h=="object"?Ar(f,n,h):((b,E,lt)=>{const $=E.hasOwnProperty(lt);return E.constructor.createProperty(lt,$?{...b,wrapped:!0}:b),$?Object.getOwnPropertyDescriptor(E,lt):void 0})(f,n,h)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Xs=(f,n,h)=>(h.configurable=!0,h.enumerable=!0,Reflect.decorate&&typeof n!="object"&&Object.defineProperty(f,n,h),h);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function ye(f,n){return(h,b,E)=>{const lt=$=>{var o;return((o=$.renderRoot)==null?void 0:o.querySelector(f))??null};if(n){const{get:$,set:o}=typeof b=="object"?h:E??(()=>{const X=Symbol();return{get(){return this[X]},set(r){this[X]=r}}})();return Xs(h,b,{get(){let X=$.call(this);return X===void 0&&(X=lt(this),(X!==null||this.hasUpdated)&&o.call(this,X)),X}})}return Xs(h,b,{get(){return lt(this)}})}}var yr=Object.defineProperty,vr=Object.getOwnPropertyDescriptor,Ms=(f,n,h,b)=>{for(var E=b>1?void 0:b?vr(n,h):n,lt=f.length-1,$;lt>=0;lt--)($=f[lt])&&(E=(b?$(n,h,E):$(E))||E);return b&&E&&yr(n,h,E),E};let ri=class extends be{constructor(){super(...arguments),this.title="",this.description=""}render(){return pe`
      <div class="header">
        <div class="info" @click=${()=>{this.toggleAttribute("open")}}>
          <h3 class="title">${this.title}</h3>
          <p class="description">${this.description}</p>
        </div>
        <div class="tools">
          <slot name="header"></slot>
        </div>
      </div>

      <div class="content" @focusin=${()=>this.setAttribute("open","")}>
        <slot></slot>
      </div>
    `}};ri.styles=ve`
    :host {
      display: grid;
      grid-template-rows: 1fr 0fr;
      grid-template-columns: 1fr;
      box-sizing: border-box;
      border-top: 1px solid var(--theme-color-background-light);
      transition: grid-template-rows .2s;
    }
    :host([open]) {
      grid-template-rows: auto 1fr;
    }
    :host([hidden]) {
      grid-template-rows: 0fr 0fr;
      transition: display 0s .5s, grid-template-rows .5s;
      display: none;
    }

    .content {
      opacity: 0;
      transition: opacity 0.5s;
      overflow: hidden;
      padding: 0 1em;
      box-sizing: border-box;
      transition: padding 0.5s;
    }
    :host([open]) .content {
      opacity: 1;
      padding: 0 1em 1em;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1em;
      overflow: hidden;
      min-height: 0;
      transition: padding .5s;
    }
    :host([hidden]) .header {
      padding: 0 1em;
    }
    .info {
      font-size: .9em;
      cursor: pointer;
      flex: 1;
    }
    .title, .description {
      display: block;
      margin: 0;
    }
    .tools {
      display: flex;
      gap: .5em;
    }

  `;Ms([he({type:String})],ri.prototype,"title",2);Ms([he({type:String})],ri.prototype,"description",2);ri=Ms([we("collapsable-container")],ri);const Rs=ve`
  button {
    background: var(--theme-color-background-light);
    border: none;
    outline: none;
    border-radius: 0.5em;
    padding: 0.5em 1em;
    color: var(--theme-color-text);
    cursor: pointer;
    font-weight: bold;
    text-transform: uppercase;
  }
  button:hover {
    scale: 1.05;
  }
  button:focus {
    box-shadow: 0 0 0 2px var(--theme-color-text-light);
  }
`;var _r=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),Sr=async(f,n)=>await(await fetch(f,n)).arrayBuffer(),Er=async({url:f,simdUrl:n},h)=>{const b=await _r()?n:f;return await Sr(b,h)},wr="@sapphi-red/web-noise-suppressor/rnnoise",Cr=class extends AudioWorkletNode{constructor(f,{maxChannels:n,wasmBinary:h}){const b={processorOptions:{maxChannels:n,wasmBinary:h}};super(f,wr,b)}destroy(){this.port.postMessage("destroy")}};const Tr="/assets/workletProcessor-aE81tT0U.js",xr="/assets/rnnoise-JVVcIJtG.wasm",Pr="/assets/rnnoise-JVVcIJtG.wasm";function pi(f,n,h){return f+(n-f)*h}function on(f,n,h){return(h-f)/(n-f)}function Xi(f,n){return Math.abs(f-n)}function Vs(f){const n=f.reduce((b,E)=>b+E,0)/f.length,h=Math.max(...f,157);return new Uint8Array(f.map(b=>Math.min(255,Math.max(0,on(n,h,b)*255))))}function kr(f,n){return new Uint8Array(f.map((h,b)=>Math.max(0,h-n[b])))}function Mr(f){const n=new Uint8Array(f.data.length);for(let h=0;h<f.data.length;h++)n[h]=f.data.reduce((b,E)=>b+E[h],0)/f.data.length;return h=>kr(h,n)}class Rr{constructor(n){this.recording=n,this.position=0,this.searchDistance=1,this.currentSpeed=1}guess(n,{treshold:h=100,minDistance:b=7,maxDistance:E=42,seekStep:lt=1.618}={}){if(this.position>=this.recording.data.length-this.searchDistance)return{over:!0};const $=this.recording.getDifferences(n,this.position,this.position+Math.max(Math.round(this.searchDistance),b)).map(x=>Math.max(...x)),o=Math.min(...$),X=this.position+$.lastIndexOf(o);this.currentSpeed=pi(this.currentSpeed,X-this.position,.1),console.log(this.currentSpeed.toFixed(2)),o>h||X===this.position?this.searchDistance=Math.min(this.searchDistance+lt,E):(this.searchDistance=1,this.position=X);const r=this.recording.markings.length?this.recording.markings.reduce((x,q)=>q[0]<=this.position?q:x)[1]:void 0;return{position:this.position,mark:r,differences:$}}}class He{constructor(){this.data=[],this.markings=[]}getDifferences(n,h=0,b=this.data.length){return this.data.slice(h,b).map(E=>new Uint8Array(E.map((lt,$)=>Xi(lt,n[$]))))}clear(){this.data.length=0,this.markings.length=0}export(){return{data:this.data.map(h=>{const b=[];let E=h[0],lt=1;for(let $=1;$<h.length;$++)h[$]===E?lt++:(lt>1?b.push([E,lt]):b.push(E),E=h[$],lt=1);return lt>1?b.push([E,lt]):b.push(E),b}),markings:this.markings}}static import({data:n,markings:h}){const b=new He;for(const E of n){const lt=[];for(const $ of E)if(Array.isArray($)){const[o,X]=$;lt.push(...new Array(X).fill(o))}else lt.push($);b.data.push(new Uint8Array(lt))}return b.markings=h,b}createFollower(){return new Rr(this)}}var Fr=Object.defineProperty,Dr=Object.getOwnPropertyDescriptor,ln=(f,n,h,b)=>{for(var E=b>1?void 0:b?Dr(n,h):n,lt=f.length-1,$;lt>=0;lt--)($=f[lt])&&(E=(b?$(n,h,E):$(E))||E);return b&&E&&Fr(n,h,E),E};let Fi=class extends be{constructor(){super(...arguments),this.recording=!1,this.pct=.125}async connect(){this.stream=await navigator.mediaDevices.getUserMedia({audio:{noiseSuppression:!0,echoCancellation:!0,autoGainControl:!1}});const f=new AudioContext;this.source=f.createMediaStreamSource(this.stream),this.gain=new GainNode(f,{gain:1}),await f.audioWorklet.addModule(Tr);const n=await Er({url:xr,simdUrl:Pr});this.rnnoise=new Cr(f,{wasmBinary:n,maxChannels:2}),this.source.connect(this.rnnoise),this.rnnoise.connect(this.gain),this.analyser=f.createAnalyser(),this.source.connect(this.analyser),this.analyser.fftSize=Math.pow(2,12),this.analyser.smoothingTimeConstant=.5}disconnect(){var f,n,h,b,E;(f=this.stream)==null||f.getTracks().forEach(lt=>lt.stop()),(n=this.source)==null||n.disconnect(),(h=this.gain)==null||h.disconnect(),(b=this.rnnoise)==null||b.destroy(),(E=this.rnnoise)==null||E.disconnect()}capture(){const f=this.analyser.frequencyBinCount,n=new Uint8Array(Math.floor(f*this.pct));this.analyser.getByteFrequencyData(n);let h=Vs(n);return this._cleaner&&(h=this._cleaner(h)),Vs(n)}loop(){var n;this.frameID=requestAnimationFrame(()=>this.loop());const f=this.capture();(n=this._onData)==null||n.call(this,f)}async start(){if(!this.recording)try{this.recording=!0,this._cleaner=void 0,await this.connect(),console.log("connected"),this.dispatchEvent(new CustomEvent("start")),this.loop(),await qs(500),console.log("capturing noise sample");const f=new He;this._onData=n=>{f.data.push(n)},await qs(1e3),this._cleaner=Mr(f),console.log("recording  "),this._onData=n=>{this.dispatchEvent(new CustomEvent("data",{detail:n}))}}catch{this.recording=!1,alert("Could not connect to microphone")}}stop(){this.recording&&(cancelAnimationFrame(this.frameID),this.disconnect(),this.dispatchEvent(new CustomEvent("stop")),this.recording=!1)}toggle(){this.recording?this.stop():this.start()}render(){return pe`
      <button @click=${this.toggle} class=${this.recording?"active":""}>
        <slot></slot>
      </button>
    `}};Fi.styles=[Rs,ve`
      :host {
        display: block;
      }
      button.active {
        background: var(--color-orange);
      }
    `];ln([he({type:Boolean})],Fi.prototype,"recording",2);Fi=ln([we("frequency-recorder")],Fi);async function qs(f){return new Promise(n=>setTimeout(n,f))}function cn(f){return`hsla(${360-f*360}, 100%, 50%, ${f})`}var Or=Object.defineProperty,Ir=Object.getOwnPropertyDescriptor,Fs=(f,n,h,b)=>{for(var E=b>1?void 0:b?Ir(n,h):n,lt=f.length-1,$;lt>=0;lt--)($=f[lt])&&(E=(b?$(n,h,E):$(E))||E);return b&&E&&Or(n,h,E),E};let ai=class extends be{render(){return pe`<canvas width="0" height="0"></canvas>`}updated(){const f=this.canvas,n=f.getContext("2d");if(!this.data){f.width=0,f.height=0;return}f.width=this.data.length,f.height=5,this.data.forEach((h,b)=>{n.fillStyle=cn(h/255),n.fillRect(b,0,1,5)})}};ai.styles=ve`
    :host {
      display: block;
    }
    canvas {
      display: block;
    }
  `;Fs([he({type:Object})],ai.prototype,"data",2);Fs([ye("canvas")],ai.prototype,"canvas",2);ai=Fs([we("graph-1d")],ai);var Lr=Object.defineProperty,Nr=Object.getOwnPropertyDescriptor,Ds=(f,n,h,b)=>{for(var E=b>1?void 0:b?Nr(n,h):n,lt=f.length-1,$;lt>=0;lt--)($=f[lt])&&(E=(b?$(n,h,E):$(E))||E);return b&&E&&Lr(n,h,E),E};let oi=class extends be{render(){return pe`<canvas width="0" height="0" @pointerdown=${f=>{const n=this.canvas.getBoundingClientRect(),h=f.clientX-n.left,b=f.clientY-n.top,E=h/n.width,lt=b/n.height,$=Math.floor(E*this.data.length||0),o=Math.floor((1-lt)*this.data[0].length);this.dispatchEvent(new CustomEvent("select",{detail:{column:$,row:o,x:h,y:b}}))}}></canvas>`}updated(){var $;if(!this.data||!this.data.length)return;const f=this.canvas,n=f.getContext("2d"),h=(($=this.data[0])==null?void 0:$.length)||0;f.width=this.data.length,f.height=h;let b=0;const E=50,lt=()=>{for(let o=b;o<Math.min(b+E,this.data.length);o++)for(let X=0;X<h;X++)n.fillStyle=cn(this.data[o][X]/255),n.fillRect(o,h-X,1,1);b+=E,b<this.data.length&&requestAnimationFrame(lt)};lt()}};oi.styles=ve`
    :host {
      display: block;
    }
    canvas {
      display: block;
    }
  `;Ds([he({type:Array})],oi.prototype,"data",2);Ds([ye("canvas")],oi.prototype,"canvas",2);oi=Ds([we("graph-2d")],oi);function $r(f){if(f.__esModule)return f;var n=f.default;if(typeof n=="function"){var h=function b(){return this instanceof b?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};h.prototype=n.prototype}else h={};return Object.defineProperty(h,"__esModule",{value:!0}),Object.keys(f).forEach(function(b){var E=Object.getOwnPropertyDescriptor(f,b);Object.defineProperty(h,b,E.get?E:{enumerable:!0,get:function(){return f[b]}})}),h}function ji(f){throw new Error('Could not dynamically require "'+f+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var hn={exports:{}};const Ur={},Br=Object.freeze(Object.defineProperty({__proto__:null,default:Ur},Symbol.toStringTag,{value:"Module"})),Se=$r(Br);(function(f,n){(function(b,E){f.exports=b.pdfjsLib=E()})(globalThis,()=>(()=>{var h=[,($,o)=>{var V;Object.defineProperty(o,"__esModule",{value:!0}),o.VerbosityLevel=o.Util=o.UnknownErrorException=o.UnexpectedResponseException=o.TextRenderingMode=o.RenderingIntentFlag=o.PromiseCapability=o.PermissionFlag=o.PasswordResponses=o.PasswordException=o.PageActionEventType=o.OPS=o.MissingPDFException=o.MAX_IMAGE_SIZE_TO_CACHE=o.LINE_FACTOR=o.LINE_DESCENT_FACTOR=o.InvalidPDFException=o.ImageKind=o.IDENTITY_MATRIX=o.FormatError=o.FeatureTest=o.FONT_IDENTITY_MATRIX=o.DocumentActionEventType=o.CMapCompressionType=o.BaseException=o.BASELINE_FACTOR=o.AnnotationType=o.AnnotationReplyType=o.AnnotationPrefix=o.AnnotationMode=o.AnnotationFlag=o.AnnotationFieldFlag=o.AnnotationEditorType=o.AnnotationEditorPrefix=o.AnnotationEditorParamsType=o.AnnotationBorderStyleType=o.AnnotationActionEventType=o.AbortException=void 0,o.assert=bt,o.bytesToString=B,o.createValidAbsoluteUrl=Ut,o.getModificationDate=Ot,o.getUuid=pt,o.getVerbosityLevel=ut,o.info=Et,o.isArrayBuffer=vt,o.isArrayEqual=Ft,o.isNodeJS=void 0,o.normalizeUnicode=Zt,o.objectFromMap=mt,o.objectSize=ft,o.setVerbosityLevel=j,o.shadow=$t,o.string32=nt,o.stringToBytes=ct,o.stringToPDFString=St,o.stringToUTF8String=it,o.unreachable=et,o.utf8StringToString=st,o.warn=yt;const X=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");o.isNodeJS=X;const r=[1,0,0,1,0,0];o.IDENTITY_MATRIX=r;const x=[.001,0,0,.001,0,0];o.FONT_IDENTITY_MATRIX=x;const q=1e7;o.MAX_IMAGE_SIZE_TO_CACHE=q;const Y=1.35;o.LINE_FACTOR=Y;const gt=.35;o.LINE_DESCENT_FACTOR=gt;const z=gt/Y;o.BASELINE_FACTOR=z;const F={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};o.RenderingIntentFlag=F;const m={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};o.AnnotationMode=m;const H="pdfjs_internal_editor_";o.AnnotationEditorPrefix=H;const W={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};o.AnnotationEditorType=W;const L={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};o.AnnotationEditorParamsType=L;const w={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};o.PermissionFlag=w;const C={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};o.TextRenderingMode=C;const p={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};o.ImageKind=p;const y={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};o.AnnotationType=y;const M={GROUP:"Group",REPLY:"R"};o.AnnotationReplyType=M;const k={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};o.AnnotationFlag=k;const v={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};o.AnnotationFieldFlag=v;const l={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};o.AnnotationBorderStyleType=l;const d={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};o.AnnotationActionEventType=d;const I={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};o.DocumentActionEventType=I;const Q={O:"PageOpen",C:"PageClose"};o.PageActionEventType=Q;const J={ERRORS:0,WARNINGS:1,INFOS:5};o.VerbosityLevel=J;const _t={NONE:0,BINARY:1};o.CMapCompressionType=_t;const at={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};o.OPS=at;const Pt={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};o.PasswordResponses=Pt;let Ct=J.WARNINGS;function j(_){Number.isInteger(_)&&(Ct=_)}function ut(){return Ct}function Et(_){Ct>=J.INFOS&&console.log(`Info: ${_}`)}function yt(_){Ct>=J.WARNINGS&&console.log(`Warning: ${_}`)}function et(_){throw new Error(_)}function bt(_,S){_||et(S)}function Rt(_){switch(_==null?void 0:_.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Ut(_,S=null,T=null){if(!_)return null;try{if(T&&typeof _=="string"){if(T.addDefaultProtocol&&_.startsWith("www.")){const dt=_.match(/\./g);(dt==null?void 0:dt.length)>=2&&(_=`http://${_}`)}if(T.tryConvertEncoding)try{_=it(_)}catch{}}const rt=S?new URL(_,S):new URL(_);if(Rt(rt))return rt}catch{}return null}function $t(_,S,T,rt=!1){return Object.defineProperty(_,S,{value:T,enumerable:!rt,configurable:!0,writable:!1}),T}const P=function(){function S(T,rt){this.constructor===S&&et("Cannot initialize BaseException."),this.message=T,this.name=rt}return S.prototype=new Error,S.constructor=S,S}();o.BaseException=P;class i extends P{constructor(S,T){super(S,"PasswordException"),this.code=T}}o.PasswordException=i;class a extends P{constructor(S,T){super(S,"UnknownErrorException"),this.details=T}}o.UnknownErrorException=a;class s extends P{constructor(S){super(S,"InvalidPDFException")}}o.InvalidPDFException=s;class c extends P{constructor(S){super(S,"MissingPDFException")}}o.MissingPDFException=c;class u extends P{constructor(S,T){super(S,"UnexpectedResponseException"),this.status=T}}o.UnexpectedResponseException=u;class A extends P{constructor(S){super(S,"FormatError")}}o.FormatError=A;class R extends P{constructor(S){super(S,"AbortException")}}o.AbortException=R;function B(_){(typeof _!="object"||(_==null?void 0:_.length)===void 0)&&et("Invalid argument for bytesToString");const S=_.length,T=8192;if(S<T)return String.fromCharCode.apply(null,_);const rt=[];for(let dt=0;dt<S;dt+=T){const qt=Math.min(dt+T,S),ie=_.subarray(dt,qt);rt.push(String.fromCharCode.apply(null,ie))}return rt.join("")}function ct(_){typeof _!="string"&&et("Invalid argument for stringToBytes");const S=_.length,T=new Uint8Array(S);for(let rt=0;rt<S;++rt)T[rt]=_.charCodeAt(rt)&255;return T}function nt(_){return String.fromCharCode(_>>24&255,_>>16&255,_>>8&255,_&255)}function ft(_){return Object.keys(_).length}function mt(_){const S=Object.create(null);for(const[T,rt]of _)S[T]=rt;return S}function Mt(){const _=new Uint8Array(4);return _[0]=1,new Uint32Array(_.buffer,0,1)[0]===1}function At(){try{return new Function(""),!0}catch{return!1}}class Bt{static get isLittleEndian(){return $t(this,"isLittleEndian",Mt())}static get isEvalSupported(){return $t(this,"isEvalSupported",At())}static get isOffscreenCanvasSupported(){return $t(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?$t(this,"platform",{isWin:!1,isMac:!1}):$t(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){var S,T;return $t(this,"isCSSRoundSupported",(T=(S=globalThis.CSS)==null?void 0:S.supports)==null?void 0:T.call(S,"width: round(1.5px, 1px)"))}}o.FeatureTest=Bt;const Vt=[...Array(256).keys()].map(_=>_.toString(16).padStart(2,"0"));class kt{static makeHexColor(S,T,rt){return`#${Vt[S]}${Vt[T]}${Vt[rt]}`}static scaleMinMax(S,T){let rt;S[0]?(S[0]<0&&(rt=T[0],T[0]=T[1],T[1]=rt),T[0]*=S[0],T[1]*=S[0],S[3]<0&&(rt=T[2],T[2]=T[3],T[3]=rt),T[2]*=S[3],T[3]*=S[3]):(rt=T[0],T[0]=T[2],T[2]=rt,rt=T[1],T[1]=T[3],T[3]=rt,S[1]<0&&(rt=T[2],T[2]=T[3],T[3]=rt),T[2]*=S[1],T[3]*=S[1],S[2]<0&&(rt=T[0],T[0]=T[1],T[1]=rt),T[0]*=S[2],T[1]*=S[2]),T[0]+=S[4],T[1]+=S[4],T[2]+=S[5],T[3]+=S[5]}static transform(S,T){return[S[0]*T[0]+S[2]*T[1],S[1]*T[0]+S[3]*T[1],S[0]*T[2]+S[2]*T[3],S[1]*T[2]+S[3]*T[3],S[0]*T[4]+S[2]*T[5]+S[4],S[1]*T[4]+S[3]*T[5]+S[5]]}static applyTransform(S,T){const rt=S[0]*T[0]+S[1]*T[2]+T[4],dt=S[0]*T[1]+S[1]*T[3]+T[5];return[rt,dt]}static applyInverseTransform(S,T){const rt=T[0]*T[3]-T[1]*T[2],dt=(S[0]*T[3]-S[1]*T[2]+T[2]*T[5]-T[4]*T[3])/rt,qt=(-S[0]*T[1]+S[1]*T[0]+T[4]*T[1]-T[5]*T[0])/rt;return[dt,qt]}static getAxialAlignedBoundingBox(S,T){const rt=this.applyTransform(S,T),dt=this.applyTransform(S.slice(2,4),T),qt=this.applyTransform([S[0],S[3]],T),ie=this.applyTransform([S[2],S[1]],T);return[Math.min(rt[0],dt[0],qt[0],ie[0]),Math.min(rt[1],dt[1],qt[1],ie[1]),Math.max(rt[0],dt[0],qt[0],ie[0]),Math.max(rt[1],dt[1],qt[1],ie[1])]}static inverseTransform(S){const T=S[0]*S[3]-S[1]*S[2];return[S[3]/T,-S[1]/T,-S[2]/T,S[0]/T,(S[2]*S[5]-S[4]*S[3])/T,(S[4]*S[1]-S[5]*S[0])/T]}static singularValueDecompose2dScale(S){const T=[S[0],S[2],S[1],S[3]],rt=S[0]*T[0]+S[1]*T[2],dt=S[0]*T[1]+S[1]*T[3],qt=S[2]*T[0]+S[3]*T[2],ie=S[2]*T[1]+S[3]*T[3],K=(rt+ie)/2,Tt=Math.sqrt((rt+ie)**2-4*(rt*ie-qt*dt))/2,Nt=K+Tt||1,Dt=K-Tt||1;return[Math.sqrt(Nt),Math.sqrt(Dt)]}static normalizeRect(S){const T=S.slice(0);return S[0]>S[2]&&(T[0]=S[2],T[2]=S[0]),S[1]>S[3]&&(T[1]=S[3],T[3]=S[1]),T}static intersect(S,T){const rt=Math.max(Math.min(S[0],S[2]),Math.min(T[0],T[2])),dt=Math.min(Math.max(S[0],S[2]),Math.max(T[0],T[2]));if(rt>dt)return null;const qt=Math.max(Math.min(S[1],S[3]),Math.min(T[1],T[3])),ie=Math.min(Math.max(S[1],S[3]),Math.max(T[1],T[3]));return qt>ie?null:[rt,qt,dt,ie]}static bezierBoundingBox(S,T,rt,dt,qt,ie,K,Tt){const Nt=[],Dt=[[],[]];let Xt,Gt,ne,xt,se,Wt,D,e;for(let tt=0;tt<2;++tt){if(tt===0?(Gt=6*S-12*rt+6*qt,Xt=-3*S+9*rt-9*qt+3*K,ne=3*rt-3*S):(Gt=6*T-12*dt+6*ie,Xt=-3*T+9*dt-9*ie+3*Tt,ne=3*dt-3*T),Math.abs(Xt)<1e-12){if(Math.abs(Gt)<1e-12)continue;xt=-ne/Gt,0<xt&&xt<1&&Nt.push(xt);continue}D=Gt*Gt-4*ne*Xt,e=Math.sqrt(D),!(D<0)&&(se=(-Gt+e)/(2*Xt),0<se&&se<1&&Nt.push(se),Wt=(-Gt-e)/(2*Xt),0<Wt&&Wt<1&&Nt.push(Wt))}let g=Nt.length,N;const G=g;for(;g--;)xt=Nt[g],N=1-xt,Dt[0][g]=N*N*N*S+3*N*N*xt*rt+3*N*xt*xt*qt+xt*xt*xt*K,Dt[1][g]=N*N*N*T+3*N*N*xt*dt+3*N*xt*xt*ie+xt*xt*xt*Tt;return Dt[0][G]=S,Dt[1][G]=T,Dt[0][G+1]=K,Dt[1][G+1]=Tt,Dt[0].length=Dt[1].length=G+2,[Math.min(...Dt[0]),Math.min(...Dt[1]),Math.max(...Dt[0]),Math.max(...Dt[1])]}}o.Util=kt;const jt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function St(_){if(_[0]>="ï"){let T;if(_[0]==="þ"&&_[1]==="ÿ"?T="utf-16be":_[0]==="ÿ"&&_[1]==="þ"?T="utf-16le":_[0]==="ï"&&_[1]==="»"&&_[2]==="¿"&&(T="utf-8"),T)try{const rt=new TextDecoder(T,{fatal:!0}),dt=ct(_);return rt.decode(dt)}catch(rt){yt(`stringToPDFString: "${rt}".`)}}const S=[];for(let T=0,rt=_.length;T<rt;T++){const dt=jt[_.charCodeAt(T)];S.push(dt?String.fromCharCode(dt):_.charAt(T))}return S.join("")}function it(_){return decodeURIComponent(escape(_))}function st(_){return unescape(encodeURIComponent(_))}function vt(_){return typeof _=="object"&&(_==null?void 0:_.byteLength)!==void 0}function Ft(_,S){if(_.length!==S.length)return!1;for(let T=0,rt=_.length;T<rt;T++)if(_[T]!==S[T])return!1;return!0}function Ot(_=new Date){return[_.getUTCFullYear().toString(),(_.getUTCMonth()+1).toString().padStart(2,"0"),_.getUTCDate().toString().padStart(2,"0"),_.getUTCHours().toString().padStart(2,"0"),_.getUTCMinutes().toString().padStart(2,"0"),_.getUTCSeconds().toString().padStart(2,"0")].join("")}class te{constructor(){U(this,V,!1);this.promise=new Promise((S,T)=>{this.resolve=rt=>{ot(this,V,!0),S(rt)},this.reject=rt=>{ot(this,V,!0),T(rt)}})}get settled(){return t(this,V)}}V=new WeakMap,o.PromiseCapability=te;let Kt=null,Jt=null;function Zt(_){return Kt||(Kt=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Jt=new Map([["ﬅ","ſt"]])),_.replaceAll(Kt,(S,T,rt)=>T?T.normalize("NFKC"):Jt.get(rt))}function pt(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const _=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(_);else for(let S=0;S<32;S++)_[S]=Math.floor(Math.random()*255);return B(_)}const O="pdfjs_internal_id_";o.AnnotationPrefix=O},($,o,X)=>{var c,A,R,B,Le,nt,gi,mt,Mt,At,Bt,kt,jt,St,it,st,mi,Ft,Ot,Vi,Kt,Jt;Object.defineProperty(o,"__esModule",{value:!0}),o.RenderTask=o.PDFWorkerUtil=o.PDFWorker=o.PDFPageProxy=o.PDFDocumentProxy=o.PDFDocumentLoadingTask=o.PDFDataRangeTransport=o.LoopbackPort=o.DefaultStandardFontDataFactory=o.DefaultFilterFactory=o.DefaultCanvasFactory=o.DefaultCMapReaderFactory=void 0,Object.defineProperty(o,"SVGGraphics",{enumerable:!0,get:function(){return y.SVGGraphics}}),o.build=void 0,o.getDocument=_t,o.version=void 0;var r=X(1),x=X(3),q=X(6),Y=X(9),gt=X(10),z=X(11),F=X(14),m=X(15),H=X(16),W=X(17),L=X(18),w=X(19),C=X(22),p=X(23),y=X(24),M=X(25);const k=65536,v=100,l=5e3,d=r.isNodeJS?gt.NodeCanvasFactory:q.DOMCanvasFactory;o.DefaultCanvasFactory=d;const I=r.isNodeJS?gt.NodeCMapReaderFactory:q.DOMCMapReaderFactory;o.DefaultCMapReaderFactory=I;const Q=r.isNodeJS?gt.NodeFilterFactory:q.DOMFilterFactory;o.DefaultFilterFactory=Q;const J=r.isNodeJS?gt.NodeStandardFontDataFactory:q.DOMStandardFontDataFactory;o.DefaultStandardFontDataFactory=J;function _t(pt){if(typeof pt=="string"||pt instanceof URL?pt={url:pt}:(0,r.isArrayBuffer)(pt)&&(pt={data:pt}),typeof pt!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!pt.url&&!pt.data&&!pt.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const O=new j,{docId:V}=O,_=pt.url?Pt(pt.url):null,S=pt.data?Ct(pt.data):null,T=pt.httpHeaders||null,rt=pt.withCredentials===!0,dt=pt.password??null,qt=pt.range instanceof ut?pt.range:null,ie=Number.isInteger(pt.rangeChunkSize)&&pt.rangeChunkSize>0?pt.rangeChunkSize:k;let K=pt.worker instanceof Rt?pt.worker:null;const Tt=pt.verbosity,Nt=typeof pt.docBaseUrl=="string"&&!(0,q.isDataScheme)(pt.docBaseUrl)?pt.docBaseUrl:null,Dt=typeof pt.cMapUrl=="string"?pt.cMapUrl:null,Xt=pt.cMapPacked!==!1,Gt=pt.CMapReaderFactory||I,ne=typeof pt.standardFontDataUrl=="string"?pt.standardFontDataUrl:null,xt=pt.StandardFontDataFactory||J,se=pt.stopAtErrors!==!0,Wt=Number.isInteger(pt.maxImageSize)&&pt.maxImageSize>-1?pt.maxImageSize:-1,D=pt.isEvalSupported!==!1,e=typeof pt.isOffscreenCanvasSupported=="boolean"?pt.isOffscreenCanvasSupported:!r.isNodeJS,g=Number.isInteger(pt.canvasMaxAreaInBytes)?pt.canvasMaxAreaInBytes:-1,N=typeof pt.disableFontFace=="boolean"?pt.disableFontFace:r.isNodeJS,G=pt.fontExtraProperties===!0,tt=pt.enableXfa===!0,ht=pt.ownerDocument||globalThis.document,wt=pt.disableRange===!0,Lt=pt.disableStream===!0,It=pt.disableAutoFetch===!0,Qt=pt.pdfBug===!0,Ht=qt?qt.length:pt.length??NaN,zt=typeof pt.useSystemFonts=="boolean"?pt.useSystemFonts:!r.isNodeJS&&!N,Yt=typeof pt.useWorkerFetch=="boolean"?pt.useWorkerFetch:Gt===q.DOMCMapReaderFactory&&xt===q.DOMStandardFontDataFactory&&Dt&&ne&&(0,q.isValidFetchUrl)(Dt,document.baseURI)&&(0,q.isValidFetchUrl)(ne,document.baseURI),ee=pt.canvasFactory||new d({ownerDocument:ht}),re=pt.filterFactory||new Q({docId:V,ownerDocument:ht}),ae=null;(0,r.setVerbosityLevel)(Tt);const ce={canvasFactory:ee,filterFactory:re};if(Yt||(ce.cMapReaderFactory=new Gt({baseUrl:Dt,isCompressed:Xt}),ce.standardFontDataFactory=new xt({baseUrl:ne})),!K){const me={verbosity:Tt,port:F.GlobalWorkerOptions.workerPort};K=me.port?Rt.fromPort(me):new Rt(me),O._worker=K}const le={docId:V,apiVersion:"3.11.174",data:S,password:dt,disableAutoFetch:It,rangeChunkSize:ie,length:Ht,docBaseUrl:Nt,enableXfa:tt,evaluatorOptions:{maxImageSize:Wt,disableFontFace:N,ignoreErrors:se,isEvalSupported:D,isOffscreenCanvasSupported:e,canvasMaxAreaInBytes:g,fontExtraProperties:G,useSystemFonts:zt,cMapUrl:Yt?Dt:null,standardFontDataUrl:Yt?ne:null}},ge={ignoreErrors:se,isEvalSupported:D,disableFontFace:N,fontExtraProperties:G,enableXfa:tt,ownerDocument:ht,disableAutoFetch:It,pdfBug:Qt,styleElement:ae};return K.promise.then(function(){if(O.destroyed)throw new Error("Loading aborted");const me=at(K,le),_e=new Promise(function(De){let ze;qt?ze=new L.PDFDataTransportStream({length:Ht,initialData:qt.initialData,progressiveDone:qt.progressiveDone,contentDispositionFilename:qt.contentDispositionFilename,disableRange:wt,disableStream:Lt},qt):S||(ze=(Oe=>r.isNodeJS?new p.PDFNodeStream(Oe):(0,q.isValidFetchUrl)(Oe.url)?new w.PDFFetchStream(Oe):new C.PDFNetworkStream(Oe))({url:_,length:Ht,httpHeaders:T,withCredentials:rt,rangeChunkSize:ie,disableRange:wt,disableStream:Lt})),De(ze)});return Promise.all([me,_e]).then(function([De,ze]){if(O.destroyed)throw new Error("Loading aborted");const Li=new m.MessageHandler(V,De,K.port),Oe=new Ut(Li,O,ze,ge,ce);O._transport=Oe,Li.send("Ready",null)})}).catch(O._capability.reject),O}async function at(pt,O){if(pt.destroyed)throw new Error("Worker was destroyed");const V=await pt.messageHandler.sendWithPromise("GetDocRequest",O,O.data?[O.data.buffer]:null);if(pt.destroyed)throw new Error("Worker was destroyed");return V}function Pt(pt){if(pt instanceof URL)return pt.href;try{return new URL(pt,window.location).href}catch{if(r.isNodeJS&&typeof pt=="string")return pt}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Ct(pt){if(r.isNodeJS&&typeof Buffer<"u"&&pt instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(pt instanceof Uint8Array&&pt.byteLength===pt.buffer.byteLength)return pt;if(typeof pt=="string")return(0,r.stringToBytes)(pt);if(typeof pt=="object"&&!isNaN(pt==null?void 0:pt.length)||(0,r.isArrayBuffer)(pt))return new Uint8Array(pt);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const u=class u{constructor(){this._capability=new r.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${Ge(u,c)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var O,V,_;this.destroyed=!0;try{(O=this._worker)!=null&&O.port&&(this._worker._pendingDestroy=!0),await((V=this._transport)==null?void 0:V.destroy())}catch(S){throw(_=this._worker)!=null&&_.port&&delete this._worker._pendingDestroy,S}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};c=new WeakMap,U(u,c,0);let j=u;o.PDFDocumentLoadingTask=j;class ut{constructor(O,V,_=!1,S=null){this.length=O,this.initialData=V,this.progressiveDone=_,this.contentDispositionFilename=S,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new r.PromiseCapability}addRangeListener(O){this._rangeListeners.push(O)}addProgressListener(O){this._progressListeners.push(O)}addProgressiveReadListener(O){this._progressiveReadListeners.push(O)}addProgressiveDoneListener(O){this._progressiveDoneListeners.push(O)}onDataRange(O,V){for(const _ of this._rangeListeners)_(O,V)}onDataProgress(O,V){this._readyCapability.promise.then(()=>{for(const _ of this._progressListeners)_(O,V)})}onDataProgressiveRead(O){this._readyCapability.promise.then(()=>{for(const V of this._progressiveReadListeners)V(O)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const O of this._progressiveDoneListeners)O()})}transportReady(){this._readyCapability.resolve()}requestDataRange(O,V){(0,r.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}o.PDFDataRangeTransport=ut;class Et{constructor(O,V){this._pdfInfo=O,this._transport=V,Object.defineProperty(this,"getJavaScript",{value:()=>((0,q.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(_=>{if(!_)return _;const S=[];for(const T in _)S.push(..._[T]);return S}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,r.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(O){return this._transport.getPage(O)}getPageIndex(O){return this._transport.getPageIndex(O)}getDestinations(){return this._transport.getDestinations()}getDestination(O){return this._transport.getDestination(O)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(O=!1){return this._transport.startCleanup(O||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}o.PDFDocumentProxy=Et;class yt{constructor(O,V,_,S=!1){U(this,B);U(this,nt);U(this,A,null);U(this,R,!1);this._pageIndex=O,this._pageInfo=V,this._transport=_,this._stats=S?new q.StatTimer:null,this._pdfBug=S,this.commonObjs=_.commonObjs,this.objs=new $t,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:O,rotation:V=this.rotate,offsetX:_=0,offsetY:S=0,dontFlip:T=!1}={}){return new q.PageViewport({viewBox:this.view,scale:O,rotation:V,offsetX:_,offsetY:S,dontFlip:T})}getAnnotations({intent:O="display"}={}){const V=this._transport.getRenderingIntent(O);return this._transport.getAnnotations(this._pageIndex,V.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,r.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var O;return((O=this._transport._htmlForXfa)==null?void 0:O.children[this._pageIndex])||null}render({canvasContext:O,viewport:V,intent:_="display",annotationMode:S=r.AnnotationMode.ENABLE,transform:T=null,background:rt=null,optionalContentConfigPromise:dt=null,annotationCanvasMap:qt=null,pageColors:ie=null,printAnnotationStorage:K=null}){var xt,se;(xt=this._stats)==null||xt.time("Overall");const Tt=this._transport.getRenderingIntent(_,S,K);ot(this,R,!1),Z(this,nt,gi).call(this),dt||(dt=this._transport.getOptionalContentConfig());let Nt=this._intentStates.get(Tt.cacheKey);Nt||(Nt=Object.create(null),this._intentStates.set(Tt.cacheKey,Nt)),Nt.streamReaderCancelTimeout&&(clearTimeout(Nt.streamReaderCancelTimeout),Nt.streamReaderCancelTimeout=null);const Dt=!!(Tt.renderingIntent&r.RenderingIntentFlag.PRINT);Nt.displayReadyCapability||(Nt.displayReadyCapability=new r.PromiseCapability,Nt.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(se=this._stats)==null||se.time("Page Request"),this._pumpOperatorList(Tt));const Xt=Wt=>{var D,e;Nt.renderTasks.delete(Gt),(this._maybeCleanupAfterRender||Dt)&&ot(this,R,!0),Z(this,B,Le).call(this,!Dt),Wt?(Gt.capability.reject(Wt),this._abortOperatorList({intentState:Nt,reason:Wt instanceof Error?Wt:new Error(Wt)})):Gt.capability.resolve(),(D=this._stats)==null||D.timeEnd("Rendering"),(e=this._stats)==null||e.timeEnd("Overall")},Gt=new i({callback:Xt,params:{canvasContext:O,viewport:V,transform:T,background:rt},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:qt,operatorList:Nt.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!Dt,pdfBug:this._pdfBug,pageColors:ie});(Nt.renderTasks||(Nt.renderTasks=new Set)).add(Gt);const ne=Gt.task;return Promise.all([Nt.displayReadyCapability.promise,dt]).then(([Wt,D])=>{var e;if(this.destroyed){Xt();return}(e=this._stats)==null||e.time("Rendering"),Gt.initializeGraphics({transparency:Wt,optionalContentConfig:D}),Gt.operatorListChanged()}).catch(Xt),ne}getOperatorList({intent:O="display",annotationMode:V=r.AnnotationMode.ENABLE,printAnnotationStorage:_=null}={}){var qt;function S(){rt.operatorList.lastChunk&&(rt.opListReadCapability.resolve(rt.operatorList),rt.renderTasks.delete(dt))}const T=this._transport.getRenderingIntent(O,V,_,!0);let rt=this._intentStates.get(T.cacheKey);rt||(rt=Object.create(null),this._intentStates.set(T.cacheKey,rt));let dt;return rt.opListReadCapability||(dt=Object.create(null),dt.operatorListChanged=S,rt.opListReadCapability=new r.PromiseCapability,(rt.renderTasks||(rt.renderTasks=new Set)).add(dt),rt.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(qt=this._stats)==null||qt.time("Page Request"),this._pumpOperatorList(T)),rt.opListReadCapability.promise}streamTextContent({includeMarkedContent:O=!1,disableNormalization:V=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:O===!0,disableNormalization:V===!0},{highWaterMark:100,size(S){return S.items.length}})}getTextContent(O={}){if(this._transport._htmlForXfa)return this.getXfa().then(_=>M.XfaText.textContent(_));const V=this.streamTextContent(O);return new Promise(function(_,S){function T(){rt.read().then(function({value:qt,done:ie}){if(ie){_(dt);return}Object.assign(dt.styles,qt.styles),dt.items.push(...qt.items),T()},S)}const rt=V.getReader(),dt={items:[],styles:Object.create(null)};T()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const O=[];for(const V of this._intentStates.values())if(this._abortOperatorList({intentState:V,reason:new Error("Page was destroyed."),force:!0}),!V.opListReadCapability)for(const _ of V.renderTasks)O.push(_.completed),_.cancel();return this.objs.clear(),ot(this,R,!1),Z(this,nt,gi).call(this),Promise.all(O)}cleanup(O=!1){ot(this,R,!0);const V=Z(this,B,Le).call(this,!1);return O&&V&&this._stats&&(this._stats=new q.StatTimer),V}_startRenderPage(O,V){var S,T;const _=this._intentStates.get(V);_&&((S=this._stats)==null||S.timeEnd("Page Request"),(T=_.displayReadyCapability)==null||T.resolve(O))}_renderPageChunk(O,V){for(let _=0,S=O.length;_<S;_++)V.operatorList.fnArray.push(O.fnArray[_]),V.operatorList.argsArray.push(O.argsArray[_]);V.operatorList.lastChunk=O.lastChunk,V.operatorList.separateAnnots=O.separateAnnots;for(const _ of V.renderTasks)_.operatorListChanged();O.lastChunk&&Z(this,B,Le).call(this,!0)}_pumpOperatorList({renderingIntent:O,cacheKey:V,annotationStorageSerializable:_}){const{map:S,transfers:T}=_,dt=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:O,cacheKey:V,annotationStorage:S},T).getReader(),qt=this._intentStates.get(V);qt.streamReader=dt;const ie=()=>{dt.read().then(({value:K,done:Tt})=>{if(Tt){qt.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(K,qt),ie())},K=>{if(qt.streamReader=null,!this._transport.destroyed){if(qt.operatorList){qt.operatorList.lastChunk=!0;for(const Tt of qt.renderTasks)Tt.operatorListChanged();Z(this,B,Le).call(this,!0)}if(qt.displayReadyCapability)qt.displayReadyCapability.reject(K);else if(qt.opListReadCapability)qt.opListReadCapability.reject(K);else throw K}})};ie()}_abortOperatorList({intentState:O,reason:V,force:_=!1}){if(O.streamReader){if(O.streamReaderCancelTimeout&&(clearTimeout(O.streamReaderCancelTimeout),O.streamReaderCancelTimeout=null),!_){if(O.renderTasks.size>0)return;if(V instanceof q.RenderingCancelledException){let S=v;V.extraDelay>0&&V.extraDelay<1e3&&(S+=V.extraDelay),O.streamReaderCancelTimeout=setTimeout(()=>{O.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:O,reason:V,force:!0})},S);return}}if(O.streamReader.cancel(new r.AbortException(V.message)).catch(()=>{}),O.streamReader=null,!this._transport.destroyed){for(const[S,T]of this._intentStates)if(T===O){this._intentStates.delete(S);break}this.cleanup()}}}get stats(){return this._stats}}A=new WeakMap,R=new WeakMap,B=new WeakSet,Le=function(O=!1){if(Z(this,nt,gi).call(this),!t(this,R)||this.destroyed)return!1;if(O)return ot(this,A,setTimeout(()=>{ot(this,A,null),Z(this,B,Le).call(this,!1)},l)),!1;for(const{renderTasks:V,operatorList:_}of this._intentStates.values())if(V.size>0||!_.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),ot(this,R,!1),!0},nt=new WeakSet,gi=function(){t(this,A)&&(clearTimeout(t(this,A)),ot(this,A,null))},o.PDFPageProxy=yt;class et{constructor(){U(this,mt,new Set);U(this,Mt,Promise.resolve())}postMessage(O,V){const _={data:structuredClone(O,V?{transfer:V}:null)};t(this,Mt).then(()=>{for(const S of t(this,mt))S.call(this,_)})}addEventListener(O,V){t(this,mt).add(V)}removeEventListener(O,V){t(this,mt).delete(V)}terminate(){t(this,mt).clear()}}mt=new WeakMap,Mt=new WeakMap,o.LoopbackPort=et;const bt={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};o.PDFWorkerUtil=bt;{if(r.isNodeJS&&typeof ji=="function")bt.isWorkerDisabled=!0,bt.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const pt=(At=document==null?void 0:document.currentScript)==null?void 0:At.src;pt&&(bt.fallbackWorkerSrc=pt.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}bt.isSameOrigin=function(pt,O){let V;try{if(V=new URL(pt),!V.origin||V.origin==="null")return!1}catch{return!1}const _=new URL(O,V);return V.origin===_.origin},bt.createCDNWrapper=function(pt){const O=`importScripts("${pt}");`;return URL.createObjectURL(new Blob([O]))}}const Vt=class Vt{constructor({name:O=null,port:V=null,verbosity:_=(0,r.getVerbosityLevel)()}={}){var S;if(this.name=O,this.destroyed=!1,this.verbosity=_,this._readyCapability=new r.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,V){if((S=t(Vt,Bt))!=null&&S.has(V))throw new Error("Cannot use more than one PDFWorker per port.");(t(Vt,Bt)||ot(Vt,Bt,new WeakMap)).set(V,this),this._initializeFromPort(V);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(O){this._port=O,this._messageHandler=new m.MessageHandler("main","worker",O),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!bt.isWorkerDisabled&&!Vt._mainThreadWorkerMessageHandler){let{workerSrc:O}=Vt;try{bt.isSameOrigin(window.location.href,O)||(O=bt.createCDNWrapper(new URL(O,window.location).href));const V=new Worker(O),_=new m.MessageHandler("main","worker",V),S=()=>{V.removeEventListener("error",T),_.destroy(),V.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},T=()=>{this._webWorker||S()};V.addEventListener("error",T),_.on("test",dt=>{if(V.removeEventListener("error",T),this.destroyed){S();return}dt?(this._messageHandler=_,this._port=V,this._webWorker=V,this._readyCapability.resolve(),_.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),_.destroy(),V.terminate())}),_.on("ready",dt=>{if(V.removeEventListener("error",T),this.destroyed){S();return}try{rt()}catch{this._setupFakeWorker()}});const rt=()=>{const dt=new Uint8Array;_.send("test",dt,[dt.buffer])};rt();return}catch{(0,r.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){bt.isWorkerDisabled||((0,r.warn)("Setting up fake worker."),bt.isWorkerDisabled=!0),Vt._setupFakeWorkerGlobal.then(O=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const V=new et;this._port=V;const _=`fake${bt.fakeWorkerId++}`,S=new m.MessageHandler(_+"_worker",_,V);O.setup(S,V);const T=new m.MessageHandler(_,_+"_worker",V);this._messageHandler=T,this._readyCapability.resolve(),T.send("configure",{verbosity:this.verbosity})}).catch(O=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${O.message}".`))})}destroy(){var O;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(O=t(Vt,Bt))==null||O.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(O){var _;if(!(O!=null&&O.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const V=(_=t(this,Bt))==null?void 0:_.get(O.port);if(V){if(V._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return V}return new Vt(O)}static get workerSrc(){if(F.GlobalWorkerOptions.workerSrc)return F.GlobalWorkerOptions.workerSrc;if(bt.fallbackWorkerSrc!==null)return r.isNodeJS||(0,q.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),bt.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var O;try{return((O=globalThis.pdfjsWorker)==null?void 0:O.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const O=async()=>{const V=this._mainThreadWorkerMessageHandler;return V||(r.isNodeJS&&typeof ji=="function"?ji(this.workerSrc).WorkerMessageHandler:(await(0,q.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler))};return(0,r.shadow)(this,"_setupFakeWorkerGlobal",O())}};Bt=new WeakMap,U(Vt,Bt,void 0);let Rt=Vt;o.PDFWorker=Rt;class Ut{constructor(O,V,_,S,T){U(this,st);U(this,kt,new Map);U(this,jt,new Map);U(this,St,new Map);U(this,it,null);this.messageHandler=O,this.loadingTask=V,this.commonObjs=new $t,this.fontLoader=new Y.FontLoader({ownerDocument:S.ownerDocument,styleElement:S.styleElement}),this._params=S,this.canvasFactory=T.canvasFactory,this.filterFactory=T.filterFactory,this.cMapReaderFactory=T.cMapReaderFactory,this.standardFontDataFactory=T.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=_,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new r.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,r.shadow)(this,"annotationStorage",new x.AnnotationStorage)}getRenderingIntent(O,V=r.AnnotationMode.ENABLE,_=null,S=!1){let T=r.RenderingIntentFlag.DISPLAY,rt=x.SerializableEmpty;switch(O){case"any":T=r.RenderingIntentFlag.ANY;break;case"display":break;case"print":T=r.RenderingIntentFlag.PRINT;break;default:(0,r.warn)(`getRenderingIntent - invalid intent: ${O}`)}switch(V){case r.AnnotationMode.DISABLE:T+=r.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case r.AnnotationMode.ENABLE:break;case r.AnnotationMode.ENABLE_FORMS:T+=r.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case r.AnnotationMode.ENABLE_STORAGE:T+=r.RenderingIntentFlag.ANNOTATIONS_STORAGE,rt=(T&r.RenderingIntentFlag.PRINT&&_ instanceof x.PrintAnnotationStorage?_:this.annotationStorage).serializable;break;default:(0,r.warn)(`getRenderingIntent - invalid annotationMode: ${V}`)}return S&&(T+=r.RenderingIntentFlag.OPLIST),{renderingIntent:T,cacheKey:`${T}_${rt.hash}`,annotationStorageSerializable:rt}}destroy(){var _;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new r.PromiseCapability,(_=t(this,it))==null||_.reject(new Error("Worker was destroyed during onPassword callback"));const O=[];for(const S of t(this,jt).values())O.push(S._destroy());t(this,jt).clear(),t(this,St).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const V=this.messageHandler.sendWithPromise("Terminate",null);return O.push(V),Promise.all(O).then(()=>{var S;this.commonObjs.clear(),this.fontLoader.clear(),t(this,kt).clear(),this.filterFactory.destroy(),(S=this._networkStream)==null||S.cancelAllRequests(new r.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:O,loadingTask:V}=this;O.on("GetReader",(_,S)=>{(0,r.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=T=>{this._lastProgress={loaded:T.loaded,total:T.total}},S.onPull=()=>{this._fullReader.read().then(function({value:T,done:rt}){if(rt){S.close();return}(0,r.assert)(T instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),S.enqueue(new Uint8Array(T),1,[T])}).catch(T=>{S.error(T)})},S.onCancel=T=>{this._fullReader.cancel(T),S.ready.catch(rt=>{if(!this.destroyed)throw rt})}}),O.on("ReaderHeadersReady",_=>{const S=new r.PromiseCapability,T=this._fullReader;return T.headersReady.then(()=>{var rt;(!T.isStreamingSupported||!T.isRangeSupported)&&(this._lastProgress&&((rt=V.onProgress)==null||rt.call(V,this._lastProgress)),T.onProgress=dt=>{var qt;(qt=V.onProgress)==null||qt.call(V,{loaded:dt.loaded,total:dt.total})}),S.resolve({isStreamingSupported:T.isStreamingSupported,isRangeSupported:T.isRangeSupported,contentLength:T.contentLength})},S.reject),S.promise}),O.on("GetRangeReader",(_,S)=>{(0,r.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const T=this._networkStream.getRangeReader(_.begin,_.end);if(!T){S.close();return}S.onPull=()=>{T.read().then(function({value:rt,done:dt}){if(dt){S.close();return}(0,r.assert)(rt instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),S.enqueue(new Uint8Array(rt),1,[rt])}).catch(rt=>{S.error(rt)})},S.onCancel=rt=>{T.cancel(rt),S.ready.catch(dt=>{if(!this.destroyed)throw dt})}}),O.on("GetDoc",({pdfInfo:_})=>{this._numPages=_.numPages,this._htmlForXfa=_.htmlForXfa,delete _.htmlForXfa,V._capability.resolve(new Et(_,this))}),O.on("DocException",function(_){let S;switch(_.name){case"PasswordException":S=new r.PasswordException(_.message,_.code);break;case"InvalidPDFException":S=new r.InvalidPDFException(_.message);break;case"MissingPDFException":S=new r.MissingPDFException(_.message);break;case"UnexpectedResponseException":S=new r.UnexpectedResponseException(_.message,_.status);break;case"UnknownErrorException":S=new r.UnknownErrorException(_.message,_.details);break;default:(0,r.unreachable)("DocException - expected a valid Error.")}V._capability.reject(S)}),O.on("PasswordRequest",_=>{if(ot(this,it,new r.PromiseCapability),V.onPassword){const S=T=>{T instanceof Error?t(this,it).reject(T):t(this,it).resolve({password:T})};try{V.onPassword(S,_.code)}catch(T){t(this,it).reject(T)}}else t(this,it).reject(new r.PasswordException(_.message,_.code));return t(this,it).promise}),O.on("DataLoaded",_=>{var S;(S=V.onProgress)==null||S.call(V,{loaded:_.length,total:_.length}),this.downloadInfoCapability.resolve(_)}),O.on("StartRenderPage",_=>{if(this.destroyed)return;t(this,jt).get(_.pageIndex)._startRenderPage(_.transparency,_.cacheKey)}),O.on("commonobj",([_,S,T])=>{var rt;if(!this.destroyed&&!this.commonObjs.has(_))switch(S){case"Font":const dt=this._params;if("error"in T){const K=T.error;(0,r.warn)(`Error during font loading: ${K}`),this.commonObjs.resolve(_,K);break}const qt=dt.pdfBug&&((rt=globalThis.FontInspector)!=null&&rt.enabled)?(K,Tt)=>globalThis.FontInspector.fontAdded(K,Tt):null,ie=new Y.FontFaceObject(T,{isEvalSupported:dt.isEvalSupported,disableFontFace:dt.disableFontFace,ignoreErrors:dt.ignoreErrors,inspectFont:qt});this.fontLoader.bind(ie).catch(K=>O.sendWithPromise("FontFallback",{id:_})).finally(()=>{!dt.fontExtraProperties&&ie.data&&(ie.data=null),this.commonObjs.resolve(_,ie)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(_,T);break;default:throw new Error(`Got unknown common object type ${S}`)}}),O.on("obj",([_,S,T,rt])=>{var qt;if(this.destroyed)return;const dt=t(this,jt).get(S);if(!dt.objs.has(_))switch(T){case"Image":if(dt.objs.resolve(_,rt),rt){let ie;if(rt.bitmap){const{width:K,height:Tt}=rt;ie=K*Tt*4}else ie=((qt=rt.data)==null?void 0:qt.length)||0;ie>r.MAX_IMAGE_SIZE_TO_CACHE&&(dt._maybeCleanupAfterRender=!0)}break;case"Pattern":dt.objs.resolve(_,rt);break;default:throw new Error(`Got unknown object type ${T}`)}}),O.on("DocProgress",_=>{var S;this.destroyed||(S=V.onProgress)==null||S.call(V,{loaded:_.loaded,total:_.total})}),O.on("FetchBuiltInCMap",_=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(_):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),O.on("FetchStandardFontData",_=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(_):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var _;this.annotationStorage.size<=0&&(0,r.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:O,transfers:V}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:O,filename:((_=this._fullReader)==null?void 0:_.filename)??null},V).finally(()=>{this.annotationStorage.resetModified()})}getPage(O){if(!Number.isInteger(O)||O<=0||O>this._numPages)return Promise.reject(new Error("Invalid page request."));const V=O-1,_=t(this,St).get(V);if(_)return _;const S=this.messageHandler.sendWithPromise("GetPage",{pageIndex:V}).then(T=>{if(this.destroyed)throw new Error("Transport destroyed");const rt=new yt(V,T,this,this._params.pdfBug);return t(this,jt).set(V,rt),rt});return t(this,St).set(V,S),S}getPageIndex(O){return typeof O!="object"||O===null||!Number.isInteger(O.num)||O.num<0||!Number.isInteger(O.gen)||O.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:O.num,gen:O.gen})}getAnnotations(O,V){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:O,intent:V})}getFieldObjects(){return Z(this,st,mi).call(this,"GetFieldObjects")}hasJSActions(){return Z(this,st,mi).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(O){return typeof O!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:O})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return Z(this,st,mi).call(this,"GetDocJSActions")}getPageJSActions(O){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:O})}getStructTree(O){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:O})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(O=>new W.OptionalContentConfig(O))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const O="GetMetadata",V=t(this,kt).get(O);if(V)return V;const _=this.messageHandler.sendWithPromise(O,null).then(S=>{var T,rt;return{info:S[0],metadata:S[1]?new H.Metadata(S[1]):null,contentDispositionFilename:((T=this._fullReader)==null?void 0:T.filename)??null,contentLength:((rt=this._fullReader)==null?void 0:rt.contentLength)??null}});return t(this,kt).set(O,_),_}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(O=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const V of t(this,jt).values())if(!V.cleanup())throw new Error(`startCleanup: Page ${V.pageNumber} is currently rendering.`);this.commonObjs.clear(),O||this.fontLoader.clear(),t(this,kt).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:O,enableXfa:V}=this._params;return(0,r.shadow)(this,"loadingParams",{disableAutoFetch:O,enableXfa:V})}}kt=new WeakMap,jt=new WeakMap,St=new WeakMap,it=new WeakMap,st=new WeakSet,mi=function(O,V=null){const _=t(this,kt).get(O);if(_)return _;const S=this.messageHandler.sendWithPromise(O,V);return t(this,kt).set(O,S),S};class $t{constructor(){U(this,Ot);U(this,Ft,Object.create(null))}get(O,V=null){if(V){const S=Z(this,Ot,Vi).call(this,O);return S.capability.promise.then(()=>V(S.data)),null}const _=t(this,Ft)[O];if(!(_!=null&&_.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${O}.`);return _.data}has(O){const V=t(this,Ft)[O];return(V==null?void 0:V.capability.settled)||!1}resolve(O,V=null){const _=Z(this,Ot,Vi).call(this,O);_.data=V,_.capability.resolve()}clear(){var O;for(const V in t(this,Ft)){const{data:_}=t(this,Ft)[V];(O=_==null?void 0:_.bitmap)==null||O.close()}ot(this,Ft,Object.create(null))}}Ft=new WeakMap,Ot=new WeakSet,Vi=function(O){var V;return(V=t(this,Ft))[O]||(V[O]={capability:new r.PromiseCapability,data:null})};class P{constructor(O){U(this,Kt,null);ot(this,Kt,O),this.onContinue=null}get promise(){return t(this,Kt).capability.promise}cancel(O=0){t(this,Kt).cancel(null,O)}get separateAnnots(){const{separateAnnots:O}=t(this,Kt).operatorList;if(!O)return!1;const{annotationCanvasMap:V}=t(this,Kt);return O.form||O.canvas&&(V==null?void 0:V.size)>0}}Kt=new WeakMap,o.RenderTask=P;const Zt=class Zt{constructor({callback:O,params:V,objs:_,commonObjs:S,annotationCanvasMap:T,operatorList:rt,pageIndex:dt,canvasFactory:qt,filterFactory:ie,useRequestAnimationFrame:K=!1,pdfBug:Tt=!1,pageColors:Nt=null}){this.callback=O,this.params=V,this.objs=_,this.commonObjs=S,this.annotationCanvasMap=T,this.operatorListIdx=null,this.operatorList=rt,this._pageIndex=dt,this.canvasFactory=qt,this.filterFactory=ie,this._pdfBug=Tt,this.pageColors=Nt,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=K===!0&&typeof window<"u",this.cancelled=!1,this.capability=new r.PromiseCapability,this.task=new P(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=V.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:O=!1,optionalContentConfig:V}){var dt,qt;if(this.cancelled)return;if(this._canvas){if(t(Zt,Jt).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");t(Zt,Jt).add(this._canvas)}this._pdfBug&&((dt=globalThis.StepperManager)!=null&&dt.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:_,viewport:S,transform:T,background:rt}=this.params;this.gfx=new z.CanvasGraphics(_,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:V},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:T,viewport:S,transparency:O,background:rt}),this.operatorListIdx=0,this.graphicsReady=!0,(qt=this.graphicsReadyCallback)==null||qt.call(this)}cancel(O=null,V=0){var _;this.running=!1,this.cancelled=!0,(_=this.gfx)==null||_.endDrawing(),t(Zt,Jt).delete(this._canvas),this.callback(O||new q.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,V))}operatorListChanged(){var O;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(O=this.stepper)==null||O.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),t(Zt,Jt).delete(this._canvas),this.callback())))}};Jt=new WeakMap,U(Zt,Jt,new WeakSet);let i=Zt;const a="3.11.174";o.version=a;const s="ce8716743";o.build=s},($,o,X)=>{var F,m,H,dn,L;Object.defineProperty(o,"__esModule",{value:!0}),o.SerializableEmpty=o.PrintAnnotationStorage=o.AnnotationStorage=void 0;var r=X(1),x=X(4),q=X(8);const Y=Object.freeze({map:null,hash:"",transfers:void 0});o.SerializableEmpty=Y;class gt{constructor(){U(this,H);U(this,F,!1);U(this,m,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(C,p){const y=t(this,m).get(C);return y===void 0?p:Object.assign(p,y)}getRawValue(C){return t(this,m).get(C)}remove(C){if(t(this,m).delete(C),t(this,m).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const p of t(this,m).values())if(p instanceof x.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(C,p){const y=t(this,m).get(C);let M=!1;if(y!==void 0)for(const[k,v]of Object.entries(p))y[k]!==v&&(M=!0,y[k]=v);else M=!0,t(this,m).set(C,p);M&&Z(this,H,dn).call(this),p instanceof x.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(p.constructor._type)}has(C){return t(this,m).has(C)}getAll(){return t(this,m).size>0?(0,r.objectFromMap)(t(this,m)):null}setAll(C){for(const[p,y]of Object.entries(C))this.setValue(p,y)}get size(){return t(this,m).size}resetModified(){t(this,F)&&(ot(this,F,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new z(this)}get serializable(){if(t(this,m).size===0)return Y;const C=new Map,p=new q.MurmurHash3_64,y=[],M=Object.create(null);let k=!1;for(const[v,l]of t(this,m)){const d=l instanceof x.AnnotationEditor?l.serialize(!1,M):l;d&&(C.set(v,d),p.update(`${v}:${JSON.stringify(d)}`),k||(k=!!d.bitmap))}if(k)for(const v of C.values())v.bitmap&&y.push(v.bitmap);return C.size>0?{map:C,hash:p.hexdigest(),transfers:y}:Y}}F=new WeakMap,m=new WeakMap,H=new WeakSet,dn=function(){t(this,F)||(ot(this,F,!0),typeof this.onSetModified=="function"&&this.onSetModified())},o.AnnotationStorage=gt;class z extends gt{constructor(p){super();U(this,L,void 0);const{map:y,hash:M,transfers:k}=p.serializable,v=structuredClone(y,k?{transfer:k}:null);ot(this,L,{map:v,hash:M,transfers:k})}get print(){(0,r.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return t(this,L)}}L=new WeakMap,o.PrintAnnotationStorage=z},($,o,X)=>{var z,F,m,H,W,L,w,C,p,y,M,k,v,l,d,qi,Q,Yi,_t,Ki,Pt,Ji,j,un,Et,fn,et,pn,Rt,Qi,$t,gn;Object.defineProperty(o,"__esModule",{value:!0}),o.AnnotationEditor=void 0;var r=X(5),x=X(1),q=X(6);const i=class i{constructor(s){U(this,d);U(this,Q);U(this,Pt);U(this,j);U(this,Et);U(this,et);U(this,Rt);U(this,$t);U(this,z,"");U(this,F,!1);U(this,m,null);U(this,H,null);U(this,W,null);U(this,L,!1);U(this,w,null);U(this,C,this.focusin.bind(this));U(this,p,this.focusout.bind(this));U(this,y,!1);U(this,M,!1);U(this,k,!1);oe(this,"_initialOptions",Object.create(null));oe(this,"_uiManager",null);oe(this,"_focusEventsAllowed",!0);oe(this,"_l10nPromise",null);U(this,v,!1);U(this,l,i._zIndex++);this.constructor===i&&(0,x.unreachable)("Cannot initialize AnnotationEditor."),this.parent=s.parent,this.id=s.id,this.width=this.height=null,this.pageIndex=s.parent.pageIndex,this.name=s.name,this.div=null,this._uiManager=s.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=s.isCentered,this._structTreeParentId=null;const{rotation:c,rawDims:{pageWidth:u,pageHeight:A,pageX:R,pageY:B}}=this.parent.viewport;this.rotation=c,this.pageRotation=(360+c-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[u,A],this.pageTranslation=[R,B];const[ct,nt]=this.parentDimensions;this.x=s.x/ct,this.y=s.y/nt,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,x.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(s){const c=new gt({id:s.parent.getNextId(),parent:s.parent,uiManager:s._uiManager});c.annotationElementId=s.annotationElementId,c.deleted=!0,c._uiManager.addToAnnotationStorage(c)}static initialize(s,c=null){if(i._l10nPromise||(i._l10nPromise=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(A=>[A,s.get(A)]))),c!=null&&c.strings)for(const A of c.strings)i._l10nPromise.set(A,s.get(A));if(i._borderLineWidth!==-1)return;const u=getComputedStyle(document.documentElement);i._borderLineWidth=parseFloat(u.getPropertyValue("--outline-width"))||0}static updateDefaultParams(s,c){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(s){return!1}static paste(s,c){(0,x.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return t(this,v)}set _isDraggable(s){var c;ot(this,v,s),(c=this.div)==null||c.classList.toggle("draggable",s)}center(){const[s,c]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*c/(s*2),this.y+=this.width*s/(c*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*c/(s*2),this.y-=this.width*s/(c*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(s){this._uiManager.addCommands(s)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=t(this,l)}setParent(s){s!==null&&(this.pageIndex=s.pageIndex,this.pageDimensions=s.pageDimensions),this.parent=s}focusin(s){this._focusEventsAllowed&&(t(this,y)?ot(this,y,!1):this.parent.setSelected(this))}focusout(s){var u;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const c=s.relatedTarget;c!=null&&c.closest(`#${this.id}`)||(s.preventDefault(),(u=this.parent)!=null&&u.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(s,c,u,A){const[R,B]=this.parentDimensions;[u,A]=this.screenToPageTranslation(u,A),this.x=(s+u)/R,this.y=(c+A)/B,this.fixAndSetPosition()}translate(s,c){Z(this,d,qi).call(this,this.parentDimensions,s,c)}translateInPage(s,c){Z(this,d,qi).call(this,this.pageDimensions,s,c),this.div.scrollIntoView({block:"nearest"})}drag(s,c){const[u,A]=this.parentDimensions;if(this.x+=s/u,this.y+=c/A,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:ft,y:mt}=this.div.getBoundingClientRect();this.parent.findNewParent(this,ft,mt)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:R,y:B}=this;const[ct,nt]=Z(this,Q,Yi).call(this);R+=ct,B+=nt,this.div.style.left=`${(100*R).toFixed(2)}%`,this.div.style.top=`${(100*B).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[s,c]=this.pageDimensions;let{x:u,y:A,width:R,height:B}=this;switch(R*=s,B*=c,u*=s,A*=c,this.rotation){case 0:u=Math.max(0,Math.min(s-R,u)),A=Math.max(0,Math.min(c-B,A));break;case 90:u=Math.max(0,Math.min(s-B,u)),A=Math.min(c,Math.max(R,A));break;case 180:u=Math.min(s,Math.max(R,u)),A=Math.min(c,Math.max(B,A));break;case 270:u=Math.min(s,Math.max(B,u)),A=Math.max(0,Math.min(c-R,A));break}this.x=u/=s,this.y=A/=c;const[ct,nt]=Z(this,Q,Yi).call(this);u+=ct,A+=nt;const{style:ft}=this.div;ft.left=`${(100*u).toFixed(2)}%`,ft.top=`${(100*A).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(s,c){var u;return Z(u=i,_t,Ki).call(u,s,c,this.parentRotation)}pageTranslationToScreen(s,c){var u;return Z(u=i,_t,Ki).call(u,s,c,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:s,pageDimensions:[c,u]}=this,A=c*s,R=u*s;return x.FeatureTest.isCSSRoundSupported?[Math.round(A),Math.round(R)]:[A,R]}setDims(s,c){var R;const[u,A]=this.parentDimensions;this.div.style.width=`${(100*s/u).toFixed(2)}%`,t(this,L)||(this.div.style.height=`${(100*c/A).toFixed(2)}%`),(R=t(this,m))==null||R.classList.toggle("small",s<i.SMALL_EDITOR_SIZE||c<i.SMALL_EDITOR_SIZE)}fixDims(){const{style:s}=this.div,{height:c,width:u}=s,A=u.endsWith("%"),R=!t(this,L)&&c.endsWith("%");if(A&&R)return;const[B,ct]=this.parentDimensions;A||(s.width=`${(100*parseFloat(u)/B).toFixed(2)}%`),!t(this,L)&&!R&&(s.height=`${(100*parseFloat(c)/ct).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}async addAltTextButton(){if(t(this,m))return;const s=ot(this,m,document.createElement("button"));s.className="altText";const c=await i._l10nPromise.get("editor_alt_text_button_label");s.textContent=c,s.setAttribute("aria-label",c),s.tabIndex="0",s.addEventListener("contextmenu",q.noContextMenu),s.addEventListener("pointerdown",u=>u.stopPropagation()),s.addEventListener("click",u=>{u.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),s.addEventListener("keydown",u=>{u.target===s&&u.key==="Enter"&&(u.preventDefault(),this._uiManager.editAltText(this))}),Z(this,Rt,Qi).call(this),this.div.append(s),i.SMALL_EDITOR_SIZE||(i.SMALL_EDITOR_SIZE=Math.min(128,Math.round(s.getBoundingClientRect().width*1.4)))}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:t(this,z),decorative:t(this,F)}}set altTextData({altText:s,decorative:c}){t(this,z)===s&&t(this,F)===c||(ot(this,z,s),ot(this,F,c),Z(this,Rt,Qi).call(this))}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",t(this,C)),this.div.addEventListener("focusout",t(this,p));const[s,c]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*c/s).toFixed(2)}%`,this.div.style.maxHeight=`${(100*s/c).toFixed(2)}%`);const[u,A]=this.getInitialTranslation();return this.translate(u,A),(0,r.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(s){const{isMac:c}=x.FeatureTest.platform;if(s.button!==0||s.ctrlKey&&c){s.preventDefault();return}ot(this,y,!0),Z(this,$t,gn).call(this,s)}moveInDOM(){var s;(s=this.parent)==null||s.moveEditorInDOM(this)}_setParentAndPosition(s,c,u){s.changeParent(this),this.x=c,this.y=u,this.fixAndSetPosition()}getRect(s,c){const u=this.parentScale,[A,R]=this.pageDimensions,[B,ct]=this.pageTranslation,nt=s/u,ft=c/u,mt=this.x*A,Mt=this.y*R,At=this.width*A,Bt=this.height*R;switch(this.rotation){case 0:return[mt+nt+B,R-Mt-ft-Bt+ct,mt+nt+At+B,R-Mt-ft+ct];case 90:return[mt+ft+B,R-Mt+nt+ct,mt+ft+Bt+B,R-Mt+nt+At+ct];case 180:return[mt-nt-At+B,R-Mt+ft+ct,mt-nt+B,R-Mt+ft+Bt+ct];case 270:return[mt-ft-Bt+B,R-Mt-nt-At+ct,mt-ft+B,R-Mt-nt+ct];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(s,c){const[u,A,R,B]=s,ct=R-u,nt=B-A;switch(this.rotation){case 0:return[u,c-B,ct,nt];case 90:return[u,c-A,nt,ct];case 180:return[R,c-A,ct,nt];case 270:return[R,c-B,nt,ct];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){ot(this,k,!0)}disableEditMode(){ot(this,k,!1)}isInEditMode(){return t(this,k)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var s,c;(s=this.div)==null||s.addEventListener("focusin",t(this,C)),(c=this.div)==null||c.addEventListener("focusout",t(this,p))}serialize(s=!1,c=null){(0,x.unreachable)("An editor must be serializable")}static deserialize(s,c,u){const A=new this.prototype.constructor({parent:c,id:c.getNextId(),uiManager:u});A.rotation=s.rotation;const[R,B]=A.pageDimensions,[ct,nt,ft,mt]=A.getRectInCurrentCoords(s.rect,B);return A.x=ct/R,A.y=nt/B,A.width=ft/R,A.height=mt/B,A}remove(){var s;this.div.removeEventListener("focusin",t(this,C)),this.div.removeEventListener("focusout",t(this,p)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),(s=t(this,m))==null||s.remove(),ot(this,m,null),ot(this,H,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(Z(this,j,un).call(this),t(this,w).classList.remove("hidden"))}select(){var s;this.makeResizable(),(s=this.div)==null||s.classList.add("selectedEditor")}unselect(){var s,c,u;(s=t(this,w))==null||s.classList.add("hidden"),(c=this.div)==null||c.classList.remove("selectedEditor"),(u=this.div)!=null&&u.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(s,c){}disableEditing(){t(this,m)&&(t(this,m).hidden=!0)}enableEditing(){t(this,m)&&(t(this,m).hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return t(this,M)}set isEditing(s){ot(this,M,s),this.parent&&(s?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(s,c){ot(this,L,!0);const u=s/c,{style:A}=this.div;A.aspectRatio=u,A.height="auto"}static get MIN_SIZE(){return 16}};z=new WeakMap,F=new WeakMap,m=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakMap,w=new WeakMap,C=new WeakMap,p=new WeakMap,y=new WeakMap,M=new WeakMap,k=new WeakMap,v=new WeakMap,l=new WeakMap,d=new WeakSet,qi=function([s,c],u,A){[u,A]=this.screenToPageTranslation(u,A),this.x+=u/s,this.y+=A/c,this.fixAndSetPosition()},Q=new WeakSet,Yi=function(){const[s,c]=this.parentDimensions,{_borderLineWidth:u}=i,A=u/s,R=u/c;switch(this.rotation){case 90:return[-A,R];case 180:return[A,R];case 270:return[A,-R];default:return[-A,-R]}},_t=new WeakSet,Ki=function(s,c,u){switch(u){case 90:return[c,-s];case 180:return[-s,-c];case 270:return[-c,s];default:return[s,c]}},Pt=new WeakSet,Ji=function(s){switch(s){case 90:{const[c,u]=this.pageDimensions;return[0,-c/u,u/c,0]}case 180:return[-1,0,0,-1];case 270:{const[c,u]=this.pageDimensions;return[0,c/u,-u/c,0]}default:return[1,0,0,1]}},j=new WeakSet,un=function(){if(t(this,w))return;ot(this,w,document.createElement("div")),t(this,w).classList.add("resizers");const s=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||s.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const c of s){const u=document.createElement("div");t(this,w).append(u),u.classList.add("resizer",c),u.addEventListener("pointerdown",Z(this,Et,fn).bind(this,c)),u.addEventListener("contextmenu",q.noContextMenu)}this.div.prepend(t(this,w))},Et=new WeakSet,fn=function(s,c){c.preventDefault();const{isMac:u}=x.FeatureTest.platform;if(c.button!==0||c.ctrlKey&&u)return;const A=Z(this,et,pn).bind(this,s),R=this._isDraggable;this._isDraggable=!1;const B={passive:!0,capture:!0};window.addEventListener("pointermove",A,B);const ct=this.x,nt=this.y,ft=this.width,mt=this.height,Mt=this.parent.div.style.cursor,At=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(c.target).cursor;const Bt=()=>{this._isDraggable=R,window.removeEventListener("pointerup",Bt),window.removeEventListener("blur",Bt),window.removeEventListener("pointermove",A,B),this.parent.div.style.cursor=Mt,this.div.style.cursor=At;const Vt=this.x,kt=this.y,jt=this.width,St=this.height;Vt===ct&&kt===nt&&jt===ft&&St===mt||this.addCommands({cmd:()=>{this.width=jt,this.height=St,this.x=Vt,this.y=kt;const[it,st]=this.parentDimensions;this.setDims(it*jt,st*St),this.fixAndSetPosition()},undo:()=>{this.width=ft,this.height=mt,this.x=ct,this.y=nt;const[it,st]=this.parentDimensions;this.setDims(it*ft,st*mt),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",Bt),window.addEventListener("blur",Bt)},et=new WeakSet,pn=function(s,c){const[u,A]=this.parentDimensions,R=this.x,B=this.y,ct=this.width,nt=this.height,ft=i.MIN_SIZE/u,mt=i.MIN_SIZE/A,Mt=rt=>Math.round(rt*1e4)/1e4,At=Z(this,Pt,Ji).call(this,this.rotation),Bt=(rt,dt)=>[At[0]*rt+At[2]*dt,At[1]*rt+At[3]*dt],Vt=Z(this,Pt,Ji).call(this,360-this.rotation),kt=(rt,dt)=>[Vt[0]*rt+Vt[2]*dt,Vt[1]*rt+Vt[3]*dt];let jt,St,it=!1,st=!1;switch(s){case"topLeft":it=!0,jt=(rt,dt)=>[0,0],St=(rt,dt)=>[rt,dt];break;case"topMiddle":jt=(rt,dt)=>[rt/2,0],St=(rt,dt)=>[rt/2,dt];break;case"topRight":it=!0,jt=(rt,dt)=>[rt,0],St=(rt,dt)=>[0,dt];break;case"middleRight":st=!0,jt=(rt,dt)=>[rt,dt/2],St=(rt,dt)=>[0,dt/2];break;case"bottomRight":it=!0,jt=(rt,dt)=>[rt,dt],St=(rt,dt)=>[0,0];break;case"bottomMiddle":jt=(rt,dt)=>[rt/2,dt],St=(rt,dt)=>[rt/2,0];break;case"bottomLeft":it=!0,jt=(rt,dt)=>[0,dt],St=(rt,dt)=>[rt,0];break;case"middleLeft":st=!0,jt=(rt,dt)=>[0,dt/2],St=(rt,dt)=>[rt,dt/2];break}const vt=jt(ct,nt),Ft=St(ct,nt);let Ot=Bt(...Ft);const te=Mt(R+Ot[0]),Kt=Mt(B+Ot[1]);let Jt=1,Zt=1,[pt,O]=this.screenToPageTranslation(c.movementX,c.movementY);if([pt,O]=kt(pt/u,O/A),it){const rt=Math.hypot(ct,nt);Jt=Zt=Math.max(Math.min(Math.hypot(Ft[0]-vt[0]-pt,Ft[1]-vt[1]-O)/rt,1/ct,1/nt),ft/ct,mt/nt)}else st?Jt=Math.max(ft,Math.min(1,Math.abs(Ft[0]-vt[0]-pt)))/ct:Zt=Math.max(mt,Math.min(1,Math.abs(Ft[1]-vt[1]-O)))/nt;const V=Mt(ct*Jt),_=Mt(nt*Zt);Ot=Bt(...St(V,_));const S=te-Ot[0],T=Kt-Ot[1];this.width=V,this.height=_,this.x=S,this.y=T,this.setDims(u*V,A*_),this.fixAndSetPosition()},Rt=new WeakSet,Qi=async function(){var u;const s=t(this,m);if(!s)return;if(!t(this,z)&&!t(this,F)){s.classList.remove("done"),(u=t(this,H))==null||u.remove();return}i._l10nPromise.get("editor_alt_text_edit_button_label").then(A=>{s.setAttribute("aria-label",A)});let c=t(this,H);if(!c){ot(this,H,c=document.createElement("span")),c.className="tooltip",c.setAttribute("role","tooltip");const A=c.id=`alt-text-tooltip-${this.id}`;s.setAttribute("aria-describedby",A);const R=100;s.addEventListener("mouseenter",()=>{ot(this,W,setTimeout(()=>{ot(this,W,null),t(this,H).classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},R))}),s.addEventListener("mouseleave",()=>{var B;clearTimeout(t(this,W)),ot(this,W,null),(B=t(this,H))==null||B.classList.remove("show")})}s.classList.add("done"),c.innerText=t(this,F)?await i._l10nPromise.get("editor_alt_text_decorative_tooltip"):t(this,z),c.parentNode||s.append(c)},$t=new WeakSet,gn=function(s){if(!this._isDraggable)return;const c=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let u,A;c&&(u={passive:!0,capture:!0},A=B=>{const[ct,nt]=this.screenToPageTranslation(B.movementX,B.movementY);this._uiManager.dragSelectedEditors(ct,nt)},window.addEventListener("pointermove",A,u));const R=()=>{if(window.removeEventListener("pointerup",R),window.removeEventListener("blur",R),c&&window.removeEventListener("pointermove",A,u),ot(this,y,!1),!this._uiManager.endDragSession()){const{isMac:B}=x.FeatureTest.platform;s.ctrlKey&&!B||s.shiftKey||s.metaKey&&B?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",R),window.addEventListener("blur",R)},U(i,_t),oe(i,"_borderLineWidth",-1),oe(i,"_colorManager",new r.ColorManager),oe(i,"_zIndex",1),oe(i,"SMALL_EDITOR_SIZE",0);let Y=i;o.AnnotationEditor=Y;class gt extends Y{constructor(s){super(s),this.annotationElementId=s.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},($,o,X)=>{var L,w,C,p,y,Zi,v,l,d,I,Q,mn,at,Pt,Ct,j,ut,Et,yt,et,bt,Rt,Ut,$t,P,i,a,s,c,u,A,R,B,ct,nt,ft,mt,Mt,At,Bt,Vt,kt,jt,St,it,st,vt,bn,Ot,ts,Kt,es,Zt,bi,O,is,_,ss,T,Ae,dt,Ve,ie,An,Tt,yn,Dt,ns,Gt,qe,xt,rs;Object.defineProperty(o,"__esModule",{value:!0}),o.KeyboardManager=o.CommandManager=o.ColorManager=o.AnnotationEditorUIManager=void 0,o.bindEvents=q,o.opacityToHex=Y;var r=X(1),x=X(6);function q(D,e,g){for(const N of g)e.addEventListener(N,D[N].bind(D))}function Y(D){return Math.round(Math.min(255,Math.max(1,255*D))).toString(16).padStart(2,"0")}class gt{constructor(){U(this,L,0)}getId(){return`${r.AnnotationEditorPrefix}${Ge(this,L)._++}`}}L=new WeakMap;const k=class k{constructor(){U(this,y);U(this,w,(0,r.getUuid)());U(this,C,0);U(this,p,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',N=new OffscreenCanvas(1,3).getContext("2d"),G=new Image;G.src=e;const tt=G.decode().then(()=>(N.drawImage(G,0,0,1,1,0,0,1,3),new Uint32Array(N.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,r.shadow)(this,"_isSVGFittingCanvas",tt)}async getFromFile(e){const{lastModified:g,name:N,size:G,type:tt}=e;return Z(this,y,Zi).call(this,`${g}_${N}_${G}_${tt}`,e)}async getFromUrl(e){return Z(this,y,Zi).call(this,e,e)}async getFromId(e){t(this,p)||ot(this,p,new Map);const g=t(this,p).get(e);return g?g.bitmap?(g.refCounter+=1,g):g.file?this.getFromFile(g.file):this.getFromUrl(g.url):null}getSvgUrl(e){const g=t(this,p).get(e);return g!=null&&g.isSvg?g.svgUrl:null}deleteId(e){t(this,p)||ot(this,p,new Map);const g=t(this,p).get(e);g&&(g.refCounter-=1,g.refCounter===0&&(g.bitmap=null))}isValidId(e){return e.startsWith(`image_${t(this,w)}_`)}};w=new WeakMap,C=new WeakMap,p=new WeakMap,y=new WeakSet,Zi=async function(e,g){t(this,p)||ot(this,p,new Map);let N=t(this,p).get(e);if(N===null)return null;if(N!=null&&N.bitmap)return N.refCounter+=1,N;try{N||(N={bitmap:null,id:`image_${t(this,w)}_${Ge(this,C)._++}`,refCounter:0,isSvg:!1});let G;if(typeof g=="string"){N.url=g;const tt=await fetch(g);if(!tt.ok)throw new Error(tt.statusText);G=await tt.blob()}else G=N.file=g;if(G.type==="image/svg+xml"){const tt=k._isSVGFittingCanvas,ht=new FileReader,wt=new Image,Lt=new Promise((It,Qt)=>{wt.onload=()=>{N.bitmap=wt,N.isSvg=!0,It()},ht.onload=async()=>{const Ht=N.svgUrl=ht.result;wt.src=await tt?`${Ht}#svgView(preserveAspectRatio(none))`:Ht},wt.onerror=ht.onerror=Qt});ht.readAsDataURL(G),await Lt}else N.bitmap=await createImageBitmap(G);N.refCounter=1}catch(G){console.error(G),N=null}return t(this,p).set(e,N),N&&t(this,p).set(N.id,N),N};let z=k;class F{constructor(e=128){U(this,v,[]);U(this,l,!1);U(this,d,void 0);U(this,I,-1);ot(this,d,e)}add({cmd:e,undo:g,mustExec:N,type:G=NaN,overwriteIfSameType:tt=!1,keepUndo:ht=!1}){if(N&&e(),t(this,l))return;const wt={cmd:e,undo:g,type:G};if(t(this,I)===-1){t(this,v).length>0&&(t(this,v).length=0),ot(this,I,0),t(this,v).push(wt);return}if(tt&&t(this,v)[t(this,I)].type===G){ht&&(wt.undo=t(this,v)[t(this,I)].undo),t(this,v)[t(this,I)]=wt;return}const Lt=t(this,I)+1;Lt===t(this,d)?t(this,v).splice(0,1):(ot(this,I,Lt),Lt<t(this,v).length&&t(this,v).splice(Lt)),t(this,v).push(wt)}undo(){t(this,I)!==-1&&(ot(this,l,!0),t(this,v)[t(this,I)].undo(),ot(this,l,!1),ot(this,I,t(this,I)-1))}redo(){t(this,I)<t(this,v).length-1&&(ot(this,I,t(this,I)+1),ot(this,l,!0),t(this,v)[t(this,I)].cmd(),ot(this,l,!1))}hasSomethingToUndo(){return t(this,I)!==-1}hasSomethingToRedo(){return t(this,I)<t(this,v).length-1}destroy(){ot(this,v,null)}}v=new WeakMap,l=new WeakMap,d=new WeakMap,I=new WeakMap,o.CommandManager=F;class m{constructor(e){U(this,Q);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:g}=r.FeatureTest.platform;for(const[N,G,tt={}]of e)for(const ht of N){const wt=ht.startsWith("mac+");g&&wt?(this.callbacks.set(ht.slice(4),{callback:G,options:tt}),this.allKeys.add(ht.split("+").at(-1))):!g&&!wt&&(this.callbacks.set(ht,{callback:G,options:tt}),this.allKeys.add(ht.split("+").at(-1)))}}exec(e,g){if(!this.allKeys.has(g.key))return;const N=this.callbacks.get(Z(this,Q,mn).call(this,g));if(!N)return;const{callback:G,options:{bubbles:tt=!1,args:ht=[],checker:wt=null}}=N;wt&&!wt(e,g)||(G.bind(e,...ht)(),tt||(g.stopPropagation(),g.preventDefault()))}}Q=new WeakSet,mn=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const g=this.buffer.join("+");return this.buffer.length=0,g},o.KeyboardManager=m;const _t=class _t{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return(0,x.getColorValues)(e),(0,r.shadow)(this,"_colors",e)}convert(e){const g=(0,x.getRGB)(e);if(!window.matchMedia("(forced-colors: active)").matches)return g;for(const[N,G]of this._colors)if(G.every((tt,ht)=>tt===g[ht]))return _t._colorsMapping.get(N);return g}getHexCode(e){const g=this._colors.get(e);return g?r.Util.makeHexColor(...g):e}};oe(_t,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let H=_t;o.ColorManager=H;const Wt=class Wt{constructor(e,g,N,G,tt,ht){U(this,vt);U(this,Ot);U(this,Kt);U(this,Zt);U(this,O);U(this,_);U(this,T);U(this,dt);U(this,ie);U(this,Tt);U(this,Dt);U(this,Gt);U(this,xt);U(this,at,null);U(this,Pt,new Map);U(this,Ct,new Map);U(this,j,null);U(this,ut,null);U(this,Et,new F);U(this,yt,0);U(this,et,new Set);U(this,bt,null);U(this,Rt,null);U(this,Ut,new Set);U(this,$t,null);U(this,P,new gt);U(this,i,!1);U(this,a,!1);U(this,s,null);U(this,c,r.AnnotationEditorType.NONE);U(this,u,new Set);U(this,A,null);U(this,R,this.blur.bind(this));U(this,B,this.focus.bind(this));U(this,ct,this.copy.bind(this));U(this,nt,this.cut.bind(this));U(this,ft,this.paste.bind(this));U(this,mt,this.keydown.bind(this));U(this,Mt,this.onEditingAction.bind(this));U(this,At,this.onPageChanging.bind(this));U(this,Bt,this.onScaleChanging.bind(this));U(this,Vt,this.onRotationChanging.bind(this));U(this,kt,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});U(this,jt,[0,0]);U(this,St,null);U(this,it,null);U(this,st,null);ot(this,it,e),ot(this,st,g),ot(this,j,N),this._eventBus=G,this._eventBus._on("editingaction",t(this,Mt)),this._eventBus._on("pagechanging",t(this,At)),this._eventBus._on("scalechanging",t(this,Bt)),this._eventBus._on("rotationchanging",t(this,Vt)),ot(this,ut,tt.annotationStorage),ot(this,$t,tt.filterFactory),ot(this,A,ht),this.viewParameters={realScale:x.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const e=Wt.prototype,g=tt=>{const{activeElement:ht}=document;return ht&&t(tt,it).contains(ht)&&tt.hasSomethingToControl()},N=this.TRANSLATE_SMALL,G=this.TRANSLATE_BIG;return(0,r.shadow)(this,"_keyboardManager",new m([[["ctrl+a","mac+meta+a"],e.selectAll],[["ctrl+z","mac+meta+z"],e.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-N,0],checker:g}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-G,0],checker:g}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[N,0],checker:g}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[G,0],checker:g}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-N],checker:g}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-G],checker:g}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,N],checker:g}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,G],checker:g}]]))}destroy(){Z(this,Zt,bi).call(this),Z(this,Ot,ts).call(this),this._eventBus._off("editingaction",t(this,Mt)),this._eventBus._off("pagechanging",t(this,At)),this._eventBus._off("scalechanging",t(this,Bt)),this._eventBus._off("rotationchanging",t(this,Vt));for(const e of t(this,Ct).values())e.destroy();t(this,Ct).clear(),t(this,Pt).clear(),t(this,Ut).clear(),ot(this,at,null),t(this,u).clear(),t(this,Et).destroy(),t(this,j).destroy()}get hcmFilter(){return(0,r.shadow)(this,"hcmFilter",t(this,A)?t(this,$t).addHCMFilter(t(this,A).foreground,t(this,A).background):"none")}get direction(){return(0,r.shadow)(this,"direction",getComputedStyle(t(this,it)).direction)}editAltText(e){var g;(g=t(this,j))==null||g.editAltText(this,e)}onPageChanging({pageNumber:e}){ot(this,yt,e-1)}focusMainContainer(){t(this,it).focus()}findParent(e,g){for(const N of t(this,Ct).values()){const{x:G,y:tt,width:ht,height:wt}=N.div.getBoundingClientRect();if(e>=G&&e<=G+ht&&g>=tt&&g<=tt+wt)return N}return null}disableUserSelect(e=!1){t(this,st).classList.toggle("noUserSelect",e)}addShouldRescale(e){t(this,Ut).add(e)}removeShouldRescale(e){t(this,Ut).delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*x.PixelsPerInch.PDF_TO_CSS_UNITS;for(const g of t(this,Ut))g.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}addToAnnotationStorage(e){!e.isEmpty()&&t(this,ut)&&!t(this,ut).has(e.id)&&t(this,ut).setValue(e.id,e)}blur(){if(!this.hasSelection)return;const{activeElement:e}=document;for(const g of t(this,u))if(g.div.contains(e)){ot(this,s,[g,e]),g._focusEventsAllowed=!1;break}}focus(){if(!t(this,s))return;const[e,g]=t(this,s);ot(this,s,null),g.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0}),g.focus()}addEditListeners(){Z(this,Kt,es).call(this),Z(this,O,is).call(this)}removeEditListeners(){Z(this,Zt,bi).call(this),Z(this,_,ss).call(this)}copy(e){var N;if(e.preventDefault(),(N=t(this,at))==null||N.commitOrRemove(),!this.hasSelection)return;const g=[];for(const G of t(this,u)){const tt=G.serialize(!0);tt&&g.push(tt)}g.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(g))}cut(e){this.copy(e),this.delete()}paste(e){e.preventDefault();const{clipboardData:g}=e;for(const tt of g.items)for(const ht of t(this,Rt))if(ht.isHandlingMimeForPasting(tt.type)){ht.paste(tt,this.currentLayer);return}let N=g.getData("application/pdfjs");if(!N)return;try{N=JSON.parse(N)}catch(tt){(0,r.warn)(`paste: "${tt.message}".`);return}if(!Array.isArray(N))return;this.unselectAll();const G=this.currentLayer;try{const tt=[];for(const Lt of N){const It=G.deserialize(Lt);if(!It)return;tt.push(It)}const ht=()=>{for(const Lt of tt)Z(this,Dt,ns).call(this,Lt);Z(this,xt,rs).call(this,tt)},wt=()=>{for(const Lt of tt)Lt.remove()};this.addCommands({cmd:ht,undo:wt,mustExec:!0})}catch(tt){(0,r.warn)(`paste: "${tt.message}".`)}}keydown(e){var g;(g=this.getActive())!=null&&g.shouldGetKeyboardEvents()||Wt._keyboardManager.exec(this,e)}onEditingAction(e){["undo","redo","delete","selectAll"].includes(e.name)&&this[e.name]()}setEditingState(e){e?(Z(this,vt,bn).call(this),Z(this,Kt,es).call(this),Z(this,O,is).call(this),Z(this,T,Ae).call(this,{isEditing:t(this,c)!==r.AnnotationEditorType.NONE,isEmpty:Z(this,Gt,qe).call(this),hasSomethingToUndo:t(this,Et).hasSomethingToUndo(),hasSomethingToRedo:t(this,Et).hasSomethingToRedo(),hasSelectedEditor:!1})):(Z(this,Ot,ts).call(this),Z(this,Zt,bi).call(this),Z(this,_,ss).call(this),Z(this,T,Ae).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!t(this,Rt)){ot(this,Rt,e);for(const g of t(this,Rt))Z(this,dt,Ve).call(this,g.defaultPropertiesToUpdate)}}getId(){return t(this,P).getId()}get currentLayer(){return t(this,Ct).get(t(this,yt))}getLayer(e){return t(this,Ct).get(e)}get currentPageIndex(){return t(this,yt)}addLayer(e){t(this,Ct).set(e.pageIndex,e),t(this,i)?e.enable():e.disable()}removeLayer(e){t(this,Ct).delete(e.pageIndex)}updateMode(e,g=null){if(t(this,c)!==e){if(ot(this,c,e),e===r.AnnotationEditorType.NONE){this.setEditingState(!1),Z(this,Tt,yn).call(this);return}this.setEditingState(!0),Z(this,ie,An).call(this),this.unselectAll();for(const N of t(this,Ct).values())N.updateMode(e);if(g){for(const N of t(this,Pt).values())if(N.annotationElementId===g){this.setSelected(N),N.enterInEditMode();break}}}}updateToolbar(e){e!==t(this,c)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,g){if(t(this,Rt)){if(e===r.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(e);return}for(const N of t(this,u))N.updateParams(e,g);for(const N of t(this,Rt))N.updateDefaultParams(e,g)}}enableWaiting(e=!1){if(t(this,a)!==e){ot(this,a,e);for(const g of t(this,Ct).values())e?g.disableClick():g.enableClick(),g.div.classList.toggle("waiting",e)}}getEditors(e){const g=[];for(const N of t(this,Pt).values())N.pageIndex===e&&g.push(N);return g}getEditor(e){return t(this,Pt).get(e)}addEditor(e){t(this,Pt).set(e.id,e)}removeEditor(e){var g;t(this,Pt).delete(e.id),this.unselect(e),(!e.annotationElementId||!t(this,et).has(e.annotationElementId))&&((g=t(this,ut))==null||g.remove(e.id))}addDeletedAnnotationElement(e){t(this,et).add(e.annotationElementId),e.deleted=!0}isDeletedAnnotationElement(e){return t(this,et).has(e)}removeDeletedAnnotationElement(e){t(this,et).delete(e.annotationElementId),e.deleted=!1}setActiveEditor(e){t(this,at)!==e&&(ot(this,at,e),e&&Z(this,dt,Ve).call(this,e.propertiesToUpdate))}toggleSelected(e){if(t(this,u).has(e)){t(this,u).delete(e),e.unselect(),Z(this,T,Ae).call(this,{hasSelectedEditor:this.hasSelection});return}t(this,u).add(e),e.select(),Z(this,dt,Ve).call(this,e.propertiesToUpdate),Z(this,T,Ae).call(this,{hasSelectedEditor:!0})}setSelected(e){for(const g of t(this,u))g!==e&&g.unselect();t(this,u).clear(),t(this,u).add(e),e.select(),Z(this,dt,Ve).call(this,e.propertiesToUpdate),Z(this,T,Ae).call(this,{hasSelectedEditor:!0})}isSelected(e){return t(this,u).has(e)}unselect(e){e.unselect(),t(this,u).delete(e),Z(this,T,Ae).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return t(this,u).size!==0}undo(){t(this,Et).undo(),Z(this,T,Ae).call(this,{hasSomethingToUndo:t(this,Et).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:Z(this,Gt,qe).call(this)})}redo(){t(this,Et).redo(),Z(this,T,Ae).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:t(this,Et).hasSomethingToRedo(),isEmpty:Z(this,Gt,qe).call(this)})}addCommands(e){t(this,Et).add(e),Z(this,T,Ae).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:Z(this,Gt,qe).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const e=[...t(this,u)],g=()=>{for(const G of e)G.remove()},N=()=>{for(const G of e)Z(this,Dt,ns).call(this,G)};this.addCommands({cmd:g,undo:N,mustExec:!0})}commitOrRemove(){var e;(e=t(this,at))==null||e.commitOrRemove()}hasSomethingToControl(){return t(this,at)||this.hasSelection}selectAll(){for(const e of t(this,u))e.commit();Z(this,xt,rs).call(this,t(this,Pt).values())}unselectAll(){if(t(this,at)){t(this,at).commitOrRemove();return}if(this.hasSelection){for(const e of t(this,u))e.unselect();t(this,u).clear(),Z(this,T,Ae).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,g,N=!1){if(N||this.commitOrRemove(),!this.hasSelection)return;t(this,jt)[0]+=e,t(this,jt)[1]+=g;const[G,tt]=t(this,jt),ht=[...t(this,u)],wt=1e3;t(this,St)&&clearTimeout(t(this,St)),ot(this,St,setTimeout(()=>{ot(this,St,null),t(this,jt)[0]=t(this,jt)[1]=0,this.addCommands({cmd:()=>{for(const Lt of ht)t(this,Pt).has(Lt.id)&&Lt.translateInPage(G,tt)},undo:()=>{for(const Lt of ht)t(this,Pt).has(Lt.id)&&Lt.translateInPage(-G,-tt)},mustExec:!1})},wt));for(const Lt of ht)Lt.translateInPage(e,g)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),ot(this,bt,new Map);for(const e of t(this,u))t(this,bt).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!t(this,bt))return!1;this.disableUserSelect(!1);const e=t(this,bt);ot(this,bt,null);let g=!1;for(const[{x:G,y:tt,pageIndex:ht},wt]of e)wt.newX=G,wt.newY=tt,wt.newPageIndex=ht,g||(g=G!==wt.savedX||tt!==wt.savedY||ht!==wt.savedPageIndex);if(!g)return!1;const N=(G,tt,ht,wt)=>{if(t(this,Pt).has(G.id)){const Lt=t(this,Ct).get(wt);Lt?G._setParentAndPosition(Lt,tt,ht):(G.pageIndex=wt,G.x=tt,G.y=ht)}};return this.addCommands({cmd:()=>{for(const[G,{newX:tt,newY:ht,newPageIndex:wt}]of e)N(G,tt,ht,wt)},undo:()=>{for(const[G,{savedX:tt,savedY:ht,savedPageIndex:wt}]of e)N(G,tt,ht,wt)},mustExec:!0}),!0}dragSelectedEditors(e,g){if(t(this,bt))for(const N of t(this,bt).keys())N.drag(e,g)}rebuild(e){if(e.parent===null){const g=this.getLayer(e.pageIndex);g?(g.changeParent(e),g.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}isActive(e){return t(this,at)===e}getActive(){return t(this,at)}getMode(){return t(this,c)}get imageManager(){return(0,r.shadow)(this,"imageManager",new z)}};at=new WeakMap,Pt=new WeakMap,Ct=new WeakMap,j=new WeakMap,ut=new WeakMap,Et=new WeakMap,yt=new WeakMap,et=new WeakMap,bt=new WeakMap,Rt=new WeakMap,Ut=new WeakMap,$t=new WeakMap,P=new WeakMap,i=new WeakMap,a=new WeakMap,s=new WeakMap,c=new WeakMap,u=new WeakMap,A=new WeakMap,R=new WeakMap,B=new WeakMap,ct=new WeakMap,nt=new WeakMap,ft=new WeakMap,mt=new WeakMap,Mt=new WeakMap,At=new WeakMap,Bt=new WeakMap,Vt=new WeakMap,kt=new WeakMap,jt=new WeakMap,St=new WeakMap,it=new WeakMap,st=new WeakMap,vt=new WeakSet,bn=function(){window.addEventListener("focus",t(this,B)),window.addEventListener("blur",t(this,R))},Ot=new WeakSet,ts=function(){window.removeEventListener("focus",t(this,B)),window.removeEventListener("blur",t(this,R))},Kt=new WeakSet,es=function(){window.addEventListener("keydown",t(this,mt),{capture:!0})},Zt=new WeakSet,bi=function(){window.removeEventListener("keydown",t(this,mt),{capture:!0})},O=new WeakSet,is=function(){document.addEventListener("copy",t(this,ct)),document.addEventListener("cut",t(this,nt)),document.addEventListener("paste",t(this,ft))},_=new WeakSet,ss=function(){document.removeEventListener("copy",t(this,ct)),document.removeEventListener("cut",t(this,nt)),document.removeEventListener("paste",t(this,ft))},T=new WeakSet,Ae=function(e){Object.entries(e).some(([N,G])=>t(this,kt)[N]!==G)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(t(this,kt),e)})},dt=new WeakSet,Ve=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},ie=new WeakSet,An=function(){if(!t(this,i)){ot(this,i,!0);for(const e of t(this,Ct).values())e.enable()}},Tt=new WeakSet,yn=function(){if(this.unselectAll(),t(this,i)){ot(this,i,!1);for(const e of t(this,Ct).values())e.disable()}},Dt=new WeakSet,ns=function(e){const g=t(this,Ct).get(e.pageIndex);g?g.addOrRebuild(e):this.addEditor(e)},Gt=new WeakSet,qe=function(){if(t(this,Pt).size===0)return!0;if(t(this,Pt).size===1)for(const e of t(this,Pt).values())return e.isEmpty();return!1},xt=new WeakSet,rs=function(e){t(this,u).clear();for(const g of e)g.isEmpty()||(t(this,u).add(g),g.select());Z(this,T,Ae).call(this,{hasSelectedEditor:!0})},oe(Wt,"TRANSLATE_SMALL",1),oe(Wt,"TRANSLATE_BIG",10);let W=Wt;o.AnnotationEditorUIManager=W},($,o,X)=>{var yt,et,bt,Rt,Ut,$t,P,i,a,s,c,u,Ne,R,$e,ct,as,ft,Ai,Mt,yi,Bt,Ye,kt,Ke;Object.defineProperty(o,"__esModule",{value:!0}),o.StatTimer=o.RenderingCancelledException=o.PixelsPerInch=o.PageViewport=o.PDFDateString=o.DOMStandardFontDataFactory=o.DOMSVGFactory=o.DOMFilterFactory=o.DOMCanvasFactory=o.DOMCMapReaderFactory=void 0,o.deprecated=I,o.getColorValues=Pt,o.getCurrentTransform=Ct,o.getCurrentTransformInverse=j,o.getFilenameFromUrl=y,o.getPdfFilenameFromUrl=M,o.getRGB=at,o.getXfaPageViewport=_t,o.isDataScheme=C,o.isPdfFile=p,o.isValidFetchUrl=v,o.loadScript=d,o.noContextMenu=l,o.setLayerDimensions=ut;var r=X(7),x=X(1);const q="http://www.w3.org/2000/svg",Et=class Et{};oe(Et,"CSS",96),oe(Et,"PDF",72),oe(Et,"PDF_TO_CSS_UNITS",Et.CSS/Et.PDF);let Y=Et;o.PixelsPerInch=Y;class gt extends r.BaseFilterFactory{constructor({docId:st,ownerDocument:vt=globalThis.document}={}){super();U(this,u);U(this,R);U(this,ct);U(this,ft);U(this,Mt);U(this,Bt);U(this,kt);U(this,yt,void 0);U(this,et,void 0);U(this,bt,void 0);U(this,Rt,void 0);U(this,Ut,void 0);U(this,$t,void 0);U(this,P,void 0);U(this,i,void 0);U(this,a,void 0);U(this,s,void 0);U(this,c,0);ot(this,bt,st),ot(this,Rt,vt)}addFilter(st){if(!st)return"none";let vt=t(this,u,Ne).get(st);if(vt)return vt;let Ft,Ot,te,Kt;if(st.length===1){const O=st[0],V=new Array(256);for(let _=0;_<256;_++)V[_]=O[_]/255;Kt=Ft=Ot=te=V.join(",")}else{const[O,V,_]=st,S=new Array(256),T=new Array(256),rt=new Array(256);for(let dt=0;dt<256;dt++)S[dt]=O[dt]/255,T[dt]=V[dt]/255,rt[dt]=_[dt]/255;Ft=S.join(","),Ot=T.join(","),te=rt.join(","),Kt=`${Ft}${Ot}${te}`}if(vt=t(this,u,Ne).get(Kt),vt)return t(this,u,Ne).set(st,vt),vt;const Jt=`g_${t(this,bt)}_transfer_map_${Ge(this,c)._++}`,Zt=`url(#${Jt})`;t(this,u,Ne).set(st,Zt),t(this,u,Ne).set(Kt,Zt);const pt=Z(this,ft,Ai).call(this,Jt);return Z(this,Bt,Ye).call(this,Ft,Ot,te,pt),Zt}addHCMFilter(st,vt){var V;const Ft=`${st}-${vt}`;if(t(this,$t)===Ft)return t(this,P);if(ot(this,$t,Ft),ot(this,P,"none"),(V=t(this,Ut))==null||V.remove(),!st||!vt)return t(this,P);const Ot=Z(this,kt,Ke).call(this,st);st=x.Util.makeHexColor(...Ot);const te=Z(this,kt,Ke).call(this,vt);if(vt=x.Util.makeHexColor(...te),t(this,R,$e).style.color="",st==="#000000"&&vt==="#ffffff"||st===vt)return t(this,P);const Kt=new Array(256);for(let _=0;_<=255;_++){const S=_/255;Kt[_]=S<=.03928?S/12.92:((S+.055)/1.055)**2.4}const Jt=Kt.join(","),Zt=`g_${t(this,bt)}_hcm_filter`,pt=ot(this,i,Z(this,ft,Ai).call(this,Zt));Z(this,Bt,Ye).call(this,Jt,Jt,Jt,pt),Z(this,ct,as).call(this,pt);const O=(_,S)=>{const T=Ot[_]/255,rt=te[_]/255,dt=new Array(S+1);for(let qt=0;qt<=S;qt++)dt[qt]=T+qt/S*(rt-T);return dt.join(",")};return Z(this,Bt,Ye).call(this,O(0,5),O(1,5),O(2,5),pt),ot(this,P,`url(#${Zt})`),t(this,P)}addHighlightHCMFilter(st,vt,Ft,Ot){var rt;const te=`${st}-${vt}-${Ft}-${Ot}`;if(t(this,a)===te)return t(this,s);if(ot(this,a,te),ot(this,s,"none"),(rt=t(this,i))==null||rt.remove(),!st||!vt)return t(this,s);const[Kt,Jt]=[st,vt].map(Z(this,kt,Ke).bind(this));let Zt=Math.round(.2126*Kt[0]+.7152*Kt[1]+.0722*Kt[2]),pt=Math.round(.2126*Jt[0]+.7152*Jt[1]+.0722*Jt[2]),[O,V]=[Ft,Ot].map(Z(this,kt,Ke).bind(this));pt<Zt&&([Zt,pt,O,V]=[pt,Zt,V,O]),t(this,R,$e).style.color="";const _=(dt,qt,ie)=>{const K=new Array(256),Tt=(pt-Zt)/ie,Nt=dt/255,Dt=(qt-dt)/(255*ie);let Xt=0;for(let Gt=0;Gt<=ie;Gt++){const ne=Math.round(Zt+Gt*Tt),xt=Nt+Gt*Dt;for(let se=Xt;se<=ne;se++)K[se]=xt;Xt=ne+1}for(let Gt=Xt;Gt<256;Gt++)K[Gt]=K[Xt-1];return K.join(",")},S=`g_${t(this,bt)}_hcm_highlight_filter`,T=ot(this,i,Z(this,ft,Ai).call(this,S));return Z(this,ct,as).call(this,T),Z(this,Bt,Ye).call(this,_(O[0],V[0],5),_(O[1],V[1],5),_(O[2],V[2],5),T),ot(this,s,`url(#${S})`),t(this,s)}destroy(st=!1){st&&(t(this,P)||t(this,s))||(t(this,et)&&(t(this,et).parentNode.parentNode.remove(),ot(this,et,null)),t(this,yt)&&(t(this,yt).clear(),ot(this,yt,null)),ot(this,c,0))}}yt=new WeakMap,et=new WeakMap,bt=new WeakMap,Rt=new WeakMap,Ut=new WeakMap,$t=new WeakMap,P=new WeakMap,i=new WeakMap,a=new WeakMap,s=new WeakMap,c=new WeakMap,u=new WeakSet,Ne=function(){return t(this,yt)||ot(this,yt,new Map)},R=new WeakSet,$e=function(){if(!t(this,et)){const st=t(this,Rt).createElement("div"),{style:vt}=st;vt.visibility="hidden",vt.contain="strict",vt.width=vt.height=0,vt.position="absolute",vt.top=vt.left=0,vt.zIndex=-1;const Ft=t(this,Rt).createElementNS(q,"svg");Ft.setAttribute("width",0),Ft.setAttribute("height",0),ot(this,et,t(this,Rt).createElementNS(q,"defs")),st.append(Ft),Ft.append(t(this,et)),t(this,Rt).body.append(st)}return t(this,et)},ct=new WeakSet,as=function(st){const vt=t(this,Rt).createElementNS(q,"feColorMatrix");vt.setAttribute("type","matrix"),vt.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),st.append(vt)},ft=new WeakSet,Ai=function(st){const vt=t(this,Rt).createElementNS(q,"filter");return vt.setAttribute("color-interpolation-filters","sRGB"),vt.setAttribute("id",st),t(this,R,$e).append(vt),vt},Mt=new WeakSet,yi=function(st,vt,Ft){const Ot=t(this,Rt).createElementNS(q,vt);Ot.setAttribute("type","discrete"),Ot.setAttribute("tableValues",Ft),st.append(Ot)},Bt=new WeakSet,Ye=function(st,vt,Ft,Ot){const te=t(this,Rt).createElementNS(q,"feComponentTransfer");Ot.append(te),Z(this,Mt,yi).call(this,te,"feFuncR",st),Z(this,Mt,yi).call(this,te,"feFuncG",vt),Z(this,Mt,yi).call(this,te,"feFuncB",Ft)},kt=new WeakSet,Ke=function(st){return t(this,R,$e).style.color=st,at(getComputedStyle(t(this,R,$e)).getPropertyValue("color"))},o.DOMFilterFactory=gt;class z extends r.BaseCanvasFactory{constructor({ownerDocument:it=globalThis.document}={}){super(),this._document=it}_createCanvas(it,st){const vt=this._document.createElement("canvas");return vt.width=it,vt.height=st,vt}}o.DOMCanvasFactory=z;async function F(St,it=!1){if(v(St,document.baseURI)){const st=await fetch(St);if(!st.ok)throw new Error(st.statusText);return it?new Uint8Array(await st.arrayBuffer()):(0,x.stringToBytes)(await st.text())}return new Promise((st,vt)=>{const Ft=new XMLHttpRequest;Ft.open("GET",St,!0),it&&(Ft.responseType="arraybuffer"),Ft.onreadystatechange=()=>{if(Ft.readyState===XMLHttpRequest.DONE){if(Ft.status===200||Ft.status===0){let Ot;if(it&&Ft.response?Ot=new Uint8Array(Ft.response):!it&&Ft.responseText&&(Ot=(0,x.stringToBytes)(Ft.responseText)),Ot){st(Ot);return}}vt(new Error(Ft.statusText))}},Ft.send(null)})}class m extends r.BaseCMapReaderFactory{_fetchData(it,st){return F(it,this.isCompressed).then(vt=>({cMapData:vt,compressionType:st}))}}o.DOMCMapReaderFactory=m;class H extends r.BaseStandardFontDataFactory{_fetchData(it){return F(it,!0)}}o.DOMStandardFontDataFactory=H;class W extends r.BaseSVGFactory{_createSVG(it){return document.createElementNS(q,it)}}o.DOMSVGFactory=W;class L{constructor({viewBox:it,scale:st,rotation:vt,offsetX:Ft=0,offsetY:Ot=0,dontFlip:te=!1}){this.viewBox=it,this.scale=st,this.rotation=vt,this.offsetX=Ft,this.offsetY=Ot;const Kt=(it[2]+it[0])/2,Jt=(it[3]+it[1])/2;let Zt,pt,O,V;switch(vt%=360,vt<0&&(vt+=360),vt){case 180:Zt=-1,pt=0,O=0,V=1;break;case 90:Zt=0,pt=1,O=1,V=0;break;case 270:Zt=0,pt=-1,O=-1,V=0;break;case 0:Zt=1,pt=0,O=0,V=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}te&&(O=-O,V=-V);let _,S,T,rt;Zt===0?(_=Math.abs(Jt-it[1])*st+Ft,S=Math.abs(Kt-it[0])*st+Ot,T=(it[3]-it[1])*st,rt=(it[2]-it[0])*st):(_=Math.abs(Kt-it[0])*st+Ft,S=Math.abs(Jt-it[1])*st+Ot,T=(it[2]-it[0])*st,rt=(it[3]-it[1])*st),this.transform=[Zt*st,pt*st,O*st,V*st,_-Zt*st*Kt-O*st*Jt,S-pt*st*Kt-V*st*Jt],this.width=T,this.height=rt}get rawDims(){const{viewBox:it}=this;return(0,x.shadow)(this,"rawDims",{pageWidth:it[2]-it[0],pageHeight:it[3]-it[1],pageX:it[0],pageY:it[1]})}clone({scale:it=this.scale,rotation:st=this.rotation,offsetX:vt=this.offsetX,offsetY:Ft=this.offsetY,dontFlip:Ot=!1}={}){return new L({viewBox:this.viewBox.slice(),scale:it,rotation:st,offsetX:vt,offsetY:Ft,dontFlip:Ot})}convertToViewportPoint(it,st){return x.Util.applyTransform([it,st],this.transform)}convertToViewportRectangle(it){const st=x.Util.applyTransform([it[0],it[1]],this.transform),vt=x.Util.applyTransform([it[2],it[3]],this.transform);return[st[0],st[1],vt[0],vt[1]]}convertToPdfPoint(it,st){return x.Util.applyInverseTransform([it,st],this.transform)}}o.PageViewport=L;class w extends x.BaseException{constructor(it,st=0){super(it,"RenderingCancelledException"),this.extraDelay=st}}o.RenderingCancelledException=w;function C(St){const it=St.length;let st=0;for(;st<it&&St[st].trim()==="";)st++;return St.substring(st,st+5).toLowerCase()==="data:"}function p(St){return typeof St=="string"&&/\.pdf$/i.test(St)}function y(St,it=!1){return it||([St]=St.split(/[#?]/,1)),St.substring(St.lastIndexOf("/")+1)}function M(St,it="document.pdf"){if(typeof St!="string")return it;if(C(St))return(0,x.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),it;const st=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,vt=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,Ft=st.exec(St);let Ot=vt.exec(Ft[1])||vt.exec(Ft[2])||vt.exec(Ft[3]);if(Ot&&(Ot=Ot[0],Ot.includes("%")))try{Ot=vt.exec(decodeURIComponent(Ot))[0]}catch{}return Ot||it}class k{constructor(){oe(this,"started",Object.create(null));oe(this,"times",[])}time(it){it in this.started&&(0,x.warn)(`Timer is already running for ${it}`),this.started[it]=Date.now()}timeEnd(it){it in this.started||(0,x.warn)(`Timer has not been started for ${it}`),this.times.push({name:it,start:this.started[it],end:Date.now()}),delete this.started[it]}toString(){const it=[];let st=0;for(const{name:vt}of this.times)st=Math.max(vt.length,st);for(const{name:vt,start:Ft,end:Ot}of this.times)it.push(`${vt.padEnd(st)} ${Ot-Ft}ms
`);return it.join("")}}o.StatTimer=k;function v(St,it){try{const{protocol:st}=it?new URL(St,it):new URL(St);return st==="http:"||st==="https:"}catch{return!1}}function l(St){St.preventDefault()}function d(St,it=!1){return new Promise((st,vt)=>{const Ft=document.createElement("script");Ft.src=St,Ft.onload=function(Ot){it&&Ft.remove(),st(Ot)},Ft.onerror=function(){vt(new Error(`Cannot load script at: ${Ft.src}`))},(document.head||document.documentElement).append(Ft)})}function I(St){console.log("Deprecated API usage: "+St)}let Q;class J{static toDateObject(it){if(!it||typeof it!="string")return null;Q||(Q=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const st=Q.exec(it);if(!st)return null;const vt=parseInt(st[1],10);let Ft=parseInt(st[2],10);Ft=Ft>=1&&Ft<=12?Ft-1:0;let Ot=parseInt(st[3],10);Ot=Ot>=1&&Ot<=31?Ot:1;let te=parseInt(st[4],10);te=te>=0&&te<=23?te:0;let Kt=parseInt(st[5],10);Kt=Kt>=0&&Kt<=59?Kt:0;let Jt=parseInt(st[6],10);Jt=Jt>=0&&Jt<=59?Jt:0;const Zt=st[7]||"Z";let pt=parseInt(st[8],10);pt=pt>=0&&pt<=23?pt:0;let O=parseInt(st[9],10)||0;return O=O>=0&&O<=59?O:0,Zt==="-"?(te+=pt,Kt+=O):Zt==="+"&&(te-=pt,Kt-=O),new Date(Date.UTC(vt,Ft,Ot,te,Kt,Jt))}}o.PDFDateString=J;function _t(St,{scale:it=1,rotation:st=0}){const{width:vt,height:Ft}=St.attributes.style,Ot=[0,0,parseInt(vt),parseInt(Ft)];return new L({viewBox:Ot,scale:it,rotation:st})}function at(St){if(St.startsWith("#")){const it=parseInt(St.slice(1),16);return[(it&16711680)>>16,(it&65280)>>8,it&255]}return St.startsWith("rgb(")?St.slice(4,-1).split(",").map(it=>parseInt(it)):St.startsWith("rgba(")?St.slice(5,-1).split(",").map(it=>parseInt(it)).slice(0,3):((0,x.warn)(`Not a valid color format: "${St}"`),[0,0,0])}function Pt(St){const it=document.createElement("span");it.style.visibility="hidden",document.body.append(it);for(const st of St.keys()){it.style.color=st;const vt=window.getComputedStyle(it).color;St.set(st,at(vt))}it.remove()}function Ct(St){const{a:it,b:st,c:vt,d:Ft,e:Ot,f:te}=St.getTransform();return[it,st,vt,Ft,Ot,te]}function j(St){const{a:it,b:st,c:vt,d:Ft,e:Ot,f:te}=St.getTransform().invertSelf();return[it,st,vt,Ft,Ot,te]}function ut(St,it,st=!1,vt=!0){if(it instanceof L){const{pageWidth:Ft,pageHeight:Ot}=it.rawDims,{style:te}=St,Kt=x.FeatureTest.isCSSRoundSupported,Jt=`var(--scale-factor) * ${Ft}px`,Zt=`var(--scale-factor) * ${Ot}px`,pt=Kt?`round(${Jt}, 1px)`:`calc(${Jt})`,O=Kt?`round(${Zt}, 1px)`:`calc(${Zt})`;!st||it.rotation%180===0?(te.width=pt,te.height=O):(te.width=O,te.height=pt)}vt&&St.setAttribute("data-main-rotation",it.rotation)}},($,o,X)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BaseStandardFontDataFactory=o.BaseSVGFactory=o.BaseFilterFactory=o.BaseCanvasFactory=o.BaseCMapReaderFactory=void 0;var r=X(1);class x{constructor(){this.constructor===x&&(0,r.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(m){return"none"}addHCMFilter(m,H){return"none"}addHighlightHCMFilter(m,H,W,L){return"none"}destroy(m=!1){}}o.BaseFilterFactory=x;class q{constructor(){this.constructor===q&&(0,r.unreachable)("Cannot initialize BaseCanvasFactory.")}create(m,H){if(m<=0||H<=0)throw new Error("Invalid canvas size");const W=this._createCanvas(m,H);return{canvas:W,context:W.getContext("2d")}}reset(m,H,W){if(!m.canvas)throw new Error("Canvas is not specified");if(H<=0||W<=0)throw new Error("Invalid canvas size");m.canvas.width=H,m.canvas.height=W}destroy(m){if(!m.canvas)throw new Error("Canvas is not specified");m.canvas.width=0,m.canvas.height=0,m.canvas=null,m.context=null}_createCanvas(m,H){(0,r.unreachable)("Abstract method `_createCanvas` called.")}}o.BaseCanvasFactory=q;class Y{constructor({baseUrl:m=null,isCompressed:H=!0}){this.constructor===Y&&(0,r.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=m,this.isCompressed=H}async fetch({name:m}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!m)throw new Error("CMap name must be specified.");const H=this.baseUrl+m+(this.isCompressed?".bcmap":""),W=this.isCompressed?r.CMapCompressionType.BINARY:r.CMapCompressionType.NONE;return this._fetchData(H,W).catch(L=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${H}`)})}_fetchData(m,H){(0,r.unreachable)("Abstract method `_fetchData` called.")}}o.BaseCMapReaderFactory=Y;class gt{constructor({baseUrl:m=null}){this.constructor===gt&&(0,r.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=m}async fetch({filename:m}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!m)throw new Error("Font filename must be specified.");const H=`${this.baseUrl}${m}`;return this._fetchData(H).catch(W=>{throw new Error(`Unable to load font data at: ${H}`)})}_fetchData(m){(0,r.unreachable)("Abstract method `_fetchData` called.")}}o.BaseStandardFontDataFactory=gt;class z{constructor(){this.constructor===z&&(0,r.unreachable)("Cannot initialize BaseSVGFactory.")}create(m,H,W=!1){if(m<=0||H<=0)throw new Error("Invalid SVG dimensions");const L=this._createSVG("svg:svg");return L.setAttribute("version","1.1"),W||(L.setAttribute("width",`${m}px`),L.setAttribute("height",`${H}px`)),L.setAttribute("preserveAspectRatio","none"),L.setAttribute("viewBox",`0 0 ${m} ${H}`),L}createElement(m){if(typeof m!="string")throw new Error("Invalid SVG element type");return this._createSVG(m)}_createSVG(m){(0,r.unreachable)("Abstract method `_createSVG` called.")}}o.BaseSVGFactory=z},($,o,X)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.MurmurHash3_64=void 0;var r=X(1);const x=3285377520,q=4294901760,Y=65535;class gt{constructor(F){this.h1=F?F&4294967295:x,this.h2=F?F&4294967295:x}update(F){let m,H;if(typeof F=="string"){m=new Uint8Array(F.length*2),H=0;for(let I=0,Q=F.length;I<Q;I++){const J=F.charCodeAt(I);J<=255?m[H++]=J:(m[H++]=J>>>8,m[H++]=J&255)}}else if((0,r.isArrayBuffer)(F))m=F.slice(),H=m.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const W=H>>2,L=H-W*4,w=new Uint32Array(m.buffer,0,W);let C=0,p=0,y=this.h1,M=this.h2;const k=3432918353,v=461845907,l=k&Y,d=v&Y;for(let I=0;I<W;I++)I&1?(C=w[I],C=C*k&q|C*l&Y,C=C<<15|C>>>17,C=C*v&q|C*d&Y,y^=C,y=y<<13|y>>>19,y=y*5+3864292196):(p=w[I],p=p*k&q|p*l&Y,p=p<<15|p>>>17,p=p*v&q|p*d&Y,M^=p,M=M<<13|M>>>19,M=M*5+3864292196);switch(C=0,L){case 3:C^=m[W*4+2]<<16;case 2:C^=m[W*4+1]<<8;case 1:C^=m[W*4],C=C*k&q|C*l&Y,C=C<<15|C>>>17,C=C*v&q|C*d&Y,W&1?y^=C:M^=C}this.h1=y,this.h2=M}hexdigest(){let F=this.h1,m=this.h2;return F^=m>>>1,F=F*3981806797&q|F*36045&Y,m=m*4283543511&q|((m<<16|F>>>16)*2950163797&q)>>>16,F^=m>>>1,F=F*444984403&q|F*60499&Y,m=m*3301882366&q|((m<<16|F>>>16)*3120437893&q)>>>16,F^=m>>>1,(F>>>0).toString(16).padStart(8,"0")+(m>>>0).toString(16).padStart(8,"0")}}o.MurmurHash3_64=gt},($,o,X)=>{var Y;Object.defineProperty(o,"__esModule",{value:!0}),o.FontLoader=o.FontFaceObject=void 0;var r=X(1);class x{constructor({ownerDocument:z=globalThis.document,styleElement:F=null}){U(this,Y,new Set);this._document=z,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(z){this.nativeFontFaces.add(z),this._document.fonts.add(z)}removeNativeFontFace(z){this.nativeFontFaces.delete(z),this._document.fonts.delete(z)}insertRule(z){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const F=this.styleElement.sheet;F.insertRule(z,F.cssRules.length)}clear(){for(const z of this.nativeFontFaces)this._document.fonts.delete(z);this.nativeFontFaces.clear(),t(this,Y).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(z){if(!(!z||t(this,Y).has(z.loadedName))){if((0,r.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:F,src:m,style:H}=z,W=new FontFace(F,m,H);this.addNativeFontFace(W);try{await W.load(),t(this,Y).add(F)}catch{(0,r.warn)(`Cannot load system font: ${z.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(W)}return}(0,r.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(z){if(z.attached||z.missingFile&&!z.systemFontInfo)return;if(z.attached=!0,z.systemFontInfo){await this.loadSystemFont(z.systemFontInfo);return}if(this.isFontLoadingAPISupported){const m=z.createNativeFontFace();if(m){this.addNativeFontFace(m);try{await m.loaded}catch(H){throw(0,r.warn)(`Failed to load font '${m.family}': '${H}'.`),z.disableFontFace=!0,H}}return}const F=z.createFontFaceRule();if(F){if(this.insertRule(F),this.isSyncFontLoadingSupported)return;await new Promise(m=>{const H=this._queueLoadingCallback(m);this._prepareFontLoadEvent(z,H)})}}get isFontLoadingAPISupported(){var F;const z=!!((F=this._document)!=null&&F.fonts);return(0,r.shadow)(this,"isFontLoadingAPISupported",z)}get isSyncFontLoadingSupported(){let z=!1;return(r.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(z=!0),(0,r.shadow)(this,"isSyncFontLoadingSupported",z)}_queueLoadingCallback(z){function F(){for((0,r.assert)(!H.done,"completeRequest() cannot be called twice."),H.done=!0;m.length>0&&m[0].done;){const W=m.shift();setTimeout(W.callback,0)}}const{loadingRequests:m}=this,H={done:!1,complete:F,callback:z};return m.push(H),H}get _loadTestFont(){const z=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,r.shadow)(this,"_loadTestFont",z)}_prepareFontLoadEvent(z,F){function m(at,Pt){return at.charCodeAt(Pt)<<24|at.charCodeAt(Pt+1)<<16|at.charCodeAt(Pt+2)<<8|at.charCodeAt(Pt+3)&255}function H(at,Pt,Ct,j){const ut=at.substring(0,Pt),Et=at.substring(Pt+Ct);return ut+j+Et}let W,L;const w=this._document.createElement("canvas");w.width=1,w.height=1;const C=w.getContext("2d");let p=0;function y(at,Pt){if(++p>30){(0,r.warn)("Load test font never loaded."),Pt();return}if(C.font="30px "+at,C.fillText(".",0,20),C.getImageData(0,0,1,1).data[3]>0){Pt();return}setTimeout(y.bind(null,at,Pt))}const M=`lt${Date.now()}${this.loadTestFontId++}`;let k=this._loadTestFont;k=H(k,976,M.length,M);const l=16,d=1482184792;let I=m(k,l);for(W=0,L=M.length-3;W<L;W+=4)I=I-d+m(M,W)|0;W<M.length&&(I=I-d+m(M+"XXX",W)|0),k=H(k,l,4,(0,r.string32)(I));const Q=`url(data:font/opentype;base64,${btoa(k)});`,J=`@font-face {font-family:"${M}";src:${Q}}`;this.insertRule(J);const _t=this._document.createElement("div");_t.style.visibility="hidden",_t.style.width=_t.style.height="10px",_t.style.position="absolute",_t.style.top=_t.style.left="0px";for(const at of[z.loadedName,M]){const Pt=this._document.createElement("span");Pt.textContent="Hi",Pt.style.fontFamily=at,_t.append(Pt)}this._document.body.append(_t),y(M,()=>{_t.remove(),F.complete()})}}Y=new WeakMap,o.FontLoader=x;class q{constructor(z,{isEvalSupported:F=!0,disableFontFace:m=!1,ignoreErrors:H=!1,inspectFont:W=null}){this.compiledGlyphs=Object.create(null);for(const L in z)this[L]=z[L];this.isEvalSupported=F!==!1,this.disableFontFace=m===!0,this.ignoreErrors=H===!0,this._inspectFont=W}createNativeFontFace(){var F;if(!this.data||this.disableFontFace)return null;let z;if(!this.cssFontInfo)z=new FontFace(this.loadedName,this.data,{});else{const m={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(m.style=`oblique ${this.cssFontInfo.italicAngle}deg`),z=new FontFace(this.cssFontInfo.fontFamily,this.data,m)}return(F=this._inspectFont)==null||F.call(this,this),z}createFontFaceRule(){var H;if(!this.data||this.disableFontFace)return null;const z=(0,r.bytesToString)(this.data),F=`url(data:${this.mimetype};base64,${btoa(z)});`;let m;if(!this.cssFontInfo)m=`@font-face {font-family:"${this.loadedName}";src:${F}}`;else{let W=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(W+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),m=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${W}src:${F}}`}return(H=this._inspectFont)==null||H.call(this,this,F),m}getPathGenerator(z,F){if(this.compiledGlyphs[F]!==void 0)return this.compiledGlyphs[F];let m;try{m=z.get(this.loadedName+"_path_"+F)}catch(H){if(!this.ignoreErrors)throw H;return(0,r.warn)(`getPathGenerator - ignoring character: "${H}".`),this.compiledGlyphs[F]=function(W,L){}}if(this.isEvalSupported&&r.FeatureTest.isEvalSupported){const H=[];for(const W of m){const L=W.args!==void 0?W.args.join(","):"";H.push("c.",W.cmd,"(",L,`);
`)}return this.compiledGlyphs[F]=new Function("c","size",H.join(""))}return this.compiledGlyphs[F]=function(H,W){for(const L of m)L.cmd==="scale"&&(L.args=[W,-W]),H[L.cmd].apply(H,L.args)}}}o.FontFaceObject=q},($,o,X)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.NodeStandardFontDataFactory=o.NodeFilterFactory=o.NodeCanvasFactory=o.NodeCMapReaderFactory=void 0;var r=X(7);X(1);const x=function(F){return new Promise((m,H)=>{Se.readFile(F,(L,w)=>{if(L||!w){H(new Error(L));return}m(new Uint8Array(w))})})};class q extends r.BaseFilterFactory{}o.NodeFilterFactory=q;class Y extends r.BaseCanvasFactory{_createCanvas(m,H){return Se.createCanvas(m,H)}}o.NodeCanvasFactory=Y;class gt extends r.BaseCMapReaderFactory{_fetchData(m,H){return x(m).then(W=>({cMapData:W,compressionType:H}))}}o.NodeCMapReaderFactory=gt;class z extends r.BaseStandardFontDataFactory{_fetchData(m){return x(m)}}o.NodeStandardFontDataFactory=z},($,o,X)=>{var et,os,Rt,ls;Object.defineProperty(o,"__esModule",{value:!0}),o.CanvasGraphics=void 0;var r=X(1),x=X(6),q=X(12),Y=X(13);const gt=16,z=100,F=4096,m=15,H=10,W=1e3,L=16;function w(P,i){if(P._removeMirroring)throw new Error("Context is already forwarding operations.");P.__originalSave=P.save,P.__originalRestore=P.restore,P.__originalRotate=P.rotate,P.__originalScale=P.scale,P.__originalTranslate=P.translate,P.__originalTransform=P.transform,P.__originalSetTransform=P.setTransform,P.__originalResetTransform=P.resetTransform,P.__originalClip=P.clip,P.__originalMoveTo=P.moveTo,P.__originalLineTo=P.lineTo,P.__originalBezierCurveTo=P.bezierCurveTo,P.__originalRect=P.rect,P.__originalClosePath=P.closePath,P.__originalBeginPath=P.beginPath,P._removeMirroring=()=>{P.save=P.__originalSave,P.restore=P.__originalRestore,P.rotate=P.__originalRotate,P.scale=P.__originalScale,P.translate=P.__originalTranslate,P.transform=P.__originalTransform,P.setTransform=P.__originalSetTransform,P.resetTransform=P.__originalResetTransform,P.clip=P.__originalClip,P.moveTo=P.__originalMoveTo,P.lineTo=P.__originalLineTo,P.bezierCurveTo=P.__originalBezierCurveTo,P.rect=P.__originalRect,P.closePath=P.__originalClosePath,P.beginPath=P.__originalBeginPath,delete P._removeMirroring},P.save=function(){i.save(),this.__originalSave()},P.restore=function(){i.restore(),this.__originalRestore()},P.translate=function(s,c){i.translate(s,c),this.__originalTranslate(s,c)},P.scale=function(s,c){i.scale(s,c),this.__originalScale(s,c)},P.transform=function(s,c,u,A,R,B){i.transform(s,c,u,A,R,B),this.__originalTransform(s,c,u,A,R,B)},P.setTransform=function(s,c,u,A,R,B){i.setTransform(s,c,u,A,R,B),this.__originalSetTransform(s,c,u,A,R,B)},P.resetTransform=function(){i.resetTransform(),this.__originalResetTransform()},P.rotate=function(s){i.rotate(s),this.__originalRotate(s)},P.clip=function(s){i.clip(s),this.__originalClip(s)},P.moveTo=function(a,s){i.moveTo(a,s),this.__originalMoveTo(a,s)},P.lineTo=function(a,s){i.lineTo(a,s),this.__originalLineTo(a,s)},P.bezierCurveTo=function(a,s,c,u,A,R){i.bezierCurveTo(a,s,c,u,A,R),this.__originalBezierCurveTo(a,s,c,u,A,R)},P.rect=function(a,s,c,u){i.rect(a,s,c,u),this.__originalRect(a,s,c,u)},P.closePath=function(){i.closePath(),this.__originalClosePath()},P.beginPath=function(){i.beginPath(),this.__originalBeginPath()}}class C{constructor(i){this.canvasFactory=i,this.cache=Object.create(null)}getCanvas(i,a,s){let c;return this.cache[i]!==void 0?(c=this.cache[i],this.canvasFactory.reset(c,a,s)):(c=this.canvasFactory.create(a,s),this.cache[i]=c),c}delete(i){delete this.cache[i]}clear(){for(const i in this.cache){const a=this.cache[i];this.canvasFactory.destroy(a),delete this.cache[i]}}}function p(P,i,a,s,c,u,A,R,B,ct){const[nt,ft,mt,Mt,At,Bt]=(0,x.getCurrentTransform)(P);if(ft===0&&mt===0){const jt=A*nt+At,St=Math.round(jt),it=R*Mt+Bt,st=Math.round(it),vt=(A+B)*nt+At,Ft=Math.abs(Math.round(vt)-St)||1,Ot=(R+ct)*Mt+Bt,te=Math.abs(Math.round(Ot)-st)||1;return P.setTransform(Math.sign(nt),0,0,Math.sign(Mt),St,st),P.drawImage(i,a,s,c,u,0,0,Ft,te),P.setTransform(nt,ft,mt,Mt,At,Bt),[Ft,te]}if(nt===0&&Mt===0){const jt=R*mt+At,St=Math.round(jt),it=A*ft+Bt,st=Math.round(it),vt=(R+ct)*mt+At,Ft=Math.abs(Math.round(vt)-St)||1,Ot=(A+B)*ft+Bt,te=Math.abs(Math.round(Ot)-st)||1;return P.setTransform(0,Math.sign(ft),Math.sign(mt),0,St,st),P.drawImage(i,a,s,c,u,0,0,te,Ft),P.setTransform(nt,ft,mt,Mt,At,Bt),[te,Ft]}P.drawImage(i,a,s,c,u,A,R,B,ct);const Vt=Math.hypot(nt,ft),kt=Math.hypot(mt,Mt);return[Vt*B,kt*ct]}function y(P){const{width:i,height:a}=P;if(i>W||a>W)return null;const s=1e3,c=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),u=i+1;let A=new Uint8Array(u*(a+1)),R,B,ct;const nt=i+7&-8;let ft=new Uint8Array(nt*a),mt=0;for(const kt of P.data){let jt=128;for(;jt>0;)ft[mt++]=kt&jt?0:255,jt>>=1}let Mt=0;for(mt=0,ft[mt]!==0&&(A[0]=1,++Mt),B=1;B<i;B++)ft[mt]!==ft[mt+1]&&(A[B]=ft[mt]?2:1,++Mt),mt++;for(ft[mt]!==0&&(A[B]=2,++Mt),R=1;R<a;R++){mt=R*nt,ct=R*u,ft[mt-nt]!==ft[mt]&&(A[ct]=ft[mt]?1:8,++Mt);let kt=(ft[mt]?4:0)+(ft[mt-nt]?8:0);for(B=1;B<i;B++)kt=(kt>>2)+(ft[mt+1]?4:0)+(ft[mt-nt+1]?8:0),c[kt]&&(A[ct+B]=c[kt],++Mt),mt++;if(ft[mt-nt]!==ft[mt]&&(A[ct+B]=ft[mt]?2:4,++Mt),Mt>s)return null}for(mt=nt*(a-1),ct=R*u,ft[mt]!==0&&(A[ct]=8,++Mt),B=1;B<i;B++)ft[mt]!==ft[mt+1]&&(A[ct+B]=ft[mt]?4:8,++Mt),mt++;if(ft[mt]!==0&&(A[ct+B]=4,++Mt),Mt>s)return null;const At=new Int32Array([0,u,-1,0,-u,0,0,0,1]),Bt=new Path2D;for(R=0;Mt&&R<=a;R++){let kt=R*u;const jt=kt+i;for(;kt<jt&&!A[kt];)kt++;if(kt===jt)continue;Bt.moveTo(kt%u,R);const St=kt;let it=A[kt];do{const st=At[it];do kt+=st;while(!A[kt]);const vt=A[kt];vt!==5&&vt!==10?(it=vt,A[kt]=0):(it=vt&51*it>>4,A[kt]&=it>>2|it<<2),Bt.lineTo(kt%u,kt/u|0),A[kt]||--Mt}while(St!==kt);--R}return ft=null,A=null,function(kt){kt.save(),kt.scale(1/i,-1/a),kt.translate(0,-a),kt.fill(Bt),kt.beginPath(),kt.restore()}}class M{constructor(i,a){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=r.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=r.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=r.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,i,a])}clone(){const i=Object.create(this);return i.clipBox=this.clipBox.slice(),i}setCurrentPoint(i,a){this.x=i,this.y=a}updatePathMinMax(i,a,s){[a,s]=r.Util.applyTransform([a,s],i),this.minX=Math.min(this.minX,a),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,a),this.maxY=Math.max(this.maxY,s)}updateRectMinMax(i,a){const s=r.Util.applyTransform(a,i),c=r.Util.applyTransform(a.slice(2),i);this.minX=Math.min(this.minX,s[0],c[0]),this.minY=Math.min(this.minY,s[1],c[1]),this.maxX=Math.max(this.maxX,s[0],c[0]),this.maxY=Math.max(this.maxY,s[1],c[1])}updateScalingPathMinMax(i,a){r.Util.scaleMinMax(i,a),this.minX=Math.min(this.minX,a[0]),this.maxX=Math.max(this.maxX,a[1]),this.minY=Math.min(this.minY,a[2]),this.maxY=Math.max(this.maxY,a[3])}updateCurvePathMinMax(i,a,s,c,u,A,R,B,ct,nt){const ft=r.Util.bezierBoundingBox(a,s,c,u,A,R,B,ct);if(nt){nt[0]=Math.min(nt[0],ft[0],ft[2]),nt[1]=Math.max(nt[1],ft[0],ft[2]),nt[2]=Math.min(nt[2],ft[1],ft[3]),nt[3]=Math.max(nt[3],ft[1],ft[3]);return}this.updateRectMinMax(i,ft)}getPathBoundingBox(i=q.PathType.FILL,a=null){const s=[this.minX,this.minY,this.maxX,this.maxY];if(i===q.PathType.STROKE){a||(0,r.unreachable)("Stroke bounding box must include transform.");const c=r.Util.singularValueDecompose2dScale(a),u=c[0]*this.lineWidth/2,A=c[1]*this.lineWidth/2;s[0]-=u,s[1]-=A,s[2]+=u,s[3]+=A}return s}updateClipFromPath(){const i=r.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(i||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(i){this.clipBox=i,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(i=q.PathType.FILL,a=null){return r.Util.intersect(this.clipBox,this.getPathBoundingBox(i,a))}}function k(P,i){if(typeof ImageData<"u"&&i instanceof ImageData){P.putImageData(i,0,0);return}const a=i.height,s=i.width,c=a%L,u=(a-c)/L,A=c===0?u:u+1,R=P.createImageData(s,L);let B=0,ct;const nt=i.data,ft=R.data;let mt,Mt,At,Bt;if(i.kind===r.ImageKind.GRAYSCALE_1BPP){const Vt=nt.byteLength,kt=new Uint32Array(ft.buffer,0,ft.byteLength>>2),jt=kt.length,St=s+7>>3,it=4294967295,st=r.FeatureTest.isLittleEndian?4278190080:255;for(mt=0;mt<A;mt++){for(At=mt<u?L:c,ct=0,Mt=0;Mt<At;Mt++){const vt=Vt-B;let Ft=0;const Ot=vt>St?s:vt*8-7,te=Ot&-8;let Kt=0,Jt=0;for(;Ft<te;Ft+=8)Jt=nt[B++],kt[ct++]=Jt&128?it:st,kt[ct++]=Jt&64?it:st,kt[ct++]=Jt&32?it:st,kt[ct++]=Jt&16?it:st,kt[ct++]=Jt&8?it:st,kt[ct++]=Jt&4?it:st,kt[ct++]=Jt&2?it:st,kt[ct++]=Jt&1?it:st;for(;Ft<Ot;Ft++)Kt===0&&(Jt=nt[B++],Kt=128),kt[ct++]=Jt&Kt?it:st,Kt>>=1}for(;ct<jt;)kt[ct++]=0;P.putImageData(R,0,mt*L)}}else if(i.kind===r.ImageKind.RGBA_32BPP){for(Mt=0,Bt=s*L*4,mt=0;mt<u;mt++)ft.set(nt.subarray(B,B+Bt)),B+=Bt,P.putImageData(R,0,Mt),Mt+=L;mt<A&&(Bt=s*c*4,ft.set(nt.subarray(B,B+Bt)),P.putImageData(R,0,Mt))}else if(i.kind===r.ImageKind.RGB_24BPP)for(At=L,Bt=s*At,mt=0;mt<A;mt++){for(mt>=u&&(At=c,Bt=s*At),ct=0,Mt=Bt;Mt--;)ft[ct++]=nt[B++],ft[ct++]=nt[B++],ft[ct++]=nt[B++],ft[ct++]=255;P.putImageData(R,0,mt*L)}else throw new Error(`bad image kind: ${i.kind}`)}function v(P,i){if(i.bitmap){P.drawImage(i.bitmap,0,0);return}const a=i.height,s=i.width,c=a%L,u=(a-c)/L,A=c===0?u:u+1,R=P.createImageData(s,L);let B=0;const ct=i.data,nt=R.data;for(let ft=0;ft<A;ft++){const mt=ft<u?L:c;({srcPos:B}=(0,Y.convertBlackAndWhiteToRGBA)({src:ct,srcPos:B,dest:nt,width:s,height:mt,nonBlackColor:0})),P.putImageData(R,0,ft*L)}}function l(P,i){const a=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of a)P[s]!==void 0&&(i[s]=P[s]);P.setLineDash!==void 0&&(i.setLineDash(P.getLineDash()),i.lineDashOffset=P.lineDashOffset)}function d(P){if(P.strokeStyle=P.fillStyle="#000000",P.fillRule="nonzero",P.globalAlpha=1,P.lineWidth=1,P.lineCap="butt",P.lineJoin="miter",P.miterLimit=10,P.globalCompositeOperation="source-over",P.font="10px sans-serif",P.setLineDash!==void 0&&(P.setLineDash([]),P.lineDashOffset=0),!r.isNodeJS){const{filter:i}=P;i!=="none"&&i!==""&&(P.filter="none")}}function I(P,i,a,s){const c=P.length;for(let u=3;u<c;u+=4){const A=P[u];if(A===0)P[u-3]=i,P[u-2]=a,P[u-1]=s;else if(A<255){const R=255-A;P[u-3]=P[u-3]*A+i*R>>8,P[u-2]=P[u-2]*A+a*R>>8,P[u-1]=P[u-1]*A+s*R>>8}}}function Q(P,i,a){const s=P.length,c=1/255;for(let u=3;u<s;u+=4){const A=a?a[P[u]]:P[u];i[u]=i[u]*A*c|0}}function J(P,i,a){const s=P.length;for(let c=3;c<s;c+=4){const u=P[c-3]*77+P[c-2]*152+P[c-1]*28;i[c]=a?i[c]*a[u>>8]>>8:i[c]*u>>16}}function _t(P,i,a,s,c,u,A,R,B,ct,nt){const ft=!!u,mt=ft?u[0]:0,Mt=ft?u[1]:0,At=ft?u[2]:0,Bt=c==="Luminosity"?J:Q,kt=Math.min(s,Math.ceil(1048576/a));for(let jt=0;jt<s;jt+=kt){const St=Math.min(kt,s-jt),it=P.getImageData(R-ct,jt+(B-nt),a,St),st=i.getImageData(R,jt+B,a,St);ft&&I(it.data,mt,Mt,At),Bt(it.data,st.data,A),i.putImageData(st,R,jt+B)}}function at(P,i,a,s){const c=s[0],u=s[1],A=s[2]-c,R=s[3]-u;A===0||R===0||(_t(i.context,a,A,R,i.subtype,i.backdrop,i.transferMap,c,u,i.offsetX,i.offsetY),P.save(),P.globalAlpha=1,P.globalCompositeOperation="source-over",P.setTransform(1,0,0,1,0,0),P.drawImage(a.canvas,0,0),P.restore())}function Pt(P,i){const a=r.Util.singularValueDecompose2dScale(P);a[0]=Math.fround(a[0]),a[1]=Math.fround(a[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*x.PixelsPerInch.PDF_TO_CSS_UNITS);return i!==void 0?i:a[0]<=s||a[1]<=s}const Ct=["butt","round","square"],j=["miter","round","bevel"],ut={},Et={},$t=class $t{constructor(i,a,s,c,u,{optionalContentConfig:A,markedContentStack:R=null},B,ct){U(this,et);U(this,Rt);this.ctx=i,this.current=new M(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=a,this.objs=s,this.canvasFactory=c,this.filterFactory=u,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=R||[],this.optionalContentConfig=A,this.cachedCanvases=new C(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=B,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=ct,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(i,a=null){return typeof i=="string"?i.startsWith("g_")?this.commonObjs.get(i):this.objs.get(i):a}beginDrawing({transform:i,viewport:a,transparency:s=!1,background:c=null}){const u=this.ctx.canvas.width,A=this.ctx.canvas.height,R=this.ctx.fillStyle;if(this.ctx.fillStyle=c||"#ffffff",this.ctx.fillRect(0,0,u,A),this.ctx.fillStyle=R,s){const B=this.cachedCanvases.getCanvas("transparent",u,A);this.compositeCtx=this.ctx,this.transparentCanvas=B.canvas,this.ctx=B.context,this.ctx.save(),this.ctx.transform(...(0,x.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),d(this.ctx),i&&(this.ctx.transform(...i),this.outputScaleX=i[0],this.outputScaleY=i[0]),this.ctx.transform(...a.transform),this.viewportScale=a.scale,this.baseTransform=(0,x.getCurrentTransform)(this.ctx)}executeOperatorList(i,a,s,c){const u=i.argsArray,A=i.fnArray;let R=a||0;const B=u.length;if(B===R)return R;const ct=B-R>H&&typeof s=="function",nt=ct?Date.now()+m:0;let ft=0;const mt=this.commonObjs,Mt=this.objs;let At;for(;;){if(c!==void 0&&R===c.nextBreakPoint)return c.breakIt(R,s),R;if(At=A[R],At!==r.OPS.dependency)this[At].apply(this,u[R]);else for(const Bt of u[R]){const Vt=Bt.startsWith("g_")?mt:Mt;if(!Vt.has(Bt))return Vt.get(Bt,s),R}if(R++,R===B)return R;if(ct&&++ft>H){if(Date.now()>nt)return s(),R;ft=0}}}endDrawing(){Z(this,et,os).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const i of this._cachedBitmapsMap.values()){for(const a of i.values())typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement&&(a.width=a.height=0);i.clear()}this._cachedBitmapsMap.clear(),Z(this,Rt,ls).call(this)}_scaleImage(i,a){const s=i.width,c=i.height;let u=Math.max(Math.hypot(a[0],a[1]),1),A=Math.max(Math.hypot(a[2],a[3]),1),R=s,B=c,ct="prescale1",nt,ft;for(;u>2&&R>1||A>2&&B>1;){let mt=R,Mt=B;u>2&&R>1&&(mt=R>=16384?Math.floor(R/2)-1||1:Math.ceil(R/2),u/=R/mt),A>2&&B>1&&(Mt=B>=16384?Math.floor(B/2)-1||1:Math.ceil(B)/2,A/=B/Mt),nt=this.cachedCanvases.getCanvas(ct,mt,Mt),ft=nt.context,ft.clearRect(0,0,mt,Mt),ft.drawImage(i,0,0,R,B,0,0,mt,Mt),i=nt.canvas,R=mt,B=Mt,ct=ct==="prescale1"?"prescale2":"prescale1"}return{img:i,paintWidth:R,paintHeight:B}}_createMaskCanvas(i){const a=this.ctx,{width:s,height:c}=i,u=this.current.fillColor,A=this.current.patternFill,R=(0,x.getCurrentTransform)(a);let B,ct,nt,ft;if((i.bitmap||i.data)&&i.count>1){const Ft=i.bitmap||i.data.buffer;ct=JSON.stringify(A?R:[R.slice(0,4),u]),B=this._cachedBitmapsMap.get(Ft),B||(B=new Map,this._cachedBitmapsMap.set(Ft,B));const Ot=B.get(ct);if(Ot&&!A){const te=Math.round(Math.min(R[0],R[2])+R[4]),Kt=Math.round(Math.min(R[1],R[3])+R[5]);return{canvas:Ot,offsetX:te,offsetY:Kt}}nt=Ot}nt||(ft=this.cachedCanvases.getCanvas("maskCanvas",s,c),v(ft.context,i));let mt=r.Util.transform(R,[1/s,0,0,-1/c,0,0]);mt=r.Util.transform(mt,[1,0,0,1,0,-c]);const Mt=r.Util.applyTransform([0,0],mt),At=r.Util.applyTransform([s,c],mt),Bt=r.Util.normalizeRect([Mt[0],Mt[1],At[0],At[1]]),Vt=Math.round(Bt[2]-Bt[0])||1,kt=Math.round(Bt[3]-Bt[1])||1,jt=this.cachedCanvases.getCanvas("fillCanvas",Vt,kt),St=jt.context,it=Math.min(Mt[0],At[0]),st=Math.min(Mt[1],At[1]);St.translate(-it,-st),St.transform(...mt),nt||(nt=this._scaleImage(ft.canvas,(0,x.getCurrentTransformInverse)(St)),nt=nt.img,B&&A&&B.set(ct,nt)),St.imageSmoothingEnabled=Pt((0,x.getCurrentTransform)(St),i.interpolate),p(St,nt,0,0,nt.width,nt.height,0,0,s,c),St.globalCompositeOperation="source-in";const vt=r.Util.transform((0,x.getCurrentTransformInverse)(St),[1,0,0,1,-it,-st]);return St.fillStyle=A?u.getPattern(a,this,vt,q.PathType.FILL):u,St.fillRect(0,0,s,c),B&&!A&&(this.cachedCanvases.delete("fillCanvas"),B.set(ct,jt.canvas)),{canvas:jt.canvas,offsetX:Math.round(it),offsetY:Math.round(st)}}setLineWidth(i){i!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=i,this.ctx.lineWidth=i}setLineCap(i){this.ctx.lineCap=Ct[i]}setLineJoin(i){this.ctx.lineJoin=j[i]}setMiterLimit(i){this.ctx.miterLimit=i}setDash(i,a){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(i),s.lineDashOffset=a)}setRenderingIntent(i){}setFlatness(i){}setGState(i){for(const[a,s]of i)switch(a){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.current.fillAlpha=s,this.ctx.globalAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const i=this.inSMaskMode;this.current.activeSMask&&!i?this.beginSMaskMode():!this.current.activeSMask&&i&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const i=this.ctx.canvas.width,a=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,c=this.cachedCanvases.getCanvas(s,i,a);this.suspendedCtx=this.ctx,this.ctx=c.context;const u=this.ctx;u.setTransform(...(0,x.getCurrentTransform)(this.suspendedCtx)),l(this.suspendedCtx,u),w(u,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),l(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(i){if(!this.current.activeSMask)return;i?(i[0]=Math.floor(i[0]),i[1]=Math.floor(i[1]),i[2]=Math.ceil(i[2]),i[3]=Math.ceil(i[3])):i=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const a=this.current.activeSMask,s=this.suspendedCtx;at(s,a,this.ctx,i),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(l(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const i=this.current;this.stateStack.push(i),this.current=i.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),l(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(i,a,s,c,u,A){this.ctx.transform(i,a,s,c,u,A),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(i,a,s){const c=this.ctx,u=this.current;let A=u.x,R=u.y,B,ct;const nt=(0,x.getCurrentTransform)(c),ft=nt[0]===0&&nt[3]===0||nt[1]===0&&nt[2]===0,mt=ft?s.slice(0):null;for(let Mt=0,At=0,Bt=i.length;Mt<Bt;Mt++)switch(i[Mt]|0){case r.OPS.rectangle:A=a[At++],R=a[At++];const Vt=a[At++],kt=a[At++],jt=A+Vt,St=R+kt;c.moveTo(A,R),Vt===0||kt===0?c.lineTo(jt,St):(c.lineTo(jt,R),c.lineTo(jt,St),c.lineTo(A,St)),ft||u.updateRectMinMax(nt,[A,R,jt,St]),c.closePath();break;case r.OPS.moveTo:A=a[At++],R=a[At++],c.moveTo(A,R),ft||u.updatePathMinMax(nt,A,R);break;case r.OPS.lineTo:A=a[At++],R=a[At++],c.lineTo(A,R),ft||u.updatePathMinMax(nt,A,R);break;case r.OPS.curveTo:B=A,ct=R,A=a[At+4],R=a[At+5],c.bezierCurveTo(a[At],a[At+1],a[At+2],a[At+3],A,R),u.updateCurvePathMinMax(nt,B,ct,a[At],a[At+1],a[At+2],a[At+3],A,R,mt),At+=6;break;case r.OPS.curveTo2:B=A,ct=R,c.bezierCurveTo(A,R,a[At],a[At+1],a[At+2],a[At+3]),u.updateCurvePathMinMax(nt,B,ct,A,R,a[At],a[At+1],a[At+2],a[At+3],mt),A=a[At+2],R=a[At+3],At+=4;break;case r.OPS.curveTo3:B=A,ct=R,A=a[At+2],R=a[At+3],c.bezierCurveTo(a[At],a[At+1],A,R,A,R),u.updateCurvePathMinMax(nt,B,ct,a[At],a[At+1],A,R,A,R,mt),At+=4;break;case r.OPS.closePath:c.closePath();break}ft&&u.updateScalingPathMinMax(nt,mt),u.setCurrentPoint(A,R)}closePath(){this.ctx.closePath()}stroke(i=!0){const a=this.ctx,s=this.current.strokeColor;a.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof s=="object"&&(s!=null&&s.getPattern)?(a.save(),a.strokeStyle=s.getPattern(a,this,(0,x.getCurrentTransformInverse)(a),q.PathType.STROKE),this.rescaleAndStroke(!1),a.restore()):this.rescaleAndStroke(!0)),i&&this.consumePath(this.current.getClippedPathBoundingBox()),a.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(i=!0){const a=this.ctx,s=this.current.fillColor,c=this.current.patternFill;let u=!1;c&&(a.save(),a.fillStyle=s.getPattern(a,this,(0,x.getCurrentTransformInverse)(a),q.PathType.FILL),u=!0);const A=this.current.getClippedPathBoundingBox();this.contentVisible&&A!==null&&(this.pendingEOFill?(a.fill("evenodd"),this.pendingEOFill=!1):a.fill()),u&&a.restore(),i&&this.consumePath(A)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=ut}eoClip(){this.pendingClip=Et}beginText(){this.current.textMatrix=r.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const i=this.pendingTextPaths,a=this.ctx;if(i===void 0){a.beginPath();return}a.save(),a.beginPath();for(const s of i)a.setTransform(...s.transform),a.translate(s.x,s.y),s.addToPath(a,s.fontSize);a.restore(),a.clip(),a.beginPath(),delete this.pendingTextPaths}setCharSpacing(i){this.current.charSpacing=i}setWordSpacing(i){this.current.wordSpacing=i}setHScale(i){this.current.textHScale=i/100}setLeading(i){this.current.leading=-i}setFont(i,a){var nt;const s=this.commonObjs.get(i),c=this.current;if(!s)throw new Error(`Can't find font for ${i}`);if(c.fontMatrix=s.fontMatrix||r.FONT_IDENTITY_MATRIX,(c.fontMatrix[0]===0||c.fontMatrix[3]===0)&&(0,r.warn)("Invalid font matrix for font "+i),a<0?(a=-a,c.fontDirection=-1):c.fontDirection=1,this.current.font=s,this.current.fontSize=a,s.isType3Font)return;const u=s.loadedName||"sans-serif",A=((nt=s.systemFontInfo)==null?void 0:nt.css)||`"${u}", ${s.fallbackName}`;let R="normal";s.black?R="900":s.bold&&(R="bold");const B=s.italic?"italic":"normal";let ct=a;a<gt?ct=gt:a>z&&(ct=z),this.current.fontSizeScale=a/ct,this.ctx.font=`${B} ${R} ${ct}px ${A}`}setTextRenderingMode(i){this.current.textRenderingMode=i}setTextRise(i){this.current.textRise=i}moveText(i,a){this.current.x=this.current.lineX+=i,this.current.y=this.current.lineY+=a}setLeadingMoveText(i,a){this.setLeading(-a),this.moveText(i,a)}setTextMatrix(i,a,s,c,u,A){this.current.textMatrix=[i,a,s,c,u,A],this.current.textMatrixScale=Math.hypot(i,a),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(i,a,s,c){const u=this.ctx,A=this.current,R=A.font,B=A.textRenderingMode,ct=A.fontSize/A.fontSizeScale,nt=B&r.TextRenderingMode.FILL_STROKE_MASK,ft=!!(B&r.TextRenderingMode.ADD_TO_PATH_FLAG),mt=A.patternFill&&!R.missingFile;let Mt;(R.disableFontFace||ft||mt)&&(Mt=R.getPathGenerator(this.commonObjs,i)),R.disableFontFace||mt?(u.save(),u.translate(a,s),u.beginPath(),Mt(u,ct),c&&u.setTransform(...c),(nt===r.TextRenderingMode.FILL||nt===r.TextRenderingMode.FILL_STROKE)&&u.fill(),(nt===r.TextRenderingMode.STROKE||nt===r.TextRenderingMode.FILL_STROKE)&&u.stroke(),u.restore()):((nt===r.TextRenderingMode.FILL||nt===r.TextRenderingMode.FILL_STROKE)&&u.fillText(i,a,s),(nt===r.TextRenderingMode.STROKE||nt===r.TextRenderingMode.FILL_STROKE)&&u.strokeText(i,a,s)),ft&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,x.getCurrentTransform)(u),x:a,y:s,fontSize:ct,addToPath:Mt})}get isFontSubpixelAAEnabled(){const{context:i}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);i.scale(1.5,1),i.fillText("I",0,10);const a=i.getImageData(0,0,10,10).data;let s=!1;for(let c=3;c<a.length;c+=4)if(a[c]>0&&a[c]<255){s=!0;break}return(0,r.shadow)(this,"isFontSubpixelAAEnabled",s)}showText(i){const a=this.current,s=a.font;if(s.isType3Font)return this.showType3Text(i);const c=a.fontSize;if(c===0)return;const u=this.ctx,A=a.fontSizeScale,R=a.charSpacing,B=a.wordSpacing,ct=a.fontDirection,nt=a.textHScale*ct,ft=i.length,mt=s.vertical,Mt=mt?1:-1,At=s.defaultVMetrics,Bt=c*a.fontMatrix[0],Vt=a.textRenderingMode===r.TextRenderingMode.FILL&&!s.disableFontFace&&!a.patternFill;u.save(),u.transform(...a.textMatrix),u.translate(a.x,a.y+a.textRise),ct>0?u.scale(nt,-1):u.scale(nt,1);let kt;if(a.patternFill){u.save();const vt=a.fillColor.getPattern(u,this,(0,x.getCurrentTransformInverse)(u),q.PathType.FILL);kt=(0,x.getCurrentTransform)(u),u.restore(),u.fillStyle=vt}let jt=a.lineWidth;const St=a.textMatrixScale;if(St===0||jt===0){const vt=a.textRenderingMode&r.TextRenderingMode.FILL_STROKE_MASK;(vt===r.TextRenderingMode.STROKE||vt===r.TextRenderingMode.FILL_STROKE)&&(jt=this.getSinglePixelWidth())}else jt/=St;if(A!==1&&(u.scale(A,A),jt/=A),u.lineWidth=jt,s.isInvalidPDFjsFont){const vt=[];let Ft=0;for(const Ot of i)vt.push(Ot.unicode),Ft+=Ot.width;u.fillText(vt.join(""),0,0),a.x+=Ft*Bt*nt,u.restore(),this.compose();return}let it=0,st;for(st=0;st<ft;++st){const vt=i[st];if(typeof vt=="number"){it+=Mt*vt*c/1e3;continue}let Ft=!1;const Ot=(vt.isSpace?B:0)+R,te=vt.fontChar,Kt=vt.accent;let Jt,Zt,pt=vt.width;if(mt){const V=vt.vmetric||At,_=-(vt.vmetric?V[1]:pt*.5)*Bt,S=V[2]*Bt;pt=V?-V[0]:pt,Jt=_/A,Zt=(it+S)/A}else Jt=it/A,Zt=0;if(s.remeasure&&pt>0){const V=u.measureText(te).width*1e3/c*A;if(pt<V&&this.isFontSubpixelAAEnabled){const _=pt/V;Ft=!0,u.save(),u.scale(_,1),Jt/=_}else pt!==V&&(Jt+=(pt-V)/2e3*c/A)}if(this.contentVisible&&(vt.isInFont||s.missingFile)){if(Vt&&!Kt)u.fillText(te,Jt,Zt);else if(this.paintChar(te,Jt,Zt,kt),Kt){const V=Jt+c*Kt.offset.x/A,_=Zt-c*Kt.offset.y/A;this.paintChar(Kt.fontChar,V,_,kt)}}const O=mt?pt*Bt-Ot*ct:pt*Bt+Ot*ct;it+=O,Ft&&u.restore()}mt?a.y-=it:a.x+=it*nt,u.restore(),this.compose()}showType3Text(i){const a=this.ctx,s=this.current,c=s.font,u=s.fontSize,A=s.fontDirection,R=c.vertical?1:-1,B=s.charSpacing,ct=s.wordSpacing,nt=s.textHScale*A,ft=s.fontMatrix||r.FONT_IDENTITY_MATRIX,mt=i.length,Mt=s.textRenderingMode===r.TextRenderingMode.INVISIBLE;let At,Bt,Vt,kt;if(!(Mt||u===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,a.save(),a.transform(...s.textMatrix),a.translate(s.x,s.y),a.scale(nt,A),At=0;At<mt;++At){if(Bt=i[At],typeof Bt=="number"){kt=R*Bt*u/1e3,this.ctx.translate(kt,0),s.x+=kt*nt;continue}const jt=(Bt.isSpace?ct:0)+B,St=c.charProcOperatorList[Bt.operatorListId];if(!St){(0,r.warn)(`Type3 character "${Bt.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=Bt,this.save(),a.scale(u,u),a.transform(...ft),this.executeOperatorList(St),this.restore()),Vt=r.Util.applyTransform([Bt.width,0],ft)[0]*u+jt,a.translate(Vt,0),s.x+=Vt*nt}a.restore(),this.processingType3=null}}setCharWidth(i,a){}setCharWidthAndBounds(i,a,s,c,u,A){this.ctx.rect(s,c,u-s,A-c),this.ctx.clip(),this.endPath()}getColorN_Pattern(i){let a;if(i[0]==="TilingPattern"){const s=i[1],c=this.baseTransform||(0,x.getCurrentTransform)(this.ctx),u={createCanvasGraphics:A=>new $t(A,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};a=new q.TilingPattern(i,s,this.ctx,u,c)}else a=this._getPattern(i[1],i[2]);return a}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(i,a,s){const c=r.Util.makeHexColor(i,a,s);this.ctx.strokeStyle=c,this.current.strokeColor=c}setFillRGBColor(i,a,s){const c=r.Util.makeHexColor(i,a,s);this.ctx.fillStyle=c,this.current.fillColor=c,this.current.patternFill=!1}_getPattern(i,a=null){let s;return this.cachedPatterns.has(i)?s=this.cachedPatterns.get(i):(s=(0,q.getShadingPattern)(this.getObject(i)),this.cachedPatterns.set(i,s)),a&&(s.matrix=a),s}shadingFill(i){if(!this.contentVisible)return;const a=this.ctx;this.save();const s=this._getPattern(i);a.fillStyle=s.getPattern(a,this,(0,x.getCurrentTransformInverse)(a),q.PathType.SHADING);const c=(0,x.getCurrentTransformInverse)(a);if(c){const{width:u,height:A}=a.canvas,[R,B,ct,nt]=r.Util.getAxialAlignedBoundingBox([0,0,u,A],c);this.ctx.fillRect(R,B,ct-R,nt-B)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,r.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,r.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(i,a){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(i)&&i.length===6&&this.transform(...i),this.baseTransform=(0,x.getCurrentTransform)(this.ctx),a)){const s=a[2]-a[0],c=a[3]-a[1];this.ctx.rect(a[0],a[1],s,c),this.current.updateRectMinMax((0,x.getCurrentTransform)(this.ctx),a),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(i){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const a=this.ctx;i.isolated||(0,r.info)("TODO: Support non-isolated groups."),i.knockout&&(0,r.warn)("Knockout groups not supported.");const s=(0,x.getCurrentTransform)(a);if(i.matrix&&a.transform(...i.matrix),!i.bbox)throw new Error("Bounding box is required.");let c=r.Util.getAxialAlignedBoundingBox(i.bbox,(0,x.getCurrentTransform)(a));const u=[0,0,a.canvas.width,a.canvas.height];c=r.Util.intersect(c,u)||[0,0,0,0];const A=Math.floor(c[0]),R=Math.floor(c[1]);let B=Math.max(Math.ceil(c[2])-A,1),ct=Math.max(Math.ceil(c[3])-R,1),nt=1,ft=1;B>F&&(nt=B/F,B=F),ct>F&&(ft=ct/F,ct=F),this.current.startNewPathAndClipBox([0,0,B,ct]);let mt="groupAt"+this.groupLevel;i.smask&&(mt+="_smask_"+this.smaskCounter++%2);const Mt=this.cachedCanvases.getCanvas(mt,B,ct),At=Mt.context;At.scale(1/nt,1/ft),At.translate(-A,-R),At.transform(...s),i.smask?this.smaskStack.push({canvas:Mt.canvas,context:At,offsetX:A,offsetY:R,scaleX:nt,scaleY:ft,subtype:i.smask.subtype,backdrop:i.smask.backdrop,transferMap:i.smask.transferMap||null,startTransformInverse:null}):(a.setTransform(1,0,0,1,0,0),a.translate(A,R),a.scale(nt,ft),a.save()),l(a,At),this.ctx=At,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(a),this.groupLevel++}endGroup(i){if(!this.contentVisible)return;this.groupLevel--;const a=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,i.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const c=(0,x.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...c);const u=r.Util.getAxialAlignedBoundingBox([0,0,a.canvas.width,a.canvas.height],c);this.ctx.drawImage(a.canvas,0,0),this.ctx.restore(),this.compose(u)}}beginAnnotation(i,a,s,c,u){if(Z(this,et,os).call(this),d(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(a)&&a.length===4){const A=a[2]-a[0],R=a[3]-a[1];if(u&&this.annotationCanvasMap){s=s.slice(),s[4]-=a[0],s[5]-=a[1],a=a.slice(),a[0]=a[1]=0,a[2]=A,a[3]=R;const[B,ct]=r.Util.singularValueDecompose2dScale((0,x.getCurrentTransform)(this.ctx)),{viewportScale:nt}=this,ft=Math.ceil(A*this.outputScaleX*nt),mt=Math.ceil(R*this.outputScaleY*nt);this.annotationCanvas=this.canvasFactory.create(ft,mt);const{canvas:Mt,context:At}=this.annotationCanvas;this.annotationCanvasMap.set(i,Mt),this.annotationCanvas.savedCtx=this.ctx,this.ctx=At,this.ctx.save(),this.ctx.setTransform(B,0,0,-ct,0,R*ct),d(this.ctx)}else d(this.ctx),this.ctx.rect(a[0],a[1],A,R),this.ctx.clip(),this.endPath()}this.current=new M(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...c)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),Z(this,Rt,ls).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(i){if(!this.contentVisible)return;const a=i.count;i=this.getObject(i.data,i),i.count=a;const s=this.ctx,c=this.processingType3;if(c&&(c.compiled===void 0&&(c.compiled=y(i)),c.compiled)){c.compiled(s);return}const u=this._createMaskCanvas(i),A=u.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(A,u.offsetX,u.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(i,a,s=0,c=0,u,A){if(!this.contentVisible)return;i=this.getObject(i.data,i);const R=this.ctx;R.save();const B=(0,x.getCurrentTransform)(R);R.transform(a,s,c,u,0,0);const ct=this._createMaskCanvas(i);R.setTransform(1,0,0,1,ct.offsetX-B[4],ct.offsetY-B[5]);for(let nt=0,ft=A.length;nt<ft;nt+=2){const mt=r.Util.transform(B,[a,s,c,u,A[nt],A[nt+1]]),[Mt,At]=r.Util.applyTransform([0,0],mt);R.drawImage(ct.canvas,Mt,At)}R.restore(),this.compose()}paintImageMaskXObjectGroup(i){if(!this.contentVisible)return;const a=this.ctx,s=this.current.fillColor,c=this.current.patternFill;for(const u of i){const{data:A,width:R,height:B,transform:ct}=u,nt=this.cachedCanvases.getCanvas("maskCanvas",R,B),ft=nt.context;ft.save();const mt=this.getObject(A,u);v(ft,mt),ft.globalCompositeOperation="source-in",ft.fillStyle=c?s.getPattern(ft,this,(0,x.getCurrentTransformInverse)(a),q.PathType.FILL):s,ft.fillRect(0,0,R,B),ft.restore(),a.save(),a.transform(...ct),a.scale(1,-1),p(a,nt.canvas,0,0,R,B,0,-1,1,1),a.restore()}this.compose()}paintImageXObject(i){if(!this.contentVisible)return;const a=this.getObject(i);if(!a){(0,r.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(a)}paintImageXObjectRepeat(i,a,s,c){if(!this.contentVisible)return;const u=this.getObject(i);if(!u){(0,r.warn)("Dependent image isn't ready yet");return}const A=u.width,R=u.height,B=[];for(let ct=0,nt=c.length;ct<nt;ct+=2)B.push({transform:[a,0,0,s,c[ct],c[ct+1]],x:0,y:0,w:A,h:R});this.paintInlineImageXObjectGroup(u,B)}applyTransferMapsToCanvas(i){return this.current.transferMaps!=="none"&&(i.filter=this.current.transferMaps,i.drawImage(i.canvas,0,0),i.filter="none"),i.canvas}applyTransferMapsToBitmap(i){if(this.current.transferMaps==="none")return i.bitmap;const{bitmap:a,width:s,height:c}=i,u=this.cachedCanvases.getCanvas("inlineImage",s,c),A=u.context;return A.filter=this.current.transferMaps,A.drawImage(a,0,0),A.filter="none",u.canvas}paintInlineImageXObject(i){if(!this.contentVisible)return;const a=i.width,s=i.height,c=this.ctx;if(this.save(),!r.isNodeJS){const{filter:R}=c;R!=="none"&&R!==""&&(c.filter="none")}c.scale(1/a,-1/s);let u;if(i.bitmap)u=this.applyTransferMapsToBitmap(i);else if(typeof HTMLElement=="function"&&i instanceof HTMLElement||!i.data)u=i;else{const B=this.cachedCanvases.getCanvas("inlineImage",a,s).context;k(B,i),u=this.applyTransferMapsToCanvas(B)}const A=this._scaleImage(u,(0,x.getCurrentTransformInverse)(c));c.imageSmoothingEnabled=Pt((0,x.getCurrentTransform)(c),i.interpolate),p(c,A.img,0,0,A.paintWidth,A.paintHeight,0,-s,a,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(i,a){if(!this.contentVisible)return;const s=this.ctx;let c;if(i.bitmap)c=i.bitmap;else{const u=i.width,A=i.height,B=this.cachedCanvases.getCanvas("inlineImage",u,A).context;k(B,i),c=this.applyTransferMapsToCanvas(B)}for(const u of a)s.save(),s.transform(...u.transform),s.scale(1,-1),p(s,c,u.x,u.y,u.w,u.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(i){}markPointProps(i,a){}beginMarkedContent(i){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(i,a){i==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(a)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(i){const a=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(i);const s=this.ctx;this.pendingClip&&(a||(this.pendingClip===Et?s.clip("evenodd"):s.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const i=(0,x.getCurrentTransform)(this.ctx);if(i[1]===0&&i[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(i[0]),Math.abs(i[3]));else{const a=Math.abs(i[0]*i[3]-i[2]*i[1]),s=Math.hypot(i[0],i[2]),c=Math.hypot(i[1],i[3]);this._cachedGetSinglePixelWidth=Math.max(s,c)/a}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:i}=this.current,{a,b:s,c,d:u}=this.ctx.getTransform();let A,R;if(s===0&&c===0){const B=Math.abs(a),ct=Math.abs(u);if(B===ct)if(i===0)A=R=1/B;else{const nt=B*i;A=R=nt<1?1/nt:1}else if(i===0)A=1/B,R=1/ct;else{const nt=B*i,ft=ct*i;A=nt<1?1/nt:1,R=ft<1?1/ft:1}}else{const B=Math.abs(a*u-s*c),ct=Math.hypot(a,s),nt=Math.hypot(c,u);if(i===0)A=nt/B,R=ct/B;else{const ft=i*B;A=nt>ft?nt/ft:1,R=ct>ft?ct/ft:1}}this._cachedScaleForStroking[0]=A,this._cachedScaleForStroking[1]=R}return this._cachedScaleForStroking}rescaleAndStroke(i){const{ctx:a}=this,{lineWidth:s}=this.current,[c,u]=this.getScaleForStroking();if(a.lineWidth=s||1,c===1&&u===1){a.stroke();return}const A=a.getLineDash();if(i&&a.save(),a.scale(c,u),A.length>0){const R=Math.max(c,u);a.setLineDash(A.map(B=>B/R)),a.lineDashOffset/=R}a.stroke(),i&&a.restore()}isContentVisible(){for(let i=this.markedContentStack.length-1;i>=0;i--)if(!this.markedContentStack[i].visible)return!1;return!0}};et=new WeakSet,os=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Rt=new WeakSet,ls=function(){if(this.pageColors){const i=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(i!=="none"){const a=this.ctx.filter;this.ctx.filter=i,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=a}}};let yt=$t;o.CanvasGraphics=yt;for(const P in r.OPS)yt.prototype[P]!==void 0&&(yt.prototype[r.OPS[P]]=yt.prototype[P])},($,o,X)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TilingPattern=o.PathType=void 0,o.getShadingPattern=L;var r=X(1),x=X(6);const q={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};o.PathType=q;function Y(y,M){if(!M)return;const k=M[2]-M[0],v=M[3]-M[1],l=new Path2D;l.rect(M[0],M[1],k,v),y.clip(l)}class gt{constructor(){this.constructor===gt&&(0,r.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,r.unreachable)("Abstract method `getPattern` called.")}}class z extends gt{constructor(M){super(),this._type=M[1],this._bbox=M[2],this._colorStops=M[3],this._p0=M[4],this._p1=M[5],this._r0=M[6],this._r1=M[7],this.matrix=null}_createGradient(M){let k;this._type==="axial"?k=M.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(k=M.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const v of this._colorStops)k.addColorStop(v[0],v[1]);return k}getPattern(M,k,v,l){let d;if(l===q.STROKE||l===q.FILL){const I=k.current.getClippedPathBoundingBox(l,(0,x.getCurrentTransform)(M))||[0,0,0,0],Q=Math.ceil(I[2]-I[0])||1,J=Math.ceil(I[3]-I[1])||1,_t=k.cachedCanvases.getCanvas("pattern",Q,J,!0),at=_t.context;at.clearRect(0,0,at.canvas.width,at.canvas.height),at.beginPath(),at.rect(0,0,at.canvas.width,at.canvas.height),at.translate(-I[0],-I[1]),v=r.Util.transform(v,[1,0,0,1,I[0],I[1]]),at.transform(...k.baseTransform),this.matrix&&at.transform(...this.matrix),Y(at,this._bbox),at.fillStyle=this._createGradient(at),at.fill(),d=M.createPattern(_t.canvas,"no-repeat");const Pt=new DOMMatrix(v);d.setTransform(Pt)}else Y(M,this._bbox),d=this._createGradient(M);return d}}function F(y,M,k,v,l,d,I,Q){const J=M.coords,_t=M.colors,at=y.data,Pt=y.width*4;let Ct;J[k+1]>J[v+1]&&(Ct=k,k=v,v=Ct,Ct=d,d=I,I=Ct),J[v+1]>J[l+1]&&(Ct=v,v=l,l=Ct,Ct=I,I=Q,Q=Ct),J[k+1]>J[v+1]&&(Ct=k,k=v,v=Ct,Ct=d,d=I,I=Ct);const j=(J[k]+M.offsetX)*M.scaleX,ut=(J[k+1]+M.offsetY)*M.scaleY,Et=(J[v]+M.offsetX)*M.scaleX,yt=(J[v+1]+M.offsetY)*M.scaleY,et=(J[l]+M.offsetX)*M.scaleX,bt=(J[l+1]+M.offsetY)*M.scaleY;if(ut>=bt)return;const Rt=_t[d],Ut=_t[d+1],$t=_t[d+2],P=_t[I],i=_t[I+1],a=_t[I+2],s=_t[Q],c=_t[Q+1],u=_t[Q+2],A=Math.round(ut),R=Math.round(bt);let B,ct,nt,ft,mt,Mt,At,Bt;for(let Vt=A;Vt<=R;Vt++){if(Vt<yt){const st=Vt<ut?0:(ut-Vt)/(ut-yt);B=j-(j-Et)*st,ct=Rt-(Rt-P)*st,nt=Ut-(Ut-i)*st,ft=$t-($t-a)*st}else{let st;Vt>bt?st=1:yt===bt?st=0:st=(yt-Vt)/(yt-bt),B=Et-(Et-et)*st,ct=P-(P-s)*st,nt=i-(i-c)*st,ft=a-(a-u)*st}let kt;Vt<ut?kt=0:Vt>bt?kt=1:kt=(ut-Vt)/(ut-bt),mt=j-(j-et)*kt,Mt=Rt-(Rt-s)*kt,At=Ut-(Ut-c)*kt,Bt=$t-($t-u)*kt;const jt=Math.round(Math.min(B,mt)),St=Math.round(Math.max(B,mt));let it=Pt*Vt+jt*4;for(let st=jt;st<=St;st++)kt=(B-st)/(B-mt),kt<0?kt=0:kt>1&&(kt=1),at[it++]=ct-(ct-Mt)*kt|0,at[it++]=nt-(nt-At)*kt|0,at[it++]=ft-(ft-Bt)*kt|0,at[it++]=255}}function m(y,M,k){const v=M.coords,l=M.colors;let d,I;switch(M.type){case"lattice":const Q=M.verticesPerRow,J=Math.floor(v.length/Q)-1,_t=Q-1;for(d=0;d<J;d++){let at=d*Q;for(let Pt=0;Pt<_t;Pt++,at++)F(y,k,v[at],v[at+1],v[at+Q],l[at],l[at+1],l[at+Q]),F(y,k,v[at+Q+1],v[at+1],v[at+Q],l[at+Q+1],l[at+1],l[at+Q])}break;case"triangles":for(d=0,I=v.length;d<I;d+=3)F(y,k,v[d],v[d+1],v[d+2],l[d],l[d+1],l[d+2]);break;default:throw new Error("illegal figure")}}class H extends gt{constructor(M){super(),this._coords=M[2],this._colors=M[3],this._figures=M[4],this._bounds=M[5],this._bbox=M[7],this._background=M[8],this.matrix=null}_createMeshCanvas(M,k,v){const Q=Math.floor(this._bounds[0]),J=Math.floor(this._bounds[1]),_t=Math.ceil(this._bounds[2])-Q,at=Math.ceil(this._bounds[3])-J,Pt=Math.min(Math.ceil(Math.abs(_t*M[0]*1.1)),3e3),Ct=Math.min(Math.ceil(Math.abs(at*M[1]*1.1)),3e3),j=_t/Pt,ut=at/Ct,Et={coords:this._coords,colors:this._colors,offsetX:-Q,offsetY:-J,scaleX:1/j,scaleY:1/ut},yt=Pt+2*2,et=Ct+2*2,bt=v.getCanvas("mesh",yt,et,!1),Rt=bt.context,Ut=Rt.createImageData(Pt,Ct);if(k){const P=Ut.data;for(let i=0,a=P.length;i<a;i+=4)P[i]=k[0],P[i+1]=k[1],P[i+2]=k[2],P[i+3]=255}for(const P of this._figures)m(Ut,P,Et);return Rt.putImageData(Ut,2,2),{canvas:bt.canvas,offsetX:Q-2*j,offsetY:J-2*ut,scaleX:j,scaleY:ut}}getPattern(M,k,v,l){Y(M,this._bbox);let d;if(l===q.SHADING)d=r.Util.singularValueDecompose2dScale((0,x.getCurrentTransform)(M));else if(d=r.Util.singularValueDecompose2dScale(k.baseTransform),this.matrix){const Q=r.Util.singularValueDecompose2dScale(this.matrix);d=[d[0]*Q[0],d[1]*Q[1]]}const I=this._createMeshCanvas(d,l===q.SHADING?null:this._background,k.cachedCanvases);return l!==q.SHADING&&(M.setTransform(...k.baseTransform),this.matrix&&M.transform(...this.matrix)),M.translate(I.offsetX,I.offsetY),M.scale(I.scaleX,I.scaleY),M.createPattern(I.canvas,"no-repeat")}}class W extends gt{getPattern(){return"hotpink"}}function L(y){switch(y[0]){case"RadialAxial":return new z(y);case"Mesh":return new H(y);case"Dummy":return new W}throw new Error(`Unknown IR type: ${y[0]}`)}const w={COLORED:1,UNCOLORED:2},p=class p{constructor(M,k,v,l,d){this.operatorList=M[2],this.matrix=M[3]||[1,0,0,1,0,0],this.bbox=M[4],this.xstep=M[5],this.ystep=M[6],this.paintType=M[7],this.tilingType=M[8],this.color=k,this.ctx=v,this.canvasGraphicsFactory=l,this.baseTransform=d}createPatternCanvas(M){const k=this.operatorList,v=this.bbox,l=this.xstep,d=this.ystep,I=this.paintType,Q=this.tilingType,J=this.color,_t=this.canvasGraphicsFactory;(0,r.info)("TilingType: "+Q);const at=v[0],Pt=v[1],Ct=v[2],j=v[3],ut=r.Util.singularValueDecompose2dScale(this.matrix),Et=r.Util.singularValueDecompose2dScale(this.baseTransform),yt=[ut[0]*Et[0],ut[1]*Et[1]],et=this.getSizeAndScale(l,this.ctx.canvas.width,yt[0]),bt=this.getSizeAndScale(d,this.ctx.canvas.height,yt[1]),Rt=M.cachedCanvases.getCanvas("pattern",et.size,bt.size,!0),Ut=Rt.context,$t=_t.createCanvasGraphics(Ut);$t.groupLevel=M.groupLevel,this.setFillAndStrokeStyleToContext($t,I,J);let P=at,i=Pt,a=Ct,s=j;return at<0&&(P=0,a+=Math.abs(at)),Pt<0&&(i=0,s+=Math.abs(Pt)),Ut.translate(-(et.scale*P),-(bt.scale*i)),$t.transform(et.scale,0,0,bt.scale,0,0),Ut.save(),this.clipBbox($t,P,i,a,s),$t.baseTransform=(0,x.getCurrentTransform)($t.ctx),$t.executeOperatorList(k),$t.endDrawing(),{canvas:Rt.canvas,scaleX:et.scale,scaleY:bt.scale,offsetX:P,offsetY:i}}getSizeAndScale(M,k,v){M=Math.abs(M);const l=Math.max(p.MAX_PATTERN_SIZE,k);let d=Math.ceil(M*v);return d>=l?d=l:v=d/M,{scale:v,size:d}}clipBbox(M,k,v,l,d){const I=l-k,Q=d-v;M.ctx.rect(k,v,I,Q),M.current.updateRectMinMax((0,x.getCurrentTransform)(M.ctx),[k,v,l,d]),M.clip(),M.endPath()}setFillAndStrokeStyleToContext(M,k,v){const l=M.ctx,d=M.current;switch(k){case w.COLORED:const I=this.ctx;l.fillStyle=I.fillStyle,l.strokeStyle=I.strokeStyle,d.fillColor=I.fillStyle,d.strokeColor=I.strokeStyle;break;case w.UNCOLORED:const Q=r.Util.makeHexColor(v[0],v[1],v[2]);l.fillStyle=Q,l.strokeStyle=Q,d.fillColor=Q,d.strokeColor=Q;break;default:throw new r.FormatError(`Unsupported paint type: ${k}`)}}getPattern(M,k,v,l){let d=v;l!==q.SHADING&&(d=r.Util.transform(d,k.baseTransform),this.matrix&&(d=r.Util.transform(d,this.matrix)));const I=this.createPatternCanvas(k);let Q=new DOMMatrix(d);Q=Q.translate(I.offsetX,I.offsetY),Q=Q.scale(1/I.scaleX,1/I.scaleY);const J=M.createPattern(I.canvas,"repeat");return J.setTransform(Q),J}};oe(p,"MAX_PATTERN_SIZE",3e3);let C=p;o.TilingPattern=C},($,o,X)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.convertBlackAndWhiteToRGBA=q,o.convertToRGBA=x,o.grayToRGBA=gt;var r=X(1);function x(z){switch(z.kind){case r.ImageKind.GRAYSCALE_1BPP:return q(z);case r.ImageKind.RGB_24BPP:return Y(z)}return null}function q({src:z,srcPos:F=0,dest:m,width:H,height:W,nonBlackColor:L=4294967295,inverseDecode:w=!1}){const C=r.FeatureTest.isLittleEndian?4278190080:255,[p,y]=w?[L,C]:[C,L],M=H>>3,k=H&7,v=z.length;m=new Uint32Array(m.buffer);let l=0;for(let d=0;d<W;d++){for(const Q=F+M;F<Q;F++){const J=F<v?z[F]:255;m[l++]=J&128?y:p,m[l++]=J&64?y:p,m[l++]=J&32?y:p,m[l++]=J&16?y:p,m[l++]=J&8?y:p,m[l++]=J&4?y:p,m[l++]=J&2?y:p,m[l++]=J&1?y:p}if(k===0)continue;const I=F<v?z[F++]:255;for(let Q=0;Q<k;Q++)m[l++]=I&1<<7-Q?y:p}return{srcPos:F,destPos:l}}function Y({src:z,srcPos:F=0,dest:m,destPos:H=0,width:W,height:L}){let w=0;const C=z.length>>2,p=new Uint32Array(z.buffer,F,C);if(r.FeatureTest.isLittleEndian){for(;w<C-2;w+=3,H+=4){const y=p[w],M=p[w+1],k=p[w+2];m[H]=y|4278190080,m[H+1]=y>>>24|M<<8|4278190080,m[H+2]=M>>>16|k<<16|4278190080,m[H+3]=k>>>8|4278190080}for(let y=w*4,M=z.length;y<M;y+=3)m[H++]=z[y]|z[y+1]<<8|z[y+2]<<16|4278190080}else{for(;w<C-2;w+=3,H+=4){const y=p[w],M=p[w+1],k=p[w+2];m[H]=y|255,m[H+1]=y<<24|M>>>8|255,m[H+2]=M<<16|k>>>16|255,m[H+3]=k<<8|255}for(let y=w*4,M=z.length;y<M;y+=3)m[H++]=z[y]<<24|z[y+1]<<16|z[y+2]<<8|255}return{srcPos:F,destPos:H}}function gt(z,F){if(r.FeatureTest.isLittleEndian)for(let m=0,H=z.length;m<H;m++)F[m]=z[m]*65793|4278190080;else for(let m=0,H=z.length;m<H;m++)F[m]=z[m]*16843008|255}},($,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.GlobalWorkerOptions=void 0;const X=Object.create(null);o.GlobalWorkerOptions=X,X.workerPort=null,X.workerSrc=""},($,o,X)=>{var z,vn,m,_n,W,vi;Object.defineProperty(o,"__esModule",{value:!0}),o.MessageHandler=void 0;var r=X(1);const x={UNKNOWN:0,DATA:1,ERROR:2},q={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Y(w){switch(w instanceof Error||typeof w=="object"&&w!==null||(0,r.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),w.name){case"AbortException":return new r.AbortException(w.message);case"MissingPDFException":return new r.MissingPDFException(w.message);case"PasswordException":return new r.PasswordException(w.message,w.code);case"UnexpectedResponseException":return new r.UnexpectedResponseException(w.message,w.status);case"UnknownErrorException":return new r.UnknownErrorException(w.message,w.details);default:return new r.UnknownErrorException(w.message,w.toString())}}class gt{constructor(C,p,y){U(this,z);U(this,m);U(this,W);this.sourceName=C,this.targetName=p,this.comObj=y,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=M=>{const k=M.data;if(k.targetName!==this.sourceName)return;if(k.stream){Z(this,m,_n).call(this,k);return}if(k.callback){const l=k.callbackId,d=this.callbackCapabilities[l];if(!d)throw new Error(`Cannot resolve callback ${l}`);if(delete this.callbackCapabilities[l],k.callback===x.DATA)d.resolve(k.data);else if(k.callback===x.ERROR)d.reject(Y(k.reason));else throw new Error("Unexpected callback case");return}const v=this.actionHandler[k.action];if(!v)throw new Error(`Unknown action from worker: ${k.action}`);if(k.callbackId){const l=this.sourceName,d=k.sourceName;new Promise(function(I){I(v(k.data))}).then(function(I){y.postMessage({sourceName:l,targetName:d,callback:x.DATA,callbackId:k.callbackId,data:I})},function(I){y.postMessage({sourceName:l,targetName:d,callback:x.ERROR,callbackId:k.callbackId,reason:Y(I)})});return}if(k.streamId){Z(this,z,vn).call(this,k);return}v(k.data)},y.addEventListener("message",this._onComObjOnMessage)}on(C,p){const y=this.actionHandler;if(y[C])throw new Error(`There is already an actionName called "${C}"`);y[C]=p}send(C,p,y){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:C,data:p},y)}sendWithPromise(C,p,y){const M=this.callbackId++,k=new r.PromiseCapability;this.callbackCapabilities[M]=k;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:C,callbackId:M,data:p},y)}catch(v){k.reject(v)}return k.promise}sendWithStream(C,p,y,M){const k=this.streamId++,v=this.sourceName,l=this.targetName,d=this.comObj;return new ReadableStream({start:I=>{const Q=new r.PromiseCapability;return this.streamControllers[k]={controller:I,startCall:Q,pullCall:null,cancelCall:null,isClosed:!1},d.postMessage({sourceName:v,targetName:l,action:C,streamId:k,data:p,desiredSize:I.desiredSize},M),Q.promise},pull:I=>{const Q=new r.PromiseCapability;return this.streamControllers[k].pullCall=Q,d.postMessage({sourceName:v,targetName:l,stream:q.PULL,streamId:k,desiredSize:I.desiredSize}),Q.promise},cancel:I=>{(0,r.assert)(I instanceof Error,"cancel must have a valid reason");const Q=new r.PromiseCapability;return this.streamControllers[k].cancelCall=Q,this.streamControllers[k].isClosed=!0,d.postMessage({sourceName:v,targetName:l,stream:q.CANCEL,streamId:k,reason:Y(I)}),Q.promise}},y)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}z=new WeakSet,vn=function(C){const p=C.streamId,y=this.sourceName,M=C.sourceName,k=this.comObj,v=this,l=this.actionHandler[C.action],d={enqueue(I,Q=1,J){if(this.isCancelled)return;const _t=this.desiredSize;this.desiredSize-=Q,_t>0&&this.desiredSize<=0&&(this.sinkCapability=new r.PromiseCapability,this.ready=this.sinkCapability.promise),k.postMessage({sourceName:y,targetName:M,stream:q.ENQUEUE,streamId:p,chunk:I},J)},close(){this.isCancelled||(this.isCancelled=!0,k.postMessage({sourceName:y,targetName:M,stream:q.CLOSE,streamId:p}),delete v.streamSinks[p])},error(I){(0,r.assert)(I instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,k.postMessage({sourceName:y,targetName:M,stream:q.ERROR,streamId:p,reason:Y(I)}))},sinkCapability:new r.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:C.desiredSize,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[p]=d,new Promise(function(I){I(l(C.data,d))}).then(function(){k.postMessage({sourceName:y,targetName:M,stream:q.START_COMPLETE,streamId:p,success:!0})},function(I){k.postMessage({sourceName:y,targetName:M,stream:q.START_COMPLETE,streamId:p,reason:Y(I)})})},m=new WeakSet,_n=function(C){const p=C.streamId,y=this.sourceName,M=C.sourceName,k=this.comObj,v=this.streamControllers[p],l=this.streamSinks[p];switch(C.stream){case q.START_COMPLETE:C.success?v.startCall.resolve():v.startCall.reject(Y(C.reason));break;case q.PULL_COMPLETE:C.success?v.pullCall.resolve():v.pullCall.reject(Y(C.reason));break;case q.PULL:if(!l){k.postMessage({sourceName:y,targetName:M,stream:q.PULL_COMPLETE,streamId:p,success:!0});break}l.desiredSize<=0&&C.desiredSize>0&&l.sinkCapability.resolve(),l.desiredSize=C.desiredSize,new Promise(function(d){var I;d((I=l.onPull)==null?void 0:I.call(l))}).then(function(){k.postMessage({sourceName:y,targetName:M,stream:q.PULL_COMPLETE,streamId:p,success:!0})},function(d){k.postMessage({sourceName:y,targetName:M,stream:q.PULL_COMPLETE,streamId:p,reason:Y(d)})});break;case q.ENQUEUE:if((0,r.assert)(v,"enqueue should have stream controller"),v.isClosed)break;v.controller.enqueue(C.chunk);break;case q.CLOSE:if((0,r.assert)(v,"close should have stream controller"),v.isClosed)break;v.isClosed=!0,v.controller.close(),Z(this,W,vi).call(this,v,p);break;case q.ERROR:(0,r.assert)(v,"error should have stream controller"),v.controller.error(Y(C.reason)),Z(this,W,vi).call(this,v,p);break;case q.CANCEL_COMPLETE:C.success?v.cancelCall.resolve():v.cancelCall.reject(Y(C.reason)),Z(this,W,vi).call(this,v,p);break;case q.CANCEL:if(!l)break;new Promise(function(d){var I;d((I=l.onCancel)==null?void 0:I.call(l,Y(C.reason)))}).then(function(){k.postMessage({sourceName:y,targetName:M,stream:q.CANCEL_COMPLETE,streamId:p,success:!0})},function(d){k.postMessage({sourceName:y,targetName:M,stream:q.CANCEL_COMPLETE,streamId:p,reason:Y(d)})}),l.sinkCapability.reject(Y(C.reason)),l.isCancelled=!0,delete this.streamSinks[p];break;default:throw new Error("Unexpected stream case")}},W=new WeakSet,vi=async function(C,p){var y,M,k;await Promise.allSettled([(y=C.startCall)==null?void 0:y.promise,(M=C.pullCall)==null?void 0:M.promise,(k=C.cancelCall)==null?void 0:k.promise]),delete this.streamControllers[p]},o.MessageHandler=gt},($,o,X)=>{var q,Y;Object.defineProperty(o,"__esModule",{value:!0}),o.Metadata=void 0;var r=X(1);class x{constructor({parsedData:z,rawData:F}){U(this,q,void 0);U(this,Y,void 0);ot(this,q,z),ot(this,Y,F)}getRaw(){return t(this,Y)}get(z){return t(this,q).get(z)??null}getAll(){return(0,r.objectFromMap)(t(this,q))}has(z){return t(this,q).has(z)}}q=new WeakMap,Y=new WeakMap,o.Metadata=x},($,o,X)=>{var z,F,m,H,W,L,cs;Object.defineProperty(o,"__esModule",{value:!0}),o.OptionalContentConfig=void 0;var r=X(1),x=X(8);const q=Symbol("INTERNAL");class Y{constructor(p,y){U(this,z,!0);this.name=p,this.intent=y}get visible(){return t(this,z)}_setVisible(p,y){p!==q&&(0,r.unreachable)("Internal method `_setVisible` called."),ot(this,z,y)}}z=new WeakMap;class gt{constructor(p){U(this,L);U(this,F,null);U(this,m,new Map);U(this,H,null);U(this,W,null);if(this.name=null,this.creator=null,p!==null){this.name=p.name,this.creator=p.creator,ot(this,W,p.order);for(const y of p.groups)t(this,m).set(y.id,new Y(y.name,y.intent));if(p.baseState==="OFF")for(const y of t(this,m).values())y._setVisible(q,!1);for(const y of p.on)t(this,m).get(y)._setVisible(q,!0);for(const y of p.off)t(this,m).get(y)._setVisible(q,!1);ot(this,H,this.getHash())}}isVisible(p){if(t(this,m).size===0)return!0;if(!p)return(0,r.warn)("Optional content group not defined."),!0;if(p.type==="OCG")return t(this,m).has(p.id)?t(this,m).get(p.id).visible:((0,r.warn)(`Optional content group not found: ${p.id}`),!0);if(p.type==="OCMD"){if(p.expression)return Z(this,L,cs).call(this,p.expression);if(!p.policy||p.policy==="AnyOn"){for(const y of p.ids){if(!t(this,m).has(y))return(0,r.warn)(`Optional content group not found: ${y}`),!0;if(t(this,m).get(y).visible)return!0}return!1}else if(p.policy==="AllOn"){for(const y of p.ids){if(!t(this,m).has(y))return(0,r.warn)(`Optional content group not found: ${y}`),!0;if(!t(this,m).get(y).visible)return!1}return!0}else if(p.policy==="AnyOff"){for(const y of p.ids){if(!t(this,m).has(y))return(0,r.warn)(`Optional content group not found: ${y}`),!0;if(!t(this,m).get(y).visible)return!0}return!1}else if(p.policy==="AllOff"){for(const y of p.ids){if(!t(this,m).has(y))return(0,r.warn)(`Optional content group not found: ${y}`),!0;if(t(this,m).get(y).visible)return!1}return!0}return(0,r.warn)(`Unknown optional content policy ${p.policy}.`),!0}return(0,r.warn)(`Unknown group type ${p.type}.`),!0}setVisibility(p,y=!0){if(!t(this,m).has(p)){(0,r.warn)(`Optional content group not found: ${p}`);return}t(this,m).get(p)._setVisible(q,!!y),ot(this,F,null)}get hasInitialVisibility(){return t(this,H)===null||this.getHash()===t(this,H)}getOrder(){return t(this,m).size?t(this,W)?t(this,W).slice():[...t(this,m).keys()]:null}getGroups(){return t(this,m).size>0?(0,r.objectFromMap)(t(this,m)):null}getGroup(p){return t(this,m).get(p)||null}getHash(){if(t(this,F)!==null)return t(this,F);const p=new x.MurmurHash3_64;for(const[y,M]of t(this,m))p.update(`${y}:${M.visible}`);return ot(this,F,p.hexdigest())}}F=new WeakMap,m=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakSet,cs=function(p){const y=p.length;if(y<2)return!0;const M=p[0];for(let k=1;k<y;k++){const v=p[k];let l;if(Array.isArray(v))l=Z(this,L,cs).call(this,v);else if(t(this,m).has(v))l=t(this,m).get(v).visible;else return(0,r.warn)(`Optional content group not found: ${v}`),!0;switch(M){case"And":if(!l)return!1;break;case"Or":if(l)return!0;break;case"Not":return!l;default:return!0}}return M==="And"},o.OptionalContentConfig=gt},($,o,X)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PDFDataTransportStream=void 0;var r=X(1),x=X(6);class q{constructor({length:F,initialData:m,progressiveDone:H=!1,contentDispositionFilename:W=null,disableRange:L=!1,disableStream:w=!1},C){if((0,r.assert)(C,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=H,this._contentDispositionFilename=W,(m==null?void 0:m.length)>0){const p=m instanceof Uint8Array&&m.byteLength===m.buffer.byteLength?m.buffer:new Uint8Array(m).buffer;this._queuedChunks.push(p)}this._pdfDataRangeTransport=C,this._isStreamingSupported=!w,this._isRangeSupported=!L,this._contentLength=F,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((p,y)=>{this._onReceiveData({begin:p,chunk:y})}),this._pdfDataRangeTransport.addProgressListener((p,y)=>{this._onProgress({loaded:p,total:y})}),this._pdfDataRangeTransport.addProgressiveReadListener(p=>{this._onReceiveData({chunk:p})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:F,chunk:m}){const H=m instanceof Uint8Array&&m.byteLength===m.buffer.byteLength?m.buffer:new Uint8Array(m).buffer;if(F===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(H):this._queuedChunks.push(H);else{const W=this._rangeReaders.some(function(L){return L._begin!==F?!1:(L._enqueue(H),!0)});(0,r.assert)(W,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var F;return((F=this._fullRequestReader)==null?void 0:F._loaded)??0}_onProgress(F){var m,H,W,L;F.total===void 0?(H=(m=this._rangeReaders[0])==null?void 0:m.onProgress)==null||H.call(m,{loaded:F.loaded}):(L=(W=this._fullRequestReader)==null?void 0:W.onProgress)==null||L.call(W,{loaded:F.loaded,total:F.total})}_onProgressiveDone(){var F;(F=this._fullRequestReader)==null||F.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(F){const m=this._rangeReaders.indexOf(F);m>=0&&this._rangeReaders.splice(m,1)}getFullReader(){(0,r.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const F=this._queuedChunks;return this._queuedChunks=null,new Y(this,F,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(F,m){if(m<=this._progressiveDataLength)return null;const H=new gt(this,F,m);return this._pdfDataRangeTransport.requestDataRange(F,m),this._rangeReaders.push(H),H}cancelAllRequests(F){var m;(m=this._fullRequestReader)==null||m.cancel(F);for(const H of this._rangeReaders.slice(0))H.cancel(F);this._pdfDataRangeTransport.abort()}}o.PDFDataTransportStream=q;class Y{constructor(F,m,H=!1,W=null){this._stream=F,this._done=H||!1,this._filename=(0,x.isPdfFile)(W)?W:null,this._queuedChunks=m||[],this._loaded=0;for(const L of this._queuedChunks)this._loaded+=L.byteLength;this._requests=[],this._headersReady=Promise.resolve(),F._fullRequestReader=this,this.onProgress=null}_enqueue(F){this._done||(this._requests.length>0?this._requests.shift().resolve({value:F,done:!1}):this._queuedChunks.push(F),this._loaded+=F.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const F=new r.PromiseCapability;return this._requests.push(F),F.promise}cancel(F){this._done=!0;for(const m of this._requests)m.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class gt{constructor(F,m,H){this._stream=F,this._begin=m,this._end=H,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(F){if(!this._done){if(this._requests.length===0)this._queuedChunk=F;else{this._requests.shift().resolve({value:F,done:!1});for(const H of this._requests)H.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const m=this._queuedChunk;return this._queuedChunk=null,{value:m,done:!1}}if(this._done)return{value:void 0,done:!0};const F=new r.PromiseCapability;return this._requests.push(F),F.promise}cancel(F){this._done=!0;for(const m of this._requests)m.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},($,o,X)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PDFFetchStream=void 0;var r=X(1),x=X(20);function q(H,W,L){return{method:"GET",headers:H,signal:L.signal,mode:"cors",credentials:W?"include":"same-origin",redirect:"follow"}}function Y(H){const W=new Headers;for(const L in H){const w=H[L];w!==void 0&&W.append(L,w)}return W}function gt(H){return H instanceof Uint8Array?H.buffer:H instanceof ArrayBuffer?H:((0,r.warn)(`getArrayBuffer - unexpected data format: ${H}`),new Uint8Array(H).buffer)}class z{constructor(W){this.source=W,this.isHttp=/^https?:/i.test(W.url),this.httpHeaders=this.isHttp&&W.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var W;return((W=this._fullRequestReader)==null?void 0:W._loaded)??0}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new F(this),this._fullRequestReader}getRangeReader(W,L){if(L<=this._progressiveDataLength)return null;const w=new m(this,W,L);return this._rangeRequestReaders.push(w),w}cancelAllRequests(W){var L;(L=this._fullRequestReader)==null||L.cancel(W);for(const w of this._rangeRequestReaders.slice(0))w.cancel(W)}}o.PDFFetchStream=z;class F{constructor(W){this._stream=W,this._reader=null,this._loaded=0,this._filename=null;const L=W.source;this._withCredentials=L.withCredentials||!1,this._contentLength=L.length,this._headersCapability=new r.PromiseCapability,this._disableRange=L.disableRange||!1,this._rangeChunkSize=L.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!L.disableStream,this._isRangeSupported=!L.disableRange,this._headers=Y(this._stream.httpHeaders);const w=L.url;fetch(w,q(this._headers,this._withCredentials,this._abortController)).then(C=>{if(!(0,x.validateResponseStatus)(C.status))throw(0,x.createResponseStatusError)(C.status,w);this._reader=C.body.getReader(),this._headersCapability.resolve();const p=k=>C.headers.get(k),{allowRangeRequests:y,suggestedLength:M}=(0,x.validateRangeRequestCapabilities)({getResponseHeader:p,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=y,this._contentLength=M||this._contentLength,this._filename=(0,x.extractFilenameFromHeader)(p),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new r.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var w;await this._headersCapability.promise;const{value:W,done:L}=await this._reader.read();return L?{value:W,done:L}:(this._loaded+=W.byteLength,(w=this.onProgress)==null||w.call(this,{loaded:this._loaded,total:this._contentLength}),{value:gt(W),done:!1})}cancel(W){var L;(L=this._reader)==null||L.cancel(W),this._abortController.abort()}}class m{constructor(W,L,w){this._stream=W,this._reader=null,this._loaded=0;const C=W.source;this._withCredentials=C.withCredentials||!1,this._readCapability=new r.PromiseCapability,this._isStreamingSupported=!C.disableStream,this._abortController=new AbortController,this._headers=Y(this._stream.httpHeaders),this._headers.append("Range",`bytes=${L}-${w-1}`);const p=C.url;fetch(p,q(this._headers,this._withCredentials,this._abortController)).then(y=>{if(!(0,x.validateResponseStatus)(y.status))throw(0,x.createResponseStatusError)(y.status,p);this._readCapability.resolve(),this._reader=y.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var w;await this._readCapability.promise;const{value:W,done:L}=await this._reader.read();return L?{value:W,done:L}:(this._loaded+=W.byteLength,(w=this.onProgress)==null||w.call(this,{loaded:this._loaded}),{value:gt(W),done:!1})}cancel(W){var L;(L=this._reader)==null||L.cancel(W),this._abortController.abort()}}},($,o,X)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.createResponseStatusError=z,o.extractFilenameFromHeader=gt,o.validateRangeRequestCapabilities=Y,o.validateResponseStatus=F;var r=X(1),x=X(21),q=X(6);function Y({getResponseHeader:m,isHttp:H,rangeChunkSize:W,disableRange:L}){const w={allowRangeRequests:!1,suggestedLength:void 0},C=parseInt(m("Content-Length"),10);return!Number.isInteger(C)||(w.suggestedLength=C,C<=2*W)||L||!H||m("Accept-Ranges")!=="bytes"||(m("Content-Encoding")||"identity")!=="identity"||(w.allowRangeRequests=!0),w}function gt(m){const H=m("Content-Disposition");if(H){let W=(0,x.getFilenameFromContentDispositionHeader)(H);if(W.includes("%"))try{W=decodeURIComponent(W)}catch{}if((0,q.isPdfFile)(W))return W}return null}function z(m,H){return m===404||m===0&&H.startsWith("file:")?new r.MissingPDFException('Missing PDF "'+H+'".'):new r.UnexpectedResponseException(`Unexpected server response (${m}) while retrieving PDF "${H}".`,m)}function F(m){return m===200||m===206}},($,o,X)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.getFilenameFromContentDispositionHeader=x;var r=X(1);function x(q){let Y=!0,gt=z("filename\\*","i").exec(q);if(gt){gt=gt[1];let C=W(gt);return C=unescape(C),C=L(C),C=w(C),m(C)}if(gt=H(q),gt){const C=w(gt);return m(C)}if(gt=z("filename","i").exec(q),gt){gt=gt[1];let C=W(gt);return C=w(C),m(C)}function z(C,p){return new RegExp("(?:^|;)\\s*"+C+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',p)}function F(C,p){if(C){if(!/^[\x00-\xFF]+$/.test(p))return p;try{const y=new TextDecoder(C,{fatal:!0}),M=(0,r.stringToBytes)(p);p=y.decode(M),Y=!1}catch{}}return p}function m(C){return Y&&/[\x80-\xff]/.test(C)&&(C=F("utf-8",C),Y&&(C=F("iso-8859-1",C))),C}function H(C){const p=[];let y;const M=z("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(y=M.exec(C))!==null;){let[,v,l,d]=y;if(v=parseInt(v,10),v in p){if(v===0)break;continue}p[v]=[l,d]}const k=[];for(let v=0;v<p.length&&v in p;++v){let[l,d]=p[v];d=W(d),l&&(d=unescape(d),v===0&&(d=L(d))),k.push(d)}return k.join("")}function W(C){if(C.startsWith('"')){const p=C.slice(1).split('\\"');for(let y=0;y<p.length;++y){const M=p[y].indexOf('"');M!==-1&&(p[y]=p[y].slice(0,M),p.length=y+1),p[y]=p[y].replaceAll(/\\(.)/g,"$1")}C=p.join('"')}return C}function L(C){const p=C.indexOf("'");if(p===-1)return C;const y=C.slice(0,p),k=C.slice(p+1).replace(/^[^']*'/,"");return F(y,k)}function w(C){return!C.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(C)?C:C.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(p,y,M,k){if(M==="q"||M==="Q")return k=k.replaceAll("_"," "),k=k.replaceAll(/=([0-9a-fA-F]{2})/g,function(v,l){return String.fromCharCode(parseInt(l,16))}),F(y,k);try{k=atob(k)}catch{}return F(y,k)})}return""}},($,o,X)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PDFNetworkStream=void 0;var r=X(1),x=X(20);const q=200,Y=206;function gt(W){const L=W.response;return typeof L!="string"?L:(0,r.stringToBytes)(L).buffer}class z{constructor(L,w={}){this.url=L,this.isHttp=/^https?:/i.test(L),this.httpHeaders=this.isHttp&&w.httpHeaders||Object.create(null),this.withCredentials=w.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(L,w,C){const p={begin:L,end:w};for(const y in C)p[y]=C[y];return this.request(p)}requestFull(L){return this.request(L)}request(L){const w=new XMLHttpRequest,C=this.currXhrId++,p=this.pendingRequests[C]={xhr:w};w.open("GET",this.url),w.withCredentials=this.withCredentials;for(const y in this.httpHeaders){const M=this.httpHeaders[y];M!==void 0&&w.setRequestHeader(y,M)}return this.isHttp&&"begin"in L&&"end"in L?(w.setRequestHeader("Range",`bytes=${L.begin}-${L.end-1}`),p.expectedStatus=Y):p.expectedStatus=q,w.responseType="arraybuffer",L.onError&&(w.onerror=function(y){L.onError(w.status)}),w.onreadystatechange=this.onStateChange.bind(this,C),w.onprogress=this.onProgress.bind(this,C),p.onHeadersReceived=L.onHeadersReceived,p.onDone=L.onDone,p.onError=L.onError,p.onProgress=L.onProgress,w.send(null),C}onProgress(L,w){var p;const C=this.pendingRequests[L];C&&((p=C.onProgress)==null||p.call(C,w))}onStateChange(L,w){var v,l,d;const C=this.pendingRequests[L];if(!C)return;const p=C.xhr;if(p.readyState>=2&&C.onHeadersReceived&&(C.onHeadersReceived(),delete C.onHeadersReceived),p.readyState!==4||!(L in this.pendingRequests))return;if(delete this.pendingRequests[L],p.status===0&&this.isHttp){(v=C.onError)==null||v.call(C,p.status);return}const y=p.status||q;if(!(y===q&&C.expectedStatus===Y)&&y!==C.expectedStatus){(l=C.onError)==null||l.call(C,p.status);return}const k=gt(p);if(y===Y){const I=p.getResponseHeader("Content-Range"),Q=/bytes (\d+)-(\d+)\/(\d+)/.exec(I);C.onDone({begin:parseInt(Q[1],10),chunk:k})}else k?C.onDone({begin:0,chunk:k}):(d=C.onError)==null||d.call(C,p.status)}getRequestXhr(L){return this.pendingRequests[L].xhr}isPendingRequest(L){return L in this.pendingRequests}abortRequest(L){const w=this.pendingRequests[L].xhr;delete this.pendingRequests[L],w.abort()}}class F{constructor(L){this._source=L,this._manager=new z(L.url,{httpHeaders:L.httpHeaders,withCredentials:L.withCredentials}),this._rangeChunkSize=L.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(L){const w=this._rangeRequestReaders.indexOf(L);w>=0&&this._rangeRequestReaders.splice(w,1)}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new m(this._manager,this._source),this._fullRequestReader}getRangeReader(L,w){const C=new H(this._manager,L,w);return C.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(C),C}cancelAllRequests(L){var w;(w=this._fullRequestReader)==null||w.cancel(L);for(const C of this._rangeRequestReaders.slice(0))C.cancel(L)}}o.PDFNetworkStream=F;class m{constructor(L,w){this._manager=L;const C={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=w.url,this._fullRequestId=L.requestFull(C),this._headersReceivedCapability=new r.PromiseCapability,this._disableRange=w.disableRange||!1,this._contentLength=w.length,this._rangeChunkSize=w.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const L=this._fullRequestId,w=this._manager.getRequestXhr(L),C=M=>w.getResponseHeader(M),{allowRangeRequests:p,suggestedLength:y}=(0,x.validateRangeRequestCapabilities)({getResponseHeader:C,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});p&&(this._isRangeSupported=!0),this._contentLength=y||this._contentLength,this._filename=(0,x.extractFilenameFromHeader)(C),this._isRangeSupported&&this._manager.abortRequest(L),this._headersReceivedCapability.resolve()}_onDone(L){if(L&&(this._requests.length>0?this._requests.shift().resolve({value:L.chunk,done:!1}):this._cachedChunks.push(L.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const w of this._requests)w.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(L){this._storedError=(0,x.createResponseStatusError)(L,this._url),this._headersReceivedCapability.reject(this._storedError);for(const w of this._requests)w.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(L){var w;(w=this.onProgress)==null||w.call(this,{loaded:L.loaded,total:L.lengthComputable?L.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const L=new r.PromiseCapability;return this._requests.push(L),L.promise}cancel(L){this._done=!0,this._headersReceivedCapability.reject(L);for(const w of this._requests)w.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class H{constructor(L,w,C){this._manager=L;const p={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=L.url,this._requestId=L.requestRange(w,C,p),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var L;(L=this.onClosed)==null||L.call(this,this)}_onDone(L){const w=L.chunk;this._requests.length>0?this._requests.shift().resolve({value:w,done:!1}):this._queuedChunk=w,this._done=!0;for(const C of this._requests)C.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(L){this._storedError=(0,x.createResponseStatusError)(L,this._url);for(const w of this._requests)w.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(L){var w;this.isStreamingSupported||(w=this.onProgress)==null||w.call(this,{loaded:L.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const w=this._queuedChunk;return this._queuedChunk=null,{value:w,done:!1}}if(this._done)return{value:void 0,done:!0};const L=new r.PromiseCapability;return this._requests.push(L),L.promise}cancel(L){this._done=!0;for(const w of this._requests)w.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},($,o,X)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PDFNodeStream=void 0;var r=X(1),x=X(20);const q=/^file:\/\/\/[a-zA-Z]:\//;function Y(C){const p=Se,y=p.parse(C);return y.protocol==="file:"||y.host?y:/^[a-z]:[/\\]/i.test(C)?p.parse(`file:///${C}`):(y.host||(y.protocol="file:"),y)}class gt{constructor(p){this.source=p,this.url=Y(p.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&p.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var p;return((p=this._fullRequestReader)==null?void 0:p._loaded)??0}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new L(this):new H(this),this._fullRequestReader}getRangeReader(p,y){if(y<=this._progressiveDataLength)return null;const M=this.isFsUrl?new w(this,p,y):new W(this,p,y);return this._rangeRequestReaders.push(M),M}cancelAllRequests(p){var y;(y=this._fullRequestReader)==null||y.cancel(p);for(const M of this._rangeRequestReaders.slice(0))M.cancel(p)}}o.PDFNodeStream=gt;class z{constructor(p){this._url=p.url,this._done=!1,this._storedError=null,this.onProgress=null;const y=p.source;this._contentLength=y.length,this._loaded=0,this._filename=null,this._disableRange=y.disableRange||!1,this._rangeChunkSize=y.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!y.disableStream,this._isRangeSupported=!y.disableRange,this._readableStream=null,this._readCapability=new r.PromiseCapability,this._headersCapability=new r.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var M;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const p=this._readableStream.read();return p===null?(this._readCapability=new r.PromiseCapability,this.read()):(this._loaded+=p.length,(M=this.onProgress)==null||M.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(p).buffer,done:!1})}cancel(p){if(!this._readableStream){this._error(p);return}this._readableStream.destroy(p)}_error(p){this._storedError=p,this._readCapability.resolve()}_setReadableStream(p){this._readableStream=p,p.on("readable",()=>{this._readCapability.resolve()}),p.on("end",()=>{p.destroy(),this._done=!0,this._readCapability.resolve()}),p.on("error",y=>{this._error(y)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new r.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class F{constructor(p){this._url=p.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new r.PromiseCapability;const y=p.source;this._isStreamingSupported=!y.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var M;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const p=this._readableStream.read();return p===null?(this._readCapability=new r.PromiseCapability,this.read()):(this._loaded+=p.length,(M=this.onProgress)==null||M.call(this,{loaded:this._loaded}),{value:new Uint8Array(p).buffer,done:!1})}cancel(p){if(!this._readableStream){this._error(p);return}this._readableStream.destroy(p)}_error(p){this._storedError=p,this._readCapability.resolve()}_setReadableStream(p){this._readableStream=p,p.on("readable",()=>{this._readCapability.resolve()}),p.on("end",()=>{p.destroy(),this._done=!0,this._readCapability.resolve()}),p.on("error",y=>{this._error(y)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function m(C,p){return{protocol:C.protocol,auth:C.auth,host:C.hostname,port:C.port,path:C.path,method:"GET",headers:p}}class H extends z{constructor(p){super(p);const y=M=>{if(M.statusCode===404){const d=new r.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=d,this._headersCapability.reject(d);return}this._headersCapability.resolve(),this._setReadableStream(M);const k=d=>this._readableStream.headers[d.toLowerCase()],{allowRangeRequests:v,suggestedLength:l}=(0,x.validateRangeRequestCapabilities)({getResponseHeader:k,isHttp:p.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=v,this._contentLength=l||this._contentLength,this._filename=(0,x.extractFilenameFromHeader)(k)};if(this._request=null,this._url.protocol==="http:"){const M=Se;this._request=M.request(m(this._url,p.httpHeaders),y)}else{const M=Se;this._request=M.request(m(this._url,p.httpHeaders),y)}this._request.on("error",M=>{this._storedError=M,this._headersCapability.reject(M)}),this._request.end()}}class W extends F{constructor(p,y,M){super(p),this._httpHeaders={};for(const v in p.httpHeaders){const l=p.httpHeaders[v];l!==void 0&&(this._httpHeaders[v]=l)}this._httpHeaders.Range=`bytes=${y}-${M-1}`;const k=v=>{if(v.statusCode===404){const l=new r.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=l;return}this._setReadableStream(v)};if(this._request=null,this._url.protocol==="http:"){const v=Se;this._request=v.request(m(this._url,this._httpHeaders),k)}else{const v=Se;this._request=v.request(m(this._url,this._httpHeaders),k)}this._request.on("error",v=>{this._storedError=v}),this._request.end()}}class L extends z{constructor(p){super(p);let y=decodeURIComponent(this._url.path);q.test(this._url.href)&&(y=y.replace(/^\//,""));const M=Se;M.lstat(y,(k,v)=>{if(k){k.code==="ENOENT"&&(k=new r.MissingPDFException(`Missing PDF "${y}".`)),this._storedError=k,this._headersCapability.reject(k);return}this._contentLength=v.size,this._setReadableStream(M.createReadStream(y)),this._headersCapability.resolve()})}}class w extends F{constructor(p,y,M){super(p);let k=decodeURIComponent(this._url.path);q.test(this._url.href)&&(k=k.replace(/^\//,""));const v=Se;this._setReadableStream(v.createReadStream(k,{start:y,end:M-1}))}}},($,o,X)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.SVGGraphics=void 0;var r=X(6),x=X(1);const q={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},Y="http://www.w3.org/XML/1998/namespace",gt="http://www.w3.org/1999/xlink",z=["butt","round","square"],F=["miter","round","bevel"],m=function(v,l="",d=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!d)return URL.createObjectURL(new Blob([v],{type:l}));const I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let Q=`data:${l};base64,`;for(let J=0,_t=v.length;J<_t;J+=3){const at=v[J]&255,Pt=v[J+1]&255,Ct=v[J+2]&255,j=at>>2,ut=(at&3)<<4|Pt>>4,Et=J+1<_t?(Pt&15)<<2|Ct>>6:64,yt=J+2<_t?Ct&63:64;Q+=I[j]+I[ut]+I[Et]+I[yt]}return Q},H=function(){const v=new Uint8Array([137,80,78,71,13,10,26,10]),l=12,d=new Int32Array(256);for(let Ct=0;Ct<256;Ct++){let j=Ct;for(let ut=0;ut<8;ut++)j=j&1?3988292384^j>>1&2147483647:j>>1&2147483647;d[Ct]=j}function I(Ct,j,ut){let Et=-1;for(let yt=j;yt<ut;yt++){const et=(Et^Ct[yt])&255,bt=d[et];Et=Et>>>8^bt}return Et^-1}function Q(Ct,j,ut,Et){let yt=Et;const et=j.length;ut[yt]=et>>24&255,ut[yt+1]=et>>16&255,ut[yt+2]=et>>8&255,ut[yt+3]=et&255,yt+=4,ut[yt]=Ct.charCodeAt(0)&255,ut[yt+1]=Ct.charCodeAt(1)&255,ut[yt+2]=Ct.charCodeAt(2)&255,ut[yt+3]=Ct.charCodeAt(3)&255,yt+=4,ut.set(j,yt),yt+=j.length;const bt=I(ut,Et+4,yt);ut[yt]=bt>>24&255,ut[yt+1]=bt>>16&255,ut[yt+2]=bt>>8&255,ut[yt+3]=bt&255}function J(Ct,j,ut){let Et=1,yt=0;for(let et=j;et<ut;++et)Et=(Et+(Ct[et]&255))%65521,yt=(yt+Et)%65521;return yt<<16|Et}function _t(Ct){if(!x.isNodeJS)return at(Ct);try{const j=parseInt(process.versions.node)>=8?Ct:Buffer.from(Ct),ut=Se.deflateSync(j,{level:9});return ut instanceof Uint8Array?ut:new Uint8Array(ut)}catch(j){(0,x.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+j)}return at(Ct)}function at(Ct){let j=Ct.length;const ut=65535,Et=Math.ceil(j/ut),yt=new Uint8Array(2+j+Et*5+4);let et=0;yt[et++]=120,yt[et++]=156;let bt=0;for(;j>ut;)yt[et++]=0,yt[et++]=255,yt[et++]=255,yt[et++]=0,yt[et++]=0,yt.set(Ct.subarray(bt,bt+ut),et),et+=ut,bt+=ut,j-=ut;yt[et++]=1,yt[et++]=j&255,yt[et++]=j>>8&255,yt[et++]=~j&65535&255,yt[et++]=(~j&65535)>>8&255,yt.set(Ct.subarray(bt),et),et+=Ct.length-bt;const Rt=J(Ct,0,Ct.length);return yt[et++]=Rt>>24&255,yt[et++]=Rt>>16&255,yt[et++]=Rt>>8&255,yt[et++]=Rt&255,yt}function Pt(Ct,j,ut,Et){const yt=Ct.width,et=Ct.height;let bt,Rt,Ut;const $t=Ct.data;switch(j){case x.ImageKind.GRAYSCALE_1BPP:Rt=0,bt=1,Ut=yt+7>>3;break;case x.ImageKind.RGB_24BPP:Rt=2,bt=8,Ut=yt*3;break;case x.ImageKind.RGBA_32BPP:Rt=6,bt=8,Ut=yt*4;break;default:throw new Error("invalid format")}const P=new Uint8Array((1+Ut)*et);let i=0,a=0;for(let B=0;B<et;++B)P[i++]=0,P.set($t.subarray(a,a+Ut),i),a+=Ut,i+=Ut;if(j===x.ImageKind.GRAYSCALE_1BPP&&Et){i=0;for(let B=0;B<et;B++){i++;for(let ct=0;ct<Ut;ct++)P[i++]^=255}}const s=new Uint8Array([yt>>24&255,yt>>16&255,yt>>8&255,yt&255,et>>24&255,et>>16&255,et>>8&255,et&255,bt,Rt,0,0,0]),c=_t(P),u=v.length+l*3+s.length+c.length,A=new Uint8Array(u);let R=0;return A.set(v,R),R+=v.length,Q("IHDR",s,A,R),R+=l+s.length,Q("IDATA",c,A,R),R+=l+c.length,Q("IEND",new Uint8Array(0),A,R),m(A,"image/png",ut)}return function(j,ut,Et){const yt=j.kind===void 0?x.ImageKind.GRAYSCALE_1BPP:j.kind;return Pt(j,yt,ut,Et)}}();class W{constructor(){this.fontSizeScale=1,this.fontWeight=q.fontWeight,this.fontSize=0,this.textMatrix=x.IDENTITY_MATRIX,this.fontMatrix=x.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=x.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=q.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(l,d){this.x=l,this.y=d}}function L(v){let l=[];const d=[];for(const I of v){if(I.fn==="save"){l.push({fnId:92,fn:"group",items:[]}),d.push(l),l=l.at(-1).items;continue}I.fn==="restore"?l=d.pop():l.push(I)}return l}function w(v){if(Number.isInteger(v))return v.toString();const l=v.toFixed(10);let d=l.length-1;if(l[d]!=="0")return l;do d--;while(l[d]==="0");return l.substring(0,l[d]==="."?d:d+1)}function C(v){if(v[4]===0&&v[5]===0){if(v[1]===0&&v[2]===0)return v[0]===1&&v[3]===1?"":`scale(${w(v[0])} ${w(v[3])})`;if(v[0]===v[3]&&v[1]===-v[2]){const l=Math.acos(v[0])*180/Math.PI;return`rotate(${w(l)})`}}else if(v[0]===1&&v[1]===0&&v[2]===0&&v[3]===1)return`translate(${w(v[4])} ${w(v[5])})`;return`matrix(${w(v[0])} ${w(v[1])} ${w(v[2])} ${w(v[3])} ${w(v[4])} ${w(v[5])})`}let p=0,y=0,M=0;class k{constructor(l,d,I=!1){(0,r.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new r.DOMSVGFactory,this.current=new W,this.transformMatrix=x.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=l,this.objs=d,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!I,this._operatorIdMapping=[];for(const Q in x.OPS)this._operatorIdMapping[x.OPS[Q]]=Q}getObject(l,d=null){return typeof l=="string"?l.startsWith("g_")?this.commonObjs.get(l):this.objs.get(l):d}save(){this.transformStack.push(this.transformMatrix);const l=this.current;this.extraStack.push(l),this.current=l.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(l){this.save(),this.executeOpTree(l),this.restore()}loadDependencies(l){const d=l.fnArray,I=l.argsArray;for(let Q=0,J=d.length;Q<J;Q++)if(d[Q]===x.OPS.dependency)for(const _t of I[Q]){const at=_t.startsWith("g_")?this.commonObjs:this.objs,Pt=new Promise(Ct=>{at.get(_t,Ct)});this.current.dependencies.push(Pt)}return Promise.all(this.current.dependencies)}transform(l,d,I,Q,J,_t){const at=[l,d,I,Q,J,_t];this.transformMatrix=x.Util.transform(this.transformMatrix,at),this.tgrp=null}getSVG(l,d){this.viewport=d;const I=this._initialize(d);return this.loadDependencies(l).then(()=>(this.transformMatrix=x.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(l)),I))}convertOpList(l){const d=this._operatorIdMapping,I=l.argsArray,Q=l.fnArray,J=[];for(let _t=0,at=Q.length;_t<at;_t++){const Pt=Q[_t];J.push({fnId:Pt,fn:d[Pt],args:I[_t]})}return L(J)}executeOpTree(l){for(const d of l){const I=d.fn,Q=d.fnId,J=d.args;switch(Q|0){case x.OPS.beginText:this.beginText();break;case x.OPS.dependency:break;case x.OPS.setLeading:this.setLeading(J);break;case x.OPS.setLeadingMoveText:this.setLeadingMoveText(J[0],J[1]);break;case x.OPS.setFont:this.setFont(J);break;case x.OPS.showText:this.showText(J[0]);break;case x.OPS.showSpacedText:this.showText(J[0]);break;case x.OPS.endText:this.endText();break;case x.OPS.moveText:this.moveText(J[0],J[1]);break;case x.OPS.setCharSpacing:this.setCharSpacing(J[0]);break;case x.OPS.setWordSpacing:this.setWordSpacing(J[0]);break;case x.OPS.setHScale:this.setHScale(J[0]);break;case x.OPS.setTextMatrix:this.setTextMatrix(J[0],J[1],J[2],J[3],J[4],J[5]);break;case x.OPS.setTextRise:this.setTextRise(J[0]);break;case x.OPS.setTextRenderingMode:this.setTextRenderingMode(J[0]);break;case x.OPS.setLineWidth:this.setLineWidth(J[0]);break;case x.OPS.setLineJoin:this.setLineJoin(J[0]);break;case x.OPS.setLineCap:this.setLineCap(J[0]);break;case x.OPS.setMiterLimit:this.setMiterLimit(J[0]);break;case x.OPS.setFillRGBColor:this.setFillRGBColor(J[0],J[1],J[2]);break;case x.OPS.setStrokeRGBColor:this.setStrokeRGBColor(J[0],J[1],J[2]);break;case x.OPS.setStrokeColorN:this.setStrokeColorN(J);break;case x.OPS.setFillColorN:this.setFillColorN(J);break;case x.OPS.shadingFill:this.shadingFill(J[0]);break;case x.OPS.setDash:this.setDash(J[0],J[1]);break;case x.OPS.setRenderingIntent:this.setRenderingIntent(J[0]);break;case x.OPS.setFlatness:this.setFlatness(J[0]);break;case x.OPS.setGState:this.setGState(J[0]);break;case x.OPS.fill:this.fill();break;case x.OPS.eoFill:this.eoFill();break;case x.OPS.stroke:this.stroke();break;case x.OPS.fillStroke:this.fillStroke();break;case x.OPS.eoFillStroke:this.eoFillStroke();break;case x.OPS.clip:this.clip("nonzero");break;case x.OPS.eoClip:this.clip("evenodd");break;case x.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case x.OPS.paintImageXObject:this.paintImageXObject(J[0]);break;case x.OPS.paintInlineImageXObject:this.paintInlineImageXObject(J[0]);break;case x.OPS.paintImageMaskXObject:this.paintImageMaskXObject(J[0]);break;case x.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(J[0],J[1]);break;case x.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case x.OPS.closePath:this.closePath();break;case x.OPS.closeStroke:this.closeStroke();break;case x.OPS.closeFillStroke:this.closeFillStroke();break;case x.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case x.OPS.nextLine:this.nextLine();break;case x.OPS.transform:this.transform(J[0],J[1],J[2],J[3],J[4],J[5]);break;case x.OPS.constructPath:this.constructPath(J[0],J[1]);break;case x.OPS.endPath:this.endPath();break;case 92:this.group(d.items);break;default:(0,x.warn)(`Unimplemented operator ${I}`);break}}}setWordSpacing(l){this.current.wordSpacing=l}setCharSpacing(l){this.current.charSpacing=l}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(l,d,I,Q,J,_t){const at=this.current;at.textMatrix=at.lineMatrix=[l,d,I,Q,J,_t],at.textMatrixScale=Math.hypot(l,d),at.x=at.lineX=0,at.y=at.lineY=0,at.xcoords=[],at.ycoords=[],at.tspan=this.svgFactory.createElement("svg:tspan"),at.tspan.setAttributeNS(null,"font-family",at.fontFamily),at.tspan.setAttributeNS(null,"font-size",`${w(at.fontSize)}px`),at.tspan.setAttributeNS(null,"y",w(-at.y)),at.txtElement=this.svgFactory.createElement("svg:text"),at.txtElement.append(at.tspan)}beginText(){const l=this.current;l.x=l.lineX=0,l.y=l.lineY=0,l.textMatrix=x.IDENTITY_MATRIX,l.lineMatrix=x.IDENTITY_MATRIX,l.textMatrixScale=1,l.tspan=this.svgFactory.createElement("svg:tspan"),l.txtElement=this.svgFactory.createElement("svg:text"),l.txtgrp=this.svgFactory.createElement("svg:g"),l.xcoords=[],l.ycoords=[]}moveText(l,d){const I=this.current;I.x=I.lineX+=l,I.y=I.lineY+=d,I.xcoords=[],I.ycoords=[],I.tspan=this.svgFactory.createElement("svg:tspan"),I.tspan.setAttributeNS(null,"font-family",I.fontFamily),I.tspan.setAttributeNS(null,"font-size",`${w(I.fontSize)}px`),I.tspan.setAttributeNS(null,"y",w(-I.y))}showText(l){const d=this.current,I=d.font,Q=d.fontSize;if(Q===0)return;const J=d.fontSizeScale,_t=d.charSpacing,at=d.wordSpacing,Pt=d.fontDirection,Ct=d.textHScale*Pt,j=I.vertical,ut=j?1:-1,Et=I.defaultVMetrics,yt=Q*d.fontMatrix[0];let et=0;for(const Ut of l){if(Ut===null){et+=Pt*at;continue}else if(typeof Ut=="number"){et+=ut*Ut*Q/1e3;continue}const $t=(Ut.isSpace?at:0)+_t,P=Ut.fontChar;let i,a,s=Ut.width;if(j){let u;const A=Ut.vmetric||Et;u=Ut.vmetric?A[1]:s*.5,u=-u*yt;const R=A[2]*yt;s=A?-A[0]:s,i=u/J,a=(et+R)/J}else i=et/J,a=0;(Ut.isInFont||I.missingFile)&&(d.xcoords.push(d.x+i),j&&d.ycoords.push(-d.y+a),d.tspan.textContent+=P);const c=j?s*yt-$t*Pt:s*yt+$t*Pt;et+=c}d.tspan.setAttributeNS(null,"x",d.xcoords.map(w).join(" ")),j?d.tspan.setAttributeNS(null,"y",d.ycoords.map(w).join(" ")):d.tspan.setAttributeNS(null,"y",w(-d.y)),j?d.y-=et:d.x+=et*Ct,d.tspan.setAttributeNS(null,"font-family",d.fontFamily),d.tspan.setAttributeNS(null,"font-size",`${w(d.fontSize)}px`),d.fontStyle!==q.fontStyle&&d.tspan.setAttributeNS(null,"font-style",d.fontStyle),d.fontWeight!==q.fontWeight&&d.tspan.setAttributeNS(null,"font-weight",d.fontWeight);const bt=d.textRenderingMode&x.TextRenderingMode.FILL_STROKE_MASK;if(bt===x.TextRenderingMode.FILL||bt===x.TextRenderingMode.FILL_STROKE?(d.fillColor!==q.fillColor&&d.tspan.setAttributeNS(null,"fill",d.fillColor),d.fillAlpha<1&&d.tspan.setAttributeNS(null,"fill-opacity",d.fillAlpha)):d.textRenderingMode===x.TextRenderingMode.ADD_TO_PATH?d.tspan.setAttributeNS(null,"fill","transparent"):d.tspan.setAttributeNS(null,"fill","none"),bt===x.TextRenderingMode.STROKE||bt===x.TextRenderingMode.FILL_STROKE){const Ut=1/(d.textMatrixScale||1);this._setStrokeAttributes(d.tspan,Ut)}let Rt=d.textMatrix;d.textRise!==0&&(Rt=Rt.slice(),Rt[5]+=d.textRise),d.txtElement.setAttributeNS(null,"transform",`${C(Rt)} scale(${w(Ct)}, -1)`),d.txtElement.setAttributeNS(Y,"xml:space","preserve"),d.txtElement.append(d.tspan),d.txtgrp.append(d.txtElement),this._ensureTransformGroup().append(d.txtElement)}setLeadingMoveText(l,d){this.setLeading(-d),this.moveText(l,d)}addFontStyle(l){if(!l.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const d=m(l.data,l.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${l.loadedName}"; src: url(${d}); }
`}setFont(l){const d=this.current,I=this.commonObjs.get(l[0]);let Q=l[1];d.font=I,this.embedFonts&&!I.missingFile&&!this.embeddedFonts[I.loadedName]&&(this.addFontStyle(I),this.embeddedFonts[I.loadedName]=I),d.fontMatrix=I.fontMatrix||x.FONT_IDENTITY_MATRIX;let J="normal";I.black?J="900":I.bold&&(J="bold");const _t=I.italic?"italic":"normal";Q<0?(Q=-Q,d.fontDirection=-1):d.fontDirection=1,d.fontSize=Q,d.fontFamily=I.loadedName,d.fontWeight=J,d.fontStyle=_t,d.tspan=this.svgFactory.createElement("svg:tspan"),d.tspan.setAttributeNS(null,"y",w(-d.y)),d.xcoords=[],d.ycoords=[]}endText(){var d;const l=this.current;l.textRenderingMode&x.TextRenderingMode.ADD_TO_PATH_FLAG&&((d=l.txtElement)!=null&&d.hasChildNodes())&&(l.element=l.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(l){l>0&&(this.current.lineWidth=l)}setLineCap(l){this.current.lineCap=z[l]}setLineJoin(l){this.current.lineJoin=F[l]}setMiterLimit(l){this.current.miterLimit=l}setStrokeAlpha(l){this.current.strokeAlpha=l}setStrokeRGBColor(l,d,I){this.current.strokeColor=x.Util.makeHexColor(l,d,I)}setFillAlpha(l){this.current.fillAlpha=l}setFillRGBColor(l,d,I){this.current.fillColor=x.Util.makeHexColor(l,d,I),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(l){this.current.strokeColor=this._makeColorN_Pattern(l)}setFillColorN(l){this.current.fillColor=this._makeColorN_Pattern(l)}shadingFill(l){const{width:d,height:I}=this.viewport,Q=x.Util.inverseTransform(this.transformMatrix),[J,_t,at,Pt]=x.Util.getAxialAlignedBoundingBox([0,0,d,I],Q),Ct=this.svgFactory.createElement("svg:rect");Ct.setAttributeNS(null,"x",J),Ct.setAttributeNS(null,"y",_t),Ct.setAttributeNS(null,"width",at-J),Ct.setAttributeNS(null,"height",Pt-_t),Ct.setAttributeNS(null,"fill",this._makeShadingPattern(l)),this.current.fillAlpha<1&&Ct.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(Ct)}_makeColorN_Pattern(l){return l[0]==="TilingPattern"?this._makeTilingPattern(l):this._makeShadingPattern(l)}_makeTilingPattern(l){const d=l[1],I=l[2],Q=l[3]||x.IDENTITY_MATRIX,[J,_t,at,Pt]=l[4],Ct=l[5],j=l[6],ut=l[7],Et=`shading${M++}`,[yt,et,bt,Rt]=x.Util.normalizeRect([...x.Util.applyTransform([J,_t],Q),...x.Util.applyTransform([at,Pt],Q)]),[Ut,$t]=x.Util.singularValueDecompose2dScale(Q),P=Ct*Ut,i=j*$t,a=this.svgFactory.createElement("svg:pattern");a.setAttributeNS(null,"id",Et),a.setAttributeNS(null,"patternUnits","userSpaceOnUse"),a.setAttributeNS(null,"width",P),a.setAttributeNS(null,"height",i),a.setAttributeNS(null,"x",`${yt}`),a.setAttributeNS(null,"y",`${et}`);const s=this.svg,c=this.transformMatrix,u=this.current.fillColor,A=this.current.strokeColor,R=this.svgFactory.create(bt-yt,Rt-et);if(this.svg=R,this.transformMatrix=Q,ut===2){const B=x.Util.makeHexColor(...d);this.current.fillColor=B,this.current.strokeColor=B}return this.executeOpTree(this.convertOpList(I)),this.svg=s,this.transformMatrix=c,this.current.fillColor=u,this.current.strokeColor=A,a.append(R.childNodes[0]),this.defs.append(a),`url(#${Et})`}_makeShadingPattern(l){switch(typeof l=="string"&&(l=this.objs.get(l)),l[0]){case"RadialAxial":const d=`shading${M++}`,I=l[3];let Q;switch(l[1]){case"axial":const J=l[4],_t=l[5];Q=this.svgFactory.createElement("svg:linearGradient"),Q.setAttributeNS(null,"id",d),Q.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),Q.setAttributeNS(null,"x1",J[0]),Q.setAttributeNS(null,"y1",J[1]),Q.setAttributeNS(null,"x2",_t[0]),Q.setAttributeNS(null,"y2",_t[1]);break;case"radial":const at=l[4],Pt=l[5],Ct=l[6],j=l[7];Q=this.svgFactory.createElement("svg:radialGradient"),Q.setAttributeNS(null,"id",d),Q.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),Q.setAttributeNS(null,"cx",Pt[0]),Q.setAttributeNS(null,"cy",Pt[1]),Q.setAttributeNS(null,"r",j),Q.setAttributeNS(null,"fx",at[0]),Q.setAttributeNS(null,"fy",at[1]),Q.setAttributeNS(null,"fr",Ct);break;default:throw new Error(`Unknown RadialAxial type: ${l[1]}`)}for(const J of I){const _t=this.svgFactory.createElement("svg:stop");_t.setAttributeNS(null,"offset",J[0]),_t.setAttributeNS(null,"stop-color",J[1]),Q.append(_t)}return this.defs.append(Q),`url(#${d})`;case"Mesh":return(0,x.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${l[0]}`)}}setDash(l,d){this.current.dashArray=l,this.current.dashPhase=d}constructPath(l,d){const I=this.current;let Q=I.x,J=I.y,_t=[],at=0;for(const Pt of l)switch(Pt|0){case x.OPS.rectangle:Q=d[at++],J=d[at++];const Ct=d[at++],j=d[at++],ut=Q+Ct,Et=J+j;_t.push("M",w(Q),w(J),"L",w(ut),w(J),"L",w(ut),w(Et),"L",w(Q),w(Et),"Z");break;case x.OPS.moveTo:Q=d[at++],J=d[at++],_t.push("M",w(Q),w(J));break;case x.OPS.lineTo:Q=d[at++],J=d[at++],_t.push("L",w(Q),w(J));break;case x.OPS.curveTo:Q=d[at+4],J=d[at+5],_t.push("C",w(d[at]),w(d[at+1]),w(d[at+2]),w(d[at+3]),w(Q),w(J)),at+=6;break;case x.OPS.curveTo2:_t.push("C",w(Q),w(J),w(d[at]),w(d[at+1]),w(d[at+2]),w(d[at+3])),Q=d[at+2],J=d[at+3],at+=4;break;case x.OPS.curveTo3:Q=d[at+2],J=d[at+3],_t.push("C",w(d[at]),w(d[at+1]),w(Q),w(J),w(Q),w(J)),at+=4;break;case x.OPS.closePath:_t.push("Z");break}_t=_t.join(" "),I.path&&l.length>0&&l[0]!==x.OPS.rectangle&&l[0]!==x.OPS.moveTo?_t=I.path.getAttributeNS(null,"d")+_t:(I.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(I.path)),I.path.setAttributeNS(null,"d",_t),I.path.setAttributeNS(null,"fill","none"),I.element=I.path,I.setCurrentPoint(Q,J)}endPath(){const l=this.current;if(l.path=null,!this.pendingClip)return;if(!l.element){this.pendingClip=null;return}const d=`clippath${p++}`,I=this.svgFactory.createElement("svg:clipPath");I.setAttributeNS(null,"id",d),I.setAttributeNS(null,"transform",C(this.transformMatrix));const Q=l.element.cloneNode(!0);if(this.pendingClip==="evenodd"?Q.setAttributeNS(null,"clip-rule","evenodd"):Q.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,I.append(Q),this.defs.append(I),l.activeClipUrl){l.clipGroup=null;for(const J of this.extraStack)J.clipGroup=null;I.setAttributeNS(null,"clip-path",l.activeClipUrl)}l.activeClipUrl=`url(#${d})`,this.tgrp=null}clip(l){this.pendingClip=l}closePath(){const l=this.current;if(l.path){const d=`${l.path.getAttributeNS(null,"d")}Z`;l.path.setAttributeNS(null,"d",d)}}setLeading(l){this.current.leading=-l}setTextRise(l){this.current.textRise=l}setTextRenderingMode(l){this.current.textRenderingMode=l}setHScale(l){this.current.textHScale=l/100}setRenderingIntent(l){}setFlatness(l){}setGState(l){for(const[d,I]of l)switch(d){case"LW":this.setLineWidth(I);break;case"LC":this.setLineCap(I);break;case"LJ":this.setLineJoin(I);break;case"ML":this.setMiterLimit(I);break;case"D":this.setDash(I[0],I[1]);break;case"RI":this.setRenderingIntent(I);break;case"FL":this.setFlatness(I);break;case"Font":this.setFont(I);break;case"CA":this.setStrokeAlpha(I);break;case"ca":this.setFillAlpha(I);break;default:(0,x.warn)(`Unimplemented graphic state operator ${d}`);break}}fill(){const l=this.current;l.element&&(l.element.setAttributeNS(null,"fill",l.fillColor),l.element.setAttributeNS(null,"fill-opacity",l.fillAlpha),this.endPath())}stroke(){const l=this.current;l.element&&(this._setStrokeAttributes(l.element),l.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(l,d=1){const I=this.current;let Q=I.dashArray;d!==1&&Q.length>0&&(Q=Q.map(function(J){return d*J})),l.setAttributeNS(null,"stroke",I.strokeColor),l.setAttributeNS(null,"stroke-opacity",I.strokeAlpha),l.setAttributeNS(null,"stroke-miterlimit",w(I.miterLimit)),l.setAttributeNS(null,"stroke-linecap",I.lineCap),l.setAttributeNS(null,"stroke-linejoin",I.lineJoin),l.setAttributeNS(null,"stroke-width",w(d*I.lineWidth)+"px"),l.setAttributeNS(null,"stroke-dasharray",Q.map(w).join(" ")),l.setAttributeNS(null,"stroke-dashoffset",w(d*I.dashPhase)+"px")}eoFill(){var l;(l=this.current.element)==null||l.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var l;(l=this.current.element)==null||l.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const l=this.svgFactory.createElement("svg:rect");l.setAttributeNS(null,"x","0"),l.setAttributeNS(null,"y","0"),l.setAttributeNS(null,"width","1px"),l.setAttributeNS(null,"height","1px"),l.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(l)}paintImageXObject(l){const d=this.getObject(l);if(!d){(0,x.warn)(`Dependent image with object ID ${l} is not ready yet`);return}this.paintInlineImageXObject(d)}paintInlineImageXObject(l,d){const I=l.width,Q=l.height,J=H(l,this.forceDataSchema,!!d),_t=this.svgFactory.createElement("svg:rect");_t.setAttributeNS(null,"x","0"),_t.setAttributeNS(null,"y","0"),_t.setAttributeNS(null,"width",w(I)),_t.setAttributeNS(null,"height",w(Q)),this.current.element=_t,this.clip("nonzero");const at=this.svgFactory.createElement("svg:image");at.setAttributeNS(gt,"xlink:href",J),at.setAttributeNS(null,"x","0"),at.setAttributeNS(null,"y",w(-Q)),at.setAttributeNS(null,"width",w(I)+"px"),at.setAttributeNS(null,"height",w(Q)+"px"),at.setAttributeNS(null,"transform",`scale(${w(1/I)} ${w(-1/Q)})`),d?d.append(at):this._ensureTransformGroup().append(at)}paintImageMaskXObject(l){const d=this.getObject(l.data,l);if(d.bitmap){(0,x.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const I=this.current,Q=d.width,J=d.height,_t=I.fillColor;I.maskId=`mask${y++}`;const at=this.svgFactory.createElement("svg:mask");at.setAttributeNS(null,"id",I.maskId);const Pt=this.svgFactory.createElement("svg:rect");Pt.setAttributeNS(null,"x","0"),Pt.setAttributeNS(null,"y","0"),Pt.setAttributeNS(null,"width",w(Q)),Pt.setAttributeNS(null,"height",w(J)),Pt.setAttributeNS(null,"fill",_t),Pt.setAttributeNS(null,"mask",`url(#${I.maskId})`),this.defs.append(at),this._ensureTransformGroup().append(Pt),this.paintInlineImageXObject(d,at)}paintFormXObjectBegin(l,d){if(Array.isArray(l)&&l.length===6&&this.transform(l[0],l[1],l[2],l[3],l[4],l[5]),d){const I=d[2]-d[0],Q=d[3]-d[1],J=this.svgFactory.createElement("svg:rect");J.setAttributeNS(null,"x",d[0]),J.setAttributeNS(null,"y",d[1]),J.setAttributeNS(null,"width",w(I)),J.setAttributeNS(null,"height",w(Q)),this.current.element=J,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(l){const d=this.svgFactory.create(l.width,l.height),I=this.svgFactory.createElement("svg:defs");d.append(I),this.defs=I;const Q=this.svgFactory.createElement("svg:g");return Q.setAttributeNS(null,"transform",C(l.transform)),d.append(Q),this.svg=Q,d}_ensureClipGroup(){if(!this.current.clipGroup){const l=this.svgFactory.createElement("svg:g");l.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(l),this.current.clipGroup=l}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",C(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}o.SVGGraphics=k},($,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.XfaText=void 0;class X{static textContent(x){const q=[],Y={items:q,styles:Object.create(null)};function gt(z){var H;if(!z)return;let F=null;const m=z.name;if(m==="#text")F=z.value;else if(X.shouldBuildText(m))(H=z==null?void 0:z.attributes)!=null&&H.textContent?F=z.attributes.textContent:z.value&&(F=z.value);else return;if(F!==null&&q.push({str:F}),!!z.children)for(const W of z.children)gt(W)}return gt(x),Y}static shouldBuildText(x){return!(x==="textarea"||x==="input"||x==="option"||x==="select")}}o.XfaText=X},($,o,X)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TextLayerRenderTask=void 0,o.renderTextLayer=C,o.updateTextLayer=p;var r=X(1),x=X(6);const q=1e5,Y=30,gt=.8,z=new Map;function F(y,M){let k;if(M&&r.FeatureTest.isOffscreenCanvasSupported)k=new OffscreenCanvas(y,y).getContext("2d",{alpha:!1});else{const v=document.createElement("canvas");v.width=v.height=y,k=v.getContext("2d",{alpha:!1})}return k}function m(y,M){const k=z.get(y);if(k)return k;const v=F(Y,M);v.font=`${Y}px ${y}`;const l=v.measureText("");let d=l.fontBoundingBoxAscent,I=Math.abs(l.fontBoundingBoxDescent);if(d){const J=d/(d+I);return z.set(y,J),v.canvas.width=v.canvas.height=0,J}v.strokeStyle="red",v.clearRect(0,0,Y,Y),v.strokeText("g",0,0);let Q=v.getImageData(0,0,Y,Y).data;I=0;for(let J=Q.length-1-3;J>=0;J-=4)if(Q[J]>0){I=Math.ceil(J/4/Y);break}v.clearRect(0,0,Y,Y),v.strokeText("A",0,Y),Q=v.getImageData(0,0,Y,Y).data,d=0;for(let J=0,_t=Q.length;J<_t;J+=4)if(Q[J]>0){d=Y-Math.floor(J/4/Y);break}if(v.canvas.width=v.canvas.height=0,d){const J=d/(d+I);return z.set(y,J),J}return z.set(y,gt),gt}function H(y,M,k){const v=document.createElement("span"),l={angle:0,canvasWidth:0,hasText:M.str!=="",hasEOL:M.hasEOL,fontSize:0};y._textDivs.push(v);const d=r.Util.transform(y._transform,M.transform);let I=Math.atan2(d[1],d[0]);const Q=k[M.fontName];Q.vertical&&(I+=Math.PI/2);const J=Math.hypot(d[2],d[3]),_t=J*m(Q.fontFamily,y._isOffscreenCanvasSupported);let at,Pt;I===0?(at=d[4],Pt=d[5]-_t):(at=d[4]+_t*Math.sin(I),Pt=d[5]-_t*Math.cos(I));const Ct="calc(var(--scale-factor)*",j=v.style;y._container===y._rootContainer?(j.left=`${(100*at/y._pageWidth).toFixed(2)}%`,j.top=`${(100*Pt/y._pageHeight).toFixed(2)}%`):(j.left=`${Ct}${at.toFixed(2)}px)`,j.top=`${Ct}${Pt.toFixed(2)}px)`),j.fontSize=`${Ct}${J.toFixed(2)}px)`,j.fontFamily=Q.fontFamily,l.fontSize=J,v.setAttribute("role","presentation"),v.textContent=M.str,v.dir=M.dir,y._fontInspectorEnabled&&(v.dataset.fontName=M.fontName),I!==0&&(l.angle=I*(180/Math.PI));let ut=!1;if(M.str.length>1)ut=!0;else if(M.str!==" "&&M.transform[0]!==M.transform[3]){const Et=Math.abs(M.transform[0]),yt=Math.abs(M.transform[3]);Et!==yt&&Math.max(Et,yt)/Math.min(Et,yt)>1.5&&(ut=!0)}ut&&(l.canvasWidth=Q.vertical?M.height:M.width),y._textDivProperties.set(v,l),y._isReadableStream&&y._layoutText(v)}function W(y){const{div:M,scale:k,properties:v,ctx:l,prevFontSize:d,prevFontFamily:I}=y,{style:Q}=M;let J="";if(v.canvasWidth!==0&&v.hasText){const{fontFamily:_t}=Q,{canvasWidth:at,fontSize:Pt}=v;(d!==Pt||I!==_t)&&(l.font=`${Pt*k}px ${_t}`,y.prevFontSize=Pt,y.prevFontFamily=_t);const{width:Ct}=l.measureText(M.textContent);Ct>0&&(J=`scaleX(${at*k/Ct})`)}v.angle!==0&&(J=`rotate(${v.angle}deg) ${J}`),J.length>0&&(Q.transform=J)}function L(y){if(y._canceled)return;const M=y._textDivs,k=y._capability;if(M.length>q){k.resolve();return}if(!y._isReadableStream)for(const l of M)y._layoutText(l);k.resolve()}class w{constructor({textContentSource:M,container:k,viewport:v,textDivs:l,textDivProperties:d,textContentItemsStr:I,isOffscreenCanvasSupported:Q}){var Ct;this._textContentSource=M,this._isReadableStream=M instanceof ReadableStream,this._container=this._rootContainer=k,this._textDivs=l||[],this._textContentItemsStr=I||[],this._isOffscreenCanvasSupported=Q,this._fontInspectorEnabled=!!((Ct=globalThis.FontInspector)!=null&&Ct.enabled),this._reader=null,this._textDivProperties=d||new WeakMap,this._canceled=!1,this._capability=new r.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:v.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:F(0,Q)};const{pageWidth:J,pageHeight:_t,pageX:at,pageY:Pt}=v.rawDims;this._transform=[1,0,0,-1,-at,Pt+_t],this._pageWidth=J,this._pageHeight=_t,(0,x.setLayerDimensions)(k,v),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new r.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new r.AbortException("TextLayer task cancelled."))}_processItems(M,k){for(const v of M){if(v.str===void 0){if(v.type==="beginMarkedContentProps"||v.type==="beginMarkedContent"){const l=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),v.id!==null&&this._container.setAttribute("id",`${v.id}`),l.append(this._container)}else v.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(v.str),H(this,v,k)}}_layoutText(M){const k=this._layoutTextParams.properties=this._textDivProperties.get(M);if(this._layoutTextParams.div=M,W(this._layoutTextParams),k.hasText&&this._container.append(M),k.hasEOL){const v=document.createElement("br");v.setAttribute("role","presentation"),this._container.append(v)}}_render(){const M=new r.PromiseCapability;let k=Object.create(null);if(this._isReadableStream){const v=()=>{this._reader.read().then(({value:l,done:d})=>{if(d){M.resolve();return}Object.assign(k,l.styles),this._processItems(l.items,k),v()},M.reject)};this._reader=this._textContentSource.getReader(),v()}else if(this._textContentSource){const{items:v,styles:l}=this._textContentSource;this._processItems(v,l),M.resolve()}else throw new Error('No "textContentSource" parameter specified.');M.promise.then(()=>{k=null,L(this)},this._capability.reject)}}o.TextLayerRenderTask=w;function C(y){!y.textContentSource&&(y.textContent||y.textContentStream)&&((0,x.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),y.textContentSource=y.textContent||y.textContentStream);const{container:M,viewport:k}=y,v=getComputedStyle(M),l=v.getPropertyValue("visibility"),d=parseFloat(v.getPropertyValue("--scale-factor"));l==="visible"&&(!d||Math.abs(d-k.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const I=new w(y);return I._render(),I}function p({container:y,viewport:M,textDivs:k,textDivProperties:v,isOffscreenCanvasSupported:l,mustRotate:d=!0,mustRescale:I=!0}){if(d&&(0,x.setLayerDimensions)(y,{rotation:M.rotation}),I){const Q=F(0,l),_t={prevFontSize:null,prevFontFamily:null,div:null,scale:M.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:Q};for(const at of k)_t.properties=v.get(at),_t.div=at,W(_t)}}},($,o,X)=>{var m,H,W,L,w,C,p,y,M,k,v,hs,d,_i,Q,ds,_t,us;Object.defineProperty(o,"__esModule",{value:!0}),o.AnnotationEditorLayer=void 0;var r=X(1),x=X(4),q=X(28),Y=X(33),gt=X(6),z=X(34);const Pt=class Pt{constructor({uiManager:j,pageIndex:ut,div:Et,accessibilityManager:yt,annotationLayer:et,viewport:bt,l10n:Rt}){U(this,v);U(this,d);U(this,Q);U(this,_t);U(this,m,void 0);U(this,H,!1);U(this,W,null);U(this,L,this.pointerup.bind(this));U(this,w,this.pointerdown.bind(this));U(this,C,new Map);U(this,p,!1);U(this,y,!1);U(this,M,!1);U(this,k,void 0);const Ut=[q.FreeTextEditor,Y.InkEditor,z.StampEditor];if(!Pt._initialized){Pt._initialized=!0;for(const $t of Ut)$t.initialize(Rt)}j.registerEditorTypes(Ut),ot(this,k,j),this.pageIndex=ut,this.div=Et,ot(this,m,yt),ot(this,W,et),this.viewport=bt,t(this,k).addLayer(this)}get isEmpty(){return t(this,C).size===0}updateToolbar(j){t(this,k).updateToolbar(j)}updateMode(j=t(this,k).getMode()){Z(this,_t,us).call(this),j===r.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),j!==r.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",j===r.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",j===r.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",j===r.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(j){if(!j&&t(this,k).getMode()!==r.AnnotationEditorType.INK)return;if(!j){for(const Et of t(this,C).values())if(Et.isEmpty()){Et.setInBackground();return}}Z(this,d,_i).call(this,{offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(j){t(this,k).setEditingState(j)}addCommands(j){t(this,k).addCommands(j)}enable(){this.div.style.pointerEvents="auto";const j=new Set;for(const Et of t(this,C).values())Et.enableEditing(),Et.annotationElementId&&j.add(Et.annotationElementId);if(!t(this,W))return;const ut=t(this,W).getEditableAnnotations();for(const Et of ut){if(Et.hide(),t(this,k).isDeletedAnnotationElement(Et.data.id)||j.has(Et.data.id))continue;const yt=this.deserialize(Et);yt&&(this.addOrRebuild(yt),yt.enableEditing())}}disable(){var ut;ot(this,M,!0),this.div.style.pointerEvents="none";const j=new Set;for(const Et of t(this,C).values()){if(Et.disableEditing(),!Et.annotationElementId||Et.serialize()!==null){j.add(Et.annotationElementId);continue}(ut=this.getEditableAnnotation(Et.annotationElementId))==null||ut.show(),Et.remove()}if(t(this,W)){const Et=t(this,W).getEditableAnnotations();for(const yt of Et){const{id:et}=yt.data;j.has(et)||t(this,k).isDeletedAnnotationElement(et)||yt.show()}}Z(this,_t,us).call(this),this.isEmpty&&(this.div.hidden=!0),ot(this,M,!1)}getEditableAnnotation(j){var ut;return((ut=t(this,W))==null?void 0:ut.getEditableAnnotation(j))||null}setActiveEditor(j){t(this,k).getActive()!==j&&t(this,k).setActiveEditor(j)}enableClick(){this.div.addEventListener("pointerdown",t(this,w)),this.div.addEventListener("pointerup",t(this,L))}disableClick(){this.div.removeEventListener("pointerdown",t(this,w)),this.div.removeEventListener("pointerup",t(this,L))}attach(j){t(this,C).set(j.id,j);const{annotationElementId:ut}=j;ut&&t(this,k).isDeletedAnnotationElement(ut)&&t(this,k).removeDeletedAnnotationElement(j)}detach(j){var ut;t(this,C).delete(j.id),(ut=t(this,m))==null||ut.removePointerInTextLayer(j.contentDiv),!t(this,M)&&j.annotationElementId&&t(this,k).addDeletedAnnotationElement(j)}remove(j){this.detach(j),t(this,k).removeEditor(j),j.div.contains(document.activeElement)&&setTimeout(()=>{t(this,k).focusMainContainer()},0),j.div.remove(),j.isAttachedToDOM=!1,t(this,y)||this.addInkEditorIfNeeded(!1)}changeParent(j){var ut;j.parent!==this&&(j.annotationElementId&&(t(this,k).addDeletedAnnotationElement(j.annotationElementId),x.AnnotationEditor.deleteAnnotationElement(j),j.annotationElementId=null),this.attach(j),(ut=j.parent)==null||ut.detach(j),j.setParent(this),j.div&&j.isAttachedToDOM&&(j.div.remove(),this.div.append(j.div)))}add(j){if(this.changeParent(j),t(this,k).addEditor(j),this.attach(j),!j.isAttachedToDOM){const ut=j.render();this.div.append(ut),j.isAttachedToDOM=!0}j.fixAndSetPosition(),j.onceAdded(),t(this,k).addToAnnotationStorage(j)}moveEditorInDOM(j){var Et;if(!j.isAttachedToDOM)return;const{activeElement:ut}=document;j.div.contains(ut)&&(j._focusEventsAllowed=!1,setTimeout(()=>{j.div.contains(document.activeElement)?j._focusEventsAllowed=!0:(j.div.addEventListener("focusin",()=>{j._focusEventsAllowed=!0},{once:!0}),ut.focus())},0)),j._structTreeParentId=(Et=t(this,m))==null?void 0:Et.moveElementInDOM(this.div,j.div,j.contentDiv,!0)}addOrRebuild(j){j.needsToBeRebuilt()?j.rebuild():this.add(j)}addUndoableEditor(j){const ut=()=>j._uiManager.rebuild(j),Et=()=>{j.remove()};this.addCommands({cmd:ut,undo:Et,mustExec:!1})}getNextId(){return t(this,k).getId()}pasteEditor(j,ut){t(this,k).updateToolbar(j),t(this,k).updateMode(j);const{offsetX:Et,offsetY:yt}=Z(this,Q,ds).call(this),et=this.getNextId(),bt=Z(this,v,hs).call(this,{parent:this,id:et,x:Et,y:yt,uiManager:t(this,k),isCentered:!0,...ut});bt&&this.add(bt)}deserialize(j){switch(j.annotationType??j.annotationEditorType){case r.AnnotationEditorType.FREETEXT:return q.FreeTextEditor.deserialize(j,this,t(this,k));case r.AnnotationEditorType.INK:return Y.InkEditor.deserialize(j,this,t(this,k));case r.AnnotationEditorType.STAMP:return z.StampEditor.deserialize(j,this,t(this,k))}return null}addNewEditor(){Z(this,d,_i).call(this,Z(this,Q,ds).call(this),!0)}setSelected(j){t(this,k).setSelected(j)}toggleSelected(j){t(this,k).toggleSelected(j)}isSelected(j){return t(this,k).isSelected(j)}unselect(j){t(this,k).unselect(j)}pointerup(j){const{isMac:ut}=r.FeatureTest.platform;if(!(j.button!==0||j.ctrlKey&&ut)&&j.target===this.div&&t(this,p)){if(ot(this,p,!1),!t(this,H)){ot(this,H,!0);return}if(t(this,k).getMode()===r.AnnotationEditorType.STAMP){t(this,k).unselectAll();return}Z(this,d,_i).call(this,j,!1)}}pointerdown(j){if(t(this,p)){ot(this,p,!1);return}const{isMac:ut}=r.FeatureTest.platform;if(j.button!==0||j.ctrlKey&&ut||j.target!==this.div)return;ot(this,p,!0);const Et=t(this,k).getActive();ot(this,H,!Et||Et.isEmpty())}findNewParent(j,ut,Et){const yt=t(this,k).findParent(ut,Et);return yt===null||yt===this?!1:(yt.changeParent(j),!0)}destroy(){var j,ut;((j=t(this,k).getActive())==null?void 0:j.parent)===this&&(t(this,k).commitOrRemove(),t(this,k).setActiveEditor(null));for(const Et of t(this,C).values())(ut=t(this,m))==null||ut.removePointerInTextLayer(Et.contentDiv),Et.setParent(null),Et.isAttachedToDOM=!1,Et.div.remove();this.div=null,t(this,C).clear(),t(this,k).removeLayer(this)}render({viewport:j}){this.viewport=j,(0,gt.setLayerDimensions)(this.div,j);for(const ut of t(this,k).getEditors(this.pageIndex))this.add(ut);this.updateMode()}update({viewport:j}){t(this,k).commitOrRemove(),this.viewport=j,(0,gt.setLayerDimensions)(this.div,{rotation:j.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:j,pageHeight:ut}=this.viewport.rawDims;return[j,ut]}};m=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakMap,w=new WeakMap,C=new WeakMap,p=new WeakMap,y=new WeakMap,M=new WeakMap,k=new WeakMap,v=new WeakSet,hs=function(j){switch(t(this,k).getMode()){case r.AnnotationEditorType.FREETEXT:return new q.FreeTextEditor(j);case r.AnnotationEditorType.INK:return new Y.InkEditor(j);case r.AnnotationEditorType.STAMP:return new z.StampEditor(j)}return null},d=new WeakSet,_i=function(j,ut){const Et=this.getNextId(),yt=Z(this,v,hs).call(this,{parent:this,id:Et,x:j.offsetX,y:j.offsetY,uiManager:t(this,k),isCentered:ut});return yt&&this.add(yt),yt},Q=new WeakSet,ds=function(){const{x:j,y:ut,width:Et,height:yt}=this.div.getBoundingClientRect(),et=Math.max(0,j),bt=Math.max(0,ut),Rt=Math.min(window.innerWidth,j+Et),Ut=Math.min(window.innerHeight,ut+yt),$t=(et+Rt)/2-j,P=(bt+Ut)/2-ut,[i,a]=this.viewport.rotation%180===0?[$t,P]:[P,$t];return{offsetX:i,offsetY:a}},_t=new WeakSet,us=function(){ot(this,y,!0);for(const j of t(this,C).values())j.isEmpty()&&j.remove();ot(this,y,!1)},oe(Pt,"_initialized",!1);let F=Pt;o.AnnotationEditorLayer=F},($,o,X)=>{var z,F,m,H,W,L,w,C,p,y,Sn,k,En,l,wn,I,Je,J,fs,at,Cn,Ct,ps;Object.defineProperty(o,"__esModule",{value:!0}),o.FreeTextEditor=void 0;var r=X(1),x=X(5),q=X(4),Y=X(29);const ut=class ut extends q.AnnotationEditor{constructor(et){super({...et,name:"freeTextEditor"});U(this,y);U(this,k);U(this,l);U(this,I);U(this,J);U(this,at);U(this,Ct);U(this,z,this.editorDivBlur.bind(this));U(this,F,this.editorDivFocus.bind(this));U(this,m,this.editorDivInput.bind(this));U(this,H,this.editorDivKeydown.bind(this));U(this,W,void 0);U(this,L,"");U(this,w,`${this.id}-editor`);U(this,C,void 0);U(this,p,null);ot(this,W,et.color||ut._defaultColor||q.AnnotationEditor._defaultLineColor),ot(this,C,et.fontSize||ut._defaultFontSize)}static get _keyboardManager(){const et=ut.prototype,bt=$t=>$t.isEmpty(),Rt=x.AnnotationEditorUIManager.TRANSLATE_SMALL,Ut=x.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,r.shadow)(this,"_keyboardManager",new x.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],et.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],et.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],et._translateEmpty,{args:[-Rt,0],checker:bt}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],et._translateEmpty,{args:[-Ut,0],checker:bt}],[["ArrowRight","mac+ArrowRight"],et._translateEmpty,{args:[Rt,0],checker:bt}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],et._translateEmpty,{args:[Ut,0],checker:bt}],[["ArrowUp","mac+ArrowUp"],et._translateEmpty,{args:[0,-Rt],checker:bt}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],et._translateEmpty,{args:[0,-Ut],checker:bt}],[["ArrowDown","mac+ArrowDown"],et._translateEmpty,{args:[0,Rt],checker:bt}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],et._translateEmpty,{args:[0,Ut],checker:bt}]]))}static initialize(et){q.AnnotationEditor.initialize(et,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const bt=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(bt.getPropertyValue("--freetext-padding"))}static updateDefaultParams(et,bt){switch(et){case r.AnnotationEditorParamsType.FREETEXT_SIZE:ut._defaultFontSize=bt;break;case r.AnnotationEditorParamsType.FREETEXT_COLOR:ut._defaultColor=bt;break}}updateParams(et,bt){switch(et){case r.AnnotationEditorParamsType.FREETEXT_SIZE:Z(this,y,Sn).call(this,bt);break;case r.AnnotationEditorParamsType.FREETEXT_COLOR:Z(this,k,En).call(this,bt);break}}static get defaultPropertiesToUpdate(){return[[r.AnnotationEditorParamsType.FREETEXT_SIZE,ut._defaultFontSize],[r.AnnotationEditorParamsType.FREETEXT_COLOR,ut._defaultColor||q.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[r.AnnotationEditorParamsType.FREETEXT_SIZE,t(this,C)],[r.AnnotationEditorParamsType.FREETEXT_COLOR,t(this,W)]]}_translateEmpty(et,bt){this._uiManager.translateSelectedEditors(et,bt,!0)}getInitialTranslation(){const et=this.parentScale;return[-ut._internalPadding*et,-(ut._internalPadding+t(this,C))*et]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(r.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",t(this,H)),this.editorDiv.addEventListener("focus",t(this,F)),this.editorDiv.addEventListener("blur",t(this,z)),this.editorDiv.addEventListener("input",t(this,m)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",t(this,w)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",t(this,H)),this.editorDiv.removeEventListener("focus",t(this,F)),this.editorDiv.removeEventListener("blur",t(this,z)),this.editorDiv.removeEventListener("input",t(this,m)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(et){this._focusEventsAllowed&&(super.focusin(et),et.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var et;if(this.width){Z(this,Ct,ps).call(this);return}this.enableEditMode(),this.editorDiv.focus(),(et=this._initialOptions)!=null&&et.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const et=t(this,L),bt=ot(this,L,Z(this,l,wn).call(this).trimEnd());if(et===bt)return;const Rt=Ut=>{if(ot(this,L,Ut),!Ut){this.remove();return}Z(this,J,fs).call(this),this._uiManager.rebuild(this),Z(this,I,Je).call(this)};this.addCommands({cmd:()=>{Rt(bt)},undo:()=>{Rt(et)},mustExec:!1}),Z(this,I,Je).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(et){this.enterInEditMode()}keydown(et){et.target===this.div&&et.key==="Enter"&&(this.enterInEditMode(),et.preventDefault())}editorDivKeydown(et){ut._keyboardManager.exec(this,et)}editorDivFocus(et){this.isEditing=!0}editorDivBlur(et){this.isEditing=!1}editorDivInput(et){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let et,bt;this.width&&(et=this.x,bt=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",t(this,w)),this.enableEditing(),q.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(Ut=>{var $t;return($t=this.editorDiv)==null?void 0:$t.setAttribute("aria-label",Ut)}),q.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(Ut=>{var $t;return($t=this.editorDiv)==null?void 0:$t.setAttribute("default-content",Ut)}),this.editorDiv.contentEditable=!0;const{style:Rt}=this.editorDiv;if(Rt.fontSize=`calc(${t(this,C)}px * var(--scale-factor))`,Rt.color=t(this,W),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,x.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[Ut,$t]=this.parentDimensions;if(this.annotationElementId){const{position:P}=t(this,p);let[i,a]=this.getInitialTranslation();[i,a]=this.pageTranslationToScreen(i,a);const[s,c]=this.pageDimensions,[u,A]=this.pageTranslation;let R,B;switch(this.rotation){case 0:R=et+(P[0]-u)/s,B=bt+this.height-(P[1]-A)/c;break;case 90:R=et+(P[0]-u)/s,B=bt-(P[1]-A)/c,[i,a]=[a,-i];break;case 180:R=et-this.width+(P[0]-u)/s,B=bt-(P[1]-A)/c,[i,a]=[-i,-a];break;case 270:R=et+(P[0]-u-this.height*c)/s,B=bt+(P[1]-A-this.width*s)/c,[i,a]=[-a,i];break}this.setAt(R*Ut,B*$t,i,a)}else this.setAt(et*Ut,bt*$t,this.width*Ut,this.height*$t);Z(this,J,fs).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(et,bt,Rt){let Ut=null;if(et instanceof Y.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:P,fontColor:i},rect:a,rotation:s,id:c},textContent:u,textPosition:A,parent:{page:{pageNumber:R}}}=et;if(!u||u.length===0)return null;Ut=et={annotationType:r.AnnotationEditorType.FREETEXT,color:Array.from(i),fontSize:P,value:u.join(`
`),position:A,pageIndex:R-1,rect:a,rotation:s,id:c,deleted:!1}}const $t=super.deserialize(et,bt,Rt);return ot($t,C,et.fontSize),ot($t,W,r.Util.makeHexColor(...et.color)),ot($t,L,et.value),$t.annotationElementId=et.id||null,ot($t,p,Ut),$t}serialize(et=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const bt=ut._internalPadding*this.parentScale,Rt=this.getRect(bt,bt),Ut=q.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:t(this,W)),$t={annotationType:r.AnnotationEditorType.FREETEXT,color:Ut,fontSize:t(this,C),value:t(this,L),pageIndex:this.pageIndex,rect:Rt,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return et?$t:this.annotationElementId&&!Z(this,at,Cn).call(this,$t)?null:($t.id=this.annotationElementId,$t)}};z=new WeakMap,F=new WeakMap,m=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakMap,w=new WeakMap,C=new WeakMap,p=new WeakMap,y=new WeakSet,Sn=function(et){const bt=Ut=>{this.editorDiv.style.fontSize=`calc(${Ut}px * var(--scale-factor))`,this.translate(0,-(Ut-t(this,C))*this.parentScale),ot(this,C,Ut),Z(this,I,Je).call(this)},Rt=t(this,C);this.addCommands({cmd:()=>{bt(et)},undo:()=>{bt(Rt)},mustExec:!0,type:r.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},k=new WeakSet,En=function(et){const bt=t(this,W);this.addCommands({cmd:()=>{ot(this,W,this.editorDiv.style.color=et)},undo:()=>{ot(this,W,this.editorDiv.style.color=bt)},mustExec:!0,type:r.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},l=new WeakSet,wn=function(){const et=this.editorDiv.getElementsByTagName("div");if(et.length===0)return this.editorDiv.innerText;const bt=[];for(const Rt of et)bt.push(Rt.innerText.replace(/\r\n?|\n/,""));return bt.join(`
`)},I=new WeakSet,Je=function(){const[et,bt]=this.parentDimensions;let Rt;if(this.isAttachedToDOM)Rt=this.div.getBoundingClientRect();else{const{currentLayer:Ut,div:$t}=this,P=$t.style.display;$t.style.display="hidden",Ut.div.append(this.div),Rt=$t.getBoundingClientRect(),$t.remove(),$t.style.display=P}this.rotation%180===this.parentRotation%180?(this.width=Rt.width/et,this.height=Rt.height/bt):(this.width=Rt.height/et,this.height=Rt.width/bt),this.fixAndSetPosition()},J=new WeakSet,fs=function(){if(this.editorDiv.replaceChildren(),!!t(this,L))for(const et of t(this,L).split(`
`)){const bt=document.createElement("div");bt.append(et?document.createTextNode(et):document.createElement("br")),this.editorDiv.append(bt)}},at=new WeakSet,Cn=function(et){const{value:bt,fontSize:Rt,color:Ut,rect:$t,pageIndex:P}=t(this,p);return et.value!==bt||et.fontSize!==Rt||et.rect.some((i,a)=>Math.abs(i-$t[a])>=1)||et.color.some((i,a)=>i!==Ut[a])||et.pageIndex!==P},Ct=new WeakSet,ps=function(et=!1){if(!this.annotationElementId)return;if(Z(this,I,Je).call(this),!et&&(this.width===0||this.height===0)){setTimeout(()=>Z(this,Ct,ps).call(this,!0),0);return}const bt=ut._internalPadding*this.parentScale;t(this,p).rect=this.getRect(bt,bt)},oe(ut,"_freeTextDefaultContent",""),oe(ut,"_internalPadding",0),oe(ut,"_defaultColor",null),oe(ut,"_defaultFontSize",10),oe(ut,"_type","freetext");let gt=ut;o.FreeTextEditor=gt},($,o,X)=>{var a,c,Pe,A,Tn,B,ct,nt,ft,mt,Mt,At,Bt,Vt,kt,jt,St,it,st,vt,Ft,Ot,te,xn,Jt,Si,pt,gs,V,ms,S,T,rt,dt,qt,ie,K,bs,Nt,Dt,Xt,Gt,Pn,xt,As;Object.defineProperty(o,"__esModule",{value:!0}),o.StampAnnotationElement=o.InkAnnotationElement=o.FreeTextAnnotationElement=o.AnnotationLayer=void 0;var r=X(1),x=X(6),q=X(3),Y=X(30),gt=X(31),z=X(32);const F=1e3,m=9,H=new WeakSet;function W(Wt){return{width:Wt[2]-Wt[0],height:Wt[3]-Wt[1]}}class L{static create(D){switch(D.data.annotationType){case r.AnnotationType.LINK:return new C(D);case r.AnnotationType.TEXT:return new p(D);case r.AnnotationType.WIDGET:switch(D.data.fieldType){case"Tx":return new M(D);case"Btn":return D.data.radioButton?new l(D):D.data.checkBox?new v(D):new d(D);case"Ch":return new I(D);case"Sig":return new k(D)}return new y(D);case r.AnnotationType.POPUP:return new Q(D);case r.AnnotationType.FREETEXT:return new _t(D);case r.AnnotationType.LINE:return new at(D);case r.AnnotationType.SQUARE:return new Pt(D);case r.AnnotationType.CIRCLE:return new Ct(D);case r.AnnotationType.POLYLINE:return new j(D);case r.AnnotationType.CARET:return new Et(D);case r.AnnotationType.INK:return new yt(D);case r.AnnotationType.POLYGON:return new ut(D);case r.AnnotationType.HIGHLIGHT:return new et(D);case r.AnnotationType.UNDERLINE:return new bt(D);case r.AnnotationType.SQUIGGLY:return new Rt(D);case r.AnnotationType.STRIKEOUT:return new Ut(D);case r.AnnotationType.STAMP:return new $t(D);case r.AnnotationType.FILEATTACHMENT:return new P(D);default:return new w(D)}}}const s=class s{constructor(D,{isRenderable:e=!1,ignoreBorder:g=!1,createQuadrilaterals:N=!1}={}){U(this,a,!1);this.isRenderable=e,this.data=D.data,this.layer=D.layer,this.linkService=D.linkService,this.downloadManager=D.downloadManager,this.imageResourcesPath=D.imageResourcesPath,this.renderForms=D.renderForms,this.svgFactory=D.svgFactory,this.annotationStorage=D.annotationStorage,this.enableScripting=D.enableScripting,this.hasJSActions=D.hasJSActions,this._fieldObjects=D.fieldObjects,this.parent=D.parent,e&&(this.container=this._createContainer(g)),N&&this._createQuadrilaterals()}static _hasPopupData({titleObj:D,contentsObj:e,richText:g}){return!!(D!=null&&D.str||e!=null&&e.str||g!=null&&g.str)}get hasPopupData(){return s._hasPopupData(this.data)}_createContainer(D){const{data:e,parent:{page:g,viewport:N}}=this,G=document.createElement("section");G.setAttribute("data-annotation-id",e.id),this instanceof y||(G.tabIndex=F),G.style.zIndex=this.parent.zIndex++,this.data.popupRef&&G.setAttribute("aria-haspopup","dialog"),e.noRotate&&G.classList.add("norotate");const{pageWidth:tt,pageHeight:ht,pageX:wt,pageY:Lt}=N.rawDims;if(!e.rect||this instanceof Q){const{rotation:Yt}=e;return!e.hasOwnCanvas&&Yt!==0&&this.setRotation(Yt,G),G}const{width:It,height:Qt}=W(e.rect),Ht=r.Util.normalizeRect([e.rect[0],g.view[3]-e.rect[1]+g.view[1],e.rect[2],g.view[3]-e.rect[3]+g.view[1]]);if(!D&&e.borderStyle.width>0){G.style.borderWidth=`${e.borderStyle.width}px`;const Yt=e.borderStyle.horizontalCornerRadius,ee=e.borderStyle.verticalCornerRadius;if(Yt>0||ee>0){const ae=`calc(${Yt}px * var(--scale-factor)) / calc(${ee}px * var(--scale-factor))`;G.style.borderRadius=ae}else if(this instanceof l){const ae=`calc(${It}px * var(--scale-factor)) / calc(${Qt}px * var(--scale-factor))`;G.style.borderRadius=ae}switch(e.borderStyle.style){case r.AnnotationBorderStyleType.SOLID:G.style.borderStyle="solid";break;case r.AnnotationBorderStyleType.DASHED:G.style.borderStyle="dashed";break;case r.AnnotationBorderStyleType.BEVELED:(0,r.warn)("Unimplemented border style: beveled");break;case r.AnnotationBorderStyleType.INSET:(0,r.warn)("Unimplemented border style: inset");break;case r.AnnotationBorderStyleType.UNDERLINE:G.style.borderBottomStyle="solid";break}const re=e.borderColor||null;re?(ot(this,a,!0),G.style.borderColor=r.Util.makeHexColor(re[0]|0,re[1]|0,re[2]|0)):G.style.borderWidth=0}G.style.left=`${100*(Ht[0]-wt)/tt}%`,G.style.top=`${100*(Ht[1]-Lt)/ht}%`;const{rotation:zt}=e;return e.hasOwnCanvas||zt===0?(G.style.width=`${100*It/tt}%`,G.style.height=`${100*Qt/ht}%`):this.setRotation(zt,G),G}setRotation(D,e=this.container){if(!this.data.rect)return;const{pageWidth:g,pageHeight:N}=this.parent.viewport.rawDims,{width:G,height:tt}=W(this.data.rect);let ht,wt;D%180===0?(ht=100*G/g,wt=100*tt/N):(ht=100*tt/g,wt=100*G/N),e.style.width=`${ht}%`,e.style.height=`${wt}%`,e.setAttribute("data-main-rotation",(360-D)%360)}get _commonActions(){const D=(e,g,N)=>{const G=N.detail[e],tt=G[0],ht=G.slice(1);N.target.style[g]=Y.ColorConverters[`${tt}_HTML`](ht),this.annotationStorage.setValue(this.data.id,{[g]:Y.ColorConverters[`${tt}_rgb`](ht)})};return(0,r.shadow)(this,"_commonActions",{display:e=>{const{display:g}=e.detail,N=g%2===1;this.container.style.visibility=N?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:N,noPrint:g===1||g===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:g}=e.detail;this.container.style.visibility=g?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:g,noView:g})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{D("bgColor","backgroundColor",e)},fillColor:e=>{D("fillColor","backgroundColor",e)},fgColor:e=>{D("fgColor","color",e)},textColor:e=>{D("textColor","color",e)},borderColor:e=>{D("borderColor","borderColor",e)},strokeColor:e=>{D("strokeColor","borderColor",e)},rotation:e=>{const g=e.detail.rotation;this.setRotation(g),this.annotationStorage.setValue(this.data.id,{rotation:g})}})}_dispatchEventFromSandbox(D,e){const g=this._commonActions;for(const N of Object.keys(e.detail)){const G=D[N]||g[N];G==null||G(e)}}_setDefaultPropertiesFromJS(D){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const g=this._commonActions;for(const[N,G]of Object.entries(e)){const tt=g[N];if(tt){const ht={detail:{[N]:G},target:D};tt(ht),delete e[N]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:D}=this.data;if(!D)return;const[e,g,N,G]=this.data.rect;if(D.length===1){const[,{x:ee,y:re},{x:ae,y:ce}]=D[0];if(N===ee&&G===re&&e===ae&&g===ce)return}const{style:tt}=this.container;let ht;if(t(this,a)){const{borderColor:ee,borderWidth:re}=tt;tt.borderWidth=0,ht=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${ee}" stroke-width="${re}">`],this.container.classList.add("hasBorder")}const wt=N-e,Lt=G-g,{svgFactory:It}=this,Qt=It.createElement("svg");Qt.classList.add("quadrilateralsContainer"),Qt.setAttribute("width",0),Qt.setAttribute("height",0);const Ht=It.createElement("defs");Qt.append(Ht);const zt=It.createElement("clipPath"),Yt=`clippath_${this.data.id}`;zt.setAttribute("id",Yt),zt.setAttribute("clipPathUnits","objectBoundingBox"),Ht.append(zt);for(const[,{x:ee,y:re},{x:ae,y:ce}]of D){const le=It.createElement("rect"),ge=(ae-e)/wt,me=(G-re)/Lt,_e=(ee-ae)/wt,De=(re-ce)/Lt;le.setAttribute("x",ge),le.setAttribute("y",me),le.setAttribute("width",_e),le.setAttribute("height",De),zt.append(le),ht==null||ht.push(`<rect vector-effect="non-scaling-stroke" x="${ge}" y="${me}" width="${_e}" height="${De}"/>`)}t(this,a)&&(ht.push("</g></svg>')"),tt.backgroundImage=ht.join("")),this.container.append(Qt),this.container.style.clipPath=`url(#${Yt})`}_createPopup(){const{container:D,data:e}=this;D.setAttribute("aria-haspopup","dialog");const g=new Q({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]});this.parent.div.append(g.render())}render(){(0,r.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(D,e=null){const g=[];if(this._fieldObjects){const N=this._fieldObjects[D];if(N)for(const{page:G,id:tt,exportValues:ht}of N){if(G===-1||tt===e)continue;const wt=typeof ht=="string"?ht:null,Lt=document.querySelector(`[data-element-id="${tt}"]`);if(Lt&&!H.has(Lt)){(0,r.warn)(`_getElementsByName - element not allowed: ${tt}`);continue}g.push({id:tt,exportValue:wt,domElement:Lt})}return g}for(const N of document.getElementsByName(D)){const{exportValue:G}=N,tt=N.getAttribute("data-element-id");tt!==e&&H.has(N)&&g.push({id:tt,exportValue:G,domElement:N})}return g}show(){var D;this.container&&(this.container.hidden=!1),(D=this.popup)==null||D.maybeShow()}hide(){var D;this.container&&(this.container.hidden=!0),(D=this.popup)==null||D.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const D=this.getElementsToTriggerPopup();if(Array.isArray(D))for(const e of D)e.classList.add("highlightArea");else D.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:D,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{var g;(g=this.linkService.eventBus)==null||g.dispatch("switchannotationeditormode",{source:this,mode:D,editId:e})})}};a=new WeakMap;let w=s;class C extends w{constructor(e,g=null){super(e,{isRenderable:!0,ignoreBorder:!!(g!=null&&g.ignoreBorder),createQuadrilaterals:!0});U(this,c);U(this,A);this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:g}=this,N=document.createElement("a");N.setAttribute("data-element-id",e.id);let G=!1;return e.url?(g.addLinkAttributes(N,e.url,e.newWindow),G=!0):e.action?(this._bindNamedAction(N,e.action),G=!0):e.attachment?(this._bindAttachment(N,e.attachment),G=!0):e.setOCGState?(Z(this,A,Tn).call(this,N,e.setOCGState),G=!0):e.dest?(this._bindLink(N,e.dest),G=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(N,e),G=!0),e.resetForm?(this._bindResetFormAction(N,e.resetForm),G=!0):this.isTooltipOnly&&!G&&(this._bindLink(N,""),G=!0)),this.container.classList.add("linkAnnotation"),G&&this.container.append(N),this.container}_bindLink(e,g){e.href=this.linkService.getDestinationHash(g),e.onclick=()=>(g&&this.linkService.goToDestination(g),!1),(g||g==="")&&Z(this,c,Pe).call(this)}_bindNamedAction(e,g){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(g),!1),Z(this,c,Pe).call(this)}_bindAttachment(e,g){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>{var N;return(N=this.downloadManager)==null||N.openOrDownloadData(this.container,g.content,g.filename),!1},Z(this,c,Pe).call(this)}_bindJSAction(e,g){e.href=this.linkService.getAnchorUrl("");const N=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const G of Object.keys(g.actions)){const tt=N.get(G);tt&&(e[tt]=()=>{var ht;return(ht=this.linkService.eventBus)==null||ht.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g.id,name:G}}),!1})}e.onclick||(e.onclick=()=>!1),Z(this,c,Pe).call(this)}_bindResetFormAction(e,g){const N=e.onclick;if(N||(e.href=this.linkService.getAnchorUrl("")),Z(this,c,Pe).call(this),!this._fieldObjects){(0,r.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),N||(e.onclick=()=>!1);return}e.onclick=()=>{var Qt;N==null||N();const{fields:G,refs:tt,include:ht}=g,wt=[];if(G.length!==0||tt.length!==0){const Ht=new Set(tt);for(const zt of G){const Yt=this._fieldObjects[zt]||[];for(const{id:ee}of Yt)Ht.add(ee)}for(const zt of Object.values(this._fieldObjects))for(const Yt of zt)Ht.has(Yt.id)===ht&&wt.push(Yt)}else for(const Ht of Object.values(this._fieldObjects))wt.push(...Ht);const Lt=this.annotationStorage,It=[];for(const Ht of wt){const{id:zt}=Ht;switch(It.push(zt),Ht.type){case"text":{const ee=Ht.defaultValue||"";Lt.setValue(zt,{value:ee});break}case"checkbox":case"radiobutton":{const ee=Ht.defaultValue===Ht.exportValues;Lt.setValue(zt,{value:ee});break}case"combobox":case"listbox":{const ee=Ht.defaultValue||"";Lt.setValue(zt,{value:ee});break}default:continue}const Yt=document.querySelector(`[data-element-id="${zt}"]`);if(Yt){if(!H.has(Yt)){(0,r.warn)(`_bindResetFormAction - element not allowed: ${zt}`);continue}}else continue;Yt.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((Qt=this.linkService.eventBus)==null||Qt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:It,name:"ResetForm"}})),!1}}}c=new WeakSet,Pe=function(){this.container.setAttribute("data-internal-link","")},A=new WeakSet,Tn=function(e,g){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(g),!1),Z(this,c,Pe).call(this)};class p extends w{constructor(D){super(D,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const D=document.createElement("img");return D.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",D.alt="[{{type}} Annotation]",D.dataset.l10nId="text_annotation_type",D.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(D),this.container}}class y extends w{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(D){var e;this.data.hasOwnCanvas&&(((e=D.previousSibling)==null?void 0:e.nodeName)==="CANVAS"&&(D.previousSibling.hidden=!0),D.hidden=!1)}_getKeyModifier(D){const{isWin:e,isMac:g}=r.FeatureTest.platform;return e&&D.ctrlKey||g&&D.metaKey}_setEventListener(D,e,g,N,G){g.includes("mouse")?D.addEventListener(g,tt=>{var ht;(ht=this.linkService.eventBus)==null||ht.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:N,value:G(tt),shift:tt.shiftKey,modifier:this._getKeyModifier(tt)}})}):D.addEventListener(g,tt=>{var ht;if(g==="blur"){if(!e.focused||!tt.relatedTarget)return;e.focused=!1}else if(g==="focus"){if(e.focused)return;e.focused=!0}G&&((ht=this.linkService.eventBus)==null||ht.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:N,value:G(tt)}}))})}_setEventListeners(D,e,g,N){var G,tt,ht;for(const[wt,Lt]of g)(Lt==="Action"||(G=this.data.actions)!=null&&G[Lt])&&((Lt==="Focus"||Lt==="Blur")&&(e||(e={focused:!1})),this._setEventListener(D,e,wt,Lt,N),Lt==="Focus"&&!((tt=this.data.actions)!=null&&tt.Blur)?this._setEventListener(D,e,"blur","Blur",null):Lt==="Blur"&&!((ht=this.data.actions)!=null&&ht.Focus)&&this._setEventListener(D,e,"focus","Focus",null))}_setBackgroundColor(D){const e=this.data.backgroundColor||null;D.style.backgroundColor=e===null?"transparent":r.Util.makeHexColor(e[0],e[1],e[2])}_setTextStyle(D){const e=["left","center","right"],{fontColor:g}=this.data.defaultAppearanceData,N=this.data.defaultAppearanceData.fontSize||m,G=D.style;let tt;const ht=2,wt=Lt=>Math.round(10*Lt)/10;if(this.data.multiLine){const Lt=Math.abs(this.data.rect[3]-this.data.rect[1]-ht),It=Math.round(Lt/(r.LINE_FACTOR*N))||1,Qt=Lt/It;tt=Math.min(N,wt(Qt/r.LINE_FACTOR))}else{const Lt=Math.abs(this.data.rect[3]-this.data.rect[1]-ht);tt=Math.min(N,wt(Lt/r.LINE_FACTOR))}G.fontSize=`calc(${tt}px * var(--scale-factor))`,G.color=r.Util.makeHexColor(g[0],g[1],g[2]),this.data.textAlignment!==null&&(G.textAlign=e[this.data.textAlignment])}_setRequired(D,e){e?D.setAttribute("required",!0):D.removeAttribute("required"),D.setAttribute("aria-required",e)}}class M extends y{constructor(D){const e=D.renderForms||!D.data.hasAppearance&&!!D.data.fieldValue;super(D,{isRenderable:e})}setPropertyOnSiblings(D,e,g,N){const G=this.annotationStorage;for(const tt of this._getElementsByName(D.name,D.id))tt.domElement&&(tt.domElement[e]=g),G.setValue(tt.id,{[N]:g})}render(){var N,G;const D=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let g=null;if(this.renderForms){const tt=D.getValue(e,{value:this.data.fieldValue});let ht=tt.value||"";const wt=D.getValue(e,{charLimit:this.data.maxLen}).charLimit;wt&&ht.length>wt&&(ht=ht.slice(0,wt));let Lt=tt.formattedValue||((N=this.data.textContent)==null?void 0:N.join(`
`))||null;Lt&&this.data.comb&&(Lt=Lt.replaceAll(/\s+/g,""));const It={userValue:ht,formattedValue:Lt,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(g=document.createElement("textarea"),g.textContent=Lt??ht,this.data.doNotScroll&&(g.style.overflowY="hidden")):(g=document.createElement("input"),g.type="text",g.setAttribute("value",Lt??ht),this.data.doNotScroll&&(g.style.overflowX="hidden")),this.data.hasOwnCanvas&&(g.hidden=!0),H.add(g),g.setAttribute("data-element-id",e),g.disabled=this.data.readOnly,g.name=this.data.fieldName,g.tabIndex=F,this._setRequired(g,this.data.required),wt&&(g.maxLength=wt),g.addEventListener("input",Ht=>{D.setValue(e,{value:Ht.target.value}),this.setPropertyOnSiblings(g,"value",Ht.target.value,"value"),It.formattedValue=null}),g.addEventListener("resetform",Ht=>{const zt=this.data.defaultFieldValue??"";g.value=It.userValue=zt,It.formattedValue=null});let Qt=Ht=>{const{formattedValue:zt}=It;zt!=null&&(Ht.target.value=zt),Ht.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){g.addEventListener("focus",zt=>{if(It.focused)return;const{target:Yt}=zt;It.userValue&&(Yt.value=It.userValue),It.lastCommittedValue=Yt.value,It.commitKey=1,It.focused=!0}),g.addEventListener("updatefromsandbox",zt=>{this.showElementAndHideCanvas(zt.target);const Yt={value(ee){It.userValue=ee.detail.value??"",D.setValue(e,{value:It.userValue.toString()}),ee.target.value=It.userValue},formattedValue(ee){const{formattedValue:re}=ee.detail;It.formattedValue=re,re!=null&&ee.target!==document.activeElement&&(ee.target.value=re),D.setValue(e,{formattedValue:re})},selRange(ee){ee.target.setSelectionRange(...ee.detail.selRange)},charLimit:ee=>{var le;const{charLimit:re}=ee.detail,{target:ae}=ee;if(re===0){ae.removeAttribute("maxLength");return}ae.setAttribute("maxLength",re);let ce=It.userValue;!ce||ce.length<=re||(ce=ce.slice(0,re),ae.value=It.userValue=ce,D.setValue(e,{value:ce}),(le=this.linkService.eventBus)==null||le.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:ce,willCommit:!0,commitKey:1,selStart:ae.selectionStart,selEnd:ae.selectionEnd}}))}};this._dispatchEventFromSandbox(Yt,zt)}),g.addEventListener("keydown",zt=>{var re;It.commitKey=1;let Yt=-1;if(zt.key==="Escape"?Yt=0:zt.key==="Enter"&&!this.data.multiLine?Yt=2:zt.key==="Tab"&&(It.commitKey=3),Yt===-1)return;const{value:ee}=zt.target;It.lastCommittedValue!==ee&&(It.lastCommittedValue=ee,It.userValue=ee,(re=this.linkService.eventBus)==null||re.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:ee,willCommit:!0,commitKey:Yt,selStart:zt.target.selectionStart,selEnd:zt.target.selectionEnd}}))});const Ht=Qt;Qt=null,g.addEventListener("blur",zt=>{var ee;if(!It.focused||!zt.relatedTarget)return;It.focused=!1;const{value:Yt}=zt.target;It.userValue=Yt,It.lastCommittedValue!==Yt&&((ee=this.linkService.eventBus)==null||ee.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:Yt,willCommit:!0,commitKey:It.commitKey,selStart:zt.target.selectionStart,selEnd:zt.target.selectionEnd}})),Ht(zt)}),(G=this.data.actions)!=null&&G.Keystroke&&g.addEventListener("beforeinput",zt=>{var me;It.lastCommittedValue=null;const{data:Yt,target:ee}=zt,{value:re,selectionStart:ae,selectionEnd:ce}=ee;let le=ae,ge=ce;switch(zt.inputType){case"deleteWordBackward":{const _e=re.substring(0,ae).match(/\w*[^\w]*$/);_e&&(le-=_e[0].length);break}case"deleteWordForward":{const _e=re.substring(ae).match(/^[^\w]*\w*/);_e&&(ge+=_e[0].length);break}case"deleteContentBackward":ae===ce&&(le-=1);break;case"deleteContentForward":ae===ce&&(ge+=1);break}zt.preventDefault(),(me=this.linkService.eventBus)==null||me.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:re,change:Yt||"",willCommit:!1,selStart:le,selEnd:ge}})}),this._setEventListeners(g,It,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],zt=>zt.target.value)}if(Qt&&g.addEventListener("blur",Qt),this.data.comb){const zt=(this.data.rect[2]-this.data.rect[0])/wt;g.classList.add("comb"),g.style.letterSpacing=`calc(${zt}px * var(--scale-factor) - 1ch)`}}else g=document.createElement("div"),g.textContent=this.data.fieldValue,g.style.verticalAlign="middle",g.style.display="table-cell";return this._setTextStyle(g),this._setBackgroundColor(g),this._setDefaultPropertiesFromJS(g),this.container.append(g),this.container}}class k extends y{constructor(D){super(D,{isRenderable:!!D.data.hasOwnCanvas})}}class v extends y{constructor(D){super(D,{isRenderable:D.renderForms})}render(){const D=this.annotationStorage,e=this.data,g=e.id;let N=D.getValue(g,{value:e.exportValue===e.fieldValue}).value;typeof N=="string"&&(N=N!=="Off",D.setValue(g,{value:N})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const G=document.createElement("input");return H.add(G),G.setAttribute("data-element-id",g),G.disabled=e.readOnly,this._setRequired(G,this.data.required),G.type="checkbox",G.name=e.fieldName,N&&G.setAttribute("checked",!0),G.setAttribute("exportValue",e.exportValue),G.tabIndex=F,G.addEventListener("change",tt=>{const{name:ht,checked:wt}=tt.target;for(const Lt of this._getElementsByName(ht,g)){const It=wt&&Lt.exportValue===e.exportValue;Lt.domElement&&(Lt.domElement.checked=It),D.setValue(Lt.id,{value:It})}D.setValue(g,{value:wt})}),G.addEventListener("resetform",tt=>{const ht=e.defaultFieldValue||"Off";tt.target.checked=ht===e.exportValue}),this.enableScripting&&this.hasJSActions&&(G.addEventListener("updatefromsandbox",tt=>{const ht={value(wt){wt.target.checked=wt.detail.value!=="Off",D.setValue(g,{value:wt.target.checked})}};this._dispatchEventFromSandbox(ht,tt)}),this._setEventListeners(G,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],tt=>tt.target.checked)),this._setBackgroundColor(G),this._setDefaultPropertiesFromJS(G),this.container.append(G),this.container}}class l extends y{constructor(D){super(D,{isRenderable:D.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const D=this.annotationStorage,e=this.data,g=e.id;let N=D.getValue(g,{value:e.fieldValue===e.buttonValue}).value;typeof N=="string"&&(N=N!==e.buttonValue,D.setValue(g,{value:N}));const G=document.createElement("input");if(H.add(G),G.setAttribute("data-element-id",g),G.disabled=e.readOnly,this._setRequired(G,this.data.required),G.type="radio",G.name=e.fieldName,N&&G.setAttribute("checked",!0),G.tabIndex=F,G.addEventListener("change",tt=>{const{name:ht,checked:wt}=tt.target;for(const Lt of this._getElementsByName(ht,g))D.setValue(Lt.id,{value:!1});D.setValue(g,{value:wt})}),G.addEventListener("resetform",tt=>{const ht=e.defaultFieldValue;tt.target.checked=ht!=null&&ht===e.buttonValue}),this.enableScripting&&this.hasJSActions){const tt=e.buttonValue;G.addEventListener("updatefromsandbox",ht=>{const wt={value:Lt=>{const It=tt===Lt.detail.value;for(const Qt of this._getElementsByName(Lt.target.name)){const Ht=It&&Qt.id===g;Qt.domElement&&(Qt.domElement.checked=Ht),D.setValue(Qt.id,{value:Ht})}}};this._dispatchEventFromSandbox(wt,ht)}),this._setEventListeners(G,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ht=>ht.target.checked)}return this._setBackgroundColor(G),this._setDefaultPropertiesFromJS(G),this.container.append(G),this.container}}class d extends C{constructor(D){super(D,{ignoreBorder:D.data.hasAppearance})}render(){const D=super.render();D.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(D.title=this.data.alternativeText);const e=D.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",g=>{this._dispatchEventFromSandbox({},g)})),D}}class I extends y{constructor(D){super(D,{isRenderable:D.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const D=this.annotationStorage,e=this.data.id,g=D.getValue(e,{value:this.data.fieldValue}),N=document.createElement("select");H.add(N),N.setAttribute("data-element-id",e),N.disabled=this.data.readOnly,this._setRequired(N,this.data.required),N.name=this.data.fieldName,N.tabIndex=F;let G=this.data.combo&&this.data.options.length>0;this.data.combo||(N.size=this.data.options.length,this.data.multiSelect&&(N.multiple=!0)),N.addEventListener("resetform",It=>{const Qt=this.data.defaultFieldValue;for(const Ht of N.options)Ht.selected=Ht.value===Qt});for(const It of this.data.options){const Qt=document.createElement("option");Qt.textContent=It.displayValue,Qt.value=It.exportValue,g.value.includes(It.exportValue)&&(Qt.setAttribute("selected",!0),G=!1),N.append(Qt)}let tt=null;if(G){const It=document.createElement("option");It.value=" ",It.setAttribute("hidden",!0),It.setAttribute("selected",!0),N.prepend(It),tt=()=>{It.remove(),N.removeEventListener("input",tt),tt=null},N.addEventListener("input",tt)}const ht=It=>{const Qt=It?"value":"textContent",{options:Ht,multiple:zt}=N;return zt?Array.prototype.filter.call(Ht,Yt=>Yt.selected).map(Yt=>Yt[Qt]):Ht.selectedIndex===-1?null:Ht[Ht.selectedIndex][Qt]};let wt=ht(!1);const Lt=It=>{const Qt=It.target.options;return Array.prototype.map.call(Qt,Ht=>({displayValue:Ht.textContent,exportValue:Ht.value}))};return this.enableScripting&&this.hasJSActions?(N.addEventListener("updatefromsandbox",It=>{const Qt={value(Ht){tt==null||tt();const zt=Ht.detail.value,Yt=new Set(Array.isArray(zt)?zt:[zt]);for(const ee of N.options)ee.selected=Yt.has(ee.value);D.setValue(e,{value:ht(!0)}),wt=ht(!1)},multipleSelection(Ht){N.multiple=!0},remove(Ht){const zt=N.options,Yt=Ht.detail.remove;zt[Yt].selected=!1,N.remove(Yt),zt.length>0&&Array.prototype.findIndex.call(zt,re=>re.selected)===-1&&(zt[0].selected=!0),D.setValue(e,{value:ht(!0),items:Lt(Ht)}),wt=ht(!1)},clear(Ht){for(;N.length!==0;)N.remove(0);D.setValue(e,{value:null,items:[]}),wt=ht(!1)},insert(Ht){const{index:zt,displayValue:Yt,exportValue:ee}=Ht.detail.insert,re=N.children[zt],ae=document.createElement("option");ae.textContent=Yt,ae.value=ee,re?re.before(ae):N.append(ae),D.setValue(e,{value:ht(!0),items:Lt(Ht)}),wt=ht(!1)},items(Ht){const{items:zt}=Ht.detail;for(;N.length!==0;)N.remove(0);for(const Yt of zt){const{displayValue:ee,exportValue:re}=Yt,ae=document.createElement("option");ae.textContent=ee,ae.value=re,N.append(ae)}N.options.length>0&&(N.options[0].selected=!0),D.setValue(e,{value:ht(!0),items:Lt(Ht)}),wt=ht(!1)},indices(Ht){const zt=new Set(Ht.detail.indices);for(const Yt of Ht.target.options)Yt.selected=zt.has(Yt.index);D.setValue(e,{value:ht(!0)}),wt=ht(!1)},editable(Ht){Ht.target.disabled=!Ht.detail.editable}};this._dispatchEventFromSandbox(Qt,It)}),N.addEventListener("input",It=>{var Ht;const Qt=ht(!0);D.setValue(e,{value:Qt}),It.preventDefault(),(Ht=this.linkService.eventBus)==null||Ht.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:wt,changeEx:Qt,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(N,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],It=>It.target.value)):N.addEventListener("input",function(It){D.setValue(e,{value:ht(!0)})}),this.data.combo&&this._setTextStyle(N),this._setBackgroundColor(N),this._setDefaultPropertiesFromJS(N),this.container.append(N),this.container}}class Q extends w{constructor(D){const{data:e,elements:g}=D;super(D,{isRenderable:w._hasPopupData(e)}),this.elements=g}render(){this.container.classList.add("popupAnnotation");const D=new J({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(const g of this.elements)g.popup=D,e.push(g.data.id),g.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(g=>`${r.AnnotationPrefix}${g}`).join(",")),this.container}}class J{constructor({container:D,color:e,elements:g,titleObj:N,modificationDate:G,contentsObj:tt,richText:ht,parent:wt,rect:Lt,parentRect:It,open:Qt}){U(this,te);U(this,Jt);U(this,pt);U(this,V);U(this,B,null);U(this,ct,Z(this,te,xn).bind(this));U(this,nt,Z(this,V,ms).bind(this));U(this,ft,Z(this,pt,gs).bind(this));U(this,mt,Z(this,Jt,Si).bind(this));U(this,Mt,null);U(this,At,null);U(this,Bt,null);U(this,Vt,null);U(this,kt,null);U(this,jt,null);U(this,St,!1);U(this,it,null);U(this,st,null);U(this,vt,null);U(this,Ft,null);U(this,Ot,!1);var zt;ot(this,At,D),ot(this,Ft,N),ot(this,Bt,tt),ot(this,vt,ht),ot(this,kt,wt),ot(this,Mt,e),ot(this,st,Lt),ot(this,jt,It),ot(this,Vt,g);const Ht=x.PDFDateString.toDateObject(G);Ht&&ot(this,B,wt.l10n.get("annotation_date_string",{date:Ht.toLocaleDateString(),time:Ht.toLocaleTimeString()})),this.trigger=g.flatMap(Yt=>Yt.getElementsToTriggerPopup());for(const Yt of this.trigger)Yt.addEventListener("click",t(this,mt)),Yt.addEventListener("mouseenter",t(this,ft)),Yt.addEventListener("mouseleave",t(this,nt)),Yt.classList.add("popupTriggerArea");for(const Yt of g)(zt=Yt.container)==null||zt.addEventListener("keydown",t(this,ct));t(this,At).hidden=!0,Qt&&Z(this,Jt,Si).call(this)}render(){if(t(this,it))return;const{page:{view:D},viewport:{rawDims:{pageWidth:e,pageHeight:g,pageX:N,pageY:G}}}=t(this,kt),tt=ot(this,it,document.createElement("div"));if(tt.className="popup",t(this,Mt)){const le=tt.style.outlineColor=r.Util.makeHexColor(...t(this,Mt));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?tt.style.backgroundColor=`color-mix(in srgb, ${le} 30%, white)`:tt.style.backgroundColor=r.Util.makeHexColor(...t(this,Mt).map(me=>Math.floor(.7*(255-me)+me)))}const ht=document.createElement("span");ht.className="header";const wt=document.createElement("h1");if(ht.append(wt),{dir:wt.dir,str:wt.textContent}=t(this,Ft),tt.append(ht),t(this,B)){const le=document.createElement("span");le.classList.add("popupDate"),t(this,B).then(ge=>{le.textContent=ge}),ht.append(le)}const Lt=t(this,Bt),It=t(this,vt);if(It!=null&&It.str&&(!(Lt!=null&&Lt.str)||Lt.str===It.str))z.XfaLayer.render({xfaHtml:It.html,intent:"richText",div:tt}),tt.lastChild.classList.add("richText","popupContent");else{const le=this._formatContents(Lt);tt.append(le)}let Qt=!!t(this,jt),Ht=Qt?t(this,jt):t(this,st);for(const le of t(this,Vt))if(!Ht||r.Util.intersect(le.data.rect,Ht)!==null){Ht=le.data.rect,Qt=!0;break}const zt=r.Util.normalizeRect([Ht[0],D[3]-Ht[1]+D[1],Ht[2],D[3]-Ht[3]+D[1]]),ee=Qt?Ht[2]-Ht[0]+5:0,re=zt[0]+ee,ae=zt[1],{style:ce}=t(this,At);ce.left=`${100*(re-N)/e}%`,ce.top=`${100*(ae-G)/g}%`,t(this,At).append(tt)}_formatContents({str:D,dir:e}){const g=document.createElement("p");g.classList.add("popupContent"),g.dir=e;const N=D.split(/(?:\r\n?|\n)/);for(let G=0,tt=N.length;G<tt;++G){const ht=N[G];g.append(document.createTextNode(ht)),G<tt-1&&g.append(document.createElement("br"))}return g}forceHide(){ot(this,Ot,this.isVisible),t(this,Ot)&&(t(this,At).hidden=!0)}maybeShow(){t(this,Ot)&&(ot(this,Ot,!1),t(this,At).hidden=!1)}get isVisible(){return t(this,At).hidden===!1}}B=new WeakMap,ct=new WeakMap,nt=new WeakMap,ft=new WeakMap,mt=new WeakMap,Mt=new WeakMap,At=new WeakMap,Bt=new WeakMap,Vt=new WeakMap,kt=new WeakMap,jt=new WeakMap,St=new WeakMap,it=new WeakMap,st=new WeakMap,vt=new WeakMap,Ft=new WeakMap,Ot=new WeakMap,te=new WeakSet,xn=function(D){D.altKey||D.shiftKey||D.ctrlKey||D.metaKey||(D.key==="Enter"||D.key==="Escape"&&t(this,St))&&Z(this,Jt,Si).call(this)},Jt=new WeakSet,Si=function(){ot(this,St,!t(this,St)),t(this,St)?(Z(this,pt,gs).call(this),t(this,At).addEventListener("click",t(this,mt)),t(this,At).addEventListener("keydown",t(this,ct))):(Z(this,V,ms).call(this),t(this,At).removeEventListener("click",t(this,mt)),t(this,At).removeEventListener("keydown",t(this,ct)))},pt=new WeakSet,gs=function(){t(this,it)||this.render(),this.isVisible?t(this,St)&&t(this,At).classList.add("focused"):(t(this,At).hidden=!1,t(this,At).style.zIndex=parseInt(t(this,At).style.zIndex)+1e3)},V=new WeakSet,ms=function(){t(this,At).classList.remove("focused"),!(t(this,St)||!this.isVisible)&&(t(this,At).hidden=!0,t(this,At).style.zIndex=parseInt(t(this,At).style.zIndex)-1e3)};class _t extends w{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0}),this.textContent=D.data.textContent,this.textPosition=D.data.textPosition,this.annotationEditorType=r.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const D=document.createElement("div");D.classList.add("annotationTextContent"),D.setAttribute("role","comment");for(const e of this.textContent){const g=document.createElement("span");g.textContent=e,D.append(g)}this.container.append(D)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}o.FreeTextAnnotationElement=_t;class at extends w{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});U(this,S,null)}render(){this.container.classList.add("lineAnnotation");const e=this.data,{width:g,height:N}=W(e.rect),G=this.svgFactory.create(g,N,!0),tt=ot(this,S,this.svgFactory.createElement("svg:line"));return tt.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),tt.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),tt.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),tt.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),tt.setAttribute("stroke-width",e.borderStyle.width||1),tt.setAttribute("stroke","transparent"),tt.setAttribute("fill","transparent"),G.append(tt),this.container.append(G),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,S)}addHighlightArea(){this.container.classList.add("highlightArea")}}S=new WeakMap;class Pt extends w{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});U(this,T,null)}render(){this.container.classList.add("squareAnnotation");const e=this.data,{width:g,height:N}=W(e.rect),G=this.svgFactory.create(g,N,!0),tt=e.borderStyle.width,ht=ot(this,T,this.svgFactory.createElement("svg:rect"));return ht.setAttribute("x",tt/2),ht.setAttribute("y",tt/2),ht.setAttribute("width",g-tt),ht.setAttribute("height",N-tt),ht.setAttribute("stroke-width",tt||1),ht.setAttribute("stroke","transparent"),ht.setAttribute("fill","transparent"),G.append(ht),this.container.append(G),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,T)}addHighlightArea(){this.container.classList.add("highlightArea")}}T=new WeakMap;class Ct extends w{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});U(this,rt,null)}render(){this.container.classList.add("circleAnnotation");const e=this.data,{width:g,height:N}=W(e.rect),G=this.svgFactory.create(g,N,!0),tt=e.borderStyle.width,ht=ot(this,rt,this.svgFactory.createElement("svg:ellipse"));return ht.setAttribute("cx",g/2),ht.setAttribute("cy",N/2),ht.setAttribute("rx",g/2-tt/2),ht.setAttribute("ry",N/2-tt/2),ht.setAttribute("stroke-width",tt||1),ht.setAttribute("stroke","transparent"),ht.setAttribute("fill","transparent"),G.append(ht),this.container.append(G),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,rt)}addHighlightArea(){this.container.classList.add("highlightArea")}}rt=new WeakMap;class j extends w{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});U(this,dt,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const e=this.data,{width:g,height:N}=W(e.rect),G=this.svgFactory.create(g,N,!0);let tt=[];for(const wt of e.vertices){const Lt=wt.x-e.rect[0],It=e.rect[3]-wt.y;tt.push(Lt+","+It)}tt=tt.join(" ");const ht=ot(this,dt,this.svgFactory.createElement(this.svgElementName));return ht.setAttribute("points",tt),ht.setAttribute("stroke-width",e.borderStyle.width||1),ht.setAttribute("stroke","transparent"),ht.setAttribute("fill","transparent"),G.append(ht),this.container.append(G),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,dt)}addHighlightArea(){this.container.classList.add("highlightArea")}}dt=new WeakMap;class ut extends j{constructor(D){super(D),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Et extends w{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class yt extends w{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});U(this,qt,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=r.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const e=this.data,{width:g,height:N}=W(e.rect),G=this.svgFactory.create(g,N,!0);for(const tt of e.inkLists){let ht=[];for(const Lt of tt){const It=Lt.x-e.rect[0],Qt=e.rect[3]-Lt.y;ht.push(`${It},${Qt}`)}ht=ht.join(" ");const wt=this.svgFactory.createElement(this.svgElementName);t(this,qt).push(wt),wt.setAttribute("points",ht),wt.setAttribute("stroke-width",e.borderStyle.width||1),wt.setAttribute("stroke","transparent"),wt.setAttribute("fill","transparent"),!e.popupRef&&this.hasPopupData&&this._createPopup(),G.append(wt)}return this.container.append(G),this.container}getElementsToTriggerPopup(){return t(this,qt)}addHighlightArea(){this.container.classList.add("highlightArea")}}qt=new WeakMap,o.InkAnnotationElement=yt;class et extends w{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class bt extends w{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Rt extends w{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Ut extends w{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class $t extends w{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}o.StampAnnotationElement=$t;class P extends w{constructor(e){var G;super(e,{isRenderable:!0});U(this,K);U(this,ie,null);const{filename:g,content:N}=this.data.file;this.filename=(0,x.getFilenameFromUrl)(g,!0),this.content=N,(G=this.linkService.eventBus)==null||G.dispatch("fileattachmentannotation",{source:this,filename:g,content:N})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:g}=this;let N;g.hasAppearance||g.fillAlpha===0?N=document.createElement("div"):(N=document.createElement("img"),N.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(g.name)?"paperclip":"pushpin"}.svg`,g.fillAlpha&&g.fillAlpha<1&&(N.style=`filter: opacity(${Math.round(g.fillAlpha*100)}%);`)),N.addEventListener("dblclick",Z(this,K,bs).bind(this)),ot(this,ie,N);const{isMac:G}=r.FeatureTest.platform;return e.addEventListener("keydown",tt=>{tt.key==="Enter"&&(G?tt.metaKey:tt.ctrlKey)&&Z(this,K,bs).call(this)}),!g.popupRef&&this.hasPopupData?this._createPopup():N.classList.add("popupTriggerArea"),e.append(N),e}getElementsToTriggerPopup(){return t(this,ie)}addHighlightArea(){this.container.classList.add("highlightArea")}}ie=new WeakMap,K=new WeakSet,bs=function(){var e;(e=this.downloadManager)==null||e.openOrDownloadData(this.container,this.content,this.filename)};class i{constructor({div:D,accessibilityManager:e,annotationCanvasMap:g,l10n:N,page:G,viewport:tt}){U(this,Gt);U(this,xt);U(this,Nt,null);U(this,Dt,null);U(this,Xt,new Map);this.div=D,ot(this,Nt,e),ot(this,Dt,g),this.l10n=N,this.page=G,this.viewport=tt,this.zIndex=0,this.l10n||(this.l10n=gt.NullL10n)}async render(D){const{annotations:e}=D,g=this.div;(0,x.setLayerDimensions)(g,this.viewport);const N=new Map,G={data:null,layer:g,linkService:D.linkService,downloadManager:D.downloadManager,imageResourcesPath:D.imageResourcesPath||"",renderForms:D.renderForms!==!1,svgFactory:new x.DOMSVGFactory,annotationStorage:D.annotationStorage||new q.AnnotationStorage,enableScripting:D.enableScripting===!0,hasJSActions:D.hasJSActions,fieldObjects:D.fieldObjects,parent:this,elements:null};for(const tt of e){if(tt.noHTML)continue;const ht=tt.annotationType===r.AnnotationType.POPUP;if(ht){const It=N.get(tt.id);if(!It)continue;G.elements=It}else{const{width:It,height:Qt}=W(tt.rect);if(It<=0||Qt<=0)continue}G.data=tt;const wt=L.create(G);if(!wt.isRenderable)continue;if(!ht&&tt.popupRef){const It=N.get(tt.popupRef);It?It.push(wt):N.set(tt.popupRef,[wt])}wt.annotationEditorType>0&&t(this,Xt).set(wt.data.id,wt);const Lt=wt.render();tt.hidden&&(Lt.style.visibility="hidden"),Z(this,Gt,Pn).call(this,Lt,tt.id)}Z(this,xt,As).call(this),await this.l10n.translate(g)}update({viewport:D}){const e=this.div;this.viewport=D,(0,x.setLayerDimensions)(e,{rotation:D.rotation}),Z(this,xt,As).call(this),e.hidden=!1}getEditableAnnotations(){return Array.from(t(this,Xt).values())}getEditableAnnotation(D){return t(this,Xt).get(D)}}Nt=new WeakMap,Dt=new WeakMap,Xt=new WeakMap,Gt=new WeakSet,Pn=function(D,e){var N;const g=D.firstChild||D;g.id=`${r.AnnotationPrefix}${e}`,this.div.append(D),(N=t(this,Nt))==null||N.moveElementInDOM(this.div,D,g,!1)},xt=new WeakSet,As=function(){if(!t(this,Dt))return;const D=this.div;for(const[e,g]of t(this,Dt)){const N=D.querySelector(`[data-annotation-id="${e}"]`);if(!N)continue;const{firstChild:G}=N;G?G.nodeName==="CANVAS"?G.replaceWith(g):G.before(g):N.append(g)}t(this,Dt).clear()},o.AnnotationLayer=i},($,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ColorConverters=void 0;function X(q){return Math.floor(Math.max(0,Math.min(1,q))*255).toString(16).padStart(2,"0")}function r(q){return Math.max(0,Math.min(255,255*q))}class x{static CMYK_G([Y,gt,z,F]){return["G",1-Math.min(1,.3*Y+.59*z+.11*gt+F)]}static G_CMYK([Y]){return["CMYK",0,0,0,1-Y]}static G_RGB([Y]){return["RGB",Y,Y,Y]}static G_rgb([Y]){return Y=r(Y),[Y,Y,Y]}static G_HTML([Y]){const gt=X(Y);return`#${gt}${gt}${gt}`}static RGB_G([Y,gt,z]){return["G",.3*Y+.59*gt+.11*z]}static RGB_rgb(Y){return Y.map(r)}static RGB_HTML(Y){return`#${Y.map(X).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([Y,gt,z,F]){return["RGB",1-Math.min(1,Y+F),1-Math.min(1,z+F),1-Math.min(1,gt+F)]}static CMYK_rgb([Y,gt,z,F]){return[r(1-Math.min(1,Y+F)),r(1-Math.min(1,z+F)),r(1-Math.min(1,gt+F))]}static CMYK_HTML(Y){const gt=this.CMYK_RGB(Y).slice(1);return this.RGB_HTML(gt)}static RGB_CMYK([Y,gt,z]){const F=1-Y,m=1-gt,H=1-z,W=Math.min(F,m,H);return["CMYK",F,m,H,W]}}o.ColorConverters=x},($,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.NullL10n=void 0,o.getL10nFallback=r;const X={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};X.print_progress_percent="{{progress}}%";function r(Y,gt){switch(Y){case"find_match_count":Y=`find_match_count[${gt.total===1?"one":"other"}]`;break;case"find_match_count_limit":Y=`find_match_count_limit[${gt.limit===1?"one":"other"}]`;break}return X[Y]||""}function x(Y,gt){return gt?Y.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(z,F)=>F in gt?gt[F]:"{{"+F+"}}"):Y}const q={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(Y,gt=null,z=r(Y,gt)){return x(z,gt)},async translate(Y){}};o.NullL10n=q},($,o,X)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.XfaLayer=void 0;var r=X(25);class x{static setupStorage(Y,gt,z,F,m){const H=F.getValue(gt,{value:null});switch(z.name){case"textarea":if(H.value!==null&&(Y.textContent=H.value),m==="print")break;Y.addEventListener("input",W=>{F.setValue(gt,{value:W.target.value})});break;case"input":if(z.attributes.type==="radio"||z.attributes.type==="checkbox"){if(H.value===z.attributes.xfaOn?Y.setAttribute("checked",!0):H.value===z.attributes.xfaOff&&Y.removeAttribute("checked"),m==="print")break;Y.addEventListener("change",W=>{F.setValue(gt,{value:W.target.checked?W.target.getAttribute("xfaOn"):W.target.getAttribute("xfaOff")})})}else{if(H.value!==null&&Y.setAttribute("value",H.value),m==="print")break;Y.addEventListener("input",W=>{F.setValue(gt,{value:W.target.value})})}break;case"select":if(H.value!==null){Y.setAttribute("value",H.value);for(const W of z.children)W.attributes.value===H.value?W.attributes.selected=!0:W.attributes.hasOwnProperty("selected")&&delete W.attributes.selected}Y.addEventListener("input",W=>{const L=W.target.options,w=L.selectedIndex===-1?"":L[L.selectedIndex].value;F.setValue(gt,{value:w})});break}}static setAttributes({html:Y,element:gt,storage:z=null,intent:F,linkService:m}){const{attributes:H}=gt,W=Y instanceof HTMLAnchorElement;H.type==="radio"&&(H.name=`${H.name}-${F}`);for(const[L,w]of Object.entries(H))if(w!=null)switch(L){case"class":w.length&&Y.setAttribute(L,w.join(" "));break;case"dataId":break;case"id":Y.setAttribute("data-element-id",w);break;case"style":Object.assign(Y.style,w);break;case"textContent":Y.textContent=w;break;default:(!W||L!=="href"&&L!=="newWindow")&&Y.setAttribute(L,w)}W&&m.addLinkAttributes(Y,H.href,H.newWindow),z&&H.dataId&&this.setupStorage(Y,H.dataId,gt,z)}static render(Y){var C;const gt=Y.annotationStorage,z=Y.linkService,F=Y.xfaHtml,m=Y.intent||"display",H=document.createElement(F.name);F.attributes&&this.setAttributes({html:H,element:F,intent:m,linkService:z});const W=[[F,-1,H]],L=Y.div;if(L.append(H),Y.viewport){const p=`matrix(${Y.viewport.transform.join(",")})`;L.style.transform=p}m!=="richText"&&L.setAttribute("class","xfaLayer xfaFont");const w=[];for(;W.length>0;){const[p,y,M]=W.at(-1);if(y+1===p.children.length){W.pop();continue}const k=p.children[++W.at(-1)[1]];if(k===null)continue;const{name:v}=k;if(v==="#text"){const d=document.createTextNode(k.value);w.push(d),M.append(d);continue}const l=(C=k==null?void 0:k.attributes)!=null&&C.xmlns?document.createElementNS(k.attributes.xmlns,v):document.createElement(v);if(M.append(l),k.attributes&&this.setAttributes({html:l,element:k,storage:gt,intent:m,linkService:z}),k.children&&k.children.length>0)W.push([k,-1,l]);else if(k.value){const d=document.createTextNode(k.value);r.XfaText.shouldBuildText(v)&&w.push(d),l.append(d)}}for(const p of L.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))p.setAttribute("readOnly",!0);return{textDivs:w}}static update(Y){const gt=`matrix(${Y.viewport.transform.join(",")})`;Y.div.style.transform=gt,Y.div.hidden=!1}}o.XfaLayer=x},($,o,X)=>{var F,m,H,W,L,w,C,p,y,M,k,v,l,d,I,kn,J,Mn,at,Rn,Ct,Fn,ut,ys,yt,Dn,bt,vs,Ut,On,P,In,a,Ln,c,Nn,A,$n,B,Ee,nt,_s,mt,Ei,At,wi,Vt,Ue,jt,Ss,it,Ci,vt,Un,Ot,Es,Kt,Bn,Zt,Hn,O,ws,_,Ti,T,Be;Object.defineProperty(o,"__esModule",{value:!0}),o.InkEditor=void 0;var r=X(1),x=X(4),q=X(29),Y=X(6),gt=X(5);const dt=class dt extends x.AnnotationEditor{constructor(K){super({...K,name:"inkEditor"});U(this,I);U(this,J);U(this,at);U(this,Ct);U(this,ut);U(this,yt);U(this,bt);U(this,Ut);U(this,P);U(this,a);U(this,c);U(this,A);U(this,B);U(this,nt);U(this,mt);U(this,At);U(this,Vt);U(this,jt);U(this,it);U(this,Zt);U(this,O);U(this,_);U(this,T);U(this,F,0);U(this,m,0);U(this,H,this.canvasPointermove.bind(this));U(this,W,this.canvasPointerleave.bind(this));U(this,L,this.canvasPointerup.bind(this));U(this,w,this.canvasPointerdown.bind(this));U(this,C,new Path2D);U(this,p,!1);U(this,y,!1);U(this,M,!1);U(this,k,null);U(this,v,0);U(this,l,0);U(this,d,null);this.color=K.color||null,this.thickness=K.thickness||null,this.opacity=K.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(K){x.AnnotationEditor.initialize(K,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(K,Tt){switch(K){case r.AnnotationEditorParamsType.INK_THICKNESS:dt._defaultThickness=Tt;break;case r.AnnotationEditorParamsType.INK_COLOR:dt._defaultColor=Tt;break;case r.AnnotationEditorParamsType.INK_OPACITY:dt._defaultOpacity=Tt/100;break}}updateParams(K,Tt){switch(K){case r.AnnotationEditorParamsType.INK_THICKNESS:Z(this,I,kn).call(this,Tt);break;case r.AnnotationEditorParamsType.INK_COLOR:Z(this,J,Mn).call(this,Tt);break;case r.AnnotationEditorParamsType.INK_OPACITY:Z(this,at,Rn).call(this,Tt);break}}static get defaultPropertiesToUpdate(){return[[r.AnnotationEditorParamsType.INK_THICKNESS,dt._defaultThickness],[r.AnnotationEditorParamsType.INK_COLOR,dt._defaultColor||x.AnnotationEditor._defaultLineColor],[r.AnnotationEditorParamsType.INK_OPACITY,Math.round(dt._defaultOpacity*100)]]}get propertiesToUpdate(){return[[r.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||dt._defaultThickness],[r.AnnotationEditorParamsType.INK_COLOR,this.color||dt._defaultColor||x.AnnotationEditor._defaultLineColor],[r.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??dt._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(Z(this,mt,Ei).call(this),Z(this,At,wi).call(this)),this.isAttachedToDOM||(this.parent.add(this),Z(this,Vt,Ue).call(this)),Z(this,T,Be).call(this)))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,t(this,k).disconnect(),ot(this,k,null),super.remove())}setParent(K){!this.parent&&K?this._uiManager.removeShouldRescale(this):this.parent&&K===null&&this._uiManager.addShouldRescale(this),super.setParent(K)}onScaleChanging(){const[K,Tt]=this.parentDimensions,Nt=this.width*K,Dt=this.height*Tt;this.setDimensions(Nt,Dt)}enableEditMode(){t(this,p)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",t(this,w)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",t(this,w)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){t(this,p)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),ot(this,p,!0),this.div.classList.add("disabled"),Z(this,T,Be).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(K){this._focusEventsAllowed&&(super.focusin(K),this.enableEditMode())}canvasPointerdown(K){K.button!==0||!this.isInEditMode()||t(this,p)||(this.setInForeground(),K.preventDefault(),K.type!=="mouse"&&this.div.focus(),Z(this,yt,Dn).call(this,K.offsetX,K.offsetY))}canvasPointermove(K){K.preventDefault(),Z(this,bt,vs).call(this,K.offsetX,K.offsetY)}canvasPointerup(K){K.preventDefault(),Z(this,nt,_s).call(this,K)}canvasPointerleave(K){Z(this,nt,_s).call(this,K)}get isResizable(){return!this.isEmpty()&&t(this,p)}render(){if(this.div)return this.div;let K,Tt;this.width&&(K=this.x,Tt=this.y),super.render(),x.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(ne=>{var xt;return(xt=this.div)==null?void 0:xt.setAttribute("aria-label",ne)});const[Nt,Dt,Xt,Gt]=Z(this,Ct,Fn).call(this);if(this.setAt(Nt,Dt,0,0),this.setDims(Xt,Gt),Z(this,mt,Ei).call(this),this.width){const[ne,xt]=this.parentDimensions;this.setAspectRatio(this.width*ne,this.height*xt),this.setAt(K*ne,Tt*xt,this.width*ne,this.height*xt),ot(this,M,!0),Z(this,Vt,Ue).call(this),this.setDims(this.width*ne,this.height*xt),Z(this,B,Ee).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return Z(this,At,wi).call(this),this.div}setDimensions(K,Tt){const Nt=Math.round(K),Dt=Math.round(Tt);if(t(this,v)===Nt&&t(this,l)===Dt)return;ot(this,v,Nt),ot(this,l,Dt),this.canvas.style.visibility="hidden";const[Xt,Gt]=this.parentDimensions;this.width=K/Xt,this.height=Tt/Gt,this.fixAndSetPosition(),t(this,p)&&Z(this,jt,Ss).call(this,K,Tt),Z(this,Vt,Ue).call(this),Z(this,B,Ee).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(K,Tt,Nt){var G,tt,ht;if(K instanceof q.InkAnnotationElement)return null;const Dt=super.deserialize(K,Tt,Nt);Dt.thickness=K.thickness,Dt.color=r.Util.makeHexColor(...K.color),Dt.opacity=K.opacity;const[Xt,Gt]=Dt.pageDimensions,ne=Dt.width*Xt,xt=Dt.height*Gt,se=Dt.parentScale,Wt=K.thickness/2;ot(Dt,p,!0),ot(Dt,v,Math.round(ne)),ot(Dt,l,Math.round(xt));const{paths:D,rect:e,rotation:g}=K;for(let{bezier:wt}of D){wt=Z(G=dt,Kt,Bn).call(G,wt,e,g);const Lt=[];Dt.paths.push(Lt);let It=se*(wt[0]-Wt),Qt=se*(wt[1]-Wt);for(let zt=2,Yt=wt.length;zt<Yt;zt+=6){const ee=se*(wt[zt]-Wt),re=se*(wt[zt+1]-Wt),ae=se*(wt[zt+2]-Wt),ce=se*(wt[zt+3]-Wt),le=se*(wt[zt+4]-Wt),ge=se*(wt[zt+5]-Wt);Lt.push([[It,Qt],[ee,re],[ae,ce],[le,ge]]),It=le,Qt=ge}const Ht=Z(this,vt,Un).call(this,Lt);Dt.bezierPath2D.push(Ht)}const N=Z(tt=Dt,O,ws).call(tt);return ot(Dt,m,Math.max(x.AnnotationEditor.MIN_SIZE,N[2]-N[0])),ot(Dt,F,Math.max(x.AnnotationEditor.MIN_SIZE,N[3]-N[1])),Z(ht=Dt,jt,Ss).call(ht,ne,xt),Dt}serialize(){if(this.isEmpty())return null;const K=this.getRect(0,0),Tt=x.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:r.AnnotationEditorType.INK,color:Tt,thickness:this.thickness,opacity:this.opacity,paths:Z(this,Zt,Hn).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,K),pageIndex:this.pageIndex,rect:K,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};F=new WeakMap,m=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakMap,w=new WeakMap,C=new WeakMap,p=new WeakMap,y=new WeakMap,M=new WeakMap,k=new WeakMap,v=new WeakMap,l=new WeakMap,d=new WeakMap,I=new WeakSet,kn=function(K){const Tt=this.thickness;this.addCommands({cmd:()=>{this.thickness=K,Z(this,T,Be).call(this)},undo:()=>{this.thickness=Tt,Z(this,T,Be).call(this)},mustExec:!0,type:r.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},J=new WeakSet,Mn=function(K){const Tt=this.color;this.addCommands({cmd:()=>{this.color=K,Z(this,B,Ee).call(this)},undo:()=>{this.color=Tt,Z(this,B,Ee).call(this)},mustExec:!0,type:r.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},at=new WeakSet,Rn=function(K){K/=100;const Tt=this.opacity;this.addCommands({cmd:()=>{this.opacity=K,Z(this,B,Ee).call(this)},undo:()=>{this.opacity=Tt,Z(this,B,Ee).call(this)},mustExec:!0,type:r.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},Ct=new WeakSet,Fn=function(){const{parentRotation:K,parentDimensions:[Tt,Nt]}=this;switch(K){case 90:return[0,Nt,Nt,Tt];case 180:return[Tt,Nt,Tt,Nt];case 270:return[Tt,0,Nt,Tt];default:return[0,0,Tt,Nt]}},ut=new WeakSet,ys=function(){const{ctx:K,color:Tt,opacity:Nt,thickness:Dt,parentScale:Xt,scaleFactor:Gt}=this;K.lineWidth=Dt*Xt/Gt,K.lineCap="round",K.lineJoin="round",K.miterLimit=10,K.strokeStyle=`${Tt}${(0,gt.opacityToHex)(Nt)}`},yt=new WeakSet,Dn=function(K,Tt){this.canvas.addEventListener("contextmenu",Y.noContextMenu),this.canvas.addEventListener("pointerleave",t(this,W)),this.canvas.addEventListener("pointermove",t(this,H)),this.canvas.addEventListener("pointerup",t(this,L)),this.canvas.removeEventListener("pointerdown",t(this,w)),this.isEditing=!0,t(this,M)||(ot(this,M,!0),Z(this,Vt,Ue).call(this),this.thickness||(this.thickness=dt._defaultThickness),this.color||(this.color=dt._defaultColor||x.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=dt._defaultOpacity)),this.currentPath.push([K,Tt]),ot(this,y,!1),Z(this,ut,ys).call(this),ot(this,d,()=>{Z(this,a,Ln).call(this),t(this,d)&&window.requestAnimationFrame(t(this,d))}),window.requestAnimationFrame(t(this,d))},bt=new WeakSet,vs=function(K,Tt){const[Nt,Dt]=this.currentPath.at(-1);if(this.currentPath.length>1&&K===Nt&&Tt===Dt)return;const Xt=this.currentPath;let Gt=t(this,C);if(Xt.push([K,Tt]),ot(this,y,!0),Xt.length<=2){Gt.moveTo(...Xt[0]),Gt.lineTo(K,Tt);return}Xt.length===3&&(ot(this,C,Gt=new Path2D),Gt.moveTo(...Xt[0])),Z(this,c,Nn).call(this,Gt,...Xt.at(-3),...Xt.at(-2),K,Tt)},Ut=new WeakSet,On=function(){if(this.currentPath.length===0)return;const K=this.currentPath.at(-1);t(this,C).lineTo(...K)},P=new WeakSet,In=function(K,Tt){ot(this,d,null),K=Math.min(Math.max(K,0),this.canvas.width),Tt=Math.min(Math.max(Tt,0),this.canvas.height),Z(this,bt,vs).call(this,K,Tt),Z(this,Ut,On).call(this);let Nt;if(this.currentPath.length!==1)Nt=Z(this,A,$n).call(this);else{const xt=[K,Tt];Nt=[[xt,xt.slice(),xt.slice(),xt]]}const Dt=t(this,C),Xt=this.currentPath;this.currentPath=[],ot(this,C,new Path2D);const Gt=()=>{this.allRawPaths.push(Xt),this.paths.push(Nt),this.bezierPath2D.push(Dt),this.rebuild()},ne=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(Z(this,mt,Ei).call(this),Z(this,At,wi).call(this)),Z(this,T,Be).call(this))};this.addCommands({cmd:Gt,undo:ne,mustExec:!0})},a=new WeakSet,Ln=function(){if(!t(this,y))return;ot(this,y,!1);const K=Math.ceil(this.thickness*this.parentScale),Tt=this.currentPath.slice(-3),Nt=Tt.map(Gt=>Gt[0]),Dt=Tt.map(Gt=>Gt[1]);Math.min(...Nt)-K,Math.max(...Nt)+K,Math.min(...Dt)-K,Math.max(...Dt)+K;const{ctx:Xt}=this;Xt.save(),Xt.clearRect(0,0,this.canvas.width,this.canvas.height);for(const Gt of this.bezierPath2D)Xt.stroke(Gt);Xt.stroke(t(this,C)),Xt.restore()},c=new WeakSet,Nn=function(K,Tt,Nt,Dt,Xt,Gt,ne){const xt=(Tt+Dt)/2,se=(Nt+Xt)/2,Wt=(Dt+Gt)/2,D=(Xt+ne)/2;K.bezierCurveTo(xt+2*(Dt-xt)/3,se+2*(Xt-se)/3,Wt+2*(Dt-Wt)/3,D+2*(Xt-D)/3,Wt,D)},A=new WeakSet,$n=function(){const K=this.currentPath;if(K.length<=2)return[[K[0],K[0],K.at(-1),K.at(-1)]];const Tt=[];let Nt,[Dt,Xt]=K[0];for(Nt=1;Nt<K.length-2;Nt++){const[e,g]=K[Nt],[N,G]=K[Nt+1],tt=(e+N)/2,ht=(g+G)/2,wt=[Dt+2*(e-Dt)/3,Xt+2*(g-Xt)/3],Lt=[tt+2*(e-tt)/3,ht+2*(g-ht)/3];Tt.push([[Dt,Xt],wt,Lt,[tt,ht]]),[Dt,Xt]=[tt,ht]}const[Gt,ne]=K[Nt],[xt,se]=K[Nt+1],Wt=[Dt+2*(Gt-Dt)/3,Xt+2*(ne-Xt)/3],D=[xt+2*(Gt-xt)/3,se+2*(ne-se)/3];return Tt.push([[Dt,Xt],Wt,D,[xt,se]]),Tt},B=new WeakSet,Ee=function(){if(this.isEmpty()){Z(this,it,Ci).call(this);return}Z(this,ut,ys).call(this);const{canvas:K,ctx:Tt}=this;Tt.setTransform(1,0,0,1,0,0),Tt.clearRect(0,0,K.width,K.height),Z(this,it,Ci).call(this);for(const Nt of this.bezierPath2D)Tt.stroke(Nt)},nt=new WeakSet,_s=function(K){this.canvas.removeEventListener("pointerleave",t(this,W)),this.canvas.removeEventListener("pointermove",t(this,H)),this.canvas.removeEventListener("pointerup",t(this,L)),this.canvas.addEventListener("pointerdown",t(this,w)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",Y.noContextMenu)},10),Z(this,P,In).call(this,K.offsetX,K.offsetY),this.addToAnnotationStorage(),this.setInBackground()},mt=new WeakSet,Ei=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",x.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(K=>{var Tt;return(Tt=this.canvas)==null?void 0:Tt.setAttribute("aria-label",K)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},At=new WeakSet,wi=function(){ot(this,k,new ResizeObserver(K=>{const Tt=K[0].contentRect;Tt.width&&Tt.height&&this.setDimensions(Tt.width,Tt.height)})),t(this,k).observe(this.div)},Vt=new WeakSet,Ue=function(){if(!t(this,M))return;const[K,Tt]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*K),this.canvas.height=Math.ceil(this.height*Tt),Z(this,it,Ci).call(this)},jt=new WeakSet,Ss=function(K,Tt){const Nt=Z(this,_,Ti).call(this),Dt=(K-Nt)/t(this,m),Xt=(Tt-Nt)/t(this,F);this.scaleFactor=Math.min(Dt,Xt)},it=new WeakSet,Ci=function(){const K=Z(this,_,Ti).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+K,this.translationY*this.scaleFactor+K)},vt=new WeakSet,Un=function(K){const Tt=new Path2D;for(let Nt=0,Dt=K.length;Nt<Dt;Nt++){const[Xt,Gt,ne,xt]=K[Nt];Nt===0&&Tt.moveTo(...Xt),Tt.bezierCurveTo(Gt[0],Gt[1],ne[0],ne[1],xt[0],xt[1])}return Tt},Ot=new WeakSet,Es=function(K,Tt,Nt){const[Dt,Xt,Gt,ne]=Tt;switch(Nt){case 0:for(let xt=0,se=K.length;xt<se;xt+=2)K[xt]+=Dt,K[xt+1]=ne-K[xt+1];break;case 90:for(let xt=0,se=K.length;xt<se;xt+=2){const Wt=K[xt];K[xt]=K[xt+1]+Dt,K[xt+1]=Wt+Xt}break;case 180:for(let xt=0,se=K.length;xt<se;xt+=2)K[xt]=Gt-K[xt],K[xt+1]+=Xt;break;case 270:for(let xt=0,se=K.length;xt<se;xt+=2){const Wt=K[xt];K[xt]=Gt-K[xt+1],K[xt+1]=ne-Wt}break;default:throw new Error("Invalid rotation")}return K},Kt=new WeakSet,Bn=function(K,Tt,Nt){const[Dt,Xt,Gt,ne]=Tt;switch(Nt){case 0:for(let xt=0,se=K.length;xt<se;xt+=2)K[xt]-=Dt,K[xt+1]=ne-K[xt+1];break;case 90:for(let xt=0,se=K.length;xt<se;xt+=2){const Wt=K[xt];K[xt]=K[xt+1]-Xt,K[xt+1]=Wt-Dt}break;case 180:for(let xt=0,se=K.length;xt<se;xt+=2)K[xt]=Gt-K[xt],K[xt+1]-=Xt;break;case 270:for(let xt=0,se=K.length;xt<se;xt+=2){const Wt=K[xt];K[xt]=ne-K[xt+1],K[xt+1]=Gt-Wt}break;default:throw new Error("Invalid rotation")}return K},Zt=new WeakSet,Hn=function(K,Tt,Nt,Dt){var se,Wt;const Xt=[],Gt=this.thickness/2,ne=K*Tt+Gt,xt=K*Nt+Gt;for(const D of this.paths){const e=[],g=[];for(let N=0,G=D.length;N<G;N++){const[tt,ht,wt,Lt]=D[N],It=K*tt[0]+ne,Qt=K*tt[1]+xt,Ht=K*ht[0]+ne,zt=K*ht[1]+xt,Yt=K*wt[0]+ne,ee=K*wt[1]+xt,re=K*Lt[0]+ne,ae=K*Lt[1]+xt;N===0&&(e.push(It,Qt),g.push(It,Qt)),e.push(Ht,zt,Yt,ee,re,ae),g.push(Ht,zt),N===G-1&&g.push(re,ae)}Xt.push({bezier:Z(se=dt,Ot,Es).call(se,e,Dt,this.rotation),points:Z(Wt=dt,Ot,Es).call(Wt,g,Dt,this.rotation)})}return Xt},O=new WeakSet,ws=function(){let K=1/0,Tt=-1/0,Nt=1/0,Dt=-1/0;for(const Xt of this.paths)for(const[Gt,ne,xt,se]of Xt){const Wt=r.Util.bezierBoundingBox(...Gt,...ne,...xt,...se);K=Math.min(K,Wt[0]),Nt=Math.min(Nt,Wt[1]),Tt=Math.max(Tt,Wt[2]),Dt=Math.max(Dt,Wt[3])}return[K,Nt,Tt,Dt]},_=new WeakSet,Ti=function(){return t(this,p)?Math.ceil(this.thickness*this.parentScale):0},T=new WeakSet,Be=function(K=!1){if(this.isEmpty())return;if(!t(this,p)){Z(this,B,Ee).call(this);return}const Tt=Z(this,O,ws).call(this),Nt=Z(this,_,Ti).call(this);ot(this,m,Math.max(x.AnnotationEditor.MIN_SIZE,Tt[2]-Tt[0])),ot(this,F,Math.max(x.AnnotationEditor.MIN_SIZE,Tt[3]-Tt[1]));const Dt=Math.ceil(Nt+t(this,m)*this.scaleFactor),Xt=Math.ceil(Nt+t(this,F)*this.scaleFactor),[Gt,ne]=this.parentDimensions;this.width=Dt/Gt,this.height=Xt/ne,this.setAspectRatio(Dt,Xt);const xt=this.translationX,se=this.translationY;this.translationX=-Tt[0],this.translationY=-Tt[1],Z(this,Vt,Ue).call(this),Z(this,B,Ee).call(this),ot(this,v,Dt),ot(this,l,Xt),this.setDims(Dt,Xt);const Wt=K?Nt/this.scaleFactor/2:0;this.translate(xt-this.translationX-Wt,se-this.translationY-Wt)},U(dt,vt),U(dt,Ot),U(dt,Kt),oe(dt,"_defaultColor",null),oe(dt,"_defaultOpacity",1),oe(dt,"_defaultThickness",1),oe(dt,"_type","ink");let z=dt;o.InkEditor=z},($,o,X)=>{var z,F,m,H,W,L,w,C,p,y,M,Qe,v,Ze,d,xi,Q,Cs,_t,jn,Pt,Wn,j,Ts,Et,Pi,et,zn;Object.defineProperty(o,"__esModule",{value:!0}),o.StampEditor=void 0;var r=X(1),x=X(4),q=X(6),Y=X(29);const Rt=class Rt extends x.AnnotationEditor{constructor(P){super({...P,name:"stampEditor"});U(this,M);U(this,v);U(this,d);U(this,Q);U(this,_t);U(this,Pt);U(this,j);U(this,Et);U(this,et);U(this,z,null);U(this,F,null);U(this,m,null);U(this,H,null);U(this,W,null);U(this,L,null);U(this,w,null);U(this,C,null);U(this,p,!1);U(this,y,!1);ot(this,H,P.bitmapUrl),ot(this,W,P.bitmapFile)}static initialize(P){x.AnnotationEditor.initialize(P)}static get supportedTypes(){const P=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,r.shadow)(this,"supportedTypes",P.map(i=>`image/${i}`))}static get supportedTypesStr(){return(0,r.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(P){return this.supportedTypes.includes(P)}static paste(P,i){i.pasteEditor(r.AnnotationEditorType.STAMP,{bitmapFile:P.getAsFile()})}remove(){var P,i;t(this,F)&&(ot(this,z,null),this._uiManager.imageManager.deleteId(t(this,F)),(P=t(this,L))==null||P.remove(),ot(this,L,null),(i=t(this,w))==null||i.disconnect(),ot(this,w,null)),super.remove()}rebuild(){if(!this.parent){t(this,F)&&Z(this,d,xi).call(this);return}super.rebuild(),this.div!==null&&(t(this,F)&&Z(this,d,xi).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(t(this,m)||t(this,z)||t(this,H)||t(this,W))}get isResizable(){return!0}render(){if(this.div)return this.div;let P,i;if(this.width&&(P=this.x,i=this.y),super.render(),this.div.hidden=!0,t(this,z)?Z(this,Q,Cs).call(this):Z(this,d,xi).call(this),this.width){const[a,s]=this.parentDimensions;this.setAt(P*a,i*s,this.width*a,this.height*s)}return this.div}static deserialize(P,i,a){if(P instanceof Y.StampAnnotationElement)return null;const s=super.deserialize(P,i,a),{rect:c,bitmapUrl:u,bitmapId:A,isSvg:R,accessibilityData:B}=P;A&&a.imageManager.isValidId(A)?ot(s,F,A):ot(s,H,u),ot(s,p,R);const[ct,nt]=s.pageDimensions;return s.width=(c[2]-c[0])/ct,s.height=(c[3]-c[1])/nt,B&&(s.altTextData=B),s}serialize(P=!1,i=null){if(this.isEmpty())return null;const a={annotationType:r.AnnotationEditorType.STAMP,bitmapId:t(this,F),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:t(this,p),structTreeParentId:this._structTreeParentId};if(P)return a.bitmapUrl=Z(this,Et,Pi).call(this,!0),a.accessibilityData=this.altTextData,a;const{decorative:s,altText:c}=this.altTextData;if(!s&&c&&(a.accessibilityData={type:"Figure",alt:c}),i===null)return a;i.stamps||(i.stamps=new Map);const u=t(this,p)?(a.rect[2]-a.rect[0])*(a.rect[3]-a.rect[1]):null;if(!i.stamps.has(t(this,F)))i.stamps.set(t(this,F),{area:u,serialized:a}),a.bitmap=Z(this,Et,Pi).call(this,!1);else if(t(this,p)){const A=i.stamps.get(t(this,F));u>A.area&&(A.area=u,A.serialized.bitmap.close(),A.serialized.bitmap=Z(this,Et,Pi).call(this,!1))}return a}};z=new WeakMap,F=new WeakMap,m=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakMap,w=new WeakMap,C=new WeakMap,p=new WeakMap,y=new WeakMap,M=new WeakSet,Qe=function(P,i=!1){if(!P){this.remove();return}ot(this,z,P.bitmap),i||(ot(this,F,P.id),ot(this,p,P.isSvg)),Z(this,Q,Cs).call(this)},v=new WeakSet,Ze=function(){ot(this,m,null),this._uiManager.enableWaiting(!1),t(this,L)&&this.div.focus()},d=new WeakSet,xi=function(){if(t(this,F)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(t(this,F)).then(i=>Z(this,M,Qe).call(this,i,!0)).finally(()=>Z(this,v,Ze).call(this));return}if(t(this,H)){const i=t(this,H);ot(this,H,null),this._uiManager.enableWaiting(!0),ot(this,m,this._uiManager.imageManager.getFromUrl(i).then(a=>Z(this,M,Qe).call(this,a)).finally(()=>Z(this,v,Ze).call(this)));return}if(t(this,W)){const i=t(this,W);ot(this,W,null),this._uiManager.enableWaiting(!0),ot(this,m,this._uiManager.imageManager.getFromFile(i).then(a=>Z(this,M,Qe).call(this,a)).finally(()=>Z(this,v,Ze).call(this)));return}const P=document.createElement("input");P.type="file",P.accept=Rt.supportedTypesStr,ot(this,m,new Promise(i=>{P.addEventListener("change",async()=>{if(!P.files||P.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const a=await this._uiManager.imageManager.getFromFile(P.files[0]);Z(this,M,Qe).call(this,a)}i()}),P.addEventListener("cancel",()=>{this.remove(),i()})}).finally(()=>Z(this,v,Ze).call(this))),P.click()},Q=new WeakSet,Cs=function(){const{div:P}=this;let{width:i,height:a}=t(this,z);const[s,c]=this.pageDimensions,u=.75;if(this.width)i=this.width*s,a=this.height*c;else if(i>u*s||a>u*c){const ct=Math.min(u*s/i,u*c/a);i*=ct,a*=ct}const[A,R]=this.parentDimensions;this.setDims(i*A/s,a*R/c),this._uiManager.enableWaiting(!1);const B=ot(this,L,document.createElement("canvas"));P.append(B),P.hidden=!1,Z(this,j,Ts).call(this,i,a),Z(this,et,zn).call(this),t(this,y)||(this.parent.addUndoableEditor(this),ot(this,y,!0)),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()},_t=new WeakSet,jn=function(P,i){var u;const[a,s]=this.parentDimensions;this.width=P/a,this.height=i/s,this.setDims(P,i),(u=this._initialOptions)!=null&&u.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,t(this,C)!==null&&clearTimeout(t(this,C)),ot(this,C,setTimeout(()=>{ot(this,C,null),Z(this,j,Ts).call(this,P,i)},200))},Pt=new WeakSet,Wn=function(P,i){const{width:a,height:s}=t(this,z);let c=a,u=s,A=t(this,z);for(;c>2*P||u>2*i;){const R=c,B=u;c>2*P&&(c=c>=16384?Math.floor(c/2)-1:Math.ceil(c/2)),u>2*i&&(u=u>=16384?Math.floor(u/2)-1:Math.ceil(u/2));const ct=new OffscreenCanvas(c,u);ct.getContext("2d").drawImage(A,0,0,R,B,0,0,c,u),A=ct.transferToImageBitmap()}return A},j=new WeakSet,Ts=function(P,i){P=Math.ceil(P),i=Math.ceil(i);const a=t(this,L);if(!a||a.width===P&&a.height===i)return;a.width=P,a.height=i;const s=t(this,p)?t(this,z):Z(this,Pt,Wn).call(this,P,i),c=a.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(s,0,0,s.width,s.height,0,0,P,i)},Et=new WeakSet,Pi=function(P){if(P){if(t(this,p)){const s=this._uiManager.imageManager.getSvgUrl(t(this,F));if(s)return s}const i=document.createElement("canvas");return{width:i.width,height:i.height}=t(this,z),i.getContext("2d").drawImage(t(this,z),0,0),i.toDataURL()}if(t(this,p)){const[i,a]=this.pageDimensions,s=Math.round(this.width*i*q.PixelsPerInch.PDF_TO_CSS_UNITS),c=Math.round(this.height*a*q.PixelsPerInch.PDF_TO_CSS_UNITS),u=new OffscreenCanvas(s,c);return u.getContext("2d").drawImage(t(this,z),0,0,t(this,z).width,t(this,z).height,0,0,s,c),u.transferToImageBitmap()}return structuredClone(t(this,z))},et=new WeakSet,zn=function(){ot(this,w,new ResizeObserver(P=>{const i=P[0].contentRect;i.width&&i.height&&Z(this,_t,jn).call(this,i.width,i.height)})),t(this,w).observe(this.div)},oe(Rt,"_type","stamp");let gt=Rt;o.StampEditor=gt}],b={};function E($){var o=b[$];if(o!==void 0)return o.exports;var X=b[$]={exports:{}};return h[$](X,X.exports,E),X.exports}var lt={};return(()=>{var $=lt;Object.defineProperty($,"__esModule",{value:!0}),Object.defineProperty($,"AbortException",{enumerable:!0,get:function(){return o.AbortException}}),Object.defineProperty($,"AnnotationEditorLayer",{enumerable:!0,get:function(){return q.AnnotationEditorLayer}}),Object.defineProperty($,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return o.AnnotationEditorParamsType}}),Object.defineProperty($,"AnnotationEditorType",{enumerable:!0,get:function(){return o.AnnotationEditorType}}),Object.defineProperty($,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return Y.AnnotationEditorUIManager}}),Object.defineProperty($,"AnnotationLayer",{enumerable:!0,get:function(){return gt.AnnotationLayer}}),Object.defineProperty($,"AnnotationMode",{enumerable:!0,get:function(){return o.AnnotationMode}}),Object.defineProperty($,"CMapCompressionType",{enumerable:!0,get:function(){return o.CMapCompressionType}}),Object.defineProperty($,"DOMSVGFactory",{enumerable:!0,get:function(){return r.DOMSVGFactory}}),Object.defineProperty($,"FeatureTest",{enumerable:!0,get:function(){return o.FeatureTest}}),Object.defineProperty($,"GlobalWorkerOptions",{enumerable:!0,get:function(){return z.GlobalWorkerOptions}}),Object.defineProperty($,"ImageKind",{enumerable:!0,get:function(){return o.ImageKind}}),Object.defineProperty($,"InvalidPDFException",{enumerable:!0,get:function(){return o.InvalidPDFException}}),Object.defineProperty($,"MissingPDFException",{enumerable:!0,get:function(){return o.MissingPDFException}}),Object.defineProperty($,"OPS",{enumerable:!0,get:function(){return o.OPS}}),Object.defineProperty($,"PDFDataRangeTransport",{enumerable:!0,get:function(){return X.PDFDataRangeTransport}}),Object.defineProperty($,"PDFDateString",{enumerable:!0,get:function(){return r.PDFDateString}}),Object.defineProperty($,"PDFWorker",{enumerable:!0,get:function(){return X.PDFWorker}}),Object.defineProperty($,"PasswordResponses",{enumerable:!0,get:function(){return o.PasswordResponses}}),Object.defineProperty($,"PermissionFlag",{enumerable:!0,get:function(){return o.PermissionFlag}}),Object.defineProperty($,"PixelsPerInch",{enumerable:!0,get:function(){return r.PixelsPerInch}}),Object.defineProperty($,"PromiseCapability",{enumerable:!0,get:function(){return o.PromiseCapability}}),Object.defineProperty($,"RenderingCancelledException",{enumerable:!0,get:function(){return r.RenderingCancelledException}}),Object.defineProperty($,"SVGGraphics",{enumerable:!0,get:function(){return X.SVGGraphics}}),Object.defineProperty($,"UnexpectedResponseException",{enumerable:!0,get:function(){return o.UnexpectedResponseException}}),Object.defineProperty($,"Util",{enumerable:!0,get:function(){return o.Util}}),Object.defineProperty($,"VerbosityLevel",{enumerable:!0,get:function(){return o.VerbosityLevel}}),Object.defineProperty($,"XfaLayer",{enumerable:!0,get:function(){return F.XfaLayer}}),Object.defineProperty($,"build",{enumerable:!0,get:function(){return X.build}}),Object.defineProperty($,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return o.createValidAbsoluteUrl}}),Object.defineProperty($,"getDocument",{enumerable:!0,get:function(){return X.getDocument}}),Object.defineProperty($,"getFilenameFromUrl",{enumerable:!0,get:function(){return r.getFilenameFromUrl}}),Object.defineProperty($,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return r.getPdfFilenameFromUrl}}),Object.defineProperty($,"getXfaPageViewport",{enumerable:!0,get:function(){return r.getXfaPageViewport}}),Object.defineProperty($,"isDataScheme",{enumerable:!0,get:function(){return r.isDataScheme}}),Object.defineProperty($,"isPdfFile",{enumerable:!0,get:function(){return r.isPdfFile}}),Object.defineProperty($,"loadScript",{enumerable:!0,get:function(){return r.loadScript}}),Object.defineProperty($,"noContextMenu",{enumerable:!0,get:function(){return r.noContextMenu}}),Object.defineProperty($,"normalizeUnicode",{enumerable:!0,get:function(){return o.normalizeUnicode}}),Object.defineProperty($,"renderTextLayer",{enumerable:!0,get:function(){return x.renderTextLayer}}),Object.defineProperty($,"setLayerDimensions",{enumerable:!0,get:function(){return r.setLayerDimensions}}),Object.defineProperty($,"shadow",{enumerable:!0,get:function(){return o.shadow}}),Object.defineProperty($,"updateTextLayer",{enumerable:!0,get:function(){return x.updateTextLayer}}),Object.defineProperty($,"version",{enumerable:!0,get:function(){return X.version}});var o=E(1),X=E(2),r=E(6),x=E(26),q=E(27),Y=E(5),gt=E(29),z=E(14),F=E(32)})(),lt})())})(hn);var Gn=hn.exports,Hr=Object.defineProperty,jr=Object.getOwnPropertyDescriptor,Xn=(f,n,h,b)=>{for(var E=b>1?void 0:b?jr(n,h):n,lt=f.length-1,$;lt>=0;lt--)($=f[lt])&&(E=(b?$(n,h,E):$(E))||E);return b&&E&&Hr(n,h,E),E};Gn.GlobalWorkerOptions.workerSrc="pdf.worker.js";let Di=class extends be{constructor(){super(...arguments),this.tabIndex=0,this.indicator=0,this._onkeydown=f=>{f.key==="ArrowRight"?(this.position++,this.fireSelectEvent()):f.key==="ArrowLeft"&&(this.position--,this.fireSelectEvent())},this._touchStart={x:0,y:0},this._onTouchStart=f=>{this._touchStart={x:f.touches[0].clientX,y:f.touches[0].clientY}},this._onTouchEnd=f=>{const n=f.changedTouches[0].clientX,h=f.changedTouches[0].clientY,b=50;Xi(this._touchStart.y,h)>Xi(this._touchStart.x,n)||(this._touchStart.x-n>b?(this.position++,this.fireSelectEvent()):n-this._touchStart.x>b&&(this.position--,this.fireSelectEvent()))}}render(){return pe`
      <slot>
        <p>
          Get your sheet together!
          <br>
          Load a PDF ⬆️
          <br>
          or try <a href="#" @click=${()=>this.load("martin.pdf")}>Bratec Martin</a> example
        </p>
      </slot>
    `}async load(f){this.innerHTML="";const n=window.devicePixelRatio||1,h=await Gn.getDocument(f).promise;for(let b=0;b<h.numPages;b++){const E=await h.getPage(b+1),lt=E.getViewport({scale:1}),$=document.createElement("canvas"),o=$.getContext("2d");$.height=lt.height*n,$.width=lt.width*n,this.appendChild($),$.onclick=()=>{this.position=b,this.fireSelectEvent()};const X=n!==1?[n,0,0,n,0,0]:void 0;await E.render({canvasContext:o,viewport:lt,transform:X}).promise}}set position(f){const n=[...this.children];if(f<0||f>=n.length)return;const h=n[f];n.forEach(b=>b.removeAttribute("selected")),h.setAttribute("selected",""),h.scrollIntoView({block:"center"})}get position(){return[...this.children].findIndex(f=>f.hasAttribute("selected"))}connectedCallback(){super.connectedCallback(),this.addEventListener("keydown",this._onkeydown),this.addEventListener("touchstart",this._onTouchStart),this.addEventListener("touchend",this._onTouchEnd)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("keydown",this._onkeydown),this.removeEventListener("touchstart",this._onTouchStart),this.removeEventListener("touchend",this._onTouchEnd)}fireSelectEvent(){this.dispatchEvent(new CustomEvent("select",{detail:this.position}))}};Di.styles=ve`
    :host {
      min-height: 50px;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      align-items: center;
      overflow: auto;
      padding: 0.5rem;
      outline: none;
    }
    :host:focus {
      background: var(--theme-color-background-light);
    }
    :host:fullscreen {
      background: black;
    }
    ::slotted(canvas) {
      max-height: 100%;
      max-width: 100%;
    }
    ::slotted(canvas[selected]) {
      box-shadow: 0 0 0 5px var(--theme-color-primary);
    }
    p {
      text-align: center;
    }
  `;Xn([he({type:Number})],Di.prototype,"indicator",2);Di=Xn([we("pdf-viewer")],Di);var Wr=Object.defineProperty,zr=Object.getOwnPropertyDescriptor,ci=(f,n,h,b)=>{for(var E=b>1?void 0:b?zr(n,h):n,lt=f.length-1,$;lt>=0;lt--)($=f[lt])&&(E=(b?$(n,h,E):$(E))||E);return b&&E&&Wr(n,h,E),E};const Ys=localStorage.getItem("recognitionOptions"),di=Ys?JSON.parse(Ys):{minDistance:7,maxDistance:42,seekStep:2.6,treshold:100},ui={minDistance:"Shortest seek distance from current frame.",maxDistance:"Longest seek distance from current frame.",seekStep:"How many frames to add to seek distance when recognizer predicts the same frame as before.",treshold:"How different can current microphone data be compared to a frame from recording to be considered a match. 0 means identical, 255 means completely different."};let Re=class extends be{constructor(){super(...arguments),this.minDistance=di.minDistance,this.maxDistance=di.maxDistance,this.seekStep=di.seekStep,this.treshold=di.treshold}render(){return pe`
      <div>
        <label for="minDistance" title=${ui.minDistance}>Min Distance</label>
        <input 
          type="number" id="minDistance"
          min="1" max=${this.maxDistance-1}
          .value=${this.minDistance.toString()} 
          @change=${f=>{this.minDistance=Number(f.target.value),this.maxDistance=Math.max(this.minDistance+1,this.maxDistance)}} />
      </div>
      <div>
        <label for="maxDistance" title=${ui.maxDistance}>Max Distance</label>
        <input 
          type="number" id="maxDistance" 
          min=${this.minDistance+1}
          .value=${this.maxDistance.toString()}
          @change=${f=>{this.maxDistance=Number(f.target.value),this.minDistance=Math.max(0,Math.min(this.maxDistance-1,this.minDistance))}} />
      </div>
      <div>
        <label for="seekStep" title=${ui.seekStep}>Seek Step</label>
        <input 
          type="number" id="seekStep"
          step=".1" min="1"
          .value=${this.seekStep.toString()} 
          @change=${f=>this.seekStep=Number(f.target.value)} />
      </div>
      <div>
        <label for="treshold" title=${ui.treshold}>Treshold</label>
        <input 
          type="number" id="treshold" 
          min="0" max="255" 
          .value=${this.treshold.toString()} 
          @input=${f=>this.treshold=Number(f.target.value)} 
        />
      </div>
    `}updated(){localStorage.setItem("recognitionOptions",JSON.stringify({minDistance:this.minDistance,maxDistance:this.maxDistance,seekStep:this.seekStep,treshold:this.treshold}))}};Re.styles=ve`
    :host {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 1em;
      justify-content: center;
      margin: 0 auto;
    }
    div {
      min-width: 120px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
    }
    input {
      margin: 0.5em 0;
      width: 6ch;
    }

  `;ci([he({type:Number})],Re.prototype,"minDistance",2);ci([he({type:Number})],Re.prototype,"maxDistance",2);ci([he({type:Number})],Re.prototype,"seekStep",2);ci([he({type:Number})],Re.prototype,"treshold",2);Re=ci([we("recognition-options")],Re);var Gr=Object.defineProperty,Xr=Object.getOwnPropertyDescriptor,Vn=(f,n,h,b)=>{for(var E=b>1?void 0:b?Xr(n,h):n,lt=f.length-1,$;lt>=0;lt--)($=f[lt])&&(E=(b?$(n,h,E):$(E))||E);return b&&E&&Gr(n,h,E),E};let Wi=1,Oi=class extends be{constructor(){super(...arguments),this.position=0}render(){return this.recording?pe`
      <div class="container">
        ${this.recording.markings.map((f,n)=>{const[h,b]=f;return pe`
            <div
              class="mark"
              style="left: ${h/this.recording.data.length*100}%"
              @click=${()=>{this.dispatchEvent(new CustomEvent("select",{detail:{position:h,mark:b}}))}}
              @dblclick=${()=>{this.recording.markings.splice(n,1),this.requestUpdate(),this.fireChangeEvent(),Wi=b}}
            >${b.toString()}</div>
          `})}
      </div>

      <button
        @click=${()=>{const f=parseInt(prompt("Input page number",Wi.toString())||"0");!f||f<1||(Wi=f+1,this.recording.markings.push([this.position,f]),this.recording.markings.sort((n,h)=>n[0]-h[0]),this.requestUpdate(),this.fireChangeEvent())}}
      >Add Mark</button> 

      Double tap to remove
    `:null}fireChangeEvent(){this.dispatchEvent(new CustomEvent("change"))}};Oi.styles=[Rs,ve`
      :host {
        display: block;
        text-align: center;
      }
      .container {
        position: relative;
        height: 1rem;
        margin-bottom: .5rem;
      }
      .mark {
        position: absolute;
        transform: translateX(-50%);
        border-radius: 50%;
        background: var(--theme-color-background-light);
        width: 1rem;
        height: 1rem;
        font-size: .7rem;
        line-height: 1rem;
        text-align: center;
        cursor: pointer;
        user-select: none;
      }
      .mark::before {
        content: '';
        position: absolute;
        top: 0;
        left: 50%;
        transform: translate(-50%, -20%) rotate(45deg);
        width: .5rem;
        height: .5rem;
        background: var(--theme-color-background-light);
        z-index: -1;
      }
    `];Vn([he({type:Object})],Oi.prototype,"recording",2);Oi=Vn([we("markings-editor")],Oi);var Vr=Object.defineProperty,qr=Object.getOwnPropertyDescriptor,hi=(f,n,h,b)=>{for(var E=b>1?void 0:b?qr(n,h):n,lt=f.length-1,$;lt>=0;lt--)($=f[lt])&&(E=(b?$(n,h,E):$(E))||E);return b&&E&&Vr(n,h,E),E};let Fe=class extends be{constructor(){super(...arguments),this.value=0,this.min=0,this.max=100,this.step=1}render(){return pe`
      <div 
        class="container"
        tabindex="0"
        @mousedown=${this._handleMouse}
        @touchstart=${this._handleTouch}
        @keydown=${this._handleKey}
      >
        <div class="track"></div>
        <div class="thumb" style="left: ${pi(0,100,on(this.min,this.max,this.value))}%"></div>
      </div>
    `}_handleMouse(f){const n=b=>{b.preventDefault();const E=this.getBoundingClientRect(),lt=(b.clientX-E.left)/E.width,$=pi(this.min,this.max,lt);this.value=Math.max(this.min,Math.min(this.max,Math.round($/this.step)*this.step)),this._fireChangeEvent()},h=()=>{document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",h)};n(f),document.addEventListener("mousemove",n),document.addEventListener("mouseup",h)}_handleTouch(f){const n=b=>{b.preventDefault();const E=this.getBoundingClientRect(),lt=(b.touches[0].clientX-E.left)/E.width,$=pi(this.min,this.max,lt);this.value=Math.max(this.min,Math.min(this.max,Math.round($/this.step)*this.step)),this._fireChangeEvent()},h=()=>{document.removeEventListener("touchmove",n),document.removeEventListener("touchend",h),document.removeEventListener("touchcancel",h)};n(f),document.addEventListener("touchmove",n),document.addEventListener("touchend",h),document.addEventListener("touchcancel",h)}_handleKey(f){switch(f.key){case"ArrowLeft":case"ArrowDown":this.value=Math.max(this.min,this.value-this.step),this._fireChangeEvent();break;case"ArrowRight":case"ArrowUp":this.value=Math.min(this.max,this.value+this.step),this._fireChangeEvent();break;case"Home":this.value=this.min,this._fireChangeEvent();break;case"End":this.value=this.max,this._fireChangeEvent();break}}_fireChangeEvent(){this.dispatchEvent(new CustomEvent("change",{detail:this.value}))}};Fe.styles=ve`
    :host {
      display: block;
      width: 100%;
    }
    .container {
      position: relative;
      width: 100%;
      height: 1em;
    }
    .track {
      position: absolute;
      top: 50%;
      left: 0;
      width: 100%;
      height: .1em;
      background: var(--theme-color-background-light);
      transform: translateY(-50%);
      border-radius: .1em;
      pointer-events: none;
      touch-action: none;
    }
    .thumb {
      position: absolute;
      top: 50%;
      left: 0;
      width: .8em;
      height: .8em;
      background: var(--theme-color-primary);
      transform: translate(-50%, -50%);
      border-radius: .5em;
      pointer-events: none;
      touch-action: none;
    }
    .container:focus .thumb {
      width: 1em;
      height: 1em;
    }
  `;hi([he({type:Number})],Fe.prototype,"value",2);hi([he({type:Number})],Fe.prototype,"min",2);hi([he({type:Number})],Fe.prototype,"max",2);hi([he({type:Number})],Fe.prototype,"step",2);Fe=hi([we("input-slider")],Fe);const Yr=ve`
  input {
    background: var(--theme-color-background-light);
    border: none;
    outline: none;
    display: block;
    /* box-sizing: border-box; */
  }

  input[type="range"] {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    margin: .4em 0;
    border-radius: .1em;
    cursor: pointer;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    width: .2em;
    height: .2em;
    border-radius: .1em;
    background: var(--theme-color-primary);
    transform: scale(5);
  }
  input[type="range"]:focus::-webkit-slider-thumb {
    transform: scale(6);
  }

`,Os=(()=>{if(typeof self>"u")return!1;if("top"in self&&self!==top)try{top.window.document._=0}catch{return!1}return"showOpenFilePicker"in self})(),Kr=Os?Promise.resolve().then(function(){return ea}):Promise.resolve().then(function(){return oa});async function Ks(...f){return(await Kr).default(...f)}Os?Promise.resolve().then(function(){return sa}):Promise.resolve().then(function(){return ca});const Jr=Os?Promise.resolve().then(function(){return ra}):Promise.resolve().then(function(){return da});async function Qr(...f){return(await Jr).default(...f)}const Zr=async f=>{const n=await f.getFile();return n.handle=f,n};var ta=async(f=[{}])=>{Array.isArray(f)||(f=[f]);const n=[];f.forEach((E,lt)=>{n[lt]={description:E.description||"Files",accept:{}},E.mimeTypes?E.mimeTypes.map($=>{n[lt].accept[$]=E.extensions||[]}):n[lt].accept["*/*"]=E.extensions||[]});const h=await window.showOpenFilePicker({id:f[0].id,startIn:f[0].startIn,types:n,multiple:f[0].multiple||!1,excludeAcceptAllOption:f[0].excludeAcceptAllOption||!1}),b=await Promise.all(h.map(Zr));return f[0].multiple?b:b[0]},ea={__proto__:null,default:ta};function ki(f){function n(h){if(Object(h)!==h)return Promise.reject(new TypeError(h+" is not an object."));var b=h.done;return Promise.resolve(h.value).then(function(E){return{value:E,done:b}})}return ki=function(h){this.s=h,this.n=h.next},ki.prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(h){var b=this.s.return;return b===void 0?Promise.resolve({value:h,done:!0}):n(b.apply(this.s,arguments))},throw:function(h){var b=this.s.return;return b===void 0?Promise.reject(h):n(b.apply(this.s,arguments))}},new ki(f)}const qn=async(f,n,h=f.name,b)=>{const E=[],lt=[];var $,o=!1,X=!1;try{for(var r,x=function(q){var Y,gt,z,F=2;for(typeof Symbol<"u"&&(gt=Symbol.asyncIterator,z=Symbol.iterator);F--;){if(gt&&(Y=q[gt])!=null)return Y.call(q);if(z&&(Y=q[z])!=null)return new ki(Y.call(q));gt="@@asyncIterator",z="@@iterator"}throw new TypeError("Object is not async iterable")}(f.values());o=!(r=await x.next()).done;o=!1){const q=r.value,Y=`${h}/${q.name}`;q.kind==="file"?lt.push(q.getFile().then(gt=>(gt.directoryHandle=f,gt.handle=q,Object.defineProperty(gt,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>Y})))):q.kind!=="directory"||!n||b&&b(q)||E.push(qn(q,n,Y,b))}}catch(q){X=!0,$=q}finally{try{o&&x.return!=null&&await x.return()}finally{if(X)throw $}}return[...(await Promise.all(E)).flat(),...await Promise.all(lt)]};var ia=async(f={})=>{f.recursive=f.recursive||!1,f.mode=f.mode||"read";const n=await window.showDirectoryPicker({id:f.id,startIn:f.startIn,mode:f.mode});return(await(await n.values()).next()).done?[n]:qn(n,f.recursive,void 0,f.skipDirectory)},sa={__proto__:null,default:ia},na=async(f,n=[{}],h=null,b=!1,E=null)=>{Array.isArray(n)||(n=[n]),n[0].fileName=n[0].fileName||"Untitled";const lt=[];let $=null;if(f instanceof Blob&&f.type?$=f.type:f.headers&&f.headers.get("content-type")&&($=f.headers.get("content-type")),n.forEach((r,x)=>{lt[x]={description:r.description||"Files",accept:{}},r.mimeTypes?(x===0&&$&&r.mimeTypes.push($),r.mimeTypes.map(q=>{lt[x].accept[q]=r.extensions||[]})):$?lt[x].accept[$]=r.extensions||[]:lt[x].accept["*/*"]=r.extensions||[]}),h)try{await h.getFile()}catch(r){if(h=null,b)throw r}const o=h||await window.showSaveFilePicker({suggestedName:n[0].fileName,id:n[0].id,startIn:n[0].startIn,types:lt,excludeAcceptAllOption:n[0].excludeAcceptAllOption||!1});!h&&E&&E(o);const X=await o.createWritable();return"stream"in f?(await f.stream().pipeTo(X),o):"body"in f?(await f.body.pipeTo(X),o):(await X.write(await f),await X.close(),o)},ra={__proto__:null,default:na},aa=async(f=[{}])=>(Array.isArray(f)||(f=[f]),new Promise((n,h)=>{const b=document.createElement("input");b.type="file";const E=[...f.map(X=>X.mimeTypes||[]),...f.map(X=>X.extensions||[])].join();b.multiple=f[0].multiple||!1,b.accept=E||"",b.style.display="none",document.body.append(b);const lt=X=>{typeof $=="function"&&$(),n(X)},$=f[0].legacySetup&&f[0].legacySetup(lt,()=>$(h),b),o=()=>{window.removeEventListener("focus",o),b.remove()};b.addEventListener("click",()=>{window.addEventListener("focus",o)}),b.addEventListener("change",()=>{window.removeEventListener("focus",o),b.remove(),lt(b.multiple?Array.from(b.files):b.files[0])}),"showPicker"in HTMLInputElement.prototype?b.showPicker():b.click()})),oa={__proto__:null,default:aa},la=async(f=[{}])=>(Array.isArray(f)||(f=[f]),f[0].recursive=f[0].recursive||!1,new Promise((n,h)=>{const b=document.createElement("input");b.type="file",b.webkitdirectory=!0;const E=$=>{typeof lt=="function"&&lt(),n($)},lt=f[0].legacySetup&&f[0].legacySetup(E,()=>lt(h),b);b.addEventListener("change",()=>{let $=Array.from(b.files);f[0].recursive?f[0].recursive&&f[0].skipDirectory&&($=$.filter(o=>o.webkitRelativePath.split("/").every(X=>!f[0].skipDirectory({name:X,kind:"directory"})))):$=$.filter(o=>o.webkitRelativePath.split("/").length===2),E($)}),"showPicker"in HTMLInputElement.prototype?b.showPicker():b.click()})),ca={__proto__:null,default:la},ha=async(f,n={})=>{Array.isArray(n)&&(n=n[0]);const h=document.createElement("a");let b=f;"body"in f&&(b=await async function($,o){const X=$.getReader(),r=new ReadableStream({start:Y=>async function gt(){return X.read().then(({done:z,value:F})=>{if(!z)return Y.enqueue(F),gt();Y.close()})}()}),x=new Response(r),q=await x.blob();return X.releaseLock(),new Blob([q],{type:o})}(f.body,f.headers.get("content-type"))),h.download=n.fileName||"Untitled",h.href=URL.createObjectURL(await b);const E=()=>{typeof lt=="function"&&lt()},lt=n.legacySetup&&n.legacySetup(E,()=>lt(),h);return h.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(h.href),3e4),E()}),h.click(),null},da={__proto__:null,default:ha};function Is(f){return new Promise((n,h)=>{f.oncomplete=f.onsuccess=()=>n(f.result),f.onabort=f.onerror=()=>h(f.error)})}function ua(f,n){const h=indexedDB.open(f);h.onupgradeneeded=()=>h.result.createObjectStore(n);const b=Is(h);return(E,lt)=>b.then($=>lt($.transaction(n,E).objectStore(n)))}let zi;function Yn(){return zi||(zi=ua("keyval-store","keyval")),zi}function Js(f,n=Yn()){return n("readonly",h=>Is(h.get(f)))}function Gi(f,n,h=Yn()){return h("readwrite",b=>(b.put(n,f),Is(b.transaction)))}async function Qs(f,n=!1){const h=n?{mode:"readwrite"}:{};return await f.queryPermission(h)==="granted"||await f.requestPermission(h)==="granted"}var fa=Object.defineProperty,pa=Object.getOwnPropertyDescriptor,fe=(f,n,h,b)=>{for(var E=b>1?void 0:b?pa(n,h):n,lt=f.length-1,$;lt>=0;lt--)($=f[lt])&&(E=(b?$(n,h,E):$(E))||E);return b&&E&&fa(n,h,E),E};let de=class extends be{constructor(){super(...arguments),this.savedState=!0,this.recentAvailable=!1,this.position=0}render(){return[this.renderHeader(),this.renderViewer(),this.renderRecording(),this.renderPageTurner()]}updated(f){if(f.has("position")){if(this.follower&&(this.follower.position=this.position),!this.scrollable)return;const n=this.scrollable.scrollWidth-this.scrollable.clientWidth,h=this.position/this.recording.data.length;this.scrollable.scrollTo({left:h*n,behavior:"auto"})}}connectedCallback(){super.connectedCallback(),this.findRecent()}async findRecent(){this.recentPDF=await Js("pdf"),this.recentRecording=await Js("recording")}renderHeader(){var f;return pe`
      <header>

        <button
          title="Open PDF"
          @click=${async()=>{const n=await Ks({mimeTypes:["application/pdf"]}),h=await n.arrayBuffer();this.viewer.load(h),n.handle&&Gi("pdf",n.handle)}}
        >
          📄 Sheet
        </button>

        <button
          ?hidden=${!this.recentPDF}
          title="Open Recent PDF - ${(f=this.recentPDF)==null?void 0:f.name}"
          @click=${async()=>{if(!this.recentPDF||!await Qs(this.recentPDF))return;const h=await(await this.recentPDF.getFile()).arrayBuffer();await this.viewer.load(h),this.recentPDF=void 0}}
        >
          🕒
        </button>

        <button
          title="Fullscreen"
          @click=${()=>{this.viewer.requestFullscreen(),this.viewer.focus()}}
        >
          ↗️
        </button>

      </header>
    `}renderViewer(){return pe`
      <pdf-viewer
        @select=${f=>{if(!this.recording)return;const n=this.recording.markings.filter(b=>b[1]===f.detail+1);if(n.length===0)return;const h=n.reduce((b,E)=>Math.abs(E[0]-this.position)<Math.abs(b[0]-this.position)?E:b);this.position=h[0]}}
      ></pdf-viewer>
    `}renderRecording(){var f,n;return pe`
      <collapsable-container
        id="recording"
        .title=${"Recording"+(this.recordingFile?" - "+this.recordingFile.name.replace(/\.json$/,""):"")}
        .description=${this.savedState?"":"Unsaved changes"}
      >
        <frequency-recorder
          id="recorder"
          title="Record"
          slot="header"
          @data=${h=>{this.recording.data.push(h.detail)}}
          @start=${()=>{this.recognizer.stop(),this.recording=new He}}
          @stop=${()=>{this.spectrogram.requestUpdate(),this.markings.requestUpdate(),this.savedState=!1,this.recordingFile=void 0,this.recordingElement.setAttribute("open",""),this.position=0}}
        >
          🎙 Record
        </frequency-recorder>

        <button
          title="Open Recording"
          slot="header"
          @click=${async()=>{const h=await Ks({mimeTypes:["application/json"]}),b=await h.text();this.recordingElement.setAttribute("open",""),h.handle&&(this.recordingFile=h.handle,Gi("recording",h.handle)),this.recording=He.import(JSON.parse(b)),this.savedState=!0,this.position=0}}
        >
          📂
        </button>

        <button
          ?hidden=${!this.recentRecording}
          title="Open Recent Recording - ${(f=this.recentRecording)==null?void 0:f.name}"
          slot="header"
          @click=${async()=>{if(this.recentRecording&&await Qs(this.recentRecording))try{const b=await(await this.recentRecording.getFile()).text();this.recordingFile=this.recentRecording,this.recentRecording=void 0,this.recordingElement.setAttribute("open",""),this.recording=He.import(JSON.parse(b)),this.savedState=!0,this.position=0}catch{this.recentRecording=void 0}}}
        >
          🕒
        </button>

        <button
          title="Save Recording"
          slot="header"
          ?hidden=${this.savedState}
          @click=${async()=>{if(!this.recording)return;const h=JSON.stringify(this.recording.export()),b=new Blob([h],{type:"application/json"}),E=await Qr(b,{fileName:"Recording.json",extensions:[".json"]},this.recordingFile);this.savedState=!0,E&&(this.recordingFile=E,Gi("recording",E))}}
        >
          💾
        </button>

        ${this.recording?pe`
              <div class="container">
                <div
                  id="scrollable"
                  @mousewheel=${h=>{this.recording&&(h.preventDefault(),this.position=Math.max(0,Math.min(this.recording.data.length,this.position+h.deltaX+h.deltaY)))}}
                >
                  <graph-2d
                    id="spectrogram"
                    .data=${((n=this.recording)==null?void 0:n.data)||[]}
                    @select=${h=>{if(!this.recording)return;const{column:b,row:E}=h.detail;console.log(`Frame: ${b}, Row: ${E}, Value: ${this.recording.data[b][E]}`),this.position=b}}
                  ></graph-2d>

                  <graph-1d id="similarity"></graph-1d>
                </div>

                <input-slider
                  id="position"
                  .max=${this.recording.data.length}
                  .value=${this.position}
                  @change=${h=>{this.recording&&(this.position=h.detail)}}
                ></input-slider>
                
                <markings-editor
                  .recording=${this.recording}
                  .position=${this.position}
                  @select=${h=>{const{position:b}=h.detail;this.position=b}}
                  @change=${()=>{this.recording&&(this.savedState=!1)}}
                ></markings-editor>

              </div>
            `:pe`
              <p>Make a recording to use the automatic page turner feature.</p>
            `}

      </collapsable-container>
    `}renderPageTurner(){return pe`
      <collapsable-container .title=${"Page Turner"} ?hidden=${!this.recording}>

        <frequency-recorder
          id="recognizer"
          title="Recognize"
          slot="header"
          @data=${f=>{if(!this.follower||!this.recording)return;const{position:n,mark:h,differences:b,over:E}=this.follower.guess(f.detail,this.recognitionOptions);if(E)return this.recognizer.stop();this.position=n||0;const lt=new Uint8Array(this.recording.data.length);b==null||b.forEach(($,o)=>lt[o+this.position]=$),this.similarity.data=lt,h&&h!==this.viewer.position+1&&(this.viewer.position=h-1)}}
          @start=${()=>{this.recording&&(this.recorder.stop(),this.follower=this.recording.createFollower(),this.position>=this.recording.data.length-100&&(this.position=0))}}
        >
          🔎 Recognize
        </frequency-recorder>

        <recognition-options></recognition-options>

      </collapsable-container>
    `}};de.styles=[Yr,Rs,ve`
      :host {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100%;
      }

      header {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.5em;
        margin: 10px;
      }

      pdf-viewer {
        flex: 1;
      }

      #position {
        width: 100%;
      }

      #scrollable {
        overflow: hidden;
        border: 1px solid grey;
        background: var(--color-black);
      }

      .container {
        width: min-content;
        max-width: 100%;
        margin: 0 auto;
      }
    `];fe([ye("pdf-viewer")],de.prototype,"viewer",2);fe([ye("#recording")],de.prototype,"recordingElement",2);fe([ye("#recorder")],de.prototype,"recorder",2);fe([ye("#scrollable")],de.prototype,"scrollable",2);fe([ye("#spectrogram")],de.prototype,"spectrogram",2);fe([ye("#similarity")],de.prototype,"similarity",2);fe([ye("#position")],de.prototype,"positionSlider",2);fe([ye("markings-editor")],de.prototype,"markings",2);fe([ye("#recognizer")],de.prototype,"recognizer",2);fe([ye("recognition-options")],de.prototype,"recognitionOptions",2);fe([he({type:Object})],de.prototype,"recording",2);fe([he({type:Object})],de.prototype,"recordingFile",2);fe([he({type:Boolean})],de.prototype,"savedState",2);fe([he({type:Boolean})],de.prototype,"recentAvailable",2);fe([he({type:Object})],de.prototype,"recentPDF",2);fe([he({type:Object})],de.prototype,"recentRecording",2);fe([he({type:Number})],de.prototype,"position",2);de=fe([we("my-app")],de);
