var Hn=Object.defineProperty;var jn=(A,a,u)=>a in A?Hn(A,a,{enumerable:!0,configurable:!0,writable:!0,value:u}):A[a]=u;var oe=(A,a,u)=>(jn(A,typeof a!="symbol"?a+"":a,u),u),Fi=(A,a,u)=>{if(!a.has(A))throw TypeError("Cannot "+u)};var t=(A,a,u)=>(Fi(A,a,"read from private field"),u?u.call(A):a.get(A)),$=(A,a,u)=>{if(a.has(A))throw TypeError("Cannot add the same private member more than once");a instanceof WeakSet?a.add(A):a.set(A,u)},ot=(A,a,u,_)=>(Fi(A,a,"write to private field"),_?_.call(A,u):a.set(A,u),u);var We=(A,a,u,_)=>({set _(R){ot(A,a,R,u)},get _(){return t(A,a,_)}}),Z=(A,a,u)=>(Fi(A,a,"access private method"),u);(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const R of document.querySelectorAll('link[rel="modulepreload"]'))_(R);new MutationObserver(R=>{for(const ht of R)if(ht.type==="childList")for(const U of ht.addedNodes)U.tagName==="LINK"&&U.rel==="modulepreload"&&_(U)}).observe(document,{childList:!0,subtree:!0});function u(R){const ht={};return R.integrity&&(ht.integrity=R.integrity),R.referrerPolicy&&(ht.referrerPolicy=R.referrerPolicy),R.crossOrigin==="use-credentials"?ht.credentials="include":R.crossOrigin==="anonymous"?ht.credentials="omit":ht.credentials="same-origin",ht}function _(R){if(R.ep)return;R.ep=!0;const ht=u(R);fetch(R.href,ht)}})();/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const hi=globalThis,Ss=hi.ShadowRoot&&(hi.ShadyCSS===void 0||hi.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Es=Symbol(),Rs=new WeakMap;let Vs=class{constructor(a,u,_){if(this._$cssResult$=!0,_!==Es)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=a,this.t=u}get styleSheet(){let a=this.o;const u=this.t;if(Ss&&a===void 0){const _=u!==void 0&&u.length===1;_&&(a=Rs.get(u)),a===void 0&&((this.o=a=new CSSStyleSheet).replaceSync(this.cssText),_&&Rs.set(u,a))}return a}toString(){return this.cssText}};const Wn=A=>new Vs(typeof A=="string"?A:A+"",void 0,Es),Se=(A,...a)=>{const u=A.length===1?A[0]:a.reduce((_,R,ht)=>_+(U=>{if(U._$cssResult$===!0)return U.cssText;if(typeof U=="number")return U;throw Error("Value passed to 'css' function must be a 'css' function result: "+U+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(R)+A[ht+1],A[0]);return new Vs(u,A,Es)},zn=(A,a)=>{if(Ss)A.adoptedStyleSheets=a.map(u=>u instanceof CSSStyleSheet?u:u.styleSheet);else for(const u of a){const _=document.createElement("style"),R=hi.litNonce;R!==void 0&&_.setAttribute("nonce",R),_.textContent=u.cssText,A.appendChild(_)}},Fs=Ss?A=>A:A=>A instanceof CSSStyleSheet?(a=>{let u="";for(const _ of a.cssRules)u+=_.cssText;return Wn(u)})(A):A;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:Gn,defineProperty:Xn,getOwnPropertyDescriptor:Vn,getOwnPropertyNames:qn,getOwnPropertySymbols:Yn,getPrototypeOf:Kn}=Object,Ce=globalThis,Ds=Ce.trustedTypes,Jn=Ds?Ds.emptyScript:"",Di=Ce.reactiveElementPolyfillSupport,Qe=(A,a)=>A,Ti={toAttribute(A,a){switch(a){case Boolean:A=A?Jn:null;break;case Object:case Array:A=A==null?A:JSON.stringify(A)}return A},fromAttribute(A,a){let u=A;switch(a){case Boolean:u=A!==null;break;case Number:u=A===null?null:Number(A);break;case Object:case Array:try{u=JSON.parse(A)}catch{u=null}}return u}},ws=(A,a)=>!Gn(A,a),Os={attribute:!0,type:String,converter:Ti,reflect:!1,hasChanged:ws};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Ce.litPropertyMetadata??(Ce.litPropertyMetadata=new WeakMap);let Oe=class extends HTMLElement{static addInitializer(a){this._$Ei(),(this.l??(this.l=[])).push(a)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(a,u=Os){if(u.state&&(u.attribute=!1),this._$Ei(),this.elementProperties.set(a,u),!u.noAccessor){const _=Symbol(),R=this.getPropertyDescriptor(a,_,u);R!==void 0&&Xn(this.prototype,a,R)}}static getPropertyDescriptor(a,u,_){const{get:R,set:ht}=Vn(this.prototype,a)??{get(){return this[u]},set(U){this[u]=U}};return{get(){return R==null?void 0:R.call(this)},set(U){const o=R==null?void 0:R.call(this);ht.call(this,U),this.requestUpdate(a,o,_)},configurable:!0,enumerable:!0}}static getPropertyOptions(a){return this.elementProperties.get(a)??Os}static _$Ei(){if(this.hasOwnProperty(Qe("elementProperties")))return;const a=Kn(this);a.finalize(),a.l!==void 0&&(this.l=[...a.l]),this.elementProperties=new Map(a.elementProperties)}static finalize(){if(this.hasOwnProperty(Qe("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Qe("properties"))){const u=this.properties,_=[...qn(u),...Yn(u)];for(const R of _)this.createProperty(R,u[R])}const a=this[Symbol.metadata];if(a!==null){const u=litPropertyMetadata.get(a);if(u!==void 0)for(const[_,R]of u)this.elementProperties.set(_,R)}this._$Eh=new Map;for(const[u,_]of this.elementProperties){const R=this._$Eu(u,_);R!==void 0&&this._$Eh.set(R,u)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(a){const u=[];if(Array.isArray(a)){const _=new Set(a.flat(1/0).reverse());for(const R of _)u.unshift(Fs(R))}else a!==void 0&&u.push(Fs(a));return u}static _$Eu(a,u){const _=u.attribute;return _===!1?void 0:typeof _=="string"?_:typeof a=="string"?a.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var a;this._$ES=new Promise(u=>this.enableUpdating=u),this._$AL=new Map,this._$E_(),this.requestUpdate(),(a=this.constructor.l)==null||a.forEach(u=>u(this))}addController(a){var u;(this._$EO??(this._$EO=new Set)).add(a),this.renderRoot!==void 0&&this.isConnected&&((u=a.hostConnected)==null||u.call(a))}removeController(a){var u;(u=this._$EO)==null||u.delete(a)}_$E_(){const a=new Map,u=this.constructor.elementProperties;for(const _ of u.keys())this.hasOwnProperty(_)&&(a.set(_,this[_]),delete this[_]);a.size>0&&(this._$Ep=a)}createRenderRoot(){const a=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return zn(a,this.constructor.elementStyles),a}connectedCallback(){var a;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(a=this._$EO)==null||a.forEach(u=>{var _;return(_=u.hostConnected)==null?void 0:_.call(u)})}enableUpdating(a){}disconnectedCallback(){var a;(a=this._$EO)==null||a.forEach(u=>{var _;return(_=u.hostDisconnected)==null?void 0:_.call(u)})}attributeChangedCallback(a,u,_){this._$AK(a,_)}_$EC(a,u){var ht;const _=this.constructor.elementProperties.get(a),R=this.constructor._$Eu(a,_);if(R!==void 0&&_.reflect===!0){const U=(((ht=_.converter)==null?void 0:ht.toAttribute)!==void 0?_.converter:Ti).toAttribute(u,_.type);this._$Em=a,U==null?this.removeAttribute(R):this.setAttribute(R,U),this._$Em=null}}_$AK(a,u){var ht;const _=this.constructor,R=_._$Eh.get(a);if(R!==void 0&&this._$Em!==R){const U=_.getPropertyOptions(R),o=typeof U.converter=="function"?{fromAttribute:U.converter}:((ht=U.converter)==null?void 0:ht.fromAttribute)!==void 0?U.converter:Ti;this._$Em=R,this[R]=o.fromAttribute(u,U.type),this._$Em=null}}requestUpdate(a,u,_){if(a!==void 0){if(_??(_=this.constructor.getPropertyOptions(a)),!(_.hasChanged??ws)(this[a],u))return;this.P(a,u,_)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(a,u,_){this._$AL.has(a)||this._$AL.set(a,u),_.reflect===!0&&this._$Em!==a&&(this._$Ej??(this._$Ej=new Set)).add(a)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(u){Promise.reject(u)}const a=this.scheduleUpdate();return a!=null&&await a,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var _;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[ht,U]of this._$Ep)this[ht]=U;this._$Ep=void 0}const R=this.constructor.elementProperties;if(R.size>0)for(const[ht,U]of R)U.wrapped!==!0||this._$AL.has(ht)||this[ht]===void 0||this.P(ht,this[ht],U)}let a=!1;const u=this._$AL;try{a=this.shouldUpdate(u),a?(this.willUpdate(u),(_=this._$EO)==null||_.forEach(R=>{var ht;return(ht=R.hostUpdate)==null?void 0:ht.call(R)}),this.update(u)):this._$EU()}catch(R){throw a=!1,this._$EU(),R}a&&this._$AE(u)}willUpdate(a){}_$AE(a){var u;(u=this._$EO)==null||u.forEach(_=>{var R;return(R=_.hostUpdated)==null?void 0:R.call(_)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(a)),this.updated(a)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(a){return!0}update(a){this._$Ej&&(this._$Ej=this._$Ej.forEach(u=>this._$EC(u,this[u]))),this._$EU()}updated(a){}firstUpdated(a){}};Oe.elementStyles=[],Oe.shadowRootOptions={mode:"open"},Oe[Qe("elementProperties")]=new Map,Oe[Qe("finalized")]=new Map,Di==null||Di({ReactiveElement:Oe}),(Ce.reactiveElementVersions??(Ce.reactiveElementVersions=[])).push("2.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ze=globalThis,Pi=Ze.trustedTypes,Is=Pi?Pi.createPolicy("lit-html",{createHTML:A=>A}):void 0,qs="$lit$",we=`lit$${(Math.random()+"").slice(9)}$`,Ys="?"+we,Qn=`<${Ys}>`,Me=document,ti=()=>Me.createComment(""),ei=A=>A===null||typeof A!="object"&&typeof A!="function",Ks=Array.isArray,Zn=A=>Ks(A)||typeof(A==null?void 0:A[Symbol.iterator])=="function",Oi=`[ 	
\f\r]`,ze=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Ls=/-->/g,Ns=/>/g,Pe=RegExp(`>|${Oi}(?:([^\\s"'>=/]+)(${Oi}*=${Oi}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),$s=/'/g,Us=/"/g,Js=/^(?:script|style|textarea|title)$/i,tr=A=>(a,...u)=>({_$litType$:A,strings:a,values:u}),be=tr(1),Be=Symbol.for("lit-noChange"),de=Symbol.for("lit-nothing"),Bs=new WeakMap,ke=Me.createTreeWalker(Me,129);function Qs(A,a){if(!Array.isArray(A)||!A.hasOwnProperty("raw"))throw Error("invalid template strings array");return Is!==void 0?Is.createHTML(a):a}const er=(A,a)=>{const u=A.length-1,_=[];let R,ht=a===2?"<svg>":"",U=ze;for(let o=0;o<u;o++){const K=A[o];let n,P,V=-1,q=0;for(;q<K.length&&(U.lastIndex=q,P=U.exec(K),P!==null);)q=U.lastIndex,U===ze?P[1]==="!--"?U=Ls:P[1]!==void 0?U=Ns:P[2]!==void 0?(Js.test(P[2])&&(R=RegExp("</"+P[2],"g")),U=Pe):P[3]!==void 0&&(U=Pe):U===Pe?P[0]===">"?(U=R??ze,V=-1):P[1]===void 0?V=-2:(V=U.lastIndex-P[2].length,n=P[1],U=P[3]===void 0?Pe:P[3]==='"'?Us:$s):U===Us||U===$s?U=Pe:U===Ls||U===Ns?U=ze:(U=Pe,R=void 0);const gt=U===Pe&&A[o+1].startsWith("/>")?" ":"";ht+=U===ze?K+Qn:V>=0?(_.push(n),K.slice(0,V)+qs+K.slice(V)+we+gt):K+we+(V===-2?o:gt)}return[Qs(A,ht+(A[u]||"<?>")+(a===2?"</svg>":"")),_]};class ii{constructor({strings:a,_$litType$:u},_){let R;this.parts=[];let ht=0,U=0;const o=a.length-1,K=this.parts,[n,P]=er(a,u);if(this.el=ii.createElement(n,_),ke.currentNode=this.el.content,u===2){const V=this.el.content.firstChild;V.replaceWith(...V.childNodes)}for(;(R=ke.nextNode())!==null&&K.length<o;){if(R.nodeType===1){if(R.hasAttributes())for(const V of R.getAttributeNames())if(V.endsWith(qs)){const q=P[U++],gt=R.getAttribute(V).split(we),z=/([.?@])?(.*)/.exec(q);K.push({type:1,index:ht,name:z[2],strings:gt,ctor:z[1]==="."?sr:z[1]==="?"?nr:z[1]==="@"?rr:Mi}),R.removeAttribute(V)}else V.startsWith(we)&&(K.push({type:6,index:ht}),R.removeAttribute(V));if(Js.test(R.tagName)){const V=R.textContent.split(we),q=V.length-1;if(q>0){R.textContent=Pi?Pi.emptyScript:"";for(let gt=0;gt<q;gt++)R.append(V[gt],ti()),ke.nextNode(),K.push({type:2,index:++ht});R.append(V[q],ti())}}}else if(R.nodeType===8)if(R.data===Ys)K.push({type:2,index:ht});else{let V=-1;for(;(V=R.data.indexOf(we,V+1))!==-1;)K.push({type:7,index:ht}),V+=we.length-1}ht++}}static createElement(a,u){const _=Me.createElement("template");return _.innerHTML=a,_}}function He(A,a,u=A,_){var U,o;if(a===Be)return a;let R=_!==void 0?(U=u._$Co)==null?void 0:U[_]:u._$Cl;const ht=ei(a)?void 0:a._$litDirective$;return(R==null?void 0:R.constructor)!==ht&&((o=R==null?void 0:R._$AO)==null||o.call(R,!1),ht===void 0?R=void 0:(R=new ht(A),R._$AT(A,u,_)),_!==void 0?(u._$Co??(u._$Co=[]))[_]=R:u._$Cl=R),R!==void 0&&(a=He(A,R._$AS(A,a.values),R,_)),a}class ir{constructor(a,u){this._$AV=[],this._$AN=void 0,this._$AD=a,this._$AM=u}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(a){const{el:{content:u},parts:_}=this._$AD,R=((a==null?void 0:a.creationScope)??Me).importNode(u,!0);ke.currentNode=R;let ht=ke.nextNode(),U=0,o=0,K=_[0];for(;K!==void 0;){if(U===K.index){let n;K.type===2?n=new ai(ht,ht.nextSibling,this,a):K.type===1?n=new K.ctor(ht,K.name,K.strings,this,a):K.type===6&&(n=new ar(ht,this,a)),this._$AV.push(n),K=_[++o]}U!==(K==null?void 0:K.index)&&(ht=ke.nextNode(),U++)}return ke.currentNode=Me,R}p(a){let u=0;for(const _ of this._$AV)_!==void 0&&(_.strings!==void 0?(_._$AI(a,_,u),u+=_.strings.length-2):_._$AI(a[u])),u++}}class ai{get _$AU(){var a;return((a=this._$AM)==null?void 0:a._$AU)??this._$Cv}constructor(a,u,_,R){this.type=2,this._$AH=de,this._$AN=void 0,this._$AA=a,this._$AB=u,this._$AM=_,this.options=R,this._$Cv=(R==null?void 0:R.isConnected)??!0}get parentNode(){let a=this._$AA.parentNode;const u=this._$AM;return u!==void 0&&(a==null?void 0:a.nodeType)===11&&(a=u.parentNode),a}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(a,u=this){a=He(this,a,u),ei(a)?a===de||a==null||a===""?(this._$AH!==de&&this._$AR(),this._$AH=de):a!==this._$AH&&a!==Be&&this._(a):a._$litType$!==void 0?this.$(a):a.nodeType!==void 0?this.T(a):Zn(a)?this.k(a):this._(a)}S(a){return this._$AA.parentNode.insertBefore(a,this._$AB)}T(a){this._$AH!==a&&(this._$AR(),this._$AH=this.S(a))}_(a){this._$AH!==de&&ei(this._$AH)?this._$AA.nextSibling.data=a:this.T(Me.createTextNode(a)),this._$AH=a}$(a){var ht;const{values:u,_$litType$:_}=a,R=typeof _=="number"?this._$AC(a):(_.el===void 0&&(_.el=ii.createElement(Qs(_.h,_.h[0]),this.options)),_);if(((ht=this._$AH)==null?void 0:ht._$AD)===R)this._$AH.p(u);else{const U=new ir(R,this),o=U.u(this.options);U.p(u),this.T(o),this._$AH=U}}_$AC(a){let u=Bs.get(a.strings);return u===void 0&&Bs.set(a.strings,u=new ii(a)),u}k(a){Ks(this._$AH)||(this._$AH=[],this._$AR());const u=this._$AH;let _,R=0;for(const ht of a)R===u.length?u.push(_=new ai(this.S(ti()),this.S(ti()),this,this.options)):_=u[R],_._$AI(ht),R++;R<u.length&&(this._$AR(_&&_._$AB.nextSibling,R),u.length=R)}_$AR(a=this._$AA.nextSibling,u){var _;for((_=this._$AP)==null?void 0:_.call(this,!1,!0,u);a&&a!==this._$AB;){const R=a.nextSibling;a.remove(),a=R}}setConnected(a){var u;this._$AM===void 0&&(this._$Cv=a,(u=this._$AP)==null||u.call(this,a))}}class Mi{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(a,u,_,R,ht){this.type=1,this._$AH=de,this._$AN=void 0,this.element=a,this.name=u,this._$AM=R,this.options=ht,_.length>2||_[0]!==""||_[1]!==""?(this._$AH=Array(_.length-1).fill(new String),this.strings=_):this._$AH=de}_$AI(a,u=this,_,R){const ht=this.strings;let U=!1;if(ht===void 0)a=He(this,a,u,0),U=!ei(a)||a!==this._$AH&&a!==Be,U&&(this._$AH=a);else{const o=a;let K,n;for(a=ht[0],K=0;K<ht.length-1;K++)n=He(this,o[_+K],u,K),n===Be&&(n=this._$AH[K]),U||(U=!ei(n)||n!==this._$AH[K]),n===de?a=de:a!==de&&(a+=(n??"")+ht[K+1]),this._$AH[K]=n}U&&!R&&this.j(a)}j(a){a===de?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,a??"")}}let sr=class extends Mi{constructor(){super(...arguments),this.type=3}j(a){this.element[this.name]=a===de?void 0:a}};class nr extends Mi{constructor(){super(...arguments),this.type=4}j(a){this.element.toggleAttribute(this.name,!!a&&a!==de)}}class rr extends Mi{constructor(a,u,_,R,ht){super(a,u,_,R,ht),this.type=5}_$AI(a,u=this){if((a=He(this,a,u,0)??de)===Be)return;const _=this._$AH,R=a===de&&_!==de||a.capture!==_.capture||a.once!==_.once||a.passive!==_.passive,ht=a!==de&&(_===de||R);R&&this.element.removeEventListener(this.name,this,_),ht&&this.element.addEventListener(this.name,this,a),this._$AH=a}handleEvent(a){var u;typeof this._$AH=="function"?this._$AH.call(((u=this.options)==null?void 0:u.host)??this.element,a):this._$AH.handleEvent(a)}}class ar{constructor(a,u,_){this.element=a,this.type=6,this._$AN=void 0,this._$AM=u,this.options=_}get _$AU(){return this._$AM._$AU}_$AI(a){He(this,a)}}const Ii=Ze.litHtmlPolyfillSupport;Ii==null||Ii(ii,ai),(Ze.litHtmlVersions??(Ze.litHtmlVersions=[])).push("3.1.2");const or=(A,a,u)=>{const _=(u==null?void 0:u.renderBefore)??a;let R=_._$litPart$;if(R===void 0){const ht=(u==null?void 0:u.renderBefore)??null;_._$litPart$=R=new ai(a.insertBefore(ti(),ht),ht,void 0,u??{})}return R._$AI(A),R};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let Ae=class extends Oe{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var u;const a=super.createRenderRoot();return(u=this.renderOptions).renderBefore??(u.renderBefore=a.firstChild),a}update(a){const u=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(a),this._$Do=or(u,this.renderRoot,this.renderOptions)}connectedCallback(){var a;super.connectedCallback(),(a=this._$Do)==null||a.setConnected(!0)}disconnectedCallback(){var a;super.disconnectedCallback(),(a=this._$Do)==null||a.setConnected(!1)}render(){return Be}};var Xs;Ae._$litElement$=!0,Ae.finalized=!0,(Xs=globalThis.litElementHydrateSupport)==null||Xs.call(globalThis,{LitElement:Ae});const Li=globalThis.litElementPolyfillSupport;Li==null||Li({LitElement:Ae});(globalThis.litElementVersions??(globalThis.litElementVersions=[])).push("4.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Te=A=>(a,u)=>{u!==void 0?u.addInitializer(()=>{customElements.define(A,a)}):customElements.define(A,a)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const lr={attribute:!0,type:String,converter:Ti,reflect:!1,hasChanged:ws},cr=(A=lr,a,u)=>{const{kind:_,metadata:R}=u;let ht=globalThis.litPropertyMetadata.get(R);if(ht===void 0&&globalThis.litPropertyMetadata.set(R,ht=new Map),ht.set(u.name,A),_==="accessor"){const{name:U}=u;return{set(o){const K=a.get.call(this);a.set.call(this,o),this.requestUpdate(U,K,A)},init(o){return o!==void 0&&this.P(U,void 0,A),o}}}if(_==="setter"){const{name:U}=u;return function(o){const K=this[U];a.call(this,o),this.requestUpdate(U,K,A)}}throw Error("Unsupported decorator location: "+_)};function fe(A){return(a,u)=>typeof u=="object"?cr(A,a,u):((_,R,ht)=>{const U=R.hasOwnProperty(ht);return R.constructor.createProperty(ht,U?{..._,wrapped:!0}:_),U?Object.getOwnPropertyDescriptor(R,ht):void 0})(A,a,u)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Hs=(A,a,u)=>(u.configurable=!0,u.enumerable=!0,Reflect.decorate&&typeof a!="object"&&Object.defineProperty(A,a,u),u);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function ye(A,a){return(u,_,R)=>{const ht=U=>{var o;return((o=U.renderRoot)==null?void 0:o.querySelector(A))??null};if(a){const{get:U,set:o}=typeof _=="object"?u:R??(()=>{const K=Symbol();return{get(){return this[K]},set(n){this[K]=n}}})();return Hs(u,_,{get(){let K=U.call(this);return K===void 0&&(K=ht(this),(K!==null||this.hasUpdated)&&o.call(this,K)),K}})}return Hs(u,_,{get(){return ht(this)}})}}var hr=Object.defineProperty,dr=Object.getOwnPropertyDescriptor,Cs=(A,a,u,_)=>{for(var R=_>1?void 0:_?dr(a,u):a,ht=A.length-1,U;ht>=0;ht--)(U=A[ht])&&(R=(_?U(a,u,R):U(R))||R);return _&&R&&hr(a,u,R),R};let si=class extends Ae{constructor(){super(...arguments),this.title="",this.description=""}render(){return be`
      <!-- <details>
        <summary>${this.title}</summary>
        <p>${this.description}</p>
        <slot></slot>
      </details> -->

      <div class="header">
        <div class="info" @click=${()=>{this.getAttribute("open")!==null?this.removeAttribute("open"):this.setAttribute("open","")}}>
          <h3 class="title">${this.title}</h3>
          <p class="description">${this.description}</p>
        </div>
        <div class="tools">
          <slot name="header"></slot>
        </div>
      </div>

      <div class="content" @focusin=${()=>this.setAttribute("open","")}>
        <slot></slot>
      </div>
    `}};si.styles=Se`
    :host {
      display: grid;
      grid-template-rows: auto 0fr;
      grid-template-columns: 1fr;
      box-sizing: border-box;
      padding: 1em;
      gap: 0;
      border-top: 1px solid var(--theme-color-background-light);
      transition: gap 0.2s, grid-template-rows 0.2s;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .info {
      font-size: .9em;
      cursor: pointer;
      flex: 1;
    }
    .title, .description {
      display: block;
      margin: 0;
    }
    .tools {
      display: flex;
      gap: .5em;
    }

    .content {
      opacity: 0;
      transition: opacity 0.5s;
      overflow: hidden;
    }

    :host([open]) {
      grid-template-rows: auto 1fr;
      gap: 1em;
    }
    :host([open]) .content {
      opacity: 1;
    }

  `;Cs([fe({type:String})],si.prototype,"title",2);Cs([fe({type:String})],si.prototype,"description",2);si=Cs([Te("collapsable-container")],si);const Ts=Se`
  button {
    background: var(--theme-color-background-light);
    border: none;
    outline: none;
    border-radius: 0.5em;
    padding: 0.5em 1em;
    color: var(--theme-color-text);
    cursor: pointer;
    font-weight: bold;
    text-transform: uppercase;
  }
  button:hover {
    scale: 1.05;
  }
  button:focus {
    box-shadow: 0 0 0 2px var(--theme-color-text-light);
  }
`;var ur=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),fr=async(A,a)=>await(await fetch(A,a)).arrayBuffer(),pr=async({url:A,simdUrl:a},u)=>{const _=await ur()?a:A;return await fr(_,u)},gr="@sapphi-red/web-noise-suppressor/rnnoise",mr=class extends AudioWorkletNode{constructor(A,{maxChannels:a,wasmBinary:u}){const _={processorOptions:{maxChannels:a,wasmBinary:u}};super(A,gr,_)}destroy(){this.port.postMessage("destroy")}};const br="/assets/workletProcessor-aE81tT0U.js",Ar="/assets/rnnoise-JVVcIJtG.wasm",yr="/assets/rnnoise-JVVcIJtG.wasm";var vr=Object.defineProperty,_r=Object.getOwnPropertyDescriptor,Zs=(A,a,u,_)=>{for(var R=_>1?void 0:_?_r(a,u):a,ht=A.length-1,U;ht>=0;ht--)(U=A[ht])&&(R=(_?U(a,u,R):U(R))||R);return _&&R&&vr(a,u,R),R};let xi=class extends Ae{constructor(){super(...arguments),this.pct=.125,this.recording=!1}async connect(){this.stream=await navigator.mediaDevices.getUserMedia({audio:{noiseSuppression:!0,echoCancellation:!0,autoGainControl:!1}});const A=new AudioContext;this.source=A.createMediaStreamSource(this.stream),this.gain=new GainNode(A,{gain:1}),await A.audioWorklet.addModule(br);const a=await pr({url:Ar,simdUrl:yr});this.rnnoise=new mr(A,{wasmBinary:a,maxChannels:2}),this.source.connect(this.rnnoise),this.rnnoise.connect(this.gain),this.analyser=A.createAnalyser(),this.source.connect(this.analyser),this.analyser.fftSize=Math.pow(2,12),this.analyser.smoothingTimeConstant=0}disconnect(){var A,a,u,_,R;(A=this.stream)==null||A.getTracks().forEach(ht=>ht.stop()),(a=this.source)==null||a.disconnect(),(u=this.gain)==null||u.disconnect(),(_=this.rnnoise)==null||_.destroy(),(R=this.rnnoise)==null||R.disconnect()}capture(){const A=this.analyser.frequencyBinCount,a=new Uint8Array(Math.floor(A*this.pct));return this.analyser.getByteFrequencyData(a),a}loop(){this.frameID=requestAnimationFrame(()=>this.loop());const A=this.capture();this.dispatchEvent(new CustomEvent("data",{detail:A}))}start(){this.recording||this.connect().then(()=>{this.dispatchEvent(new CustomEvent("start")),setTimeout(()=>{this.loop(),this.recording=!0},100)}).catch(A=>{console.error(A),alert("Could not start recording")})}stop(){this.recording&&(cancelAnimationFrame(this.frameID),this.disconnect(),this.dispatchEvent(new CustomEvent("stop")),this.recording=!1)}toggle(){this.recording?this.stop():this.start()}render(){return be`
      <button @click=${this.toggle} class=${this.recording?"active":""}>
        <slot></slot>
      </button>
    `}};xi.styles=[Ts,Se`
      :host {
        display: block;
      }
      button.active {
        background: var(--color-orange);
      }
    `];Zs([fe({type:Boolean})],xi.prototype,"recording",2);xi=Zs([Te("frequency-recorder")],xi);function tn(A){return`hsla(${360-A*360}, 100%, 50%, ${A})`}var Sr=Object.defineProperty,Er=Object.getOwnPropertyDescriptor,Ps=(A,a,u,_)=>{for(var R=_>1?void 0:_?Er(a,u):a,ht=A.length-1,U;ht>=0;ht--)(U=A[ht])&&(R=(_?U(a,u,R):U(R))||R);return _&&R&&Sr(a,u,R),R};let ni=class extends Ae{render(){return be`<canvas width="0" height="0"></canvas>`}updated(){const A=this.canvas,a=A.getContext("2d");if(!this.data){A.width=0,A.height=0;return}A.width=this.data.length,A.height=5,this.data.forEach((u,_)=>{a.fillStyle=tn(u/255),a.fillRect(_,0,1,5)})}};ni.styles=Se`
    :host {
      display: block;
    }
    canvas {
      display: block;
    }
  `;Ps([fe({type:Object})],ni.prototype,"data",2);Ps([ye("canvas")],ni.prototype,"canvas",2);ni=Ps([Te("graph-1d")],ni);var wr=Object.defineProperty,Cr=Object.getOwnPropertyDescriptor,xs=(A,a,u,_)=>{for(var R=_>1?void 0:_?Cr(a,u):a,ht=A.length-1,U;ht>=0;ht--)(U=A[ht])&&(R=(_?U(a,u,R):U(R))||R);return _&&R&&wr(a,u,R),R};let ri=class extends Ae{render(){return be`<canvas width="0" height="0" @pointerdown=${A=>{const a=this.canvas.getBoundingClientRect(),u=A.clientX-a.left,_=A.clientY-a.top,R=u/a.width,ht=_/a.height,U=Math.floor(R*this.data.length||0),o=Math.floor((1-ht)*this.data[0].length);this.dispatchEvent(new CustomEvent("select",{detail:{column:U,row:o,x:u,y:_}}))}}></canvas>`}updated(){var U;if(!this.data||!this.data.length)return;const A=this.canvas,a=A.getContext("2d"),u=((U=this.data[0])==null?void 0:U.length)||0;A.width=this.data.length,A.height=u;let _=0;const R=100,ht=()=>{for(let o=_;o<Math.min(_+R,this.data.length);o++)for(let K=0;K<u;K++)a.fillStyle=tn(this.data[o][K]/255),a.fillRect(o,u-K,1,1);_+=R,_<this.data.length&&requestAnimationFrame(ht)};ht()}};ri.styles=Se`
    :host {
      display: block;
    }
    canvas {
      display: block;
    }
  `;xs([fe({type:Array})],ri.prototype,"data",2);xs([ye("canvas")],ri.prototype,"canvas",2);ri=xs([Te("graph-2d")],ri);function Tr(A){if(A.__esModule)return A;var a=A.default;if(typeof a=="function"){var u=function _(){return this instanceof _?Reflect.construct(a,arguments,this.constructor):a.apply(this,arguments)};u.prototype=a.prototype}else u={};return Object.defineProperty(u,"__esModule",{value:!0}),Object.keys(A).forEach(function(_){var R=Object.getOwnPropertyDescriptor(A,_);Object.defineProperty(u,_,R.get?R:{enumerable:!0,get:function(){return A[_]}})}),u}function Ni(A){throw new Error('Could not dynamically require "'+A+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var en={exports:{}};const Pr={},xr=Object.freeze(Object.defineProperty({__proto__:null,default:Pr},Symbol.toStringTag,{value:"Module"})),_e=Tr(xr);(function(A,a){(function(_,R){A.exports=_.pdfjsLib=R()})(globalThis,()=>(()=>{var u=[,(U,o)=>{var X;Object.defineProperty(o,"__esModule",{value:!0}),o.VerbosityLevel=o.Util=o.UnknownErrorException=o.UnexpectedResponseException=o.TextRenderingMode=o.RenderingIntentFlag=o.PromiseCapability=o.PermissionFlag=o.PasswordResponses=o.PasswordException=o.PageActionEventType=o.OPS=o.MissingPDFException=o.MAX_IMAGE_SIZE_TO_CACHE=o.LINE_FACTOR=o.LINE_DESCENT_FACTOR=o.InvalidPDFException=o.ImageKind=o.IDENTITY_MATRIX=o.FormatError=o.FeatureTest=o.FONT_IDENTITY_MATRIX=o.DocumentActionEventType=o.CMapCompressionType=o.BaseException=o.BASELINE_FACTOR=o.AnnotationType=o.AnnotationReplyType=o.AnnotationPrefix=o.AnnotationMode=o.AnnotationFlag=o.AnnotationFieldFlag=o.AnnotationEditorType=o.AnnotationEditorPrefix=o.AnnotationEditorParamsType=o.AnnotationBorderStyleType=o.AnnotationActionEventType=o.AbortException=void 0,o.assert=bt,o.bytesToString=B,o.createValidAbsoluteUrl=Ut,o.getModificationDate=Ot,o.getUuid=pt,o.getVerbosityLevel=ut,o.info=Et,o.isArrayBuffer=vt,o.isArrayEqual=Ft,o.isNodeJS=void 0,o.normalizeUnicode=Zt,o.objectFromMap=mt,o.objectSize=ft,o.setVerbosityLevel=j,o.shadow=$t,o.string32=nt,o.stringToBytes=lt,o.stringToPDFString=St,o.stringToUTF8String=it,o.unreachable=et,o.utf8StringToString=st,o.warn=yt;const K=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");o.isNodeJS=K;const n=[1,0,0,1,0,0];o.IDENTITY_MATRIX=n;const P=[.001,0,0,.001,0,0];o.FONT_IDENTITY_MATRIX=P;const V=1e7;o.MAX_IMAGE_SIZE_TO_CACHE=V;const q=1.35;o.LINE_FACTOR=q;const gt=.35;o.LINE_DESCENT_FACTOR=gt;const z=gt/q;o.BASELINE_FACTOR=z;const F={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};o.RenderingIntentFlag=F;const g={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};o.AnnotationMode=g;const H="pdfjs_internal_editor_";o.AnnotationEditorPrefix=H;const W={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};o.AnnotationEditorType=W;const L={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};o.AnnotationEditorParamsType=L;const E={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};o.PermissionFlag=E;const w={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};o.TextRenderingMode=w;const f={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};o.ImageKind=f;const b={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};o.AnnotationType=b;const k={GROUP:"Group",REPLY:"R"};o.AnnotationReplyType=k;const x={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};o.AnnotationFlag=x;const y={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};o.AnnotationFieldFlag=y;const l={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};o.AnnotationBorderStyleType=l;const h={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};o.AnnotationActionEventType=h;const I={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};o.DocumentActionEventType=I;const Q={O:"PageOpen",C:"PageClose"};o.PageActionEventType=Q;const J={ERRORS:0,WARNINGS:1,INFOS:5};o.VerbosityLevel=J;const _t={NONE:0,BINARY:1};o.CMapCompressionType=_t;const at={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};o.OPS=at;const xt={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};o.PasswordResponses=xt;let Ct=J.WARNINGS;function j(v){Number.isInteger(v)&&(Ct=v)}function ut(){return Ct}function Et(v){Ct>=J.INFOS&&console.log(`Info: ${v}`)}function yt(v){Ct>=J.WARNINGS&&console.log(`Warning: ${v}`)}function et(v){throw new Error(v)}function bt(v,S){v||et(S)}function Rt(v){switch(v==null?void 0:v.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Ut(v,S=null,C=null){if(!v)return null;try{if(C&&typeof v=="string"){if(C.addDefaultProtocol&&v.startsWith("www.")){const dt=v.match(/\./g);(dt==null?void 0:dt.length)>=2&&(v=`http://${v}`)}if(C.tryConvertEncoding)try{v=it(v)}catch{}}const rt=S?new URL(v,S):new URL(v);if(Rt(rt))return rt}catch{}return null}function $t(v,S,C,rt=!1){return Object.defineProperty(v,S,{value:C,enumerable:!rt,configurable:!0,writable:!1}),C}const T=function(){function S(C,rt){this.constructor===S&&et("Cannot initialize BaseException."),this.message=C,this.name=rt}return S.prototype=new Error,S.constructor=S,S}();o.BaseException=T;class i extends T{constructor(S,C){super(S,"PasswordException"),this.code=C}}o.PasswordException=i;class r extends T{constructor(S,C){super(S,"UnknownErrorException"),this.details=C}}o.UnknownErrorException=r;class s extends T{constructor(S){super(S,"InvalidPDFException")}}o.InvalidPDFException=s;class c extends T{constructor(S){super(S,"MissingPDFException")}}o.MissingPDFException=c;class d extends T{constructor(S,C){super(S,"UnexpectedResponseException"),this.status=C}}o.UnexpectedResponseException=d;class m extends T{constructor(S){super(S,"FormatError")}}o.FormatError=m;class M extends T{constructor(S){super(S,"AbortException")}}o.AbortException=M;function B(v){(typeof v!="object"||(v==null?void 0:v.length)===void 0)&&et("Invalid argument for bytesToString");const S=v.length,C=8192;if(S<C)return String.fromCharCode.apply(null,v);const rt=[];for(let dt=0;dt<S;dt+=C){const qt=Math.min(dt+C,S),ie=v.subarray(dt,qt);rt.push(String.fromCharCode.apply(null,ie))}return rt.join("")}function lt(v){typeof v!="string"&&et("Invalid argument for stringToBytes");const S=v.length,C=new Uint8Array(S);for(let rt=0;rt<S;++rt)C[rt]=v.charCodeAt(rt)&255;return C}function nt(v){return String.fromCharCode(v>>24&255,v>>16&255,v>>8&255,v&255)}function ft(v){return Object.keys(v).length}function mt(v){const S=Object.create(null);for(const[C,rt]of v)S[C]=rt;return S}function Mt(){const v=new Uint8Array(4);return v[0]=1,new Uint32Array(v.buffer,0,1)[0]===1}function At(){try{return new Function(""),!0}catch{return!1}}class Bt{static get isLittleEndian(){return $t(this,"isLittleEndian",Mt())}static get isEvalSupported(){return $t(this,"isEvalSupported",At())}static get isOffscreenCanvasSupported(){return $t(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?$t(this,"platform",{isWin:!1,isMac:!1}):$t(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){var S,C;return $t(this,"isCSSRoundSupported",(C=(S=globalThis.CSS)==null?void 0:S.supports)==null?void 0:C.call(S,"width: round(1.5px, 1px)"))}}o.FeatureTest=Bt;const Vt=[...Array(256).keys()].map(v=>v.toString(16).padStart(2,"0"));class kt{static makeHexColor(S,C,rt){return`#${Vt[S]}${Vt[C]}${Vt[rt]}`}static scaleMinMax(S,C){let rt;S[0]?(S[0]<0&&(rt=C[0],C[0]=C[1],C[1]=rt),C[0]*=S[0],C[1]*=S[0],S[3]<0&&(rt=C[2],C[2]=C[3],C[3]=rt),C[2]*=S[3],C[3]*=S[3]):(rt=C[0],C[0]=C[2],C[2]=rt,rt=C[1],C[1]=C[3],C[3]=rt,S[1]<0&&(rt=C[2],C[2]=C[3],C[3]=rt),C[2]*=S[1],C[3]*=S[1],S[2]<0&&(rt=C[0],C[0]=C[1],C[1]=rt),C[0]*=S[2],C[1]*=S[2]),C[0]+=S[4],C[1]+=S[4],C[2]+=S[5],C[3]+=S[5]}static transform(S,C){return[S[0]*C[0]+S[2]*C[1],S[1]*C[0]+S[3]*C[1],S[0]*C[2]+S[2]*C[3],S[1]*C[2]+S[3]*C[3],S[0]*C[4]+S[2]*C[5]+S[4],S[1]*C[4]+S[3]*C[5]+S[5]]}static applyTransform(S,C){const rt=S[0]*C[0]+S[1]*C[2]+C[4],dt=S[0]*C[1]+S[1]*C[3]+C[5];return[rt,dt]}static applyInverseTransform(S,C){const rt=C[0]*C[3]-C[1]*C[2],dt=(S[0]*C[3]-S[1]*C[2]+C[2]*C[5]-C[4]*C[3])/rt,qt=(-S[0]*C[1]+S[1]*C[0]+C[4]*C[1]-C[5]*C[0])/rt;return[dt,qt]}static getAxialAlignedBoundingBox(S,C){const rt=this.applyTransform(S,C),dt=this.applyTransform(S.slice(2,4),C),qt=this.applyTransform([S[0],S[3]],C),ie=this.applyTransform([S[2],S[1]],C);return[Math.min(rt[0],dt[0],qt[0],ie[0]),Math.min(rt[1],dt[1],qt[1],ie[1]),Math.max(rt[0],dt[0],qt[0],ie[0]),Math.max(rt[1],dt[1],qt[1],ie[1])]}static inverseTransform(S){const C=S[0]*S[3]-S[1]*S[2];return[S[3]/C,-S[1]/C,-S[2]/C,S[0]/C,(S[2]*S[5]-S[4]*S[3])/C,(S[4]*S[1]-S[5]*S[0])/C]}static singularValueDecompose2dScale(S){const C=[S[0],S[2],S[1],S[3]],rt=S[0]*C[0]+S[1]*C[2],dt=S[0]*C[1]+S[1]*C[3],qt=S[2]*C[0]+S[3]*C[2],ie=S[2]*C[1]+S[3]*C[3],Y=(rt+ie)/2,Tt=Math.sqrt((rt+ie)**2-4*(rt*ie-qt*dt))/2,Nt=Y+Tt||1,Dt=Y-Tt||1;return[Math.sqrt(Nt),Math.sqrt(Dt)]}static normalizeRect(S){const C=S.slice(0);return S[0]>S[2]&&(C[0]=S[2],C[2]=S[0]),S[1]>S[3]&&(C[1]=S[3],C[3]=S[1]),C}static intersect(S,C){const rt=Math.max(Math.min(S[0],S[2]),Math.min(C[0],C[2])),dt=Math.min(Math.max(S[0],S[2]),Math.max(C[0],C[2]));if(rt>dt)return null;const qt=Math.max(Math.min(S[1],S[3]),Math.min(C[1],C[3])),ie=Math.min(Math.max(S[1],S[3]),Math.max(C[1],C[3]));return qt>ie?null:[rt,qt,dt,ie]}static bezierBoundingBox(S,C,rt,dt,qt,ie,Y,Tt){const Nt=[],Dt=[[],[]];let Xt,Gt,ne,Pt,se,Wt,D,e;for(let tt=0;tt<2;++tt){if(tt===0?(Gt=6*S-12*rt+6*qt,Xt=-3*S+9*rt-9*qt+3*Y,ne=3*rt-3*S):(Gt=6*C-12*dt+6*ie,Xt=-3*C+9*dt-9*ie+3*Tt,ne=3*dt-3*C),Math.abs(Xt)<1e-12){if(Math.abs(Gt)<1e-12)continue;Pt=-ne/Gt,0<Pt&&Pt<1&&Nt.push(Pt);continue}D=Gt*Gt-4*ne*Xt,e=Math.sqrt(D),!(D<0)&&(se=(-Gt+e)/(2*Xt),0<se&&se<1&&Nt.push(se),Wt=(-Gt-e)/(2*Xt),0<Wt&&Wt<1&&Nt.push(Wt))}let p=Nt.length,N;const G=p;for(;p--;)Pt=Nt[p],N=1-Pt,Dt[0][p]=N*N*N*S+3*N*N*Pt*rt+3*N*Pt*Pt*qt+Pt*Pt*Pt*Y,Dt[1][p]=N*N*N*C+3*N*N*Pt*dt+3*N*Pt*Pt*ie+Pt*Pt*Pt*Tt;return Dt[0][G]=S,Dt[1][G]=C,Dt[0][G+1]=Y,Dt[1][G+1]=Tt,Dt[0].length=Dt[1].length=G+2,[Math.min(...Dt[0]),Math.min(...Dt[1]),Math.max(...Dt[0]),Math.max(...Dt[1])]}}o.Util=kt;const jt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function St(v){if(v[0]>="ï"){let C;if(v[0]==="þ"&&v[1]==="ÿ"?C="utf-16be":v[0]==="ÿ"&&v[1]==="þ"?C="utf-16le":v[0]==="ï"&&v[1]==="»"&&v[2]==="¿"&&(C="utf-8"),C)try{const rt=new TextDecoder(C,{fatal:!0}),dt=lt(v);return rt.decode(dt)}catch(rt){yt(`stringToPDFString: "${rt}".`)}}const S=[];for(let C=0,rt=v.length;C<rt;C++){const dt=jt[v.charCodeAt(C)];S.push(dt?String.fromCharCode(dt):v.charAt(C))}return S.join("")}function it(v){return decodeURIComponent(escape(v))}function st(v){return unescape(encodeURIComponent(v))}function vt(v){return typeof v=="object"&&(v==null?void 0:v.byteLength)!==void 0}function Ft(v,S){if(v.length!==S.length)return!1;for(let C=0,rt=v.length;C<rt;C++)if(v[C]!==S[C])return!1;return!0}function Ot(v=new Date){return[v.getUTCFullYear().toString(),(v.getUTCMonth()+1).toString().padStart(2,"0"),v.getUTCDate().toString().padStart(2,"0"),v.getUTCHours().toString().padStart(2,"0"),v.getUTCMinutes().toString().padStart(2,"0"),v.getUTCSeconds().toString().padStart(2,"0")].join("")}class te{constructor(){$(this,X,!1);this.promise=new Promise((S,C)=>{this.resolve=rt=>{ot(this,X,!0),S(rt)},this.reject=rt=>{ot(this,X,!0),C(rt)}})}get settled(){return t(this,X)}}X=new WeakMap,o.PromiseCapability=te;let Kt=null,Jt=null;function Zt(v){return Kt||(Kt=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Jt=new Map([["ﬅ","ſt"]])),v.replaceAll(Kt,(S,C,rt)=>C?C.normalize("NFKC"):Jt.get(rt))}function pt(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const v=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(v);else for(let S=0;S<32;S++)v[S]=Math.floor(Math.random()*255);return B(v)}const O="pdfjs_internal_id_";o.AnnotationPrefix=O},(U,o,K)=>{var c,m,M,B,Ie,nt,di,mt,Mt,At,Bt,kt,jt,St,it,st,ui,Ft,Ot,Hi,Kt,Jt;Object.defineProperty(o,"__esModule",{value:!0}),o.RenderTask=o.PDFWorkerUtil=o.PDFWorker=o.PDFPageProxy=o.PDFDocumentProxy=o.PDFDocumentLoadingTask=o.PDFDataRangeTransport=o.LoopbackPort=o.DefaultStandardFontDataFactory=o.DefaultFilterFactory=o.DefaultCanvasFactory=o.DefaultCMapReaderFactory=void 0,Object.defineProperty(o,"SVGGraphics",{enumerable:!0,get:function(){return b.SVGGraphics}}),o.build=void 0,o.getDocument=_t,o.version=void 0;var n=K(1),P=K(3),V=K(6),q=K(9),gt=K(10),z=K(11),F=K(14),g=K(15),H=K(16),W=K(17),L=K(18),E=K(19),w=K(22),f=K(23),b=K(24),k=K(25);const x=65536,y=100,l=5e3,h=n.isNodeJS?gt.NodeCanvasFactory:V.DOMCanvasFactory;o.DefaultCanvasFactory=h;const I=n.isNodeJS?gt.NodeCMapReaderFactory:V.DOMCMapReaderFactory;o.DefaultCMapReaderFactory=I;const Q=n.isNodeJS?gt.NodeFilterFactory:V.DOMFilterFactory;o.DefaultFilterFactory=Q;const J=n.isNodeJS?gt.NodeStandardFontDataFactory:V.DOMStandardFontDataFactory;o.DefaultStandardFontDataFactory=J;function _t(pt){if(typeof pt=="string"||pt instanceof URL?pt={url:pt}:(0,n.isArrayBuffer)(pt)&&(pt={data:pt}),typeof pt!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!pt.url&&!pt.data&&!pt.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const O=new j,{docId:X}=O,v=pt.url?xt(pt.url):null,S=pt.data?Ct(pt.data):null,C=pt.httpHeaders||null,rt=pt.withCredentials===!0,dt=pt.password??null,qt=pt.range instanceof ut?pt.range:null,ie=Number.isInteger(pt.rangeChunkSize)&&pt.rangeChunkSize>0?pt.rangeChunkSize:x;let Y=pt.worker instanceof Rt?pt.worker:null;const Tt=pt.verbosity,Nt=typeof pt.docBaseUrl=="string"&&!(0,V.isDataScheme)(pt.docBaseUrl)?pt.docBaseUrl:null,Dt=typeof pt.cMapUrl=="string"?pt.cMapUrl:null,Xt=pt.cMapPacked!==!1,Gt=pt.CMapReaderFactory||I,ne=typeof pt.standardFontDataUrl=="string"?pt.standardFontDataUrl:null,Pt=pt.StandardFontDataFactory||J,se=pt.stopAtErrors!==!0,Wt=Number.isInteger(pt.maxImageSize)&&pt.maxImageSize>-1?pt.maxImageSize:-1,D=pt.isEvalSupported!==!1,e=typeof pt.isOffscreenCanvasSupported=="boolean"?pt.isOffscreenCanvasSupported:!n.isNodeJS,p=Number.isInteger(pt.canvasMaxAreaInBytes)?pt.canvasMaxAreaInBytes:-1,N=typeof pt.disableFontFace=="boolean"?pt.disableFontFace:n.isNodeJS,G=pt.fontExtraProperties===!0,tt=pt.enableXfa===!0,ct=pt.ownerDocument||globalThis.document,wt=pt.disableRange===!0,Lt=pt.disableStream===!0,It=pt.disableAutoFetch===!0,Qt=pt.pdfBug===!0,Ht=qt?qt.length:pt.length??NaN,zt=typeof pt.useSystemFonts=="boolean"?pt.useSystemFonts:!n.isNodeJS&&!N,Yt=typeof pt.useWorkerFetch=="boolean"?pt.useWorkerFetch:Gt===V.DOMCMapReaderFactory&&Pt===V.DOMStandardFontDataFactory&&Dt&&ne&&(0,V.isValidFetchUrl)(Dt,document.baseURI)&&(0,V.isValidFetchUrl)(ne,document.baseURI),ee=pt.canvasFactory||new h({ownerDocument:ct}),re=pt.filterFactory||new Q({docId:X,ownerDocument:ct}),ae=null;(0,n.setVerbosityLevel)(Tt);const ce={canvasFactory:ee,filterFactory:re};if(Yt||(ce.cMapReaderFactory=new Gt({baseUrl:Dt,isCompressed:Xt}),ce.standardFontDataFactory=new Pt({baseUrl:ne})),!Y){const ge={verbosity:Tt,port:F.GlobalWorkerOptions.workerPort};Y=ge.port?Rt.fromPort(ge):new Rt(ge),O._worker=Y}const le={docId:X,apiVersion:"3.11.174",data:S,password:dt,disableAutoFetch:It,rangeChunkSize:ie,length:Ht,docBaseUrl:Nt,enableXfa:tt,evaluatorOptions:{maxImageSize:Wt,disableFontFace:N,ignoreErrors:se,isEvalSupported:D,isOffscreenCanvasSupported:e,canvasMaxAreaInBytes:p,fontExtraProperties:G,useSystemFonts:zt,cMapUrl:Yt?Dt:null,standardFontDataUrl:Yt?ne:null}},pe={ignoreErrors:se,isEvalSupported:D,disableFontFace:N,fontExtraProperties:G,enableXfa:tt,ownerDocument:ct,disableAutoFetch:It,pdfBug:Qt,styleElement:ae};return Y.promise.then(function(){if(O.destroyed)throw new Error("Loading aborted");const ge=at(Y,le),ve=new Promise(function(Fe){let je;qt?je=new L.PDFDataTransportStream({length:Ht,initialData:qt.initialData,progressiveDone:qt.progressiveDone,contentDispositionFilename:qt.contentDispositionFilename,disableRange:wt,disableStream:Lt},qt):S||(je=(De=>n.isNodeJS?new f.PDFNodeStream(De):(0,V.isValidFetchUrl)(De.url)?new E.PDFFetchStream(De):new w.PDFNetworkStream(De))({url:v,length:Ht,httpHeaders:C,withCredentials:rt,rangeChunkSize:ie,disableRange:wt,disableStream:Lt})),Fe(je)});return Promise.all([ge,ve]).then(function([Fe,je]){if(O.destroyed)throw new Error("Loading aborted");const Ri=new g.MessageHandler(X,Fe,Y.port),De=new Ut(Ri,O,je,pe,ce);O._transport=De,Ri.send("Ready",null)})}).catch(O._capability.reject),O}async function at(pt,O){if(pt.destroyed)throw new Error("Worker was destroyed");const X=await pt.messageHandler.sendWithPromise("GetDocRequest",O,O.data?[O.data.buffer]:null);if(pt.destroyed)throw new Error("Worker was destroyed");return X}function xt(pt){if(pt instanceof URL)return pt.href;try{return new URL(pt,window.location).href}catch{if(n.isNodeJS&&typeof pt=="string")return pt}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Ct(pt){if(n.isNodeJS&&typeof Buffer<"u"&&pt instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(pt instanceof Uint8Array&&pt.byteLength===pt.buffer.byteLength)return pt;if(typeof pt=="string")return(0,n.stringToBytes)(pt);if(typeof pt=="object"&&!isNaN(pt==null?void 0:pt.length)||(0,n.isArrayBuffer)(pt))return new Uint8Array(pt);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const d=class d{constructor(){this._capability=new n.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${We(d,c)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var O,X,v;this.destroyed=!0;try{(O=this._worker)!=null&&O.port&&(this._worker._pendingDestroy=!0),await((X=this._transport)==null?void 0:X.destroy())}catch(S){throw(v=this._worker)!=null&&v.port&&delete this._worker._pendingDestroy,S}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};c=new WeakMap,$(d,c,0);let j=d;o.PDFDocumentLoadingTask=j;class ut{constructor(O,X,v=!1,S=null){this.length=O,this.initialData=X,this.progressiveDone=v,this.contentDispositionFilename=S,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new n.PromiseCapability}addRangeListener(O){this._rangeListeners.push(O)}addProgressListener(O){this._progressListeners.push(O)}addProgressiveReadListener(O){this._progressiveReadListeners.push(O)}addProgressiveDoneListener(O){this._progressiveDoneListeners.push(O)}onDataRange(O,X){for(const v of this._rangeListeners)v(O,X)}onDataProgress(O,X){this._readyCapability.promise.then(()=>{for(const v of this._progressListeners)v(O,X)})}onDataProgressiveRead(O){this._readyCapability.promise.then(()=>{for(const X of this._progressiveReadListeners)X(O)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const O of this._progressiveDoneListeners)O()})}transportReady(){this._readyCapability.resolve()}requestDataRange(O,X){(0,n.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}o.PDFDataRangeTransport=ut;class Et{constructor(O,X){this._pdfInfo=O,this._transport=X,Object.defineProperty(this,"getJavaScript",{value:()=>((0,V.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(v=>{if(!v)return v;const S=[];for(const C in v)S.push(...v[C]);return S}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,n.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(O){return this._transport.getPage(O)}getPageIndex(O){return this._transport.getPageIndex(O)}getDestinations(){return this._transport.getDestinations()}getDestination(O){return this._transport.getDestination(O)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(O=!1){return this._transport.startCleanup(O||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}o.PDFDocumentProxy=Et;class yt{constructor(O,X,v,S=!1){$(this,B);$(this,nt);$(this,m,null);$(this,M,!1);this._pageIndex=O,this._pageInfo=X,this._transport=v,this._stats=S?new V.StatTimer:null,this._pdfBug=S,this.commonObjs=v.commonObjs,this.objs=new $t,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:O,rotation:X=this.rotate,offsetX:v=0,offsetY:S=0,dontFlip:C=!1}={}){return new V.PageViewport({viewBox:this.view,scale:O,rotation:X,offsetX:v,offsetY:S,dontFlip:C})}getAnnotations({intent:O="display"}={}){const X=this._transport.getRenderingIntent(O);return this._transport.getAnnotations(this._pageIndex,X.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,n.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var O;return((O=this._transport._htmlForXfa)==null?void 0:O.children[this._pageIndex])||null}render({canvasContext:O,viewport:X,intent:v="display",annotationMode:S=n.AnnotationMode.ENABLE,transform:C=null,background:rt=null,optionalContentConfigPromise:dt=null,annotationCanvasMap:qt=null,pageColors:ie=null,printAnnotationStorage:Y=null}){var Pt,se;(Pt=this._stats)==null||Pt.time("Overall");const Tt=this._transport.getRenderingIntent(v,S,Y);ot(this,M,!1),Z(this,nt,di).call(this),dt||(dt=this._transport.getOptionalContentConfig());let Nt=this._intentStates.get(Tt.cacheKey);Nt||(Nt=Object.create(null),this._intentStates.set(Tt.cacheKey,Nt)),Nt.streamReaderCancelTimeout&&(clearTimeout(Nt.streamReaderCancelTimeout),Nt.streamReaderCancelTimeout=null);const Dt=!!(Tt.renderingIntent&n.RenderingIntentFlag.PRINT);Nt.displayReadyCapability||(Nt.displayReadyCapability=new n.PromiseCapability,Nt.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(se=this._stats)==null||se.time("Page Request"),this._pumpOperatorList(Tt));const Xt=Wt=>{var D,e;Nt.renderTasks.delete(Gt),(this._maybeCleanupAfterRender||Dt)&&ot(this,M,!0),Z(this,B,Ie).call(this,!Dt),Wt?(Gt.capability.reject(Wt),this._abortOperatorList({intentState:Nt,reason:Wt instanceof Error?Wt:new Error(Wt)})):Gt.capability.resolve(),(D=this._stats)==null||D.timeEnd("Rendering"),(e=this._stats)==null||e.timeEnd("Overall")},Gt=new i({callback:Xt,params:{canvasContext:O,viewport:X,transform:C,background:rt},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:qt,operatorList:Nt.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!Dt,pdfBug:this._pdfBug,pageColors:ie});(Nt.renderTasks||(Nt.renderTasks=new Set)).add(Gt);const ne=Gt.task;return Promise.all([Nt.displayReadyCapability.promise,dt]).then(([Wt,D])=>{var e;if(this.destroyed){Xt();return}(e=this._stats)==null||e.time("Rendering"),Gt.initializeGraphics({transparency:Wt,optionalContentConfig:D}),Gt.operatorListChanged()}).catch(Xt),ne}getOperatorList({intent:O="display",annotationMode:X=n.AnnotationMode.ENABLE,printAnnotationStorage:v=null}={}){var qt;function S(){rt.operatorList.lastChunk&&(rt.opListReadCapability.resolve(rt.operatorList),rt.renderTasks.delete(dt))}const C=this._transport.getRenderingIntent(O,X,v,!0);let rt=this._intentStates.get(C.cacheKey);rt||(rt=Object.create(null),this._intentStates.set(C.cacheKey,rt));let dt;return rt.opListReadCapability||(dt=Object.create(null),dt.operatorListChanged=S,rt.opListReadCapability=new n.PromiseCapability,(rt.renderTasks||(rt.renderTasks=new Set)).add(dt),rt.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(qt=this._stats)==null||qt.time("Page Request"),this._pumpOperatorList(C)),rt.opListReadCapability.promise}streamTextContent({includeMarkedContent:O=!1,disableNormalization:X=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:O===!0,disableNormalization:X===!0},{highWaterMark:100,size(S){return S.items.length}})}getTextContent(O={}){if(this._transport._htmlForXfa)return this.getXfa().then(v=>k.XfaText.textContent(v));const X=this.streamTextContent(O);return new Promise(function(v,S){function C(){rt.read().then(function({value:qt,done:ie}){if(ie){v(dt);return}Object.assign(dt.styles,qt.styles),dt.items.push(...qt.items),C()},S)}const rt=X.getReader(),dt={items:[],styles:Object.create(null)};C()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const O=[];for(const X of this._intentStates.values())if(this._abortOperatorList({intentState:X,reason:new Error("Page was destroyed."),force:!0}),!X.opListReadCapability)for(const v of X.renderTasks)O.push(v.completed),v.cancel();return this.objs.clear(),ot(this,M,!1),Z(this,nt,di).call(this),Promise.all(O)}cleanup(O=!1){ot(this,M,!0);const X=Z(this,B,Ie).call(this,!1);return O&&X&&this._stats&&(this._stats=new V.StatTimer),X}_startRenderPage(O,X){var S,C;const v=this._intentStates.get(X);v&&((S=this._stats)==null||S.timeEnd("Page Request"),(C=v.displayReadyCapability)==null||C.resolve(O))}_renderPageChunk(O,X){for(let v=0,S=O.length;v<S;v++)X.operatorList.fnArray.push(O.fnArray[v]),X.operatorList.argsArray.push(O.argsArray[v]);X.operatorList.lastChunk=O.lastChunk,X.operatorList.separateAnnots=O.separateAnnots;for(const v of X.renderTasks)v.operatorListChanged();O.lastChunk&&Z(this,B,Ie).call(this,!0)}_pumpOperatorList({renderingIntent:O,cacheKey:X,annotationStorageSerializable:v}){const{map:S,transfers:C}=v,dt=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:O,cacheKey:X,annotationStorage:S},C).getReader(),qt=this._intentStates.get(X);qt.streamReader=dt;const ie=()=>{dt.read().then(({value:Y,done:Tt})=>{if(Tt){qt.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(Y,qt),ie())},Y=>{if(qt.streamReader=null,!this._transport.destroyed){if(qt.operatorList){qt.operatorList.lastChunk=!0;for(const Tt of qt.renderTasks)Tt.operatorListChanged();Z(this,B,Ie).call(this,!0)}if(qt.displayReadyCapability)qt.displayReadyCapability.reject(Y);else if(qt.opListReadCapability)qt.opListReadCapability.reject(Y);else throw Y}})};ie()}_abortOperatorList({intentState:O,reason:X,force:v=!1}){if(O.streamReader){if(O.streamReaderCancelTimeout&&(clearTimeout(O.streamReaderCancelTimeout),O.streamReaderCancelTimeout=null),!v){if(O.renderTasks.size>0)return;if(X instanceof V.RenderingCancelledException){let S=y;X.extraDelay>0&&X.extraDelay<1e3&&(S+=X.extraDelay),O.streamReaderCancelTimeout=setTimeout(()=>{O.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:O,reason:X,force:!0})},S);return}}if(O.streamReader.cancel(new n.AbortException(X.message)).catch(()=>{}),O.streamReader=null,!this._transport.destroyed){for(const[S,C]of this._intentStates)if(C===O){this._intentStates.delete(S);break}this.cleanup()}}}get stats(){return this._stats}}m=new WeakMap,M=new WeakMap,B=new WeakSet,Ie=function(O=!1){if(Z(this,nt,di).call(this),!t(this,M)||this.destroyed)return!1;if(O)return ot(this,m,setTimeout(()=>{ot(this,m,null),Z(this,B,Ie).call(this,!1)},l)),!1;for(const{renderTasks:X,operatorList:v}of this._intentStates.values())if(X.size>0||!v.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),ot(this,M,!1),!0},nt=new WeakSet,di=function(){t(this,m)&&(clearTimeout(t(this,m)),ot(this,m,null))},o.PDFPageProxy=yt;class et{constructor(){$(this,mt,new Set);$(this,Mt,Promise.resolve())}postMessage(O,X){const v={data:structuredClone(O,X?{transfer:X}:null)};t(this,Mt).then(()=>{for(const S of t(this,mt))S.call(this,v)})}addEventListener(O,X){t(this,mt).add(X)}removeEventListener(O,X){t(this,mt).delete(X)}terminate(){t(this,mt).clear()}}mt=new WeakMap,Mt=new WeakMap,o.LoopbackPort=et;const bt={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};o.PDFWorkerUtil=bt;{if(n.isNodeJS&&typeof Ni=="function")bt.isWorkerDisabled=!0,bt.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const pt=(At=document==null?void 0:document.currentScript)==null?void 0:At.src;pt&&(bt.fallbackWorkerSrc=pt.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}bt.isSameOrigin=function(pt,O){let X;try{if(X=new URL(pt),!X.origin||X.origin==="null")return!1}catch{return!1}const v=new URL(O,X);return X.origin===v.origin},bt.createCDNWrapper=function(pt){const O=`importScripts("${pt}");`;return URL.createObjectURL(new Blob([O]))}}const Vt=class Vt{constructor({name:O=null,port:X=null,verbosity:v=(0,n.getVerbosityLevel)()}={}){var S;if(this.name=O,this.destroyed=!1,this.verbosity=v,this._readyCapability=new n.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,X){if((S=t(Vt,Bt))!=null&&S.has(X))throw new Error("Cannot use more than one PDFWorker per port.");(t(Vt,Bt)||ot(Vt,Bt,new WeakMap)).set(X,this),this._initializeFromPort(X);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(O){this._port=O,this._messageHandler=new g.MessageHandler("main","worker",O),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!bt.isWorkerDisabled&&!Vt._mainThreadWorkerMessageHandler){let{workerSrc:O}=Vt;try{bt.isSameOrigin(window.location.href,O)||(O=bt.createCDNWrapper(new URL(O,window.location).href));const X=new Worker(O),v=new g.MessageHandler("main","worker",X),S=()=>{X.removeEventListener("error",C),v.destroy(),X.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},C=()=>{this._webWorker||S()};X.addEventListener("error",C),v.on("test",dt=>{if(X.removeEventListener("error",C),this.destroyed){S();return}dt?(this._messageHandler=v,this._port=X,this._webWorker=X,this._readyCapability.resolve(),v.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),v.destroy(),X.terminate())}),v.on("ready",dt=>{if(X.removeEventListener("error",C),this.destroyed){S();return}try{rt()}catch{this._setupFakeWorker()}});const rt=()=>{const dt=new Uint8Array;v.send("test",dt,[dt.buffer])};rt();return}catch{(0,n.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){bt.isWorkerDisabled||((0,n.warn)("Setting up fake worker."),bt.isWorkerDisabled=!0),Vt._setupFakeWorkerGlobal.then(O=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const X=new et;this._port=X;const v=`fake${bt.fakeWorkerId++}`,S=new g.MessageHandler(v+"_worker",v,X);O.setup(S,X);const C=new g.MessageHandler(v,v+"_worker",X);this._messageHandler=C,this._readyCapability.resolve(),C.send("configure",{verbosity:this.verbosity})}).catch(O=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${O.message}".`))})}destroy(){var O;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(O=t(Vt,Bt))==null||O.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(O){var v;if(!(O!=null&&O.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const X=(v=t(this,Bt))==null?void 0:v.get(O.port);if(X){if(X._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return X}return new Vt(O)}static get workerSrc(){if(F.GlobalWorkerOptions.workerSrc)return F.GlobalWorkerOptions.workerSrc;if(bt.fallbackWorkerSrc!==null)return n.isNodeJS||(0,V.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),bt.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var O;try{return((O=globalThis.pdfjsWorker)==null?void 0:O.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const O=async()=>{const X=this._mainThreadWorkerMessageHandler;return X||(n.isNodeJS&&typeof Ni=="function"?Ni(this.workerSrc).WorkerMessageHandler:(await(0,V.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler))};return(0,n.shadow)(this,"_setupFakeWorkerGlobal",O())}};Bt=new WeakMap,$(Vt,Bt,void 0);let Rt=Vt;o.PDFWorker=Rt;class Ut{constructor(O,X,v,S,C){$(this,st);$(this,kt,new Map);$(this,jt,new Map);$(this,St,new Map);$(this,it,null);this.messageHandler=O,this.loadingTask=X,this.commonObjs=new $t,this.fontLoader=new q.FontLoader({ownerDocument:S.ownerDocument,styleElement:S.styleElement}),this._params=S,this.canvasFactory=C.canvasFactory,this.filterFactory=C.filterFactory,this.cMapReaderFactory=C.cMapReaderFactory,this.standardFontDataFactory=C.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=v,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new n.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,n.shadow)(this,"annotationStorage",new P.AnnotationStorage)}getRenderingIntent(O,X=n.AnnotationMode.ENABLE,v=null,S=!1){let C=n.RenderingIntentFlag.DISPLAY,rt=P.SerializableEmpty;switch(O){case"any":C=n.RenderingIntentFlag.ANY;break;case"display":break;case"print":C=n.RenderingIntentFlag.PRINT;break;default:(0,n.warn)(`getRenderingIntent - invalid intent: ${O}`)}switch(X){case n.AnnotationMode.DISABLE:C+=n.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case n.AnnotationMode.ENABLE:break;case n.AnnotationMode.ENABLE_FORMS:C+=n.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case n.AnnotationMode.ENABLE_STORAGE:C+=n.RenderingIntentFlag.ANNOTATIONS_STORAGE,rt=(C&n.RenderingIntentFlag.PRINT&&v instanceof P.PrintAnnotationStorage?v:this.annotationStorage).serializable;break;default:(0,n.warn)(`getRenderingIntent - invalid annotationMode: ${X}`)}return S&&(C+=n.RenderingIntentFlag.OPLIST),{renderingIntent:C,cacheKey:`${C}_${rt.hash}`,annotationStorageSerializable:rt}}destroy(){var v;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new n.PromiseCapability,(v=t(this,it))==null||v.reject(new Error("Worker was destroyed during onPassword callback"));const O=[];for(const S of t(this,jt).values())O.push(S._destroy());t(this,jt).clear(),t(this,St).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const X=this.messageHandler.sendWithPromise("Terminate",null);return O.push(X),Promise.all(O).then(()=>{var S;this.commonObjs.clear(),this.fontLoader.clear(),t(this,kt).clear(),this.filterFactory.destroy(),(S=this._networkStream)==null||S.cancelAllRequests(new n.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:O,loadingTask:X}=this;O.on("GetReader",(v,S)=>{(0,n.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=C=>{this._lastProgress={loaded:C.loaded,total:C.total}},S.onPull=()=>{this._fullReader.read().then(function({value:C,done:rt}){if(rt){S.close();return}(0,n.assert)(C instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),S.enqueue(new Uint8Array(C),1,[C])}).catch(C=>{S.error(C)})},S.onCancel=C=>{this._fullReader.cancel(C),S.ready.catch(rt=>{if(!this.destroyed)throw rt})}}),O.on("ReaderHeadersReady",v=>{const S=new n.PromiseCapability,C=this._fullReader;return C.headersReady.then(()=>{var rt;(!C.isStreamingSupported||!C.isRangeSupported)&&(this._lastProgress&&((rt=X.onProgress)==null||rt.call(X,this._lastProgress)),C.onProgress=dt=>{var qt;(qt=X.onProgress)==null||qt.call(X,{loaded:dt.loaded,total:dt.total})}),S.resolve({isStreamingSupported:C.isStreamingSupported,isRangeSupported:C.isRangeSupported,contentLength:C.contentLength})},S.reject),S.promise}),O.on("GetRangeReader",(v,S)=>{(0,n.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const C=this._networkStream.getRangeReader(v.begin,v.end);if(!C){S.close();return}S.onPull=()=>{C.read().then(function({value:rt,done:dt}){if(dt){S.close();return}(0,n.assert)(rt instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),S.enqueue(new Uint8Array(rt),1,[rt])}).catch(rt=>{S.error(rt)})},S.onCancel=rt=>{C.cancel(rt),S.ready.catch(dt=>{if(!this.destroyed)throw dt})}}),O.on("GetDoc",({pdfInfo:v})=>{this._numPages=v.numPages,this._htmlForXfa=v.htmlForXfa,delete v.htmlForXfa,X._capability.resolve(new Et(v,this))}),O.on("DocException",function(v){let S;switch(v.name){case"PasswordException":S=new n.PasswordException(v.message,v.code);break;case"InvalidPDFException":S=new n.InvalidPDFException(v.message);break;case"MissingPDFException":S=new n.MissingPDFException(v.message);break;case"UnexpectedResponseException":S=new n.UnexpectedResponseException(v.message,v.status);break;case"UnknownErrorException":S=new n.UnknownErrorException(v.message,v.details);break;default:(0,n.unreachable)("DocException - expected a valid Error.")}X._capability.reject(S)}),O.on("PasswordRequest",v=>{if(ot(this,it,new n.PromiseCapability),X.onPassword){const S=C=>{C instanceof Error?t(this,it).reject(C):t(this,it).resolve({password:C})};try{X.onPassword(S,v.code)}catch(C){t(this,it).reject(C)}}else t(this,it).reject(new n.PasswordException(v.message,v.code));return t(this,it).promise}),O.on("DataLoaded",v=>{var S;(S=X.onProgress)==null||S.call(X,{loaded:v.length,total:v.length}),this.downloadInfoCapability.resolve(v)}),O.on("StartRenderPage",v=>{if(this.destroyed)return;t(this,jt).get(v.pageIndex)._startRenderPage(v.transparency,v.cacheKey)}),O.on("commonobj",([v,S,C])=>{var rt;if(!this.destroyed&&!this.commonObjs.has(v))switch(S){case"Font":const dt=this._params;if("error"in C){const Y=C.error;(0,n.warn)(`Error during font loading: ${Y}`),this.commonObjs.resolve(v,Y);break}const qt=dt.pdfBug&&((rt=globalThis.FontInspector)!=null&&rt.enabled)?(Y,Tt)=>globalThis.FontInspector.fontAdded(Y,Tt):null,ie=new q.FontFaceObject(C,{isEvalSupported:dt.isEvalSupported,disableFontFace:dt.disableFontFace,ignoreErrors:dt.ignoreErrors,inspectFont:qt});this.fontLoader.bind(ie).catch(Y=>O.sendWithPromise("FontFallback",{id:v})).finally(()=>{!dt.fontExtraProperties&&ie.data&&(ie.data=null),this.commonObjs.resolve(v,ie)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(v,C);break;default:throw new Error(`Got unknown common object type ${S}`)}}),O.on("obj",([v,S,C,rt])=>{var qt;if(this.destroyed)return;const dt=t(this,jt).get(S);if(!dt.objs.has(v))switch(C){case"Image":if(dt.objs.resolve(v,rt),rt){let ie;if(rt.bitmap){const{width:Y,height:Tt}=rt;ie=Y*Tt*4}else ie=((qt=rt.data)==null?void 0:qt.length)||0;ie>n.MAX_IMAGE_SIZE_TO_CACHE&&(dt._maybeCleanupAfterRender=!0)}break;case"Pattern":dt.objs.resolve(v,rt);break;default:throw new Error(`Got unknown object type ${C}`)}}),O.on("DocProgress",v=>{var S;this.destroyed||(S=X.onProgress)==null||S.call(X,{loaded:v.loaded,total:v.total})}),O.on("FetchBuiltInCMap",v=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(v):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),O.on("FetchStandardFontData",v=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(v):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var v;this.annotationStorage.size<=0&&(0,n.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:O,transfers:X}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:O,filename:((v=this._fullReader)==null?void 0:v.filename)??null},X).finally(()=>{this.annotationStorage.resetModified()})}getPage(O){if(!Number.isInteger(O)||O<=0||O>this._numPages)return Promise.reject(new Error("Invalid page request."));const X=O-1,v=t(this,St).get(X);if(v)return v;const S=this.messageHandler.sendWithPromise("GetPage",{pageIndex:X}).then(C=>{if(this.destroyed)throw new Error("Transport destroyed");const rt=new yt(X,C,this,this._params.pdfBug);return t(this,jt).set(X,rt),rt});return t(this,St).set(X,S),S}getPageIndex(O){return typeof O!="object"||O===null||!Number.isInteger(O.num)||O.num<0||!Number.isInteger(O.gen)||O.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:O.num,gen:O.gen})}getAnnotations(O,X){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:O,intent:X})}getFieldObjects(){return Z(this,st,ui).call(this,"GetFieldObjects")}hasJSActions(){return Z(this,st,ui).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(O){return typeof O!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:O})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return Z(this,st,ui).call(this,"GetDocJSActions")}getPageJSActions(O){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:O})}getStructTree(O){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:O})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(O=>new W.OptionalContentConfig(O))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const O="GetMetadata",X=t(this,kt).get(O);if(X)return X;const v=this.messageHandler.sendWithPromise(O,null).then(S=>{var C,rt;return{info:S[0],metadata:S[1]?new H.Metadata(S[1]):null,contentDispositionFilename:((C=this._fullReader)==null?void 0:C.filename)??null,contentLength:((rt=this._fullReader)==null?void 0:rt.contentLength)??null}});return t(this,kt).set(O,v),v}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(O=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const X of t(this,jt).values())if(!X.cleanup())throw new Error(`startCleanup: Page ${X.pageNumber} is currently rendering.`);this.commonObjs.clear(),O||this.fontLoader.clear(),t(this,kt).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:O,enableXfa:X}=this._params;return(0,n.shadow)(this,"loadingParams",{disableAutoFetch:O,enableXfa:X})}}kt=new WeakMap,jt=new WeakMap,St=new WeakMap,it=new WeakMap,st=new WeakSet,ui=function(O,X=null){const v=t(this,kt).get(O);if(v)return v;const S=this.messageHandler.sendWithPromise(O,X);return t(this,kt).set(O,S),S};class $t{constructor(){$(this,Ot);$(this,Ft,Object.create(null))}get(O,X=null){if(X){const S=Z(this,Ot,Hi).call(this,O);return S.capability.promise.then(()=>X(S.data)),null}const v=t(this,Ft)[O];if(!(v!=null&&v.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${O}.`);return v.data}has(O){const X=t(this,Ft)[O];return(X==null?void 0:X.capability.settled)||!1}resolve(O,X=null){const v=Z(this,Ot,Hi).call(this,O);v.data=X,v.capability.resolve()}clear(){var O;for(const X in t(this,Ft)){const{data:v}=t(this,Ft)[X];(O=v==null?void 0:v.bitmap)==null||O.close()}ot(this,Ft,Object.create(null))}}Ft=new WeakMap,Ot=new WeakSet,Hi=function(O){var X;return(X=t(this,Ft))[O]||(X[O]={capability:new n.PromiseCapability,data:null})};class T{constructor(O){$(this,Kt,null);ot(this,Kt,O),this.onContinue=null}get promise(){return t(this,Kt).capability.promise}cancel(O=0){t(this,Kt).cancel(null,O)}get separateAnnots(){const{separateAnnots:O}=t(this,Kt).operatorList;if(!O)return!1;const{annotationCanvasMap:X}=t(this,Kt);return O.form||O.canvas&&(X==null?void 0:X.size)>0}}Kt=new WeakMap,o.RenderTask=T;const Zt=class Zt{constructor({callback:O,params:X,objs:v,commonObjs:S,annotationCanvasMap:C,operatorList:rt,pageIndex:dt,canvasFactory:qt,filterFactory:ie,useRequestAnimationFrame:Y=!1,pdfBug:Tt=!1,pageColors:Nt=null}){this.callback=O,this.params=X,this.objs=v,this.commonObjs=S,this.annotationCanvasMap=C,this.operatorListIdx=null,this.operatorList=rt,this._pageIndex=dt,this.canvasFactory=qt,this.filterFactory=ie,this._pdfBug=Tt,this.pageColors=Nt,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=Y===!0&&typeof window<"u",this.cancelled=!1,this.capability=new n.PromiseCapability,this.task=new T(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=X.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:O=!1,optionalContentConfig:X}){var dt,qt;if(this.cancelled)return;if(this._canvas){if(t(Zt,Jt).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");t(Zt,Jt).add(this._canvas)}this._pdfBug&&((dt=globalThis.StepperManager)!=null&&dt.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:v,viewport:S,transform:C,background:rt}=this.params;this.gfx=new z.CanvasGraphics(v,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:X},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:C,viewport:S,transparency:O,background:rt}),this.operatorListIdx=0,this.graphicsReady=!0,(qt=this.graphicsReadyCallback)==null||qt.call(this)}cancel(O=null,X=0){var v;this.running=!1,this.cancelled=!0,(v=this.gfx)==null||v.endDrawing(),t(Zt,Jt).delete(this._canvas),this.callback(O||new V.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,X))}operatorListChanged(){var O;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(O=this.stepper)==null||O.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),t(Zt,Jt).delete(this._canvas),this.callback())))}};Jt=new WeakMap,$(Zt,Jt,new WeakSet);let i=Zt;const r="3.11.174";o.version=r;const s="ce8716743";o.build=s},(U,o,K)=>{var F,g,H,sn,L;Object.defineProperty(o,"__esModule",{value:!0}),o.SerializableEmpty=o.PrintAnnotationStorage=o.AnnotationStorage=void 0;var n=K(1),P=K(4),V=K(8);const q=Object.freeze({map:null,hash:"",transfers:void 0});o.SerializableEmpty=q;class gt{constructor(){$(this,H);$(this,F,!1);$(this,g,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(w,f){const b=t(this,g).get(w);return b===void 0?f:Object.assign(f,b)}getRawValue(w){return t(this,g).get(w)}remove(w){if(t(this,g).delete(w),t(this,g).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const f of t(this,g).values())if(f instanceof P.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(w,f){const b=t(this,g).get(w);let k=!1;if(b!==void 0)for(const[x,y]of Object.entries(f))b[x]!==y&&(k=!0,b[x]=y);else k=!0,t(this,g).set(w,f);k&&Z(this,H,sn).call(this),f instanceof P.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(f.constructor._type)}has(w){return t(this,g).has(w)}getAll(){return t(this,g).size>0?(0,n.objectFromMap)(t(this,g)):null}setAll(w){for(const[f,b]of Object.entries(w))this.setValue(f,b)}get size(){return t(this,g).size}resetModified(){t(this,F)&&(ot(this,F,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new z(this)}get serializable(){if(t(this,g).size===0)return q;const w=new Map,f=new V.MurmurHash3_64,b=[],k=Object.create(null);let x=!1;for(const[y,l]of t(this,g)){const h=l instanceof P.AnnotationEditor?l.serialize(!1,k):l;h&&(w.set(y,h),f.update(`${y}:${JSON.stringify(h)}`),x||(x=!!h.bitmap))}if(x)for(const y of w.values())y.bitmap&&b.push(y.bitmap);return w.size>0?{map:w,hash:f.hexdigest(),transfers:b}:q}}F=new WeakMap,g=new WeakMap,H=new WeakSet,sn=function(){t(this,F)||(ot(this,F,!0),typeof this.onSetModified=="function"&&this.onSetModified())},o.AnnotationStorage=gt;class z extends gt{constructor(f){super();$(this,L,void 0);const{map:b,hash:k,transfers:x}=f.serializable,y=structuredClone(b,x?{transfer:x}:null);ot(this,L,{map:y,hash:k,transfers:x})}get print(){(0,n.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return t(this,L)}}L=new WeakMap,o.PrintAnnotationStorage=z},(U,o,K)=>{var z,F,g,H,W,L,E,w,f,b,k,x,y,l,h,ji,Q,Wi,_t,zi,xt,Gi,j,nn,Et,rn,et,an,Rt,Xi,$t,on;Object.defineProperty(o,"__esModule",{value:!0}),o.AnnotationEditor=void 0;var n=K(5),P=K(1),V=K(6);const i=class i{constructor(s){$(this,h);$(this,Q);$(this,xt);$(this,j);$(this,Et);$(this,et);$(this,Rt);$(this,$t);$(this,z,"");$(this,F,!1);$(this,g,null);$(this,H,null);$(this,W,null);$(this,L,!1);$(this,E,null);$(this,w,this.focusin.bind(this));$(this,f,this.focusout.bind(this));$(this,b,!1);$(this,k,!1);$(this,x,!1);oe(this,"_initialOptions",Object.create(null));oe(this,"_uiManager",null);oe(this,"_focusEventsAllowed",!0);oe(this,"_l10nPromise",null);$(this,y,!1);$(this,l,i._zIndex++);this.constructor===i&&(0,P.unreachable)("Cannot initialize AnnotationEditor."),this.parent=s.parent,this.id=s.id,this.width=this.height=null,this.pageIndex=s.parent.pageIndex,this.name=s.name,this.div=null,this._uiManager=s.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=s.isCentered,this._structTreeParentId=null;const{rotation:c,rawDims:{pageWidth:d,pageHeight:m,pageX:M,pageY:B}}=this.parent.viewport;this.rotation=c,this.pageRotation=(360+c-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[d,m],this.pageTranslation=[M,B];const[lt,nt]=this.parentDimensions;this.x=s.x/lt,this.y=s.y/nt,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,P.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(s){const c=new gt({id:s.parent.getNextId(),parent:s.parent,uiManager:s._uiManager});c.annotationElementId=s.annotationElementId,c.deleted=!0,c._uiManager.addToAnnotationStorage(c)}static initialize(s,c=null){if(i._l10nPromise||(i._l10nPromise=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(m=>[m,s.get(m)]))),c!=null&&c.strings)for(const m of c.strings)i._l10nPromise.set(m,s.get(m));if(i._borderLineWidth!==-1)return;const d=getComputedStyle(document.documentElement);i._borderLineWidth=parseFloat(d.getPropertyValue("--outline-width"))||0}static updateDefaultParams(s,c){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(s){return!1}static paste(s,c){(0,P.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return t(this,y)}set _isDraggable(s){var c;ot(this,y,s),(c=this.div)==null||c.classList.toggle("draggable",s)}center(){const[s,c]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*c/(s*2),this.y+=this.width*s/(c*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*c/(s*2),this.y-=this.width*s/(c*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(s){this._uiManager.addCommands(s)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=t(this,l)}setParent(s){s!==null&&(this.pageIndex=s.pageIndex,this.pageDimensions=s.pageDimensions),this.parent=s}focusin(s){this._focusEventsAllowed&&(t(this,b)?ot(this,b,!1):this.parent.setSelected(this))}focusout(s){var d;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const c=s.relatedTarget;c!=null&&c.closest(`#${this.id}`)||(s.preventDefault(),(d=this.parent)!=null&&d.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(s,c,d,m){const[M,B]=this.parentDimensions;[d,m]=this.screenToPageTranslation(d,m),this.x=(s+d)/M,this.y=(c+m)/B,this.fixAndSetPosition()}translate(s,c){Z(this,h,ji).call(this,this.parentDimensions,s,c)}translateInPage(s,c){Z(this,h,ji).call(this,this.pageDimensions,s,c),this.div.scrollIntoView({block:"nearest"})}drag(s,c){const[d,m]=this.parentDimensions;if(this.x+=s/d,this.y+=c/m,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:ft,y:mt}=this.div.getBoundingClientRect();this.parent.findNewParent(this,ft,mt)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:M,y:B}=this;const[lt,nt]=Z(this,Q,Wi).call(this);M+=lt,B+=nt,this.div.style.left=`${(100*M).toFixed(2)}%`,this.div.style.top=`${(100*B).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[s,c]=this.pageDimensions;let{x:d,y:m,width:M,height:B}=this;switch(M*=s,B*=c,d*=s,m*=c,this.rotation){case 0:d=Math.max(0,Math.min(s-M,d)),m=Math.max(0,Math.min(c-B,m));break;case 90:d=Math.max(0,Math.min(s-B,d)),m=Math.min(c,Math.max(M,m));break;case 180:d=Math.min(s,Math.max(M,d)),m=Math.min(c,Math.max(B,m));break;case 270:d=Math.min(s,Math.max(B,d)),m=Math.max(0,Math.min(c-M,m));break}this.x=d/=s,this.y=m/=c;const[lt,nt]=Z(this,Q,Wi).call(this);d+=lt,m+=nt;const{style:ft}=this.div;ft.left=`${(100*d).toFixed(2)}%`,ft.top=`${(100*m).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(s,c){var d;return Z(d=i,_t,zi).call(d,s,c,this.parentRotation)}pageTranslationToScreen(s,c){var d;return Z(d=i,_t,zi).call(d,s,c,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:s,pageDimensions:[c,d]}=this,m=c*s,M=d*s;return P.FeatureTest.isCSSRoundSupported?[Math.round(m),Math.round(M)]:[m,M]}setDims(s,c){var M;const[d,m]=this.parentDimensions;this.div.style.width=`${(100*s/d).toFixed(2)}%`,t(this,L)||(this.div.style.height=`${(100*c/m).toFixed(2)}%`),(M=t(this,g))==null||M.classList.toggle("small",s<i.SMALL_EDITOR_SIZE||c<i.SMALL_EDITOR_SIZE)}fixDims(){const{style:s}=this.div,{height:c,width:d}=s,m=d.endsWith("%"),M=!t(this,L)&&c.endsWith("%");if(m&&M)return;const[B,lt]=this.parentDimensions;m||(s.width=`${(100*parseFloat(d)/B).toFixed(2)}%`),!t(this,L)&&!M&&(s.height=`${(100*parseFloat(c)/lt).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}async addAltTextButton(){if(t(this,g))return;const s=ot(this,g,document.createElement("button"));s.className="altText";const c=await i._l10nPromise.get("editor_alt_text_button_label");s.textContent=c,s.setAttribute("aria-label",c),s.tabIndex="0",s.addEventListener("contextmenu",V.noContextMenu),s.addEventListener("pointerdown",d=>d.stopPropagation()),s.addEventListener("click",d=>{d.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),s.addEventListener("keydown",d=>{d.target===s&&d.key==="Enter"&&(d.preventDefault(),this._uiManager.editAltText(this))}),Z(this,Rt,Xi).call(this),this.div.append(s),i.SMALL_EDITOR_SIZE||(i.SMALL_EDITOR_SIZE=Math.min(128,Math.round(s.getBoundingClientRect().width*1.4)))}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:t(this,z),decorative:t(this,F)}}set altTextData({altText:s,decorative:c}){t(this,z)===s&&t(this,F)===c||(ot(this,z,s),ot(this,F,c),Z(this,Rt,Xi).call(this))}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",t(this,w)),this.div.addEventListener("focusout",t(this,f));const[s,c]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*c/s).toFixed(2)}%`,this.div.style.maxHeight=`${(100*s/c).toFixed(2)}%`);const[d,m]=this.getInitialTranslation();return this.translate(d,m),(0,n.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(s){const{isMac:c}=P.FeatureTest.platform;if(s.button!==0||s.ctrlKey&&c){s.preventDefault();return}ot(this,b,!0),Z(this,$t,on).call(this,s)}moveInDOM(){var s;(s=this.parent)==null||s.moveEditorInDOM(this)}_setParentAndPosition(s,c,d){s.changeParent(this),this.x=c,this.y=d,this.fixAndSetPosition()}getRect(s,c){const d=this.parentScale,[m,M]=this.pageDimensions,[B,lt]=this.pageTranslation,nt=s/d,ft=c/d,mt=this.x*m,Mt=this.y*M,At=this.width*m,Bt=this.height*M;switch(this.rotation){case 0:return[mt+nt+B,M-Mt-ft-Bt+lt,mt+nt+At+B,M-Mt-ft+lt];case 90:return[mt+ft+B,M-Mt+nt+lt,mt+ft+Bt+B,M-Mt+nt+At+lt];case 180:return[mt-nt-At+B,M-Mt+ft+lt,mt-nt+B,M-Mt+ft+Bt+lt];case 270:return[mt-ft-Bt+B,M-Mt-nt-At+lt,mt-ft+B,M-Mt-nt+lt];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(s,c){const[d,m,M,B]=s,lt=M-d,nt=B-m;switch(this.rotation){case 0:return[d,c-B,lt,nt];case 90:return[d,c-m,nt,lt];case 180:return[M,c-m,lt,nt];case 270:return[M,c-B,nt,lt];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){ot(this,x,!0)}disableEditMode(){ot(this,x,!1)}isInEditMode(){return t(this,x)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var s,c;(s=this.div)==null||s.addEventListener("focusin",t(this,w)),(c=this.div)==null||c.addEventListener("focusout",t(this,f))}serialize(s=!1,c=null){(0,P.unreachable)("An editor must be serializable")}static deserialize(s,c,d){const m=new this.prototype.constructor({parent:c,id:c.getNextId(),uiManager:d});m.rotation=s.rotation;const[M,B]=m.pageDimensions,[lt,nt,ft,mt]=m.getRectInCurrentCoords(s.rect,B);return m.x=lt/M,m.y=nt/B,m.width=ft/M,m.height=mt/B,m}remove(){var s;this.div.removeEventListener("focusin",t(this,w)),this.div.removeEventListener("focusout",t(this,f)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),(s=t(this,g))==null||s.remove(),ot(this,g,null),ot(this,H,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(Z(this,j,nn).call(this),t(this,E).classList.remove("hidden"))}select(){var s;this.makeResizable(),(s=this.div)==null||s.classList.add("selectedEditor")}unselect(){var s,c,d;(s=t(this,E))==null||s.classList.add("hidden"),(c=this.div)==null||c.classList.remove("selectedEditor"),(d=this.div)!=null&&d.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(s,c){}disableEditing(){t(this,g)&&(t(this,g).hidden=!0)}enableEditing(){t(this,g)&&(t(this,g).hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return t(this,k)}set isEditing(s){ot(this,k,s),this.parent&&(s?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(s,c){ot(this,L,!0);const d=s/c,{style:m}=this.div;m.aspectRatio=d,m.height="auto"}static get MIN_SIZE(){return 16}};z=new WeakMap,F=new WeakMap,g=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakMap,E=new WeakMap,w=new WeakMap,f=new WeakMap,b=new WeakMap,k=new WeakMap,x=new WeakMap,y=new WeakMap,l=new WeakMap,h=new WeakSet,ji=function([s,c],d,m){[d,m]=this.screenToPageTranslation(d,m),this.x+=d/s,this.y+=m/c,this.fixAndSetPosition()},Q=new WeakSet,Wi=function(){const[s,c]=this.parentDimensions,{_borderLineWidth:d}=i,m=d/s,M=d/c;switch(this.rotation){case 90:return[-m,M];case 180:return[m,M];case 270:return[m,-M];default:return[-m,-M]}},_t=new WeakSet,zi=function(s,c,d){switch(d){case 90:return[c,-s];case 180:return[-s,-c];case 270:return[-c,s];default:return[s,c]}},xt=new WeakSet,Gi=function(s){switch(s){case 90:{const[c,d]=this.pageDimensions;return[0,-c/d,d/c,0]}case 180:return[-1,0,0,-1];case 270:{const[c,d]=this.pageDimensions;return[0,c/d,-d/c,0]}default:return[1,0,0,1]}},j=new WeakSet,nn=function(){if(t(this,E))return;ot(this,E,document.createElement("div")),t(this,E).classList.add("resizers");const s=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||s.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const c of s){const d=document.createElement("div");t(this,E).append(d),d.classList.add("resizer",c),d.addEventListener("pointerdown",Z(this,Et,rn).bind(this,c)),d.addEventListener("contextmenu",V.noContextMenu)}this.div.prepend(t(this,E))},Et=new WeakSet,rn=function(s,c){c.preventDefault();const{isMac:d}=P.FeatureTest.platform;if(c.button!==0||c.ctrlKey&&d)return;const m=Z(this,et,an).bind(this,s),M=this._isDraggable;this._isDraggable=!1;const B={passive:!0,capture:!0};window.addEventListener("pointermove",m,B);const lt=this.x,nt=this.y,ft=this.width,mt=this.height,Mt=this.parent.div.style.cursor,At=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(c.target).cursor;const Bt=()=>{this._isDraggable=M,window.removeEventListener("pointerup",Bt),window.removeEventListener("blur",Bt),window.removeEventListener("pointermove",m,B),this.parent.div.style.cursor=Mt,this.div.style.cursor=At;const Vt=this.x,kt=this.y,jt=this.width,St=this.height;Vt===lt&&kt===nt&&jt===ft&&St===mt||this.addCommands({cmd:()=>{this.width=jt,this.height=St,this.x=Vt,this.y=kt;const[it,st]=this.parentDimensions;this.setDims(it*jt,st*St),this.fixAndSetPosition()},undo:()=>{this.width=ft,this.height=mt,this.x=lt,this.y=nt;const[it,st]=this.parentDimensions;this.setDims(it*ft,st*mt),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",Bt),window.addEventListener("blur",Bt)},et=new WeakSet,an=function(s,c){const[d,m]=this.parentDimensions,M=this.x,B=this.y,lt=this.width,nt=this.height,ft=i.MIN_SIZE/d,mt=i.MIN_SIZE/m,Mt=rt=>Math.round(rt*1e4)/1e4,At=Z(this,xt,Gi).call(this,this.rotation),Bt=(rt,dt)=>[At[0]*rt+At[2]*dt,At[1]*rt+At[3]*dt],Vt=Z(this,xt,Gi).call(this,360-this.rotation),kt=(rt,dt)=>[Vt[0]*rt+Vt[2]*dt,Vt[1]*rt+Vt[3]*dt];let jt,St,it=!1,st=!1;switch(s){case"topLeft":it=!0,jt=(rt,dt)=>[0,0],St=(rt,dt)=>[rt,dt];break;case"topMiddle":jt=(rt,dt)=>[rt/2,0],St=(rt,dt)=>[rt/2,dt];break;case"topRight":it=!0,jt=(rt,dt)=>[rt,0],St=(rt,dt)=>[0,dt];break;case"middleRight":st=!0,jt=(rt,dt)=>[rt,dt/2],St=(rt,dt)=>[0,dt/2];break;case"bottomRight":it=!0,jt=(rt,dt)=>[rt,dt],St=(rt,dt)=>[0,0];break;case"bottomMiddle":jt=(rt,dt)=>[rt/2,dt],St=(rt,dt)=>[rt/2,0];break;case"bottomLeft":it=!0,jt=(rt,dt)=>[0,dt],St=(rt,dt)=>[rt,0];break;case"middleLeft":st=!0,jt=(rt,dt)=>[0,dt/2],St=(rt,dt)=>[rt,dt/2];break}const vt=jt(lt,nt),Ft=St(lt,nt);let Ot=Bt(...Ft);const te=Mt(M+Ot[0]),Kt=Mt(B+Ot[1]);let Jt=1,Zt=1,[pt,O]=this.screenToPageTranslation(c.movementX,c.movementY);if([pt,O]=kt(pt/d,O/m),it){const rt=Math.hypot(lt,nt);Jt=Zt=Math.max(Math.min(Math.hypot(Ft[0]-vt[0]-pt,Ft[1]-vt[1]-O)/rt,1/lt,1/nt),ft/lt,mt/nt)}else st?Jt=Math.max(ft,Math.min(1,Math.abs(Ft[0]-vt[0]-pt)))/lt:Zt=Math.max(mt,Math.min(1,Math.abs(Ft[1]-vt[1]-O)))/nt;const X=Mt(lt*Jt),v=Mt(nt*Zt);Ot=Bt(...St(X,v));const S=te-Ot[0],C=Kt-Ot[1];this.width=X,this.height=v,this.x=S,this.y=C,this.setDims(d*X,m*v),this.fixAndSetPosition()},Rt=new WeakSet,Xi=async function(){var d;const s=t(this,g);if(!s)return;if(!t(this,z)&&!t(this,F)){s.classList.remove("done"),(d=t(this,H))==null||d.remove();return}i._l10nPromise.get("editor_alt_text_edit_button_label").then(m=>{s.setAttribute("aria-label",m)});let c=t(this,H);if(!c){ot(this,H,c=document.createElement("span")),c.className="tooltip",c.setAttribute("role","tooltip");const m=c.id=`alt-text-tooltip-${this.id}`;s.setAttribute("aria-describedby",m);const M=100;s.addEventListener("mouseenter",()=>{ot(this,W,setTimeout(()=>{ot(this,W,null),t(this,H).classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},M))}),s.addEventListener("mouseleave",()=>{var B;clearTimeout(t(this,W)),ot(this,W,null),(B=t(this,H))==null||B.classList.remove("show")})}s.classList.add("done"),c.innerText=t(this,F)?await i._l10nPromise.get("editor_alt_text_decorative_tooltip"):t(this,z),c.parentNode||s.append(c)},$t=new WeakSet,on=function(s){if(!this._isDraggable)return;const c=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let d,m;c&&(d={passive:!0,capture:!0},m=B=>{const[lt,nt]=this.screenToPageTranslation(B.movementX,B.movementY);this._uiManager.dragSelectedEditors(lt,nt)},window.addEventListener("pointermove",m,d));const M=()=>{if(window.removeEventListener("pointerup",M),window.removeEventListener("blur",M),c&&window.removeEventListener("pointermove",m,d),ot(this,b,!1),!this._uiManager.endDragSession()){const{isMac:B}=P.FeatureTest.platform;s.ctrlKey&&!B||s.shiftKey||s.metaKey&&B?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",M),window.addEventListener("blur",M)},$(i,_t),oe(i,"_borderLineWidth",-1),oe(i,"_colorManager",new n.ColorManager),oe(i,"_zIndex",1),oe(i,"SMALL_EDITOR_SIZE",0);let q=i;o.AnnotationEditor=q;class gt extends q{constructor(s){super(s),this.annotationElementId=s.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(U,o,K)=>{var L,E,w,f,b,Vi,y,l,h,I,Q,ln,at,xt,Ct,j,ut,Et,yt,et,bt,Rt,Ut,$t,T,i,r,s,c,d,m,M,B,lt,nt,ft,mt,Mt,At,Bt,Vt,kt,jt,St,it,st,vt,cn,Ot,qi,Kt,Yi,Zt,fi,O,Ki,v,Ji,C,me,dt,Ge,ie,hn,Tt,dn,Dt,Qi,Gt,Xe,Pt,Zi;Object.defineProperty(o,"__esModule",{value:!0}),o.KeyboardManager=o.CommandManager=o.ColorManager=o.AnnotationEditorUIManager=void 0,o.bindEvents=V,o.opacityToHex=q;var n=K(1),P=K(6);function V(D,e,p){for(const N of p)e.addEventListener(N,D[N].bind(D))}function q(D){return Math.round(Math.min(255,Math.max(1,255*D))).toString(16).padStart(2,"0")}class gt{constructor(){$(this,L,0)}getId(){return`${n.AnnotationEditorPrefix}${We(this,L)._++}`}}L=new WeakMap;const x=class x{constructor(){$(this,b);$(this,E,(0,n.getUuid)());$(this,w,0);$(this,f,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',N=new OffscreenCanvas(1,3).getContext("2d"),G=new Image;G.src=e;const tt=G.decode().then(()=>(N.drawImage(G,0,0,1,1,0,0,1,3),new Uint32Array(N.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,n.shadow)(this,"_isSVGFittingCanvas",tt)}async getFromFile(e){const{lastModified:p,name:N,size:G,type:tt}=e;return Z(this,b,Vi).call(this,`${p}_${N}_${G}_${tt}`,e)}async getFromUrl(e){return Z(this,b,Vi).call(this,e,e)}async getFromId(e){t(this,f)||ot(this,f,new Map);const p=t(this,f).get(e);return p?p.bitmap?(p.refCounter+=1,p):p.file?this.getFromFile(p.file):this.getFromUrl(p.url):null}getSvgUrl(e){const p=t(this,f).get(e);return p!=null&&p.isSvg?p.svgUrl:null}deleteId(e){t(this,f)||ot(this,f,new Map);const p=t(this,f).get(e);p&&(p.refCounter-=1,p.refCounter===0&&(p.bitmap=null))}isValidId(e){return e.startsWith(`image_${t(this,E)}_`)}};E=new WeakMap,w=new WeakMap,f=new WeakMap,b=new WeakSet,Vi=async function(e,p){t(this,f)||ot(this,f,new Map);let N=t(this,f).get(e);if(N===null)return null;if(N!=null&&N.bitmap)return N.refCounter+=1,N;try{N||(N={bitmap:null,id:`image_${t(this,E)}_${We(this,w)._++}`,refCounter:0,isSvg:!1});let G;if(typeof p=="string"){N.url=p;const tt=await fetch(p);if(!tt.ok)throw new Error(tt.statusText);G=await tt.blob()}else G=N.file=p;if(G.type==="image/svg+xml"){const tt=x._isSVGFittingCanvas,ct=new FileReader,wt=new Image,Lt=new Promise((It,Qt)=>{wt.onload=()=>{N.bitmap=wt,N.isSvg=!0,It()},ct.onload=async()=>{const Ht=N.svgUrl=ct.result;wt.src=await tt?`${Ht}#svgView(preserveAspectRatio(none))`:Ht},wt.onerror=ct.onerror=Qt});ct.readAsDataURL(G),await Lt}else N.bitmap=await createImageBitmap(G);N.refCounter=1}catch(G){console.error(G),N=null}return t(this,f).set(e,N),N&&t(this,f).set(N.id,N),N};let z=x;class F{constructor(e=128){$(this,y,[]);$(this,l,!1);$(this,h,void 0);$(this,I,-1);ot(this,h,e)}add({cmd:e,undo:p,mustExec:N,type:G=NaN,overwriteIfSameType:tt=!1,keepUndo:ct=!1}){if(N&&e(),t(this,l))return;const wt={cmd:e,undo:p,type:G};if(t(this,I)===-1){t(this,y).length>0&&(t(this,y).length=0),ot(this,I,0),t(this,y).push(wt);return}if(tt&&t(this,y)[t(this,I)].type===G){ct&&(wt.undo=t(this,y)[t(this,I)].undo),t(this,y)[t(this,I)]=wt;return}const Lt=t(this,I)+1;Lt===t(this,h)?t(this,y).splice(0,1):(ot(this,I,Lt),Lt<t(this,y).length&&t(this,y).splice(Lt)),t(this,y).push(wt)}undo(){t(this,I)!==-1&&(ot(this,l,!0),t(this,y)[t(this,I)].undo(),ot(this,l,!1),ot(this,I,t(this,I)-1))}redo(){t(this,I)<t(this,y).length-1&&(ot(this,I,t(this,I)+1),ot(this,l,!0),t(this,y)[t(this,I)].cmd(),ot(this,l,!1))}hasSomethingToUndo(){return t(this,I)!==-1}hasSomethingToRedo(){return t(this,I)<t(this,y).length-1}destroy(){ot(this,y,null)}}y=new WeakMap,l=new WeakMap,h=new WeakMap,I=new WeakMap,o.CommandManager=F;class g{constructor(e){$(this,Q);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:p}=n.FeatureTest.platform;for(const[N,G,tt={}]of e)for(const ct of N){const wt=ct.startsWith("mac+");p&&wt?(this.callbacks.set(ct.slice(4),{callback:G,options:tt}),this.allKeys.add(ct.split("+").at(-1))):!p&&!wt&&(this.callbacks.set(ct,{callback:G,options:tt}),this.allKeys.add(ct.split("+").at(-1)))}}exec(e,p){if(!this.allKeys.has(p.key))return;const N=this.callbacks.get(Z(this,Q,ln).call(this,p));if(!N)return;const{callback:G,options:{bubbles:tt=!1,args:ct=[],checker:wt=null}}=N;wt&&!wt(e,p)||(G.bind(e,...ct)(),tt||(p.stopPropagation(),p.preventDefault()))}}Q=new WeakSet,ln=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const p=this.buffer.join("+");return this.buffer.length=0,p},o.KeyboardManager=g;const _t=class _t{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return(0,P.getColorValues)(e),(0,n.shadow)(this,"_colors",e)}convert(e){const p=(0,P.getRGB)(e);if(!window.matchMedia("(forced-colors: active)").matches)return p;for(const[N,G]of this._colors)if(G.every((tt,ct)=>tt===p[ct]))return _t._colorsMapping.get(N);return p}getHexCode(e){const p=this._colors.get(e);return p?n.Util.makeHexColor(...p):e}};oe(_t,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let H=_t;o.ColorManager=H;const Wt=class Wt{constructor(e,p,N,G,tt,ct){$(this,vt);$(this,Ot);$(this,Kt);$(this,Zt);$(this,O);$(this,v);$(this,C);$(this,dt);$(this,ie);$(this,Tt);$(this,Dt);$(this,Gt);$(this,Pt);$(this,at,null);$(this,xt,new Map);$(this,Ct,new Map);$(this,j,null);$(this,ut,null);$(this,Et,new F);$(this,yt,0);$(this,et,new Set);$(this,bt,null);$(this,Rt,null);$(this,Ut,new Set);$(this,$t,null);$(this,T,new gt);$(this,i,!1);$(this,r,!1);$(this,s,null);$(this,c,n.AnnotationEditorType.NONE);$(this,d,new Set);$(this,m,null);$(this,M,this.blur.bind(this));$(this,B,this.focus.bind(this));$(this,lt,this.copy.bind(this));$(this,nt,this.cut.bind(this));$(this,ft,this.paste.bind(this));$(this,mt,this.keydown.bind(this));$(this,Mt,this.onEditingAction.bind(this));$(this,At,this.onPageChanging.bind(this));$(this,Bt,this.onScaleChanging.bind(this));$(this,Vt,this.onRotationChanging.bind(this));$(this,kt,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});$(this,jt,[0,0]);$(this,St,null);$(this,it,null);$(this,st,null);ot(this,it,e),ot(this,st,p),ot(this,j,N),this._eventBus=G,this._eventBus._on("editingaction",t(this,Mt)),this._eventBus._on("pagechanging",t(this,At)),this._eventBus._on("scalechanging",t(this,Bt)),this._eventBus._on("rotationchanging",t(this,Vt)),ot(this,ut,tt.annotationStorage),ot(this,$t,tt.filterFactory),ot(this,m,ct),this.viewParameters={realScale:P.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const e=Wt.prototype,p=tt=>{const{activeElement:ct}=document;return ct&&t(tt,it).contains(ct)&&tt.hasSomethingToControl()},N=this.TRANSLATE_SMALL,G=this.TRANSLATE_BIG;return(0,n.shadow)(this,"_keyboardManager",new g([[["ctrl+a","mac+meta+a"],e.selectAll],[["ctrl+z","mac+meta+z"],e.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-N,0],checker:p}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-G,0],checker:p}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[N,0],checker:p}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[G,0],checker:p}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-N],checker:p}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-G],checker:p}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,N],checker:p}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,G],checker:p}]]))}destroy(){Z(this,Zt,fi).call(this),Z(this,Ot,qi).call(this),this._eventBus._off("editingaction",t(this,Mt)),this._eventBus._off("pagechanging",t(this,At)),this._eventBus._off("scalechanging",t(this,Bt)),this._eventBus._off("rotationchanging",t(this,Vt));for(const e of t(this,Ct).values())e.destroy();t(this,Ct).clear(),t(this,xt).clear(),t(this,Ut).clear(),ot(this,at,null),t(this,d).clear(),t(this,Et).destroy(),t(this,j).destroy()}get hcmFilter(){return(0,n.shadow)(this,"hcmFilter",t(this,m)?t(this,$t).addHCMFilter(t(this,m).foreground,t(this,m).background):"none")}get direction(){return(0,n.shadow)(this,"direction",getComputedStyle(t(this,it)).direction)}editAltText(e){var p;(p=t(this,j))==null||p.editAltText(this,e)}onPageChanging({pageNumber:e}){ot(this,yt,e-1)}focusMainContainer(){t(this,it).focus()}findParent(e,p){for(const N of t(this,Ct).values()){const{x:G,y:tt,width:ct,height:wt}=N.div.getBoundingClientRect();if(e>=G&&e<=G+ct&&p>=tt&&p<=tt+wt)return N}return null}disableUserSelect(e=!1){t(this,st).classList.toggle("noUserSelect",e)}addShouldRescale(e){t(this,Ut).add(e)}removeShouldRescale(e){t(this,Ut).delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*P.PixelsPerInch.PDF_TO_CSS_UNITS;for(const p of t(this,Ut))p.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}addToAnnotationStorage(e){!e.isEmpty()&&t(this,ut)&&!t(this,ut).has(e.id)&&t(this,ut).setValue(e.id,e)}blur(){if(!this.hasSelection)return;const{activeElement:e}=document;for(const p of t(this,d))if(p.div.contains(e)){ot(this,s,[p,e]),p._focusEventsAllowed=!1;break}}focus(){if(!t(this,s))return;const[e,p]=t(this,s);ot(this,s,null),p.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0}),p.focus()}addEditListeners(){Z(this,Kt,Yi).call(this),Z(this,O,Ki).call(this)}removeEditListeners(){Z(this,Zt,fi).call(this),Z(this,v,Ji).call(this)}copy(e){var N;if(e.preventDefault(),(N=t(this,at))==null||N.commitOrRemove(),!this.hasSelection)return;const p=[];for(const G of t(this,d)){const tt=G.serialize(!0);tt&&p.push(tt)}p.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(p))}cut(e){this.copy(e),this.delete()}paste(e){e.preventDefault();const{clipboardData:p}=e;for(const tt of p.items)for(const ct of t(this,Rt))if(ct.isHandlingMimeForPasting(tt.type)){ct.paste(tt,this.currentLayer);return}let N=p.getData("application/pdfjs");if(!N)return;try{N=JSON.parse(N)}catch(tt){(0,n.warn)(`paste: "${tt.message}".`);return}if(!Array.isArray(N))return;this.unselectAll();const G=this.currentLayer;try{const tt=[];for(const Lt of N){const It=G.deserialize(Lt);if(!It)return;tt.push(It)}const ct=()=>{for(const Lt of tt)Z(this,Dt,Qi).call(this,Lt);Z(this,Pt,Zi).call(this,tt)},wt=()=>{for(const Lt of tt)Lt.remove()};this.addCommands({cmd:ct,undo:wt,mustExec:!0})}catch(tt){(0,n.warn)(`paste: "${tt.message}".`)}}keydown(e){var p;(p=this.getActive())!=null&&p.shouldGetKeyboardEvents()||Wt._keyboardManager.exec(this,e)}onEditingAction(e){["undo","redo","delete","selectAll"].includes(e.name)&&this[e.name]()}setEditingState(e){e?(Z(this,vt,cn).call(this),Z(this,Kt,Yi).call(this),Z(this,O,Ki).call(this),Z(this,C,me).call(this,{isEditing:t(this,c)!==n.AnnotationEditorType.NONE,isEmpty:Z(this,Gt,Xe).call(this),hasSomethingToUndo:t(this,Et).hasSomethingToUndo(),hasSomethingToRedo:t(this,Et).hasSomethingToRedo(),hasSelectedEditor:!1})):(Z(this,Ot,qi).call(this),Z(this,Zt,fi).call(this),Z(this,v,Ji).call(this),Z(this,C,me).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!t(this,Rt)){ot(this,Rt,e);for(const p of t(this,Rt))Z(this,dt,Ge).call(this,p.defaultPropertiesToUpdate)}}getId(){return t(this,T).getId()}get currentLayer(){return t(this,Ct).get(t(this,yt))}getLayer(e){return t(this,Ct).get(e)}get currentPageIndex(){return t(this,yt)}addLayer(e){t(this,Ct).set(e.pageIndex,e),t(this,i)?e.enable():e.disable()}removeLayer(e){t(this,Ct).delete(e.pageIndex)}updateMode(e,p=null){if(t(this,c)!==e){if(ot(this,c,e),e===n.AnnotationEditorType.NONE){this.setEditingState(!1),Z(this,Tt,dn).call(this);return}this.setEditingState(!0),Z(this,ie,hn).call(this),this.unselectAll();for(const N of t(this,Ct).values())N.updateMode(e);if(p){for(const N of t(this,xt).values())if(N.annotationElementId===p){this.setSelected(N),N.enterInEditMode();break}}}}updateToolbar(e){e!==t(this,c)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,p){if(t(this,Rt)){if(e===n.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(e);return}for(const N of t(this,d))N.updateParams(e,p);for(const N of t(this,Rt))N.updateDefaultParams(e,p)}}enableWaiting(e=!1){if(t(this,r)!==e){ot(this,r,e);for(const p of t(this,Ct).values())e?p.disableClick():p.enableClick(),p.div.classList.toggle("waiting",e)}}getEditors(e){const p=[];for(const N of t(this,xt).values())N.pageIndex===e&&p.push(N);return p}getEditor(e){return t(this,xt).get(e)}addEditor(e){t(this,xt).set(e.id,e)}removeEditor(e){var p;t(this,xt).delete(e.id),this.unselect(e),(!e.annotationElementId||!t(this,et).has(e.annotationElementId))&&((p=t(this,ut))==null||p.remove(e.id))}addDeletedAnnotationElement(e){t(this,et).add(e.annotationElementId),e.deleted=!0}isDeletedAnnotationElement(e){return t(this,et).has(e)}removeDeletedAnnotationElement(e){t(this,et).delete(e.annotationElementId),e.deleted=!1}setActiveEditor(e){t(this,at)!==e&&(ot(this,at,e),e&&Z(this,dt,Ge).call(this,e.propertiesToUpdate))}toggleSelected(e){if(t(this,d).has(e)){t(this,d).delete(e),e.unselect(),Z(this,C,me).call(this,{hasSelectedEditor:this.hasSelection});return}t(this,d).add(e),e.select(),Z(this,dt,Ge).call(this,e.propertiesToUpdate),Z(this,C,me).call(this,{hasSelectedEditor:!0})}setSelected(e){for(const p of t(this,d))p!==e&&p.unselect();t(this,d).clear(),t(this,d).add(e),e.select(),Z(this,dt,Ge).call(this,e.propertiesToUpdate),Z(this,C,me).call(this,{hasSelectedEditor:!0})}isSelected(e){return t(this,d).has(e)}unselect(e){e.unselect(),t(this,d).delete(e),Z(this,C,me).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return t(this,d).size!==0}undo(){t(this,Et).undo(),Z(this,C,me).call(this,{hasSomethingToUndo:t(this,Et).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:Z(this,Gt,Xe).call(this)})}redo(){t(this,Et).redo(),Z(this,C,me).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:t(this,Et).hasSomethingToRedo(),isEmpty:Z(this,Gt,Xe).call(this)})}addCommands(e){t(this,Et).add(e),Z(this,C,me).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:Z(this,Gt,Xe).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const e=[...t(this,d)],p=()=>{for(const G of e)G.remove()},N=()=>{for(const G of e)Z(this,Dt,Qi).call(this,G)};this.addCommands({cmd:p,undo:N,mustExec:!0})}commitOrRemove(){var e;(e=t(this,at))==null||e.commitOrRemove()}hasSomethingToControl(){return t(this,at)||this.hasSelection}selectAll(){for(const e of t(this,d))e.commit();Z(this,Pt,Zi).call(this,t(this,xt).values())}unselectAll(){if(t(this,at)){t(this,at).commitOrRemove();return}if(this.hasSelection){for(const e of t(this,d))e.unselect();t(this,d).clear(),Z(this,C,me).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,p,N=!1){if(N||this.commitOrRemove(),!this.hasSelection)return;t(this,jt)[0]+=e,t(this,jt)[1]+=p;const[G,tt]=t(this,jt),ct=[...t(this,d)],wt=1e3;t(this,St)&&clearTimeout(t(this,St)),ot(this,St,setTimeout(()=>{ot(this,St,null),t(this,jt)[0]=t(this,jt)[1]=0,this.addCommands({cmd:()=>{for(const Lt of ct)t(this,xt).has(Lt.id)&&Lt.translateInPage(G,tt)},undo:()=>{for(const Lt of ct)t(this,xt).has(Lt.id)&&Lt.translateInPage(-G,-tt)},mustExec:!1})},wt));for(const Lt of ct)Lt.translateInPage(e,p)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),ot(this,bt,new Map);for(const e of t(this,d))t(this,bt).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!t(this,bt))return!1;this.disableUserSelect(!1);const e=t(this,bt);ot(this,bt,null);let p=!1;for(const[{x:G,y:tt,pageIndex:ct},wt]of e)wt.newX=G,wt.newY=tt,wt.newPageIndex=ct,p||(p=G!==wt.savedX||tt!==wt.savedY||ct!==wt.savedPageIndex);if(!p)return!1;const N=(G,tt,ct,wt)=>{if(t(this,xt).has(G.id)){const Lt=t(this,Ct).get(wt);Lt?G._setParentAndPosition(Lt,tt,ct):(G.pageIndex=wt,G.x=tt,G.y=ct)}};return this.addCommands({cmd:()=>{for(const[G,{newX:tt,newY:ct,newPageIndex:wt}]of e)N(G,tt,ct,wt)},undo:()=>{for(const[G,{savedX:tt,savedY:ct,savedPageIndex:wt}]of e)N(G,tt,ct,wt)},mustExec:!0}),!0}dragSelectedEditors(e,p){if(t(this,bt))for(const N of t(this,bt).keys())N.drag(e,p)}rebuild(e){if(e.parent===null){const p=this.getLayer(e.pageIndex);p?(p.changeParent(e),p.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}isActive(e){return t(this,at)===e}getActive(){return t(this,at)}getMode(){return t(this,c)}get imageManager(){return(0,n.shadow)(this,"imageManager",new z)}};at=new WeakMap,xt=new WeakMap,Ct=new WeakMap,j=new WeakMap,ut=new WeakMap,Et=new WeakMap,yt=new WeakMap,et=new WeakMap,bt=new WeakMap,Rt=new WeakMap,Ut=new WeakMap,$t=new WeakMap,T=new WeakMap,i=new WeakMap,r=new WeakMap,s=new WeakMap,c=new WeakMap,d=new WeakMap,m=new WeakMap,M=new WeakMap,B=new WeakMap,lt=new WeakMap,nt=new WeakMap,ft=new WeakMap,mt=new WeakMap,Mt=new WeakMap,At=new WeakMap,Bt=new WeakMap,Vt=new WeakMap,kt=new WeakMap,jt=new WeakMap,St=new WeakMap,it=new WeakMap,st=new WeakMap,vt=new WeakSet,cn=function(){window.addEventListener("focus",t(this,B)),window.addEventListener("blur",t(this,M))},Ot=new WeakSet,qi=function(){window.removeEventListener("focus",t(this,B)),window.removeEventListener("blur",t(this,M))},Kt=new WeakSet,Yi=function(){window.addEventListener("keydown",t(this,mt),{capture:!0})},Zt=new WeakSet,fi=function(){window.removeEventListener("keydown",t(this,mt),{capture:!0})},O=new WeakSet,Ki=function(){document.addEventListener("copy",t(this,lt)),document.addEventListener("cut",t(this,nt)),document.addEventListener("paste",t(this,ft))},v=new WeakSet,Ji=function(){document.removeEventListener("copy",t(this,lt)),document.removeEventListener("cut",t(this,nt)),document.removeEventListener("paste",t(this,ft))},C=new WeakSet,me=function(e){Object.entries(e).some(([N,G])=>t(this,kt)[N]!==G)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(t(this,kt),e)})},dt=new WeakSet,Ge=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},ie=new WeakSet,hn=function(){if(!t(this,i)){ot(this,i,!0);for(const e of t(this,Ct).values())e.enable()}},Tt=new WeakSet,dn=function(){if(this.unselectAll(),t(this,i)){ot(this,i,!1);for(const e of t(this,Ct).values())e.disable()}},Dt=new WeakSet,Qi=function(e){const p=t(this,Ct).get(e.pageIndex);p?p.addOrRebuild(e):this.addEditor(e)},Gt=new WeakSet,Xe=function(){if(t(this,xt).size===0)return!0;if(t(this,xt).size===1)for(const e of t(this,xt).values())return e.isEmpty();return!1},Pt=new WeakSet,Zi=function(e){t(this,d).clear();for(const p of e)p.isEmpty()||(t(this,d).add(p),p.select());Z(this,C,me).call(this,{hasSelectedEditor:!0})},oe(Wt,"TRANSLATE_SMALL",1),oe(Wt,"TRANSLATE_BIG",10);let W=Wt;o.AnnotationEditorUIManager=W},(U,o,K)=>{var yt,et,bt,Rt,Ut,$t,T,i,r,s,c,d,Le,M,Ne,lt,ts,ft,pi,Mt,gi,Bt,Ve,kt,qe;Object.defineProperty(o,"__esModule",{value:!0}),o.StatTimer=o.RenderingCancelledException=o.PixelsPerInch=o.PageViewport=o.PDFDateString=o.DOMStandardFontDataFactory=o.DOMSVGFactory=o.DOMFilterFactory=o.DOMCanvasFactory=o.DOMCMapReaderFactory=void 0,o.deprecated=I,o.getColorValues=xt,o.getCurrentTransform=Ct,o.getCurrentTransformInverse=j,o.getFilenameFromUrl=b,o.getPdfFilenameFromUrl=k,o.getRGB=at,o.getXfaPageViewport=_t,o.isDataScheme=w,o.isPdfFile=f,o.isValidFetchUrl=y,o.loadScript=h,o.noContextMenu=l,o.setLayerDimensions=ut;var n=K(7),P=K(1);const V="http://www.w3.org/2000/svg",Et=class Et{};oe(Et,"CSS",96),oe(Et,"PDF",72),oe(Et,"PDF_TO_CSS_UNITS",Et.CSS/Et.PDF);let q=Et;o.PixelsPerInch=q;class gt extends n.BaseFilterFactory{constructor({docId:st,ownerDocument:vt=globalThis.document}={}){super();$(this,d);$(this,M);$(this,lt);$(this,ft);$(this,Mt);$(this,Bt);$(this,kt);$(this,yt,void 0);$(this,et,void 0);$(this,bt,void 0);$(this,Rt,void 0);$(this,Ut,void 0);$(this,$t,void 0);$(this,T,void 0);$(this,i,void 0);$(this,r,void 0);$(this,s,void 0);$(this,c,0);ot(this,bt,st),ot(this,Rt,vt)}addFilter(st){if(!st)return"none";let vt=t(this,d,Le).get(st);if(vt)return vt;let Ft,Ot,te,Kt;if(st.length===1){const O=st[0],X=new Array(256);for(let v=0;v<256;v++)X[v]=O[v]/255;Kt=Ft=Ot=te=X.join(",")}else{const[O,X,v]=st,S=new Array(256),C=new Array(256),rt=new Array(256);for(let dt=0;dt<256;dt++)S[dt]=O[dt]/255,C[dt]=X[dt]/255,rt[dt]=v[dt]/255;Ft=S.join(","),Ot=C.join(","),te=rt.join(","),Kt=`${Ft}${Ot}${te}`}if(vt=t(this,d,Le).get(Kt),vt)return t(this,d,Le).set(st,vt),vt;const Jt=`g_${t(this,bt)}_transfer_map_${We(this,c)._++}`,Zt=`url(#${Jt})`;t(this,d,Le).set(st,Zt),t(this,d,Le).set(Kt,Zt);const pt=Z(this,ft,pi).call(this,Jt);return Z(this,Bt,Ve).call(this,Ft,Ot,te,pt),Zt}addHCMFilter(st,vt){var X;const Ft=`${st}-${vt}`;if(t(this,$t)===Ft)return t(this,T);if(ot(this,$t,Ft),ot(this,T,"none"),(X=t(this,Ut))==null||X.remove(),!st||!vt)return t(this,T);const Ot=Z(this,kt,qe).call(this,st);st=P.Util.makeHexColor(...Ot);const te=Z(this,kt,qe).call(this,vt);if(vt=P.Util.makeHexColor(...te),t(this,M,Ne).style.color="",st==="#000000"&&vt==="#ffffff"||st===vt)return t(this,T);const Kt=new Array(256);for(let v=0;v<=255;v++){const S=v/255;Kt[v]=S<=.03928?S/12.92:((S+.055)/1.055)**2.4}const Jt=Kt.join(","),Zt=`g_${t(this,bt)}_hcm_filter`,pt=ot(this,i,Z(this,ft,pi).call(this,Zt));Z(this,Bt,Ve).call(this,Jt,Jt,Jt,pt),Z(this,lt,ts).call(this,pt);const O=(v,S)=>{const C=Ot[v]/255,rt=te[v]/255,dt=new Array(S+1);for(let qt=0;qt<=S;qt++)dt[qt]=C+qt/S*(rt-C);return dt.join(",")};return Z(this,Bt,Ve).call(this,O(0,5),O(1,5),O(2,5),pt),ot(this,T,`url(#${Zt})`),t(this,T)}addHighlightHCMFilter(st,vt,Ft,Ot){var rt;const te=`${st}-${vt}-${Ft}-${Ot}`;if(t(this,r)===te)return t(this,s);if(ot(this,r,te),ot(this,s,"none"),(rt=t(this,i))==null||rt.remove(),!st||!vt)return t(this,s);const[Kt,Jt]=[st,vt].map(Z(this,kt,qe).bind(this));let Zt=Math.round(.2126*Kt[0]+.7152*Kt[1]+.0722*Kt[2]),pt=Math.round(.2126*Jt[0]+.7152*Jt[1]+.0722*Jt[2]),[O,X]=[Ft,Ot].map(Z(this,kt,qe).bind(this));pt<Zt&&([Zt,pt,O,X]=[pt,Zt,X,O]),t(this,M,Ne).style.color="";const v=(dt,qt,ie)=>{const Y=new Array(256),Tt=(pt-Zt)/ie,Nt=dt/255,Dt=(qt-dt)/(255*ie);let Xt=0;for(let Gt=0;Gt<=ie;Gt++){const ne=Math.round(Zt+Gt*Tt),Pt=Nt+Gt*Dt;for(let se=Xt;se<=ne;se++)Y[se]=Pt;Xt=ne+1}for(let Gt=Xt;Gt<256;Gt++)Y[Gt]=Y[Xt-1];return Y.join(",")},S=`g_${t(this,bt)}_hcm_highlight_filter`,C=ot(this,i,Z(this,ft,pi).call(this,S));return Z(this,lt,ts).call(this,C),Z(this,Bt,Ve).call(this,v(O[0],X[0],5),v(O[1],X[1],5),v(O[2],X[2],5),C),ot(this,s,`url(#${S})`),t(this,s)}destroy(st=!1){st&&(t(this,T)||t(this,s))||(t(this,et)&&(t(this,et).parentNode.parentNode.remove(),ot(this,et,null)),t(this,yt)&&(t(this,yt).clear(),ot(this,yt,null)),ot(this,c,0))}}yt=new WeakMap,et=new WeakMap,bt=new WeakMap,Rt=new WeakMap,Ut=new WeakMap,$t=new WeakMap,T=new WeakMap,i=new WeakMap,r=new WeakMap,s=new WeakMap,c=new WeakMap,d=new WeakSet,Le=function(){return t(this,yt)||ot(this,yt,new Map)},M=new WeakSet,Ne=function(){if(!t(this,et)){const st=t(this,Rt).createElement("div"),{style:vt}=st;vt.visibility="hidden",vt.contain="strict",vt.width=vt.height=0,vt.position="absolute",vt.top=vt.left=0,vt.zIndex=-1;const Ft=t(this,Rt).createElementNS(V,"svg");Ft.setAttribute("width",0),Ft.setAttribute("height",0),ot(this,et,t(this,Rt).createElementNS(V,"defs")),st.append(Ft),Ft.append(t(this,et)),t(this,Rt).body.append(st)}return t(this,et)},lt=new WeakSet,ts=function(st){const vt=t(this,Rt).createElementNS(V,"feColorMatrix");vt.setAttribute("type","matrix"),vt.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),st.append(vt)},ft=new WeakSet,pi=function(st){const vt=t(this,Rt).createElementNS(V,"filter");return vt.setAttribute("color-interpolation-filters","sRGB"),vt.setAttribute("id",st),t(this,M,Ne).append(vt),vt},Mt=new WeakSet,gi=function(st,vt,Ft){const Ot=t(this,Rt).createElementNS(V,vt);Ot.setAttribute("type","discrete"),Ot.setAttribute("tableValues",Ft),st.append(Ot)},Bt=new WeakSet,Ve=function(st,vt,Ft,Ot){const te=t(this,Rt).createElementNS(V,"feComponentTransfer");Ot.append(te),Z(this,Mt,gi).call(this,te,"feFuncR",st),Z(this,Mt,gi).call(this,te,"feFuncG",vt),Z(this,Mt,gi).call(this,te,"feFuncB",Ft)},kt=new WeakSet,qe=function(st){return t(this,M,Ne).style.color=st,at(getComputedStyle(t(this,M,Ne)).getPropertyValue("color"))},o.DOMFilterFactory=gt;class z extends n.BaseCanvasFactory{constructor({ownerDocument:it=globalThis.document}={}){super(),this._document=it}_createCanvas(it,st){const vt=this._document.createElement("canvas");return vt.width=it,vt.height=st,vt}}o.DOMCanvasFactory=z;async function F(St,it=!1){if(y(St,document.baseURI)){const st=await fetch(St);if(!st.ok)throw new Error(st.statusText);return it?new Uint8Array(await st.arrayBuffer()):(0,P.stringToBytes)(await st.text())}return new Promise((st,vt)=>{const Ft=new XMLHttpRequest;Ft.open("GET",St,!0),it&&(Ft.responseType="arraybuffer"),Ft.onreadystatechange=()=>{if(Ft.readyState===XMLHttpRequest.DONE){if(Ft.status===200||Ft.status===0){let Ot;if(it&&Ft.response?Ot=new Uint8Array(Ft.response):!it&&Ft.responseText&&(Ot=(0,P.stringToBytes)(Ft.responseText)),Ot){st(Ot);return}}vt(new Error(Ft.statusText))}},Ft.send(null)})}class g extends n.BaseCMapReaderFactory{_fetchData(it,st){return F(it,this.isCompressed).then(vt=>({cMapData:vt,compressionType:st}))}}o.DOMCMapReaderFactory=g;class H extends n.BaseStandardFontDataFactory{_fetchData(it){return F(it,!0)}}o.DOMStandardFontDataFactory=H;class W extends n.BaseSVGFactory{_createSVG(it){return document.createElementNS(V,it)}}o.DOMSVGFactory=W;class L{constructor({viewBox:it,scale:st,rotation:vt,offsetX:Ft=0,offsetY:Ot=0,dontFlip:te=!1}){this.viewBox=it,this.scale=st,this.rotation=vt,this.offsetX=Ft,this.offsetY=Ot;const Kt=(it[2]+it[0])/2,Jt=(it[3]+it[1])/2;let Zt,pt,O,X;switch(vt%=360,vt<0&&(vt+=360),vt){case 180:Zt=-1,pt=0,O=0,X=1;break;case 90:Zt=0,pt=1,O=1,X=0;break;case 270:Zt=0,pt=-1,O=-1,X=0;break;case 0:Zt=1,pt=0,O=0,X=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}te&&(O=-O,X=-X);let v,S,C,rt;Zt===0?(v=Math.abs(Jt-it[1])*st+Ft,S=Math.abs(Kt-it[0])*st+Ot,C=(it[3]-it[1])*st,rt=(it[2]-it[0])*st):(v=Math.abs(Kt-it[0])*st+Ft,S=Math.abs(Jt-it[1])*st+Ot,C=(it[2]-it[0])*st,rt=(it[3]-it[1])*st),this.transform=[Zt*st,pt*st,O*st,X*st,v-Zt*st*Kt-O*st*Jt,S-pt*st*Kt-X*st*Jt],this.width=C,this.height=rt}get rawDims(){const{viewBox:it}=this;return(0,P.shadow)(this,"rawDims",{pageWidth:it[2]-it[0],pageHeight:it[3]-it[1],pageX:it[0],pageY:it[1]})}clone({scale:it=this.scale,rotation:st=this.rotation,offsetX:vt=this.offsetX,offsetY:Ft=this.offsetY,dontFlip:Ot=!1}={}){return new L({viewBox:this.viewBox.slice(),scale:it,rotation:st,offsetX:vt,offsetY:Ft,dontFlip:Ot})}convertToViewportPoint(it,st){return P.Util.applyTransform([it,st],this.transform)}convertToViewportRectangle(it){const st=P.Util.applyTransform([it[0],it[1]],this.transform),vt=P.Util.applyTransform([it[2],it[3]],this.transform);return[st[0],st[1],vt[0],vt[1]]}convertToPdfPoint(it,st){return P.Util.applyInverseTransform([it,st],this.transform)}}o.PageViewport=L;class E extends P.BaseException{constructor(it,st=0){super(it,"RenderingCancelledException"),this.extraDelay=st}}o.RenderingCancelledException=E;function w(St){const it=St.length;let st=0;for(;st<it&&St[st].trim()==="";)st++;return St.substring(st,st+5).toLowerCase()==="data:"}function f(St){return typeof St=="string"&&/\.pdf$/i.test(St)}function b(St,it=!1){return it||([St]=St.split(/[#?]/,1)),St.substring(St.lastIndexOf("/")+1)}function k(St,it="document.pdf"){if(typeof St!="string")return it;if(w(St))return(0,P.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),it;const st=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,vt=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,Ft=st.exec(St);let Ot=vt.exec(Ft[1])||vt.exec(Ft[2])||vt.exec(Ft[3]);if(Ot&&(Ot=Ot[0],Ot.includes("%")))try{Ot=vt.exec(decodeURIComponent(Ot))[0]}catch{}return Ot||it}class x{constructor(){oe(this,"started",Object.create(null));oe(this,"times",[])}time(it){it in this.started&&(0,P.warn)(`Timer is already running for ${it}`),this.started[it]=Date.now()}timeEnd(it){it in this.started||(0,P.warn)(`Timer has not been started for ${it}`),this.times.push({name:it,start:this.started[it],end:Date.now()}),delete this.started[it]}toString(){const it=[];let st=0;for(const{name:vt}of this.times)st=Math.max(vt.length,st);for(const{name:vt,start:Ft,end:Ot}of this.times)it.push(`${vt.padEnd(st)} ${Ot-Ft}ms
`);return it.join("")}}o.StatTimer=x;function y(St,it){try{const{protocol:st}=it?new URL(St,it):new URL(St);return st==="http:"||st==="https:"}catch{return!1}}function l(St){St.preventDefault()}function h(St,it=!1){return new Promise((st,vt)=>{const Ft=document.createElement("script");Ft.src=St,Ft.onload=function(Ot){it&&Ft.remove(),st(Ot)},Ft.onerror=function(){vt(new Error(`Cannot load script at: ${Ft.src}`))},(document.head||document.documentElement).append(Ft)})}function I(St){console.log("Deprecated API usage: "+St)}let Q;class J{static toDateObject(it){if(!it||typeof it!="string")return null;Q||(Q=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const st=Q.exec(it);if(!st)return null;const vt=parseInt(st[1],10);let Ft=parseInt(st[2],10);Ft=Ft>=1&&Ft<=12?Ft-1:0;let Ot=parseInt(st[3],10);Ot=Ot>=1&&Ot<=31?Ot:1;let te=parseInt(st[4],10);te=te>=0&&te<=23?te:0;let Kt=parseInt(st[5],10);Kt=Kt>=0&&Kt<=59?Kt:0;let Jt=parseInt(st[6],10);Jt=Jt>=0&&Jt<=59?Jt:0;const Zt=st[7]||"Z";let pt=parseInt(st[8],10);pt=pt>=0&&pt<=23?pt:0;let O=parseInt(st[9],10)||0;return O=O>=0&&O<=59?O:0,Zt==="-"?(te+=pt,Kt+=O):Zt==="+"&&(te-=pt,Kt-=O),new Date(Date.UTC(vt,Ft,Ot,te,Kt,Jt))}}o.PDFDateString=J;function _t(St,{scale:it=1,rotation:st=0}){const{width:vt,height:Ft}=St.attributes.style,Ot=[0,0,parseInt(vt),parseInt(Ft)];return new L({viewBox:Ot,scale:it,rotation:st})}function at(St){if(St.startsWith("#")){const it=parseInt(St.slice(1),16);return[(it&16711680)>>16,(it&65280)>>8,it&255]}return St.startsWith("rgb(")?St.slice(4,-1).split(",").map(it=>parseInt(it)):St.startsWith("rgba(")?St.slice(5,-1).split(",").map(it=>parseInt(it)).slice(0,3):((0,P.warn)(`Not a valid color format: "${St}"`),[0,0,0])}function xt(St){const it=document.createElement("span");it.style.visibility="hidden",document.body.append(it);for(const st of St.keys()){it.style.color=st;const vt=window.getComputedStyle(it).color;St.set(st,at(vt))}it.remove()}function Ct(St){const{a:it,b:st,c:vt,d:Ft,e:Ot,f:te}=St.getTransform();return[it,st,vt,Ft,Ot,te]}function j(St){const{a:it,b:st,c:vt,d:Ft,e:Ot,f:te}=St.getTransform().invertSelf();return[it,st,vt,Ft,Ot,te]}function ut(St,it,st=!1,vt=!0){if(it instanceof L){const{pageWidth:Ft,pageHeight:Ot}=it.rawDims,{style:te}=St,Kt=P.FeatureTest.isCSSRoundSupported,Jt=`var(--scale-factor) * ${Ft}px`,Zt=`var(--scale-factor) * ${Ot}px`,pt=Kt?`round(${Jt}, 1px)`:`calc(${Jt})`,O=Kt?`round(${Zt}, 1px)`:`calc(${Zt})`;!st||it.rotation%180===0?(te.width=pt,te.height=O):(te.width=O,te.height=pt)}vt&&St.setAttribute("data-main-rotation",it.rotation)}},(U,o,K)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.BaseStandardFontDataFactory=o.BaseSVGFactory=o.BaseFilterFactory=o.BaseCanvasFactory=o.BaseCMapReaderFactory=void 0;var n=K(1);class P{constructor(){this.constructor===P&&(0,n.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(g){return"none"}addHCMFilter(g,H){return"none"}addHighlightHCMFilter(g,H,W,L){return"none"}destroy(g=!1){}}o.BaseFilterFactory=P;class V{constructor(){this.constructor===V&&(0,n.unreachable)("Cannot initialize BaseCanvasFactory.")}create(g,H){if(g<=0||H<=0)throw new Error("Invalid canvas size");const W=this._createCanvas(g,H);return{canvas:W,context:W.getContext("2d")}}reset(g,H,W){if(!g.canvas)throw new Error("Canvas is not specified");if(H<=0||W<=0)throw new Error("Invalid canvas size");g.canvas.width=H,g.canvas.height=W}destroy(g){if(!g.canvas)throw new Error("Canvas is not specified");g.canvas.width=0,g.canvas.height=0,g.canvas=null,g.context=null}_createCanvas(g,H){(0,n.unreachable)("Abstract method `_createCanvas` called.")}}o.BaseCanvasFactory=V;class q{constructor({baseUrl:g=null,isCompressed:H=!0}){this.constructor===q&&(0,n.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=g,this.isCompressed=H}async fetch({name:g}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!g)throw new Error("CMap name must be specified.");const H=this.baseUrl+g+(this.isCompressed?".bcmap":""),W=this.isCompressed?n.CMapCompressionType.BINARY:n.CMapCompressionType.NONE;return this._fetchData(H,W).catch(L=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${H}`)})}_fetchData(g,H){(0,n.unreachable)("Abstract method `_fetchData` called.")}}o.BaseCMapReaderFactory=q;class gt{constructor({baseUrl:g=null}){this.constructor===gt&&(0,n.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=g}async fetch({filename:g}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!g)throw new Error("Font filename must be specified.");const H=`${this.baseUrl}${g}`;return this._fetchData(H).catch(W=>{throw new Error(`Unable to load font data at: ${H}`)})}_fetchData(g){(0,n.unreachable)("Abstract method `_fetchData` called.")}}o.BaseStandardFontDataFactory=gt;class z{constructor(){this.constructor===z&&(0,n.unreachable)("Cannot initialize BaseSVGFactory.")}create(g,H,W=!1){if(g<=0||H<=0)throw new Error("Invalid SVG dimensions");const L=this._createSVG("svg:svg");return L.setAttribute("version","1.1"),W||(L.setAttribute("width",`${g}px`),L.setAttribute("height",`${H}px`)),L.setAttribute("preserveAspectRatio","none"),L.setAttribute("viewBox",`0 0 ${g} ${H}`),L}createElement(g){if(typeof g!="string")throw new Error("Invalid SVG element type");return this._createSVG(g)}_createSVG(g){(0,n.unreachable)("Abstract method `_createSVG` called.")}}o.BaseSVGFactory=z},(U,o,K)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.MurmurHash3_64=void 0;var n=K(1);const P=3285377520,V=4294901760,q=65535;class gt{constructor(F){this.h1=F?F&4294967295:P,this.h2=F?F&4294967295:P}update(F){let g,H;if(typeof F=="string"){g=new Uint8Array(F.length*2),H=0;for(let I=0,Q=F.length;I<Q;I++){const J=F.charCodeAt(I);J<=255?g[H++]=J:(g[H++]=J>>>8,g[H++]=J&255)}}else if((0,n.isArrayBuffer)(F))g=F.slice(),H=g.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const W=H>>2,L=H-W*4,E=new Uint32Array(g.buffer,0,W);let w=0,f=0,b=this.h1,k=this.h2;const x=3432918353,y=461845907,l=x&q,h=y&q;for(let I=0;I<W;I++)I&1?(w=E[I],w=w*x&V|w*l&q,w=w<<15|w>>>17,w=w*y&V|w*h&q,b^=w,b=b<<13|b>>>19,b=b*5+3864292196):(f=E[I],f=f*x&V|f*l&q,f=f<<15|f>>>17,f=f*y&V|f*h&q,k^=f,k=k<<13|k>>>19,k=k*5+3864292196);switch(w=0,L){case 3:w^=g[W*4+2]<<16;case 2:w^=g[W*4+1]<<8;case 1:w^=g[W*4],w=w*x&V|w*l&q,w=w<<15|w>>>17,w=w*y&V|w*h&q,W&1?b^=w:k^=w}this.h1=b,this.h2=k}hexdigest(){let F=this.h1,g=this.h2;return F^=g>>>1,F=F*3981806797&V|F*36045&q,g=g*4283543511&V|((g<<16|F>>>16)*2950163797&V)>>>16,F^=g>>>1,F=F*444984403&V|F*60499&q,g=g*3301882366&V|((g<<16|F>>>16)*3120437893&V)>>>16,F^=g>>>1,(F>>>0).toString(16).padStart(8,"0")+(g>>>0).toString(16).padStart(8,"0")}}o.MurmurHash3_64=gt},(U,o,K)=>{var q;Object.defineProperty(o,"__esModule",{value:!0}),o.FontLoader=o.FontFaceObject=void 0;var n=K(1);class P{constructor({ownerDocument:z=globalThis.document,styleElement:F=null}){$(this,q,new Set);this._document=z,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(z){this.nativeFontFaces.add(z),this._document.fonts.add(z)}removeNativeFontFace(z){this.nativeFontFaces.delete(z),this._document.fonts.delete(z)}insertRule(z){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const F=this.styleElement.sheet;F.insertRule(z,F.cssRules.length)}clear(){for(const z of this.nativeFontFaces)this._document.fonts.delete(z);this.nativeFontFaces.clear(),t(this,q).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(z){if(!(!z||t(this,q).has(z.loadedName))){if((0,n.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:F,src:g,style:H}=z,W=new FontFace(F,g,H);this.addNativeFontFace(W);try{await W.load(),t(this,q).add(F)}catch{(0,n.warn)(`Cannot load system font: ${z.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(W)}return}(0,n.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(z){if(z.attached||z.missingFile&&!z.systemFontInfo)return;if(z.attached=!0,z.systemFontInfo){await this.loadSystemFont(z.systemFontInfo);return}if(this.isFontLoadingAPISupported){const g=z.createNativeFontFace();if(g){this.addNativeFontFace(g);try{await g.loaded}catch(H){throw(0,n.warn)(`Failed to load font '${g.family}': '${H}'.`),z.disableFontFace=!0,H}}return}const F=z.createFontFaceRule();if(F){if(this.insertRule(F),this.isSyncFontLoadingSupported)return;await new Promise(g=>{const H=this._queueLoadingCallback(g);this._prepareFontLoadEvent(z,H)})}}get isFontLoadingAPISupported(){var F;const z=!!((F=this._document)!=null&&F.fonts);return(0,n.shadow)(this,"isFontLoadingAPISupported",z)}get isSyncFontLoadingSupported(){let z=!1;return(n.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(z=!0),(0,n.shadow)(this,"isSyncFontLoadingSupported",z)}_queueLoadingCallback(z){function F(){for((0,n.assert)(!H.done,"completeRequest() cannot be called twice."),H.done=!0;g.length>0&&g[0].done;){const W=g.shift();setTimeout(W.callback,0)}}const{loadingRequests:g}=this,H={done:!1,complete:F,callback:z};return g.push(H),H}get _loadTestFont(){const z=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,n.shadow)(this,"_loadTestFont",z)}_prepareFontLoadEvent(z,F){function g(at,xt){return at.charCodeAt(xt)<<24|at.charCodeAt(xt+1)<<16|at.charCodeAt(xt+2)<<8|at.charCodeAt(xt+3)&255}function H(at,xt,Ct,j){const ut=at.substring(0,xt),Et=at.substring(xt+Ct);return ut+j+Et}let W,L;const E=this._document.createElement("canvas");E.width=1,E.height=1;const w=E.getContext("2d");let f=0;function b(at,xt){if(++f>30){(0,n.warn)("Load test font never loaded."),xt();return}if(w.font="30px "+at,w.fillText(".",0,20),w.getImageData(0,0,1,1).data[3]>0){xt();return}setTimeout(b.bind(null,at,xt))}const k=`lt${Date.now()}${this.loadTestFontId++}`;let x=this._loadTestFont;x=H(x,976,k.length,k);const l=16,h=1482184792;let I=g(x,l);for(W=0,L=k.length-3;W<L;W+=4)I=I-h+g(k,W)|0;W<k.length&&(I=I-h+g(k+"XXX",W)|0),x=H(x,l,4,(0,n.string32)(I));const Q=`url(data:font/opentype;base64,${btoa(x)});`,J=`@font-face {font-family:"${k}";src:${Q}}`;this.insertRule(J);const _t=this._document.createElement("div");_t.style.visibility="hidden",_t.style.width=_t.style.height="10px",_t.style.position="absolute",_t.style.top=_t.style.left="0px";for(const at of[z.loadedName,k]){const xt=this._document.createElement("span");xt.textContent="Hi",xt.style.fontFamily=at,_t.append(xt)}this._document.body.append(_t),b(k,()=>{_t.remove(),F.complete()})}}q=new WeakMap,o.FontLoader=P;class V{constructor(z,{isEvalSupported:F=!0,disableFontFace:g=!1,ignoreErrors:H=!1,inspectFont:W=null}){this.compiledGlyphs=Object.create(null);for(const L in z)this[L]=z[L];this.isEvalSupported=F!==!1,this.disableFontFace=g===!0,this.ignoreErrors=H===!0,this._inspectFont=W}createNativeFontFace(){var F;if(!this.data||this.disableFontFace)return null;let z;if(!this.cssFontInfo)z=new FontFace(this.loadedName,this.data,{});else{const g={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(g.style=`oblique ${this.cssFontInfo.italicAngle}deg`),z=new FontFace(this.cssFontInfo.fontFamily,this.data,g)}return(F=this._inspectFont)==null||F.call(this,this),z}createFontFaceRule(){var H;if(!this.data||this.disableFontFace)return null;const z=(0,n.bytesToString)(this.data),F=`url(data:${this.mimetype};base64,${btoa(z)});`;let g;if(!this.cssFontInfo)g=`@font-face {font-family:"${this.loadedName}";src:${F}}`;else{let W=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(W+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),g=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${W}src:${F}}`}return(H=this._inspectFont)==null||H.call(this,this,F),g}getPathGenerator(z,F){if(this.compiledGlyphs[F]!==void 0)return this.compiledGlyphs[F];let g;try{g=z.get(this.loadedName+"_path_"+F)}catch(H){if(!this.ignoreErrors)throw H;return(0,n.warn)(`getPathGenerator - ignoring character: "${H}".`),this.compiledGlyphs[F]=function(W,L){}}if(this.isEvalSupported&&n.FeatureTest.isEvalSupported){const H=[];for(const W of g){const L=W.args!==void 0?W.args.join(","):"";H.push("c.",W.cmd,"(",L,`);
`)}return this.compiledGlyphs[F]=new Function("c","size",H.join(""))}return this.compiledGlyphs[F]=function(H,W){for(const L of g)L.cmd==="scale"&&(L.args=[W,-W]),H[L.cmd].apply(H,L.args)}}}o.FontFaceObject=V},(U,o,K)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.NodeStandardFontDataFactory=o.NodeFilterFactory=o.NodeCanvasFactory=o.NodeCMapReaderFactory=void 0;var n=K(7);K(1);const P=function(F){return new Promise((g,H)=>{_e.readFile(F,(L,E)=>{if(L||!E){H(new Error(L));return}g(new Uint8Array(E))})})};class V extends n.BaseFilterFactory{}o.NodeFilterFactory=V;class q extends n.BaseCanvasFactory{_createCanvas(g,H){return _e.createCanvas(g,H)}}o.NodeCanvasFactory=q;class gt extends n.BaseCMapReaderFactory{_fetchData(g,H){return P(g).then(W=>({cMapData:W,compressionType:H}))}}o.NodeCMapReaderFactory=gt;class z extends n.BaseStandardFontDataFactory{_fetchData(g){return P(g)}}o.NodeStandardFontDataFactory=z},(U,o,K)=>{var et,es,Rt,is;Object.defineProperty(o,"__esModule",{value:!0}),o.CanvasGraphics=void 0;var n=K(1),P=K(6),V=K(12),q=K(13);const gt=16,z=100,F=4096,g=15,H=10,W=1e3,L=16;function E(T,i){if(T._removeMirroring)throw new Error("Context is already forwarding operations.");T.__originalSave=T.save,T.__originalRestore=T.restore,T.__originalRotate=T.rotate,T.__originalScale=T.scale,T.__originalTranslate=T.translate,T.__originalTransform=T.transform,T.__originalSetTransform=T.setTransform,T.__originalResetTransform=T.resetTransform,T.__originalClip=T.clip,T.__originalMoveTo=T.moveTo,T.__originalLineTo=T.lineTo,T.__originalBezierCurveTo=T.bezierCurveTo,T.__originalRect=T.rect,T.__originalClosePath=T.closePath,T.__originalBeginPath=T.beginPath,T._removeMirroring=()=>{T.save=T.__originalSave,T.restore=T.__originalRestore,T.rotate=T.__originalRotate,T.scale=T.__originalScale,T.translate=T.__originalTranslate,T.transform=T.__originalTransform,T.setTransform=T.__originalSetTransform,T.resetTransform=T.__originalResetTransform,T.clip=T.__originalClip,T.moveTo=T.__originalMoveTo,T.lineTo=T.__originalLineTo,T.bezierCurveTo=T.__originalBezierCurveTo,T.rect=T.__originalRect,T.closePath=T.__originalClosePath,T.beginPath=T.__originalBeginPath,delete T._removeMirroring},T.save=function(){i.save(),this.__originalSave()},T.restore=function(){i.restore(),this.__originalRestore()},T.translate=function(s,c){i.translate(s,c),this.__originalTranslate(s,c)},T.scale=function(s,c){i.scale(s,c),this.__originalScale(s,c)},T.transform=function(s,c,d,m,M,B){i.transform(s,c,d,m,M,B),this.__originalTransform(s,c,d,m,M,B)},T.setTransform=function(s,c,d,m,M,B){i.setTransform(s,c,d,m,M,B),this.__originalSetTransform(s,c,d,m,M,B)},T.resetTransform=function(){i.resetTransform(),this.__originalResetTransform()},T.rotate=function(s){i.rotate(s),this.__originalRotate(s)},T.clip=function(s){i.clip(s),this.__originalClip(s)},T.moveTo=function(r,s){i.moveTo(r,s),this.__originalMoveTo(r,s)},T.lineTo=function(r,s){i.lineTo(r,s),this.__originalLineTo(r,s)},T.bezierCurveTo=function(r,s,c,d,m,M){i.bezierCurveTo(r,s,c,d,m,M),this.__originalBezierCurveTo(r,s,c,d,m,M)},T.rect=function(r,s,c,d){i.rect(r,s,c,d),this.__originalRect(r,s,c,d)},T.closePath=function(){i.closePath(),this.__originalClosePath()},T.beginPath=function(){i.beginPath(),this.__originalBeginPath()}}class w{constructor(i){this.canvasFactory=i,this.cache=Object.create(null)}getCanvas(i,r,s){let c;return this.cache[i]!==void 0?(c=this.cache[i],this.canvasFactory.reset(c,r,s)):(c=this.canvasFactory.create(r,s),this.cache[i]=c),c}delete(i){delete this.cache[i]}clear(){for(const i in this.cache){const r=this.cache[i];this.canvasFactory.destroy(r),delete this.cache[i]}}}function f(T,i,r,s,c,d,m,M,B,lt){const[nt,ft,mt,Mt,At,Bt]=(0,P.getCurrentTransform)(T);if(ft===0&&mt===0){const jt=m*nt+At,St=Math.round(jt),it=M*Mt+Bt,st=Math.round(it),vt=(m+B)*nt+At,Ft=Math.abs(Math.round(vt)-St)||1,Ot=(M+lt)*Mt+Bt,te=Math.abs(Math.round(Ot)-st)||1;return T.setTransform(Math.sign(nt),0,0,Math.sign(Mt),St,st),T.drawImage(i,r,s,c,d,0,0,Ft,te),T.setTransform(nt,ft,mt,Mt,At,Bt),[Ft,te]}if(nt===0&&Mt===0){const jt=M*mt+At,St=Math.round(jt),it=m*ft+Bt,st=Math.round(it),vt=(M+lt)*mt+At,Ft=Math.abs(Math.round(vt)-St)||1,Ot=(m+B)*ft+Bt,te=Math.abs(Math.round(Ot)-st)||1;return T.setTransform(0,Math.sign(ft),Math.sign(mt),0,St,st),T.drawImage(i,r,s,c,d,0,0,te,Ft),T.setTransform(nt,ft,mt,Mt,At,Bt),[te,Ft]}T.drawImage(i,r,s,c,d,m,M,B,lt);const Vt=Math.hypot(nt,ft),kt=Math.hypot(mt,Mt);return[Vt*B,kt*lt]}function b(T){const{width:i,height:r}=T;if(i>W||r>W)return null;const s=1e3,c=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),d=i+1;let m=new Uint8Array(d*(r+1)),M,B,lt;const nt=i+7&-8;let ft=new Uint8Array(nt*r),mt=0;for(const kt of T.data){let jt=128;for(;jt>0;)ft[mt++]=kt&jt?0:255,jt>>=1}let Mt=0;for(mt=0,ft[mt]!==0&&(m[0]=1,++Mt),B=1;B<i;B++)ft[mt]!==ft[mt+1]&&(m[B]=ft[mt]?2:1,++Mt),mt++;for(ft[mt]!==0&&(m[B]=2,++Mt),M=1;M<r;M++){mt=M*nt,lt=M*d,ft[mt-nt]!==ft[mt]&&(m[lt]=ft[mt]?1:8,++Mt);let kt=(ft[mt]?4:0)+(ft[mt-nt]?8:0);for(B=1;B<i;B++)kt=(kt>>2)+(ft[mt+1]?4:0)+(ft[mt-nt+1]?8:0),c[kt]&&(m[lt+B]=c[kt],++Mt),mt++;if(ft[mt-nt]!==ft[mt]&&(m[lt+B]=ft[mt]?2:4,++Mt),Mt>s)return null}for(mt=nt*(r-1),lt=M*d,ft[mt]!==0&&(m[lt]=8,++Mt),B=1;B<i;B++)ft[mt]!==ft[mt+1]&&(m[lt+B]=ft[mt]?4:8,++Mt),mt++;if(ft[mt]!==0&&(m[lt+B]=4,++Mt),Mt>s)return null;const At=new Int32Array([0,d,-1,0,-d,0,0,0,1]),Bt=new Path2D;for(M=0;Mt&&M<=r;M++){let kt=M*d;const jt=kt+i;for(;kt<jt&&!m[kt];)kt++;if(kt===jt)continue;Bt.moveTo(kt%d,M);const St=kt;let it=m[kt];do{const st=At[it];do kt+=st;while(!m[kt]);const vt=m[kt];vt!==5&&vt!==10?(it=vt,m[kt]=0):(it=vt&51*it>>4,m[kt]&=it>>2|it<<2),Bt.lineTo(kt%d,kt/d|0),m[kt]||--Mt}while(St!==kt);--M}return ft=null,m=null,function(kt){kt.save(),kt.scale(1/i,-1/r),kt.translate(0,-r),kt.fill(Bt),kt.beginPath(),kt.restore()}}class k{constructor(i,r){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=n.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=n.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=n.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,i,r])}clone(){const i=Object.create(this);return i.clipBox=this.clipBox.slice(),i}setCurrentPoint(i,r){this.x=i,this.y=r}updatePathMinMax(i,r,s){[r,s]=n.Util.applyTransform([r,s],i),this.minX=Math.min(this.minX,r),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,r),this.maxY=Math.max(this.maxY,s)}updateRectMinMax(i,r){const s=n.Util.applyTransform(r,i),c=n.Util.applyTransform(r.slice(2),i);this.minX=Math.min(this.minX,s[0],c[0]),this.minY=Math.min(this.minY,s[1],c[1]),this.maxX=Math.max(this.maxX,s[0],c[0]),this.maxY=Math.max(this.maxY,s[1],c[1])}updateScalingPathMinMax(i,r){n.Util.scaleMinMax(i,r),this.minX=Math.min(this.minX,r[0]),this.maxX=Math.max(this.maxX,r[1]),this.minY=Math.min(this.minY,r[2]),this.maxY=Math.max(this.maxY,r[3])}updateCurvePathMinMax(i,r,s,c,d,m,M,B,lt,nt){const ft=n.Util.bezierBoundingBox(r,s,c,d,m,M,B,lt);if(nt){nt[0]=Math.min(nt[0],ft[0],ft[2]),nt[1]=Math.max(nt[1],ft[0],ft[2]),nt[2]=Math.min(nt[2],ft[1],ft[3]),nt[3]=Math.max(nt[3],ft[1],ft[3]);return}this.updateRectMinMax(i,ft)}getPathBoundingBox(i=V.PathType.FILL,r=null){const s=[this.minX,this.minY,this.maxX,this.maxY];if(i===V.PathType.STROKE){r||(0,n.unreachable)("Stroke bounding box must include transform.");const c=n.Util.singularValueDecompose2dScale(r),d=c[0]*this.lineWidth/2,m=c[1]*this.lineWidth/2;s[0]-=d,s[1]-=m,s[2]+=d,s[3]+=m}return s}updateClipFromPath(){const i=n.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(i||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(i){this.clipBox=i,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(i=V.PathType.FILL,r=null){return n.Util.intersect(this.clipBox,this.getPathBoundingBox(i,r))}}function x(T,i){if(typeof ImageData<"u"&&i instanceof ImageData){T.putImageData(i,0,0);return}const r=i.height,s=i.width,c=r%L,d=(r-c)/L,m=c===0?d:d+1,M=T.createImageData(s,L);let B=0,lt;const nt=i.data,ft=M.data;let mt,Mt,At,Bt;if(i.kind===n.ImageKind.GRAYSCALE_1BPP){const Vt=nt.byteLength,kt=new Uint32Array(ft.buffer,0,ft.byteLength>>2),jt=kt.length,St=s+7>>3,it=4294967295,st=n.FeatureTest.isLittleEndian?4278190080:255;for(mt=0;mt<m;mt++){for(At=mt<d?L:c,lt=0,Mt=0;Mt<At;Mt++){const vt=Vt-B;let Ft=0;const Ot=vt>St?s:vt*8-7,te=Ot&-8;let Kt=0,Jt=0;for(;Ft<te;Ft+=8)Jt=nt[B++],kt[lt++]=Jt&128?it:st,kt[lt++]=Jt&64?it:st,kt[lt++]=Jt&32?it:st,kt[lt++]=Jt&16?it:st,kt[lt++]=Jt&8?it:st,kt[lt++]=Jt&4?it:st,kt[lt++]=Jt&2?it:st,kt[lt++]=Jt&1?it:st;for(;Ft<Ot;Ft++)Kt===0&&(Jt=nt[B++],Kt=128),kt[lt++]=Jt&Kt?it:st,Kt>>=1}for(;lt<jt;)kt[lt++]=0;T.putImageData(M,0,mt*L)}}else if(i.kind===n.ImageKind.RGBA_32BPP){for(Mt=0,Bt=s*L*4,mt=0;mt<d;mt++)ft.set(nt.subarray(B,B+Bt)),B+=Bt,T.putImageData(M,0,Mt),Mt+=L;mt<m&&(Bt=s*c*4,ft.set(nt.subarray(B,B+Bt)),T.putImageData(M,0,Mt))}else if(i.kind===n.ImageKind.RGB_24BPP)for(At=L,Bt=s*At,mt=0;mt<m;mt++){for(mt>=d&&(At=c,Bt=s*At),lt=0,Mt=Bt;Mt--;)ft[lt++]=nt[B++],ft[lt++]=nt[B++],ft[lt++]=nt[B++],ft[lt++]=255;T.putImageData(M,0,mt*L)}else throw new Error(`bad image kind: ${i.kind}`)}function y(T,i){if(i.bitmap){T.drawImage(i.bitmap,0,0);return}const r=i.height,s=i.width,c=r%L,d=(r-c)/L,m=c===0?d:d+1,M=T.createImageData(s,L);let B=0;const lt=i.data,nt=M.data;for(let ft=0;ft<m;ft++){const mt=ft<d?L:c;({srcPos:B}=(0,q.convertBlackAndWhiteToRGBA)({src:lt,srcPos:B,dest:nt,width:s,height:mt,nonBlackColor:0})),T.putImageData(M,0,ft*L)}}function l(T,i){const r=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of r)T[s]!==void 0&&(i[s]=T[s]);T.setLineDash!==void 0&&(i.setLineDash(T.getLineDash()),i.lineDashOffset=T.lineDashOffset)}function h(T){if(T.strokeStyle=T.fillStyle="#000000",T.fillRule="nonzero",T.globalAlpha=1,T.lineWidth=1,T.lineCap="butt",T.lineJoin="miter",T.miterLimit=10,T.globalCompositeOperation="source-over",T.font="10px sans-serif",T.setLineDash!==void 0&&(T.setLineDash([]),T.lineDashOffset=0),!n.isNodeJS){const{filter:i}=T;i!=="none"&&i!==""&&(T.filter="none")}}function I(T,i,r,s){const c=T.length;for(let d=3;d<c;d+=4){const m=T[d];if(m===0)T[d-3]=i,T[d-2]=r,T[d-1]=s;else if(m<255){const M=255-m;T[d-3]=T[d-3]*m+i*M>>8,T[d-2]=T[d-2]*m+r*M>>8,T[d-1]=T[d-1]*m+s*M>>8}}}function Q(T,i,r){const s=T.length,c=1/255;for(let d=3;d<s;d+=4){const m=r?r[T[d]]:T[d];i[d]=i[d]*m*c|0}}function J(T,i,r){const s=T.length;for(let c=3;c<s;c+=4){const d=T[c-3]*77+T[c-2]*152+T[c-1]*28;i[c]=r?i[c]*r[d>>8]>>8:i[c]*d>>16}}function _t(T,i,r,s,c,d,m,M,B,lt,nt){const ft=!!d,mt=ft?d[0]:0,Mt=ft?d[1]:0,At=ft?d[2]:0,Bt=c==="Luminosity"?J:Q,kt=Math.min(s,Math.ceil(1048576/r));for(let jt=0;jt<s;jt+=kt){const St=Math.min(kt,s-jt),it=T.getImageData(M-lt,jt+(B-nt),r,St),st=i.getImageData(M,jt+B,r,St);ft&&I(it.data,mt,Mt,At),Bt(it.data,st.data,m),i.putImageData(st,M,jt+B)}}function at(T,i,r,s){const c=s[0],d=s[1],m=s[2]-c,M=s[3]-d;m===0||M===0||(_t(i.context,r,m,M,i.subtype,i.backdrop,i.transferMap,c,d,i.offsetX,i.offsetY),T.save(),T.globalAlpha=1,T.globalCompositeOperation="source-over",T.setTransform(1,0,0,1,0,0),T.drawImage(r.canvas,0,0),T.restore())}function xt(T,i){const r=n.Util.singularValueDecompose2dScale(T);r[0]=Math.fround(r[0]),r[1]=Math.fround(r[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*P.PixelsPerInch.PDF_TO_CSS_UNITS);return i!==void 0?i:r[0]<=s||r[1]<=s}const Ct=["butt","round","square"],j=["miter","round","bevel"],ut={},Et={},$t=class $t{constructor(i,r,s,c,d,{optionalContentConfig:m,markedContentStack:M=null},B,lt){$(this,et);$(this,Rt);this.ctx=i,this.current=new k(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=r,this.objs=s,this.canvasFactory=c,this.filterFactory=d,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=M||[],this.optionalContentConfig=m,this.cachedCanvases=new w(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=B,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=lt,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(i,r=null){return typeof i=="string"?i.startsWith("g_")?this.commonObjs.get(i):this.objs.get(i):r}beginDrawing({transform:i,viewport:r,transparency:s=!1,background:c=null}){const d=this.ctx.canvas.width,m=this.ctx.canvas.height,M=this.ctx.fillStyle;if(this.ctx.fillStyle=c||"#ffffff",this.ctx.fillRect(0,0,d,m),this.ctx.fillStyle=M,s){const B=this.cachedCanvases.getCanvas("transparent",d,m);this.compositeCtx=this.ctx,this.transparentCanvas=B.canvas,this.ctx=B.context,this.ctx.save(),this.ctx.transform(...(0,P.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),h(this.ctx),i&&(this.ctx.transform(...i),this.outputScaleX=i[0],this.outputScaleY=i[0]),this.ctx.transform(...r.transform),this.viewportScale=r.scale,this.baseTransform=(0,P.getCurrentTransform)(this.ctx)}executeOperatorList(i,r,s,c){const d=i.argsArray,m=i.fnArray;let M=r||0;const B=d.length;if(B===M)return M;const lt=B-M>H&&typeof s=="function",nt=lt?Date.now()+g:0;let ft=0;const mt=this.commonObjs,Mt=this.objs;let At;for(;;){if(c!==void 0&&M===c.nextBreakPoint)return c.breakIt(M,s),M;if(At=m[M],At!==n.OPS.dependency)this[At].apply(this,d[M]);else for(const Bt of d[M]){const Vt=Bt.startsWith("g_")?mt:Mt;if(!Vt.has(Bt))return Vt.get(Bt,s),M}if(M++,M===B)return M;if(lt&&++ft>H){if(Date.now()>nt)return s(),M;ft=0}}}endDrawing(){Z(this,et,es).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const i of this._cachedBitmapsMap.values()){for(const r of i.values())typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement&&(r.width=r.height=0);i.clear()}this._cachedBitmapsMap.clear(),Z(this,Rt,is).call(this)}_scaleImage(i,r){const s=i.width,c=i.height;let d=Math.max(Math.hypot(r[0],r[1]),1),m=Math.max(Math.hypot(r[2],r[3]),1),M=s,B=c,lt="prescale1",nt,ft;for(;d>2&&M>1||m>2&&B>1;){let mt=M,Mt=B;d>2&&M>1&&(mt=M>=16384?Math.floor(M/2)-1||1:Math.ceil(M/2),d/=M/mt),m>2&&B>1&&(Mt=B>=16384?Math.floor(B/2)-1||1:Math.ceil(B)/2,m/=B/Mt),nt=this.cachedCanvases.getCanvas(lt,mt,Mt),ft=nt.context,ft.clearRect(0,0,mt,Mt),ft.drawImage(i,0,0,M,B,0,0,mt,Mt),i=nt.canvas,M=mt,B=Mt,lt=lt==="prescale1"?"prescale2":"prescale1"}return{img:i,paintWidth:M,paintHeight:B}}_createMaskCanvas(i){const r=this.ctx,{width:s,height:c}=i,d=this.current.fillColor,m=this.current.patternFill,M=(0,P.getCurrentTransform)(r);let B,lt,nt,ft;if((i.bitmap||i.data)&&i.count>1){const Ft=i.bitmap||i.data.buffer;lt=JSON.stringify(m?M:[M.slice(0,4),d]),B=this._cachedBitmapsMap.get(Ft),B||(B=new Map,this._cachedBitmapsMap.set(Ft,B));const Ot=B.get(lt);if(Ot&&!m){const te=Math.round(Math.min(M[0],M[2])+M[4]),Kt=Math.round(Math.min(M[1],M[3])+M[5]);return{canvas:Ot,offsetX:te,offsetY:Kt}}nt=Ot}nt||(ft=this.cachedCanvases.getCanvas("maskCanvas",s,c),y(ft.context,i));let mt=n.Util.transform(M,[1/s,0,0,-1/c,0,0]);mt=n.Util.transform(mt,[1,0,0,1,0,-c]);const Mt=n.Util.applyTransform([0,0],mt),At=n.Util.applyTransform([s,c],mt),Bt=n.Util.normalizeRect([Mt[0],Mt[1],At[0],At[1]]),Vt=Math.round(Bt[2]-Bt[0])||1,kt=Math.round(Bt[3]-Bt[1])||1,jt=this.cachedCanvases.getCanvas("fillCanvas",Vt,kt),St=jt.context,it=Math.min(Mt[0],At[0]),st=Math.min(Mt[1],At[1]);St.translate(-it,-st),St.transform(...mt),nt||(nt=this._scaleImage(ft.canvas,(0,P.getCurrentTransformInverse)(St)),nt=nt.img,B&&m&&B.set(lt,nt)),St.imageSmoothingEnabled=xt((0,P.getCurrentTransform)(St),i.interpolate),f(St,nt,0,0,nt.width,nt.height,0,0,s,c),St.globalCompositeOperation="source-in";const vt=n.Util.transform((0,P.getCurrentTransformInverse)(St),[1,0,0,1,-it,-st]);return St.fillStyle=m?d.getPattern(r,this,vt,V.PathType.FILL):d,St.fillRect(0,0,s,c),B&&!m&&(this.cachedCanvases.delete("fillCanvas"),B.set(lt,jt.canvas)),{canvas:jt.canvas,offsetX:Math.round(it),offsetY:Math.round(st)}}setLineWidth(i){i!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=i,this.ctx.lineWidth=i}setLineCap(i){this.ctx.lineCap=Ct[i]}setLineJoin(i){this.ctx.lineJoin=j[i]}setMiterLimit(i){this.ctx.miterLimit=i}setDash(i,r){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(i),s.lineDashOffset=r)}setRenderingIntent(i){}setFlatness(i){}setGState(i){for(const[r,s]of i)switch(r){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.current.fillAlpha=s,this.ctx.globalAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const i=this.inSMaskMode;this.current.activeSMask&&!i?this.beginSMaskMode():!this.current.activeSMask&&i&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const i=this.ctx.canvas.width,r=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,c=this.cachedCanvases.getCanvas(s,i,r);this.suspendedCtx=this.ctx,this.ctx=c.context;const d=this.ctx;d.setTransform(...(0,P.getCurrentTransform)(this.suspendedCtx)),l(this.suspendedCtx,d),E(d,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),l(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(i){if(!this.current.activeSMask)return;i?(i[0]=Math.floor(i[0]),i[1]=Math.floor(i[1]),i[2]=Math.ceil(i[2]),i[3]=Math.ceil(i[3])):i=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const r=this.current.activeSMask,s=this.suspendedCtx;at(s,r,this.ctx,i),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(l(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const i=this.current;this.stateStack.push(i),this.current=i.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),l(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(i,r,s,c,d,m){this.ctx.transform(i,r,s,c,d,m),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(i,r,s){const c=this.ctx,d=this.current;let m=d.x,M=d.y,B,lt;const nt=(0,P.getCurrentTransform)(c),ft=nt[0]===0&&nt[3]===0||nt[1]===0&&nt[2]===0,mt=ft?s.slice(0):null;for(let Mt=0,At=0,Bt=i.length;Mt<Bt;Mt++)switch(i[Mt]|0){case n.OPS.rectangle:m=r[At++],M=r[At++];const Vt=r[At++],kt=r[At++],jt=m+Vt,St=M+kt;c.moveTo(m,M),Vt===0||kt===0?c.lineTo(jt,St):(c.lineTo(jt,M),c.lineTo(jt,St),c.lineTo(m,St)),ft||d.updateRectMinMax(nt,[m,M,jt,St]),c.closePath();break;case n.OPS.moveTo:m=r[At++],M=r[At++],c.moveTo(m,M),ft||d.updatePathMinMax(nt,m,M);break;case n.OPS.lineTo:m=r[At++],M=r[At++],c.lineTo(m,M),ft||d.updatePathMinMax(nt,m,M);break;case n.OPS.curveTo:B=m,lt=M,m=r[At+4],M=r[At+5],c.bezierCurveTo(r[At],r[At+1],r[At+2],r[At+3],m,M),d.updateCurvePathMinMax(nt,B,lt,r[At],r[At+1],r[At+2],r[At+3],m,M,mt),At+=6;break;case n.OPS.curveTo2:B=m,lt=M,c.bezierCurveTo(m,M,r[At],r[At+1],r[At+2],r[At+3]),d.updateCurvePathMinMax(nt,B,lt,m,M,r[At],r[At+1],r[At+2],r[At+3],mt),m=r[At+2],M=r[At+3],At+=4;break;case n.OPS.curveTo3:B=m,lt=M,m=r[At+2],M=r[At+3],c.bezierCurveTo(r[At],r[At+1],m,M,m,M),d.updateCurvePathMinMax(nt,B,lt,r[At],r[At+1],m,M,m,M,mt),At+=4;break;case n.OPS.closePath:c.closePath();break}ft&&d.updateScalingPathMinMax(nt,mt),d.setCurrentPoint(m,M)}closePath(){this.ctx.closePath()}stroke(i=!0){const r=this.ctx,s=this.current.strokeColor;r.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof s=="object"&&(s!=null&&s.getPattern)?(r.save(),r.strokeStyle=s.getPattern(r,this,(0,P.getCurrentTransformInverse)(r),V.PathType.STROKE),this.rescaleAndStroke(!1),r.restore()):this.rescaleAndStroke(!0)),i&&this.consumePath(this.current.getClippedPathBoundingBox()),r.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(i=!0){const r=this.ctx,s=this.current.fillColor,c=this.current.patternFill;let d=!1;c&&(r.save(),r.fillStyle=s.getPattern(r,this,(0,P.getCurrentTransformInverse)(r),V.PathType.FILL),d=!0);const m=this.current.getClippedPathBoundingBox();this.contentVisible&&m!==null&&(this.pendingEOFill?(r.fill("evenodd"),this.pendingEOFill=!1):r.fill()),d&&r.restore(),i&&this.consumePath(m)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=ut}eoClip(){this.pendingClip=Et}beginText(){this.current.textMatrix=n.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const i=this.pendingTextPaths,r=this.ctx;if(i===void 0){r.beginPath();return}r.save(),r.beginPath();for(const s of i)r.setTransform(...s.transform),r.translate(s.x,s.y),s.addToPath(r,s.fontSize);r.restore(),r.clip(),r.beginPath(),delete this.pendingTextPaths}setCharSpacing(i){this.current.charSpacing=i}setWordSpacing(i){this.current.wordSpacing=i}setHScale(i){this.current.textHScale=i/100}setLeading(i){this.current.leading=-i}setFont(i,r){var nt;const s=this.commonObjs.get(i),c=this.current;if(!s)throw new Error(`Can't find font for ${i}`);if(c.fontMatrix=s.fontMatrix||n.FONT_IDENTITY_MATRIX,(c.fontMatrix[0]===0||c.fontMatrix[3]===0)&&(0,n.warn)("Invalid font matrix for font "+i),r<0?(r=-r,c.fontDirection=-1):c.fontDirection=1,this.current.font=s,this.current.fontSize=r,s.isType3Font)return;const d=s.loadedName||"sans-serif",m=((nt=s.systemFontInfo)==null?void 0:nt.css)||`"${d}", ${s.fallbackName}`;let M="normal";s.black?M="900":s.bold&&(M="bold");const B=s.italic?"italic":"normal";let lt=r;r<gt?lt=gt:r>z&&(lt=z),this.current.fontSizeScale=r/lt,this.ctx.font=`${B} ${M} ${lt}px ${m}`}setTextRenderingMode(i){this.current.textRenderingMode=i}setTextRise(i){this.current.textRise=i}moveText(i,r){this.current.x=this.current.lineX+=i,this.current.y=this.current.lineY+=r}setLeadingMoveText(i,r){this.setLeading(-r),this.moveText(i,r)}setTextMatrix(i,r,s,c,d,m){this.current.textMatrix=[i,r,s,c,d,m],this.current.textMatrixScale=Math.hypot(i,r),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(i,r,s,c){const d=this.ctx,m=this.current,M=m.font,B=m.textRenderingMode,lt=m.fontSize/m.fontSizeScale,nt=B&n.TextRenderingMode.FILL_STROKE_MASK,ft=!!(B&n.TextRenderingMode.ADD_TO_PATH_FLAG),mt=m.patternFill&&!M.missingFile;let Mt;(M.disableFontFace||ft||mt)&&(Mt=M.getPathGenerator(this.commonObjs,i)),M.disableFontFace||mt?(d.save(),d.translate(r,s),d.beginPath(),Mt(d,lt),c&&d.setTransform(...c),(nt===n.TextRenderingMode.FILL||nt===n.TextRenderingMode.FILL_STROKE)&&d.fill(),(nt===n.TextRenderingMode.STROKE||nt===n.TextRenderingMode.FILL_STROKE)&&d.stroke(),d.restore()):((nt===n.TextRenderingMode.FILL||nt===n.TextRenderingMode.FILL_STROKE)&&d.fillText(i,r,s),(nt===n.TextRenderingMode.STROKE||nt===n.TextRenderingMode.FILL_STROKE)&&d.strokeText(i,r,s)),ft&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,P.getCurrentTransform)(d),x:r,y:s,fontSize:lt,addToPath:Mt})}get isFontSubpixelAAEnabled(){const{context:i}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);i.scale(1.5,1),i.fillText("I",0,10);const r=i.getImageData(0,0,10,10).data;let s=!1;for(let c=3;c<r.length;c+=4)if(r[c]>0&&r[c]<255){s=!0;break}return(0,n.shadow)(this,"isFontSubpixelAAEnabled",s)}showText(i){const r=this.current,s=r.font;if(s.isType3Font)return this.showType3Text(i);const c=r.fontSize;if(c===0)return;const d=this.ctx,m=r.fontSizeScale,M=r.charSpacing,B=r.wordSpacing,lt=r.fontDirection,nt=r.textHScale*lt,ft=i.length,mt=s.vertical,Mt=mt?1:-1,At=s.defaultVMetrics,Bt=c*r.fontMatrix[0],Vt=r.textRenderingMode===n.TextRenderingMode.FILL&&!s.disableFontFace&&!r.patternFill;d.save(),d.transform(...r.textMatrix),d.translate(r.x,r.y+r.textRise),lt>0?d.scale(nt,-1):d.scale(nt,1);let kt;if(r.patternFill){d.save();const vt=r.fillColor.getPattern(d,this,(0,P.getCurrentTransformInverse)(d),V.PathType.FILL);kt=(0,P.getCurrentTransform)(d),d.restore(),d.fillStyle=vt}let jt=r.lineWidth;const St=r.textMatrixScale;if(St===0||jt===0){const vt=r.textRenderingMode&n.TextRenderingMode.FILL_STROKE_MASK;(vt===n.TextRenderingMode.STROKE||vt===n.TextRenderingMode.FILL_STROKE)&&(jt=this.getSinglePixelWidth())}else jt/=St;if(m!==1&&(d.scale(m,m),jt/=m),d.lineWidth=jt,s.isInvalidPDFjsFont){const vt=[];let Ft=0;for(const Ot of i)vt.push(Ot.unicode),Ft+=Ot.width;d.fillText(vt.join(""),0,0),r.x+=Ft*Bt*nt,d.restore(),this.compose();return}let it=0,st;for(st=0;st<ft;++st){const vt=i[st];if(typeof vt=="number"){it+=Mt*vt*c/1e3;continue}let Ft=!1;const Ot=(vt.isSpace?B:0)+M,te=vt.fontChar,Kt=vt.accent;let Jt,Zt,pt=vt.width;if(mt){const X=vt.vmetric||At,v=-(vt.vmetric?X[1]:pt*.5)*Bt,S=X[2]*Bt;pt=X?-X[0]:pt,Jt=v/m,Zt=(it+S)/m}else Jt=it/m,Zt=0;if(s.remeasure&&pt>0){const X=d.measureText(te).width*1e3/c*m;if(pt<X&&this.isFontSubpixelAAEnabled){const v=pt/X;Ft=!0,d.save(),d.scale(v,1),Jt/=v}else pt!==X&&(Jt+=(pt-X)/2e3*c/m)}if(this.contentVisible&&(vt.isInFont||s.missingFile)){if(Vt&&!Kt)d.fillText(te,Jt,Zt);else if(this.paintChar(te,Jt,Zt,kt),Kt){const X=Jt+c*Kt.offset.x/m,v=Zt-c*Kt.offset.y/m;this.paintChar(Kt.fontChar,X,v,kt)}}const O=mt?pt*Bt-Ot*lt:pt*Bt+Ot*lt;it+=O,Ft&&d.restore()}mt?r.y-=it:r.x+=it*nt,d.restore(),this.compose()}showType3Text(i){const r=this.ctx,s=this.current,c=s.font,d=s.fontSize,m=s.fontDirection,M=c.vertical?1:-1,B=s.charSpacing,lt=s.wordSpacing,nt=s.textHScale*m,ft=s.fontMatrix||n.FONT_IDENTITY_MATRIX,mt=i.length,Mt=s.textRenderingMode===n.TextRenderingMode.INVISIBLE;let At,Bt,Vt,kt;if(!(Mt||d===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,r.save(),r.transform(...s.textMatrix),r.translate(s.x,s.y),r.scale(nt,m),At=0;At<mt;++At){if(Bt=i[At],typeof Bt=="number"){kt=M*Bt*d/1e3,this.ctx.translate(kt,0),s.x+=kt*nt;continue}const jt=(Bt.isSpace?lt:0)+B,St=c.charProcOperatorList[Bt.operatorListId];if(!St){(0,n.warn)(`Type3 character "${Bt.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=Bt,this.save(),r.scale(d,d),r.transform(...ft),this.executeOperatorList(St),this.restore()),Vt=n.Util.applyTransform([Bt.width,0],ft)[0]*d+jt,r.translate(Vt,0),s.x+=Vt*nt}r.restore(),this.processingType3=null}}setCharWidth(i,r){}setCharWidthAndBounds(i,r,s,c,d,m){this.ctx.rect(s,c,d-s,m-c),this.ctx.clip(),this.endPath()}getColorN_Pattern(i){let r;if(i[0]==="TilingPattern"){const s=i[1],c=this.baseTransform||(0,P.getCurrentTransform)(this.ctx),d={createCanvasGraphics:m=>new $t(m,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};r=new V.TilingPattern(i,s,this.ctx,d,c)}else r=this._getPattern(i[1],i[2]);return r}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(i,r,s){const c=n.Util.makeHexColor(i,r,s);this.ctx.strokeStyle=c,this.current.strokeColor=c}setFillRGBColor(i,r,s){const c=n.Util.makeHexColor(i,r,s);this.ctx.fillStyle=c,this.current.fillColor=c,this.current.patternFill=!1}_getPattern(i,r=null){let s;return this.cachedPatterns.has(i)?s=this.cachedPatterns.get(i):(s=(0,V.getShadingPattern)(this.getObject(i)),this.cachedPatterns.set(i,s)),r&&(s.matrix=r),s}shadingFill(i){if(!this.contentVisible)return;const r=this.ctx;this.save();const s=this._getPattern(i);r.fillStyle=s.getPattern(r,this,(0,P.getCurrentTransformInverse)(r),V.PathType.SHADING);const c=(0,P.getCurrentTransformInverse)(r);if(c){const{width:d,height:m}=r.canvas,[M,B,lt,nt]=n.Util.getAxialAlignedBoundingBox([0,0,d,m],c);this.ctx.fillRect(M,B,lt-M,nt-B)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,n.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,n.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(i,r){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(i)&&i.length===6&&this.transform(...i),this.baseTransform=(0,P.getCurrentTransform)(this.ctx),r)){const s=r[2]-r[0],c=r[3]-r[1];this.ctx.rect(r[0],r[1],s,c),this.current.updateRectMinMax((0,P.getCurrentTransform)(this.ctx),r),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(i){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const r=this.ctx;i.isolated||(0,n.info)("TODO: Support non-isolated groups."),i.knockout&&(0,n.warn)("Knockout groups not supported.");const s=(0,P.getCurrentTransform)(r);if(i.matrix&&r.transform(...i.matrix),!i.bbox)throw new Error("Bounding box is required.");let c=n.Util.getAxialAlignedBoundingBox(i.bbox,(0,P.getCurrentTransform)(r));const d=[0,0,r.canvas.width,r.canvas.height];c=n.Util.intersect(c,d)||[0,0,0,0];const m=Math.floor(c[0]),M=Math.floor(c[1]);let B=Math.max(Math.ceil(c[2])-m,1),lt=Math.max(Math.ceil(c[3])-M,1),nt=1,ft=1;B>F&&(nt=B/F,B=F),lt>F&&(ft=lt/F,lt=F),this.current.startNewPathAndClipBox([0,0,B,lt]);let mt="groupAt"+this.groupLevel;i.smask&&(mt+="_smask_"+this.smaskCounter++%2);const Mt=this.cachedCanvases.getCanvas(mt,B,lt),At=Mt.context;At.scale(1/nt,1/ft),At.translate(-m,-M),At.transform(...s),i.smask?this.smaskStack.push({canvas:Mt.canvas,context:At,offsetX:m,offsetY:M,scaleX:nt,scaleY:ft,subtype:i.smask.subtype,backdrop:i.smask.backdrop,transferMap:i.smask.transferMap||null,startTransformInverse:null}):(r.setTransform(1,0,0,1,0,0),r.translate(m,M),r.scale(nt,ft),r.save()),l(r,At),this.ctx=At,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(r),this.groupLevel++}endGroup(i){if(!this.contentVisible)return;this.groupLevel--;const r=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,i.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const c=(0,P.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...c);const d=n.Util.getAxialAlignedBoundingBox([0,0,r.canvas.width,r.canvas.height],c);this.ctx.drawImage(r.canvas,0,0),this.ctx.restore(),this.compose(d)}}beginAnnotation(i,r,s,c,d){if(Z(this,et,es).call(this),h(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(r)&&r.length===4){const m=r[2]-r[0],M=r[3]-r[1];if(d&&this.annotationCanvasMap){s=s.slice(),s[4]-=r[0],s[5]-=r[1],r=r.slice(),r[0]=r[1]=0,r[2]=m,r[3]=M;const[B,lt]=n.Util.singularValueDecompose2dScale((0,P.getCurrentTransform)(this.ctx)),{viewportScale:nt}=this,ft=Math.ceil(m*this.outputScaleX*nt),mt=Math.ceil(M*this.outputScaleY*nt);this.annotationCanvas=this.canvasFactory.create(ft,mt);const{canvas:Mt,context:At}=this.annotationCanvas;this.annotationCanvasMap.set(i,Mt),this.annotationCanvas.savedCtx=this.ctx,this.ctx=At,this.ctx.save(),this.ctx.setTransform(B,0,0,-lt,0,M*lt),h(this.ctx)}else h(this.ctx),this.ctx.rect(r[0],r[1],m,M),this.ctx.clip(),this.endPath()}this.current=new k(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...c)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),Z(this,Rt,is).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(i){if(!this.contentVisible)return;const r=i.count;i=this.getObject(i.data,i),i.count=r;const s=this.ctx,c=this.processingType3;if(c&&(c.compiled===void 0&&(c.compiled=b(i)),c.compiled)){c.compiled(s);return}const d=this._createMaskCanvas(i),m=d.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(m,d.offsetX,d.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(i,r,s=0,c=0,d,m){if(!this.contentVisible)return;i=this.getObject(i.data,i);const M=this.ctx;M.save();const B=(0,P.getCurrentTransform)(M);M.transform(r,s,c,d,0,0);const lt=this._createMaskCanvas(i);M.setTransform(1,0,0,1,lt.offsetX-B[4],lt.offsetY-B[5]);for(let nt=0,ft=m.length;nt<ft;nt+=2){const mt=n.Util.transform(B,[r,s,c,d,m[nt],m[nt+1]]),[Mt,At]=n.Util.applyTransform([0,0],mt);M.drawImage(lt.canvas,Mt,At)}M.restore(),this.compose()}paintImageMaskXObjectGroup(i){if(!this.contentVisible)return;const r=this.ctx,s=this.current.fillColor,c=this.current.patternFill;for(const d of i){const{data:m,width:M,height:B,transform:lt}=d,nt=this.cachedCanvases.getCanvas("maskCanvas",M,B),ft=nt.context;ft.save();const mt=this.getObject(m,d);y(ft,mt),ft.globalCompositeOperation="source-in",ft.fillStyle=c?s.getPattern(ft,this,(0,P.getCurrentTransformInverse)(r),V.PathType.FILL):s,ft.fillRect(0,0,M,B),ft.restore(),r.save(),r.transform(...lt),r.scale(1,-1),f(r,nt.canvas,0,0,M,B,0,-1,1,1),r.restore()}this.compose()}paintImageXObject(i){if(!this.contentVisible)return;const r=this.getObject(i);if(!r){(0,n.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(r)}paintImageXObjectRepeat(i,r,s,c){if(!this.contentVisible)return;const d=this.getObject(i);if(!d){(0,n.warn)("Dependent image isn't ready yet");return}const m=d.width,M=d.height,B=[];for(let lt=0,nt=c.length;lt<nt;lt+=2)B.push({transform:[r,0,0,s,c[lt],c[lt+1]],x:0,y:0,w:m,h:M});this.paintInlineImageXObjectGroup(d,B)}applyTransferMapsToCanvas(i){return this.current.transferMaps!=="none"&&(i.filter=this.current.transferMaps,i.drawImage(i.canvas,0,0),i.filter="none"),i.canvas}applyTransferMapsToBitmap(i){if(this.current.transferMaps==="none")return i.bitmap;const{bitmap:r,width:s,height:c}=i,d=this.cachedCanvases.getCanvas("inlineImage",s,c),m=d.context;return m.filter=this.current.transferMaps,m.drawImage(r,0,0),m.filter="none",d.canvas}paintInlineImageXObject(i){if(!this.contentVisible)return;const r=i.width,s=i.height,c=this.ctx;if(this.save(),!n.isNodeJS){const{filter:M}=c;M!=="none"&&M!==""&&(c.filter="none")}c.scale(1/r,-1/s);let d;if(i.bitmap)d=this.applyTransferMapsToBitmap(i);else if(typeof HTMLElement=="function"&&i instanceof HTMLElement||!i.data)d=i;else{const B=this.cachedCanvases.getCanvas("inlineImage",r,s).context;x(B,i),d=this.applyTransferMapsToCanvas(B)}const m=this._scaleImage(d,(0,P.getCurrentTransformInverse)(c));c.imageSmoothingEnabled=xt((0,P.getCurrentTransform)(c),i.interpolate),f(c,m.img,0,0,m.paintWidth,m.paintHeight,0,-s,r,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(i,r){if(!this.contentVisible)return;const s=this.ctx;let c;if(i.bitmap)c=i.bitmap;else{const d=i.width,m=i.height,B=this.cachedCanvases.getCanvas("inlineImage",d,m).context;x(B,i),c=this.applyTransferMapsToCanvas(B)}for(const d of r)s.save(),s.transform(...d.transform),s.scale(1,-1),f(s,c,d.x,d.y,d.w,d.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(i){}markPointProps(i,r){}beginMarkedContent(i){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(i,r){i==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(r)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(i){const r=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(i);const s=this.ctx;this.pendingClip&&(r||(this.pendingClip===Et?s.clip("evenodd"):s.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const i=(0,P.getCurrentTransform)(this.ctx);if(i[1]===0&&i[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(i[0]),Math.abs(i[3]));else{const r=Math.abs(i[0]*i[3]-i[2]*i[1]),s=Math.hypot(i[0],i[2]),c=Math.hypot(i[1],i[3]);this._cachedGetSinglePixelWidth=Math.max(s,c)/r}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:i}=this.current,{a:r,b:s,c,d}=this.ctx.getTransform();let m,M;if(s===0&&c===0){const B=Math.abs(r),lt=Math.abs(d);if(B===lt)if(i===0)m=M=1/B;else{const nt=B*i;m=M=nt<1?1/nt:1}else if(i===0)m=1/B,M=1/lt;else{const nt=B*i,ft=lt*i;m=nt<1?1/nt:1,M=ft<1?1/ft:1}}else{const B=Math.abs(r*d-s*c),lt=Math.hypot(r,s),nt=Math.hypot(c,d);if(i===0)m=nt/B,M=lt/B;else{const ft=i*B;m=nt>ft?nt/ft:1,M=lt>ft?lt/ft:1}}this._cachedScaleForStroking[0]=m,this._cachedScaleForStroking[1]=M}return this._cachedScaleForStroking}rescaleAndStroke(i){const{ctx:r}=this,{lineWidth:s}=this.current,[c,d]=this.getScaleForStroking();if(r.lineWidth=s||1,c===1&&d===1){r.stroke();return}const m=r.getLineDash();if(i&&r.save(),r.scale(c,d),m.length>0){const M=Math.max(c,d);r.setLineDash(m.map(B=>B/M)),r.lineDashOffset/=M}r.stroke(),i&&r.restore()}isContentVisible(){for(let i=this.markedContentStack.length-1;i>=0;i--)if(!this.markedContentStack[i].visible)return!1;return!0}};et=new WeakSet,es=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Rt=new WeakSet,is=function(){if(this.pageColors){const i=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(i!=="none"){const r=this.ctx.filter;this.ctx.filter=i,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=r}}};let yt=$t;o.CanvasGraphics=yt;for(const T in n.OPS)yt.prototype[T]!==void 0&&(yt.prototype[n.OPS[T]]=yt.prototype[T])},(U,o,K)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TilingPattern=o.PathType=void 0,o.getShadingPattern=L;var n=K(1),P=K(6);const V={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};o.PathType=V;function q(b,k){if(!k)return;const x=k[2]-k[0],y=k[3]-k[1],l=new Path2D;l.rect(k[0],k[1],x,y),b.clip(l)}class gt{constructor(){this.constructor===gt&&(0,n.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,n.unreachable)("Abstract method `getPattern` called.")}}class z extends gt{constructor(k){super(),this._type=k[1],this._bbox=k[2],this._colorStops=k[3],this._p0=k[4],this._p1=k[5],this._r0=k[6],this._r1=k[7],this.matrix=null}_createGradient(k){let x;this._type==="axial"?x=k.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(x=k.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const y of this._colorStops)x.addColorStop(y[0],y[1]);return x}getPattern(k,x,y,l){let h;if(l===V.STROKE||l===V.FILL){const I=x.current.getClippedPathBoundingBox(l,(0,P.getCurrentTransform)(k))||[0,0,0,0],Q=Math.ceil(I[2]-I[0])||1,J=Math.ceil(I[3]-I[1])||1,_t=x.cachedCanvases.getCanvas("pattern",Q,J,!0),at=_t.context;at.clearRect(0,0,at.canvas.width,at.canvas.height),at.beginPath(),at.rect(0,0,at.canvas.width,at.canvas.height),at.translate(-I[0],-I[1]),y=n.Util.transform(y,[1,0,0,1,I[0],I[1]]),at.transform(...x.baseTransform),this.matrix&&at.transform(...this.matrix),q(at,this._bbox),at.fillStyle=this._createGradient(at),at.fill(),h=k.createPattern(_t.canvas,"no-repeat");const xt=new DOMMatrix(y);h.setTransform(xt)}else q(k,this._bbox),h=this._createGradient(k);return h}}function F(b,k,x,y,l,h,I,Q){const J=k.coords,_t=k.colors,at=b.data,xt=b.width*4;let Ct;J[x+1]>J[y+1]&&(Ct=x,x=y,y=Ct,Ct=h,h=I,I=Ct),J[y+1]>J[l+1]&&(Ct=y,y=l,l=Ct,Ct=I,I=Q,Q=Ct),J[x+1]>J[y+1]&&(Ct=x,x=y,y=Ct,Ct=h,h=I,I=Ct);const j=(J[x]+k.offsetX)*k.scaleX,ut=(J[x+1]+k.offsetY)*k.scaleY,Et=(J[y]+k.offsetX)*k.scaleX,yt=(J[y+1]+k.offsetY)*k.scaleY,et=(J[l]+k.offsetX)*k.scaleX,bt=(J[l+1]+k.offsetY)*k.scaleY;if(ut>=bt)return;const Rt=_t[h],Ut=_t[h+1],$t=_t[h+2],T=_t[I],i=_t[I+1],r=_t[I+2],s=_t[Q],c=_t[Q+1],d=_t[Q+2],m=Math.round(ut),M=Math.round(bt);let B,lt,nt,ft,mt,Mt,At,Bt;for(let Vt=m;Vt<=M;Vt++){if(Vt<yt){const st=Vt<ut?0:(ut-Vt)/(ut-yt);B=j-(j-Et)*st,lt=Rt-(Rt-T)*st,nt=Ut-(Ut-i)*st,ft=$t-($t-r)*st}else{let st;Vt>bt?st=1:yt===bt?st=0:st=(yt-Vt)/(yt-bt),B=Et-(Et-et)*st,lt=T-(T-s)*st,nt=i-(i-c)*st,ft=r-(r-d)*st}let kt;Vt<ut?kt=0:Vt>bt?kt=1:kt=(ut-Vt)/(ut-bt),mt=j-(j-et)*kt,Mt=Rt-(Rt-s)*kt,At=Ut-(Ut-c)*kt,Bt=$t-($t-d)*kt;const jt=Math.round(Math.min(B,mt)),St=Math.round(Math.max(B,mt));let it=xt*Vt+jt*4;for(let st=jt;st<=St;st++)kt=(B-st)/(B-mt),kt<0?kt=0:kt>1&&(kt=1),at[it++]=lt-(lt-Mt)*kt|0,at[it++]=nt-(nt-At)*kt|0,at[it++]=ft-(ft-Bt)*kt|0,at[it++]=255}}function g(b,k,x){const y=k.coords,l=k.colors;let h,I;switch(k.type){case"lattice":const Q=k.verticesPerRow,J=Math.floor(y.length/Q)-1,_t=Q-1;for(h=0;h<J;h++){let at=h*Q;for(let xt=0;xt<_t;xt++,at++)F(b,x,y[at],y[at+1],y[at+Q],l[at],l[at+1],l[at+Q]),F(b,x,y[at+Q+1],y[at+1],y[at+Q],l[at+Q+1],l[at+1],l[at+Q])}break;case"triangles":for(h=0,I=y.length;h<I;h+=3)F(b,x,y[h],y[h+1],y[h+2],l[h],l[h+1],l[h+2]);break;default:throw new Error("illegal figure")}}class H extends gt{constructor(k){super(),this._coords=k[2],this._colors=k[3],this._figures=k[4],this._bounds=k[5],this._bbox=k[7],this._background=k[8],this.matrix=null}_createMeshCanvas(k,x,y){const Q=Math.floor(this._bounds[0]),J=Math.floor(this._bounds[1]),_t=Math.ceil(this._bounds[2])-Q,at=Math.ceil(this._bounds[3])-J,xt=Math.min(Math.ceil(Math.abs(_t*k[0]*1.1)),3e3),Ct=Math.min(Math.ceil(Math.abs(at*k[1]*1.1)),3e3),j=_t/xt,ut=at/Ct,Et={coords:this._coords,colors:this._colors,offsetX:-Q,offsetY:-J,scaleX:1/j,scaleY:1/ut},yt=xt+2*2,et=Ct+2*2,bt=y.getCanvas("mesh",yt,et,!1),Rt=bt.context,Ut=Rt.createImageData(xt,Ct);if(x){const T=Ut.data;for(let i=0,r=T.length;i<r;i+=4)T[i]=x[0],T[i+1]=x[1],T[i+2]=x[2],T[i+3]=255}for(const T of this._figures)g(Ut,T,Et);return Rt.putImageData(Ut,2,2),{canvas:bt.canvas,offsetX:Q-2*j,offsetY:J-2*ut,scaleX:j,scaleY:ut}}getPattern(k,x,y,l){q(k,this._bbox);let h;if(l===V.SHADING)h=n.Util.singularValueDecompose2dScale((0,P.getCurrentTransform)(k));else if(h=n.Util.singularValueDecompose2dScale(x.baseTransform),this.matrix){const Q=n.Util.singularValueDecompose2dScale(this.matrix);h=[h[0]*Q[0],h[1]*Q[1]]}const I=this._createMeshCanvas(h,l===V.SHADING?null:this._background,x.cachedCanvases);return l!==V.SHADING&&(k.setTransform(...x.baseTransform),this.matrix&&k.transform(...this.matrix)),k.translate(I.offsetX,I.offsetY),k.scale(I.scaleX,I.scaleY),k.createPattern(I.canvas,"no-repeat")}}class W extends gt{getPattern(){return"hotpink"}}function L(b){switch(b[0]){case"RadialAxial":return new z(b);case"Mesh":return new H(b);case"Dummy":return new W}throw new Error(`Unknown IR type: ${b[0]}`)}const E={COLORED:1,UNCOLORED:2},f=class f{constructor(k,x,y,l,h){this.operatorList=k[2],this.matrix=k[3]||[1,0,0,1,0,0],this.bbox=k[4],this.xstep=k[5],this.ystep=k[6],this.paintType=k[7],this.tilingType=k[8],this.color=x,this.ctx=y,this.canvasGraphicsFactory=l,this.baseTransform=h}createPatternCanvas(k){const x=this.operatorList,y=this.bbox,l=this.xstep,h=this.ystep,I=this.paintType,Q=this.tilingType,J=this.color,_t=this.canvasGraphicsFactory;(0,n.info)("TilingType: "+Q);const at=y[0],xt=y[1],Ct=y[2],j=y[3],ut=n.Util.singularValueDecompose2dScale(this.matrix),Et=n.Util.singularValueDecompose2dScale(this.baseTransform),yt=[ut[0]*Et[0],ut[1]*Et[1]],et=this.getSizeAndScale(l,this.ctx.canvas.width,yt[0]),bt=this.getSizeAndScale(h,this.ctx.canvas.height,yt[1]),Rt=k.cachedCanvases.getCanvas("pattern",et.size,bt.size,!0),Ut=Rt.context,$t=_t.createCanvasGraphics(Ut);$t.groupLevel=k.groupLevel,this.setFillAndStrokeStyleToContext($t,I,J);let T=at,i=xt,r=Ct,s=j;return at<0&&(T=0,r+=Math.abs(at)),xt<0&&(i=0,s+=Math.abs(xt)),Ut.translate(-(et.scale*T),-(bt.scale*i)),$t.transform(et.scale,0,0,bt.scale,0,0),Ut.save(),this.clipBbox($t,T,i,r,s),$t.baseTransform=(0,P.getCurrentTransform)($t.ctx),$t.executeOperatorList(x),$t.endDrawing(),{canvas:Rt.canvas,scaleX:et.scale,scaleY:bt.scale,offsetX:T,offsetY:i}}getSizeAndScale(k,x,y){k=Math.abs(k);const l=Math.max(f.MAX_PATTERN_SIZE,x);let h=Math.ceil(k*y);return h>=l?h=l:y=h/k,{scale:y,size:h}}clipBbox(k,x,y,l,h){const I=l-x,Q=h-y;k.ctx.rect(x,y,I,Q),k.current.updateRectMinMax((0,P.getCurrentTransform)(k.ctx),[x,y,l,h]),k.clip(),k.endPath()}setFillAndStrokeStyleToContext(k,x,y){const l=k.ctx,h=k.current;switch(x){case E.COLORED:const I=this.ctx;l.fillStyle=I.fillStyle,l.strokeStyle=I.strokeStyle,h.fillColor=I.fillStyle,h.strokeColor=I.strokeStyle;break;case E.UNCOLORED:const Q=n.Util.makeHexColor(y[0],y[1],y[2]);l.fillStyle=Q,l.strokeStyle=Q,h.fillColor=Q,h.strokeColor=Q;break;default:throw new n.FormatError(`Unsupported paint type: ${x}`)}}getPattern(k,x,y,l){let h=y;l!==V.SHADING&&(h=n.Util.transform(h,x.baseTransform),this.matrix&&(h=n.Util.transform(h,this.matrix)));const I=this.createPatternCanvas(x);let Q=new DOMMatrix(h);Q=Q.translate(I.offsetX,I.offsetY),Q=Q.scale(1/I.scaleX,1/I.scaleY);const J=k.createPattern(I.canvas,"repeat");return J.setTransform(Q),J}};oe(f,"MAX_PATTERN_SIZE",3e3);let w=f;o.TilingPattern=w},(U,o,K)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.convertBlackAndWhiteToRGBA=V,o.convertToRGBA=P,o.grayToRGBA=gt;var n=K(1);function P(z){switch(z.kind){case n.ImageKind.GRAYSCALE_1BPP:return V(z);case n.ImageKind.RGB_24BPP:return q(z)}return null}function V({src:z,srcPos:F=0,dest:g,width:H,height:W,nonBlackColor:L=4294967295,inverseDecode:E=!1}){const w=n.FeatureTest.isLittleEndian?4278190080:255,[f,b]=E?[L,w]:[w,L],k=H>>3,x=H&7,y=z.length;g=new Uint32Array(g.buffer);let l=0;for(let h=0;h<W;h++){for(const Q=F+k;F<Q;F++){const J=F<y?z[F]:255;g[l++]=J&128?b:f,g[l++]=J&64?b:f,g[l++]=J&32?b:f,g[l++]=J&16?b:f,g[l++]=J&8?b:f,g[l++]=J&4?b:f,g[l++]=J&2?b:f,g[l++]=J&1?b:f}if(x===0)continue;const I=F<y?z[F++]:255;for(let Q=0;Q<x;Q++)g[l++]=I&1<<7-Q?b:f}return{srcPos:F,destPos:l}}function q({src:z,srcPos:F=0,dest:g,destPos:H=0,width:W,height:L}){let E=0;const w=z.length>>2,f=new Uint32Array(z.buffer,F,w);if(n.FeatureTest.isLittleEndian){for(;E<w-2;E+=3,H+=4){const b=f[E],k=f[E+1],x=f[E+2];g[H]=b|4278190080,g[H+1]=b>>>24|k<<8|4278190080,g[H+2]=k>>>16|x<<16|4278190080,g[H+3]=x>>>8|4278190080}for(let b=E*4,k=z.length;b<k;b+=3)g[H++]=z[b]|z[b+1]<<8|z[b+2]<<16|4278190080}else{for(;E<w-2;E+=3,H+=4){const b=f[E],k=f[E+1],x=f[E+2];g[H]=b|255,g[H+1]=b<<24|k>>>8|255,g[H+2]=k<<16|x>>>16|255,g[H+3]=x<<8|255}for(let b=E*4,k=z.length;b<k;b+=3)g[H++]=z[b]<<24|z[b+1]<<16|z[b+2]<<8|255}return{srcPos:F,destPos:H}}function gt(z,F){if(n.FeatureTest.isLittleEndian)for(let g=0,H=z.length;g<H;g++)F[g]=z[g]*65793|4278190080;else for(let g=0,H=z.length;g<H;g++)F[g]=z[g]*16843008|255}},(U,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.GlobalWorkerOptions=void 0;const K=Object.create(null);o.GlobalWorkerOptions=K,K.workerPort=null,K.workerSrc=""},(U,o,K)=>{var z,un,g,fn,W,mi;Object.defineProperty(o,"__esModule",{value:!0}),o.MessageHandler=void 0;var n=K(1);const P={UNKNOWN:0,DATA:1,ERROR:2},V={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function q(E){switch(E instanceof Error||typeof E=="object"&&E!==null||(0,n.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),E.name){case"AbortException":return new n.AbortException(E.message);case"MissingPDFException":return new n.MissingPDFException(E.message);case"PasswordException":return new n.PasswordException(E.message,E.code);case"UnexpectedResponseException":return new n.UnexpectedResponseException(E.message,E.status);case"UnknownErrorException":return new n.UnknownErrorException(E.message,E.details);default:return new n.UnknownErrorException(E.message,E.toString())}}class gt{constructor(w,f,b){$(this,z);$(this,g);$(this,W);this.sourceName=w,this.targetName=f,this.comObj=b,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=k=>{const x=k.data;if(x.targetName!==this.sourceName)return;if(x.stream){Z(this,g,fn).call(this,x);return}if(x.callback){const l=x.callbackId,h=this.callbackCapabilities[l];if(!h)throw new Error(`Cannot resolve callback ${l}`);if(delete this.callbackCapabilities[l],x.callback===P.DATA)h.resolve(x.data);else if(x.callback===P.ERROR)h.reject(q(x.reason));else throw new Error("Unexpected callback case");return}const y=this.actionHandler[x.action];if(!y)throw new Error(`Unknown action from worker: ${x.action}`);if(x.callbackId){const l=this.sourceName,h=x.sourceName;new Promise(function(I){I(y(x.data))}).then(function(I){b.postMessage({sourceName:l,targetName:h,callback:P.DATA,callbackId:x.callbackId,data:I})},function(I){b.postMessage({sourceName:l,targetName:h,callback:P.ERROR,callbackId:x.callbackId,reason:q(I)})});return}if(x.streamId){Z(this,z,un).call(this,x);return}y(x.data)},b.addEventListener("message",this._onComObjOnMessage)}on(w,f){const b=this.actionHandler;if(b[w])throw new Error(`There is already an actionName called "${w}"`);b[w]=f}send(w,f,b){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:w,data:f},b)}sendWithPromise(w,f,b){const k=this.callbackId++,x=new n.PromiseCapability;this.callbackCapabilities[k]=x;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:w,callbackId:k,data:f},b)}catch(y){x.reject(y)}return x.promise}sendWithStream(w,f,b,k){const x=this.streamId++,y=this.sourceName,l=this.targetName,h=this.comObj;return new ReadableStream({start:I=>{const Q=new n.PromiseCapability;return this.streamControllers[x]={controller:I,startCall:Q,pullCall:null,cancelCall:null,isClosed:!1},h.postMessage({sourceName:y,targetName:l,action:w,streamId:x,data:f,desiredSize:I.desiredSize},k),Q.promise},pull:I=>{const Q=new n.PromiseCapability;return this.streamControllers[x].pullCall=Q,h.postMessage({sourceName:y,targetName:l,stream:V.PULL,streamId:x,desiredSize:I.desiredSize}),Q.promise},cancel:I=>{(0,n.assert)(I instanceof Error,"cancel must have a valid reason");const Q=new n.PromiseCapability;return this.streamControllers[x].cancelCall=Q,this.streamControllers[x].isClosed=!0,h.postMessage({sourceName:y,targetName:l,stream:V.CANCEL,streamId:x,reason:q(I)}),Q.promise}},b)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}z=new WeakSet,un=function(w){const f=w.streamId,b=this.sourceName,k=w.sourceName,x=this.comObj,y=this,l=this.actionHandler[w.action],h={enqueue(I,Q=1,J){if(this.isCancelled)return;const _t=this.desiredSize;this.desiredSize-=Q,_t>0&&this.desiredSize<=0&&(this.sinkCapability=new n.PromiseCapability,this.ready=this.sinkCapability.promise),x.postMessage({sourceName:b,targetName:k,stream:V.ENQUEUE,streamId:f,chunk:I},J)},close(){this.isCancelled||(this.isCancelled=!0,x.postMessage({sourceName:b,targetName:k,stream:V.CLOSE,streamId:f}),delete y.streamSinks[f])},error(I){(0,n.assert)(I instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,x.postMessage({sourceName:b,targetName:k,stream:V.ERROR,streamId:f,reason:q(I)}))},sinkCapability:new n.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:w.desiredSize,ready:null};h.sinkCapability.resolve(),h.ready=h.sinkCapability.promise,this.streamSinks[f]=h,new Promise(function(I){I(l(w.data,h))}).then(function(){x.postMessage({sourceName:b,targetName:k,stream:V.START_COMPLETE,streamId:f,success:!0})},function(I){x.postMessage({sourceName:b,targetName:k,stream:V.START_COMPLETE,streamId:f,reason:q(I)})})},g=new WeakSet,fn=function(w){const f=w.streamId,b=this.sourceName,k=w.sourceName,x=this.comObj,y=this.streamControllers[f],l=this.streamSinks[f];switch(w.stream){case V.START_COMPLETE:w.success?y.startCall.resolve():y.startCall.reject(q(w.reason));break;case V.PULL_COMPLETE:w.success?y.pullCall.resolve():y.pullCall.reject(q(w.reason));break;case V.PULL:if(!l){x.postMessage({sourceName:b,targetName:k,stream:V.PULL_COMPLETE,streamId:f,success:!0});break}l.desiredSize<=0&&w.desiredSize>0&&l.sinkCapability.resolve(),l.desiredSize=w.desiredSize,new Promise(function(h){var I;h((I=l.onPull)==null?void 0:I.call(l))}).then(function(){x.postMessage({sourceName:b,targetName:k,stream:V.PULL_COMPLETE,streamId:f,success:!0})},function(h){x.postMessage({sourceName:b,targetName:k,stream:V.PULL_COMPLETE,streamId:f,reason:q(h)})});break;case V.ENQUEUE:if((0,n.assert)(y,"enqueue should have stream controller"),y.isClosed)break;y.controller.enqueue(w.chunk);break;case V.CLOSE:if((0,n.assert)(y,"close should have stream controller"),y.isClosed)break;y.isClosed=!0,y.controller.close(),Z(this,W,mi).call(this,y,f);break;case V.ERROR:(0,n.assert)(y,"error should have stream controller"),y.controller.error(q(w.reason)),Z(this,W,mi).call(this,y,f);break;case V.CANCEL_COMPLETE:w.success?y.cancelCall.resolve():y.cancelCall.reject(q(w.reason)),Z(this,W,mi).call(this,y,f);break;case V.CANCEL:if(!l)break;new Promise(function(h){var I;h((I=l.onCancel)==null?void 0:I.call(l,q(w.reason)))}).then(function(){x.postMessage({sourceName:b,targetName:k,stream:V.CANCEL_COMPLETE,streamId:f,success:!0})},function(h){x.postMessage({sourceName:b,targetName:k,stream:V.CANCEL_COMPLETE,streamId:f,reason:q(h)})}),l.sinkCapability.reject(q(w.reason)),l.isCancelled=!0,delete this.streamSinks[f];break;default:throw new Error("Unexpected stream case")}},W=new WeakSet,mi=async function(w,f){var b,k,x;await Promise.allSettled([(b=w.startCall)==null?void 0:b.promise,(k=w.pullCall)==null?void 0:k.promise,(x=w.cancelCall)==null?void 0:x.promise]),delete this.streamControllers[f]},o.MessageHandler=gt},(U,o,K)=>{var V,q;Object.defineProperty(o,"__esModule",{value:!0}),o.Metadata=void 0;var n=K(1);class P{constructor({parsedData:z,rawData:F}){$(this,V,void 0);$(this,q,void 0);ot(this,V,z),ot(this,q,F)}getRaw(){return t(this,q)}get(z){return t(this,V).get(z)??null}getAll(){return(0,n.objectFromMap)(t(this,V))}has(z){return t(this,V).has(z)}}V=new WeakMap,q=new WeakMap,o.Metadata=P},(U,o,K)=>{var z,F,g,H,W,L,ss;Object.defineProperty(o,"__esModule",{value:!0}),o.OptionalContentConfig=void 0;var n=K(1),P=K(8);const V=Symbol("INTERNAL");class q{constructor(f,b){$(this,z,!0);this.name=f,this.intent=b}get visible(){return t(this,z)}_setVisible(f,b){f!==V&&(0,n.unreachable)("Internal method `_setVisible` called."),ot(this,z,b)}}z=new WeakMap;class gt{constructor(f){$(this,L);$(this,F,null);$(this,g,new Map);$(this,H,null);$(this,W,null);if(this.name=null,this.creator=null,f!==null){this.name=f.name,this.creator=f.creator,ot(this,W,f.order);for(const b of f.groups)t(this,g).set(b.id,new q(b.name,b.intent));if(f.baseState==="OFF")for(const b of t(this,g).values())b._setVisible(V,!1);for(const b of f.on)t(this,g).get(b)._setVisible(V,!0);for(const b of f.off)t(this,g).get(b)._setVisible(V,!1);ot(this,H,this.getHash())}}isVisible(f){if(t(this,g).size===0)return!0;if(!f)return(0,n.warn)("Optional content group not defined."),!0;if(f.type==="OCG")return t(this,g).has(f.id)?t(this,g).get(f.id).visible:((0,n.warn)(`Optional content group not found: ${f.id}`),!0);if(f.type==="OCMD"){if(f.expression)return Z(this,L,ss).call(this,f.expression);if(!f.policy||f.policy==="AnyOn"){for(const b of f.ids){if(!t(this,g).has(b))return(0,n.warn)(`Optional content group not found: ${b}`),!0;if(t(this,g).get(b).visible)return!0}return!1}else if(f.policy==="AllOn"){for(const b of f.ids){if(!t(this,g).has(b))return(0,n.warn)(`Optional content group not found: ${b}`),!0;if(!t(this,g).get(b).visible)return!1}return!0}else if(f.policy==="AnyOff"){for(const b of f.ids){if(!t(this,g).has(b))return(0,n.warn)(`Optional content group not found: ${b}`),!0;if(!t(this,g).get(b).visible)return!0}return!1}else if(f.policy==="AllOff"){for(const b of f.ids){if(!t(this,g).has(b))return(0,n.warn)(`Optional content group not found: ${b}`),!0;if(t(this,g).get(b).visible)return!1}return!0}return(0,n.warn)(`Unknown optional content policy ${f.policy}.`),!0}return(0,n.warn)(`Unknown group type ${f.type}.`),!0}setVisibility(f,b=!0){if(!t(this,g).has(f)){(0,n.warn)(`Optional content group not found: ${f}`);return}t(this,g).get(f)._setVisible(V,!!b),ot(this,F,null)}get hasInitialVisibility(){return t(this,H)===null||this.getHash()===t(this,H)}getOrder(){return t(this,g).size?t(this,W)?t(this,W).slice():[...t(this,g).keys()]:null}getGroups(){return t(this,g).size>0?(0,n.objectFromMap)(t(this,g)):null}getGroup(f){return t(this,g).get(f)||null}getHash(){if(t(this,F)!==null)return t(this,F);const f=new P.MurmurHash3_64;for(const[b,k]of t(this,g))f.update(`${b}:${k.visible}`);return ot(this,F,f.hexdigest())}}F=new WeakMap,g=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakSet,ss=function(f){const b=f.length;if(b<2)return!0;const k=f[0];for(let x=1;x<b;x++){const y=f[x];let l;if(Array.isArray(y))l=Z(this,L,ss).call(this,y);else if(t(this,g).has(y))l=t(this,g).get(y).visible;else return(0,n.warn)(`Optional content group not found: ${y}`),!0;switch(k){case"And":if(!l)return!1;break;case"Or":if(l)return!0;break;case"Not":return!l;default:return!0}}return k==="And"},o.OptionalContentConfig=gt},(U,o,K)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PDFDataTransportStream=void 0;var n=K(1),P=K(6);class V{constructor({length:F,initialData:g,progressiveDone:H=!1,contentDispositionFilename:W=null,disableRange:L=!1,disableStream:E=!1},w){if((0,n.assert)(w,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=H,this._contentDispositionFilename=W,(g==null?void 0:g.length)>0){const f=g instanceof Uint8Array&&g.byteLength===g.buffer.byteLength?g.buffer:new Uint8Array(g).buffer;this._queuedChunks.push(f)}this._pdfDataRangeTransport=w,this._isStreamingSupported=!E,this._isRangeSupported=!L,this._contentLength=F,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((f,b)=>{this._onReceiveData({begin:f,chunk:b})}),this._pdfDataRangeTransport.addProgressListener((f,b)=>{this._onProgress({loaded:f,total:b})}),this._pdfDataRangeTransport.addProgressiveReadListener(f=>{this._onReceiveData({chunk:f})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:F,chunk:g}){const H=g instanceof Uint8Array&&g.byteLength===g.buffer.byteLength?g.buffer:new Uint8Array(g).buffer;if(F===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(H):this._queuedChunks.push(H);else{const W=this._rangeReaders.some(function(L){return L._begin!==F?!1:(L._enqueue(H),!0)});(0,n.assert)(W,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var F;return((F=this._fullRequestReader)==null?void 0:F._loaded)??0}_onProgress(F){var g,H,W,L;F.total===void 0?(H=(g=this._rangeReaders[0])==null?void 0:g.onProgress)==null||H.call(g,{loaded:F.loaded}):(L=(W=this._fullRequestReader)==null?void 0:W.onProgress)==null||L.call(W,{loaded:F.loaded,total:F.total})}_onProgressiveDone(){var F;(F=this._fullRequestReader)==null||F.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(F){const g=this._rangeReaders.indexOf(F);g>=0&&this._rangeReaders.splice(g,1)}getFullReader(){(0,n.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const F=this._queuedChunks;return this._queuedChunks=null,new q(this,F,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(F,g){if(g<=this._progressiveDataLength)return null;const H=new gt(this,F,g);return this._pdfDataRangeTransport.requestDataRange(F,g),this._rangeReaders.push(H),H}cancelAllRequests(F){var g;(g=this._fullRequestReader)==null||g.cancel(F);for(const H of this._rangeReaders.slice(0))H.cancel(F);this._pdfDataRangeTransport.abort()}}o.PDFDataTransportStream=V;class q{constructor(F,g,H=!1,W=null){this._stream=F,this._done=H||!1,this._filename=(0,P.isPdfFile)(W)?W:null,this._queuedChunks=g||[],this._loaded=0;for(const L of this._queuedChunks)this._loaded+=L.byteLength;this._requests=[],this._headersReady=Promise.resolve(),F._fullRequestReader=this,this.onProgress=null}_enqueue(F){this._done||(this._requests.length>0?this._requests.shift().resolve({value:F,done:!1}):this._queuedChunks.push(F),this._loaded+=F.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const F=new n.PromiseCapability;return this._requests.push(F),F.promise}cancel(F){this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class gt{constructor(F,g,H){this._stream=F,this._begin=g,this._end=H,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(F){if(!this._done){if(this._requests.length===0)this._queuedChunk=F;else{this._requests.shift().resolve({value:F,done:!1});for(const H of this._requests)H.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const g=this._queuedChunk;return this._queuedChunk=null,{value:g,done:!1}}if(this._done)return{value:void 0,done:!0};const F=new n.PromiseCapability;return this._requests.push(F),F.promise}cancel(F){this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(U,o,K)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PDFFetchStream=void 0;var n=K(1),P=K(20);function V(H,W,L){return{method:"GET",headers:H,signal:L.signal,mode:"cors",credentials:W?"include":"same-origin",redirect:"follow"}}function q(H){const W=new Headers;for(const L in H){const E=H[L];E!==void 0&&W.append(L,E)}return W}function gt(H){return H instanceof Uint8Array?H.buffer:H instanceof ArrayBuffer?H:((0,n.warn)(`getArrayBuffer - unexpected data format: ${H}`),new Uint8Array(H).buffer)}class z{constructor(W){this.source=W,this.isHttp=/^https?:/i.test(W.url),this.httpHeaders=this.isHttp&&W.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var W;return((W=this._fullRequestReader)==null?void 0:W._loaded)??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new F(this),this._fullRequestReader}getRangeReader(W,L){if(L<=this._progressiveDataLength)return null;const E=new g(this,W,L);return this._rangeRequestReaders.push(E),E}cancelAllRequests(W){var L;(L=this._fullRequestReader)==null||L.cancel(W);for(const E of this._rangeRequestReaders.slice(0))E.cancel(W)}}o.PDFFetchStream=z;class F{constructor(W){this._stream=W,this._reader=null,this._loaded=0,this._filename=null;const L=W.source;this._withCredentials=L.withCredentials||!1,this._contentLength=L.length,this._headersCapability=new n.PromiseCapability,this._disableRange=L.disableRange||!1,this._rangeChunkSize=L.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!L.disableStream,this._isRangeSupported=!L.disableRange,this._headers=q(this._stream.httpHeaders);const E=L.url;fetch(E,V(this._headers,this._withCredentials,this._abortController)).then(w=>{if(!(0,P.validateResponseStatus)(w.status))throw(0,P.createResponseStatusError)(w.status,E);this._reader=w.body.getReader(),this._headersCapability.resolve();const f=x=>w.headers.get(x),{allowRangeRequests:b,suggestedLength:k}=(0,P.validateRangeRequestCapabilities)({getResponseHeader:f,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=b,this._contentLength=k||this._contentLength,this._filename=(0,P.extractFilenameFromHeader)(f),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new n.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var E;await this._headersCapability.promise;const{value:W,done:L}=await this._reader.read();return L?{value:W,done:L}:(this._loaded+=W.byteLength,(E=this.onProgress)==null||E.call(this,{loaded:this._loaded,total:this._contentLength}),{value:gt(W),done:!1})}cancel(W){var L;(L=this._reader)==null||L.cancel(W),this._abortController.abort()}}class g{constructor(W,L,E){this._stream=W,this._reader=null,this._loaded=0;const w=W.source;this._withCredentials=w.withCredentials||!1,this._readCapability=new n.PromiseCapability,this._isStreamingSupported=!w.disableStream,this._abortController=new AbortController,this._headers=q(this._stream.httpHeaders),this._headers.append("Range",`bytes=${L}-${E-1}`);const f=w.url;fetch(f,V(this._headers,this._withCredentials,this._abortController)).then(b=>{if(!(0,P.validateResponseStatus)(b.status))throw(0,P.createResponseStatusError)(b.status,f);this._readCapability.resolve(),this._reader=b.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var E;await this._readCapability.promise;const{value:W,done:L}=await this._reader.read();return L?{value:W,done:L}:(this._loaded+=W.byteLength,(E=this.onProgress)==null||E.call(this,{loaded:this._loaded}),{value:gt(W),done:!1})}cancel(W){var L;(L=this._reader)==null||L.cancel(W),this._abortController.abort()}}},(U,o,K)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.createResponseStatusError=z,o.extractFilenameFromHeader=gt,o.validateRangeRequestCapabilities=q,o.validateResponseStatus=F;var n=K(1),P=K(21),V=K(6);function q({getResponseHeader:g,isHttp:H,rangeChunkSize:W,disableRange:L}){const E={allowRangeRequests:!1,suggestedLength:void 0},w=parseInt(g("Content-Length"),10);return!Number.isInteger(w)||(E.suggestedLength=w,w<=2*W)||L||!H||g("Accept-Ranges")!=="bytes"||(g("Content-Encoding")||"identity")!=="identity"||(E.allowRangeRequests=!0),E}function gt(g){const H=g("Content-Disposition");if(H){let W=(0,P.getFilenameFromContentDispositionHeader)(H);if(W.includes("%"))try{W=decodeURIComponent(W)}catch{}if((0,V.isPdfFile)(W))return W}return null}function z(g,H){return g===404||g===0&&H.startsWith("file:")?new n.MissingPDFException('Missing PDF "'+H+'".'):new n.UnexpectedResponseException(`Unexpected server response (${g}) while retrieving PDF "${H}".`,g)}function F(g){return g===200||g===206}},(U,o,K)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.getFilenameFromContentDispositionHeader=P;var n=K(1);function P(V){let q=!0,gt=z("filename\\*","i").exec(V);if(gt){gt=gt[1];let w=W(gt);return w=unescape(w),w=L(w),w=E(w),g(w)}if(gt=H(V),gt){const w=E(gt);return g(w)}if(gt=z("filename","i").exec(V),gt){gt=gt[1];let w=W(gt);return w=E(w),g(w)}function z(w,f){return new RegExp("(?:^|;)\\s*"+w+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',f)}function F(w,f){if(w){if(!/^[\x00-\xFF]+$/.test(f))return f;try{const b=new TextDecoder(w,{fatal:!0}),k=(0,n.stringToBytes)(f);f=b.decode(k),q=!1}catch{}}return f}function g(w){return q&&/[\x80-\xff]/.test(w)&&(w=F("utf-8",w),q&&(w=F("iso-8859-1",w))),w}function H(w){const f=[];let b;const k=z("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(b=k.exec(w))!==null;){let[,y,l,h]=b;if(y=parseInt(y,10),y in f){if(y===0)break;continue}f[y]=[l,h]}const x=[];for(let y=0;y<f.length&&y in f;++y){let[l,h]=f[y];h=W(h),l&&(h=unescape(h),y===0&&(h=L(h))),x.push(h)}return x.join("")}function W(w){if(w.startsWith('"')){const f=w.slice(1).split('\\"');for(let b=0;b<f.length;++b){const k=f[b].indexOf('"');k!==-1&&(f[b]=f[b].slice(0,k),f.length=b+1),f[b]=f[b].replaceAll(/\\(.)/g,"$1")}w=f.join('"')}return w}function L(w){const f=w.indexOf("'");if(f===-1)return w;const b=w.slice(0,f),x=w.slice(f+1).replace(/^[^']*'/,"");return F(b,x)}function E(w){return!w.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(w)?w:w.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(f,b,k,x){if(k==="q"||k==="Q")return x=x.replaceAll("_"," "),x=x.replaceAll(/=([0-9a-fA-F]{2})/g,function(y,l){return String.fromCharCode(parseInt(l,16))}),F(b,x);try{x=atob(x)}catch{}return F(b,x)})}return""}},(U,o,K)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PDFNetworkStream=void 0;var n=K(1),P=K(20);const V=200,q=206;function gt(W){const L=W.response;return typeof L!="string"?L:(0,n.stringToBytes)(L).buffer}class z{constructor(L,E={}){this.url=L,this.isHttp=/^https?:/i.test(L),this.httpHeaders=this.isHttp&&E.httpHeaders||Object.create(null),this.withCredentials=E.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(L,E,w){const f={begin:L,end:E};for(const b in w)f[b]=w[b];return this.request(f)}requestFull(L){return this.request(L)}request(L){const E=new XMLHttpRequest,w=this.currXhrId++,f=this.pendingRequests[w]={xhr:E};E.open("GET",this.url),E.withCredentials=this.withCredentials;for(const b in this.httpHeaders){const k=this.httpHeaders[b];k!==void 0&&E.setRequestHeader(b,k)}return this.isHttp&&"begin"in L&&"end"in L?(E.setRequestHeader("Range",`bytes=${L.begin}-${L.end-1}`),f.expectedStatus=q):f.expectedStatus=V,E.responseType="arraybuffer",L.onError&&(E.onerror=function(b){L.onError(E.status)}),E.onreadystatechange=this.onStateChange.bind(this,w),E.onprogress=this.onProgress.bind(this,w),f.onHeadersReceived=L.onHeadersReceived,f.onDone=L.onDone,f.onError=L.onError,f.onProgress=L.onProgress,E.send(null),w}onProgress(L,E){var f;const w=this.pendingRequests[L];w&&((f=w.onProgress)==null||f.call(w,E))}onStateChange(L,E){var y,l,h;const w=this.pendingRequests[L];if(!w)return;const f=w.xhr;if(f.readyState>=2&&w.onHeadersReceived&&(w.onHeadersReceived(),delete w.onHeadersReceived),f.readyState!==4||!(L in this.pendingRequests))return;if(delete this.pendingRequests[L],f.status===0&&this.isHttp){(y=w.onError)==null||y.call(w,f.status);return}const b=f.status||V;if(!(b===V&&w.expectedStatus===q)&&b!==w.expectedStatus){(l=w.onError)==null||l.call(w,f.status);return}const x=gt(f);if(b===q){const I=f.getResponseHeader("Content-Range"),Q=/bytes (\d+)-(\d+)\/(\d+)/.exec(I);w.onDone({begin:parseInt(Q[1],10),chunk:x})}else x?w.onDone({begin:0,chunk:x}):(h=w.onError)==null||h.call(w,f.status)}getRequestXhr(L){return this.pendingRequests[L].xhr}isPendingRequest(L){return L in this.pendingRequests}abortRequest(L){const E=this.pendingRequests[L].xhr;delete this.pendingRequests[L],E.abort()}}class F{constructor(L){this._source=L,this._manager=new z(L.url,{httpHeaders:L.httpHeaders,withCredentials:L.withCredentials}),this._rangeChunkSize=L.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(L){const E=this._rangeRequestReaders.indexOf(L);E>=0&&this._rangeRequestReaders.splice(E,1)}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new g(this._manager,this._source),this._fullRequestReader}getRangeReader(L,E){const w=new H(this._manager,L,E);return w.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(w),w}cancelAllRequests(L){var E;(E=this._fullRequestReader)==null||E.cancel(L);for(const w of this._rangeRequestReaders.slice(0))w.cancel(L)}}o.PDFNetworkStream=F;class g{constructor(L,E){this._manager=L;const w={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=E.url,this._fullRequestId=L.requestFull(w),this._headersReceivedCapability=new n.PromiseCapability,this._disableRange=E.disableRange||!1,this._contentLength=E.length,this._rangeChunkSize=E.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const L=this._fullRequestId,E=this._manager.getRequestXhr(L),w=k=>E.getResponseHeader(k),{allowRangeRequests:f,suggestedLength:b}=(0,P.validateRangeRequestCapabilities)({getResponseHeader:w,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});f&&(this._isRangeSupported=!0),this._contentLength=b||this._contentLength,this._filename=(0,P.extractFilenameFromHeader)(w),this._isRangeSupported&&this._manager.abortRequest(L),this._headersReceivedCapability.resolve()}_onDone(L){if(L&&(this._requests.length>0?this._requests.shift().resolve({value:L.chunk,done:!1}):this._cachedChunks.push(L.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const E of this._requests)E.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(L){this._storedError=(0,P.createResponseStatusError)(L,this._url),this._headersReceivedCapability.reject(this._storedError);for(const E of this._requests)E.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(L){var E;(E=this.onProgress)==null||E.call(this,{loaded:L.loaded,total:L.lengthComputable?L.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const L=new n.PromiseCapability;return this._requests.push(L),L.promise}cancel(L){this._done=!0,this._headersReceivedCapability.reject(L);for(const E of this._requests)E.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class H{constructor(L,E,w){this._manager=L;const f={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=L.url,this._requestId=L.requestRange(E,w,f),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var L;(L=this.onClosed)==null||L.call(this,this)}_onDone(L){const E=L.chunk;this._requests.length>0?this._requests.shift().resolve({value:E,done:!1}):this._queuedChunk=E,this._done=!0;for(const w of this._requests)w.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(L){this._storedError=(0,P.createResponseStatusError)(L,this._url);for(const E of this._requests)E.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(L){var E;this.isStreamingSupported||(E=this.onProgress)==null||E.call(this,{loaded:L.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const E=this._queuedChunk;return this._queuedChunk=null,{value:E,done:!1}}if(this._done)return{value:void 0,done:!0};const L=new n.PromiseCapability;return this._requests.push(L),L.promise}cancel(L){this._done=!0;for(const E of this._requests)E.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(U,o,K)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.PDFNodeStream=void 0;var n=K(1),P=K(20);const V=/^file:\/\/\/[a-zA-Z]:\//;function q(w){const f=_e,b=f.parse(w);return b.protocol==="file:"||b.host?b:/^[a-z]:[/\\]/i.test(w)?f.parse(`file:///${w}`):(b.host||(b.protocol="file:"),b)}class gt{constructor(f){this.source=f,this.url=q(f.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&f.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var f;return((f=this._fullRequestReader)==null?void 0:f._loaded)??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new L(this):new H(this),this._fullRequestReader}getRangeReader(f,b){if(b<=this._progressiveDataLength)return null;const k=this.isFsUrl?new E(this,f,b):new W(this,f,b);return this._rangeRequestReaders.push(k),k}cancelAllRequests(f){var b;(b=this._fullRequestReader)==null||b.cancel(f);for(const k of this._rangeRequestReaders.slice(0))k.cancel(f)}}o.PDFNodeStream=gt;class z{constructor(f){this._url=f.url,this._done=!1,this._storedError=null,this.onProgress=null;const b=f.source;this._contentLength=b.length,this._loaded=0,this._filename=null,this._disableRange=b.disableRange||!1,this._rangeChunkSize=b.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!b.disableStream,this._isRangeSupported=!b.disableRange,this._readableStream=null,this._readCapability=new n.PromiseCapability,this._headersCapability=new n.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var k;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const f=this._readableStream.read();return f===null?(this._readCapability=new n.PromiseCapability,this.read()):(this._loaded+=f.length,(k=this.onProgress)==null||k.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(f).buffer,done:!1})}cancel(f){if(!this._readableStream){this._error(f);return}this._readableStream.destroy(f)}_error(f){this._storedError=f,this._readCapability.resolve()}_setReadableStream(f){this._readableStream=f,f.on("readable",()=>{this._readCapability.resolve()}),f.on("end",()=>{f.destroy(),this._done=!0,this._readCapability.resolve()}),f.on("error",b=>{this._error(b)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new n.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class F{constructor(f){this._url=f.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new n.PromiseCapability;const b=f.source;this._isStreamingSupported=!b.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var k;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const f=this._readableStream.read();return f===null?(this._readCapability=new n.PromiseCapability,this.read()):(this._loaded+=f.length,(k=this.onProgress)==null||k.call(this,{loaded:this._loaded}),{value:new Uint8Array(f).buffer,done:!1})}cancel(f){if(!this._readableStream){this._error(f);return}this._readableStream.destroy(f)}_error(f){this._storedError=f,this._readCapability.resolve()}_setReadableStream(f){this._readableStream=f,f.on("readable",()=>{this._readCapability.resolve()}),f.on("end",()=>{f.destroy(),this._done=!0,this._readCapability.resolve()}),f.on("error",b=>{this._error(b)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function g(w,f){return{protocol:w.protocol,auth:w.auth,host:w.hostname,port:w.port,path:w.path,method:"GET",headers:f}}class H extends z{constructor(f){super(f);const b=k=>{if(k.statusCode===404){const h=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=h,this._headersCapability.reject(h);return}this._headersCapability.resolve(),this._setReadableStream(k);const x=h=>this._readableStream.headers[h.toLowerCase()],{allowRangeRequests:y,suggestedLength:l}=(0,P.validateRangeRequestCapabilities)({getResponseHeader:x,isHttp:f.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=y,this._contentLength=l||this._contentLength,this._filename=(0,P.extractFilenameFromHeader)(x)};if(this._request=null,this._url.protocol==="http:"){const k=_e;this._request=k.request(g(this._url,f.httpHeaders),b)}else{const k=_e;this._request=k.request(g(this._url,f.httpHeaders),b)}this._request.on("error",k=>{this._storedError=k,this._headersCapability.reject(k)}),this._request.end()}}class W extends F{constructor(f,b,k){super(f),this._httpHeaders={};for(const y in f.httpHeaders){const l=f.httpHeaders[y];l!==void 0&&(this._httpHeaders[y]=l)}this._httpHeaders.Range=`bytes=${b}-${k-1}`;const x=y=>{if(y.statusCode===404){const l=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=l;return}this._setReadableStream(y)};if(this._request=null,this._url.protocol==="http:"){const y=_e;this._request=y.request(g(this._url,this._httpHeaders),x)}else{const y=_e;this._request=y.request(g(this._url,this._httpHeaders),x)}this._request.on("error",y=>{this._storedError=y}),this._request.end()}}class L extends z{constructor(f){super(f);let b=decodeURIComponent(this._url.path);V.test(this._url.href)&&(b=b.replace(/^\//,""));const k=_e;k.lstat(b,(x,y)=>{if(x){x.code==="ENOENT"&&(x=new n.MissingPDFException(`Missing PDF "${b}".`)),this._storedError=x,this._headersCapability.reject(x);return}this._contentLength=y.size,this._setReadableStream(k.createReadStream(b)),this._headersCapability.resolve()})}}class E extends F{constructor(f,b,k){super(f);let x=decodeURIComponent(this._url.path);V.test(this._url.href)&&(x=x.replace(/^\//,""));const y=_e;this._setReadableStream(y.createReadStream(x,{start:b,end:k-1}))}}},(U,o,K)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.SVGGraphics=void 0;var n=K(6),P=K(1);const V={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},q="http://www.w3.org/XML/1998/namespace",gt="http://www.w3.org/1999/xlink",z=["butt","round","square"],F=["miter","round","bevel"],g=function(y,l="",h=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!h)return URL.createObjectURL(new Blob([y],{type:l}));const I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let Q=`data:${l};base64,`;for(let J=0,_t=y.length;J<_t;J+=3){const at=y[J]&255,xt=y[J+1]&255,Ct=y[J+2]&255,j=at>>2,ut=(at&3)<<4|xt>>4,Et=J+1<_t?(xt&15)<<2|Ct>>6:64,yt=J+2<_t?Ct&63:64;Q+=I[j]+I[ut]+I[Et]+I[yt]}return Q},H=function(){const y=new Uint8Array([137,80,78,71,13,10,26,10]),l=12,h=new Int32Array(256);for(let Ct=0;Ct<256;Ct++){let j=Ct;for(let ut=0;ut<8;ut++)j=j&1?3988292384^j>>1&2147483647:j>>1&2147483647;h[Ct]=j}function I(Ct,j,ut){let Et=-1;for(let yt=j;yt<ut;yt++){const et=(Et^Ct[yt])&255,bt=h[et];Et=Et>>>8^bt}return Et^-1}function Q(Ct,j,ut,Et){let yt=Et;const et=j.length;ut[yt]=et>>24&255,ut[yt+1]=et>>16&255,ut[yt+2]=et>>8&255,ut[yt+3]=et&255,yt+=4,ut[yt]=Ct.charCodeAt(0)&255,ut[yt+1]=Ct.charCodeAt(1)&255,ut[yt+2]=Ct.charCodeAt(2)&255,ut[yt+3]=Ct.charCodeAt(3)&255,yt+=4,ut.set(j,yt),yt+=j.length;const bt=I(ut,Et+4,yt);ut[yt]=bt>>24&255,ut[yt+1]=bt>>16&255,ut[yt+2]=bt>>8&255,ut[yt+3]=bt&255}function J(Ct,j,ut){let Et=1,yt=0;for(let et=j;et<ut;++et)Et=(Et+(Ct[et]&255))%65521,yt=(yt+Et)%65521;return yt<<16|Et}function _t(Ct){if(!P.isNodeJS)return at(Ct);try{const j=parseInt(process.versions.node)>=8?Ct:Buffer.from(Ct),ut=_e.deflateSync(j,{level:9});return ut instanceof Uint8Array?ut:new Uint8Array(ut)}catch(j){(0,P.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+j)}return at(Ct)}function at(Ct){let j=Ct.length;const ut=65535,Et=Math.ceil(j/ut),yt=new Uint8Array(2+j+Et*5+4);let et=0;yt[et++]=120,yt[et++]=156;let bt=0;for(;j>ut;)yt[et++]=0,yt[et++]=255,yt[et++]=255,yt[et++]=0,yt[et++]=0,yt.set(Ct.subarray(bt,bt+ut),et),et+=ut,bt+=ut,j-=ut;yt[et++]=1,yt[et++]=j&255,yt[et++]=j>>8&255,yt[et++]=~j&65535&255,yt[et++]=(~j&65535)>>8&255,yt.set(Ct.subarray(bt),et),et+=Ct.length-bt;const Rt=J(Ct,0,Ct.length);return yt[et++]=Rt>>24&255,yt[et++]=Rt>>16&255,yt[et++]=Rt>>8&255,yt[et++]=Rt&255,yt}function xt(Ct,j,ut,Et){const yt=Ct.width,et=Ct.height;let bt,Rt,Ut;const $t=Ct.data;switch(j){case P.ImageKind.GRAYSCALE_1BPP:Rt=0,bt=1,Ut=yt+7>>3;break;case P.ImageKind.RGB_24BPP:Rt=2,bt=8,Ut=yt*3;break;case P.ImageKind.RGBA_32BPP:Rt=6,bt=8,Ut=yt*4;break;default:throw new Error("invalid format")}const T=new Uint8Array((1+Ut)*et);let i=0,r=0;for(let B=0;B<et;++B)T[i++]=0,T.set($t.subarray(r,r+Ut),i),r+=Ut,i+=Ut;if(j===P.ImageKind.GRAYSCALE_1BPP&&Et){i=0;for(let B=0;B<et;B++){i++;for(let lt=0;lt<Ut;lt++)T[i++]^=255}}const s=new Uint8Array([yt>>24&255,yt>>16&255,yt>>8&255,yt&255,et>>24&255,et>>16&255,et>>8&255,et&255,bt,Rt,0,0,0]),c=_t(T),d=y.length+l*3+s.length+c.length,m=new Uint8Array(d);let M=0;return m.set(y,M),M+=y.length,Q("IHDR",s,m,M),M+=l+s.length,Q("IDATA",c,m,M),M+=l+c.length,Q("IEND",new Uint8Array(0),m,M),g(m,"image/png",ut)}return function(j,ut,Et){const yt=j.kind===void 0?P.ImageKind.GRAYSCALE_1BPP:j.kind;return xt(j,yt,ut,Et)}}();class W{constructor(){this.fontSizeScale=1,this.fontWeight=V.fontWeight,this.fontSize=0,this.textMatrix=P.IDENTITY_MATRIX,this.fontMatrix=P.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=P.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=V.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(l,h){this.x=l,this.y=h}}function L(y){let l=[];const h=[];for(const I of y){if(I.fn==="save"){l.push({fnId:92,fn:"group",items:[]}),h.push(l),l=l.at(-1).items;continue}I.fn==="restore"?l=h.pop():l.push(I)}return l}function E(y){if(Number.isInteger(y))return y.toString();const l=y.toFixed(10);let h=l.length-1;if(l[h]!=="0")return l;do h--;while(l[h]==="0");return l.substring(0,l[h]==="."?h:h+1)}function w(y){if(y[4]===0&&y[5]===0){if(y[1]===0&&y[2]===0)return y[0]===1&&y[3]===1?"":`scale(${E(y[0])} ${E(y[3])})`;if(y[0]===y[3]&&y[1]===-y[2]){const l=Math.acos(y[0])*180/Math.PI;return`rotate(${E(l)})`}}else if(y[0]===1&&y[1]===0&&y[2]===0&&y[3]===1)return`translate(${E(y[4])} ${E(y[5])})`;return`matrix(${E(y[0])} ${E(y[1])} ${E(y[2])} ${E(y[3])} ${E(y[4])} ${E(y[5])})`}let f=0,b=0,k=0;class x{constructor(l,h,I=!1){(0,n.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new n.DOMSVGFactory,this.current=new W,this.transformMatrix=P.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=l,this.objs=h,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!I,this._operatorIdMapping=[];for(const Q in P.OPS)this._operatorIdMapping[P.OPS[Q]]=Q}getObject(l,h=null){return typeof l=="string"?l.startsWith("g_")?this.commonObjs.get(l):this.objs.get(l):h}save(){this.transformStack.push(this.transformMatrix);const l=this.current;this.extraStack.push(l),this.current=l.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(l){this.save(),this.executeOpTree(l),this.restore()}loadDependencies(l){const h=l.fnArray,I=l.argsArray;for(let Q=0,J=h.length;Q<J;Q++)if(h[Q]===P.OPS.dependency)for(const _t of I[Q]){const at=_t.startsWith("g_")?this.commonObjs:this.objs,xt=new Promise(Ct=>{at.get(_t,Ct)});this.current.dependencies.push(xt)}return Promise.all(this.current.dependencies)}transform(l,h,I,Q,J,_t){const at=[l,h,I,Q,J,_t];this.transformMatrix=P.Util.transform(this.transformMatrix,at),this.tgrp=null}getSVG(l,h){this.viewport=h;const I=this._initialize(h);return this.loadDependencies(l).then(()=>(this.transformMatrix=P.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(l)),I))}convertOpList(l){const h=this._operatorIdMapping,I=l.argsArray,Q=l.fnArray,J=[];for(let _t=0,at=Q.length;_t<at;_t++){const xt=Q[_t];J.push({fnId:xt,fn:h[xt],args:I[_t]})}return L(J)}executeOpTree(l){for(const h of l){const I=h.fn,Q=h.fnId,J=h.args;switch(Q|0){case P.OPS.beginText:this.beginText();break;case P.OPS.dependency:break;case P.OPS.setLeading:this.setLeading(J);break;case P.OPS.setLeadingMoveText:this.setLeadingMoveText(J[0],J[1]);break;case P.OPS.setFont:this.setFont(J);break;case P.OPS.showText:this.showText(J[0]);break;case P.OPS.showSpacedText:this.showText(J[0]);break;case P.OPS.endText:this.endText();break;case P.OPS.moveText:this.moveText(J[0],J[1]);break;case P.OPS.setCharSpacing:this.setCharSpacing(J[0]);break;case P.OPS.setWordSpacing:this.setWordSpacing(J[0]);break;case P.OPS.setHScale:this.setHScale(J[0]);break;case P.OPS.setTextMatrix:this.setTextMatrix(J[0],J[1],J[2],J[3],J[4],J[5]);break;case P.OPS.setTextRise:this.setTextRise(J[0]);break;case P.OPS.setTextRenderingMode:this.setTextRenderingMode(J[0]);break;case P.OPS.setLineWidth:this.setLineWidth(J[0]);break;case P.OPS.setLineJoin:this.setLineJoin(J[0]);break;case P.OPS.setLineCap:this.setLineCap(J[0]);break;case P.OPS.setMiterLimit:this.setMiterLimit(J[0]);break;case P.OPS.setFillRGBColor:this.setFillRGBColor(J[0],J[1],J[2]);break;case P.OPS.setStrokeRGBColor:this.setStrokeRGBColor(J[0],J[1],J[2]);break;case P.OPS.setStrokeColorN:this.setStrokeColorN(J);break;case P.OPS.setFillColorN:this.setFillColorN(J);break;case P.OPS.shadingFill:this.shadingFill(J[0]);break;case P.OPS.setDash:this.setDash(J[0],J[1]);break;case P.OPS.setRenderingIntent:this.setRenderingIntent(J[0]);break;case P.OPS.setFlatness:this.setFlatness(J[0]);break;case P.OPS.setGState:this.setGState(J[0]);break;case P.OPS.fill:this.fill();break;case P.OPS.eoFill:this.eoFill();break;case P.OPS.stroke:this.stroke();break;case P.OPS.fillStroke:this.fillStroke();break;case P.OPS.eoFillStroke:this.eoFillStroke();break;case P.OPS.clip:this.clip("nonzero");break;case P.OPS.eoClip:this.clip("evenodd");break;case P.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case P.OPS.paintImageXObject:this.paintImageXObject(J[0]);break;case P.OPS.paintInlineImageXObject:this.paintInlineImageXObject(J[0]);break;case P.OPS.paintImageMaskXObject:this.paintImageMaskXObject(J[0]);break;case P.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(J[0],J[1]);break;case P.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case P.OPS.closePath:this.closePath();break;case P.OPS.closeStroke:this.closeStroke();break;case P.OPS.closeFillStroke:this.closeFillStroke();break;case P.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case P.OPS.nextLine:this.nextLine();break;case P.OPS.transform:this.transform(J[0],J[1],J[2],J[3],J[4],J[5]);break;case P.OPS.constructPath:this.constructPath(J[0],J[1]);break;case P.OPS.endPath:this.endPath();break;case 92:this.group(h.items);break;default:(0,P.warn)(`Unimplemented operator ${I}`);break}}}setWordSpacing(l){this.current.wordSpacing=l}setCharSpacing(l){this.current.charSpacing=l}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(l,h,I,Q,J,_t){const at=this.current;at.textMatrix=at.lineMatrix=[l,h,I,Q,J,_t],at.textMatrixScale=Math.hypot(l,h),at.x=at.lineX=0,at.y=at.lineY=0,at.xcoords=[],at.ycoords=[],at.tspan=this.svgFactory.createElement("svg:tspan"),at.tspan.setAttributeNS(null,"font-family",at.fontFamily),at.tspan.setAttributeNS(null,"font-size",`${E(at.fontSize)}px`),at.tspan.setAttributeNS(null,"y",E(-at.y)),at.txtElement=this.svgFactory.createElement("svg:text"),at.txtElement.append(at.tspan)}beginText(){const l=this.current;l.x=l.lineX=0,l.y=l.lineY=0,l.textMatrix=P.IDENTITY_MATRIX,l.lineMatrix=P.IDENTITY_MATRIX,l.textMatrixScale=1,l.tspan=this.svgFactory.createElement("svg:tspan"),l.txtElement=this.svgFactory.createElement("svg:text"),l.txtgrp=this.svgFactory.createElement("svg:g"),l.xcoords=[],l.ycoords=[]}moveText(l,h){const I=this.current;I.x=I.lineX+=l,I.y=I.lineY+=h,I.xcoords=[],I.ycoords=[],I.tspan=this.svgFactory.createElement("svg:tspan"),I.tspan.setAttributeNS(null,"font-family",I.fontFamily),I.tspan.setAttributeNS(null,"font-size",`${E(I.fontSize)}px`),I.tspan.setAttributeNS(null,"y",E(-I.y))}showText(l){const h=this.current,I=h.font,Q=h.fontSize;if(Q===0)return;const J=h.fontSizeScale,_t=h.charSpacing,at=h.wordSpacing,xt=h.fontDirection,Ct=h.textHScale*xt,j=I.vertical,ut=j?1:-1,Et=I.defaultVMetrics,yt=Q*h.fontMatrix[0];let et=0;for(const Ut of l){if(Ut===null){et+=xt*at;continue}else if(typeof Ut=="number"){et+=ut*Ut*Q/1e3;continue}const $t=(Ut.isSpace?at:0)+_t,T=Ut.fontChar;let i,r,s=Ut.width;if(j){let d;const m=Ut.vmetric||Et;d=Ut.vmetric?m[1]:s*.5,d=-d*yt;const M=m[2]*yt;s=m?-m[0]:s,i=d/J,r=(et+M)/J}else i=et/J,r=0;(Ut.isInFont||I.missingFile)&&(h.xcoords.push(h.x+i),j&&h.ycoords.push(-h.y+r),h.tspan.textContent+=T);const c=j?s*yt-$t*xt:s*yt+$t*xt;et+=c}h.tspan.setAttributeNS(null,"x",h.xcoords.map(E).join(" ")),j?h.tspan.setAttributeNS(null,"y",h.ycoords.map(E).join(" ")):h.tspan.setAttributeNS(null,"y",E(-h.y)),j?h.y-=et:h.x+=et*Ct,h.tspan.setAttributeNS(null,"font-family",h.fontFamily),h.tspan.setAttributeNS(null,"font-size",`${E(h.fontSize)}px`),h.fontStyle!==V.fontStyle&&h.tspan.setAttributeNS(null,"font-style",h.fontStyle),h.fontWeight!==V.fontWeight&&h.tspan.setAttributeNS(null,"font-weight",h.fontWeight);const bt=h.textRenderingMode&P.TextRenderingMode.FILL_STROKE_MASK;if(bt===P.TextRenderingMode.FILL||bt===P.TextRenderingMode.FILL_STROKE?(h.fillColor!==V.fillColor&&h.tspan.setAttributeNS(null,"fill",h.fillColor),h.fillAlpha<1&&h.tspan.setAttributeNS(null,"fill-opacity",h.fillAlpha)):h.textRenderingMode===P.TextRenderingMode.ADD_TO_PATH?h.tspan.setAttributeNS(null,"fill","transparent"):h.tspan.setAttributeNS(null,"fill","none"),bt===P.TextRenderingMode.STROKE||bt===P.TextRenderingMode.FILL_STROKE){const Ut=1/(h.textMatrixScale||1);this._setStrokeAttributes(h.tspan,Ut)}let Rt=h.textMatrix;h.textRise!==0&&(Rt=Rt.slice(),Rt[5]+=h.textRise),h.txtElement.setAttributeNS(null,"transform",`${w(Rt)} scale(${E(Ct)}, -1)`),h.txtElement.setAttributeNS(q,"xml:space","preserve"),h.txtElement.append(h.tspan),h.txtgrp.append(h.txtElement),this._ensureTransformGroup().append(h.txtElement)}setLeadingMoveText(l,h){this.setLeading(-h),this.moveText(l,h)}addFontStyle(l){if(!l.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const h=g(l.data,l.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${l.loadedName}"; src: url(${h}); }
`}setFont(l){const h=this.current,I=this.commonObjs.get(l[0]);let Q=l[1];h.font=I,this.embedFonts&&!I.missingFile&&!this.embeddedFonts[I.loadedName]&&(this.addFontStyle(I),this.embeddedFonts[I.loadedName]=I),h.fontMatrix=I.fontMatrix||P.FONT_IDENTITY_MATRIX;let J="normal";I.black?J="900":I.bold&&(J="bold");const _t=I.italic?"italic":"normal";Q<0?(Q=-Q,h.fontDirection=-1):h.fontDirection=1,h.fontSize=Q,h.fontFamily=I.loadedName,h.fontWeight=J,h.fontStyle=_t,h.tspan=this.svgFactory.createElement("svg:tspan"),h.tspan.setAttributeNS(null,"y",E(-h.y)),h.xcoords=[],h.ycoords=[]}endText(){var h;const l=this.current;l.textRenderingMode&P.TextRenderingMode.ADD_TO_PATH_FLAG&&((h=l.txtElement)!=null&&h.hasChildNodes())&&(l.element=l.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(l){l>0&&(this.current.lineWidth=l)}setLineCap(l){this.current.lineCap=z[l]}setLineJoin(l){this.current.lineJoin=F[l]}setMiterLimit(l){this.current.miterLimit=l}setStrokeAlpha(l){this.current.strokeAlpha=l}setStrokeRGBColor(l,h,I){this.current.strokeColor=P.Util.makeHexColor(l,h,I)}setFillAlpha(l){this.current.fillAlpha=l}setFillRGBColor(l,h,I){this.current.fillColor=P.Util.makeHexColor(l,h,I),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(l){this.current.strokeColor=this._makeColorN_Pattern(l)}setFillColorN(l){this.current.fillColor=this._makeColorN_Pattern(l)}shadingFill(l){const{width:h,height:I}=this.viewport,Q=P.Util.inverseTransform(this.transformMatrix),[J,_t,at,xt]=P.Util.getAxialAlignedBoundingBox([0,0,h,I],Q),Ct=this.svgFactory.createElement("svg:rect");Ct.setAttributeNS(null,"x",J),Ct.setAttributeNS(null,"y",_t),Ct.setAttributeNS(null,"width",at-J),Ct.setAttributeNS(null,"height",xt-_t),Ct.setAttributeNS(null,"fill",this._makeShadingPattern(l)),this.current.fillAlpha<1&&Ct.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(Ct)}_makeColorN_Pattern(l){return l[0]==="TilingPattern"?this._makeTilingPattern(l):this._makeShadingPattern(l)}_makeTilingPattern(l){const h=l[1],I=l[2],Q=l[3]||P.IDENTITY_MATRIX,[J,_t,at,xt]=l[4],Ct=l[5],j=l[6],ut=l[7],Et=`shading${k++}`,[yt,et,bt,Rt]=P.Util.normalizeRect([...P.Util.applyTransform([J,_t],Q),...P.Util.applyTransform([at,xt],Q)]),[Ut,$t]=P.Util.singularValueDecompose2dScale(Q),T=Ct*Ut,i=j*$t,r=this.svgFactory.createElement("svg:pattern");r.setAttributeNS(null,"id",Et),r.setAttributeNS(null,"patternUnits","userSpaceOnUse"),r.setAttributeNS(null,"width",T),r.setAttributeNS(null,"height",i),r.setAttributeNS(null,"x",`${yt}`),r.setAttributeNS(null,"y",`${et}`);const s=this.svg,c=this.transformMatrix,d=this.current.fillColor,m=this.current.strokeColor,M=this.svgFactory.create(bt-yt,Rt-et);if(this.svg=M,this.transformMatrix=Q,ut===2){const B=P.Util.makeHexColor(...h);this.current.fillColor=B,this.current.strokeColor=B}return this.executeOpTree(this.convertOpList(I)),this.svg=s,this.transformMatrix=c,this.current.fillColor=d,this.current.strokeColor=m,r.append(M.childNodes[0]),this.defs.append(r),`url(#${Et})`}_makeShadingPattern(l){switch(typeof l=="string"&&(l=this.objs.get(l)),l[0]){case"RadialAxial":const h=`shading${k++}`,I=l[3];let Q;switch(l[1]){case"axial":const J=l[4],_t=l[5];Q=this.svgFactory.createElement("svg:linearGradient"),Q.setAttributeNS(null,"id",h),Q.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),Q.setAttributeNS(null,"x1",J[0]),Q.setAttributeNS(null,"y1",J[1]),Q.setAttributeNS(null,"x2",_t[0]),Q.setAttributeNS(null,"y2",_t[1]);break;case"radial":const at=l[4],xt=l[5],Ct=l[6],j=l[7];Q=this.svgFactory.createElement("svg:radialGradient"),Q.setAttributeNS(null,"id",h),Q.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),Q.setAttributeNS(null,"cx",xt[0]),Q.setAttributeNS(null,"cy",xt[1]),Q.setAttributeNS(null,"r",j),Q.setAttributeNS(null,"fx",at[0]),Q.setAttributeNS(null,"fy",at[1]),Q.setAttributeNS(null,"fr",Ct);break;default:throw new Error(`Unknown RadialAxial type: ${l[1]}`)}for(const J of I){const _t=this.svgFactory.createElement("svg:stop");_t.setAttributeNS(null,"offset",J[0]),_t.setAttributeNS(null,"stop-color",J[1]),Q.append(_t)}return this.defs.append(Q),`url(#${h})`;case"Mesh":return(0,P.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${l[0]}`)}}setDash(l,h){this.current.dashArray=l,this.current.dashPhase=h}constructPath(l,h){const I=this.current;let Q=I.x,J=I.y,_t=[],at=0;for(const xt of l)switch(xt|0){case P.OPS.rectangle:Q=h[at++],J=h[at++];const Ct=h[at++],j=h[at++],ut=Q+Ct,Et=J+j;_t.push("M",E(Q),E(J),"L",E(ut),E(J),"L",E(ut),E(Et),"L",E(Q),E(Et),"Z");break;case P.OPS.moveTo:Q=h[at++],J=h[at++],_t.push("M",E(Q),E(J));break;case P.OPS.lineTo:Q=h[at++],J=h[at++],_t.push("L",E(Q),E(J));break;case P.OPS.curveTo:Q=h[at+4],J=h[at+5],_t.push("C",E(h[at]),E(h[at+1]),E(h[at+2]),E(h[at+3]),E(Q),E(J)),at+=6;break;case P.OPS.curveTo2:_t.push("C",E(Q),E(J),E(h[at]),E(h[at+1]),E(h[at+2]),E(h[at+3])),Q=h[at+2],J=h[at+3],at+=4;break;case P.OPS.curveTo3:Q=h[at+2],J=h[at+3],_t.push("C",E(h[at]),E(h[at+1]),E(Q),E(J),E(Q),E(J)),at+=4;break;case P.OPS.closePath:_t.push("Z");break}_t=_t.join(" "),I.path&&l.length>0&&l[0]!==P.OPS.rectangle&&l[0]!==P.OPS.moveTo?_t=I.path.getAttributeNS(null,"d")+_t:(I.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(I.path)),I.path.setAttributeNS(null,"d",_t),I.path.setAttributeNS(null,"fill","none"),I.element=I.path,I.setCurrentPoint(Q,J)}endPath(){const l=this.current;if(l.path=null,!this.pendingClip)return;if(!l.element){this.pendingClip=null;return}const h=`clippath${f++}`,I=this.svgFactory.createElement("svg:clipPath");I.setAttributeNS(null,"id",h),I.setAttributeNS(null,"transform",w(this.transformMatrix));const Q=l.element.cloneNode(!0);if(this.pendingClip==="evenodd"?Q.setAttributeNS(null,"clip-rule","evenodd"):Q.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,I.append(Q),this.defs.append(I),l.activeClipUrl){l.clipGroup=null;for(const J of this.extraStack)J.clipGroup=null;I.setAttributeNS(null,"clip-path",l.activeClipUrl)}l.activeClipUrl=`url(#${h})`,this.tgrp=null}clip(l){this.pendingClip=l}closePath(){const l=this.current;if(l.path){const h=`${l.path.getAttributeNS(null,"d")}Z`;l.path.setAttributeNS(null,"d",h)}}setLeading(l){this.current.leading=-l}setTextRise(l){this.current.textRise=l}setTextRenderingMode(l){this.current.textRenderingMode=l}setHScale(l){this.current.textHScale=l/100}setRenderingIntent(l){}setFlatness(l){}setGState(l){for(const[h,I]of l)switch(h){case"LW":this.setLineWidth(I);break;case"LC":this.setLineCap(I);break;case"LJ":this.setLineJoin(I);break;case"ML":this.setMiterLimit(I);break;case"D":this.setDash(I[0],I[1]);break;case"RI":this.setRenderingIntent(I);break;case"FL":this.setFlatness(I);break;case"Font":this.setFont(I);break;case"CA":this.setStrokeAlpha(I);break;case"ca":this.setFillAlpha(I);break;default:(0,P.warn)(`Unimplemented graphic state operator ${h}`);break}}fill(){const l=this.current;l.element&&(l.element.setAttributeNS(null,"fill",l.fillColor),l.element.setAttributeNS(null,"fill-opacity",l.fillAlpha),this.endPath())}stroke(){const l=this.current;l.element&&(this._setStrokeAttributes(l.element),l.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(l,h=1){const I=this.current;let Q=I.dashArray;h!==1&&Q.length>0&&(Q=Q.map(function(J){return h*J})),l.setAttributeNS(null,"stroke",I.strokeColor),l.setAttributeNS(null,"stroke-opacity",I.strokeAlpha),l.setAttributeNS(null,"stroke-miterlimit",E(I.miterLimit)),l.setAttributeNS(null,"stroke-linecap",I.lineCap),l.setAttributeNS(null,"stroke-linejoin",I.lineJoin),l.setAttributeNS(null,"stroke-width",E(h*I.lineWidth)+"px"),l.setAttributeNS(null,"stroke-dasharray",Q.map(E).join(" ")),l.setAttributeNS(null,"stroke-dashoffset",E(h*I.dashPhase)+"px")}eoFill(){var l;(l=this.current.element)==null||l.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var l;(l=this.current.element)==null||l.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const l=this.svgFactory.createElement("svg:rect");l.setAttributeNS(null,"x","0"),l.setAttributeNS(null,"y","0"),l.setAttributeNS(null,"width","1px"),l.setAttributeNS(null,"height","1px"),l.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(l)}paintImageXObject(l){const h=this.getObject(l);if(!h){(0,P.warn)(`Dependent image with object ID ${l} is not ready yet`);return}this.paintInlineImageXObject(h)}paintInlineImageXObject(l,h){const I=l.width,Q=l.height,J=H(l,this.forceDataSchema,!!h),_t=this.svgFactory.createElement("svg:rect");_t.setAttributeNS(null,"x","0"),_t.setAttributeNS(null,"y","0"),_t.setAttributeNS(null,"width",E(I)),_t.setAttributeNS(null,"height",E(Q)),this.current.element=_t,this.clip("nonzero");const at=this.svgFactory.createElement("svg:image");at.setAttributeNS(gt,"xlink:href",J),at.setAttributeNS(null,"x","0"),at.setAttributeNS(null,"y",E(-Q)),at.setAttributeNS(null,"width",E(I)+"px"),at.setAttributeNS(null,"height",E(Q)+"px"),at.setAttributeNS(null,"transform",`scale(${E(1/I)} ${E(-1/Q)})`),h?h.append(at):this._ensureTransformGroup().append(at)}paintImageMaskXObject(l){const h=this.getObject(l.data,l);if(h.bitmap){(0,P.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const I=this.current,Q=h.width,J=h.height,_t=I.fillColor;I.maskId=`mask${b++}`;const at=this.svgFactory.createElement("svg:mask");at.setAttributeNS(null,"id",I.maskId);const xt=this.svgFactory.createElement("svg:rect");xt.setAttributeNS(null,"x","0"),xt.setAttributeNS(null,"y","0"),xt.setAttributeNS(null,"width",E(Q)),xt.setAttributeNS(null,"height",E(J)),xt.setAttributeNS(null,"fill",_t),xt.setAttributeNS(null,"mask",`url(#${I.maskId})`),this.defs.append(at),this._ensureTransformGroup().append(xt),this.paintInlineImageXObject(h,at)}paintFormXObjectBegin(l,h){if(Array.isArray(l)&&l.length===6&&this.transform(l[0],l[1],l[2],l[3],l[4],l[5]),h){const I=h[2]-h[0],Q=h[3]-h[1],J=this.svgFactory.createElement("svg:rect");J.setAttributeNS(null,"x",h[0]),J.setAttributeNS(null,"y",h[1]),J.setAttributeNS(null,"width",E(I)),J.setAttributeNS(null,"height",E(Q)),this.current.element=J,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(l){const h=this.svgFactory.create(l.width,l.height),I=this.svgFactory.createElement("svg:defs");h.append(I),this.defs=I;const Q=this.svgFactory.createElement("svg:g");return Q.setAttributeNS(null,"transform",w(l.transform)),h.append(Q),this.svg=Q,h}_ensureClipGroup(){if(!this.current.clipGroup){const l=this.svgFactory.createElement("svg:g");l.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(l),this.current.clipGroup=l}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",w(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}o.SVGGraphics=x},(U,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.XfaText=void 0;class K{static textContent(P){const V=[],q={items:V,styles:Object.create(null)};function gt(z){var H;if(!z)return;let F=null;const g=z.name;if(g==="#text")F=z.value;else if(K.shouldBuildText(g))(H=z==null?void 0:z.attributes)!=null&&H.textContent?F=z.attributes.textContent:z.value&&(F=z.value);else return;if(F!==null&&V.push({str:F}),!!z.children)for(const W of z.children)gt(W)}return gt(P),q}static shouldBuildText(P){return!(P==="textarea"||P==="input"||P==="option"||P==="select")}}o.XfaText=K},(U,o,K)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.TextLayerRenderTask=void 0,o.renderTextLayer=w,o.updateTextLayer=f;var n=K(1),P=K(6);const V=1e5,q=30,gt=.8,z=new Map;function F(b,k){let x;if(k&&n.FeatureTest.isOffscreenCanvasSupported)x=new OffscreenCanvas(b,b).getContext("2d",{alpha:!1});else{const y=document.createElement("canvas");y.width=y.height=b,x=y.getContext("2d",{alpha:!1})}return x}function g(b,k){const x=z.get(b);if(x)return x;const y=F(q,k);y.font=`${q}px ${b}`;const l=y.measureText("");let h=l.fontBoundingBoxAscent,I=Math.abs(l.fontBoundingBoxDescent);if(h){const J=h/(h+I);return z.set(b,J),y.canvas.width=y.canvas.height=0,J}y.strokeStyle="red",y.clearRect(0,0,q,q),y.strokeText("g",0,0);let Q=y.getImageData(0,0,q,q).data;I=0;for(let J=Q.length-1-3;J>=0;J-=4)if(Q[J]>0){I=Math.ceil(J/4/q);break}y.clearRect(0,0,q,q),y.strokeText("A",0,q),Q=y.getImageData(0,0,q,q).data,h=0;for(let J=0,_t=Q.length;J<_t;J+=4)if(Q[J]>0){h=q-Math.floor(J/4/q);break}if(y.canvas.width=y.canvas.height=0,h){const J=h/(h+I);return z.set(b,J),J}return z.set(b,gt),gt}function H(b,k,x){const y=document.createElement("span"),l={angle:0,canvasWidth:0,hasText:k.str!=="",hasEOL:k.hasEOL,fontSize:0};b._textDivs.push(y);const h=n.Util.transform(b._transform,k.transform);let I=Math.atan2(h[1],h[0]);const Q=x[k.fontName];Q.vertical&&(I+=Math.PI/2);const J=Math.hypot(h[2],h[3]),_t=J*g(Q.fontFamily,b._isOffscreenCanvasSupported);let at,xt;I===0?(at=h[4],xt=h[5]-_t):(at=h[4]+_t*Math.sin(I),xt=h[5]-_t*Math.cos(I));const Ct="calc(var(--scale-factor)*",j=y.style;b._container===b._rootContainer?(j.left=`${(100*at/b._pageWidth).toFixed(2)}%`,j.top=`${(100*xt/b._pageHeight).toFixed(2)}%`):(j.left=`${Ct}${at.toFixed(2)}px)`,j.top=`${Ct}${xt.toFixed(2)}px)`),j.fontSize=`${Ct}${J.toFixed(2)}px)`,j.fontFamily=Q.fontFamily,l.fontSize=J,y.setAttribute("role","presentation"),y.textContent=k.str,y.dir=k.dir,b._fontInspectorEnabled&&(y.dataset.fontName=k.fontName),I!==0&&(l.angle=I*(180/Math.PI));let ut=!1;if(k.str.length>1)ut=!0;else if(k.str!==" "&&k.transform[0]!==k.transform[3]){const Et=Math.abs(k.transform[0]),yt=Math.abs(k.transform[3]);Et!==yt&&Math.max(Et,yt)/Math.min(Et,yt)>1.5&&(ut=!0)}ut&&(l.canvasWidth=Q.vertical?k.height:k.width),b._textDivProperties.set(y,l),b._isReadableStream&&b._layoutText(y)}function W(b){const{div:k,scale:x,properties:y,ctx:l,prevFontSize:h,prevFontFamily:I}=b,{style:Q}=k;let J="";if(y.canvasWidth!==0&&y.hasText){const{fontFamily:_t}=Q,{canvasWidth:at,fontSize:xt}=y;(h!==xt||I!==_t)&&(l.font=`${xt*x}px ${_t}`,b.prevFontSize=xt,b.prevFontFamily=_t);const{width:Ct}=l.measureText(k.textContent);Ct>0&&(J=`scaleX(${at*x/Ct})`)}y.angle!==0&&(J=`rotate(${y.angle}deg) ${J}`),J.length>0&&(Q.transform=J)}function L(b){if(b._canceled)return;const k=b._textDivs,x=b._capability;if(k.length>V){x.resolve();return}if(!b._isReadableStream)for(const l of k)b._layoutText(l);x.resolve()}class E{constructor({textContentSource:k,container:x,viewport:y,textDivs:l,textDivProperties:h,textContentItemsStr:I,isOffscreenCanvasSupported:Q}){var Ct;this._textContentSource=k,this._isReadableStream=k instanceof ReadableStream,this._container=this._rootContainer=x,this._textDivs=l||[],this._textContentItemsStr=I||[],this._isOffscreenCanvasSupported=Q,this._fontInspectorEnabled=!!((Ct=globalThis.FontInspector)!=null&&Ct.enabled),this._reader=null,this._textDivProperties=h||new WeakMap,this._canceled=!1,this._capability=new n.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:y.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:F(0,Q)};const{pageWidth:J,pageHeight:_t,pageX:at,pageY:xt}=y.rawDims;this._transform=[1,0,0,-1,-at,xt+_t],this._pageWidth=J,this._pageHeight=_t,(0,P.setLayerDimensions)(x,y),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new n.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new n.AbortException("TextLayer task cancelled."))}_processItems(k,x){for(const y of k){if(y.str===void 0){if(y.type==="beginMarkedContentProps"||y.type==="beginMarkedContent"){const l=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),y.id!==null&&this._container.setAttribute("id",`${y.id}`),l.append(this._container)}else y.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(y.str),H(this,y,x)}}_layoutText(k){const x=this._layoutTextParams.properties=this._textDivProperties.get(k);if(this._layoutTextParams.div=k,W(this._layoutTextParams),x.hasText&&this._container.append(k),x.hasEOL){const y=document.createElement("br");y.setAttribute("role","presentation"),this._container.append(y)}}_render(){const k=new n.PromiseCapability;let x=Object.create(null);if(this._isReadableStream){const y=()=>{this._reader.read().then(({value:l,done:h})=>{if(h){k.resolve();return}Object.assign(x,l.styles),this._processItems(l.items,x),y()},k.reject)};this._reader=this._textContentSource.getReader(),y()}else if(this._textContentSource){const{items:y,styles:l}=this._textContentSource;this._processItems(y,l),k.resolve()}else throw new Error('No "textContentSource" parameter specified.');k.promise.then(()=>{x=null,L(this)},this._capability.reject)}}o.TextLayerRenderTask=E;function w(b){!b.textContentSource&&(b.textContent||b.textContentStream)&&((0,P.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),b.textContentSource=b.textContent||b.textContentStream);const{container:k,viewport:x}=b,y=getComputedStyle(k),l=y.getPropertyValue("visibility"),h=parseFloat(y.getPropertyValue("--scale-factor"));l==="visible"&&(!h||Math.abs(h-x.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const I=new E(b);return I._render(),I}function f({container:b,viewport:k,textDivs:x,textDivProperties:y,isOffscreenCanvasSupported:l,mustRotate:h=!0,mustRescale:I=!0}){if(h&&(0,P.setLayerDimensions)(b,{rotation:k.rotation}),I){const Q=F(0,l),_t={prevFontSize:null,prevFontFamily:null,div:null,scale:k.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:Q};for(const at of x)_t.properties=y.get(at),_t.div=at,W(_t)}}},(U,o,K)=>{var g,H,W,L,E,w,f,b,k,x,y,ns,h,bi,Q,rs,_t,as;Object.defineProperty(o,"__esModule",{value:!0}),o.AnnotationEditorLayer=void 0;var n=K(1),P=K(4),V=K(28),q=K(33),gt=K(6),z=K(34);const xt=class xt{constructor({uiManager:j,pageIndex:ut,div:Et,accessibilityManager:yt,annotationLayer:et,viewport:bt,l10n:Rt}){$(this,y);$(this,h);$(this,Q);$(this,_t);$(this,g,void 0);$(this,H,!1);$(this,W,null);$(this,L,this.pointerup.bind(this));$(this,E,this.pointerdown.bind(this));$(this,w,new Map);$(this,f,!1);$(this,b,!1);$(this,k,!1);$(this,x,void 0);const Ut=[V.FreeTextEditor,q.InkEditor,z.StampEditor];if(!xt._initialized){xt._initialized=!0;for(const $t of Ut)$t.initialize(Rt)}j.registerEditorTypes(Ut),ot(this,x,j),this.pageIndex=ut,this.div=Et,ot(this,g,yt),ot(this,W,et),this.viewport=bt,t(this,x).addLayer(this)}get isEmpty(){return t(this,w).size===0}updateToolbar(j){t(this,x).updateToolbar(j)}updateMode(j=t(this,x).getMode()){Z(this,_t,as).call(this),j===n.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),j!==n.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",j===n.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",j===n.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",j===n.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(j){if(!j&&t(this,x).getMode()!==n.AnnotationEditorType.INK)return;if(!j){for(const Et of t(this,w).values())if(Et.isEmpty()){Et.setInBackground();return}}Z(this,h,bi).call(this,{offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(j){t(this,x).setEditingState(j)}addCommands(j){t(this,x).addCommands(j)}enable(){this.div.style.pointerEvents="auto";const j=new Set;for(const Et of t(this,w).values())Et.enableEditing(),Et.annotationElementId&&j.add(Et.annotationElementId);if(!t(this,W))return;const ut=t(this,W).getEditableAnnotations();for(const Et of ut){if(Et.hide(),t(this,x).isDeletedAnnotationElement(Et.data.id)||j.has(Et.data.id))continue;const yt=this.deserialize(Et);yt&&(this.addOrRebuild(yt),yt.enableEditing())}}disable(){var ut;ot(this,k,!0),this.div.style.pointerEvents="none";const j=new Set;for(const Et of t(this,w).values()){if(Et.disableEditing(),!Et.annotationElementId||Et.serialize()!==null){j.add(Et.annotationElementId);continue}(ut=this.getEditableAnnotation(Et.annotationElementId))==null||ut.show(),Et.remove()}if(t(this,W)){const Et=t(this,W).getEditableAnnotations();for(const yt of Et){const{id:et}=yt.data;j.has(et)||t(this,x).isDeletedAnnotationElement(et)||yt.show()}}Z(this,_t,as).call(this),this.isEmpty&&(this.div.hidden=!0),ot(this,k,!1)}getEditableAnnotation(j){var ut;return((ut=t(this,W))==null?void 0:ut.getEditableAnnotation(j))||null}setActiveEditor(j){t(this,x).getActive()!==j&&t(this,x).setActiveEditor(j)}enableClick(){this.div.addEventListener("pointerdown",t(this,E)),this.div.addEventListener("pointerup",t(this,L))}disableClick(){this.div.removeEventListener("pointerdown",t(this,E)),this.div.removeEventListener("pointerup",t(this,L))}attach(j){t(this,w).set(j.id,j);const{annotationElementId:ut}=j;ut&&t(this,x).isDeletedAnnotationElement(ut)&&t(this,x).removeDeletedAnnotationElement(j)}detach(j){var ut;t(this,w).delete(j.id),(ut=t(this,g))==null||ut.removePointerInTextLayer(j.contentDiv),!t(this,k)&&j.annotationElementId&&t(this,x).addDeletedAnnotationElement(j)}remove(j){this.detach(j),t(this,x).removeEditor(j),j.div.contains(document.activeElement)&&setTimeout(()=>{t(this,x).focusMainContainer()},0),j.div.remove(),j.isAttachedToDOM=!1,t(this,b)||this.addInkEditorIfNeeded(!1)}changeParent(j){var ut;j.parent!==this&&(j.annotationElementId&&(t(this,x).addDeletedAnnotationElement(j.annotationElementId),P.AnnotationEditor.deleteAnnotationElement(j),j.annotationElementId=null),this.attach(j),(ut=j.parent)==null||ut.detach(j),j.setParent(this),j.div&&j.isAttachedToDOM&&(j.div.remove(),this.div.append(j.div)))}add(j){if(this.changeParent(j),t(this,x).addEditor(j),this.attach(j),!j.isAttachedToDOM){const ut=j.render();this.div.append(ut),j.isAttachedToDOM=!0}j.fixAndSetPosition(),j.onceAdded(),t(this,x).addToAnnotationStorage(j)}moveEditorInDOM(j){var Et;if(!j.isAttachedToDOM)return;const{activeElement:ut}=document;j.div.contains(ut)&&(j._focusEventsAllowed=!1,setTimeout(()=>{j.div.contains(document.activeElement)?j._focusEventsAllowed=!0:(j.div.addEventListener("focusin",()=>{j._focusEventsAllowed=!0},{once:!0}),ut.focus())},0)),j._structTreeParentId=(Et=t(this,g))==null?void 0:Et.moveElementInDOM(this.div,j.div,j.contentDiv,!0)}addOrRebuild(j){j.needsToBeRebuilt()?j.rebuild():this.add(j)}addUndoableEditor(j){const ut=()=>j._uiManager.rebuild(j),Et=()=>{j.remove()};this.addCommands({cmd:ut,undo:Et,mustExec:!1})}getNextId(){return t(this,x).getId()}pasteEditor(j,ut){t(this,x).updateToolbar(j),t(this,x).updateMode(j);const{offsetX:Et,offsetY:yt}=Z(this,Q,rs).call(this),et=this.getNextId(),bt=Z(this,y,ns).call(this,{parent:this,id:et,x:Et,y:yt,uiManager:t(this,x),isCentered:!0,...ut});bt&&this.add(bt)}deserialize(j){switch(j.annotationType??j.annotationEditorType){case n.AnnotationEditorType.FREETEXT:return V.FreeTextEditor.deserialize(j,this,t(this,x));case n.AnnotationEditorType.INK:return q.InkEditor.deserialize(j,this,t(this,x));case n.AnnotationEditorType.STAMP:return z.StampEditor.deserialize(j,this,t(this,x))}return null}addNewEditor(){Z(this,h,bi).call(this,Z(this,Q,rs).call(this),!0)}setSelected(j){t(this,x).setSelected(j)}toggleSelected(j){t(this,x).toggleSelected(j)}isSelected(j){return t(this,x).isSelected(j)}unselect(j){t(this,x).unselect(j)}pointerup(j){const{isMac:ut}=n.FeatureTest.platform;if(!(j.button!==0||j.ctrlKey&&ut)&&j.target===this.div&&t(this,f)){if(ot(this,f,!1),!t(this,H)){ot(this,H,!0);return}if(t(this,x).getMode()===n.AnnotationEditorType.STAMP){t(this,x).unselectAll();return}Z(this,h,bi).call(this,j,!1)}}pointerdown(j){if(t(this,f)){ot(this,f,!1);return}const{isMac:ut}=n.FeatureTest.platform;if(j.button!==0||j.ctrlKey&&ut||j.target!==this.div)return;ot(this,f,!0);const Et=t(this,x).getActive();ot(this,H,!Et||Et.isEmpty())}findNewParent(j,ut,Et){const yt=t(this,x).findParent(ut,Et);return yt===null||yt===this?!1:(yt.changeParent(j),!0)}destroy(){var j,ut;((j=t(this,x).getActive())==null?void 0:j.parent)===this&&(t(this,x).commitOrRemove(),t(this,x).setActiveEditor(null));for(const Et of t(this,w).values())(ut=t(this,g))==null||ut.removePointerInTextLayer(Et.contentDiv),Et.setParent(null),Et.isAttachedToDOM=!1,Et.div.remove();this.div=null,t(this,w).clear(),t(this,x).removeLayer(this)}render({viewport:j}){this.viewport=j,(0,gt.setLayerDimensions)(this.div,j);for(const ut of t(this,x).getEditors(this.pageIndex))this.add(ut);this.updateMode()}update({viewport:j}){t(this,x).commitOrRemove(),this.viewport=j,(0,gt.setLayerDimensions)(this.div,{rotation:j.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:j,pageHeight:ut}=this.viewport.rawDims;return[j,ut]}};g=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakMap,E=new WeakMap,w=new WeakMap,f=new WeakMap,b=new WeakMap,k=new WeakMap,x=new WeakMap,y=new WeakSet,ns=function(j){switch(t(this,x).getMode()){case n.AnnotationEditorType.FREETEXT:return new V.FreeTextEditor(j);case n.AnnotationEditorType.INK:return new q.InkEditor(j);case n.AnnotationEditorType.STAMP:return new z.StampEditor(j)}return null},h=new WeakSet,bi=function(j,ut){const Et=this.getNextId(),yt=Z(this,y,ns).call(this,{parent:this,id:Et,x:j.offsetX,y:j.offsetY,uiManager:t(this,x),isCentered:ut});return yt&&this.add(yt),yt},Q=new WeakSet,rs=function(){const{x:j,y:ut,width:Et,height:yt}=this.div.getBoundingClientRect(),et=Math.max(0,j),bt=Math.max(0,ut),Rt=Math.min(window.innerWidth,j+Et),Ut=Math.min(window.innerHeight,ut+yt),$t=(et+Rt)/2-j,T=(bt+Ut)/2-ut,[i,r]=this.viewport.rotation%180===0?[$t,T]:[T,$t];return{offsetX:i,offsetY:r}},_t=new WeakSet,as=function(){ot(this,b,!0);for(const j of t(this,w).values())j.isEmpty()&&j.remove();ot(this,b,!1)},oe(xt,"_initialized",!1);let F=xt;o.AnnotationEditorLayer=F},(U,o,K)=>{var z,F,g,H,W,L,E,w,f,b,pn,x,gn,l,mn,I,Ye,J,os,at,bn,Ct,ls;Object.defineProperty(o,"__esModule",{value:!0}),o.FreeTextEditor=void 0;var n=K(1),P=K(5),V=K(4),q=K(29);const ut=class ut extends V.AnnotationEditor{constructor(et){super({...et,name:"freeTextEditor"});$(this,b);$(this,x);$(this,l);$(this,I);$(this,J);$(this,at);$(this,Ct);$(this,z,this.editorDivBlur.bind(this));$(this,F,this.editorDivFocus.bind(this));$(this,g,this.editorDivInput.bind(this));$(this,H,this.editorDivKeydown.bind(this));$(this,W,void 0);$(this,L,"");$(this,E,`${this.id}-editor`);$(this,w,void 0);$(this,f,null);ot(this,W,et.color||ut._defaultColor||V.AnnotationEditor._defaultLineColor),ot(this,w,et.fontSize||ut._defaultFontSize)}static get _keyboardManager(){const et=ut.prototype,bt=$t=>$t.isEmpty(),Rt=P.AnnotationEditorUIManager.TRANSLATE_SMALL,Ut=P.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,n.shadow)(this,"_keyboardManager",new P.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],et.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],et.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],et._translateEmpty,{args:[-Rt,0],checker:bt}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],et._translateEmpty,{args:[-Ut,0],checker:bt}],[["ArrowRight","mac+ArrowRight"],et._translateEmpty,{args:[Rt,0],checker:bt}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],et._translateEmpty,{args:[Ut,0],checker:bt}],[["ArrowUp","mac+ArrowUp"],et._translateEmpty,{args:[0,-Rt],checker:bt}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],et._translateEmpty,{args:[0,-Ut],checker:bt}],[["ArrowDown","mac+ArrowDown"],et._translateEmpty,{args:[0,Rt],checker:bt}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],et._translateEmpty,{args:[0,Ut],checker:bt}]]))}static initialize(et){V.AnnotationEditor.initialize(et,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const bt=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(bt.getPropertyValue("--freetext-padding"))}static updateDefaultParams(et,bt){switch(et){case n.AnnotationEditorParamsType.FREETEXT_SIZE:ut._defaultFontSize=bt;break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:ut._defaultColor=bt;break}}updateParams(et,bt){switch(et){case n.AnnotationEditorParamsType.FREETEXT_SIZE:Z(this,b,pn).call(this,bt);break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:Z(this,x,gn).call(this,bt);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,ut._defaultFontSize],[n.AnnotationEditorParamsType.FREETEXT_COLOR,ut._defaultColor||V.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,t(this,w)],[n.AnnotationEditorParamsType.FREETEXT_COLOR,t(this,W)]]}_translateEmpty(et,bt){this._uiManager.translateSelectedEditors(et,bt,!0)}getInitialTranslation(){const et=this.parentScale;return[-ut._internalPadding*et,-(ut._internalPadding+t(this,w))*et]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(n.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",t(this,H)),this.editorDiv.addEventListener("focus",t(this,F)),this.editorDiv.addEventListener("blur",t(this,z)),this.editorDiv.addEventListener("input",t(this,g)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",t(this,E)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",t(this,H)),this.editorDiv.removeEventListener("focus",t(this,F)),this.editorDiv.removeEventListener("blur",t(this,z)),this.editorDiv.removeEventListener("input",t(this,g)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(et){this._focusEventsAllowed&&(super.focusin(et),et.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var et;if(this.width){Z(this,Ct,ls).call(this);return}this.enableEditMode(),this.editorDiv.focus(),(et=this._initialOptions)!=null&&et.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const et=t(this,L),bt=ot(this,L,Z(this,l,mn).call(this).trimEnd());if(et===bt)return;const Rt=Ut=>{if(ot(this,L,Ut),!Ut){this.remove();return}Z(this,J,os).call(this),this._uiManager.rebuild(this),Z(this,I,Ye).call(this)};this.addCommands({cmd:()=>{Rt(bt)},undo:()=>{Rt(et)},mustExec:!1}),Z(this,I,Ye).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(et){this.enterInEditMode()}keydown(et){et.target===this.div&&et.key==="Enter"&&(this.enterInEditMode(),et.preventDefault())}editorDivKeydown(et){ut._keyboardManager.exec(this,et)}editorDivFocus(et){this.isEditing=!0}editorDivBlur(et){this.isEditing=!1}editorDivInput(et){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let et,bt;this.width&&(et=this.x,bt=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",t(this,E)),this.enableEditing(),V.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(Ut=>{var $t;return($t=this.editorDiv)==null?void 0:$t.setAttribute("aria-label",Ut)}),V.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(Ut=>{var $t;return($t=this.editorDiv)==null?void 0:$t.setAttribute("default-content",Ut)}),this.editorDiv.contentEditable=!0;const{style:Rt}=this.editorDiv;if(Rt.fontSize=`calc(${t(this,w)}px * var(--scale-factor))`,Rt.color=t(this,W),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,P.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[Ut,$t]=this.parentDimensions;if(this.annotationElementId){const{position:T}=t(this,f);let[i,r]=this.getInitialTranslation();[i,r]=this.pageTranslationToScreen(i,r);const[s,c]=this.pageDimensions,[d,m]=this.pageTranslation;let M,B;switch(this.rotation){case 0:M=et+(T[0]-d)/s,B=bt+this.height-(T[1]-m)/c;break;case 90:M=et+(T[0]-d)/s,B=bt-(T[1]-m)/c,[i,r]=[r,-i];break;case 180:M=et-this.width+(T[0]-d)/s,B=bt-(T[1]-m)/c,[i,r]=[-i,-r];break;case 270:M=et+(T[0]-d-this.height*c)/s,B=bt+(T[1]-m-this.width*s)/c,[i,r]=[-r,i];break}this.setAt(M*Ut,B*$t,i,r)}else this.setAt(et*Ut,bt*$t,this.width*Ut,this.height*$t);Z(this,J,os).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(et,bt,Rt){let Ut=null;if(et instanceof q.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:T,fontColor:i},rect:r,rotation:s,id:c},textContent:d,textPosition:m,parent:{page:{pageNumber:M}}}=et;if(!d||d.length===0)return null;Ut=et={annotationType:n.AnnotationEditorType.FREETEXT,color:Array.from(i),fontSize:T,value:d.join(`
`),position:m,pageIndex:M-1,rect:r,rotation:s,id:c,deleted:!1}}const $t=super.deserialize(et,bt,Rt);return ot($t,w,et.fontSize),ot($t,W,n.Util.makeHexColor(...et.color)),ot($t,L,et.value),$t.annotationElementId=et.id||null,ot($t,f,Ut),$t}serialize(et=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const bt=ut._internalPadding*this.parentScale,Rt=this.getRect(bt,bt),Ut=V.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:t(this,W)),$t={annotationType:n.AnnotationEditorType.FREETEXT,color:Ut,fontSize:t(this,w),value:t(this,L),pageIndex:this.pageIndex,rect:Rt,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return et?$t:this.annotationElementId&&!Z(this,at,bn).call(this,$t)?null:($t.id=this.annotationElementId,$t)}};z=new WeakMap,F=new WeakMap,g=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakMap,E=new WeakMap,w=new WeakMap,f=new WeakMap,b=new WeakSet,pn=function(et){const bt=Ut=>{this.editorDiv.style.fontSize=`calc(${Ut}px * var(--scale-factor))`,this.translate(0,-(Ut-t(this,w))*this.parentScale),ot(this,w,Ut),Z(this,I,Ye).call(this)},Rt=t(this,w);this.addCommands({cmd:()=>{bt(et)},undo:()=>{bt(Rt)},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},x=new WeakSet,gn=function(et){const bt=t(this,W);this.addCommands({cmd:()=>{ot(this,W,this.editorDiv.style.color=et)},undo:()=>{ot(this,W,this.editorDiv.style.color=bt)},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},l=new WeakSet,mn=function(){const et=this.editorDiv.getElementsByTagName("div");if(et.length===0)return this.editorDiv.innerText;const bt=[];for(const Rt of et)bt.push(Rt.innerText.replace(/\r\n?|\n/,""));return bt.join(`
`)},I=new WeakSet,Ye=function(){const[et,bt]=this.parentDimensions;let Rt;if(this.isAttachedToDOM)Rt=this.div.getBoundingClientRect();else{const{currentLayer:Ut,div:$t}=this,T=$t.style.display;$t.style.display="hidden",Ut.div.append(this.div),Rt=$t.getBoundingClientRect(),$t.remove(),$t.style.display=T}this.rotation%180===this.parentRotation%180?(this.width=Rt.width/et,this.height=Rt.height/bt):(this.width=Rt.height/et,this.height=Rt.width/bt),this.fixAndSetPosition()},J=new WeakSet,os=function(){if(this.editorDiv.replaceChildren(),!!t(this,L))for(const et of t(this,L).split(`
`)){const bt=document.createElement("div");bt.append(et?document.createTextNode(et):document.createElement("br")),this.editorDiv.append(bt)}},at=new WeakSet,bn=function(et){const{value:bt,fontSize:Rt,color:Ut,rect:$t,pageIndex:T}=t(this,f);return et.value!==bt||et.fontSize!==Rt||et.rect.some((i,r)=>Math.abs(i-$t[r])>=1)||et.color.some((i,r)=>i!==Ut[r])||et.pageIndex!==T},Ct=new WeakSet,ls=function(et=!1){if(!this.annotationElementId)return;if(Z(this,I,Ye).call(this),!et&&(this.width===0||this.height===0)){setTimeout(()=>Z(this,Ct,ls).call(this,!0),0);return}const bt=ut._internalPadding*this.parentScale;t(this,f).rect=this.getRect(bt,bt)},oe(ut,"_freeTextDefaultContent",""),oe(ut,"_internalPadding",0),oe(ut,"_defaultColor",null),oe(ut,"_defaultFontSize",10),oe(ut,"_type","freetext");let gt=ut;o.FreeTextEditor=gt},(U,o,K)=>{var r,c,xe,m,An,B,lt,nt,ft,mt,Mt,At,Bt,Vt,kt,jt,St,it,st,vt,Ft,Ot,te,yn,Jt,Ai,pt,cs,X,hs,S,C,rt,dt,qt,ie,Y,ds,Nt,Dt,Xt,Gt,vn,Pt,us;Object.defineProperty(o,"__esModule",{value:!0}),o.StampAnnotationElement=o.InkAnnotationElement=o.FreeTextAnnotationElement=o.AnnotationLayer=void 0;var n=K(1),P=K(6),V=K(3),q=K(30),gt=K(31),z=K(32);const F=1e3,g=9,H=new WeakSet;function W(Wt){return{width:Wt[2]-Wt[0],height:Wt[3]-Wt[1]}}class L{static create(D){switch(D.data.annotationType){case n.AnnotationType.LINK:return new w(D);case n.AnnotationType.TEXT:return new f(D);case n.AnnotationType.WIDGET:switch(D.data.fieldType){case"Tx":return new k(D);case"Btn":return D.data.radioButton?new l(D):D.data.checkBox?new y(D):new h(D);case"Ch":return new I(D);case"Sig":return new x(D)}return new b(D);case n.AnnotationType.POPUP:return new Q(D);case n.AnnotationType.FREETEXT:return new _t(D);case n.AnnotationType.LINE:return new at(D);case n.AnnotationType.SQUARE:return new xt(D);case n.AnnotationType.CIRCLE:return new Ct(D);case n.AnnotationType.POLYLINE:return new j(D);case n.AnnotationType.CARET:return new Et(D);case n.AnnotationType.INK:return new yt(D);case n.AnnotationType.POLYGON:return new ut(D);case n.AnnotationType.HIGHLIGHT:return new et(D);case n.AnnotationType.UNDERLINE:return new bt(D);case n.AnnotationType.SQUIGGLY:return new Rt(D);case n.AnnotationType.STRIKEOUT:return new Ut(D);case n.AnnotationType.STAMP:return new $t(D);case n.AnnotationType.FILEATTACHMENT:return new T(D);default:return new E(D)}}}const s=class s{constructor(D,{isRenderable:e=!1,ignoreBorder:p=!1,createQuadrilaterals:N=!1}={}){$(this,r,!1);this.isRenderable=e,this.data=D.data,this.layer=D.layer,this.linkService=D.linkService,this.downloadManager=D.downloadManager,this.imageResourcesPath=D.imageResourcesPath,this.renderForms=D.renderForms,this.svgFactory=D.svgFactory,this.annotationStorage=D.annotationStorage,this.enableScripting=D.enableScripting,this.hasJSActions=D.hasJSActions,this._fieldObjects=D.fieldObjects,this.parent=D.parent,e&&(this.container=this._createContainer(p)),N&&this._createQuadrilaterals()}static _hasPopupData({titleObj:D,contentsObj:e,richText:p}){return!!(D!=null&&D.str||e!=null&&e.str||p!=null&&p.str)}get hasPopupData(){return s._hasPopupData(this.data)}_createContainer(D){const{data:e,parent:{page:p,viewport:N}}=this,G=document.createElement("section");G.setAttribute("data-annotation-id",e.id),this instanceof b||(G.tabIndex=F),G.style.zIndex=this.parent.zIndex++,this.data.popupRef&&G.setAttribute("aria-haspopup","dialog"),e.noRotate&&G.classList.add("norotate");const{pageWidth:tt,pageHeight:ct,pageX:wt,pageY:Lt}=N.rawDims;if(!e.rect||this instanceof Q){const{rotation:Yt}=e;return!e.hasOwnCanvas&&Yt!==0&&this.setRotation(Yt,G),G}const{width:It,height:Qt}=W(e.rect),Ht=n.Util.normalizeRect([e.rect[0],p.view[3]-e.rect[1]+p.view[1],e.rect[2],p.view[3]-e.rect[3]+p.view[1]]);if(!D&&e.borderStyle.width>0){G.style.borderWidth=`${e.borderStyle.width}px`;const Yt=e.borderStyle.horizontalCornerRadius,ee=e.borderStyle.verticalCornerRadius;if(Yt>0||ee>0){const ae=`calc(${Yt}px * var(--scale-factor)) / calc(${ee}px * var(--scale-factor))`;G.style.borderRadius=ae}else if(this instanceof l){const ae=`calc(${It}px * var(--scale-factor)) / calc(${Qt}px * var(--scale-factor))`;G.style.borderRadius=ae}switch(e.borderStyle.style){case n.AnnotationBorderStyleType.SOLID:G.style.borderStyle="solid";break;case n.AnnotationBorderStyleType.DASHED:G.style.borderStyle="dashed";break;case n.AnnotationBorderStyleType.BEVELED:(0,n.warn)("Unimplemented border style: beveled");break;case n.AnnotationBorderStyleType.INSET:(0,n.warn)("Unimplemented border style: inset");break;case n.AnnotationBorderStyleType.UNDERLINE:G.style.borderBottomStyle="solid";break}const re=e.borderColor||null;re?(ot(this,r,!0),G.style.borderColor=n.Util.makeHexColor(re[0]|0,re[1]|0,re[2]|0)):G.style.borderWidth=0}G.style.left=`${100*(Ht[0]-wt)/tt}%`,G.style.top=`${100*(Ht[1]-Lt)/ct}%`;const{rotation:zt}=e;return e.hasOwnCanvas||zt===0?(G.style.width=`${100*It/tt}%`,G.style.height=`${100*Qt/ct}%`):this.setRotation(zt,G),G}setRotation(D,e=this.container){if(!this.data.rect)return;const{pageWidth:p,pageHeight:N}=this.parent.viewport.rawDims,{width:G,height:tt}=W(this.data.rect);let ct,wt;D%180===0?(ct=100*G/p,wt=100*tt/N):(ct=100*tt/p,wt=100*G/N),e.style.width=`${ct}%`,e.style.height=`${wt}%`,e.setAttribute("data-main-rotation",(360-D)%360)}get _commonActions(){const D=(e,p,N)=>{const G=N.detail[e],tt=G[0],ct=G.slice(1);N.target.style[p]=q.ColorConverters[`${tt}_HTML`](ct),this.annotationStorage.setValue(this.data.id,{[p]:q.ColorConverters[`${tt}_rgb`](ct)})};return(0,n.shadow)(this,"_commonActions",{display:e=>{const{display:p}=e.detail,N=p%2===1;this.container.style.visibility=N?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:N,noPrint:p===1||p===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:p}=e.detail;this.container.style.visibility=p?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:p,noView:p})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{D("bgColor","backgroundColor",e)},fillColor:e=>{D("fillColor","backgroundColor",e)},fgColor:e=>{D("fgColor","color",e)},textColor:e=>{D("textColor","color",e)},borderColor:e=>{D("borderColor","borderColor",e)},strokeColor:e=>{D("strokeColor","borderColor",e)},rotation:e=>{const p=e.detail.rotation;this.setRotation(p),this.annotationStorage.setValue(this.data.id,{rotation:p})}})}_dispatchEventFromSandbox(D,e){const p=this._commonActions;for(const N of Object.keys(e.detail)){const G=D[N]||p[N];G==null||G(e)}}_setDefaultPropertiesFromJS(D){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const p=this._commonActions;for(const[N,G]of Object.entries(e)){const tt=p[N];if(tt){const ct={detail:{[N]:G},target:D};tt(ct),delete e[N]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:D}=this.data;if(!D)return;const[e,p,N,G]=this.data.rect;if(D.length===1){const[,{x:ee,y:re},{x:ae,y:ce}]=D[0];if(N===ee&&G===re&&e===ae&&p===ce)return}const{style:tt}=this.container;let ct;if(t(this,r)){const{borderColor:ee,borderWidth:re}=tt;tt.borderWidth=0,ct=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${ee}" stroke-width="${re}">`],this.container.classList.add("hasBorder")}const wt=N-e,Lt=G-p,{svgFactory:It}=this,Qt=It.createElement("svg");Qt.classList.add("quadrilateralsContainer"),Qt.setAttribute("width",0),Qt.setAttribute("height",0);const Ht=It.createElement("defs");Qt.append(Ht);const zt=It.createElement("clipPath"),Yt=`clippath_${this.data.id}`;zt.setAttribute("id",Yt),zt.setAttribute("clipPathUnits","objectBoundingBox"),Ht.append(zt);for(const[,{x:ee,y:re},{x:ae,y:ce}]of D){const le=It.createElement("rect"),pe=(ae-e)/wt,ge=(G-re)/Lt,ve=(ee-ae)/wt,Fe=(re-ce)/Lt;le.setAttribute("x",pe),le.setAttribute("y",ge),le.setAttribute("width",ve),le.setAttribute("height",Fe),zt.append(le),ct==null||ct.push(`<rect vector-effect="non-scaling-stroke" x="${pe}" y="${ge}" width="${ve}" height="${Fe}"/>`)}t(this,r)&&(ct.push("</g></svg>')"),tt.backgroundImage=ct.join("")),this.container.append(Qt),this.container.style.clipPath=`url(#${Yt})`}_createPopup(){const{container:D,data:e}=this;D.setAttribute("aria-haspopup","dialog");const p=new Q({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]});this.parent.div.append(p.render())}render(){(0,n.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(D,e=null){const p=[];if(this._fieldObjects){const N=this._fieldObjects[D];if(N)for(const{page:G,id:tt,exportValues:ct}of N){if(G===-1||tt===e)continue;const wt=typeof ct=="string"?ct:null,Lt=document.querySelector(`[data-element-id="${tt}"]`);if(Lt&&!H.has(Lt)){(0,n.warn)(`_getElementsByName - element not allowed: ${tt}`);continue}p.push({id:tt,exportValue:wt,domElement:Lt})}return p}for(const N of document.getElementsByName(D)){const{exportValue:G}=N,tt=N.getAttribute("data-element-id");tt!==e&&H.has(N)&&p.push({id:tt,exportValue:G,domElement:N})}return p}show(){var D;this.container&&(this.container.hidden=!1),(D=this.popup)==null||D.maybeShow()}hide(){var D;this.container&&(this.container.hidden=!0),(D=this.popup)==null||D.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const D=this.getElementsToTriggerPopup();if(Array.isArray(D))for(const e of D)e.classList.add("highlightArea");else D.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:D,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{var p;(p=this.linkService.eventBus)==null||p.dispatch("switchannotationeditormode",{source:this,mode:D,editId:e})})}};r=new WeakMap;let E=s;class w extends E{constructor(e,p=null){super(e,{isRenderable:!0,ignoreBorder:!!(p!=null&&p.ignoreBorder),createQuadrilaterals:!0});$(this,c);$(this,m);this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:p}=this,N=document.createElement("a");N.setAttribute("data-element-id",e.id);let G=!1;return e.url?(p.addLinkAttributes(N,e.url,e.newWindow),G=!0):e.action?(this._bindNamedAction(N,e.action),G=!0):e.attachment?(this._bindAttachment(N,e.attachment),G=!0):e.setOCGState?(Z(this,m,An).call(this,N,e.setOCGState),G=!0):e.dest?(this._bindLink(N,e.dest),G=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(N,e),G=!0),e.resetForm?(this._bindResetFormAction(N,e.resetForm),G=!0):this.isTooltipOnly&&!G&&(this._bindLink(N,""),G=!0)),this.container.classList.add("linkAnnotation"),G&&this.container.append(N),this.container}_bindLink(e,p){e.href=this.linkService.getDestinationHash(p),e.onclick=()=>(p&&this.linkService.goToDestination(p),!1),(p||p==="")&&Z(this,c,xe).call(this)}_bindNamedAction(e,p){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(p),!1),Z(this,c,xe).call(this)}_bindAttachment(e,p){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>{var N;return(N=this.downloadManager)==null||N.openOrDownloadData(this.container,p.content,p.filename),!1},Z(this,c,xe).call(this)}_bindJSAction(e,p){e.href=this.linkService.getAnchorUrl("");const N=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const G of Object.keys(p.actions)){const tt=N.get(G);tt&&(e[tt]=()=>{var ct;return(ct=this.linkService.eventBus)==null||ct.dispatch("dispatcheventinsandbox",{source:this,detail:{id:p.id,name:G}}),!1})}e.onclick||(e.onclick=()=>!1),Z(this,c,xe).call(this)}_bindResetFormAction(e,p){const N=e.onclick;if(N||(e.href=this.linkService.getAnchorUrl("")),Z(this,c,xe).call(this),!this._fieldObjects){(0,n.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),N||(e.onclick=()=>!1);return}e.onclick=()=>{var Qt;N==null||N();const{fields:G,refs:tt,include:ct}=p,wt=[];if(G.length!==0||tt.length!==0){const Ht=new Set(tt);for(const zt of G){const Yt=this._fieldObjects[zt]||[];for(const{id:ee}of Yt)Ht.add(ee)}for(const zt of Object.values(this._fieldObjects))for(const Yt of zt)Ht.has(Yt.id)===ct&&wt.push(Yt)}else for(const Ht of Object.values(this._fieldObjects))wt.push(...Ht);const Lt=this.annotationStorage,It=[];for(const Ht of wt){const{id:zt}=Ht;switch(It.push(zt),Ht.type){case"text":{const ee=Ht.defaultValue||"";Lt.setValue(zt,{value:ee});break}case"checkbox":case"radiobutton":{const ee=Ht.defaultValue===Ht.exportValues;Lt.setValue(zt,{value:ee});break}case"combobox":case"listbox":{const ee=Ht.defaultValue||"";Lt.setValue(zt,{value:ee});break}default:continue}const Yt=document.querySelector(`[data-element-id="${zt}"]`);if(Yt){if(!H.has(Yt)){(0,n.warn)(`_bindResetFormAction - element not allowed: ${zt}`);continue}}else continue;Yt.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((Qt=this.linkService.eventBus)==null||Qt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:It,name:"ResetForm"}})),!1}}}c=new WeakSet,xe=function(){this.container.setAttribute("data-internal-link","")},m=new WeakSet,An=function(e,p){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(p),!1),Z(this,c,xe).call(this)};class f extends E{constructor(D){super(D,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const D=document.createElement("img");return D.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",D.alt="[{{type}} Annotation]",D.dataset.l10nId="text_annotation_type",D.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(D),this.container}}class b extends E{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(D){var e;this.data.hasOwnCanvas&&(((e=D.previousSibling)==null?void 0:e.nodeName)==="CANVAS"&&(D.previousSibling.hidden=!0),D.hidden=!1)}_getKeyModifier(D){const{isWin:e,isMac:p}=n.FeatureTest.platform;return e&&D.ctrlKey||p&&D.metaKey}_setEventListener(D,e,p,N,G){p.includes("mouse")?D.addEventListener(p,tt=>{var ct;(ct=this.linkService.eventBus)==null||ct.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:N,value:G(tt),shift:tt.shiftKey,modifier:this._getKeyModifier(tt)}})}):D.addEventListener(p,tt=>{var ct;if(p==="blur"){if(!e.focused||!tt.relatedTarget)return;e.focused=!1}else if(p==="focus"){if(e.focused)return;e.focused=!0}G&&((ct=this.linkService.eventBus)==null||ct.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:N,value:G(tt)}}))})}_setEventListeners(D,e,p,N){var G,tt,ct;for(const[wt,Lt]of p)(Lt==="Action"||(G=this.data.actions)!=null&&G[Lt])&&((Lt==="Focus"||Lt==="Blur")&&(e||(e={focused:!1})),this._setEventListener(D,e,wt,Lt,N),Lt==="Focus"&&!((tt=this.data.actions)!=null&&tt.Blur)?this._setEventListener(D,e,"blur","Blur",null):Lt==="Blur"&&!((ct=this.data.actions)!=null&&ct.Focus)&&this._setEventListener(D,e,"focus","Focus",null))}_setBackgroundColor(D){const e=this.data.backgroundColor||null;D.style.backgroundColor=e===null?"transparent":n.Util.makeHexColor(e[0],e[1],e[2])}_setTextStyle(D){const e=["left","center","right"],{fontColor:p}=this.data.defaultAppearanceData,N=this.data.defaultAppearanceData.fontSize||g,G=D.style;let tt;const ct=2,wt=Lt=>Math.round(10*Lt)/10;if(this.data.multiLine){const Lt=Math.abs(this.data.rect[3]-this.data.rect[1]-ct),It=Math.round(Lt/(n.LINE_FACTOR*N))||1,Qt=Lt/It;tt=Math.min(N,wt(Qt/n.LINE_FACTOR))}else{const Lt=Math.abs(this.data.rect[3]-this.data.rect[1]-ct);tt=Math.min(N,wt(Lt/n.LINE_FACTOR))}G.fontSize=`calc(${tt}px * var(--scale-factor))`,G.color=n.Util.makeHexColor(p[0],p[1],p[2]),this.data.textAlignment!==null&&(G.textAlign=e[this.data.textAlignment])}_setRequired(D,e){e?D.setAttribute("required",!0):D.removeAttribute("required"),D.setAttribute("aria-required",e)}}class k extends b{constructor(D){const e=D.renderForms||!D.data.hasAppearance&&!!D.data.fieldValue;super(D,{isRenderable:e})}setPropertyOnSiblings(D,e,p,N){const G=this.annotationStorage;for(const tt of this._getElementsByName(D.name,D.id))tt.domElement&&(tt.domElement[e]=p),G.setValue(tt.id,{[N]:p})}render(){var N,G;const D=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let p=null;if(this.renderForms){const tt=D.getValue(e,{value:this.data.fieldValue});let ct=tt.value||"";const wt=D.getValue(e,{charLimit:this.data.maxLen}).charLimit;wt&&ct.length>wt&&(ct=ct.slice(0,wt));let Lt=tt.formattedValue||((N=this.data.textContent)==null?void 0:N.join(`
`))||null;Lt&&this.data.comb&&(Lt=Lt.replaceAll(/\s+/g,""));const It={userValue:ct,formattedValue:Lt,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(p=document.createElement("textarea"),p.textContent=Lt??ct,this.data.doNotScroll&&(p.style.overflowY="hidden")):(p=document.createElement("input"),p.type="text",p.setAttribute("value",Lt??ct),this.data.doNotScroll&&(p.style.overflowX="hidden")),this.data.hasOwnCanvas&&(p.hidden=!0),H.add(p),p.setAttribute("data-element-id",e),p.disabled=this.data.readOnly,p.name=this.data.fieldName,p.tabIndex=F,this._setRequired(p,this.data.required),wt&&(p.maxLength=wt),p.addEventListener("input",Ht=>{D.setValue(e,{value:Ht.target.value}),this.setPropertyOnSiblings(p,"value",Ht.target.value,"value"),It.formattedValue=null}),p.addEventListener("resetform",Ht=>{const zt=this.data.defaultFieldValue??"";p.value=It.userValue=zt,It.formattedValue=null});let Qt=Ht=>{const{formattedValue:zt}=It;zt!=null&&(Ht.target.value=zt),Ht.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){p.addEventListener("focus",zt=>{if(It.focused)return;const{target:Yt}=zt;It.userValue&&(Yt.value=It.userValue),It.lastCommittedValue=Yt.value,It.commitKey=1,It.focused=!0}),p.addEventListener("updatefromsandbox",zt=>{this.showElementAndHideCanvas(zt.target);const Yt={value(ee){It.userValue=ee.detail.value??"",D.setValue(e,{value:It.userValue.toString()}),ee.target.value=It.userValue},formattedValue(ee){const{formattedValue:re}=ee.detail;It.formattedValue=re,re!=null&&ee.target!==document.activeElement&&(ee.target.value=re),D.setValue(e,{formattedValue:re})},selRange(ee){ee.target.setSelectionRange(...ee.detail.selRange)},charLimit:ee=>{var le;const{charLimit:re}=ee.detail,{target:ae}=ee;if(re===0){ae.removeAttribute("maxLength");return}ae.setAttribute("maxLength",re);let ce=It.userValue;!ce||ce.length<=re||(ce=ce.slice(0,re),ae.value=It.userValue=ce,D.setValue(e,{value:ce}),(le=this.linkService.eventBus)==null||le.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:ce,willCommit:!0,commitKey:1,selStart:ae.selectionStart,selEnd:ae.selectionEnd}}))}};this._dispatchEventFromSandbox(Yt,zt)}),p.addEventListener("keydown",zt=>{var re;It.commitKey=1;let Yt=-1;if(zt.key==="Escape"?Yt=0:zt.key==="Enter"&&!this.data.multiLine?Yt=2:zt.key==="Tab"&&(It.commitKey=3),Yt===-1)return;const{value:ee}=zt.target;It.lastCommittedValue!==ee&&(It.lastCommittedValue=ee,It.userValue=ee,(re=this.linkService.eventBus)==null||re.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:ee,willCommit:!0,commitKey:Yt,selStart:zt.target.selectionStart,selEnd:zt.target.selectionEnd}}))});const Ht=Qt;Qt=null,p.addEventListener("blur",zt=>{var ee;if(!It.focused||!zt.relatedTarget)return;It.focused=!1;const{value:Yt}=zt.target;It.userValue=Yt,It.lastCommittedValue!==Yt&&((ee=this.linkService.eventBus)==null||ee.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:Yt,willCommit:!0,commitKey:It.commitKey,selStart:zt.target.selectionStart,selEnd:zt.target.selectionEnd}})),Ht(zt)}),(G=this.data.actions)!=null&&G.Keystroke&&p.addEventListener("beforeinput",zt=>{var ge;It.lastCommittedValue=null;const{data:Yt,target:ee}=zt,{value:re,selectionStart:ae,selectionEnd:ce}=ee;let le=ae,pe=ce;switch(zt.inputType){case"deleteWordBackward":{const ve=re.substring(0,ae).match(/\w*[^\w]*$/);ve&&(le-=ve[0].length);break}case"deleteWordForward":{const ve=re.substring(ae).match(/^[^\w]*\w*/);ve&&(pe+=ve[0].length);break}case"deleteContentBackward":ae===ce&&(le-=1);break;case"deleteContentForward":ae===ce&&(pe+=1);break}zt.preventDefault(),(ge=this.linkService.eventBus)==null||ge.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:re,change:Yt||"",willCommit:!1,selStart:le,selEnd:pe}})}),this._setEventListeners(p,It,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],zt=>zt.target.value)}if(Qt&&p.addEventListener("blur",Qt),this.data.comb){const zt=(this.data.rect[2]-this.data.rect[0])/wt;p.classList.add("comb"),p.style.letterSpacing=`calc(${zt}px * var(--scale-factor) - 1ch)`}}else p=document.createElement("div"),p.textContent=this.data.fieldValue,p.style.verticalAlign="middle",p.style.display="table-cell";return this._setTextStyle(p),this._setBackgroundColor(p),this._setDefaultPropertiesFromJS(p),this.container.append(p),this.container}}class x extends b{constructor(D){super(D,{isRenderable:!!D.data.hasOwnCanvas})}}class y extends b{constructor(D){super(D,{isRenderable:D.renderForms})}render(){const D=this.annotationStorage,e=this.data,p=e.id;let N=D.getValue(p,{value:e.exportValue===e.fieldValue}).value;typeof N=="string"&&(N=N!=="Off",D.setValue(p,{value:N})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const G=document.createElement("input");return H.add(G),G.setAttribute("data-element-id",p),G.disabled=e.readOnly,this._setRequired(G,this.data.required),G.type="checkbox",G.name=e.fieldName,N&&G.setAttribute("checked",!0),G.setAttribute("exportValue",e.exportValue),G.tabIndex=F,G.addEventListener("change",tt=>{const{name:ct,checked:wt}=tt.target;for(const Lt of this._getElementsByName(ct,p)){const It=wt&&Lt.exportValue===e.exportValue;Lt.domElement&&(Lt.domElement.checked=It),D.setValue(Lt.id,{value:It})}D.setValue(p,{value:wt})}),G.addEventListener("resetform",tt=>{const ct=e.defaultFieldValue||"Off";tt.target.checked=ct===e.exportValue}),this.enableScripting&&this.hasJSActions&&(G.addEventListener("updatefromsandbox",tt=>{const ct={value(wt){wt.target.checked=wt.detail.value!=="Off",D.setValue(p,{value:wt.target.checked})}};this._dispatchEventFromSandbox(ct,tt)}),this._setEventListeners(G,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],tt=>tt.target.checked)),this._setBackgroundColor(G),this._setDefaultPropertiesFromJS(G),this.container.append(G),this.container}}class l extends b{constructor(D){super(D,{isRenderable:D.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const D=this.annotationStorage,e=this.data,p=e.id;let N=D.getValue(p,{value:e.fieldValue===e.buttonValue}).value;typeof N=="string"&&(N=N!==e.buttonValue,D.setValue(p,{value:N}));const G=document.createElement("input");if(H.add(G),G.setAttribute("data-element-id",p),G.disabled=e.readOnly,this._setRequired(G,this.data.required),G.type="radio",G.name=e.fieldName,N&&G.setAttribute("checked",!0),G.tabIndex=F,G.addEventListener("change",tt=>{const{name:ct,checked:wt}=tt.target;for(const Lt of this._getElementsByName(ct,p))D.setValue(Lt.id,{value:!1});D.setValue(p,{value:wt})}),G.addEventListener("resetform",tt=>{const ct=e.defaultFieldValue;tt.target.checked=ct!=null&&ct===e.buttonValue}),this.enableScripting&&this.hasJSActions){const tt=e.buttonValue;G.addEventListener("updatefromsandbox",ct=>{const wt={value:Lt=>{const It=tt===Lt.detail.value;for(const Qt of this._getElementsByName(Lt.target.name)){const Ht=It&&Qt.id===p;Qt.domElement&&(Qt.domElement.checked=Ht),D.setValue(Qt.id,{value:Ht})}}};this._dispatchEventFromSandbox(wt,ct)}),this._setEventListeners(G,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ct=>ct.target.checked)}return this._setBackgroundColor(G),this._setDefaultPropertiesFromJS(G),this.container.append(G),this.container}}class h extends w{constructor(D){super(D,{ignoreBorder:D.data.hasAppearance})}render(){const D=super.render();D.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(D.title=this.data.alternativeText);const e=D.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",p=>{this._dispatchEventFromSandbox({},p)})),D}}class I extends b{constructor(D){super(D,{isRenderable:D.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const D=this.annotationStorage,e=this.data.id,p=D.getValue(e,{value:this.data.fieldValue}),N=document.createElement("select");H.add(N),N.setAttribute("data-element-id",e),N.disabled=this.data.readOnly,this._setRequired(N,this.data.required),N.name=this.data.fieldName,N.tabIndex=F;let G=this.data.combo&&this.data.options.length>0;this.data.combo||(N.size=this.data.options.length,this.data.multiSelect&&(N.multiple=!0)),N.addEventListener("resetform",It=>{const Qt=this.data.defaultFieldValue;for(const Ht of N.options)Ht.selected=Ht.value===Qt});for(const It of this.data.options){const Qt=document.createElement("option");Qt.textContent=It.displayValue,Qt.value=It.exportValue,p.value.includes(It.exportValue)&&(Qt.setAttribute("selected",!0),G=!1),N.append(Qt)}let tt=null;if(G){const It=document.createElement("option");It.value=" ",It.setAttribute("hidden",!0),It.setAttribute("selected",!0),N.prepend(It),tt=()=>{It.remove(),N.removeEventListener("input",tt),tt=null},N.addEventListener("input",tt)}const ct=It=>{const Qt=It?"value":"textContent",{options:Ht,multiple:zt}=N;return zt?Array.prototype.filter.call(Ht,Yt=>Yt.selected).map(Yt=>Yt[Qt]):Ht.selectedIndex===-1?null:Ht[Ht.selectedIndex][Qt]};let wt=ct(!1);const Lt=It=>{const Qt=It.target.options;return Array.prototype.map.call(Qt,Ht=>({displayValue:Ht.textContent,exportValue:Ht.value}))};return this.enableScripting&&this.hasJSActions?(N.addEventListener("updatefromsandbox",It=>{const Qt={value(Ht){tt==null||tt();const zt=Ht.detail.value,Yt=new Set(Array.isArray(zt)?zt:[zt]);for(const ee of N.options)ee.selected=Yt.has(ee.value);D.setValue(e,{value:ct(!0)}),wt=ct(!1)},multipleSelection(Ht){N.multiple=!0},remove(Ht){const zt=N.options,Yt=Ht.detail.remove;zt[Yt].selected=!1,N.remove(Yt),zt.length>0&&Array.prototype.findIndex.call(zt,re=>re.selected)===-1&&(zt[0].selected=!0),D.setValue(e,{value:ct(!0),items:Lt(Ht)}),wt=ct(!1)},clear(Ht){for(;N.length!==0;)N.remove(0);D.setValue(e,{value:null,items:[]}),wt=ct(!1)},insert(Ht){const{index:zt,displayValue:Yt,exportValue:ee}=Ht.detail.insert,re=N.children[zt],ae=document.createElement("option");ae.textContent=Yt,ae.value=ee,re?re.before(ae):N.append(ae),D.setValue(e,{value:ct(!0),items:Lt(Ht)}),wt=ct(!1)},items(Ht){const{items:zt}=Ht.detail;for(;N.length!==0;)N.remove(0);for(const Yt of zt){const{displayValue:ee,exportValue:re}=Yt,ae=document.createElement("option");ae.textContent=ee,ae.value=re,N.append(ae)}N.options.length>0&&(N.options[0].selected=!0),D.setValue(e,{value:ct(!0),items:Lt(Ht)}),wt=ct(!1)},indices(Ht){const zt=new Set(Ht.detail.indices);for(const Yt of Ht.target.options)Yt.selected=zt.has(Yt.index);D.setValue(e,{value:ct(!0)}),wt=ct(!1)},editable(Ht){Ht.target.disabled=!Ht.detail.editable}};this._dispatchEventFromSandbox(Qt,It)}),N.addEventListener("input",It=>{var Ht;const Qt=ct(!0);D.setValue(e,{value:Qt}),It.preventDefault(),(Ht=this.linkService.eventBus)==null||Ht.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:wt,changeEx:Qt,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(N,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],It=>It.target.value)):N.addEventListener("input",function(It){D.setValue(e,{value:ct(!0)})}),this.data.combo&&this._setTextStyle(N),this._setBackgroundColor(N),this._setDefaultPropertiesFromJS(N),this.container.append(N),this.container}}class Q extends E{constructor(D){const{data:e,elements:p}=D;super(D,{isRenderable:E._hasPopupData(e)}),this.elements=p}render(){this.container.classList.add("popupAnnotation");const D=new J({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(const p of this.elements)p.popup=D,e.push(p.data.id),p.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(p=>`${n.AnnotationPrefix}${p}`).join(",")),this.container}}class J{constructor({container:D,color:e,elements:p,titleObj:N,modificationDate:G,contentsObj:tt,richText:ct,parent:wt,rect:Lt,parentRect:It,open:Qt}){$(this,te);$(this,Jt);$(this,pt);$(this,X);$(this,B,null);$(this,lt,Z(this,te,yn).bind(this));$(this,nt,Z(this,X,hs).bind(this));$(this,ft,Z(this,pt,cs).bind(this));$(this,mt,Z(this,Jt,Ai).bind(this));$(this,Mt,null);$(this,At,null);$(this,Bt,null);$(this,Vt,null);$(this,kt,null);$(this,jt,null);$(this,St,!1);$(this,it,null);$(this,st,null);$(this,vt,null);$(this,Ft,null);$(this,Ot,!1);var zt;ot(this,At,D),ot(this,Ft,N),ot(this,Bt,tt),ot(this,vt,ct),ot(this,kt,wt),ot(this,Mt,e),ot(this,st,Lt),ot(this,jt,It),ot(this,Vt,p);const Ht=P.PDFDateString.toDateObject(G);Ht&&ot(this,B,wt.l10n.get("annotation_date_string",{date:Ht.toLocaleDateString(),time:Ht.toLocaleTimeString()})),this.trigger=p.flatMap(Yt=>Yt.getElementsToTriggerPopup());for(const Yt of this.trigger)Yt.addEventListener("click",t(this,mt)),Yt.addEventListener("mouseenter",t(this,ft)),Yt.addEventListener("mouseleave",t(this,nt)),Yt.classList.add("popupTriggerArea");for(const Yt of p)(zt=Yt.container)==null||zt.addEventListener("keydown",t(this,lt));t(this,At).hidden=!0,Qt&&Z(this,Jt,Ai).call(this)}render(){if(t(this,it))return;const{page:{view:D},viewport:{rawDims:{pageWidth:e,pageHeight:p,pageX:N,pageY:G}}}=t(this,kt),tt=ot(this,it,document.createElement("div"));if(tt.className="popup",t(this,Mt)){const le=tt.style.outlineColor=n.Util.makeHexColor(...t(this,Mt));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?tt.style.backgroundColor=`color-mix(in srgb, ${le} 30%, white)`:tt.style.backgroundColor=n.Util.makeHexColor(...t(this,Mt).map(ge=>Math.floor(.7*(255-ge)+ge)))}const ct=document.createElement("span");ct.className="header";const wt=document.createElement("h1");if(ct.append(wt),{dir:wt.dir,str:wt.textContent}=t(this,Ft),tt.append(ct),t(this,B)){const le=document.createElement("span");le.classList.add("popupDate"),t(this,B).then(pe=>{le.textContent=pe}),ct.append(le)}const Lt=t(this,Bt),It=t(this,vt);if(It!=null&&It.str&&(!(Lt!=null&&Lt.str)||Lt.str===It.str))z.XfaLayer.render({xfaHtml:It.html,intent:"richText",div:tt}),tt.lastChild.classList.add("richText","popupContent");else{const le=this._formatContents(Lt);tt.append(le)}let Qt=!!t(this,jt),Ht=Qt?t(this,jt):t(this,st);for(const le of t(this,Vt))if(!Ht||n.Util.intersect(le.data.rect,Ht)!==null){Ht=le.data.rect,Qt=!0;break}const zt=n.Util.normalizeRect([Ht[0],D[3]-Ht[1]+D[1],Ht[2],D[3]-Ht[3]+D[1]]),ee=Qt?Ht[2]-Ht[0]+5:0,re=zt[0]+ee,ae=zt[1],{style:ce}=t(this,At);ce.left=`${100*(re-N)/e}%`,ce.top=`${100*(ae-G)/p}%`,t(this,At).append(tt)}_formatContents({str:D,dir:e}){const p=document.createElement("p");p.classList.add("popupContent"),p.dir=e;const N=D.split(/(?:\r\n?|\n)/);for(let G=0,tt=N.length;G<tt;++G){const ct=N[G];p.append(document.createTextNode(ct)),G<tt-1&&p.append(document.createElement("br"))}return p}forceHide(){ot(this,Ot,this.isVisible),t(this,Ot)&&(t(this,At).hidden=!0)}maybeShow(){t(this,Ot)&&(ot(this,Ot,!1),t(this,At).hidden=!1)}get isVisible(){return t(this,At).hidden===!1}}B=new WeakMap,lt=new WeakMap,nt=new WeakMap,ft=new WeakMap,mt=new WeakMap,Mt=new WeakMap,At=new WeakMap,Bt=new WeakMap,Vt=new WeakMap,kt=new WeakMap,jt=new WeakMap,St=new WeakMap,it=new WeakMap,st=new WeakMap,vt=new WeakMap,Ft=new WeakMap,Ot=new WeakMap,te=new WeakSet,yn=function(D){D.altKey||D.shiftKey||D.ctrlKey||D.metaKey||(D.key==="Enter"||D.key==="Escape"&&t(this,St))&&Z(this,Jt,Ai).call(this)},Jt=new WeakSet,Ai=function(){ot(this,St,!t(this,St)),t(this,St)?(Z(this,pt,cs).call(this),t(this,At).addEventListener("click",t(this,mt)),t(this,At).addEventListener("keydown",t(this,lt))):(Z(this,X,hs).call(this),t(this,At).removeEventListener("click",t(this,mt)),t(this,At).removeEventListener("keydown",t(this,lt)))},pt=new WeakSet,cs=function(){t(this,it)||this.render(),this.isVisible?t(this,St)&&t(this,At).classList.add("focused"):(t(this,At).hidden=!1,t(this,At).style.zIndex=parseInt(t(this,At).style.zIndex)+1e3)},X=new WeakSet,hs=function(){t(this,At).classList.remove("focused"),!(t(this,St)||!this.isVisible)&&(t(this,At).hidden=!0,t(this,At).style.zIndex=parseInt(t(this,At).style.zIndex)-1e3)};class _t extends E{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0}),this.textContent=D.data.textContent,this.textPosition=D.data.textPosition,this.annotationEditorType=n.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const D=document.createElement("div");D.classList.add("annotationTextContent"),D.setAttribute("role","comment");for(const e of this.textContent){const p=document.createElement("span");p.textContent=e,D.append(p)}this.container.append(D)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}o.FreeTextAnnotationElement=_t;class at extends E{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});$(this,S,null)}render(){this.container.classList.add("lineAnnotation");const e=this.data,{width:p,height:N}=W(e.rect),G=this.svgFactory.create(p,N,!0),tt=ot(this,S,this.svgFactory.createElement("svg:line"));return tt.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),tt.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),tt.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),tt.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),tt.setAttribute("stroke-width",e.borderStyle.width||1),tt.setAttribute("stroke","transparent"),tt.setAttribute("fill","transparent"),G.append(tt),this.container.append(G),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,S)}addHighlightArea(){this.container.classList.add("highlightArea")}}S=new WeakMap;class xt extends E{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});$(this,C,null)}render(){this.container.classList.add("squareAnnotation");const e=this.data,{width:p,height:N}=W(e.rect),G=this.svgFactory.create(p,N,!0),tt=e.borderStyle.width,ct=ot(this,C,this.svgFactory.createElement("svg:rect"));return ct.setAttribute("x",tt/2),ct.setAttribute("y",tt/2),ct.setAttribute("width",p-tt),ct.setAttribute("height",N-tt),ct.setAttribute("stroke-width",tt||1),ct.setAttribute("stroke","transparent"),ct.setAttribute("fill","transparent"),G.append(ct),this.container.append(G),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,C)}addHighlightArea(){this.container.classList.add("highlightArea")}}C=new WeakMap;class Ct extends E{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});$(this,rt,null)}render(){this.container.classList.add("circleAnnotation");const e=this.data,{width:p,height:N}=W(e.rect),G=this.svgFactory.create(p,N,!0),tt=e.borderStyle.width,ct=ot(this,rt,this.svgFactory.createElement("svg:ellipse"));return ct.setAttribute("cx",p/2),ct.setAttribute("cy",N/2),ct.setAttribute("rx",p/2-tt/2),ct.setAttribute("ry",N/2-tt/2),ct.setAttribute("stroke-width",tt||1),ct.setAttribute("stroke","transparent"),ct.setAttribute("fill","transparent"),G.append(ct),this.container.append(G),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,rt)}addHighlightArea(){this.container.classList.add("highlightArea")}}rt=new WeakMap;class j extends E{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});$(this,dt,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const e=this.data,{width:p,height:N}=W(e.rect),G=this.svgFactory.create(p,N,!0);let tt=[];for(const wt of e.vertices){const Lt=wt.x-e.rect[0],It=e.rect[3]-wt.y;tt.push(Lt+","+It)}tt=tt.join(" ");const ct=ot(this,dt,this.svgFactory.createElement(this.svgElementName));return ct.setAttribute("points",tt),ct.setAttribute("stroke-width",e.borderStyle.width||1),ct.setAttribute("stroke","transparent"),ct.setAttribute("fill","transparent"),G.append(ct),this.container.append(G),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,dt)}addHighlightArea(){this.container.classList.add("highlightArea")}}dt=new WeakMap;class ut extends j{constructor(D){super(D),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Et extends E{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class yt extends E{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});$(this,qt,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=n.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const e=this.data,{width:p,height:N}=W(e.rect),G=this.svgFactory.create(p,N,!0);for(const tt of e.inkLists){let ct=[];for(const Lt of tt){const It=Lt.x-e.rect[0],Qt=e.rect[3]-Lt.y;ct.push(`${It},${Qt}`)}ct=ct.join(" ");const wt=this.svgFactory.createElement(this.svgElementName);t(this,qt).push(wt),wt.setAttribute("points",ct),wt.setAttribute("stroke-width",e.borderStyle.width||1),wt.setAttribute("stroke","transparent"),wt.setAttribute("fill","transparent"),!e.popupRef&&this.hasPopupData&&this._createPopup(),G.append(wt)}return this.container.append(G),this.container}getElementsToTriggerPopup(){return t(this,qt)}addHighlightArea(){this.container.classList.add("highlightArea")}}qt=new WeakMap,o.InkAnnotationElement=yt;class et extends E{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class bt extends E{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Rt extends E{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Ut extends E{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class $t extends E{constructor(D){super(D,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}o.StampAnnotationElement=$t;class T extends E{constructor(e){var G;super(e,{isRenderable:!0});$(this,Y);$(this,ie,null);const{filename:p,content:N}=this.data.file;this.filename=(0,P.getFilenameFromUrl)(p,!0),this.content=N,(G=this.linkService.eventBus)==null||G.dispatch("fileattachmentannotation",{source:this,filename:p,content:N})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:p}=this;let N;p.hasAppearance||p.fillAlpha===0?N=document.createElement("div"):(N=document.createElement("img"),N.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(p.name)?"paperclip":"pushpin"}.svg`,p.fillAlpha&&p.fillAlpha<1&&(N.style=`filter: opacity(${Math.round(p.fillAlpha*100)}%);`)),N.addEventListener("dblclick",Z(this,Y,ds).bind(this)),ot(this,ie,N);const{isMac:G}=n.FeatureTest.platform;return e.addEventListener("keydown",tt=>{tt.key==="Enter"&&(G?tt.metaKey:tt.ctrlKey)&&Z(this,Y,ds).call(this)}),!p.popupRef&&this.hasPopupData?this._createPopup():N.classList.add("popupTriggerArea"),e.append(N),e}getElementsToTriggerPopup(){return t(this,ie)}addHighlightArea(){this.container.classList.add("highlightArea")}}ie=new WeakMap,Y=new WeakSet,ds=function(){var e;(e=this.downloadManager)==null||e.openOrDownloadData(this.container,this.content,this.filename)};class i{constructor({div:D,accessibilityManager:e,annotationCanvasMap:p,l10n:N,page:G,viewport:tt}){$(this,Gt);$(this,Pt);$(this,Nt,null);$(this,Dt,null);$(this,Xt,new Map);this.div=D,ot(this,Nt,e),ot(this,Dt,p),this.l10n=N,this.page=G,this.viewport=tt,this.zIndex=0,this.l10n||(this.l10n=gt.NullL10n)}async render(D){const{annotations:e}=D,p=this.div;(0,P.setLayerDimensions)(p,this.viewport);const N=new Map,G={data:null,layer:p,linkService:D.linkService,downloadManager:D.downloadManager,imageResourcesPath:D.imageResourcesPath||"",renderForms:D.renderForms!==!1,svgFactory:new P.DOMSVGFactory,annotationStorage:D.annotationStorage||new V.AnnotationStorage,enableScripting:D.enableScripting===!0,hasJSActions:D.hasJSActions,fieldObjects:D.fieldObjects,parent:this,elements:null};for(const tt of e){if(tt.noHTML)continue;const ct=tt.annotationType===n.AnnotationType.POPUP;if(ct){const It=N.get(tt.id);if(!It)continue;G.elements=It}else{const{width:It,height:Qt}=W(tt.rect);if(It<=0||Qt<=0)continue}G.data=tt;const wt=L.create(G);if(!wt.isRenderable)continue;if(!ct&&tt.popupRef){const It=N.get(tt.popupRef);It?It.push(wt):N.set(tt.popupRef,[wt])}wt.annotationEditorType>0&&t(this,Xt).set(wt.data.id,wt);const Lt=wt.render();tt.hidden&&(Lt.style.visibility="hidden"),Z(this,Gt,vn).call(this,Lt,tt.id)}Z(this,Pt,us).call(this),await this.l10n.translate(p)}update({viewport:D}){const e=this.div;this.viewport=D,(0,P.setLayerDimensions)(e,{rotation:D.rotation}),Z(this,Pt,us).call(this),e.hidden=!1}getEditableAnnotations(){return Array.from(t(this,Xt).values())}getEditableAnnotation(D){return t(this,Xt).get(D)}}Nt=new WeakMap,Dt=new WeakMap,Xt=new WeakMap,Gt=new WeakSet,vn=function(D,e){var N;const p=D.firstChild||D;p.id=`${n.AnnotationPrefix}${e}`,this.div.append(D),(N=t(this,Nt))==null||N.moveElementInDOM(this.div,D,p,!1)},Pt=new WeakSet,us=function(){if(!t(this,Dt))return;const D=this.div;for(const[e,p]of t(this,Dt)){const N=D.querySelector(`[data-annotation-id="${e}"]`);if(!N)continue;const{firstChild:G}=N;G?G.nodeName==="CANVAS"?G.replaceWith(p):G.before(p):N.append(p)}t(this,Dt).clear()},o.AnnotationLayer=i},(U,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ColorConverters=void 0;function K(V){return Math.floor(Math.max(0,Math.min(1,V))*255).toString(16).padStart(2,"0")}function n(V){return Math.max(0,Math.min(255,255*V))}class P{static CMYK_G([q,gt,z,F]){return["G",1-Math.min(1,.3*q+.59*z+.11*gt+F)]}static G_CMYK([q]){return["CMYK",0,0,0,1-q]}static G_RGB([q]){return["RGB",q,q,q]}static G_rgb([q]){return q=n(q),[q,q,q]}static G_HTML([q]){const gt=K(q);return`#${gt}${gt}${gt}`}static RGB_G([q,gt,z]){return["G",.3*q+.59*gt+.11*z]}static RGB_rgb(q){return q.map(n)}static RGB_HTML(q){return`#${q.map(K).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([q,gt,z,F]){return["RGB",1-Math.min(1,q+F),1-Math.min(1,z+F),1-Math.min(1,gt+F)]}static CMYK_rgb([q,gt,z,F]){return[n(1-Math.min(1,q+F)),n(1-Math.min(1,z+F)),n(1-Math.min(1,gt+F))]}static CMYK_HTML(q){const gt=this.CMYK_RGB(q).slice(1);return this.RGB_HTML(gt)}static RGB_CMYK([q,gt,z]){const F=1-q,g=1-gt,H=1-z,W=Math.min(F,g,H);return["CMYK",F,g,H,W]}}o.ColorConverters=P},(U,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.NullL10n=void 0,o.getL10nFallback=n;const K={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};K.print_progress_percent="{{progress}}%";function n(q,gt){switch(q){case"find_match_count":q=`find_match_count[${gt.total===1?"one":"other"}]`;break;case"find_match_count_limit":q=`find_match_count_limit[${gt.limit===1?"one":"other"}]`;break}return K[q]||""}function P(q,gt){return gt?q.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(z,F)=>F in gt?gt[F]:"{{"+F+"}}"):q}const V={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(q,gt=null,z=n(q,gt)){return P(z,gt)},async translate(q){}};o.NullL10n=V},(U,o,K)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.XfaLayer=void 0;var n=K(25);class P{static setupStorage(q,gt,z,F,g){const H=F.getValue(gt,{value:null});switch(z.name){case"textarea":if(H.value!==null&&(q.textContent=H.value),g==="print")break;q.addEventListener("input",W=>{F.setValue(gt,{value:W.target.value})});break;case"input":if(z.attributes.type==="radio"||z.attributes.type==="checkbox"){if(H.value===z.attributes.xfaOn?q.setAttribute("checked",!0):H.value===z.attributes.xfaOff&&q.removeAttribute("checked"),g==="print")break;q.addEventListener("change",W=>{F.setValue(gt,{value:W.target.checked?W.target.getAttribute("xfaOn"):W.target.getAttribute("xfaOff")})})}else{if(H.value!==null&&q.setAttribute("value",H.value),g==="print")break;q.addEventListener("input",W=>{F.setValue(gt,{value:W.target.value})})}break;case"select":if(H.value!==null){q.setAttribute("value",H.value);for(const W of z.children)W.attributes.value===H.value?W.attributes.selected=!0:W.attributes.hasOwnProperty("selected")&&delete W.attributes.selected}q.addEventListener("input",W=>{const L=W.target.options,E=L.selectedIndex===-1?"":L[L.selectedIndex].value;F.setValue(gt,{value:E})});break}}static setAttributes({html:q,element:gt,storage:z=null,intent:F,linkService:g}){const{attributes:H}=gt,W=q instanceof HTMLAnchorElement;H.type==="radio"&&(H.name=`${H.name}-${F}`);for(const[L,E]of Object.entries(H))if(E!=null)switch(L){case"class":E.length&&q.setAttribute(L,E.join(" "));break;case"dataId":break;case"id":q.setAttribute("data-element-id",E);break;case"style":Object.assign(q.style,E);break;case"textContent":q.textContent=E;break;default:(!W||L!=="href"&&L!=="newWindow")&&q.setAttribute(L,E)}W&&g.addLinkAttributes(q,H.href,H.newWindow),z&&H.dataId&&this.setupStorage(q,H.dataId,gt,z)}static render(q){var w;const gt=q.annotationStorage,z=q.linkService,F=q.xfaHtml,g=q.intent||"display",H=document.createElement(F.name);F.attributes&&this.setAttributes({html:H,element:F,intent:g,linkService:z});const W=[[F,-1,H]],L=q.div;if(L.append(H),q.viewport){const f=`matrix(${q.viewport.transform.join(",")})`;L.style.transform=f}g!=="richText"&&L.setAttribute("class","xfaLayer xfaFont");const E=[];for(;W.length>0;){const[f,b,k]=W.at(-1);if(b+1===f.children.length){W.pop();continue}const x=f.children[++W.at(-1)[1]];if(x===null)continue;const{name:y}=x;if(y==="#text"){const h=document.createTextNode(x.value);E.push(h),k.append(h);continue}const l=(w=x==null?void 0:x.attributes)!=null&&w.xmlns?document.createElementNS(x.attributes.xmlns,y):document.createElement(y);if(k.append(l),x.attributes&&this.setAttributes({html:l,element:x,storage:gt,intent:g,linkService:z}),x.children&&x.children.length>0)W.push([x,-1,l]);else if(x.value){const h=document.createTextNode(x.value);n.XfaText.shouldBuildText(y)&&E.push(h),l.append(h)}}for(const f of L.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))f.setAttribute("readOnly",!0);return{textDivs:E}}static update(q){const gt=`matrix(${q.viewport.transform.join(",")})`;q.div.style.transform=gt,q.div.hidden=!1}}o.XfaLayer=P},(U,o,K)=>{var F,g,H,W,L,E,w,f,b,k,x,y,l,h,I,_n,J,Sn,at,En,Ct,wn,ut,fs,yt,Cn,bt,ps,Ut,Tn,T,Pn,r,xn,c,kn,m,Mn,B,Ee,nt,gs,mt,yi,At,vi,Vt,$e,jt,ms,it,_i,vt,Rn,Ot,bs,Kt,Fn,Zt,Dn,O,As,v,Si,C,Ue;Object.defineProperty(o,"__esModule",{value:!0}),o.InkEditor=void 0;var n=K(1),P=K(4),V=K(29),q=K(6),gt=K(5);const dt=class dt extends P.AnnotationEditor{constructor(Y){super({...Y,name:"inkEditor"});$(this,I);$(this,J);$(this,at);$(this,Ct);$(this,ut);$(this,yt);$(this,bt);$(this,Ut);$(this,T);$(this,r);$(this,c);$(this,m);$(this,B);$(this,nt);$(this,mt);$(this,At);$(this,Vt);$(this,jt);$(this,it);$(this,Zt);$(this,O);$(this,v);$(this,C);$(this,F,0);$(this,g,0);$(this,H,this.canvasPointermove.bind(this));$(this,W,this.canvasPointerleave.bind(this));$(this,L,this.canvasPointerup.bind(this));$(this,E,this.canvasPointerdown.bind(this));$(this,w,new Path2D);$(this,f,!1);$(this,b,!1);$(this,k,!1);$(this,x,null);$(this,y,0);$(this,l,0);$(this,h,null);this.color=Y.color||null,this.thickness=Y.thickness||null,this.opacity=Y.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(Y){P.AnnotationEditor.initialize(Y,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(Y,Tt){switch(Y){case n.AnnotationEditorParamsType.INK_THICKNESS:dt._defaultThickness=Tt;break;case n.AnnotationEditorParamsType.INK_COLOR:dt._defaultColor=Tt;break;case n.AnnotationEditorParamsType.INK_OPACITY:dt._defaultOpacity=Tt/100;break}}updateParams(Y,Tt){switch(Y){case n.AnnotationEditorParamsType.INK_THICKNESS:Z(this,I,_n).call(this,Tt);break;case n.AnnotationEditorParamsType.INK_COLOR:Z(this,J,Sn).call(this,Tt);break;case n.AnnotationEditorParamsType.INK_OPACITY:Z(this,at,En).call(this,Tt);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,dt._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,dt._defaultColor||P.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(dt._defaultOpacity*100)]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||dt._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,this.color||dt._defaultColor||P.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??dt._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(Z(this,mt,yi).call(this),Z(this,At,vi).call(this)),this.isAttachedToDOM||(this.parent.add(this),Z(this,Vt,$e).call(this)),Z(this,C,Ue).call(this)))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,t(this,x).disconnect(),ot(this,x,null),super.remove())}setParent(Y){!this.parent&&Y?this._uiManager.removeShouldRescale(this):this.parent&&Y===null&&this._uiManager.addShouldRescale(this),super.setParent(Y)}onScaleChanging(){const[Y,Tt]=this.parentDimensions,Nt=this.width*Y,Dt=this.height*Tt;this.setDimensions(Nt,Dt)}enableEditMode(){t(this,f)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",t(this,E)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",t(this,E)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){t(this,f)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),ot(this,f,!0),this.div.classList.add("disabled"),Z(this,C,Ue).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(Y){this._focusEventsAllowed&&(super.focusin(Y),this.enableEditMode())}canvasPointerdown(Y){Y.button!==0||!this.isInEditMode()||t(this,f)||(this.setInForeground(),Y.preventDefault(),Y.type!=="mouse"&&this.div.focus(),Z(this,yt,Cn).call(this,Y.offsetX,Y.offsetY))}canvasPointermove(Y){Y.preventDefault(),Z(this,bt,ps).call(this,Y.offsetX,Y.offsetY)}canvasPointerup(Y){Y.preventDefault(),Z(this,nt,gs).call(this,Y)}canvasPointerleave(Y){Z(this,nt,gs).call(this,Y)}get isResizable(){return!this.isEmpty()&&t(this,f)}render(){if(this.div)return this.div;let Y,Tt;this.width&&(Y=this.x,Tt=this.y),super.render(),P.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(ne=>{var Pt;return(Pt=this.div)==null?void 0:Pt.setAttribute("aria-label",ne)});const[Nt,Dt,Xt,Gt]=Z(this,Ct,wn).call(this);if(this.setAt(Nt,Dt,0,0),this.setDims(Xt,Gt),Z(this,mt,yi).call(this),this.width){const[ne,Pt]=this.parentDimensions;this.setAspectRatio(this.width*ne,this.height*Pt),this.setAt(Y*ne,Tt*Pt,this.width*ne,this.height*Pt),ot(this,k,!0),Z(this,Vt,$e).call(this),this.setDims(this.width*ne,this.height*Pt),Z(this,B,Ee).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return Z(this,At,vi).call(this),this.div}setDimensions(Y,Tt){const Nt=Math.round(Y),Dt=Math.round(Tt);if(t(this,y)===Nt&&t(this,l)===Dt)return;ot(this,y,Nt),ot(this,l,Dt),this.canvas.style.visibility="hidden";const[Xt,Gt]=this.parentDimensions;this.width=Y/Xt,this.height=Tt/Gt,this.fixAndSetPosition(),t(this,f)&&Z(this,jt,ms).call(this,Y,Tt),Z(this,Vt,$e).call(this),Z(this,B,Ee).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(Y,Tt,Nt){var G,tt,ct;if(Y instanceof V.InkAnnotationElement)return null;const Dt=super.deserialize(Y,Tt,Nt);Dt.thickness=Y.thickness,Dt.color=n.Util.makeHexColor(...Y.color),Dt.opacity=Y.opacity;const[Xt,Gt]=Dt.pageDimensions,ne=Dt.width*Xt,Pt=Dt.height*Gt,se=Dt.parentScale,Wt=Y.thickness/2;ot(Dt,f,!0),ot(Dt,y,Math.round(ne)),ot(Dt,l,Math.round(Pt));const{paths:D,rect:e,rotation:p}=Y;for(let{bezier:wt}of D){wt=Z(G=dt,Kt,Fn).call(G,wt,e,p);const Lt=[];Dt.paths.push(Lt);let It=se*(wt[0]-Wt),Qt=se*(wt[1]-Wt);for(let zt=2,Yt=wt.length;zt<Yt;zt+=6){const ee=se*(wt[zt]-Wt),re=se*(wt[zt+1]-Wt),ae=se*(wt[zt+2]-Wt),ce=se*(wt[zt+3]-Wt),le=se*(wt[zt+4]-Wt),pe=se*(wt[zt+5]-Wt);Lt.push([[It,Qt],[ee,re],[ae,ce],[le,pe]]),It=le,Qt=pe}const Ht=Z(this,vt,Rn).call(this,Lt);Dt.bezierPath2D.push(Ht)}const N=Z(tt=Dt,O,As).call(tt);return ot(Dt,g,Math.max(P.AnnotationEditor.MIN_SIZE,N[2]-N[0])),ot(Dt,F,Math.max(P.AnnotationEditor.MIN_SIZE,N[3]-N[1])),Z(ct=Dt,jt,ms).call(ct,ne,Pt),Dt}serialize(){if(this.isEmpty())return null;const Y=this.getRect(0,0),Tt=P.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:n.AnnotationEditorType.INK,color:Tt,thickness:this.thickness,opacity:this.opacity,paths:Z(this,Zt,Dn).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,Y),pageIndex:this.pageIndex,rect:Y,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};F=new WeakMap,g=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakMap,E=new WeakMap,w=new WeakMap,f=new WeakMap,b=new WeakMap,k=new WeakMap,x=new WeakMap,y=new WeakMap,l=new WeakMap,h=new WeakMap,I=new WeakSet,_n=function(Y){const Tt=this.thickness;this.addCommands({cmd:()=>{this.thickness=Y,Z(this,C,Ue).call(this)},undo:()=>{this.thickness=Tt,Z(this,C,Ue).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},J=new WeakSet,Sn=function(Y){const Tt=this.color;this.addCommands({cmd:()=>{this.color=Y,Z(this,B,Ee).call(this)},undo:()=>{this.color=Tt,Z(this,B,Ee).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},at=new WeakSet,En=function(Y){Y/=100;const Tt=this.opacity;this.addCommands({cmd:()=>{this.opacity=Y,Z(this,B,Ee).call(this)},undo:()=>{this.opacity=Tt,Z(this,B,Ee).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},Ct=new WeakSet,wn=function(){const{parentRotation:Y,parentDimensions:[Tt,Nt]}=this;switch(Y){case 90:return[0,Nt,Nt,Tt];case 180:return[Tt,Nt,Tt,Nt];case 270:return[Tt,0,Nt,Tt];default:return[0,0,Tt,Nt]}},ut=new WeakSet,fs=function(){const{ctx:Y,color:Tt,opacity:Nt,thickness:Dt,parentScale:Xt,scaleFactor:Gt}=this;Y.lineWidth=Dt*Xt/Gt,Y.lineCap="round",Y.lineJoin="round",Y.miterLimit=10,Y.strokeStyle=`${Tt}${(0,gt.opacityToHex)(Nt)}`},yt=new WeakSet,Cn=function(Y,Tt){this.canvas.addEventListener("contextmenu",q.noContextMenu),this.canvas.addEventListener("pointerleave",t(this,W)),this.canvas.addEventListener("pointermove",t(this,H)),this.canvas.addEventListener("pointerup",t(this,L)),this.canvas.removeEventListener("pointerdown",t(this,E)),this.isEditing=!0,t(this,k)||(ot(this,k,!0),Z(this,Vt,$e).call(this),this.thickness||(this.thickness=dt._defaultThickness),this.color||(this.color=dt._defaultColor||P.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=dt._defaultOpacity)),this.currentPath.push([Y,Tt]),ot(this,b,!1),Z(this,ut,fs).call(this),ot(this,h,()=>{Z(this,r,xn).call(this),t(this,h)&&window.requestAnimationFrame(t(this,h))}),window.requestAnimationFrame(t(this,h))},bt=new WeakSet,ps=function(Y,Tt){const[Nt,Dt]=this.currentPath.at(-1);if(this.currentPath.length>1&&Y===Nt&&Tt===Dt)return;const Xt=this.currentPath;let Gt=t(this,w);if(Xt.push([Y,Tt]),ot(this,b,!0),Xt.length<=2){Gt.moveTo(...Xt[0]),Gt.lineTo(Y,Tt);return}Xt.length===3&&(ot(this,w,Gt=new Path2D),Gt.moveTo(...Xt[0])),Z(this,c,kn).call(this,Gt,...Xt.at(-3),...Xt.at(-2),Y,Tt)},Ut=new WeakSet,Tn=function(){if(this.currentPath.length===0)return;const Y=this.currentPath.at(-1);t(this,w).lineTo(...Y)},T=new WeakSet,Pn=function(Y,Tt){ot(this,h,null),Y=Math.min(Math.max(Y,0),this.canvas.width),Tt=Math.min(Math.max(Tt,0),this.canvas.height),Z(this,bt,ps).call(this,Y,Tt),Z(this,Ut,Tn).call(this);let Nt;if(this.currentPath.length!==1)Nt=Z(this,m,Mn).call(this);else{const Pt=[Y,Tt];Nt=[[Pt,Pt.slice(),Pt.slice(),Pt]]}const Dt=t(this,w),Xt=this.currentPath;this.currentPath=[],ot(this,w,new Path2D);const Gt=()=>{this.allRawPaths.push(Xt),this.paths.push(Nt),this.bezierPath2D.push(Dt),this.rebuild()},ne=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(Z(this,mt,yi).call(this),Z(this,At,vi).call(this)),Z(this,C,Ue).call(this))};this.addCommands({cmd:Gt,undo:ne,mustExec:!0})},r=new WeakSet,xn=function(){if(!t(this,b))return;ot(this,b,!1);const Y=Math.ceil(this.thickness*this.parentScale),Tt=this.currentPath.slice(-3),Nt=Tt.map(Gt=>Gt[0]),Dt=Tt.map(Gt=>Gt[1]);Math.min(...Nt)-Y,Math.max(...Nt)+Y,Math.min(...Dt)-Y,Math.max(...Dt)+Y;const{ctx:Xt}=this;Xt.save(),Xt.clearRect(0,0,this.canvas.width,this.canvas.height);for(const Gt of this.bezierPath2D)Xt.stroke(Gt);Xt.stroke(t(this,w)),Xt.restore()},c=new WeakSet,kn=function(Y,Tt,Nt,Dt,Xt,Gt,ne){const Pt=(Tt+Dt)/2,se=(Nt+Xt)/2,Wt=(Dt+Gt)/2,D=(Xt+ne)/2;Y.bezierCurveTo(Pt+2*(Dt-Pt)/3,se+2*(Xt-se)/3,Wt+2*(Dt-Wt)/3,D+2*(Xt-D)/3,Wt,D)},m=new WeakSet,Mn=function(){const Y=this.currentPath;if(Y.length<=2)return[[Y[0],Y[0],Y.at(-1),Y.at(-1)]];const Tt=[];let Nt,[Dt,Xt]=Y[0];for(Nt=1;Nt<Y.length-2;Nt++){const[e,p]=Y[Nt],[N,G]=Y[Nt+1],tt=(e+N)/2,ct=(p+G)/2,wt=[Dt+2*(e-Dt)/3,Xt+2*(p-Xt)/3],Lt=[tt+2*(e-tt)/3,ct+2*(p-ct)/3];Tt.push([[Dt,Xt],wt,Lt,[tt,ct]]),[Dt,Xt]=[tt,ct]}const[Gt,ne]=Y[Nt],[Pt,se]=Y[Nt+1],Wt=[Dt+2*(Gt-Dt)/3,Xt+2*(ne-Xt)/3],D=[Pt+2*(Gt-Pt)/3,se+2*(ne-se)/3];return Tt.push([[Dt,Xt],Wt,D,[Pt,se]]),Tt},B=new WeakSet,Ee=function(){if(this.isEmpty()){Z(this,it,_i).call(this);return}Z(this,ut,fs).call(this);const{canvas:Y,ctx:Tt}=this;Tt.setTransform(1,0,0,1,0,0),Tt.clearRect(0,0,Y.width,Y.height),Z(this,it,_i).call(this);for(const Nt of this.bezierPath2D)Tt.stroke(Nt)},nt=new WeakSet,gs=function(Y){this.canvas.removeEventListener("pointerleave",t(this,W)),this.canvas.removeEventListener("pointermove",t(this,H)),this.canvas.removeEventListener("pointerup",t(this,L)),this.canvas.addEventListener("pointerdown",t(this,E)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",q.noContextMenu)},10),Z(this,T,Pn).call(this,Y.offsetX,Y.offsetY),this.addToAnnotationStorage(),this.setInBackground()},mt=new WeakSet,yi=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",P.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(Y=>{var Tt;return(Tt=this.canvas)==null?void 0:Tt.setAttribute("aria-label",Y)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},At=new WeakSet,vi=function(){ot(this,x,new ResizeObserver(Y=>{const Tt=Y[0].contentRect;Tt.width&&Tt.height&&this.setDimensions(Tt.width,Tt.height)})),t(this,x).observe(this.div)},Vt=new WeakSet,$e=function(){if(!t(this,k))return;const[Y,Tt]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*Y),this.canvas.height=Math.ceil(this.height*Tt),Z(this,it,_i).call(this)},jt=new WeakSet,ms=function(Y,Tt){const Nt=Z(this,v,Si).call(this),Dt=(Y-Nt)/t(this,g),Xt=(Tt-Nt)/t(this,F);this.scaleFactor=Math.min(Dt,Xt)},it=new WeakSet,_i=function(){const Y=Z(this,v,Si).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+Y,this.translationY*this.scaleFactor+Y)},vt=new WeakSet,Rn=function(Y){const Tt=new Path2D;for(let Nt=0,Dt=Y.length;Nt<Dt;Nt++){const[Xt,Gt,ne,Pt]=Y[Nt];Nt===0&&Tt.moveTo(...Xt),Tt.bezierCurveTo(Gt[0],Gt[1],ne[0],ne[1],Pt[0],Pt[1])}return Tt},Ot=new WeakSet,bs=function(Y,Tt,Nt){const[Dt,Xt,Gt,ne]=Tt;switch(Nt){case 0:for(let Pt=0,se=Y.length;Pt<se;Pt+=2)Y[Pt]+=Dt,Y[Pt+1]=ne-Y[Pt+1];break;case 90:for(let Pt=0,se=Y.length;Pt<se;Pt+=2){const Wt=Y[Pt];Y[Pt]=Y[Pt+1]+Dt,Y[Pt+1]=Wt+Xt}break;case 180:for(let Pt=0,se=Y.length;Pt<se;Pt+=2)Y[Pt]=Gt-Y[Pt],Y[Pt+1]+=Xt;break;case 270:for(let Pt=0,se=Y.length;Pt<se;Pt+=2){const Wt=Y[Pt];Y[Pt]=Gt-Y[Pt+1],Y[Pt+1]=ne-Wt}break;default:throw new Error("Invalid rotation")}return Y},Kt=new WeakSet,Fn=function(Y,Tt,Nt){const[Dt,Xt,Gt,ne]=Tt;switch(Nt){case 0:for(let Pt=0,se=Y.length;Pt<se;Pt+=2)Y[Pt]-=Dt,Y[Pt+1]=ne-Y[Pt+1];break;case 90:for(let Pt=0,se=Y.length;Pt<se;Pt+=2){const Wt=Y[Pt];Y[Pt]=Y[Pt+1]-Xt,Y[Pt+1]=Wt-Dt}break;case 180:for(let Pt=0,se=Y.length;Pt<se;Pt+=2)Y[Pt]=Gt-Y[Pt],Y[Pt+1]-=Xt;break;case 270:for(let Pt=0,se=Y.length;Pt<se;Pt+=2){const Wt=Y[Pt];Y[Pt]=ne-Y[Pt+1],Y[Pt+1]=Gt-Wt}break;default:throw new Error("Invalid rotation")}return Y},Zt=new WeakSet,Dn=function(Y,Tt,Nt,Dt){var se,Wt;const Xt=[],Gt=this.thickness/2,ne=Y*Tt+Gt,Pt=Y*Nt+Gt;for(const D of this.paths){const e=[],p=[];for(let N=0,G=D.length;N<G;N++){const[tt,ct,wt,Lt]=D[N],It=Y*tt[0]+ne,Qt=Y*tt[1]+Pt,Ht=Y*ct[0]+ne,zt=Y*ct[1]+Pt,Yt=Y*wt[0]+ne,ee=Y*wt[1]+Pt,re=Y*Lt[0]+ne,ae=Y*Lt[1]+Pt;N===0&&(e.push(It,Qt),p.push(It,Qt)),e.push(Ht,zt,Yt,ee,re,ae),p.push(Ht,zt),N===G-1&&p.push(re,ae)}Xt.push({bezier:Z(se=dt,Ot,bs).call(se,e,Dt,this.rotation),points:Z(Wt=dt,Ot,bs).call(Wt,p,Dt,this.rotation)})}return Xt},O=new WeakSet,As=function(){let Y=1/0,Tt=-1/0,Nt=1/0,Dt=-1/0;for(const Xt of this.paths)for(const[Gt,ne,Pt,se]of Xt){const Wt=n.Util.bezierBoundingBox(...Gt,...ne,...Pt,...se);Y=Math.min(Y,Wt[0]),Nt=Math.min(Nt,Wt[1]),Tt=Math.max(Tt,Wt[2]),Dt=Math.max(Dt,Wt[3])}return[Y,Nt,Tt,Dt]},v=new WeakSet,Si=function(){return t(this,f)?Math.ceil(this.thickness*this.parentScale):0},C=new WeakSet,Ue=function(Y=!1){if(this.isEmpty())return;if(!t(this,f)){Z(this,B,Ee).call(this);return}const Tt=Z(this,O,As).call(this),Nt=Z(this,v,Si).call(this);ot(this,g,Math.max(P.AnnotationEditor.MIN_SIZE,Tt[2]-Tt[0])),ot(this,F,Math.max(P.AnnotationEditor.MIN_SIZE,Tt[3]-Tt[1]));const Dt=Math.ceil(Nt+t(this,g)*this.scaleFactor),Xt=Math.ceil(Nt+t(this,F)*this.scaleFactor),[Gt,ne]=this.parentDimensions;this.width=Dt/Gt,this.height=Xt/ne,this.setAspectRatio(Dt,Xt);const Pt=this.translationX,se=this.translationY;this.translationX=-Tt[0],this.translationY=-Tt[1],Z(this,Vt,$e).call(this),Z(this,B,Ee).call(this),ot(this,y,Dt),ot(this,l,Xt),this.setDims(Dt,Xt);const Wt=Y?Nt/this.scaleFactor/2:0;this.translate(Pt-this.translationX-Wt,se-this.translationY-Wt)},$(dt,vt),$(dt,Ot),$(dt,Kt),oe(dt,"_defaultColor",null),oe(dt,"_defaultOpacity",1),oe(dt,"_defaultThickness",1),oe(dt,"_type","ink");let z=dt;o.InkEditor=z},(U,o,K)=>{var z,F,g,H,W,L,E,w,f,b,k,Ke,y,Je,h,Ei,Q,ys,_t,On,xt,In,j,vs,Et,wi,et,Ln;Object.defineProperty(o,"__esModule",{value:!0}),o.StampEditor=void 0;var n=K(1),P=K(4),V=K(6),q=K(29);const Rt=class Rt extends P.AnnotationEditor{constructor(T){super({...T,name:"stampEditor"});$(this,k);$(this,y);$(this,h);$(this,Q);$(this,_t);$(this,xt);$(this,j);$(this,Et);$(this,et);$(this,z,null);$(this,F,null);$(this,g,null);$(this,H,null);$(this,W,null);$(this,L,null);$(this,E,null);$(this,w,null);$(this,f,!1);$(this,b,!1);ot(this,H,T.bitmapUrl),ot(this,W,T.bitmapFile)}static initialize(T){P.AnnotationEditor.initialize(T)}static get supportedTypes(){const T=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,n.shadow)(this,"supportedTypes",T.map(i=>`image/${i}`))}static get supportedTypesStr(){return(0,n.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(T){return this.supportedTypes.includes(T)}static paste(T,i){i.pasteEditor(n.AnnotationEditorType.STAMP,{bitmapFile:T.getAsFile()})}remove(){var T,i;t(this,F)&&(ot(this,z,null),this._uiManager.imageManager.deleteId(t(this,F)),(T=t(this,L))==null||T.remove(),ot(this,L,null),(i=t(this,E))==null||i.disconnect(),ot(this,E,null)),super.remove()}rebuild(){if(!this.parent){t(this,F)&&Z(this,h,Ei).call(this);return}super.rebuild(),this.div!==null&&(t(this,F)&&Z(this,h,Ei).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(t(this,g)||t(this,z)||t(this,H)||t(this,W))}get isResizable(){return!0}render(){if(this.div)return this.div;let T,i;if(this.width&&(T=this.x,i=this.y),super.render(),this.div.hidden=!0,t(this,z)?Z(this,Q,ys).call(this):Z(this,h,Ei).call(this),this.width){const[r,s]=this.parentDimensions;this.setAt(T*r,i*s,this.width*r,this.height*s)}return this.div}static deserialize(T,i,r){if(T instanceof q.StampAnnotationElement)return null;const s=super.deserialize(T,i,r),{rect:c,bitmapUrl:d,bitmapId:m,isSvg:M,accessibilityData:B}=T;m&&r.imageManager.isValidId(m)?ot(s,F,m):ot(s,H,d),ot(s,f,M);const[lt,nt]=s.pageDimensions;return s.width=(c[2]-c[0])/lt,s.height=(c[3]-c[1])/nt,B&&(s.altTextData=B),s}serialize(T=!1,i=null){if(this.isEmpty())return null;const r={annotationType:n.AnnotationEditorType.STAMP,bitmapId:t(this,F),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:t(this,f),structTreeParentId:this._structTreeParentId};if(T)return r.bitmapUrl=Z(this,Et,wi).call(this,!0),r.accessibilityData=this.altTextData,r;const{decorative:s,altText:c}=this.altTextData;if(!s&&c&&(r.accessibilityData={type:"Figure",alt:c}),i===null)return r;i.stamps||(i.stamps=new Map);const d=t(this,f)?(r.rect[2]-r.rect[0])*(r.rect[3]-r.rect[1]):null;if(!i.stamps.has(t(this,F)))i.stamps.set(t(this,F),{area:d,serialized:r}),r.bitmap=Z(this,Et,wi).call(this,!1);else if(t(this,f)){const m=i.stamps.get(t(this,F));d>m.area&&(m.area=d,m.serialized.bitmap.close(),m.serialized.bitmap=Z(this,Et,wi).call(this,!1))}return r}};z=new WeakMap,F=new WeakMap,g=new WeakMap,H=new WeakMap,W=new WeakMap,L=new WeakMap,E=new WeakMap,w=new WeakMap,f=new WeakMap,b=new WeakMap,k=new WeakSet,Ke=function(T,i=!1){if(!T){this.remove();return}ot(this,z,T.bitmap),i||(ot(this,F,T.id),ot(this,f,T.isSvg)),Z(this,Q,ys).call(this)},y=new WeakSet,Je=function(){ot(this,g,null),this._uiManager.enableWaiting(!1),t(this,L)&&this.div.focus()},h=new WeakSet,Ei=function(){if(t(this,F)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(t(this,F)).then(i=>Z(this,k,Ke).call(this,i,!0)).finally(()=>Z(this,y,Je).call(this));return}if(t(this,H)){const i=t(this,H);ot(this,H,null),this._uiManager.enableWaiting(!0),ot(this,g,this._uiManager.imageManager.getFromUrl(i).then(r=>Z(this,k,Ke).call(this,r)).finally(()=>Z(this,y,Je).call(this)));return}if(t(this,W)){const i=t(this,W);ot(this,W,null),this._uiManager.enableWaiting(!0),ot(this,g,this._uiManager.imageManager.getFromFile(i).then(r=>Z(this,k,Ke).call(this,r)).finally(()=>Z(this,y,Je).call(this)));return}const T=document.createElement("input");T.type="file",T.accept=Rt.supportedTypesStr,ot(this,g,new Promise(i=>{T.addEventListener("change",async()=>{if(!T.files||T.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(T.files[0]);Z(this,k,Ke).call(this,r)}i()}),T.addEventListener("cancel",()=>{this.remove(),i()})}).finally(()=>Z(this,y,Je).call(this))),T.click()},Q=new WeakSet,ys=function(){const{div:T}=this;let{width:i,height:r}=t(this,z);const[s,c]=this.pageDimensions,d=.75;if(this.width)i=this.width*s,r=this.height*c;else if(i>d*s||r>d*c){const lt=Math.min(d*s/i,d*c/r);i*=lt,r*=lt}const[m,M]=this.parentDimensions;this.setDims(i*m/s,r*M/c),this._uiManager.enableWaiting(!1);const B=ot(this,L,document.createElement("canvas"));T.append(B),T.hidden=!1,Z(this,j,vs).call(this,i,r),Z(this,et,Ln).call(this),t(this,b)||(this.parent.addUndoableEditor(this),ot(this,b,!0)),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()},_t=new WeakSet,On=function(T,i){var d;const[r,s]=this.parentDimensions;this.width=T/r,this.height=i/s,this.setDims(T,i),(d=this._initialOptions)!=null&&d.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,t(this,w)!==null&&clearTimeout(t(this,w)),ot(this,w,setTimeout(()=>{ot(this,w,null),Z(this,j,vs).call(this,T,i)},200))},xt=new WeakSet,In=function(T,i){const{width:r,height:s}=t(this,z);let c=r,d=s,m=t(this,z);for(;c>2*T||d>2*i;){const M=c,B=d;c>2*T&&(c=c>=16384?Math.floor(c/2)-1:Math.ceil(c/2)),d>2*i&&(d=d>=16384?Math.floor(d/2)-1:Math.ceil(d/2));const lt=new OffscreenCanvas(c,d);lt.getContext("2d").drawImage(m,0,0,M,B,0,0,c,d),m=lt.transferToImageBitmap()}return m},j=new WeakSet,vs=function(T,i){T=Math.ceil(T),i=Math.ceil(i);const r=t(this,L);if(!r||r.width===T&&r.height===i)return;r.width=T,r.height=i;const s=t(this,f)?t(this,z):Z(this,xt,In).call(this,T,i),c=r.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(s,0,0,s.width,s.height,0,0,T,i)},Et=new WeakSet,wi=function(T){if(T){if(t(this,f)){const s=this._uiManager.imageManager.getSvgUrl(t(this,F));if(s)return s}const i=document.createElement("canvas");return{width:i.width,height:i.height}=t(this,z),i.getContext("2d").drawImage(t(this,z),0,0),i.toDataURL()}if(t(this,f)){const[i,r]=this.pageDimensions,s=Math.round(this.width*i*V.PixelsPerInch.PDF_TO_CSS_UNITS),c=Math.round(this.height*r*V.PixelsPerInch.PDF_TO_CSS_UNITS),d=new OffscreenCanvas(s,c);return d.getContext("2d").drawImage(t(this,z),0,0,t(this,z).width,t(this,z).height,0,0,s,c),d.transferToImageBitmap()}return structuredClone(t(this,z))},et=new WeakSet,Ln=function(){ot(this,E,new ResizeObserver(T=>{const i=T[0].contentRect;i.width&&i.height&&Z(this,_t,On).call(this,i.width,i.height)})),t(this,E).observe(this.div)},oe(Rt,"_type","stamp");let gt=Rt;o.StampEditor=gt}],_={};function R(U){var o=_[U];if(o!==void 0)return o.exports;var K=_[U]={exports:{}};return u[U](K,K.exports,R),K.exports}var ht={};return(()=>{var U=ht;Object.defineProperty(U,"__esModule",{value:!0}),Object.defineProperty(U,"AbortException",{enumerable:!0,get:function(){return o.AbortException}}),Object.defineProperty(U,"AnnotationEditorLayer",{enumerable:!0,get:function(){return V.AnnotationEditorLayer}}),Object.defineProperty(U,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return o.AnnotationEditorParamsType}}),Object.defineProperty(U,"AnnotationEditorType",{enumerable:!0,get:function(){return o.AnnotationEditorType}}),Object.defineProperty(U,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return q.AnnotationEditorUIManager}}),Object.defineProperty(U,"AnnotationLayer",{enumerable:!0,get:function(){return gt.AnnotationLayer}}),Object.defineProperty(U,"AnnotationMode",{enumerable:!0,get:function(){return o.AnnotationMode}}),Object.defineProperty(U,"CMapCompressionType",{enumerable:!0,get:function(){return o.CMapCompressionType}}),Object.defineProperty(U,"DOMSVGFactory",{enumerable:!0,get:function(){return n.DOMSVGFactory}}),Object.defineProperty(U,"FeatureTest",{enumerable:!0,get:function(){return o.FeatureTest}}),Object.defineProperty(U,"GlobalWorkerOptions",{enumerable:!0,get:function(){return z.GlobalWorkerOptions}}),Object.defineProperty(U,"ImageKind",{enumerable:!0,get:function(){return o.ImageKind}}),Object.defineProperty(U,"InvalidPDFException",{enumerable:!0,get:function(){return o.InvalidPDFException}}),Object.defineProperty(U,"MissingPDFException",{enumerable:!0,get:function(){return o.MissingPDFException}}),Object.defineProperty(U,"OPS",{enumerable:!0,get:function(){return o.OPS}}),Object.defineProperty(U,"PDFDataRangeTransport",{enumerable:!0,get:function(){return K.PDFDataRangeTransport}}),Object.defineProperty(U,"PDFDateString",{enumerable:!0,get:function(){return n.PDFDateString}}),Object.defineProperty(U,"PDFWorker",{enumerable:!0,get:function(){return K.PDFWorker}}),Object.defineProperty(U,"PasswordResponses",{enumerable:!0,get:function(){return o.PasswordResponses}}),Object.defineProperty(U,"PermissionFlag",{enumerable:!0,get:function(){return o.PermissionFlag}}),Object.defineProperty(U,"PixelsPerInch",{enumerable:!0,get:function(){return n.PixelsPerInch}}),Object.defineProperty(U,"PromiseCapability",{enumerable:!0,get:function(){return o.PromiseCapability}}),Object.defineProperty(U,"RenderingCancelledException",{enumerable:!0,get:function(){return n.RenderingCancelledException}}),Object.defineProperty(U,"SVGGraphics",{enumerable:!0,get:function(){return K.SVGGraphics}}),Object.defineProperty(U,"UnexpectedResponseException",{enumerable:!0,get:function(){return o.UnexpectedResponseException}}),Object.defineProperty(U,"Util",{enumerable:!0,get:function(){return o.Util}}),Object.defineProperty(U,"VerbosityLevel",{enumerable:!0,get:function(){return o.VerbosityLevel}}),Object.defineProperty(U,"XfaLayer",{enumerable:!0,get:function(){return F.XfaLayer}}),Object.defineProperty(U,"build",{enumerable:!0,get:function(){return K.build}}),Object.defineProperty(U,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return o.createValidAbsoluteUrl}}),Object.defineProperty(U,"getDocument",{enumerable:!0,get:function(){return K.getDocument}}),Object.defineProperty(U,"getFilenameFromUrl",{enumerable:!0,get:function(){return n.getFilenameFromUrl}}),Object.defineProperty(U,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return n.getPdfFilenameFromUrl}}),Object.defineProperty(U,"getXfaPageViewport",{enumerable:!0,get:function(){return n.getXfaPageViewport}}),Object.defineProperty(U,"isDataScheme",{enumerable:!0,get:function(){return n.isDataScheme}}),Object.defineProperty(U,"isPdfFile",{enumerable:!0,get:function(){return n.isPdfFile}}),Object.defineProperty(U,"loadScript",{enumerable:!0,get:function(){return n.loadScript}}),Object.defineProperty(U,"noContextMenu",{enumerable:!0,get:function(){return n.noContextMenu}}),Object.defineProperty(U,"normalizeUnicode",{enumerable:!0,get:function(){return o.normalizeUnicode}}),Object.defineProperty(U,"renderTextLayer",{enumerable:!0,get:function(){return P.renderTextLayer}}),Object.defineProperty(U,"setLayerDimensions",{enumerable:!0,get:function(){return n.setLayerDimensions}}),Object.defineProperty(U,"shadow",{enumerable:!0,get:function(){return o.shadow}}),Object.defineProperty(U,"updateTextLayer",{enumerable:!0,get:function(){return P.updateTextLayer}}),Object.defineProperty(U,"version",{enumerable:!0,get:function(){return K.version}});var o=R(1),K=R(2),n=R(6),P=R(26),V=R(27),q=R(5),gt=R(29),z=R(14),F=R(32)})(),ht})())})(en);var Nn=en.exports,kr=Object.defineProperty,Mr=Object.getOwnPropertyDescriptor,Rr=(A,a,u,_)=>{for(var R=_>1?void 0:_?Mr(a,u):a,ht=A.length-1,U;ht>=0;ht--)(U=A[ht])&&(R=(_?U(a,u,R):U(R))||R);return _&&R&&kr(a,u,R),R};Nn.GlobalWorkerOptions.workerSrc="pdf.worker.js";let _s=class extends Ae{constructor(){super(...arguments),this.tabIndex=0,this.onkeydown=A=>{A.key==="ArrowRight"?(this.currentPage++,this.fireSelectEvent()):A.key==="ArrowLeft"&&(this.currentPage--,this.fireSelectEvent())}}render(){return be`<slot></slot>`}async load(A){this.innerHTML="";const a=await Nn.getDocument(A).promise,u=window.devicePixelRatio||1;for(let _=0;_<a.numPages;_++){const R=await a.getPage(_+1),ht=R.getViewport({scale:1}),U=document.createElement("canvas"),o=U.getContext("2d");U.height=ht.height*u,U.width=ht.width*u,this.appendChild(U),U.onclick=()=>{this.currentPage=_,this.fireSelectEvent()};const K=u!==1?[u,0,0,u,0,0]:void 0;await R.render({canvasContext:o,viewport:ht,transform:K}).promise}}set currentPage(A){const a=[...this.children];A=Math.max(0,Math.min(a.length-1,A));const u=a[A];a.forEach(_=>_.removeAttribute("selected")),u.setAttribute("selected",""),u.scrollIntoView({block:"center"})}get currentPage(){return[...this.children].findIndex(A=>A.hasAttribute("selected"))}connectedCallback(){super.connectedCallback(),this.load("martin.pdf")}fireSelectEvent(){this.dispatchEvent(new CustomEvent("select",{detail:this.currentPage}))}};_s.styles=Se`
    :host {
      min-height: 50px;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      align-items: center;
      overflow: auto;
      padding: 0.5rem;
      outline: none;
    }
    :host:fullscreen {
      background: black;
    }
    ::slotted(canvas) {
      max-height: 100%;
      max-width: 100%;
    }
    ::slotted(canvas[selected]) {
      box-shadow: 0 0 0 5px var(--color-cyan);
    }
  `;_s=Rr([Te("pdf-viewer")],_s);var Fr=Object.defineProperty,Dr=Object.getOwnPropertyDescriptor,oi=(A,a,u,_)=>{for(var R=_>1?void 0:_?Dr(a,u):a,ht=A.length-1,U;ht>=0;ht--)(U=A[ht])&&(R=(_?U(a,u,R):U(R))||R);return _&&R&&Fr(a,u,R),R};const js=localStorage.getItem("recognitionOptions"),li=js?JSON.parse(js):{minDistance:7,maxDistance:42,seekStep:2.6,treshold:100},ci={minDistance:"Shortest seek distance from current frame.",maxDistance:"Longest seek distance from current frame.",seekStep:"How many frames to add to seek distance when recognizer predicts the same frame as before.",treshold:"How different a frame from recording can be to be considered a match. 0 means identical, 255 means completely different."};let Re=class extends Ae{constructor(){super(...arguments),this.minDistance=li.minDistance,this.maxDistance=li.maxDistance,this.seekStep=li.seekStep,this.treshold=li.treshold}render(){return be`
      <div>
        <label for="minDistance" title=${ci.minDistance}>Min Distance</label>
        <input 
          type="number" id="minDistance"
          min="1" max=${this.maxDistance-1}
          .value=${this.minDistance.toString()} 
          @change=${A=>{this.minDistance=Number(A.target.value),this.maxDistance=Math.max(this.minDistance+1,this.maxDistance)}} />
      </div>
      <div>
        <label for="maxDistance" title=${ci.maxDistance}>Max Distance</label>
        <input 
          type="number" id="maxDistance" 
          min=${this.minDistance+1}
          .value=${this.maxDistance.toString()}
          @change=${A=>{this.maxDistance=Number(A.target.value),this.minDistance=Math.max(0,Math.min(this.maxDistance-1,this.minDistance))}} />
      </div>
      <div>
        <label for="seekStep" title=${ci.seekStep}>Seek Step</label>
        <input 
          type="number" id="seekStep"
          step=".1" min="1"
          .value=${this.seekStep.toString()} 
          @change=${A=>this.seekStep=Number(A.target.value)} />
      </div>
      <div>
        <label for="treshold" title=${ci.treshold}>Treshold</label>
        <input 
          type="number" id="treshold" 
          min="0" max="255" 
          .value=${this.treshold.toString()} 
          @input=${A=>this.treshold=Number(A.target.value)} 
        />
      </div>
    `}updated(){localStorage.setItem("recognitionOptions",JSON.stringify({minDistance:this.minDistance,maxDistance:this.maxDistance,seekStep:this.seekStep,treshold:this.treshold}))}};Re.styles=Se`
    :host {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 1em;
      justify-content: center;
      margin: 0 auto;
    }
    div {
      min-width: 120px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
    }
    input {
      margin: 0.5em 0;
      width: 6ch;
    }

  `;oi([fe({type:Number})],Re.prototype,"minDistance",2);oi([fe({type:Number})],Re.prototype,"maxDistance",2);oi([fe({type:Number})],Re.prototype,"seekStep",2);oi([fe({type:Number})],Re.prototype,"treshold",2);Re=oi([Te("recognition-options")],Re);var Or=Object.defineProperty,Ir=Object.getOwnPropertyDescriptor,$n=(A,a,u,_)=>{for(var R=_>1?void 0:_?Ir(a,u):a,ht=A.length-1,U;ht>=0;ht--)(U=A[ht])&&(R=(_?U(a,u,R):U(R))||R);return _&&R&&Or(a,u,R),R};let $i=1,ki=class extends Ae{constructor(){super(...arguments),this.position=0}render(){return this.recording?be`
      <div class="container">
        ${this.recording.markings.map((A,a)=>{const[u,_]=A;return be`
            <div
              class="mark"
              style="left: ${u/this.recording.data.length*100}%"
              @click=${()=>{this.dispatchEvent(new CustomEvent("select",{detail:{position:u,mark:_}}))}}
              @dblclick=${()=>{this.recording.markings.splice(a,1),this.requestUpdate(),this.fireChangeEvent(),$i=_}}
            >${_.toString()}</div>
          `})}
      </div>

      <button
        @click=${()=>{const A=parseInt(prompt("Input page number",$i.toString())||"0");!A||A<1||($i=A+1,this.recording.markings.push([this.position,A]),this.recording.markings.sort((a,u)=>a[0]-u[0]),this.requestUpdate(),this.fireChangeEvent())}}
      >Add Mark</button> 

      Double tap to remove
    `:null}fireChangeEvent(){this.dispatchEvent(new CustomEvent("change"))}};ki.styles=[Ts,Se`
      :host {
        display: block;
        text-align: center;
      }
      .container {
        position: relative;
        height: 1rem;
        margin-bottom: .5rem;
      }
      .mark {
        position: absolute;
        transform: translateX(-50%);
        border-radius: 50%;
        background: var(--theme-color-background-light);
        width: 1rem;
        height: 1rem;
        font-size: .7rem;
        line-height: 1rem;
        text-align: center;
        cursor: pointer;
        user-select: none;
      }
    `];$n([fe({type:Object})],ki.prototype,"recording",2);ki=$n([Te("markings-editor")],ki);const Lr=Se`
  input {
    background: var(--theme-color-background-light);
    border: none;
    outline: none;
    display: block;
    box-sizing: border-box;
  }

  input[type="range"] {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    margin: .2em 0;
    border-radius: .2em;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    width: .1em;
    height: .1em;
    scale: 8;
    border-radius: .1em;
    background: var(--theme-color-primary);
    cursor: pointer;
  }

`;class Nr{constructor(a){this.recording=a,this.position=0,this.searchDistance=1}getDifferences(a,u=0,_=this.recording.data.length){return new Uint8Array(this.recording.data.slice(u,_).map(R=>new Uint8Array(R.map((ht,U)=>Math.abs(ht-a[U]),0))).map(R=>Math.max(...R)))}guess(a,{treshold:u=100,minDistance:_=7,maxDistance:R=42,seekStep:ht=1.618}={}){if(this.position>=this.recording.data.length-this.searchDistance)return{over:!0};const U=this.getDifferences(a,this.position,this.position+Math.max(Math.round(this.searchDistance),_)),o=Math.min(...U),K=this.position+U.lastIndexOf(o);o>u||K===this.position?this.searchDistance=Math.min(this.searchDistance+ht,R):(this.searchDistance=1,this.position=K);const n=this.recording.markings.length?this.recording.markings.reduce((P,V)=>V[0]<=this.position?V:P)[1]:void 0;return{position:this.position,mark:n,differences:U}}}class $r{constructor(){this.data=[],this.markings=[]}clear(){this.data.length=0,this.markings.length=0}export(){return{data:this.data.map(u=>{const _=[];let R=u[0],ht=1;for(let U=1;U<u.length;U++)u[U]===R?ht++:(ht>1?_.push([R,ht]):_.push(R),R=u[U],ht=1);return ht>1?_.push([R,ht]):_.push(R),_}),markings:this.markings}}import({data:a,markings:u}){this.clear();for(const _ of a){const R=[];for(const ht of _)if(Array.isArray(ht)){const[U,o]=ht;R.push(...new Array(o).fill(U))}else R.push(ht);this.data.push(new Uint8Array(R))}this.markings=u}createFollower(){return new Nr(this)}}const ks=(()=>{if(typeof self>"u")return!1;if("top"in self&&self!==top)try{top.window.document._=0}catch{return!1}return"showOpenFilePicker"in self})(),Ur=ks?Promise.resolve().then(function(){return zr}):Promise.resolve().then(function(){return Kr});async function Ws(...A){return(await Ur).default(...A)}ks?Promise.resolve().then(function(){return Xr}):Promise.resolve().then(function(){return Qr});const Br=ks?Promise.resolve().then(function(){return qr}):Promise.resolve().then(function(){return ta});async function Hr(...A){return(await Br).default(...A)}const jr=async A=>{const a=await A.getFile();return a.handle=A,a};var Wr=async(A=[{}])=>{Array.isArray(A)||(A=[A]);const a=[];A.forEach((R,ht)=>{a[ht]={description:R.description||"Files",accept:{}},R.mimeTypes?R.mimeTypes.map(U=>{a[ht].accept[U]=R.extensions||[]}):a[ht].accept["*/*"]=R.extensions||[]});const u=await window.showOpenFilePicker({id:A[0].id,startIn:A[0].startIn,types:a,multiple:A[0].multiple||!1,excludeAcceptAllOption:A[0].excludeAcceptAllOption||!1}),_=await Promise.all(u.map(jr));return A[0].multiple?_:_[0]},zr={__proto__:null,default:Wr};function Ci(A){function a(u){if(Object(u)!==u)return Promise.reject(new TypeError(u+" is not an object."));var _=u.done;return Promise.resolve(u.value).then(function(R){return{value:R,done:_}})}return Ci=function(u){this.s=u,this.n=u.next},Ci.prototype={s:null,n:null,next:function(){return a(this.n.apply(this.s,arguments))},return:function(u){var _=this.s.return;return _===void 0?Promise.resolve({value:u,done:!0}):a(_.apply(this.s,arguments))},throw:function(u){var _=this.s.return;return _===void 0?Promise.reject(u):a(_.apply(this.s,arguments))}},new Ci(A)}const Un=async(A,a,u=A.name,_)=>{const R=[],ht=[];var U,o=!1,K=!1;try{for(var n,P=function(V){var q,gt,z,F=2;for(typeof Symbol<"u"&&(gt=Symbol.asyncIterator,z=Symbol.iterator);F--;){if(gt&&(q=V[gt])!=null)return q.call(V);if(z&&(q=V[z])!=null)return new Ci(q.call(V));gt="@@asyncIterator",z="@@iterator"}throw new TypeError("Object is not async iterable")}(A.values());o=!(n=await P.next()).done;o=!1){const V=n.value,q=`${u}/${V.name}`;V.kind==="file"?ht.push(V.getFile().then(gt=>(gt.directoryHandle=A,gt.handle=V,Object.defineProperty(gt,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>q})))):V.kind!=="directory"||!a||_&&_(V)||R.push(Un(V,a,q,_))}}catch(V){K=!0,U=V}finally{try{o&&P.return!=null&&await P.return()}finally{if(K)throw U}}return[...(await Promise.all(R)).flat(),...await Promise.all(ht)]};var Gr=async(A={})=>{A.recursive=A.recursive||!1,A.mode=A.mode||"read";const a=await window.showDirectoryPicker({id:A.id,startIn:A.startIn,mode:A.mode});return(await(await a.values()).next()).done?[a]:Un(a,A.recursive,void 0,A.skipDirectory)},Xr={__proto__:null,default:Gr},Vr=async(A,a=[{}],u=null,_=!1,R=null)=>{Array.isArray(a)||(a=[a]),a[0].fileName=a[0].fileName||"Untitled";const ht=[];let U=null;if(A instanceof Blob&&A.type?U=A.type:A.headers&&A.headers.get("content-type")&&(U=A.headers.get("content-type")),a.forEach((n,P)=>{ht[P]={description:n.description||"Files",accept:{}},n.mimeTypes?(P===0&&U&&n.mimeTypes.push(U),n.mimeTypes.map(V=>{ht[P].accept[V]=n.extensions||[]})):U?ht[P].accept[U]=n.extensions||[]:ht[P].accept["*/*"]=n.extensions||[]}),u)try{await u.getFile()}catch(n){if(u=null,_)throw n}const o=u||await window.showSaveFilePicker({suggestedName:a[0].fileName,id:a[0].id,startIn:a[0].startIn,types:ht,excludeAcceptAllOption:a[0].excludeAcceptAllOption||!1});!u&&R&&R(o);const K=await o.createWritable();return"stream"in A?(await A.stream().pipeTo(K),o):"body"in A?(await A.body.pipeTo(K),o):(await K.write(await A),await K.close(),o)},qr={__proto__:null,default:Vr},Yr=async(A=[{}])=>(Array.isArray(A)||(A=[A]),new Promise((a,u)=>{const _=document.createElement("input");_.type="file";const R=[...A.map(K=>K.mimeTypes||[]),...A.map(K=>K.extensions||[])].join();_.multiple=A[0].multiple||!1,_.accept=R||"",_.style.display="none",document.body.append(_);const ht=K=>{typeof U=="function"&&U(),a(K)},U=A[0].legacySetup&&A[0].legacySetup(ht,()=>U(u),_),o=()=>{window.removeEventListener("focus",o),_.remove()};_.addEventListener("click",()=>{window.addEventListener("focus",o)}),_.addEventListener("change",()=>{window.removeEventListener("focus",o),_.remove(),ht(_.multiple?Array.from(_.files):_.files[0])}),"showPicker"in HTMLInputElement.prototype?_.showPicker():_.click()})),Kr={__proto__:null,default:Yr},Jr=async(A=[{}])=>(Array.isArray(A)||(A=[A]),A[0].recursive=A[0].recursive||!1,new Promise((a,u)=>{const _=document.createElement("input");_.type="file",_.webkitdirectory=!0;const R=U=>{typeof ht=="function"&&ht(),a(U)},ht=A[0].legacySetup&&A[0].legacySetup(R,()=>ht(u),_);_.addEventListener("change",()=>{let U=Array.from(_.files);A[0].recursive?A[0].recursive&&A[0].skipDirectory&&(U=U.filter(o=>o.webkitRelativePath.split("/").every(K=>!A[0].skipDirectory({name:K,kind:"directory"})))):U=U.filter(o=>o.webkitRelativePath.split("/").length===2),R(U)}),"showPicker"in HTMLInputElement.prototype?_.showPicker():_.click()})),Qr={__proto__:null,default:Jr},Zr=async(A,a={})=>{Array.isArray(a)&&(a=a[0]);const u=document.createElement("a");let _=A;"body"in A&&(_=await async function(U,o){const K=U.getReader(),n=new ReadableStream({start:q=>async function gt(){return K.read().then(({done:z,value:F})=>{if(!z)return q.enqueue(F),gt();q.close()})}()}),P=new Response(n),V=await P.blob();return K.releaseLock(),new Blob([V],{type:o})}(A.body,A.headers.get("content-type"))),u.download=a.fileName||"Untitled",u.href=URL.createObjectURL(await _);const R=()=>{typeof ht=="function"&&ht()},ht=a.legacySetup&&a.legacySetup(R,()=>ht(),u);return u.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(u.href),3e4),R()}),u.click(),null},ta={__proto__:null,default:Zr};function Ms(A){return new Promise((a,u)=>{A.oncomplete=A.onsuccess=()=>a(A.result),A.onabort=A.onerror=()=>u(A.error)})}function ea(A,a){const u=indexedDB.open(A);u.onupgradeneeded=()=>u.result.createObjectStore(a);const _=Ms(u);return(R,ht)=>_.then(U=>ht(U.transaction(a,R).objectStore(a)))}let Ui;function Bn(){return Ui||(Ui=ea("keyval-store","keyval")),Ui}function zs(A,a=Bn()){return a("readonly",u=>Ms(u.get(A)))}function Bi(A,a,u=Bn()){return u("readwrite",_=>(_.put(a,A),Ms(_.transaction)))}var ia=Object.defineProperty,sa=Object.getOwnPropertyDescriptor,ue=(A,a,u,_)=>{for(var R=_>1?void 0:_?sa(a,u):a,ht=A.length-1,U;ht>=0;ht--)(U=A[ht])&&(R=(_?U(a,u,R):U(R))||R);return _&&R&&ia(a,u,R),R};let he=class extends Ae{constructor(){super(...arguments),this.recording=new $r,this.follower=this.recording.createFollower(),this.savedState=!0,this.recentAvailable=!1}render(){return[this.renderHeader(),this.renderViewer(),this.renderRecording(),this.renderPageTurner()]}set position(A){this.follower.position=A,this.positionSlider.max=this.recording.data.length.toString(),this.positionSlider.value=A.toString(),this.markings.position=A;const a=this.scrollable.scrollWidth-this.scrollable.clientWidth,u=A/this.recording.data.length;this.scrollable.scrollTo({left:u*a,behavior:"auto"})}get position(){return parseInt(this.positionSlider.value)}connectedCallback(){super.connectedCallback(),this.loadRecent()}async loadRecent(){this.recentPDF=await zs("pdf"),this.recentRecording=await zs("recording")}renderHeader(){var A;return be`
      <header>

        <button
          title="Open PDF"
          @click=${async()=>{const a=await Ws({mimeTypes:["application/pdf"]}),u=await a.arrayBuffer();this.viewer.load(u),a.handle&&Bi("pdf",a.handle)}}
        >
          📄
        </button>

        <button
          title="Fullscreen"
          @click=${()=>{this.viewer.requestFullscreen(),this.viewer.focus()}}
        >
          ↗️
        </button>

        <button
          ?hidden=${!this.recentPDF}
          title="Open Recent PDF - ${(A=this.recentPDF)==null?void 0:A.name}"
          @click=${async()=>{if(!this.recentPDF||!await Gs(this.recentPDF))return;const u=await(await this.recentPDF.getFile()).arrayBuffer();await this.viewer.load(u),this.recentPDF=void 0}}
        >
          🕒
        </button>

      </header>
    `}renderViewer(){return be`
      <pdf-viewer
        @select=${A=>{console.log("Selected page",A.detail);const a=this.recording.markings.filter(_=>_[1]===A.detail+1);if(a.length===0)return;const u=a.reduce((_,R)=>Math.abs(R[0]-this.position)<Math.abs(_[0]-this.position)?R:_);this.position=u[0]}}
      ></pdf-viewer>
    `}renderRecording(){var A;return be`
      <collapsable-container
        id="recording"
        title=${"Recording"+(this.recordingFile?" - "+this.recordingFile.name.replace(/\.json$/,""):"")}
        description=${this.savedState?"":"Unsaved changes"}
      >
        <frequency-recorder
          id="recorder"
          title="Record"
          slot="header"
          @data=${a=>{this.recording.data.push(a.detail)}}
          @start=${()=>{this.recognizer.stop(),this.recording.clear(),this.spectrogram.requestUpdate()}}
          @stop=${()=>{this.spectrogram.requestUpdate(),this.markings.requestUpdate(),this.savedState=!1,this.recordingFile=void 0,this.position=0,this.recordingElement.setAttribute("open","")}}
        >
          🎙 Record
        </frequency-recorder>

        <button
          title="Open Recording"
          slot="header"
          @click=${async()=>{const a=await Ws({mimeTypes:["application/json"]}),u=await a.text();this.recording.import(JSON.parse(u)),this.spectrogram.requestUpdate(),this.markings.requestUpdate(),this.position=0,this.savedState=!0,this.recordingElement.setAttribute("open",""),a.handle&&(this.recordingFile=a.handle,Bi("recording",a.handle))}}
        >
          📂
        </button>

        <button
          ?hidden=${!this.recentRecording}
          title="Open Recent Recording - ${(A=this.recentRecording)==null?void 0:A.name}"
          slot="header"
          @click=${async()=>{if(!this.recentRecording||!await Gs(this.recentRecording))return;const u=await(await this.recentRecording.getFile()).text();this.recording.import(JSON.parse(u)),this.spectrogram.requestUpdate(),this.markings.requestUpdate(),this.position=0,this.savedState=!0,this.recordingElement.setAttribute("open",""),this.recordingFile=this.recentRecording,this.recentRecording=void 0}}
        >
          🕒
        </button>

        <button
          title="Save Recording"
          slot="header"
          ?hidden=${this.savedState}
          @click=${async()=>{const a=JSON.stringify(this.recording.export()),u=new Blob([a],{type:"application/json"}),_=await Hr(u,{fileName:"Recording.json",extensions:[".json"]},this.recordingFile);this.savedState=!0,_&&(this.recordingFile=_,Bi("recording",_))}}
        >
          💾
        </button>

        <div class="container">
          <div
            id="scrollable"
            @mousewheel=${a=>{a.preventDefault(),this.position=Math.max(0,Math.min(this.recording.data.length,this.position+a.deltaX+a.deltaY))}}
          >
            <graph-2d
              id="spectrogram"
              .data=${this.recording.data}
              @select=${a=>{const{column:u,row:_}=a.detail;console.log(`Frame: ${u}, Row: ${_}, Value: ${this.recording.data[u][_]}`),this.position=u}}
            ></graph-2d>

            <graph-1d id="similarity"></graph-1d>
          </div>

          <input
            type="range"
            id="position"
            min="0"
            max=${this.recording.data.length}
            value="0"
            @input=${()=>this.position=parseInt(this.positionSlider.value)}
          />
          
          <markings-editor
            .recording=${this.recording}
            @select=${a=>{const{position:u}=a.detail;this.position=u}}
            @change=${()=>{this.savedState=!1}}
          ></markings-editor>

        </div>

      </collapsable-container>
    `}renderPageTurner(){return be`
      <collapsable-container title="Page Turner">

        <frequency-recorder
          id="recognizer"
          title="Recognize"
          slot="header"
          @data=${A=>{const{position:a,mark:u,differences:_,over:R}=this.follower.guess(A.detail,this.recognitionOptions);if(R)return this.recognizer.stop();this.position=a||0;const ht=new Uint8Array(this.recording.data.length);_==null||_.forEach((U,o)=>ht[o+this.position]=U),this.similarity.data=ht,u&&(this.viewer.currentPage=u-1)}}
          @start=${()=>{this.recorder.stop(),this.position=0,this.follower.searchDistance=0}}
        >
          🔎 Recognize
        </frequency-recorder>

        <recognition-options></recognition-options>

      </collapsable-container>
    `}};he.styles=[Lr,Ts,Se`
      :host {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100%;
      }

      header {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.5em;
        margin: 10px;
      }

      pdf-viewer {
        flex: 1;
      }

      #position {
        width: 100%;
      }

      #scrollable {
        overflow: hidden;
        border: 1px solid grey;
        background: var(--color-black);
      }

      .container {
        width: min-content;
        max-width: 100%;
        margin: 0 auto;
      }
    `];ue([ye("pdf-viewer")],he.prototype,"viewer",2);ue([ye("#recording")],he.prototype,"recordingElement",2);ue([ye("#recorder")],he.prototype,"recorder",2);ue([ye("#scrollable")],he.prototype,"scrollable",2);ue([ye("#spectrogram")],he.prototype,"spectrogram",2);ue([ye("#similarity")],he.prototype,"similarity",2);ue([ye("#position")],he.prototype,"positionSlider",2);ue([ye("markings-editor")],he.prototype,"markings",2);ue([ye("#recognizer")],he.prototype,"recognizer",2);ue([ye("recognition-options")],he.prototype,"recognitionOptions",2);ue([fe({type:Object})],he.prototype,"recording",2);ue([fe({type:Object})],he.prototype,"recordingFile",2);ue([fe({type:Boolean})],he.prototype,"savedState",2);ue([fe({type:Boolean})],he.prototype,"recentAvailable",2);ue([fe({type:Object})],he.prototype,"recentPDF",2);ue([fe({type:Object})],he.prototype,"recentRecording",2);he=ue([Te("my-app")],he);async function Gs(A,a=!1){const u=a?{mode:"readwrite"}:{};return await A.queryPermission(u)==="granted"||await A.requestPermission(u)==="granted"}
