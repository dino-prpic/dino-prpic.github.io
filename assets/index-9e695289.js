var Hs=Object.defineProperty;var Ws=(K,F,B)=>F in K?Hs(K,F,{enumerable:!0,configurable:!0,writable:!0,value:B}):K[F]=B;var je=(K,F,B)=>(Ws(K,typeof F!="symbol"?F+"":F,B),B),Ei=(K,F,B)=>{if(!F.has(K))throw TypeError("Cannot "+B)};var O=(K,F,B)=>(Ei(K,F,"read from private field"),B?B.call(K):F.get(K)),xt=(K,F,B)=>{if(F.has(K))throw TypeError("Cannot add the same private member more than once");F instanceof WeakSet?F.add(K):F.set(K,B)},Ht=(K,F,B,D)=>(Ei(K,F,"write to private field"),D?D.call(K,B):F.set(K,B),B);var ei=(K,F,B,D)=>({set _(U){Ht(K,F,U,B)},get _(){return O(K,F,D)}}),Ft=(K,F,B)=>(Ei(K,F,"access private method"),B);(function(){const F=document.createElement("link").relList;if(F&&F.supports&&F.supports("modulepreload"))return;for(const U of document.querySelectorAll('link[rel="modulepreload"]'))D(U);new MutationObserver(U=>{for(const ct of U)if(ct.type==="childList")for(const it of ct.addedNodes)it.tagName==="LINK"&&it.rel==="modulepreload"&&D(it)}).observe(document,{childList:!0,subtree:!0});function B(U){const ct={};return U.integrity&&(ct.integrity=U.integrity),U.referrerPolicy&&(ct.referrerPolicy=U.referrerPolicy),U.crossOrigin==="use-credentials"?ct.credentials="include":U.crossOrigin==="anonymous"?ct.credentials="omit":ct.credentials="same-origin",ct}function D(U){if(U.ep)return;U.ep=!0;const ct=B(U);fetch(U.href,ct)}})();const index="";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const t$2=globalThis,e$5=t$2.ShadowRoot&&(t$2.ShadyCSS===void 0||t$2.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,s$2=Symbol(),o$3=new WeakMap;let n$3=class{constructor(F,B,D){if(this._$cssResult$=!0,D!==s$2)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=F,this.t=B}get styleSheet(){let F=this.o;const B=this.t;if(e$5&&F===void 0){const D=B!==void 0&&B.length===1;D&&(F=o$3.get(B)),F===void 0&&((this.o=F=new CSSStyleSheet).replaceSync(this.cssText),D&&o$3.set(B,F))}return F}toString(){return this.cssText}};const r$5=K=>new n$3(typeof K=="string"?K:K+"",void 0,s$2),i$2=(K,...F)=>{const B=K.length===1?K[0]:F.reduce((D,U,ct)=>D+(it=>{if(it._$cssResult$===!0)return it.cssText;if(typeof it=="number")return it;throw Error("Value passed to 'css' function must be a 'css' function result: "+it+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(U)+K[ct+1],K[0]);return new n$3(B,K,s$2)},S$1=(K,F)=>{if(e$5)K.adoptedStyleSheets=F.map(B=>B instanceof CSSStyleSheet?B:B.styleSheet);else for(const B of F){const D=document.createElement("style"),U=t$2.litNonce;U!==void 0&&D.setAttribute("nonce",U),D.textContent=B.cssText,K.appendChild(D)}},c$2=e$5?K=>K:K=>K instanceof CSSStyleSheet?(F=>{let B="";for(const D of F.cssRules)B+=D.cssText;return r$5(B)})(K):K;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:i$1,defineProperty:e$4,getOwnPropertyDescriptor:r$4,getOwnPropertyNames:h$1,getOwnPropertySymbols:o$2,getPrototypeOf:n$2}=Object,a$1=globalThis,c$1=a$1.trustedTypes,l$1=c$1?c$1.emptyScript:"",p$1=a$1.reactiveElementPolyfillSupport,d$1=(K,F)=>K,u$1={toAttribute(K,F){switch(F){case Boolean:K=K?l$1:null;break;case Object:case Array:K=K==null?K:JSON.stringify(K)}return K},fromAttribute(K,F){let B=K;switch(F){case Boolean:B=K!==null;break;case Number:B=K===null?null:Number(K);break;case Object:case Array:try{B=JSON.parse(K)}catch{B=null}}return B}},f$1=(K,F)=>!i$1(K,F),y$1={attribute:!0,type:String,converter:u$1,reflect:!1,hasChanged:f$1};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),a$1.litPropertyMetadata??(a$1.litPropertyMetadata=new WeakMap);class b extends HTMLElement{static addInitializer(F){this._$Ei(),(this.l??(this.l=[])).push(F)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(F,B=y$1){if(B.state&&(B.attribute=!1),this._$Ei(),this.elementProperties.set(F,B),!B.noAccessor){const D=Symbol(),U=this.getPropertyDescriptor(F,D,B);U!==void 0&&e$4(this.prototype,F,U)}}static getPropertyDescriptor(F,B,D){const{get:U,set:ct}=r$4(this.prototype,F)??{get(){return this[B]},set(it){this[B]=it}};return{get(){return U==null?void 0:U.call(this)},set(it){const zt=U==null?void 0:U.call(this);ct.call(this,it),this.requestUpdate(F,zt,D)},configurable:!0,enumerable:!0}}static getPropertyOptions(F){return this.elementProperties.get(F)??y$1}static _$Ei(){if(this.hasOwnProperty(d$1("elementProperties")))return;const F=n$2(this);F.finalize(),F.l!==void 0&&(this.l=[...F.l]),this.elementProperties=new Map(F.elementProperties)}static finalize(){if(this.hasOwnProperty(d$1("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(d$1("properties"))){const B=this.properties,D=[...h$1(B),...o$2(B)];for(const U of D)this.createProperty(U,B[U])}const F=this[Symbol.metadata];if(F!==null){const B=litPropertyMetadata.get(F);if(B!==void 0)for(const[D,U]of B)this.elementProperties.set(D,U)}this._$Eh=new Map;for(const[B,D]of this.elementProperties){const U=this._$Eu(B,D);U!==void 0&&this._$Eh.set(U,B)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(F){const B=[];if(Array.isArray(F)){const D=new Set(F.flat(1/0).reverse());for(const U of D)B.unshift(c$2(U))}else F!==void 0&&B.push(c$2(F));return B}static _$Eu(F,B){const D=B.attribute;return D===!1?void 0:typeof D=="string"?D:typeof F=="string"?F.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var F;this._$ES=new Promise(B=>this.enableUpdating=B),this._$AL=new Map,this._$E_(),this.requestUpdate(),(F=this.constructor.l)==null||F.forEach(B=>B(this))}addController(F){var B;(this._$EO??(this._$EO=new Set)).add(F),this.renderRoot!==void 0&&this.isConnected&&((B=F.hostConnected)==null||B.call(F))}removeController(F){var B;(B=this._$EO)==null||B.delete(F)}_$E_(){const F=new Map,B=this.constructor.elementProperties;for(const D of B.keys())this.hasOwnProperty(D)&&(F.set(D,this[D]),delete this[D]);F.size>0&&(this._$Ep=F)}createRenderRoot(){const F=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return S$1(F,this.constructor.elementStyles),F}connectedCallback(){var F;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(F=this._$EO)==null||F.forEach(B=>{var D;return(D=B.hostConnected)==null?void 0:D.call(B)})}enableUpdating(F){}disconnectedCallback(){var F;(F=this._$EO)==null||F.forEach(B=>{var D;return(D=B.hostDisconnected)==null?void 0:D.call(B)})}attributeChangedCallback(F,B,D){this._$AK(F,D)}_$EC(F,B){var ct;const D=this.constructor.elementProperties.get(F),U=this.constructor._$Eu(F,D);if(U!==void 0&&D.reflect===!0){const it=(((ct=D.converter)==null?void 0:ct.toAttribute)!==void 0?D.converter:u$1).toAttribute(B,D.type);this._$Em=F,it==null?this.removeAttribute(U):this.setAttribute(U,it),this._$Em=null}}_$AK(F,B){var ct;const D=this.constructor,U=D._$Eh.get(F);if(U!==void 0&&this._$Em!==U){const it=D.getPropertyOptions(U),zt=typeof it.converter=="function"?{fromAttribute:it.converter}:((ct=it.converter)==null?void 0:ct.fromAttribute)!==void 0?it.converter:u$1;this._$Em=U,this[U]=zt.fromAttribute(B,it.type),this._$Em=null}}requestUpdate(F,B,D){if(F!==void 0){if(D??(D=this.constructor.getPropertyOptions(F)),!(D.hasChanged??f$1)(this[F],B))return;this.P(F,B,D)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(F,B,D){this._$AL.has(F)||this._$AL.set(F,B),D.reflect===!0&&this._$Em!==F&&(this._$Ej??(this._$Ej=new Set)).add(F)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(B){Promise.reject(B)}const F=this.scheduleUpdate();return F!=null&&await F,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var D;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[ct,it]of this._$Ep)this[ct]=it;this._$Ep=void 0}const U=this.constructor.elementProperties;if(U.size>0)for(const[ct,it]of U)it.wrapped!==!0||this._$AL.has(ct)||this[ct]===void 0||this.P(ct,this[ct],it)}let F=!1;const B=this._$AL;try{F=this.shouldUpdate(B),F?(this.willUpdate(B),(D=this._$EO)==null||D.forEach(U=>{var ct;return(ct=U.hostUpdate)==null?void 0:ct.call(U)}),this.update(B)):this._$EU()}catch(U){throw F=!1,this._$EU(),U}F&&this._$AE(B)}willUpdate(F){}_$AE(F){var B;(B=this._$EO)==null||B.forEach(D=>{var U;return(U=D.hostUpdated)==null?void 0:U.call(D)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(F)),this.updated(F)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(F){return!0}update(F){this._$Ej&&(this._$Ej=this._$Ej.forEach(B=>this._$EC(B,this[B]))),this._$EU()}updated(F){}firstUpdated(F){}}b.elementStyles=[],b.shadowRootOptions={mode:"open"},b[d$1("elementProperties")]=new Map,b[d$1("finalized")]=new Map,p$1==null||p$1({ReactiveElement:b}),(a$1.reactiveElementVersions??(a$1.reactiveElementVersions=[])).push("2.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const t$1=globalThis,i=t$1.trustedTypes,s$1=i?i.createPolicy("lit-html",{createHTML:K=>K}):void 0,e$3="$lit$",h=`lit$${(Math.random()+"").slice(9)}$`,o$1="?"+h,n$1=`<${o$1}>`,r$3=document,l=()=>r$3.createComment(""),c=K=>K===null||typeof K!="object"&&typeof K!="function",a=Array.isArray,u=K=>a(K)||typeof(K==null?void 0:K[Symbol.iterator])=="function",d=`[ 	
\f\r]`,f=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,v=/-->/g,_=/>/g,m=RegExp(`>|${d}(?:([^\\s"'>=/]+)(${d}*=${d}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),p=/'/g,g=/"/g,$=/^(?:script|style|textarea|title)$/i,y=K=>(F,...B)=>({_$litType$:K,strings:F,values:B}),x=y(1),w=Symbol.for("lit-noChange"),T=Symbol.for("lit-nothing"),A=new WeakMap,E=r$3.createTreeWalker(r$3,129);function C(K,F){if(!Array.isArray(K)||!K.hasOwnProperty("raw"))throw Error("invalid template strings array");return s$1!==void 0?s$1.createHTML(F):F}const P=(K,F)=>{const B=K.length-1,D=[];let U,ct=F===2?"<svg>":"",it=f;for(let zt=0;zt<B;zt++){const At=K[zt];let gt,et,vt=-1,Pt=0;for(;Pt<At.length&&(it.lastIndex=Pt,et=it.exec(At),et!==null);)Pt=it.lastIndex,it===f?et[1]==="!--"?it=v:et[1]!==void 0?it=_:et[2]!==void 0?($.test(et[2])&&(U=RegExp("</"+et[2],"g")),it=m):et[3]!==void 0&&(it=m):it===m?et[0]===">"?(it=U??f,vt=-1):et[1]===void 0?vt=-2:(vt=it.lastIndex-et[2].length,gt=et[1],it=et[3]===void 0?m:et[3]==='"'?g:p):it===g||it===p?it=m:it===v||it===_?it=f:(it=m,U=void 0);const yt=it===m&&K[zt+1].startsWith("/>")?" ":"";ct+=it===f?At+n$1:vt>=0?(D.push(gt),At.slice(0,vt)+e$3+At.slice(vt)+h+yt):At+h+(vt===-2?zt:yt)}return[C(K,ct+(K[B]||"<?>")+(F===2?"</svg>":"")),D]};class V{constructor({strings:F,_$litType$:B},D){let U;this.parts=[];let ct=0,it=0;const zt=F.length-1,At=this.parts,[gt,et]=P(F,B);if(this.el=V.createElement(gt,D),E.currentNode=this.el.content,B===2){const vt=this.el.content.firstChild;vt.replaceWith(...vt.childNodes)}for(;(U=E.nextNode())!==null&&At.length<zt;){if(U.nodeType===1){if(U.hasAttributes())for(const vt of U.getAttributeNames())if(vt.endsWith(e$3)){const Pt=et[it++],yt=U.getAttribute(vt).split(h),ht=/([.?@])?(.*)/.exec(Pt);At.push({type:1,index:ct,name:ht[2],strings:yt,ctor:ht[1]==="."?k:ht[1]==="?"?H:ht[1]==="@"?I:R}),U.removeAttribute(vt)}else vt.startsWith(h)&&(At.push({type:6,index:ct}),U.removeAttribute(vt));if($.test(U.tagName)){const vt=U.textContent.split(h),Pt=vt.length-1;if(Pt>0){U.textContent=i?i.emptyScript:"";for(let yt=0;yt<Pt;yt++)U.append(vt[yt],l()),E.nextNode(),At.push({type:2,index:++ct});U.append(vt[Pt],l())}}}else if(U.nodeType===8)if(U.data===o$1)At.push({type:2,index:ct});else{let vt=-1;for(;(vt=U.data.indexOf(h,vt+1))!==-1;)At.push({type:7,index:ct}),vt+=h.length-1}ct++}}static createElement(F,B){const D=r$3.createElement("template");return D.innerHTML=F,D}}function N(K,F,B=K,D){var it,zt;if(F===w)return F;let U=D!==void 0?(it=B._$Co)==null?void 0:it[D]:B._$Cl;const ct=c(F)?void 0:F._$litDirective$;return(U==null?void 0:U.constructor)!==ct&&((zt=U==null?void 0:U._$AO)==null||zt.call(U,!1),ct===void 0?U=void 0:(U=new ct(K),U._$AT(K,B,D)),D!==void 0?(B._$Co??(B._$Co=[]))[D]=U:B._$Cl=U),U!==void 0&&(F=N(K,U._$AS(K,F.values),U,D)),F}class S{constructor(F,B){this._$AV=[],this._$AN=void 0,this._$AD=F,this._$AM=B}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(F){const{el:{content:B},parts:D}=this._$AD,U=((F==null?void 0:F.creationScope)??r$3).importNode(B,!0);E.currentNode=U;let ct=E.nextNode(),it=0,zt=0,At=D[0];for(;At!==void 0;){if(it===At.index){let gt;At.type===2?gt=new M(ct,ct.nextSibling,this,F):At.type===1?gt=new At.ctor(ct,At.name,At.strings,this,F):At.type===6&&(gt=new L(ct,this,F)),this._$AV.push(gt),At=D[++zt]}it!==(At==null?void 0:At.index)&&(ct=E.nextNode(),it++)}return E.currentNode=r$3,U}p(F){let B=0;for(const D of this._$AV)D!==void 0&&(D.strings!==void 0?(D._$AI(F,D,B),B+=D.strings.length-2):D._$AI(F[B])),B++}}class M{get _$AU(){var F;return((F=this._$AM)==null?void 0:F._$AU)??this._$Cv}constructor(F,B,D,U){this.type=2,this._$AH=T,this._$AN=void 0,this._$AA=F,this._$AB=B,this._$AM=D,this.options=U,this._$Cv=(U==null?void 0:U.isConnected)??!0}get parentNode(){let F=this._$AA.parentNode;const B=this._$AM;return B!==void 0&&(F==null?void 0:F.nodeType)===11&&(F=B.parentNode),F}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(F,B=this){F=N(this,F,B),c(F)?F===T||F==null||F===""?(this._$AH!==T&&this._$AR(),this._$AH=T):F!==this._$AH&&F!==w&&this._(F):F._$litType$!==void 0?this.$(F):F.nodeType!==void 0?this.T(F):u(F)?this.k(F):this._(F)}S(F){return this._$AA.parentNode.insertBefore(F,this._$AB)}T(F){this._$AH!==F&&(this._$AR(),this._$AH=this.S(F))}_(F){this._$AH!==T&&c(this._$AH)?this._$AA.nextSibling.data=F:this.T(r$3.createTextNode(F)),this._$AH=F}$(F){var ct;const{values:B,_$litType$:D}=F,U=typeof D=="number"?this._$AC(F):(D.el===void 0&&(D.el=V.createElement(C(D.h,D.h[0]),this.options)),D);if(((ct=this._$AH)==null?void 0:ct._$AD)===U)this._$AH.p(B);else{const it=new S(U,this),zt=it.u(this.options);it.p(B),this.T(zt),this._$AH=it}}_$AC(F){let B=A.get(F.strings);return B===void 0&&A.set(F.strings,B=new V(F)),B}k(F){a(this._$AH)||(this._$AH=[],this._$AR());const B=this._$AH;let D,U=0;for(const ct of F)U===B.length?B.push(D=new M(this.S(l()),this.S(l()),this,this.options)):D=B[U],D._$AI(ct),U++;U<B.length&&(this._$AR(D&&D._$AB.nextSibling,U),B.length=U)}_$AR(F=this._$AA.nextSibling,B){var D;for((D=this._$AP)==null?void 0:D.call(this,!1,!0,B);F&&F!==this._$AB;){const U=F.nextSibling;F.remove(),F=U}}setConnected(F){var B;this._$AM===void 0&&(this._$Cv=F,(B=this._$AP)==null||B.call(this,F))}}class R{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(F,B,D,U,ct){this.type=1,this._$AH=T,this._$AN=void 0,this.element=F,this.name=B,this._$AM=U,this.options=ct,D.length>2||D[0]!==""||D[1]!==""?(this._$AH=Array(D.length-1).fill(new String),this.strings=D):this._$AH=T}_$AI(F,B=this,D,U){const ct=this.strings;let it=!1;if(ct===void 0)F=N(this,F,B,0),it=!c(F)||F!==this._$AH&&F!==w,it&&(this._$AH=F);else{const zt=F;let At,gt;for(F=ct[0],At=0;At<ct.length-1;At++)gt=N(this,zt[D+At],B,At),gt===w&&(gt=this._$AH[At]),it||(it=!c(gt)||gt!==this._$AH[At]),gt===T?F=T:F!==T&&(F+=(gt??"")+ct[At+1]),this._$AH[At]=gt}it&&!U&&this.j(F)}j(F){F===T?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,F??"")}}class k extends R{constructor(){super(...arguments),this.type=3}j(F){this.element[this.name]=F===T?void 0:F}}class H extends R{constructor(){super(...arguments),this.type=4}j(F){this.element.toggleAttribute(this.name,!!F&&F!==T)}}class I extends R{constructor(F,B,D,U,ct){super(F,B,D,U,ct),this.type=5}_$AI(F,B=this){if((F=N(this,F,B,0)??T)===w)return;const D=this._$AH,U=F===T&&D!==T||F.capture!==D.capture||F.once!==D.once||F.passive!==D.passive,ct=F!==T&&(D===T||U);U&&this.element.removeEventListener(this.name,this,D),ct&&this.element.addEventListener(this.name,this,F),this._$AH=F}handleEvent(F){var B;typeof this._$AH=="function"?this._$AH.call(((B=this.options)==null?void 0:B.host)??this.element,F):this._$AH.handleEvent(F)}}class L{constructor(F,B,D){this.element=F,this.type=6,this._$AN=void 0,this._$AM=B,this.options=D}get _$AU(){return this._$AM._$AU}_$AI(F){N(this,F)}}const Z=t$1.litHtmlPolyfillSupport;Z==null||Z(V,M),(t$1.litHtmlVersions??(t$1.litHtmlVersions=[])).push("3.1.2");const j=(K,F,B)=>{const D=(B==null?void 0:B.renderBefore)??F;let U=D._$litPart$;if(U===void 0){const ct=(B==null?void 0:B.renderBefore)??null;D._$litPart$=U=new M(F.insertBefore(l(),ct),ct,void 0,B??{})}return U._$AI(K),U};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class s extends b{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var B;const F=super.createRenderRoot();return(B=this.renderOptions).renderBefore??(B.renderBefore=F.firstChild),F}update(F){const B=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(F),this._$Do=j(B,this.renderRoot,this.renderOptions)}connectedCallback(){var F;super.connectedCallback(),(F=this._$Do)==null||F.setConnected(!0)}disconnectedCallback(){var F;super.disconnectedCallback(),(F=this._$Do)==null||F.setConnected(!1)}render(){return w}}var as;s._$litElement$=!0,s.finalized=!0,(as=globalThis.litElementHydrateSupport)==null||as.call(globalThis,{LitElement:s});const r$2=globalThis.litElementPolyfillSupport;r$2==null||r$2({LitElement:s});(globalThis.litElementVersions??(globalThis.litElementVersions=[])).push("4.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const t=K=>(F,B)=>{B!==void 0?B.addInitializer(()=>{customElements.define(K,F)}):customElements.define(K,F)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const o={attribute:!0,type:String,converter:u$1,reflect:!1,hasChanged:f$1},r$1=(K=o,F,B)=>{const{kind:D,metadata:U}=B;let ct=globalThis.litPropertyMetadata.get(U);if(ct===void 0&&globalThis.litPropertyMetadata.set(U,ct=new Map),ct.set(B.name,K),D==="accessor"){const{name:it}=B;return{set(zt){const At=F.get.call(this);F.set.call(this,zt),this.requestUpdate(it,At,K)},init(zt){return zt!==void 0&&this.P(it,void 0,K),zt}}}if(D==="setter"){const{name:it}=B;return function(zt){const At=this[it];F.call(this,zt),this.requestUpdate(it,At,K)}}throw Error("Unsupported decorator location: "+D)};function n(K){return(F,B)=>typeof B=="object"?r$1(K,F,B):((D,U,ct)=>{const it=U.hasOwnProperty(ct);return U.constructor.createProperty(ct,it?{...D,wrapped:!0}:D),it?Object.getOwnPropertyDescriptor(U,ct):void 0})(K,F,B)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const e$2=(K,F,B)=>(B.configurable=!0,B.enumerable=!0,Reflect.decorate&&typeof F!="object"&&Object.defineProperty(K,F,B),B);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function e$1(K,F){return(B,D,U)=>{const ct=it=>{var zt;return((zt=it.renderRoot)==null?void 0:zt.querySelector(K))??null};if(F){const{get:it,set:zt}=typeof D=="object"?B:U??(()=>{const At=Symbol();return{get(){return this[At]},set(gt){this[At]=gt}}})();return e$2(B,D,{get(){let At=it.call(this);return At===void 0&&(At=ct(this),(At!==null||this.hasUpdated)&&zt.call(this,At)),At}})}return e$2(B,D,{get(){return ct(this)}})}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let e;function r(K){return(F,B)=>e$2(F,B,{get(){return(this.renderRoot??e??(e=document.createDocumentFragment())).querySelectorAll(K)}})}var __defProp$9=Object.defineProperty,__getOwnPropDesc$9=Object.getOwnPropertyDescriptor,__decorateClass$9=(K,F,B,D)=>{for(var U=D>1?void 0:D?__getOwnPropDesc$9(F,B):F,ct=K.length-1,it;ct>=0;ct--)(it=K[ct])&&(U=(D?it(F,B,U):it(U))||U);return D&&U&&__defProp$9(F,B,U),U};let CollapsableContainer=class extends s{constructor(){super(...arguments),this.title="",this.description=""}render(){return x`
      <div class="header">
        <div class="info" @click=${()=>{this.toggleAttribute("open")}}>
          <h3 class="title">${this.title}</h3>
          <p class="description">${this.description}</p>
        </div>
        <div class="tools">
          <slot name="header"></slot>
        </div>
      </div>

      <div class="content" @focusin=${()=>this.setAttribute("open","")}>
        <slot></slot>
      </div>
    `}};CollapsableContainer.styles=i$2`
    :host {
      display: grid;
      grid-template-rows: 1fr 0fr;
      grid-template-columns: 1fr;
      box-sizing: border-box;
      border-top: 1px solid var(--theme-color-background-light);
      transition: grid-template-rows .2s;
    }
    :host([open]) {
      grid-template-rows: auto 1fr;
    }
    :host([hidden]) {
      grid-template-rows: 0fr 0fr;
      transition: display 0s .5s, grid-template-rows .5s;
      display: none;
    }

    .content {
      opacity: 0;
      transition: opacity 0.5s;
      overflow: hidden;
      padding: 0 1em;
      box-sizing: border-box;
      transition: padding 0.5s;
    }
    :host([open]) .content {
      opacity: 1;
      padding: 0 1em 1em;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1em;
      overflow: hidden;
      min-height: 0;
      transition: padding .5s;
    }
    :host([hidden]) .header {
      padding: 0 1em;
    }
    .info {
      font-size: .9em;
      cursor: pointer;
      flex: 1;
    }
    .title, .description {
      display: block;
      margin: 0;
    }
    .tools {
      display: flex;
      gap: .5em;
    }

  `;__decorateClass$9([n({type:String})],CollapsableContainer.prototype,"title",2);__decorateClass$9([n({type:String})],CollapsableContainer.prototype,"description",2);CollapsableContainer=__decorateClass$9([t("collapsable-container")],CollapsableContainer);const buttonStyle=i$2`
  button {
    background: var(--theme-color-background-light);
    border: none;
    outline: none;
    border-radius: 0.5em;
    padding: 0.5em 1em;
    color: var(--theme-color-text);
    cursor: pointer;
    font-weight: bold;
    text-transform: uppercase;
  }
  button:hover {
    scale: 1.05;
  }
  button:focus {
    box-shadow: 0 0 0 2px var(--theme-color-text-light);
  }
`;var simd=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),fetchArrayBuffer=async(K,F)=>await(await fetch(K,F)).arrayBuffer(),loadRnnoise=async({url:K,simdUrl:F},B)=>{const D=await simd()?F:K;return await fetchArrayBuffer(D,B)},id2="@sapphi-red/web-noise-suppressor/rnnoise",RnnoiseWorkletNode=class extends AudioWorkletNode{constructor(K,{maxChannels:F,wasmBinary:B}){const D={processorOptions:{maxChannels:F,wasmBinary:B}};super(K,id2,D)}destroy(){this.port.postMessage("destroy")}};const rnnoiseWorkletPath=""+new URL("workletProcessor-43740a55.js",import.meta.url).href,rnnoiseWasmPath=""+new URL("rnnoise-8b60a2ab.wasm",import.meta.url).href,rnnoiseWasmSimdPath=""+new URL("rnnoise-8b60a2ab.wasm",import.meta.url).href;function lerp(K,F,B){return K+(F-K)*B}function rlerp(K,F,B){return(B-K)/(F-K)}function absoluteDistance(K,F){return Math.abs(K-F)}function transformFrequencyData(K){const F=K.reduce((D,U)=>D+U,0)/K.length,B=Math.max(...K,50);for(let D=0;D<K.length;D++)K[D]=Math.min(255,Math.max(0,rlerp(F,B,K[D])*255))}function createNoiseRemover(K){const F=new Uint8Array(K.data[0].length);for(let B=0;B<F.length;B++){const D=K.data.map(ct=>ct[B]),U=Math.max(...D);F[B]=U}return B=>{for(let D=0;D<B.length;D++)B[D]=Math.max(0,B[D]-F[D])}}class FrequencyFollower{constructor(F){this.recording=F,this.position=0,this.searchDistance=1,this.currentSpeed=1}guess(F,{treshold:B=100,minDistance:D=7,maxDistance:U=42,seekStep:ct=1.618}={}){if(this.position>=this.recording.data.length-this.searchDistance)return{over:!0};const it=this.recording.getDifferences(F,this.position,this.position+Math.max(Math.round(this.searchDistance),D)).map(et=>Math.max(...et)),zt=Math.min(...it),At=this.position+it.lastIndexOf(zt);this.currentSpeed=lerp(this.currentSpeed,At-this.position,.1),console.log(this.currentSpeed.toFixed(2)),zt>B||At===this.position?this.searchDistance=Math.min(this.searchDistance+ct,U):(this.searchDistance=1,this.position=At);const gt=this.recording.markings.length?this.recording.markings.reduce((et,vt)=>vt[0]<=this.position?vt:et)[1]:void 0;return{position:this.position,mark:gt,differences:it}}}class FrequencyRecording{constructor(){this.data=[],this.markings=[]}getDifferences(F,B=0,D=this.data.length){return this.data.slice(B,D).map(U=>new Uint8Array(U.map((ct,it)=>absoluteDistance(ct,F[it]))))}clear(){this.data.length=0,this.markings.length=0}export(){return{data:this.data.map(B=>{const D=[];let U=B[0],ct=1;for(let it=1;it<B.length;it++)B[it]===U?ct++:(ct>1?D.push([U,ct]):D.push(U),U=B[it],ct=1);return ct>1?D.push([U,ct]):D.push(U),D}),markings:this.markings}}static import({data:F,markings:B}){const D=new FrequencyRecording;for(const U of F){const ct=[];for(const it of U)if(Array.isArray(it)){const[zt,At]=it;ct.push(...new Array(At).fill(zt))}else ct.push(it);D.data.push(new Uint8Array(ct))}return D.markings=B,D}createFollower(){return new FrequencyFollower(this)}}var __defProp$8=Object.defineProperty,__getOwnPropDesc$8=Object.getOwnPropertyDescriptor,__decorateClass$8=(K,F,B,D)=>{for(var U=D>1?void 0:D?__getOwnPropDesc$8(F,B):F,ct=K.length-1,it;ct>=0;ct--)(it=K[ct])&&(U=(D?it(F,B,U):it(U))||U);return D&&U&&__defProp$8(F,B,U),U};const ui={get app(){return document.querySelector("app-root")}};function popup(K,F){const B=document.createElement("app-popup");return B.content=K,B.inputs=F,document.body.appendChild(B),B.promise}let AppPopup=class extends s{constructor(){super(...arguments),this.promise=new Promise((K,F)=>{this.resolve=K,this.reject=F})}connectedCallback(){super.connectedCallback(),ui.app.setAttribute("tabindex","-1"),this.promise.then(()=>this.remove()).catch(()=>this.remove())}disconnectedCallback(){super.disconnectedCallback(),ui.app.removeAttribute("tabindex")}render(){return x`
      <div class="popup">
        <div id="content">
          ${this.content}
        </div>
        <div id="inputs" ?hidden=${!this.inputs}>
          ${this.inputs}
        </div>
        <div id="actions">
          <button @click=${()=>this.resolve(this.getValues())}>Ok</button>
          <button @click=${()=>this.reject()} ?hidden=${!this.inputs}>Cancel</button>
        </div>
      </div>
    `}getValues(){const K=[...this.inputsEls];if(console.log("inputs",K),K.length===0)return;const F=new Map;return K.forEach(B=>{const{id:D,value:U}=B;D&&F.set(D,U)}),F}};AppPopup.styles=[buttonStyle,i$2`
      :host {
        display: grid;
        place-items: center;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        width: 100dvw;
        height: 100vh;
        height: 100dvh;
        background-color: var(--theme-color-background)bc;
        backdrop-filter: blur(5px);
        z-index: 100;
      }
      .popup {
        max-width: 80%;
        max-height: 80%;
        overflow: auto;
        display: flex;
        flex-direction: column;
        gap: 1em;
        background-color: var(--theme-color-background);
        padding: 1.5em;
        border: 1px solid var(--theme-color-background-light);
        border-radius: 2em;
        box-shadow: 0 0.6em 1em var(--theme-color-shadow);
        z-index: 101;
      }
      h1, h2, h3, h4, h5, h6, p, span {
        margin: 0;
        padding: 0;
      }
      .popup > div {
        display: flex;
        gap: 1em;
        flex-wrap: wrap;
        align-items: center;
        justify-content: stretch;
      }
      #content {
        flex: 1;
      }
      #inputs > input {
        display: block;
        min-width: 0;
        width: 100%;
        padding: 0.5em;
      }
      #actions {
        flex-direction: row-reverse;
      }
    `];__decorateClass$8([r("#inputs > *")],AppPopup.prototype,"inputsEls",2);AppPopup=__decorateClass$8([t("app-popup")],AppPopup);var __defProp$7=Object.defineProperty,__getOwnPropDesc$7=Object.getOwnPropertyDescriptor,__decorateClass$7=(K,F,B,D)=>{for(var U=D>1?void 0:D?__getOwnPropDesc$7(F,B):F,ct=K.length-1,it;ct>=0;ct--)(it=K[ct])&&(U=(D?it(F,B,U):it(U))||U);return D&&U&&__defProp$7(F,B,U),U};let FrequencyRecorder=class extends s{constructor(){super(...arguments),this.recording=!1,this._status="",this.pct=.125}async connect(){this.stream=await navigator.mediaDevices.getUserMedia({audio:{noiseSuppression:!0,echoCancellation:!0,autoGainControl:!1}});const K=new AudioContext;this.source=K.createMediaStreamSource(this.stream),this.gain=new GainNode(K,{gain:1}),await K.audioWorklet.addModule(rnnoiseWorkletPath);const F=await loadRnnoise({url:rnnoiseWasmPath,simdUrl:rnnoiseWasmSimdPath});this.rnnoise=new RnnoiseWorkletNode(K,{wasmBinary:F,maxChannels:2}),this.source.connect(this.rnnoise),this.rnnoise.connect(this.gain),this.analyser=K.createAnalyser(),this.source.connect(this.analyser),this.analyser.fftSize=Math.pow(2,12),this.analyser.smoothingTimeConstant=.5}disconnect(){var K,F,B,D,U;(K=this.stream)==null||K.getTracks().forEach(ct=>ct.stop()),(F=this.source)==null||F.disconnect(),(B=this.gain)==null||B.disconnect(),(D=this.rnnoise)==null||D.destroy(),(U=this.rnnoise)==null||U.disconnect()}capture(){const K=this.analyser.frequencyBinCount,F=new Uint8Array(Math.floor(K*this.pct));return this.analyser.getByteFrequencyData(F),this._cleaner&&this._cleaner(F),this._transformer&&this._transformer(F),F}loop(){var F;this.frameID=requestAnimationFrame(()=>this.loop());const K=this.capture();(F=this._onData)==null||F.call(this,K)}async start(){if(!this.recording)try{this._status="connecting",this.recording=!0,this._cleaner=void 0,this._transformer=void 0,this._onData=void 0,await this.connect(),this.dispatchEvent(new CustomEvent("start")),this.loop(),await delay(500),this._status="capturing noise";const K=new FrequencyRecording;this._onData=F=>{K.data.push(F)},await delay(2500),this._status="running",this._cleaner=createNoiseRemover(K),this._transformer=transformFrequencyData,this._onData=F=>{this.dispatchEvent(new CustomEvent("data",{detail:F}))}}catch{this.recording=!1,this._status="error",popup(x`<h3>Could not connect to microphone</h3>`)}}stop(){this.recording&&(cancelAnimationFrame(this.frameID),this.disconnect(),this.dispatchEvent(new CustomEvent("stop")),this.recording=!1,this._status="")}toggle(){this.recording?this.stop():this.start()}render(){return x`
      <button @click=${this.toggle} class=${this._status==="running"?"active":""}>
        <slot></slot>
        <p>${this._status}</p>
      </button>
    `}};FrequencyRecorder.styles=[buttonStyle,i$2`
      :host {
        display: block;
      }
      button.active {
        background: var(--theme-color-primary);
      }
      button p {
        text-transform: none;
        font-weight: normal;
        font-size: 0.8em;
        line-height: 1em;
        margin: 0;
      }
    `];__decorateClass$7([n({type:Boolean})],FrequencyRecorder.prototype,"recording",2);__decorateClass$7([n({type:String})],FrequencyRecorder.prototype,"_status",2);FrequencyRecorder=__decorateClass$7([t("frequency-recorder")],FrequencyRecorder);async function delay(K){return new Promise(F=>setTimeout(F,K))}function heat(K){return`hsla(${360-K*360}, 100%, 50%, ${K})`}var __defProp$6=Object.defineProperty,__getOwnPropDesc$6=Object.getOwnPropertyDescriptor,__decorateClass$6=(K,F,B,D)=>{for(var U=D>1?void 0:D?__getOwnPropDesc$6(F,B):F,ct=K.length-1,it;ct>=0;ct--)(it=K[ct])&&(U=(D?it(F,B,U):it(U))||U);return D&&U&&__defProp$6(F,B,U),U};let Graph1D=class extends s{render(){return x`<canvas width="0" height="0"></canvas>`}updated(){const K=this.canvas,F=K.getContext("2d");if(!this.data){K.width=0,K.height=0;return}K.width=this.data.length,K.height=5,this.data.forEach((B,D)=>{F.fillStyle=heat(B/255),F.fillRect(D,0,1,5)})}};Graph1D.styles=i$2`
    :host {
      display: block;
    }
    canvas {
      display: block;
    }
  `;__decorateClass$6([n({type:Object})],Graph1D.prototype,"data",2);__decorateClass$6([e$1("canvas")],Graph1D.prototype,"canvas",2);Graph1D=__decorateClass$6([t("graph-1d")],Graph1D);var __defProp$5=Object.defineProperty,__getOwnPropDesc$5=Object.getOwnPropertyDescriptor,__decorateClass$5=(K,F,B,D)=>{for(var U=D>1?void 0:D?__getOwnPropDesc$5(F,B):F,ct=K.length-1,it;ct>=0;ct--)(it=K[ct])&&(U=(D?it(F,B,U):it(U))||U);return D&&U&&__defProp$5(F,B,U),U};let Graph2D=class extends s{render(){return x`<canvas width="0" height="0" @pointerdown=${K=>{const F=this.canvas.getBoundingClientRect(),B=K.clientX-F.left,D=K.clientY-F.top,U=B/F.width,ct=D/F.height,it=Math.floor(U*this.data.length||0),zt=Math.floor((1-ct)*this.data[0].length);this.dispatchEvent(new CustomEvent("select",{detail:{column:it,row:zt,x:B,y:D}}))}}></canvas>`}updated(){var At;if(!this.data||!this.data.length)return;const K=this.canvas,F=K.getContext("2d"),B=((At=this.data[0])==null?void 0:At.length)||0;K.width=this.data.length,K.height=B;let D=0,U=50,ct;const it=45,zt=gt=>{ct&&(gt-ct<it?U++:U--),ct=gt;for(let et=D;et<Math.min(D+U,this.data.length);et++)for(let vt=0;vt<B;vt++)F.fillStyle=heat(this.data[et][vt]/255),F.fillRect(et,B-vt,1,1);D+=U,D<this.data.length&&requestAnimationFrame(zt)};requestAnimationFrame(zt)}};Graph2D.styles=i$2`
    :host {
      display: block;
    }
    canvas {
      display: block;
    }
  `;__decorateClass$5([n({type:Array})],Graph2D.prototype,"data",2);__decorateClass$5([e$1("canvas")],Graph2D.prototype,"canvas",2);Graph2D=__decorateClass$5([t("graph-2d")],Graph2D);function getAugmentedNamespace(K){if(K.__esModule)return K;var F=K.default;if(typeof F=="function"){var B=function D(){return this instanceof D?Reflect.construct(F,arguments,this.constructor):F.apply(this,arguments)};B.prototype=F.prototype}else B={};return Object.defineProperty(B,"__esModule",{value:!0}),Object.keys(K).forEach(function(D){var U=Object.getOwnPropertyDescriptor(K,D);Object.defineProperty(B,D,U.get?U:{enumerable:!0,get:function(){return K[D]}})}),B}function commonjsRequire(K){throw new Error('Could not dynamically require "'+K+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"}),require$$0=getAugmentedNamespace(__viteBrowserExternal$1);(function(module,exports){(function(F,B){module.exports=F.pdfjsLib=B()})(globalThis,()=>(()=>{var __webpack_modules__=[,(K,F)=>{var Oe;Object.defineProperty(F,"__esModule",{value:!0}),F.VerbosityLevel=F.Util=F.UnknownErrorException=F.UnexpectedResponseException=F.TextRenderingMode=F.RenderingIntentFlag=F.PromiseCapability=F.PermissionFlag=F.PasswordResponses=F.PasswordException=F.PageActionEventType=F.OPS=F.MissingPDFException=F.MAX_IMAGE_SIZE_TO_CACHE=F.LINE_FACTOR=F.LINE_DESCENT_FACTOR=F.InvalidPDFException=F.ImageKind=F.IDENTITY_MATRIX=F.FormatError=F.FeatureTest=F.FONT_IDENTITY_MATRIX=F.DocumentActionEventType=F.CMapCompressionType=F.BaseException=F.BASELINE_FACTOR=F.AnnotationType=F.AnnotationReplyType=F.AnnotationPrefix=F.AnnotationMode=F.AnnotationFlag=F.AnnotationFieldFlag=F.AnnotationEditorType=F.AnnotationEditorPrefix=F.AnnotationEditorParamsType=F.AnnotationBorderStyleType=F.AnnotationActionEventType=F.AbortException=void 0,F.assert=Kt,F.bytesToString=Tt,F.createValidAbsoluteUrl=he,F.getModificationDate=de,F.getUuid=Fe,F.getVerbosityLevel=It,F.info=qt,F.isArrayBuffer=Qt,F.isArrayEqual=ce,F.isNodeJS=void 0,F.normalizeUnicode=Re,F.objectFromMap=Jt,F.objectSize=Xt,F.setVerbosityLevel=ft,F.shadow=fe,F.string32=jt,F.stringToBytes=Wt,F.stringToPDFString=te,F.stringToUTF8String=Ut,F.unreachable=Rt,F.utf8StringToString=Bt,F.warn=Vt;const B=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");F.isNodeJS=B;const D=[1,0,0,1,0,0];F.IDENTITY_MATRIX=D;const U=[.001,0,0,.001,0,0];F.FONT_IDENTITY_MATRIX=U;const ct=1e7;F.MAX_IMAGE_SIZE_TO_CACHE=ct;const it=1.35;F.LINE_FACTOR=it;const zt=.35;F.LINE_DESCENT_FACTOR=zt;const At=zt/it;F.BASELINE_FACTOR=At;const gt={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};F.RenderingIntentFlag=gt;const et={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};F.AnnotationMode=et;const vt="pdfjs_internal_editor_";F.AnnotationEditorPrefix=vt;const Pt={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};F.AnnotationEditorType=Pt;const yt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};F.AnnotationEditorParamsType=yt;const ht={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};F.PermissionFlag=ht;const ut={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};F.TextRenderingMode=ut;const st={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};F.ImageKind=st;const lt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};F.AnnotationType=lt;const mt={GROUP:"Group",REPLY:"R"};F.AnnotationReplyType=mt;const _t={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};F.AnnotationFlag=_t;const dt={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};F.AnnotationFieldFlag=dt;const Y={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};F.AnnotationBorderStyleType=Y;const Q={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};F.AnnotationActionEventType=Q;const St={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};F.DocumentActionEventType=St;const rt={O:"PageOpen",C:"PageClose"};F.PageActionEventType=rt;const X={ERRORS:0,WARNINGS:1,INFOS:5};F.VerbosityLevel=X;const bt={NONE:0,BINARY:1};F.CMapCompressionType=bt;const at={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};F.OPS=at;const kt={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};F.PasswordResponses=kt;let Ot=X.WARNINGS;function ft(Yt){Number.isInteger(Yt)&&(Ot=Yt)}function It(){return Ot}function qt(Yt){Ot>=X.INFOS&&console.log(`Info: ${Yt}`)}function Vt(Yt){Ot>=X.WARNINGS&&console.log(`Warning: ${Yt}`)}function Rt(Yt){throw new Error(Yt)}function Kt(Yt,Nt){Yt||Rt(Nt)}function ee(Yt){switch(Yt==null?void 0:Yt.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function he(Yt,Nt=null,Dt=null){if(!Yt)return null;try{if(Dt&&typeof Yt=="string"){if(Dt.addDefaultProtocol&&Yt.startsWith("www.")){const re=Yt.match(/\./g);(re==null?void 0:re.length)>=2&&(Yt=`http://${Yt}`)}if(Dt.tryConvertEncoding)try{Yt=Ut(Yt)}catch{}}const se=Nt?new URL(Yt,Nt):new URL(Yt);if(ee(se))return se}catch{}return null}function fe(Yt,Nt,Dt,se=!1){return Object.defineProperty(Yt,Nt,{value:Dt,enumerable:!se,configurable:!0,writable:!1}),Dt}const pt=function(){function Nt(Dt,se){this.constructor===Nt&&Rt("Cannot initialize BaseException."),this.message=Dt,this.name=se}return Nt.prototype=new Error,Nt.constructor=Nt,Nt}();F.BaseException=pt;class z extends pt{constructor(Nt,Dt){super(Nt,"PasswordException"),this.code=Dt}}F.PasswordException=z;class q extends pt{constructor(Nt,Dt){super(Nt,"UnknownErrorException"),this.details=Dt}}F.UnknownErrorException=q;class G extends pt{constructor(Nt){super(Nt,"InvalidPDFException")}}F.InvalidPDFException=G;class J extends pt{constructor(Nt){super(Nt,"MissingPDFException")}}F.MissingPDFException=J;class tt extends pt{constructor(Nt,Dt){super(Nt,"UnexpectedResponseException"),this.status=Dt}}F.UnexpectedResponseException=tt;class ot extends pt{constructor(Nt){super(Nt,"FormatError")}}F.FormatError=ot;class wt extends pt{constructor(Nt){super(Nt,"AbortException")}}F.AbortException=wt;function Tt(Yt){(typeof Yt!="object"||(Yt==null?void 0:Yt.length)===void 0)&&Rt("Invalid argument for bytesToString");const Nt=Yt.length,Dt=8192;if(Nt<Dt)return String.fromCharCode.apply(null,Yt);const se=[];for(let re=0;re<Nt;re+=Dt){const Be=Math.min(re+Dt,Nt),Ue=Yt.subarray(re,Be);se.push(String.fromCharCode.apply(null,Ue))}return se.join("")}function Wt(Yt){typeof Yt!="string"&&Rt("Invalid argument for stringToBytes");const Nt=Yt.length,Dt=new Uint8Array(Nt);for(let se=0;se<Nt;++se)Dt[se]=Yt.charCodeAt(se)&255;return Dt}function jt(Yt){return String.fromCharCode(Yt>>24&255,Yt>>16&255,Yt>>8&255,Yt&255)}function Xt(Yt){return Object.keys(Yt).length}function Jt(Yt){const Nt=Object.create(null);for(const[Dt,se]of Yt)Nt[Dt]=se;return Nt}function ae(){const Yt=new Uint8Array(4);return Yt[0]=1,new Uint32Array(Yt.buffer,0,1)[0]===1}function Zt(){try{return new Function(""),!0}catch{return!1}}class me{static get isLittleEndian(){return fe(this,"isLittleEndian",ae())}static get isEvalSupported(){return fe(this,"isEvalSupported",Zt())}static get isOffscreenCanvasSupported(){return fe(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?fe(this,"platform",{isWin:!1,isMac:!1}):fe(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){var Nt,Dt;return fe(this,"isCSSRoundSupported",(Dt=(Nt=globalThis.CSS)==null?void 0:Nt.supports)==null?void 0:Dt.call(Nt,"width: round(1.5px, 1px)"))}}F.FeatureTest=me;const Ee=[...Array(256).keys()].map(Yt=>Yt.toString(16).padStart(2,"0"));class le{static makeHexColor(Nt,Dt,se){return`#${Ee[Nt]}${Ee[Dt]}${Ee[se]}`}static scaleMinMax(Nt,Dt){let se;Nt[0]?(Nt[0]<0&&(se=Dt[0],Dt[0]=Dt[1],Dt[1]=se),Dt[0]*=Nt[0],Dt[1]*=Nt[0],Nt[3]<0&&(se=Dt[2],Dt[2]=Dt[3],Dt[3]=se),Dt[2]*=Nt[3],Dt[3]*=Nt[3]):(se=Dt[0],Dt[0]=Dt[2],Dt[2]=se,se=Dt[1],Dt[1]=Dt[3],Dt[3]=se,Nt[1]<0&&(se=Dt[2],Dt[2]=Dt[3],Dt[3]=se),Dt[2]*=Nt[1],Dt[3]*=Nt[1],Nt[2]<0&&(se=Dt[0],Dt[0]=Dt[1],Dt[1]=se),Dt[0]*=Nt[2],Dt[1]*=Nt[2]),Dt[0]+=Nt[4],Dt[1]+=Nt[4],Dt[2]+=Nt[5],Dt[3]+=Nt[5]}static transform(Nt,Dt){return[Nt[0]*Dt[0]+Nt[2]*Dt[1],Nt[1]*Dt[0]+Nt[3]*Dt[1],Nt[0]*Dt[2]+Nt[2]*Dt[3],Nt[1]*Dt[2]+Nt[3]*Dt[3],Nt[0]*Dt[4]+Nt[2]*Dt[5]+Nt[4],Nt[1]*Dt[4]+Nt[3]*Dt[5]+Nt[5]]}static applyTransform(Nt,Dt){const se=Nt[0]*Dt[0]+Nt[1]*Dt[2]+Dt[4],re=Nt[0]*Dt[1]+Nt[1]*Dt[3]+Dt[5];return[se,re]}static applyInverseTransform(Nt,Dt){const se=Dt[0]*Dt[3]-Dt[1]*Dt[2],re=(Nt[0]*Dt[3]-Nt[1]*Dt[2]+Dt[2]*Dt[5]-Dt[4]*Dt[3])/se,Be=(-Nt[0]*Dt[1]+Nt[1]*Dt[0]+Dt[4]*Dt[1]-Dt[5]*Dt[0])/se;return[re,Be]}static getAxialAlignedBoundingBox(Nt,Dt){const se=this.applyTransform(Nt,Dt),re=this.applyTransform(Nt.slice(2,4),Dt),Be=this.applyTransform([Nt[0],Nt[3]],Dt),Ue=this.applyTransform([Nt[2],Nt[1]],Dt);return[Math.min(se[0],re[0],Be[0],Ue[0]),Math.min(se[1],re[1],Be[1],Ue[1]),Math.max(se[0],re[0],Be[0],Ue[0]),Math.max(se[1],re[1],Be[1],Ue[1])]}static inverseTransform(Nt){const Dt=Nt[0]*Nt[3]-Nt[1]*Nt[2];return[Nt[3]/Dt,-Nt[1]/Dt,-Nt[2]/Dt,Nt[0]/Dt,(Nt[2]*Nt[5]-Nt[4]*Nt[3])/Dt,(Nt[4]*Nt[1]-Nt[5]*Nt[0])/Dt]}static singularValueDecompose2dScale(Nt){const Dt=[Nt[0],Nt[2],Nt[1],Nt[3]],se=Nt[0]*Dt[0]+Nt[1]*Dt[2],re=Nt[0]*Dt[1]+Nt[1]*Dt[3],Be=Nt[2]*Dt[0]+Nt[3]*Dt[2],Ue=Nt[2]*Dt[1]+Nt[3]*Dt[3],$t=(se+Ue)/2,oe=Math.sqrt((se+Ue)**2-4*(se*Ue-Be*re))/2,ve=$t+oe||1,ue=$t-oe||1;return[Math.sqrt(ve),Math.sqrt(ue)]}static normalizeRect(Nt){const Dt=Nt.slice(0);return Nt[0]>Nt[2]&&(Dt[0]=Nt[2],Dt[2]=Nt[0]),Nt[1]>Nt[3]&&(Dt[1]=Nt[3],Dt[3]=Nt[1]),Dt}static intersect(Nt,Dt){const se=Math.max(Math.min(Nt[0],Nt[2]),Math.min(Dt[0],Dt[2])),re=Math.min(Math.max(Nt[0],Nt[2]),Math.max(Dt[0],Dt[2]));if(se>re)return null;const Be=Math.max(Math.min(Nt[1],Nt[3]),Math.min(Dt[1],Dt[3])),Ue=Math.min(Math.max(Nt[1],Nt[3]),Math.max(Dt[1],Dt[3]));return Be>Ue?null:[se,Be,re,Ue]}static bezierBoundingBox(Nt,Dt,se,re,Be,Ue,$t,oe){const ve=[],ue=[[],[]];let Se,we,$e,ne,Ie,ye,Et,W;for(let Lt=0;Lt<2;++Lt){if(Lt===0?(we=6*Nt-12*se+6*Be,Se=-3*Nt+9*se-9*Be+3*$t,$e=3*se-3*Nt):(we=6*Dt-12*re+6*Ue,Se=-3*Dt+9*re-9*Ue+3*oe,$e=3*re-3*Dt),Math.abs(Se)<1e-12){if(Math.abs(we)<1e-12)continue;ne=-$e/we,0<ne&&ne<1&&ve.push(ne);continue}Et=we*we-4*$e*Se,W=Math.sqrt(Et),!(Et<0)&&(Ie=(-we+W)/(2*Se),0<Ie&&Ie<1&&ve.push(Ie),ye=(-we-W)/(2*Se),0<ye&&ye<1&&ve.push(ye))}let nt=ve.length,Ct;const Mt=nt;for(;nt--;)ne=ve[nt],Ct=1-ne,ue[0][nt]=Ct*Ct*Ct*Nt+3*Ct*Ct*ne*se+3*Ct*ne*ne*Be+ne*ne*ne*$t,ue[1][nt]=Ct*Ct*Ct*Dt+3*Ct*Ct*ne*re+3*Ct*ne*ne*Ue+ne*ne*ne*oe;return ue[0][Mt]=Nt,ue[1][Mt]=Dt,ue[0][Mt+1]=$t,ue[1][Mt+1]=oe,ue[0].length=ue[1].length=Mt+2,[Math.min(...ue[0]),Math.min(...ue[1]),Math.max(...ue[0]),Math.max(...ue[1])]}}F.Util=le;const Ae=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function te(Yt){if(Yt[0]>="ï"){let Dt;if(Yt[0]==="þ"&&Yt[1]==="ÿ"?Dt="utf-16be":Yt[0]==="ÿ"&&Yt[1]==="þ"?Dt="utf-16le":Yt[0]==="ï"&&Yt[1]==="»"&&Yt[2]==="¿"&&(Dt="utf-8"),Dt)try{const se=new TextDecoder(Dt,{fatal:!0}),re=Wt(Yt);return se.decode(re)}catch(se){Vt(`stringToPDFString: "${se}".`)}}const Nt=[];for(let Dt=0,se=Yt.length;Dt<se;Dt++){const re=Ae[Yt.charCodeAt(Dt)];Nt.push(re?String.fromCharCode(re):Yt.charAt(Dt))}return Nt.join("")}function Ut(Yt){return decodeURIComponent(escape(Yt))}function Bt(Yt){return unescape(encodeURIComponent(Yt))}function Qt(Yt){return typeof Yt=="object"&&(Yt==null?void 0:Yt.byteLength)!==void 0}function ce(Yt,Nt){if(Yt.length!==Nt.length)return!1;for(let Dt=0,se=Yt.length;Dt<se;Dt++)if(Yt[Dt]!==Nt[Dt])return!1;return!0}function de(Yt=new Date){return[Yt.getUTCFullYear().toString(),(Yt.getUTCMonth()+1).toString().padStart(2,"0"),Yt.getUTCDate().toString().padStart(2,"0"),Yt.getUTCHours().toString().padStart(2,"0"),Yt.getUTCMinutes().toString().padStart(2,"0"),Yt.getUTCSeconds().toString().padStart(2,"0")].join("")}class xe{constructor(){xt(this,Oe,!1);this.promise=new Promise((Nt,Dt)=>{this.resolve=se=>{Ht(this,Oe,!0),Nt(se)},this.reject=se=>{Ht(this,Oe,!0),Dt(se)}})}get settled(){return O(this,Oe)}}Oe=new WeakMap,F.PromiseCapability=xe;let ke=null,Pe=null;function Re(Yt){return ke||(ke=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Pe=new Map([["ﬅ","ſt"]])),Yt.replaceAll(ke,(Nt,Dt,se)=>Dt?Dt.normalize("NFKC"):Pe.get(se))}function Fe(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const Yt=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(Yt);else for(let Nt=0;Nt<32;Nt++)Yt[Nt]=Math.floor(Math.random()*255);return Tt(Yt)}const Te="pdfjs_internal_id_";F.AnnotationPrefix=Te},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var K,B,D,U,Ke,it,ci,At,gt,et,vt,Pt,yt,ht,ut,st,hi,mt,_t,Ci,Y,Q;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports.build=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(rt){if(typeof rt=="string"||rt instanceof URL?rt={url:rt}:(0,_util.isArrayBuffer)(rt)&&(rt={data:rt}),typeof rt!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!rt.url&&!rt.data&&!rt.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const X=new PDFDocumentLoadingTask,{docId:bt}=X,at=rt.url?getUrlProp(rt.url):null,kt=rt.data?getDataProp(rt.data):null,Ot=rt.httpHeaders||null,ft=rt.withCredentials===!0,It=rt.password??null,qt=rt.range instanceof PDFDataRangeTransport?rt.range:null,Vt=Number.isInteger(rt.rangeChunkSize)&&rt.rangeChunkSize>0?rt.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let Rt=rt.worker instanceof PDFWorker?rt.worker:null;const Kt=rt.verbosity,ee=typeof rt.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(rt.docBaseUrl)?rt.docBaseUrl:null,he=typeof rt.cMapUrl=="string"?rt.cMapUrl:null,fe=rt.cMapPacked!==!1,pt=rt.CMapReaderFactory||DefaultCMapReaderFactory,z=typeof rt.standardFontDataUrl=="string"?rt.standardFontDataUrl:null,q=rt.StandardFontDataFactory||DefaultStandardFontDataFactory,G=rt.stopAtErrors!==!0,J=Number.isInteger(rt.maxImageSize)&&rt.maxImageSize>-1?rt.maxImageSize:-1,tt=rt.isEvalSupported!==!1,ot=typeof rt.isOffscreenCanvasSupported=="boolean"?rt.isOffscreenCanvasSupported:!_util.isNodeJS,wt=Number.isInteger(rt.canvasMaxAreaInBytes)?rt.canvasMaxAreaInBytes:-1,Tt=typeof rt.disableFontFace=="boolean"?rt.disableFontFace:_util.isNodeJS,Wt=rt.fontExtraProperties===!0,jt=rt.enableXfa===!0,Xt=rt.ownerDocument||globalThis.document,Jt=rt.disableRange===!0,ae=rt.disableStream===!0,Zt=rt.disableAutoFetch===!0,me=rt.pdfBug===!0,Ee=qt?qt.length:rt.length??NaN,le=typeof rt.useSystemFonts=="boolean"?rt.useSystemFonts:!_util.isNodeJS&&!Tt,Ae=typeof rt.useWorkerFetch=="boolean"?rt.useWorkerFetch:pt===_display_utils.DOMCMapReaderFactory&&q===_display_utils.DOMStandardFontDataFactory&&he&&z&&(0,_display_utils.isValidFetchUrl)(he,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(z,document.baseURI),te=rt.canvasFactory||new DefaultCanvasFactory({ownerDocument:Xt}),Ut=rt.filterFactory||new DefaultFilterFactory({docId:bt,ownerDocument:Xt}),Bt=null;(0,_util.setVerbosityLevel)(Kt);const Qt={canvasFactory:te,filterFactory:Ut};if(Ae||(Qt.cMapReaderFactory=new pt({baseUrl:he,isCompressed:fe}),Qt.standardFontDataFactory=new q({baseUrl:z})),!Rt){const xe={verbosity:Kt,port:_worker_options.GlobalWorkerOptions.workerPort};Rt=xe.port?PDFWorker.fromPort(xe):new PDFWorker(xe),X._worker=Rt}const ce={docId:bt,apiVersion:"3.11.174",data:kt,password:It,disableAutoFetch:Zt,rangeChunkSize:Vt,length:Ee,docBaseUrl:ee,enableXfa:jt,evaluatorOptions:{maxImageSize:J,disableFontFace:Tt,ignoreErrors:G,isEvalSupported:tt,isOffscreenCanvasSupported:ot,canvasMaxAreaInBytes:wt,fontExtraProperties:Wt,useSystemFonts:le,cMapUrl:Ae?he:null,standardFontDataUrl:Ae?z:null}},de={ignoreErrors:G,isEvalSupported:tt,disableFontFace:Tt,fontExtraProperties:Wt,enableXfa:jt,ownerDocument:Xt,disableAutoFetch:Zt,pdfBug:me,styleElement:Bt};return Rt.promise.then(function(){if(X.destroyed)throw new Error("Loading aborted");const xe=_fetchDocument(Rt,ce),ke=new Promise(function(Pe){let Re;qt?Re=new _transport_stream.PDFDataTransportStream({length:Ee,initialData:qt.initialData,progressiveDone:qt.progressiveDone,contentDispositionFilename:qt.contentDispositionFilename,disableRange:Jt,disableStream:ae},qt):kt||(Re=(Te=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(Te):(0,_display_utils.isValidFetchUrl)(Te.url)?new _displayFetch_stream.PDFFetchStream(Te):new _displayNetwork.PDFNetworkStream(Te))({url:at,length:Ee,httpHeaders:Ot,withCredentials:ft,rangeChunkSize:Vt,disableRange:Jt,disableStream:ae})),Pe(Re)});return Promise.all([xe,ke]).then(function([Pe,Re]){if(X.destroyed)throw new Error("Loading aborted");const Fe=new _message_handler.MessageHandler(bt,Pe,Rt.port),Te=new WorkerTransport(Fe,X,Re,de,Qt);X._transport=Te,Fe.send("Ready",null)})}).catch(X._capability.reject),X}async function _fetchDocument(rt,X){if(rt.destroyed)throw new Error("Worker was destroyed");const bt=await rt.messageHandler.sendWithPromise("GetDocRequest",X,X.data?[X.data.buffer]:null);if(rt.destroyed)throw new Error("Worker was destroyed");return bt}function getUrlProp(rt){if(rt instanceof URL)return rt.href;try{return new URL(rt,window.location).href}catch{if(_util.isNodeJS&&typeof rt=="string")return rt}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(rt){if(_util.isNodeJS&&typeof Buffer<"u"&&rt instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(rt instanceof Uint8Array&&rt.byteLength===rt.buffer.byteLength)return rt;if(typeof rt=="string")return(0,_util.stringToBytes)(rt);if(typeof rt=="object"&&!isNaN(rt==null?void 0:rt.length)||(0,_util.isArrayBuffer)(rt))return new Uint8Array(rt);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const F=class F{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${ei(F,K)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var X,bt,at;this.destroyed=!0;try{(X=this._worker)!=null&&X.port&&(this._worker._pendingDestroy=!0),await((bt=this._transport)==null?void 0:bt.destroy())}catch(kt){throw(at=this._worker)!=null&&at.port&&delete this._worker._pendingDestroy,kt}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};K=new WeakMap,xt(F,K,0);let PDFDocumentLoadingTask=F;exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(X,bt,at=!1,kt=null){this.length=X,this.initialData=bt,this.progressiveDone=at,this.contentDispositionFilename=kt,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(X){this._rangeListeners.push(X)}addProgressListener(X){this._progressListeners.push(X)}addProgressiveReadListener(X){this._progressiveReadListeners.push(X)}addProgressiveDoneListener(X){this._progressiveDoneListeners.push(X)}onDataRange(X,bt){for(const at of this._rangeListeners)at(X,bt)}onDataProgress(X,bt){this._readyCapability.promise.then(()=>{for(const at of this._progressListeners)at(X,bt)})}onDataProgressiveRead(X){this._readyCapability.promise.then(()=>{for(const bt of this._progressiveReadListeners)bt(X)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const X of this._progressiveDoneListeners)X()})}transportReady(){this._readyCapability.resolve()}requestDataRange(X,bt){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(X,bt){this._pdfInfo=X,this._transport=bt,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(at=>{if(!at)return at;const kt=[];for(const Ot in at)kt.push(...at[Ot]);return kt}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(X){return this._transport.getPage(X)}getPageIndex(X){return this._transport.getPageIndex(X)}getDestinations(){return this._transport.getDestinations()}getDestination(X){return this._transport.getDestination(X)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(X=!1){return this._transport.startCleanup(X||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(X,bt,at,kt=!1){xt(this,U);xt(this,it);xt(this,B,null);xt(this,D,!1);this._pageIndex=X,this._pageInfo=bt,this._transport=at,this._stats=kt?new _display_utils.StatTimer:null,this._pdfBug=kt,this.commonObjs=at.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:X,rotation:bt=this.rotate,offsetX:at=0,offsetY:kt=0,dontFlip:Ot=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:X,rotation:bt,offsetX:at,offsetY:kt,dontFlip:Ot})}getAnnotations({intent:X="display"}={}){const bt=this._transport.getRenderingIntent(X);return this._transport.getAnnotations(this._pageIndex,bt.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var X;return((X=this._transport._htmlForXfa)==null?void 0:X.children[this._pageIndex])||null}render({canvasContext:X,viewport:bt,intent:at="display",annotationMode:kt=_util.AnnotationMode.ENABLE,transform:Ot=null,background:ft=null,optionalContentConfigPromise:It=null,annotationCanvasMap:qt=null,pageColors:Vt=null,printAnnotationStorage:Rt=null}){var q,G;(q=this._stats)==null||q.time("Overall");const Kt=this._transport.getRenderingIntent(at,kt,Rt);Ht(this,D,!1),Ft(this,it,ci).call(this),It||(It=this._transport.getOptionalContentConfig());let ee=this._intentStates.get(Kt.cacheKey);ee||(ee=Object.create(null),this._intentStates.set(Kt.cacheKey,ee)),ee.streamReaderCancelTimeout&&(clearTimeout(ee.streamReaderCancelTimeout),ee.streamReaderCancelTimeout=null);const he=!!(Kt.renderingIntent&_util.RenderingIntentFlag.PRINT);ee.displayReadyCapability||(ee.displayReadyCapability=new _util.PromiseCapability,ee.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(G=this._stats)==null||G.time("Page Request"),this._pumpOperatorList(Kt));const fe=J=>{var tt,ot;ee.renderTasks.delete(pt),(this._maybeCleanupAfterRender||he)&&Ht(this,D,!0),Ft(this,U,Ke).call(this,!he),J?(pt.capability.reject(J),this._abortOperatorList({intentState:ee,reason:J instanceof Error?J:new Error(J)})):pt.capability.resolve(),(tt=this._stats)==null||tt.timeEnd("Rendering"),(ot=this._stats)==null||ot.timeEnd("Overall")},pt=new InternalRenderTask({callback:fe,params:{canvasContext:X,viewport:bt,transform:Ot,background:ft},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:qt,operatorList:ee.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!he,pdfBug:this._pdfBug,pageColors:Vt});(ee.renderTasks||(ee.renderTasks=new Set)).add(pt);const z=pt.task;return Promise.all([ee.displayReadyCapability.promise,It]).then(([J,tt])=>{var ot;if(this.destroyed){fe();return}(ot=this._stats)==null||ot.time("Rendering"),pt.initializeGraphics({transparency:J,optionalContentConfig:tt}),pt.operatorListChanged()}).catch(fe),z}getOperatorList({intent:X="display",annotationMode:bt=_util.AnnotationMode.ENABLE,printAnnotationStorage:at=null}={}){var qt;function kt(){ft.operatorList.lastChunk&&(ft.opListReadCapability.resolve(ft.operatorList),ft.renderTasks.delete(It))}const Ot=this._transport.getRenderingIntent(X,bt,at,!0);let ft=this._intentStates.get(Ot.cacheKey);ft||(ft=Object.create(null),this._intentStates.set(Ot.cacheKey,ft));let It;return ft.opListReadCapability||(It=Object.create(null),It.operatorListChanged=kt,ft.opListReadCapability=new _util.PromiseCapability,(ft.renderTasks||(ft.renderTasks=new Set)).add(It),ft.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(qt=this._stats)==null||qt.time("Page Request"),this._pumpOperatorList(Ot)),ft.opListReadCapability.promise}streamTextContent({includeMarkedContent:X=!1,disableNormalization:bt=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:X===!0,disableNormalization:bt===!0},{highWaterMark:100,size(kt){return kt.items.length}})}getTextContent(X={}){if(this._transport._htmlForXfa)return this.getXfa().then(at=>_xfa_text.XfaText.textContent(at));const bt=this.streamTextContent(X);return new Promise(function(at,kt){function Ot(){ft.read().then(function({value:qt,done:Vt}){if(Vt){at(It);return}Object.assign(It.styles,qt.styles),It.items.push(...qt.items),Ot()},kt)}const ft=bt.getReader(),It={items:[],styles:Object.create(null)};Ot()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const X=[];for(const bt of this._intentStates.values())if(this._abortOperatorList({intentState:bt,reason:new Error("Page was destroyed."),force:!0}),!bt.opListReadCapability)for(const at of bt.renderTasks)X.push(at.completed),at.cancel();return this.objs.clear(),Ht(this,D,!1),Ft(this,it,ci).call(this),Promise.all(X)}cleanup(X=!1){Ht(this,D,!0);const bt=Ft(this,U,Ke).call(this,!1);return X&&bt&&this._stats&&(this._stats=new _display_utils.StatTimer),bt}_startRenderPage(X,bt){var kt,Ot;const at=this._intentStates.get(bt);at&&((kt=this._stats)==null||kt.timeEnd("Page Request"),(Ot=at.displayReadyCapability)==null||Ot.resolve(X))}_renderPageChunk(X,bt){for(let at=0,kt=X.length;at<kt;at++)bt.operatorList.fnArray.push(X.fnArray[at]),bt.operatorList.argsArray.push(X.argsArray[at]);bt.operatorList.lastChunk=X.lastChunk,bt.operatorList.separateAnnots=X.separateAnnots;for(const at of bt.renderTasks)at.operatorListChanged();X.lastChunk&&Ft(this,U,Ke).call(this,!0)}_pumpOperatorList({renderingIntent:X,cacheKey:bt,annotationStorageSerializable:at}){const{map:kt,transfers:Ot}=at,It=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:X,cacheKey:bt,annotationStorage:kt},Ot).getReader(),qt=this._intentStates.get(bt);qt.streamReader=It;const Vt=()=>{It.read().then(({value:Rt,done:Kt})=>{if(Kt){qt.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(Rt,qt),Vt())},Rt=>{if(qt.streamReader=null,!this._transport.destroyed){if(qt.operatorList){qt.operatorList.lastChunk=!0;for(const Kt of qt.renderTasks)Kt.operatorListChanged();Ft(this,U,Ke).call(this,!0)}if(qt.displayReadyCapability)qt.displayReadyCapability.reject(Rt);else if(qt.opListReadCapability)qt.opListReadCapability.reject(Rt);else throw Rt}})};Vt()}_abortOperatorList({intentState:X,reason:bt,force:at=!1}){if(X.streamReader){if(X.streamReaderCancelTimeout&&(clearTimeout(X.streamReaderCancelTimeout),X.streamReaderCancelTimeout=null),!at){if(X.renderTasks.size>0)return;if(bt instanceof _display_utils.RenderingCancelledException){let kt=RENDERING_CANCELLED_TIMEOUT;bt.extraDelay>0&&bt.extraDelay<1e3&&(kt+=bt.extraDelay),X.streamReaderCancelTimeout=setTimeout(()=>{X.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:X,reason:bt,force:!0})},kt);return}}if(X.streamReader.cancel(new _util.AbortException(bt.message)).catch(()=>{}),X.streamReader=null,!this._transport.destroyed){for(const[kt,Ot]of this._intentStates)if(Ot===X){this._intentStates.delete(kt);break}this.cleanup()}}}get stats(){return this._stats}}B=new WeakMap,D=new WeakMap,U=new WeakSet,Ke=function(X=!1){if(Ft(this,it,ci).call(this),!O(this,D)||this.destroyed)return!1;if(X)return Ht(this,B,setTimeout(()=>{Ht(this,B,null),Ft(this,U,Ke).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:bt,operatorList:at}of this._intentStates.values())if(bt.size>0||!at.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),Ht(this,D,!1),!0},it=new WeakSet,ci=function(){O(this,B)&&(clearTimeout(O(this,B)),Ht(this,B,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){xt(this,At,new Set);xt(this,gt,Promise.resolve())}postMessage(X,bt){const at={data:structuredClone(X,bt?{transfer:bt}:null)};O(this,gt).then(()=>{for(const kt of O(this,At))kt.call(this,at)})}addEventListener(X,bt){O(this,At).add(bt)}removeEventListener(X,bt){O(this,At).delete(bt)}terminate(){O(this,At).clear()}}At=new WeakMap,gt=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const rt=(et=document==null?void 0:document.currentScript)==null?void 0:et.src;rt&&(PDFWorkerUtil.fallbackWorkerSrc=rt.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(rt,X){let bt;try{if(bt=new URL(rt),!bt.origin||bt.origin==="null")return!1}catch{return!1}const at=new URL(X,bt);return bt.origin===at.origin},PDFWorkerUtil.createCDNWrapper=function(rt){const X=`importScripts("${rt}");`;return URL.createObjectURL(new Blob([X]))}}const _PDFWorker=class _PDFWorker{constructor({name:rt=null,port:X=null,verbosity:bt=(0,_util.getVerbosityLevel)()}={}){var at;if(this.name=rt,this.destroyed=!1,this.verbosity=bt,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,X){if((at=O(_PDFWorker,vt))!=null&&at.has(X))throw new Error("Cannot use more than one PDFWorker per port.");(O(_PDFWorker,vt)||Ht(_PDFWorker,vt,new WeakMap)).set(X,this),this._initializeFromPort(X);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(rt){this._port=rt,this._messageHandler=new _message_handler.MessageHandler("main","worker",rt),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:rt}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,rt)||(rt=PDFWorkerUtil.createCDNWrapper(new URL(rt,window.location).href));const X=new Worker(rt),bt=new _message_handler.MessageHandler("main","worker",X),at=()=>{X.removeEventListener("error",kt),bt.destroy(),X.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},kt=()=>{this._webWorker||at()};X.addEventListener("error",kt),bt.on("test",ft=>{if(X.removeEventListener("error",kt),this.destroyed){at();return}ft?(this._messageHandler=bt,this._port=X,this._webWorker=X,this._readyCapability.resolve(),bt.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),bt.destroy(),X.terminate())}),bt.on("ready",ft=>{if(X.removeEventListener("error",kt),this.destroyed){at();return}try{Ot()}catch{this._setupFakeWorker()}});const Ot=()=>{const ft=new Uint8Array;bt.send("test",ft,[ft.buffer])};Ot();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(rt=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const X=new LoopbackPort;this._port=X;const bt=`fake${PDFWorkerUtil.fakeWorkerId++}`,at=new _message_handler.MessageHandler(bt+"_worker",bt,X);rt.setup(at,X);const kt=new _message_handler.MessageHandler(bt,bt+"_worker",X);this._messageHandler=kt,this._readyCapability.resolve(),kt.send("configure",{verbosity:this.verbosity})}).catch(rt=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${rt.message}".`))})}destroy(){var rt;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(rt=O(_PDFWorker,vt))==null||rt.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(rt){var bt;if(!(rt!=null&&rt.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const X=(bt=O(this,vt))==null?void 0:bt.get(rt.port);if(X){if(X._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return X}return new _PDFWorker(rt)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var rt;try{return((rt=globalThis.pdfjsWorker)==null?void 0:rt.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};vt=new WeakMap,xt(_PDFWorker,vt,void 0);let PDFWorker=_PDFWorker;exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(X,bt,at,kt,Ot){xt(this,st);xt(this,Pt,new Map);xt(this,yt,new Map);xt(this,ht,new Map);xt(this,ut,null);this.messageHandler=X,this.loadingTask=bt,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:kt.ownerDocument,styleElement:kt.styleElement}),this._params=kt,this.canvasFactory=Ot.canvasFactory,this.filterFactory=Ot.filterFactory,this.cMapReaderFactory=Ot.cMapReaderFactory,this.standardFontDataFactory=Ot.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=at,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(X,bt=_util.AnnotationMode.ENABLE,at=null,kt=!1){let Ot=_util.RenderingIntentFlag.DISPLAY,ft=_annotation_storage.SerializableEmpty;switch(X){case"any":Ot=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":Ot=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${X}`)}switch(bt){case _util.AnnotationMode.DISABLE:Ot+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:Ot+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:Ot+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,ft=(Ot&_util.RenderingIntentFlag.PRINT&&at instanceof _annotation_storage.PrintAnnotationStorage?at:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${bt}`)}return kt&&(Ot+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:Ot,cacheKey:`${Ot}_${ft.hash}`,annotationStorageSerializable:ft}}destroy(){var at;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,(at=O(this,ut))==null||at.reject(new Error("Worker was destroyed during onPassword callback"));const X=[];for(const kt of O(this,yt).values())X.push(kt._destroy());O(this,yt).clear(),O(this,ht).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const bt=this.messageHandler.sendWithPromise("Terminate",null);return X.push(bt),Promise.all(X).then(()=>{var kt;this.commonObjs.clear(),this.fontLoader.clear(),O(this,Pt).clear(),this.filterFactory.destroy(),(kt=this._networkStream)==null||kt.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:X,loadingTask:bt}=this;X.on("GetReader",(at,kt)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=Ot=>{this._lastProgress={loaded:Ot.loaded,total:Ot.total}},kt.onPull=()=>{this._fullReader.read().then(function({value:Ot,done:ft}){if(ft){kt.close();return}(0,_util.assert)(Ot instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),kt.enqueue(new Uint8Array(Ot),1,[Ot])}).catch(Ot=>{kt.error(Ot)})},kt.onCancel=Ot=>{this._fullReader.cancel(Ot),kt.ready.catch(ft=>{if(!this.destroyed)throw ft})}}),X.on("ReaderHeadersReady",at=>{const kt=new _util.PromiseCapability,Ot=this._fullReader;return Ot.headersReady.then(()=>{var ft;(!Ot.isStreamingSupported||!Ot.isRangeSupported)&&(this._lastProgress&&((ft=bt.onProgress)==null||ft.call(bt,this._lastProgress)),Ot.onProgress=It=>{var qt;(qt=bt.onProgress)==null||qt.call(bt,{loaded:It.loaded,total:It.total})}),kt.resolve({isStreamingSupported:Ot.isStreamingSupported,isRangeSupported:Ot.isRangeSupported,contentLength:Ot.contentLength})},kt.reject),kt.promise}),X.on("GetRangeReader",(at,kt)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const Ot=this._networkStream.getRangeReader(at.begin,at.end);if(!Ot){kt.close();return}kt.onPull=()=>{Ot.read().then(function({value:ft,done:It}){if(It){kt.close();return}(0,_util.assert)(ft instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),kt.enqueue(new Uint8Array(ft),1,[ft])}).catch(ft=>{kt.error(ft)})},kt.onCancel=ft=>{Ot.cancel(ft),kt.ready.catch(It=>{if(!this.destroyed)throw It})}}),X.on("GetDoc",({pdfInfo:at})=>{this._numPages=at.numPages,this._htmlForXfa=at.htmlForXfa,delete at.htmlForXfa,bt._capability.resolve(new PDFDocumentProxy(at,this))}),X.on("DocException",function(at){let kt;switch(at.name){case"PasswordException":kt=new _util.PasswordException(at.message,at.code);break;case"InvalidPDFException":kt=new _util.InvalidPDFException(at.message);break;case"MissingPDFException":kt=new _util.MissingPDFException(at.message);break;case"UnexpectedResponseException":kt=new _util.UnexpectedResponseException(at.message,at.status);break;case"UnknownErrorException":kt=new _util.UnknownErrorException(at.message,at.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}bt._capability.reject(kt)}),X.on("PasswordRequest",at=>{if(Ht(this,ut,new _util.PromiseCapability),bt.onPassword){const kt=Ot=>{Ot instanceof Error?O(this,ut).reject(Ot):O(this,ut).resolve({password:Ot})};try{bt.onPassword(kt,at.code)}catch(Ot){O(this,ut).reject(Ot)}}else O(this,ut).reject(new _util.PasswordException(at.message,at.code));return O(this,ut).promise}),X.on("DataLoaded",at=>{var kt;(kt=bt.onProgress)==null||kt.call(bt,{loaded:at.length,total:at.length}),this.downloadInfoCapability.resolve(at)}),X.on("StartRenderPage",at=>{if(this.destroyed)return;O(this,yt).get(at.pageIndex)._startRenderPage(at.transparency,at.cacheKey)}),X.on("commonobj",([at,kt,Ot])=>{var ft;if(!this.destroyed&&!this.commonObjs.has(at))switch(kt){case"Font":const It=this._params;if("error"in Ot){const Rt=Ot.error;(0,_util.warn)(`Error during font loading: ${Rt}`),this.commonObjs.resolve(at,Rt);break}const qt=It.pdfBug&&((ft=globalThis.FontInspector)!=null&&ft.enabled)?(Rt,Kt)=>globalThis.FontInspector.fontAdded(Rt,Kt):null,Vt=new _font_loader.FontFaceObject(Ot,{isEvalSupported:It.isEvalSupported,disableFontFace:It.disableFontFace,ignoreErrors:It.ignoreErrors,inspectFont:qt});this.fontLoader.bind(Vt).catch(Rt=>X.sendWithPromise("FontFallback",{id:at})).finally(()=>{!It.fontExtraProperties&&Vt.data&&(Vt.data=null),this.commonObjs.resolve(at,Vt)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(at,Ot);break;default:throw new Error(`Got unknown common object type ${kt}`)}}),X.on("obj",([at,kt,Ot,ft])=>{var qt;if(this.destroyed)return;const It=O(this,yt).get(kt);if(!It.objs.has(at))switch(Ot){case"Image":if(It.objs.resolve(at,ft),ft){let Vt;if(ft.bitmap){const{width:Rt,height:Kt}=ft;Vt=Rt*Kt*4}else Vt=((qt=ft.data)==null?void 0:qt.length)||0;Vt>_util.MAX_IMAGE_SIZE_TO_CACHE&&(It._maybeCleanupAfterRender=!0)}break;case"Pattern":It.objs.resolve(at,ft);break;default:throw new Error(`Got unknown object type ${Ot}`)}}),X.on("DocProgress",at=>{var kt;this.destroyed||(kt=bt.onProgress)==null||kt.call(bt,{loaded:at.loaded,total:at.total})}),X.on("FetchBuiltInCMap",at=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(at):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),X.on("FetchStandardFontData",at=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(at):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var at;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:X,transfers:bt}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:X,filename:((at=this._fullReader)==null?void 0:at.filename)??null},bt).finally(()=>{this.annotationStorage.resetModified()})}getPage(X){if(!Number.isInteger(X)||X<=0||X>this._numPages)return Promise.reject(new Error("Invalid page request."));const bt=X-1,at=O(this,ht).get(bt);if(at)return at;const kt=this.messageHandler.sendWithPromise("GetPage",{pageIndex:bt}).then(Ot=>{if(this.destroyed)throw new Error("Transport destroyed");const ft=new PDFPageProxy(bt,Ot,this,this._params.pdfBug);return O(this,yt).set(bt,ft),ft});return O(this,ht).set(bt,kt),kt}getPageIndex(X){return typeof X!="object"||X===null||!Number.isInteger(X.num)||X.num<0||!Number.isInteger(X.gen)||X.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:X.num,gen:X.gen})}getAnnotations(X,bt){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:X,intent:bt})}getFieldObjects(){return Ft(this,st,hi).call(this,"GetFieldObjects")}hasJSActions(){return Ft(this,st,hi).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(X){return typeof X!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:X})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return Ft(this,st,hi).call(this,"GetDocJSActions")}getPageJSActions(X){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:X})}getStructTree(X){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:X})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(X=>new _optional_content_config.OptionalContentConfig(X))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const X="GetMetadata",bt=O(this,Pt).get(X);if(bt)return bt;const at=this.messageHandler.sendWithPromise(X,null).then(kt=>{var Ot,ft;return{info:kt[0],metadata:kt[1]?new _metadata.Metadata(kt[1]):null,contentDispositionFilename:((Ot=this._fullReader)==null?void 0:Ot.filename)??null,contentLength:((ft=this._fullReader)==null?void 0:ft.contentLength)??null}});return O(this,Pt).set(X,at),at}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(X=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const bt of O(this,yt).values())if(!bt.cleanup())throw new Error(`startCleanup: Page ${bt.pageNumber} is currently rendering.`);this.commonObjs.clear(),X||this.fontLoader.clear(),O(this,Pt).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:X,enableXfa:bt}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:X,enableXfa:bt})}}Pt=new WeakMap,yt=new WeakMap,ht=new WeakMap,ut=new WeakMap,st=new WeakSet,hi=function(X,bt=null){const at=O(this,Pt).get(X);if(at)return at;const kt=this.messageHandler.sendWithPromise(X,bt);return O(this,Pt).set(X,kt),kt};class PDFObjects{constructor(){xt(this,_t);xt(this,mt,Object.create(null))}get(X,bt=null){if(bt){const kt=Ft(this,_t,Ci).call(this,X);return kt.capability.promise.then(()=>bt(kt.data)),null}const at=O(this,mt)[X];if(!(at!=null&&at.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${X}.`);return at.data}has(X){const bt=O(this,mt)[X];return(bt==null?void 0:bt.capability.settled)||!1}resolve(X,bt=null){const at=Ft(this,_t,Ci).call(this,X);at.data=bt,at.capability.resolve()}clear(){var X;for(const bt in O(this,mt)){const{data:at}=O(this,mt)[bt];(X=at==null?void 0:at.bitmap)==null||X.close()}Ht(this,mt,Object.create(null))}}mt=new WeakMap,_t=new WeakSet,Ci=function(X){var bt;return(bt=O(this,mt))[X]||(bt[X]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(X){xt(this,Y,null);Ht(this,Y,X),this.onContinue=null}get promise(){return O(this,Y).capability.promise}cancel(X=0){O(this,Y).cancel(null,X)}get separateAnnots(){const{separateAnnots:X}=O(this,Y).operatorList;if(!X)return!1;const{annotationCanvasMap:bt}=O(this,Y);return X.form||X.canvas&&(bt==null?void 0:bt.size)>0}}Y=new WeakMap,exports.RenderTask=RenderTask;const St=class St{constructor({callback:X,params:bt,objs:at,commonObjs:kt,annotationCanvasMap:Ot,operatorList:ft,pageIndex:It,canvasFactory:qt,filterFactory:Vt,useRequestAnimationFrame:Rt=!1,pdfBug:Kt=!1,pageColors:ee=null}){this.callback=X,this.params=bt,this.objs=at,this.commonObjs=kt,this.annotationCanvasMap=Ot,this.operatorListIdx=null,this.operatorList=ft,this._pageIndex=It,this.canvasFactory=qt,this.filterFactory=Vt,this._pdfBug=Kt,this.pageColors=ee,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=Rt===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=bt.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:X=!1,optionalContentConfig:bt}){var It,qt;if(this.cancelled)return;if(this._canvas){if(O(St,Q).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");O(St,Q).add(this._canvas)}this._pdfBug&&((It=globalThis.StepperManager)!=null&&It.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:at,viewport:kt,transform:Ot,background:ft}=this.params;this.gfx=new _canvas.CanvasGraphics(at,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:bt},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:Ot,viewport:kt,transparency:X,background:ft}),this.operatorListIdx=0,this.graphicsReady=!0,(qt=this.graphicsReadyCallback)==null||qt.call(this)}cancel(X=null,bt=0){var at;this.running=!1,this.cancelled=!0,(at=this.gfx)==null||at.endDrawing(),O(St,Q).delete(this._canvas),this.callback(X||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,bt))}operatorListChanged(){var X;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(X=this.stepper)==null||X.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),O(St,Q).delete(this._canvas),this.callback())))}};Q=new WeakMap,xt(St,Q,new WeakSet);let InternalRenderTask=St;const version="3.11.174";exports.version=version;const build="ce8716743";exports.build=build},(K,F,B)=>{var gt,et,vt,os,yt;Object.defineProperty(F,"__esModule",{value:!0}),F.SerializableEmpty=F.PrintAnnotationStorage=F.AnnotationStorage=void 0;var D=B(1),U=B(4),ct=B(8);const it=Object.freeze({map:null,hash:"",transfers:void 0});F.SerializableEmpty=it;class zt{constructor(){xt(this,vt);xt(this,gt,!1);xt(this,et,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(ut,st){const lt=O(this,et).get(ut);return lt===void 0?st:Object.assign(st,lt)}getRawValue(ut){return O(this,et).get(ut)}remove(ut){if(O(this,et).delete(ut),O(this,et).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const st of O(this,et).values())if(st instanceof U.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(ut,st){const lt=O(this,et).get(ut);let mt=!1;if(lt!==void 0)for(const[_t,dt]of Object.entries(st))lt[_t]!==dt&&(mt=!0,lt[_t]=dt);else mt=!0,O(this,et).set(ut,st);mt&&Ft(this,vt,os).call(this),st instanceof U.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(st.constructor._type)}has(ut){return O(this,et).has(ut)}getAll(){return O(this,et).size>0?(0,D.objectFromMap)(O(this,et)):null}setAll(ut){for(const[st,lt]of Object.entries(ut))this.setValue(st,lt)}get size(){return O(this,et).size}resetModified(){O(this,gt)&&(Ht(this,gt,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new At(this)}get serializable(){if(O(this,et).size===0)return it;const ut=new Map,st=new ct.MurmurHash3_64,lt=[],mt=Object.create(null);let _t=!1;for(const[dt,Y]of O(this,et)){const Q=Y instanceof U.AnnotationEditor?Y.serialize(!1,mt):Y;Q&&(ut.set(dt,Q),st.update(`${dt}:${JSON.stringify(Q)}`),_t||(_t=!!Q.bitmap))}if(_t)for(const dt of ut.values())dt.bitmap&&lt.push(dt.bitmap);return ut.size>0?{map:ut,hash:st.hexdigest(),transfers:lt}:it}}gt=new WeakMap,et=new WeakMap,vt=new WeakSet,os=function(){O(this,gt)||(Ht(this,gt,!0),typeof this.onSetModified=="function"&&this.onSetModified())},F.AnnotationStorage=zt;class At extends zt{constructor(st){super();xt(this,yt,void 0);const{map:lt,hash:mt,transfers:_t}=st.serializable,dt=structuredClone(lt,_t?{transfer:_t}:null);Ht(this,yt,{map:dt,hash:mt,transfers:_t})}get print(){(0,D.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return O(this,yt)}}yt=new WeakMap,F.PrintAnnotationStorage=At},(K,F,B)=>{var At,gt,et,vt,Pt,yt,ht,ut,st,lt,mt,_t,dt,Y,Q,xi,rt,Pi,bt,Ti,kt,ki,ft,ls,qt,cs,Rt,hs,ee,Mi,fe,ds;Object.defineProperty(F,"__esModule",{value:!0}),F.AnnotationEditor=void 0;var D=B(5),U=B(1),ct=B(6);const z=class z{constructor(G){xt(this,Q);xt(this,rt);xt(this,kt);xt(this,ft);xt(this,qt);xt(this,Rt);xt(this,ee);xt(this,fe);xt(this,At,"");xt(this,gt,!1);xt(this,et,null);xt(this,vt,null);xt(this,Pt,null);xt(this,yt,!1);xt(this,ht,null);xt(this,ut,this.focusin.bind(this));xt(this,st,this.focusout.bind(this));xt(this,lt,!1);xt(this,mt,!1);xt(this,_t,!1);je(this,"_initialOptions",Object.create(null));je(this,"_uiManager",null);je(this,"_focusEventsAllowed",!0);je(this,"_l10nPromise",null);xt(this,dt,!1);xt(this,Y,z._zIndex++);this.constructor===z&&(0,U.unreachable)("Cannot initialize AnnotationEditor."),this.parent=G.parent,this.id=G.id,this.width=this.height=null,this.pageIndex=G.parent.pageIndex,this.name=G.name,this.div=null,this._uiManager=G.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=G.isCentered,this._structTreeParentId=null;const{rotation:J,rawDims:{pageWidth:tt,pageHeight:ot,pageX:wt,pageY:Tt}}=this.parent.viewport;this.rotation=J,this.pageRotation=(360+J-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[tt,ot],this.pageTranslation=[wt,Tt];const[Wt,jt]=this.parentDimensions;this.x=G.x/Wt,this.y=G.y/jt,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,U.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(G){const J=new zt({id:G.parent.getNextId(),parent:G.parent,uiManager:G._uiManager});J.annotationElementId=G.annotationElementId,J.deleted=!0,J._uiManager.addToAnnotationStorage(J)}static initialize(G,J=null){if(z._l10nPromise||(z._l10nPromise=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(ot=>[ot,G.get(ot)]))),J!=null&&J.strings)for(const ot of J.strings)z._l10nPromise.set(ot,G.get(ot));if(z._borderLineWidth!==-1)return;const tt=getComputedStyle(document.documentElement);z._borderLineWidth=parseFloat(tt.getPropertyValue("--outline-width"))||0}static updateDefaultParams(G,J){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(G){return!1}static paste(G,J){(0,U.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return O(this,dt)}set _isDraggable(G){var J;Ht(this,dt,G),(J=this.div)==null||J.classList.toggle("draggable",G)}center(){const[G,J]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*J/(G*2),this.y+=this.width*G/(J*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*J/(G*2),this.y-=this.width*G/(J*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(G){this._uiManager.addCommands(G)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=O(this,Y)}setParent(G){G!==null&&(this.pageIndex=G.pageIndex,this.pageDimensions=G.pageDimensions),this.parent=G}focusin(G){this._focusEventsAllowed&&(O(this,lt)?Ht(this,lt,!1):this.parent.setSelected(this))}focusout(G){var tt;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const J=G.relatedTarget;J!=null&&J.closest(`#${this.id}`)||(G.preventDefault(),(tt=this.parent)!=null&&tt.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(G,J,tt,ot){const[wt,Tt]=this.parentDimensions;[tt,ot]=this.screenToPageTranslation(tt,ot),this.x=(G+tt)/wt,this.y=(J+ot)/Tt,this.fixAndSetPosition()}translate(G,J){Ft(this,Q,xi).call(this,this.parentDimensions,G,J)}translateInPage(G,J){Ft(this,Q,xi).call(this,this.pageDimensions,G,J),this.div.scrollIntoView({block:"nearest"})}drag(G,J){const[tt,ot]=this.parentDimensions;if(this.x+=G/tt,this.y+=J/ot,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:Xt,y:Jt}=this.div.getBoundingClientRect();this.parent.findNewParent(this,Xt,Jt)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:wt,y:Tt}=this;const[Wt,jt]=Ft(this,rt,Pi).call(this);wt+=Wt,Tt+=jt,this.div.style.left=`${(100*wt).toFixed(2)}%`,this.div.style.top=`${(100*Tt).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[G,J]=this.pageDimensions;let{x:tt,y:ot,width:wt,height:Tt}=this;switch(wt*=G,Tt*=J,tt*=G,ot*=J,this.rotation){case 0:tt=Math.max(0,Math.min(G-wt,tt)),ot=Math.max(0,Math.min(J-Tt,ot));break;case 90:tt=Math.max(0,Math.min(G-Tt,tt)),ot=Math.min(J,Math.max(wt,ot));break;case 180:tt=Math.min(G,Math.max(wt,tt)),ot=Math.min(J,Math.max(Tt,ot));break;case 270:tt=Math.min(G,Math.max(Tt,tt)),ot=Math.max(0,Math.min(J-wt,ot));break}this.x=tt/=G,this.y=ot/=J;const[Wt,jt]=Ft(this,rt,Pi).call(this);tt+=Wt,ot+=jt;const{style:Xt}=this.div;Xt.left=`${(100*tt).toFixed(2)}%`,Xt.top=`${(100*ot).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(G,J){var tt;return Ft(tt=z,bt,Ti).call(tt,G,J,this.parentRotation)}pageTranslationToScreen(G,J){var tt;return Ft(tt=z,bt,Ti).call(tt,G,J,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:G,pageDimensions:[J,tt]}=this,ot=J*G,wt=tt*G;return U.FeatureTest.isCSSRoundSupported?[Math.round(ot),Math.round(wt)]:[ot,wt]}setDims(G,J){var wt;const[tt,ot]=this.parentDimensions;this.div.style.width=`${(100*G/tt).toFixed(2)}%`,O(this,yt)||(this.div.style.height=`${(100*J/ot).toFixed(2)}%`),(wt=O(this,et))==null||wt.classList.toggle("small",G<z.SMALL_EDITOR_SIZE||J<z.SMALL_EDITOR_SIZE)}fixDims(){const{style:G}=this.div,{height:J,width:tt}=G,ot=tt.endsWith("%"),wt=!O(this,yt)&&J.endsWith("%");if(ot&&wt)return;const[Tt,Wt]=this.parentDimensions;ot||(G.width=`${(100*parseFloat(tt)/Tt).toFixed(2)}%`),!O(this,yt)&&!wt&&(G.height=`${(100*parseFloat(J)/Wt).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}async addAltTextButton(){if(O(this,et))return;const G=Ht(this,et,document.createElement("button"));G.className="altText";const J=await z._l10nPromise.get("editor_alt_text_button_label");G.textContent=J,G.setAttribute("aria-label",J),G.tabIndex="0",G.addEventListener("contextmenu",ct.noContextMenu),G.addEventListener("pointerdown",tt=>tt.stopPropagation()),G.addEventListener("click",tt=>{tt.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),G.addEventListener("keydown",tt=>{tt.target===G&&tt.key==="Enter"&&(tt.preventDefault(),this._uiManager.editAltText(this))}),Ft(this,ee,Mi).call(this),this.div.append(G),z.SMALL_EDITOR_SIZE||(z.SMALL_EDITOR_SIZE=Math.min(128,Math.round(G.getBoundingClientRect().width*1.4)))}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:O(this,At),decorative:O(this,gt)}}set altTextData({altText:G,decorative:J}){O(this,At)===G&&O(this,gt)===J||(Ht(this,At,G),Ht(this,gt,J),Ft(this,ee,Mi).call(this))}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",O(this,ut)),this.div.addEventListener("focusout",O(this,st));const[G,J]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*J/G).toFixed(2)}%`,this.div.style.maxHeight=`${(100*G/J).toFixed(2)}%`);const[tt,ot]=this.getInitialTranslation();return this.translate(tt,ot),(0,D.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(G){const{isMac:J}=U.FeatureTest.platform;if(G.button!==0||G.ctrlKey&&J){G.preventDefault();return}Ht(this,lt,!0),Ft(this,fe,ds).call(this,G)}moveInDOM(){var G;(G=this.parent)==null||G.moveEditorInDOM(this)}_setParentAndPosition(G,J,tt){G.changeParent(this),this.x=J,this.y=tt,this.fixAndSetPosition()}getRect(G,J){const tt=this.parentScale,[ot,wt]=this.pageDimensions,[Tt,Wt]=this.pageTranslation,jt=G/tt,Xt=J/tt,Jt=this.x*ot,ae=this.y*wt,Zt=this.width*ot,me=this.height*wt;switch(this.rotation){case 0:return[Jt+jt+Tt,wt-ae-Xt-me+Wt,Jt+jt+Zt+Tt,wt-ae-Xt+Wt];case 90:return[Jt+Xt+Tt,wt-ae+jt+Wt,Jt+Xt+me+Tt,wt-ae+jt+Zt+Wt];case 180:return[Jt-jt-Zt+Tt,wt-ae+Xt+Wt,Jt-jt+Tt,wt-ae+Xt+me+Wt];case 270:return[Jt-Xt-me+Tt,wt-ae-jt-Zt+Wt,Jt-Xt+Tt,wt-ae-jt+Wt];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(G,J){const[tt,ot,wt,Tt]=G,Wt=wt-tt,jt=Tt-ot;switch(this.rotation){case 0:return[tt,J-Tt,Wt,jt];case 90:return[tt,J-ot,jt,Wt];case 180:return[wt,J-ot,Wt,jt];case 270:return[wt,J-Tt,jt,Wt];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){Ht(this,_t,!0)}disableEditMode(){Ht(this,_t,!1)}isInEditMode(){return O(this,_t)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var G,J;(G=this.div)==null||G.addEventListener("focusin",O(this,ut)),(J=this.div)==null||J.addEventListener("focusout",O(this,st))}serialize(G=!1,J=null){(0,U.unreachable)("An editor must be serializable")}static deserialize(G,J,tt){const ot=new this.prototype.constructor({parent:J,id:J.getNextId(),uiManager:tt});ot.rotation=G.rotation;const[wt,Tt]=ot.pageDimensions,[Wt,jt,Xt,Jt]=ot.getRectInCurrentCoords(G.rect,Tt);return ot.x=Wt/wt,ot.y=jt/Tt,ot.width=Xt/wt,ot.height=Jt/Tt,ot}remove(){var G;this.div.removeEventListener("focusin",O(this,ut)),this.div.removeEventListener("focusout",O(this,st)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),(G=O(this,et))==null||G.remove(),Ht(this,et,null),Ht(this,vt,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(Ft(this,ft,ls).call(this),O(this,ht).classList.remove("hidden"))}select(){var G;this.makeResizable(),(G=this.div)==null||G.classList.add("selectedEditor")}unselect(){var G,J,tt;(G=O(this,ht))==null||G.classList.add("hidden"),(J=this.div)==null||J.classList.remove("selectedEditor"),(tt=this.div)!=null&&tt.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(G,J){}disableEditing(){O(this,et)&&(O(this,et).hidden=!0)}enableEditing(){O(this,et)&&(O(this,et).hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return O(this,mt)}set isEditing(G){Ht(this,mt,G),this.parent&&(G?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(G,J){Ht(this,yt,!0);const tt=G/J,{style:ot}=this.div;ot.aspectRatio=tt,ot.height="auto"}static get MIN_SIZE(){return 16}};At=new WeakMap,gt=new WeakMap,et=new WeakMap,vt=new WeakMap,Pt=new WeakMap,yt=new WeakMap,ht=new WeakMap,ut=new WeakMap,st=new WeakMap,lt=new WeakMap,mt=new WeakMap,_t=new WeakMap,dt=new WeakMap,Y=new WeakMap,Q=new WeakSet,xi=function([G,J],tt,ot){[tt,ot]=this.screenToPageTranslation(tt,ot),this.x+=tt/G,this.y+=ot/J,this.fixAndSetPosition()},rt=new WeakSet,Pi=function(){const[G,J]=this.parentDimensions,{_borderLineWidth:tt}=z,ot=tt/G,wt=tt/J;switch(this.rotation){case 90:return[-ot,wt];case 180:return[ot,wt];case 270:return[ot,-wt];default:return[-ot,-wt]}},bt=new WeakSet,Ti=function(G,J,tt){switch(tt){case 90:return[J,-G];case 180:return[-G,-J];case 270:return[-J,G];default:return[G,J]}},kt=new WeakSet,ki=function(G){switch(G){case 90:{const[J,tt]=this.pageDimensions;return[0,-J/tt,tt/J,0]}case 180:return[-1,0,0,-1];case 270:{const[J,tt]=this.pageDimensions;return[0,J/tt,-tt/J,0]}default:return[1,0,0,1]}},ft=new WeakSet,ls=function(){if(O(this,ht))return;Ht(this,ht,document.createElement("div")),O(this,ht).classList.add("resizers");const G=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||G.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const J of G){const tt=document.createElement("div");O(this,ht).append(tt),tt.classList.add("resizer",J),tt.addEventListener("pointerdown",Ft(this,qt,cs).bind(this,J)),tt.addEventListener("contextmenu",ct.noContextMenu)}this.div.prepend(O(this,ht))},qt=new WeakSet,cs=function(G,J){J.preventDefault();const{isMac:tt}=U.FeatureTest.platform;if(J.button!==0||J.ctrlKey&&tt)return;const ot=Ft(this,Rt,hs).bind(this,G),wt=this._isDraggable;this._isDraggable=!1;const Tt={passive:!0,capture:!0};window.addEventListener("pointermove",ot,Tt);const Wt=this.x,jt=this.y,Xt=this.width,Jt=this.height,ae=this.parent.div.style.cursor,Zt=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(J.target).cursor;const me=()=>{this._isDraggable=wt,window.removeEventListener("pointerup",me),window.removeEventListener("blur",me),window.removeEventListener("pointermove",ot,Tt),this.parent.div.style.cursor=ae,this.div.style.cursor=Zt;const Ee=this.x,le=this.y,Ae=this.width,te=this.height;Ee===Wt&&le===jt&&Ae===Xt&&te===Jt||this.addCommands({cmd:()=>{this.width=Ae,this.height=te,this.x=Ee,this.y=le;const[Ut,Bt]=this.parentDimensions;this.setDims(Ut*Ae,Bt*te),this.fixAndSetPosition()},undo:()=>{this.width=Xt,this.height=Jt,this.x=Wt,this.y=jt;const[Ut,Bt]=this.parentDimensions;this.setDims(Ut*Xt,Bt*Jt),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",me),window.addEventListener("blur",me)},Rt=new WeakSet,hs=function(G,J){const[tt,ot]=this.parentDimensions,wt=this.x,Tt=this.y,Wt=this.width,jt=this.height,Xt=z.MIN_SIZE/tt,Jt=z.MIN_SIZE/ot,ae=se=>Math.round(se*1e4)/1e4,Zt=Ft(this,kt,ki).call(this,this.rotation),me=(se,re)=>[Zt[0]*se+Zt[2]*re,Zt[1]*se+Zt[3]*re],Ee=Ft(this,kt,ki).call(this,360-this.rotation),le=(se,re)=>[Ee[0]*se+Ee[2]*re,Ee[1]*se+Ee[3]*re];let Ae,te,Ut=!1,Bt=!1;switch(G){case"topLeft":Ut=!0,Ae=(se,re)=>[0,0],te=(se,re)=>[se,re];break;case"topMiddle":Ae=(se,re)=>[se/2,0],te=(se,re)=>[se/2,re];break;case"topRight":Ut=!0,Ae=(se,re)=>[se,0],te=(se,re)=>[0,re];break;case"middleRight":Bt=!0,Ae=(se,re)=>[se,re/2],te=(se,re)=>[0,re/2];break;case"bottomRight":Ut=!0,Ae=(se,re)=>[se,re],te=(se,re)=>[0,0];break;case"bottomMiddle":Ae=(se,re)=>[se/2,re],te=(se,re)=>[se/2,0];break;case"bottomLeft":Ut=!0,Ae=(se,re)=>[0,re],te=(se,re)=>[se,0];break;case"middleLeft":Bt=!0,Ae=(se,re)=>[0,re/2],te=(se,re)=>[se,re/2];break}const Qt=Ae(Wt,jt),ce=te(Wt,jt);let de=me(...ce);const xe=ae(wt+de[0]),ke=ae(Tt+de[1]);let Pe=1,Re=1,[Fe,Te]=this.screenToPageTranslation(J.movementX,J.movementY);if([Fe,Te]=le(Fe/tt,Te/ot),Ut){const se=Math.hypot(Wt,jt);Pe=Re=Math.max(Math.min(Math.hypot(ce[0]-Qt[0]-Fe,ce[1]-Qt[1]-Te)/se,1/Wt,1/jt),Xt/Wt,Jt/jt)}else Bt?Pe=Math.max(Xt,Math.min(1,Math.abs(ce[0]-Qt[0]-Fe)))/Wt:Re=Math.max(Jt,Math.min(1,Math.abs(ce[1]-Qt[1]-Te)))/jt;const Oe=ae(Wt*Pe),Yt=ae(jt*Re);de=me(...te(Oe,Yt));const Nt=xe-de[0],Dt=ke-de[1];this.width=Oe,this.height=Yt,this.x=Nt,this.y=Dt,this.setDims(tt*Oe,ot*Yt),this.fixAndSetPosition()},ee=new WeakSet,Mi=async function(){var tt;const G=O(this,et);if(!G)return;if(!O(this,At)&&!O(this,gt)){G.classList.remove("done"),(tt=O(this,vt))==null||tt.remove();return}z._l10nPromise.get("editor_alt_text_edit_button_label").then(ot=>{G.setAttribute("aria-label",ot)});let J=O(this,vt);if(!J){Ht(this,vt,J=document.createElement("span")),J.className="tooltip",J.setAttribute("role","tooltip");const ot=J.id=`alt-text-tooltip-${this.id}`;G.setAttribute("aria-describedby",ot);const wt=100;G.addEventListener("mouseenter",()=>{Ht(this,Pt,setTimeout(()=>{Ht(this,Pt,null),O(this,vt).classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},wt))}),G.addEventListener("mouseleave",()=>{var Tt;clearTimeout(O(this,Pt)),Ht(this,Pt,null),(Tt=O(this,vt))==null||Tt.classList.remove("show")})}G.classList.add("done"),J.innerText=O(this,gt)?await z._l10nPromise.get("editor_alt_text_decorative_tooltip"):O(this,At),J.parentNode||G.append(J)},fe=new WeakSet,ds=function(G){if(!this._isDraggable)return;const J=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let tt,ot;J&&(tt={passive:!0,capture:!0},ot=Tt=>{const[Wt,jt]=this.screenToPageTranslation(Tt.movementX,Tt.movementY);this._uiManager.dragSelectedEditors(Wt,jt)},window.addEventListener("pointermove",ot,tt));const wt=()=>{if(window.removeEventListener("pointerup",wt),window.removeEventListener("blur",wt),J&&window.removeEventListener("pointermove",ot,tt),Ht(this,lt,!1),!this._uiManager.endDragSession()){const{isMac:Tt}=U.FeatureTest.platform;G.ctrlKey&&!Tt||G.shiftKey||G.metaKey&&Tt?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",wt),window.addEventListener("blur",wt)},xt(z,bt),je(z,"_borderLineWidth",-1),je(z,"_colorManager",new D.ColorManager),je(z,"_zIndex",1),je(z,"SMALL_EDITOR_SIZE",0);let it=z;F.AnnotationEditor=it;class zt extends it{constructor(G){super(G),this.annotationElementId=G.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(K,F,B)=>{var yt,ht,ut,st,lt,Ri,dt,Y,Q,St,rt,us,at,kt,Ot,ft,It,qt,Vt,Rt,Kt,ee,he,fe,pt,z,q,G,J,tt,ot,wt,Tt,Wt,jt,Xt,Jt,ae,Zt,me,Ee,le,Ae,te,Ut,Bt,Qt,ps,de,Fi,ke,Di,Re,di,Te,Oi,Yt,Ii,Dt,Ge,re,ii,Ue,gs,oe,ms,ue,Li,we,si,ne,$i;Object.defineProperty(F,"__esModule",{value:!0}),F.KeyboardManager=F.CommandManager=F.ColorManager=F.AnnotationEditorUIManager=void 0,F.bindEvents=ct,F.opacityToHex=it;var D=B(1),U=B(6);function ct(Et,W,nt){for(const Ct of nt)W.addEventListener(Ct,Et[Ct].bind(Et))}function it(Et){return Math.round(Math.min(255,Math.max(1,255*Et))).toString(16).padStart(2,"0")}class zt{constructor(){xt(this,yt,0)}getId(){return`${D.AnnotationEditorPrefix}${ei(this,yt)._++}`}}yt=new WeakMap;const _t=class _t{constructor(){xt(this,lt);xt(this,ht,(0,D.getUuid)());xt(this,ut,0);xt(this,st,null)}static get _isSVGFittingCanvas(){const W='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',Ct=new OffscreenCanvas(1,3).getContext("2d"),Mt=new Image;Mt.src=W;const Lt=Mt.decode().then(()=>(Ct.drawImage(Mt,0,0,1,1,0,0,1,3),new Uint32Array(Ct.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,D.shadow)(this,"_isSVGFittingCanvas",Lt)}async getFromFile(W){const{lastModified:nt,name:Ct,size:Mt,type:Lt}=W;return Ft(this,lt,Ri).call(this,`${nt}_${Ct}_${Mt}_${Lt}`,W)}async getFromUrl(W){return Ft(this,lt,Ri).call(this,W,W)}async getFromId(W){O(this,st)||Ht(this,st,new Map);const nt=O(this,st).get(W);return nt?nt.bitmap?(nt.refCounter+=1,nt):nt.file?this.getFromFile(nt.file):this.getFromUrl(nt.url):null}getSvgUrl(W){const nt=O(this,st).get(W);return nt!=null&&nt.isSvg?nt.svgUrl:null}deleteId(W){O(this,st)||Ht(this,st,new Map);const nt=O(this,st).get(W);nt&&(nt.refCounter-=1,nt.refCounter===0&&(nt.bitmap=null))}isValidId(W){return W.startsWith(`image_${O(this,ht)}_`)}};ht=new WeakMap,ut=new WeakMap,st=new WeakMap,lt=new WeakSet,Ri=async function(W,nt){O(this,st)||Ht(this,st,new Map);let Ct=O(this,st).get(W);if(Ct===null)return null;if(Ct!=null&&Ct.bitmap)return Ct.refCounter+=1,Ct;try{Ct||(Ct={bitmap:null,id:`image_${O(this,ht)}_${ei(this,ut)._++}`,refCounter:0,isSvg:!1});let Mt;if(typeof nt=="string"){Ct.url=nt;const Lt=await fetch(nt);if(!Lt.ok)throw new Error(Lt.statusText);Mt=await Lt.blob()}else Mt=Ct.file=nt;if(Mt.type==="image/svg+xml"){const Lt=_t._isSVGFittingCanvas,Gt=new FileReader,ie=new Image,ge=new Promise((pe,Me)=>{ie.onload=()=>{Ct.bitmap=ie,Ct.isSvg=!0,pe()},Gt.onload=async()=>{const _e=Ct.svgUrl=Gt.result;ie.src=await Lt?`${_e}#svgView(preserveAspectRatio(none))`:_e},ie.onerror=Gt.onerror=Me});Gt.readAsDataURL(Mt),await ge}else Ct.bitmap=await createImageBitmap(Mt);Ct.refCounter=1}catch(Mt){console.error(Mt),Ct=null}return O(this,st).set(W,Ct),Ct&&O(this,st).set(Ct.id,Ct),Ct};let At=_t;class gt{constructor(W=128){xt(this,dt,[]);xt(this,Y,!1);xt(this,Q,void 0);xt(this,St,-1);Ht(this,Q,W)}add({cmd:W,undo:nt,mustExec:Ct,type:Mt=NaN,overwriteIfSameType:Lt=!1,keepUndo:Gt=!1}){if(Ct&&W(),O(this,Y))return;const ie={cmd:W,undo:nt,type:Mt};if(O(this,St)===-1){O(this,dt).length>0&&(O(this,dt).length=0),Ht(this,St,0),O(this,dt).push(ie);return}if(Lt&&O(this,dt)[O(this,St)].type===Mt){Gt&&(ie.undo=O(this,dt)[O(this,St)].undo),O(this,dt)[O(this,St)]=ie;return}const ge=O(this,St)+1;ge===O(this,Q)?O(this,dt).splice(0,1):(Ht(this,St,ge),ge<O(this,dt).length&&O(this,dt).splice(ge)),O(this,dt).push(ie)}undo(){O(this,St)!==-1&&(Ht(this,Y,!0),O(this,dt)[O(this,St)].undo(),Ht(this,Y,!1),Ht(this,St,O(this,St)-1))}redo(){O(this,St)<O(this,dt).length-1&&(Ht(this,St,O(this,St)+1),Ht(this,Y,!0),O(this,dt)[O(this,St)].cmd(),Ht(this,Y,!1))}hasSomethingToUndo(){return O(this,St)!==-1}hasSomethingToRedo(){return O(this,St)<O(this,dt).length-1}destroy(){Ht(this,dt,null)}}dt=new WeakMap,Y=new WeakMap,Q=new WeakMap,St=new WeakMap,F.CommandManager=gt;class et{constructor(W){xt(this,rt);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:nt}=D.FeatureTest.platform;for(const[Ct,Mt,Lt={}]of W)for(const Gt of Ct){const ie=Gt.startsWith("mac+");nt&&ie?(this.callbacks.set(Gt.slice(4),{callback:Mt,options:Lt}),this.allKeys.add(Gt.split("+").at(-1))):!nt&&!ie&&(this.callbacks.set(Gt,{callback:Mt,options:Lt}),this.allKeys.add(Gt.split("+").at(-1)))}}exec(W,nt){if(!this.allKeys.has(nt.key))return;const Ct=this.callbacks.get(Ft(this,rt,us).call(this,nt));if(!Ct)return;const{callback:Mt,options:{bubbles:Lt=!1,args:Gt=[],checker:ie=null}}=Ct;ie&&!ie(W,nt)||(Mt.bind(W,...Gt)(),Lt||(nt.stopPropagation(),nt.preventDefault()))}}rt=new WeakSet,us=function(W){W.altKey&&this.buffer.push("alt"),W.ctrlKey&&this.buffer.push("ctrl"),W.metaKey&&this.buffer.push("meta"),W.shiftKey&&this.buffer.push("shift"),this.buffer.push(W.key);const nt=this.buffer.join("+");return this.buffer.length=0,nt},F.KeyboardManager=et;const bt=class bt{get _colors(){const W=new Map([["CanvasText",null],["Canvas",null]]);return(0,U.getColorValues)(W),(0,D.shadow)(this,"_colors",W)}convert(W){const nt=(0,U.getRGB)(W);if(!window.matchMedia("(forced-colors: active)").matches)return nt;for(const[Ct,Mt]of this._colors)if(Mt.every((Lt,Gt)=>Lt===nt[Gt]))return bt._colorsMapping.get(Ct);return nt}getHexCode(W){const nt=this._colors.get(W);return nt?D.Util.makeHexColor(...nt):W}};je(bt,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let vt=bt;F.ColorManager=vt;const ye=class ye{constructor(W,nt,Ct,Mt,Lt,Gt){xt(this,Qt);xt(this,de);xt(this,ke);xt(this,Re);xt(this,Te);xt(this,Yt);xt(this,Dt);xt(this,re);xt(this,Ue);xt(this,oe);xt(this,ue);xt(this,we);xt(this,ne);xt(this,at,null);xt(this,kt,new Map);xt(this,Ot,new Map);xt(this,ft,null);xt(this,It,null);xt(this,qt,new gt);xt(this,Vt,0);xt(this,Rt,new Set);xt(this,Kt,null);xt(this,ee,null);xt(this,he,new Set);xt(this,fe,null);xt(this,pt,new zt);xt(this,z,!1);xt(this,q,!1);xt(this,G,null);xt(this,J,D.AnnotationEditorType.NONE);xt(this,tt,new Set);xt(this,ot,null);xt(this,wt,this.blur.bind(this));xt(this,Tt,this.focus.bind(this));xt(this,Wt,this.copy.bind(this));xt(this,jt,this.cut.bind(this));xt(this,Xt,this.paste.bind(this));xt(this,Jt,this.keydown.bind(this));xt(this,ae,this.onEditingAction.bind(this));xt(this,Zt,this.onPageChanging.bind(this));xt(this,me,this.onScaleChanging.bind(this));xt(this,Ee,this.onRotationChanging.bind(this));xt(this,le,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});xt(this,Ae,[0,0]);xt(this,te,null);xt(this,Ut,null);xt(this,Bt,null);Ht(this,Ut,W),Ht(this,Bt,nt),Ht(this,ft,Ct),this._eventBus=Mt,this._eventBus._on("editingaction",O(this,ae)),this._eventBus._on("pagechanging",O(this,Zt)),this._eventBus._on("scalechanging",O(this,me)),this._eventBus._on("rotationchanging",O(this,Ee)),Ht(this,It,Lt.annotationStorage),Ht(this,fe,Lt.filterFactory),Ht(this,ot,Gt),this.viewParameters={realScale:U.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const W=ye.prototype,nt=Lt=>{const{activeElement:Gt}=document;return Gt&&O(Lt,Ut).contains(Gt)&&Lt.hasSomethingToControl()},Ct=this.TRANSLATE_SMALL,Mt=this.TRANSLATE_BIG;return(0,D.shadow)(this,"_keyboardManager",new et([[["ctrl+a","mac+meta+a"],W.selectAll],[["ctrl+z","mac+meta+z"],W.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],W.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],W.delete],[["Escape","mac+Escape"],W.unselectAll],[["ArrowLeft","mac+ArrowLeft"],W.translateSelectedEditors,{args:[-Ct,0],checker:nt}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],W.translateSelectedEditors,{args:[-Mt,0],checker:nt}],[["ArrowRight","mac+ArrowRight"],W.translateSelectedEditors,{args:[Ct,0],checker:nt}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],W.translateSelectedEditors,{args:[Mt,0],checker:nt}],[["ArrowUp","mac+ArrowUp"],W.translateSelectedEditors,{args:[0,-Ct],checker:nt}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],W.translateSelectedEditors,{args:[0,-Mt],checker:nt}],[["ArrowDown","mac+ArrowDown"],W.translateSelectedEditors,{args:[0,Ct],checker:nt}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],W.translateSelectedEditors,{args:[0,Mt],checker:nt}]]))}destroy(){Ft(this,Re,di).call(this),Ft(this,de,Fi).call(this),this._eventBus._off("editingaction",O(this,ae)),this._eventBus._off("pagechanging",O(this,Zt)),this._eventBus._off("scalechanging",O(this,me)),this._eventBus._off("rotationchanging",O(this,Ee));for(const W of O(this,Ot).values())W.destroy();O(this,Ot).clear(),O(this,kt).clear(),O(this,he).clear(),Ht(this,at,null),O(this,tt).clear(),O(this,qt).destroy(),O(this,ft).destroy()}get hcmFilter(){return(0,D.shadow)(this,"hcmFilter",O(this,ot)?O(this,fe).addHCMFilter(O(this,ot).foreground,O(this,ot).background):"none")}get direction(){return(0,D.shadow)(this,"direction",getComputedStyle(O(this,Ut)).direction)}editAltText(W){var nt;(nt=O(this,ft))==null||nt.editAltText(this,W)}onPageChanging({pageNumber:W}){Ht(this,Vt,W-1)}focusMainContainer(){O(this,Ut).focus()}findParent(W,nt){for(const Ct of O(this,Ot).values()){const{x:Mt,y:Lt,width:Gt,height:ie}=Ct.div.getBoundingClientRect();if(W>=Mt&&W<=Mt+Gt&&nt>=Lt&&nt<=Lt+ie)return Ct}return null}disableUserSelect(W=!1){O(this,Bt).classList.toggle("noUserSelect",W)}addShouldRescale(W){O(this,he).add(W)}removeShouldRescale(W){O(this,he).delete(W)}onScaleChanging({scale:W}){this.commitOrRemove(),this.viewParameters.realScale=W*U.PixelsPerInch.PDF_TO_CSS_UNITS;for(const nt of O(this,he))nt.onScaleChanging()}onRotationChanging({pagesRotation:W}){this.commitOrRemove(),this.viewParameters.rotation=W}addToAnnotationStorage(W){!W.isEmpty()&&O(this,It)&&!O(this,It).has(W.id)&&O(this,It).setValue(W.id,W)}blur(){if(!this.hasSelection)return;const{activeElement:W}=document;for(const nt of O(this,tt))if(nt.div.contains(W)){Ht(this,G,[nt,W]),nt._focusEventsAllowed=!1;break}}focus(){if(!O(this,G))return;const[W,nt]=O(this,G);Ht(this,G,null),nt.addEventListener("focusin",()=>{W._focusEventsAllowed=!0},{once:!0}),nt.focus()}addEditListeners(){Ft(this,ke,Di).call(this),Ft(this,Te,Oi).call(this)}removeEditListeners(){Ft(this,Re,di).call(this),Ft(this,Yt,Ii).call(this)}copy(W){var Ct;if(W.preventDefault(),(Ct=O(this,at))==null||Ct.commitOrRemove(),!this.hasSelection)return;const nt=[];for(const Mt of O(this,tt)){const Lt=Mt.serialize(!0);Lt&&nt.push(Lt)}nt.length!==0&&W.clipboardData.setData("application/pdfjs",JSON.stringify(nt))}cut(W){this.copy(W),this.delete()}paste(W){W.preventDefault();const{clipboardData:nt}=W;for(const Lt of nt.items)for(const Gt of O(this,ee))if(Gt.isHandlingMimeForPasting(Lt.type)){Gt.paste(Lt,this.currentLayer);return}let Ct=nt.getData("application/pdfjs");if(!Ct)return;try{Ct=JSON.parse(Ct)}catch(Lt){(0,D.warn)(`paste: "${Lt.message}".`);return}if(!Array.isArray(Ct))return;this.unselectAll();const Mt=this.currentLayer;try{const Lt=[];for(const ge of Ct){const pe=Mt.deserialize(ge);if(!pe)return;Lt.push(pe)}const Gt=()=>{for(const ge of Lt)Ft(this,ue,Li).call(this,ge);Ft(this,ne,$i).call(this,Lt)},ie=()=>{for(const ge of Lt)ge.remove()};this.addCommands({cmd:Gt,undo:ie,mustExec:!0})}catch(Lt){(0,D.warn)(`paste: "${Lt.message}".`)}}keydown(W){var nt;(nt=this.getActive())!=null&&nt.shouldGetKeyboardEvents()||ye._keyboardManager.exec(this,W)}onEditingAction(W){["undo","redo","delete","selectAll"].includes(W.name)&&this[W.name]()}setEditingState(W){W?(Ft(this,Qt,ps).call(this),Ft(this,ke,Di).call(this),Ft(this,Te,Oi).call(this),Ft(this,Dt,Ge).call(this,{isEditing:O(this,J)!==D.AnnotationEditorType.NONE,isEmpty:Ft(this,we,si).call(this),hasSomethingToUndo:O(this,qt).hasSomethingToUndo(),hasSomethingToRedo:O(this,qt).hasSomethingToRedo(),hasSelectedEditor:!1})):(Ft(this,de,Fi).call(this),Ft(this,Re,di).call(this),Ft(this,Yt,Ii).call(this),Ft(this,Dt,Ge).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(W){if(!O(this,ee)){Ht(this,ee,W);for(const nt of O(this,ee))Ft(this,re,ii).call(this,nt.defaultPropertiesToUpdate)}}getId(){return O(this,pt).getId()}get currentLayer(){return O(this,Ot).get(O(this,Vt))}getLayer(W){return O(this,Ot).get(W)}get currentPageIndex(){return O(this,Vt)}addLayer(W){O(this,Ot).set(W.pageIndex,W),O(this,z)?W.enable():W.disable()}removeLayer(W){O(this,Ot).delete(W.pageIndex)}updateMode(W,nt=null){if(O(this,J)!==W){if(Ht(this,J,W),W===D.AnnotationEditorType.NONE){this.setEditingState(!1),Ft(this,oe,ms).call(this);return}this.setEditingState(!0),Ft(this,Ue,gs).call(this),this.unselectAll();for(const Ct of O(this,Ot).values())Ct.updateMode(W);if(nt){for(const Ct of O(this,kt).values())if(Ct.annotationElementId===nt){this.setSelected(Ct),Ct.enterInEditMode();break}}}}updateToolbar(W){W!==O(this,J)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:W})}updateParams(W,nt){if(O(this,ee)){if(W===D.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(W);return}for(const Ct of O(this,tt))Ct.updateParams(W,nt);for(const Ct of O(this,ee))Ct.updateDefaultParams(W,nt)}}enableWaiting(W=!1){if(O(this,q)!==W){Ht(this,q,W);for(const nt of O(this,Ot).values())W?nt.disableClick():nt.enableClick(),nt.div.classList.toggle("waiting",W)}}getEditors(W){const nt=[];for(const Ct of O(this,kt).values())Ct.pageIndex===W&&nt.push(Ct);return nt}getEditor(W){return O(this,kt).get(W)}addEditor(W){O(this,kt).set(W.id,W)}removeEditor(W){var nt;O(this,kt).delete(W.id),this.unselect(W),(!W.annotationElementId||!O(this,Rt).has(W.annotationElementId))&&((nt=O(this,It))==null||nt.remove(W.id))}addDeletedAnnotationElement(W){O(this,Rt).add(W.annotationElementId),W.deleted=!0}isDeletedAnnotationElement(W){return O(this,Rt).has(W)}removeDeletedAnnotationElement(W){O(this,Rt).delete(W.annotationElementId),W.deleted=!1}setActiveEditor(W){O(this,at)!==W&&(Ht(this,at,W),W&&Ft(this,re,ii).call(this,W.propertiesToUpdate))}toggleSelected(W){if(O(this,tt).has(W)){O(this,tt).delete(W),W.unselect(),Ft(this,Dt,Ge).call(this,{hasSelectedEditor:this.hasSelection});return}O(this,tt).add(W),W.select(),Ft(this,re,ii).call(this,W.propertiesToUpdate),Ft(this,Dt,Ge).call(this,{hasSelectedEditor:!0})}setSelected(W){for(const nt of O(this,tt))nt!==W&&nt.unselect();O(this,tt).clear(),O(this,tt).add(W),W.select(),Ft(this,re,ii).call(this,W.propertiesToUpdate),Ft(this,Dt,Ge).call(this,{hasSelectedEditor:!0})}isSelected(W){return O(this,tt).has(W)}unselect(W){W.unselect(),O(this,tt).delete(W),Ft(this,Dt,Ge).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return O(this,tt).size!==0}undo(){O(this,qt).undo(),Ft(this,Dt,Ge).call(this,{hasSomethingToUndo:O(this,qt).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:Ft(this,we,si).call(this)})}redo(){O(this,qt).redo(),Ft(this,Dt,Ge).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:O(this,qt).hasSomethingToRedo(),isEmpty:Ft(this,we,si).call(this)})}addCommands(W){O(this,qt).add(W),Ft(this,Dt,Ge).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:Ft(this,we,si).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const W=[...O(this,tt)],nt=()=>{for(const Mt of W)Mt.remove()},Ct=()=>{for(const Mt of W)Ft(this,ue,Li).call(this,Mt)};this.addCommands({cmd:nt,undo:Ct,mustExec:!0})}commitOrRemove(){var W;(W=O(this,at))==null||W.commitOrRemove()}hasSomethingToControl(){return O(this,at)||this.hasSelection}selectAll(){for(const W of O(this,tt))W.commit();Ft(this,ne,$i).call(this,O(this,kt).values())}unselectAll(){if(O(this,at)){O(this,at).commitOrRemove();return}if(this.hasSelection){for(const W of O(this,tt))W.unselect();O(this,tt).clear(),Ft(this,Dt,Ge).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(W,nt,Ct=!1){if(Ct||this.commitOrRemove(),!this.hasSelection)return;O(this,Ae)[0]+=W,O(this,Ae)[1]+=nt;const[Mt,Lt]=O(this,Ae),Gt=[...O(this,tt)],ie=1e3;O(this,te)&&clearTimeout(O(this,te)),Ht(this,te,setTimeout(()=>{Ht(this,te,null),O(this,Ae)[0]=O(this,Ae)[1]=0,this.addCommands({cmd:()=>{for(const ge of Gt)O(this,kt).has(ge.id)&&ge.translateInPage(Mt,Lt)},undo:()=>{for(const ge of Gt)O(this,kt).has(ge.id)&&ge.translateInPage(-Mt,-Lt)},mustExec:!1})},ie));for(const ge of Gt)ge.translateInPage(W,nt)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),Ht(this,Kt,new Map);for(const W of O(this,tt))O(this,Kt).set(W,{savedX:W.x,savedY:W.y,savedPageIndex:W.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!O(this,Kt))return!1;this.disableUserSelect(!1);const W=O(this,Kt);Ht(this,Kt,null);let nt=!1;for(const[{x:Mt,y:Lt,pageIndex:Gt},ie]of W)ie.newX=Mt,ie.newY=Lt,ie.newPageIndex=Gt,nt||(nt=Mt!==ie.savedX||Lt!==ie.savedY||Gt!==ie.savedPageIndex);if(!nt)return!1;const Ct=(Mt,Lt,Gt,ie)=>{if(O(this,kt).has(Mt.id)){const ge=O(this,Ot).get(ie);ge?Mt._setParentAndPosition(ge,Lt,Gt):(Mt.pageIndex=ie,Mt.x=Lt,Mt.y=Gt)}};return this.addCommands({cmd:()=>{for(const[Mt,{newX:Lt,newY:Gt,newPageIndex:ie}]of W)Ct(Mt,Lt,Gt,ie)},undo:()=>{for(const[Mt,{savedX:Lt,savedY:Gt,savedPageIndex:ie}]of W)Ct(Mt,Lt,Gt,ie)},mustExec:!0}),!0}dragSelectedEditors(W,nt){if(O(this,Kt))for(const Ct of O(this,Kt).keys())Ct.drag(W,nt)}rebuild(W){if(W.parent===null){const nt=this.getLayer(W.pageIndex);nt?(nt.changeParent(W),nt.addOrRebuild(W)):(this.addEditor(W),this.addToAnnotationStorage(W),W.rebuild())}else W.parent.addOrRebuild(W)}isActive(W){return O(this,at)===W}getActive(){return O(this,at)}getMode(){return O(this,J)}get imageManager(){return(0,D.shadow)(this,"imageManager",new At)}};at=new WeakMap,kt=new WeakMap,Ot=new WeakMap,ft=new WeakMap,It=new WeakMap,qt=new WeakMap,Vt=new WeakMap,Rt=new WeakMap,Kt=new WeakMap,ee=new WeakMap,he=new WeakMap,fe=new WeakMap,pt=new WeakMap,z=new WeakMap,q=new WeakMap,G=new WeakMap,J=new WeakMap,tt=new WeakMap,ot=new WeakMap,wt=new WeakMap,Tt=new WeakMap,Wt=new WeakMap,jt=new WeakMap,Xt=new WeakMap,Jt=new WeakMap,ae=new WeakMap,Zt=new WeakMap,me=new WeakMap,Ee=new WeakMap,le=new WeakMap,Ae=new WeakMap,te=new WeakMap,Ut=new WeakMap,Bt=new WeakMap,Qt=new WeakSet,ps=function(){window.addEventListener("focus",O(this,Tt)),window.addEventListener("blur",O(this,wt))},de=new WeakSet,Fi=function(){window.removeEventListener("focus",O(this,Tt)),window.removeEventListener("blur",O(this,wt))},ke=new WeakSet,Di=function(){window.addEventListener("keydown",O(this,Jt),{capture:!0})},Re=new WeakSet,di=function(){window.removeEventListener("keydown",O(this,Jt),{capture:!0})},Te=new WeakSet,Oi=function(){document.addEventListener("copy",O(this,Wt)),document.addEventListener("cut",O(this,jt)),document.addEventListener("paste",O(this,Xt))},Yt=new WeakSet,Ii=function(){document.removeEventListener("copy",O(this,Wt)),document.removeEventListener("cut",O(this,jt)),document.removeEventListener("paste",O(this,Xt))},Dt=new WeakSet,Ge=function(W){Object.entries(W).some(([Ct,Mt])=>O(this,le)[Ct]!==Mt)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(O(this,le),W)})},re=new WeakSet,ii=function(W){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:W})},Ue=new WeakSet,gs=function(){if(!O(this,z)){Ht(this,z,!0);for(const W of O(this,Ot).values())W.enable()}},oe=new WeakSet,ms=function(){if(this.unselectAll(),O(this,z)){Ht(this,z,!1);for(const W of O(this,Ot).values())W.disable()}},ue=new WeakSet,Li=function(W){const nt=O(this,Ot).get(W.pageIndex);nt?nt.addOrRebuild(W):this.addEditor(W)},we=new WeakSet,si=function(){if(O(this,kt).size===0)return!0;if(O(this,kt).size===1)for(const W of O(this,kt).values())return W.isEmpty();return!1},ne=new WeakSet,$i=function(W){O(this,tt).clear();for(const nt of W)nt.isEmpty()||(O(this,tt).add(nt),nt.select());Ft(this,Dt,Ge).call(this,{hasSelectedEditor:!0})},je(ye,"TRANSLATE_SMALL",1),je(ye,"TRANSLATE_BIG",10);let Pt=ye;F.AnnotationEditorUIManager=Pt},(K,F,B)=>{var Vt,Rt,Kt,ee,he,fe,pt,z,q,G,J,tt,Je,wt,Qe,Wt,Ni,Xt,pi,ae,fi,me,ni,le,ri;Object.defineProperty(F,"__esModule",{value:!0}),F.StatTimer=F.RenderingCancelledException=F.PixelsPerInch=F.PageViewport=F.PDFDateString=F.DOMStandardFontDataFactory=F.DOMSVGFactory=F.DOMFilterFactory=F.DOMCanvasFactory=F.DOMCMapReaderFactory=void 0,F.deprecated=St,F.getColorValues=kt,F.getCurrentTransform=Ot,F.getCurrentTransformInverse=ft,F.getFilenameFromUrl=lt,F.getPdfFilenameFromUrl=mt,F.getRGB=at,F.getXfaPageViewport=bt,F.isDataScheme=ut,F.isPdfFile=st,F.isValidFetchUrl=dt,F.loadScript=Q,F.noContextMenu=Y,F.setLayerDimensions=It;var D=B(7),U=B(1);const ct="http://www.w3.org/2000/svg",qt=class qt{};je(qt,"CSS",96),je(qt,"PDF",72),je(qt,"PDF_TO_CSS_UNITS",qt.CSS/qt.PDF);let it=qt;F.PixelsPerInch=it;class zt extends D.BaseFilterFactory{constructor({docId:Bt,ownerDocument:Qt=globalThis.document}={}){super();xt(this,tt);xt(this,wt);xt(this,Wt);xt(this,Xt);xt(this,ae);xt(this,me);xt(this,le);xt(this,Vt,void 0);xt(this,Rt,void 0);xt(this,Kt,void 0);xt(this,ee,void 0);xt(this,he,void 0);xt(this,fe,void 0);xt(this,pt,void 0);xt(this,z,void 0);xt(this,q,void 0);xt(this,G,void 0);xt(this,J,0);Ht(this,Kt,Bt),Ht(this,ee,Qt)}addFilter(Bt){if(!Bt)return"none";let Qt=O(this,tt,Je).get(Bt);if(Qt)return Qt;let ce,de,xe,ke;if(Bt.length===1){const Te=Bt[0],Oe=new Array(256);for(let Yt=0;Yt<256;Yt++)Oe[Yt]=Te[Yt]/255;ke=ce=de=xe=Oe.join(",")}else{const[Te,Oe,Yt]=Bt,Nt=new Array(256),Dt=new Array(256),se=new Array(256);for(let re=0;re<256;re++)Nt[re]=Te[re]/255,Dt[re]=Oe[re]/255,se[re]=Yt[re]/255;ce=Nt.join(","),de=Dt.join(","),xe=se.join(","),ke=`${ce}${de}${xe}`}if(Qt=O(this,tt,Je).get(ke),Qt)return O(this,tt,Je).set(Bt,Qt),Qt;const Pe=`g_${O(this,Kt)}_transfer_map_${ei(this,J)._++}`,Re=`url(#${Pe})`;O(this,tt,Je).set(Bt,Re),O(this,tt,Je).set(ke,Re);const Fe=Ft(this,Xt,pi).call(this,Pe);return Ft(this,me,ni).call(this,ce,de,xe,Fe),Re}addHCMFilter(Bt,Qt){var Oe;const ce=`${Bt}-${Qt}`;if(O(this,fe)===ce)return O(this,pt);if(Ht(this,fe,ce),Ht(this,pt,"none"),(Oe=O(this,he))==null||Oe.remove(),!Bt||!Qt)return O(this,pt);const de=Ft(this,le,ri).call(this,Bt);Bt=U.Util.makeHexColor(...de);const xe=Ft(this,le,ri).call(this,Qt);if(Qt=U.Util.makeHexColor(...xe),O(this,wt,Qe).style.color="",Bt==="#000000"&&Qt==="#ffffff"||Bt===Qt)return O(this,pt);const ke=new Array(256);for(let Yt=0;Yt<=255;Yt++){const Nt=Yt/255;ke[Yt]=Nt<=.03928?Nt/12.92:((Nt+.055)/1.055)**2.4}const Pe=ke.join(","),Re=`g_${O(this,Kt)}_hcm_filter`,Fe=Ht(this,z,Ft(this,Xt,pi).call(this,Re));Ft(this,me,ni).call(this,Pe,Pe,Pe,Fe),Ft(this,Wt,Ni).call(this,Fe);const Te=(Yt,Nt)=>{const Dt=de[Yt]/255,se=xe[Yt]/255,re=new Array(Nt+1);for(let Be=0;Be<=Nt;Be++)re[Be]=Dt+Be/Nt*(se-Dt);return re.join(",")};return Ft(this,me,ni).call(this,Te(0,5),Te(1,5),Te(2,5),Fe),Ht(this,pt,`url(#${Re})`),O(this,pt)}addHighlightHCMFilter(Bt,Qt,ce,de){var se;const xe=`${Bt}-${Qt}-${ce}-${de}`;if(O(this,q)===xe)return O(this,G);if(Ht(this,q,xe),Ht(this,G,"none"),(se=O(this,z))==null||se.remove(),!Bt||!Qt)return O(this,G);const[ke,Pe]=[Bt,Qt].map(Ft(this,le,ri).bind(this));let Re=Math.round(.2126*ke[0]+.7152*ke[1]+.0722*ke[2]),Fe=Math.round(.2126*Pe[0]+.7152*Pe[1]+.0722*Pe[2]),[Te,Oe]=[ce,de].map(Ft(this,le,ri).bind(this));Fe<Re&&([Re,Fe,Te,Oe]=[Fe,Re,Oe,Te]),O(this,wt,Qe).style.color="";const Yt=(re,Be,Ue)=>{const $t=new Array(256),oe=(Fe-Re)/Ue,ve=re/255,ue=(Be-re)/(255*Ue);let Se=0;for(let we=0;we<=Ue;we++){const $e=Math.round(Re+we*oe),ne=ve+we*ue;for(let Ie=Se;Ie<=$e;Ie++)$t[Ie]=ne;Se=$e+1}for(let we=Se;we<256;we++)$t[we]=$t[Se-1];return $t.join(",")},Nt=`g_${O(this,Kt)}_hcm_highlight_filter`,Dt=Ht(this,z,Ft(this,Xt,pi).call(this,Nt));return Ft(this,Wt,Ni).call(this,Dt),Ft(this,me,ni).call(this,Yt(Te[0],Oe[0],5),Yt(Te[1],Oe[1],5),Yt(Te[2],Oe[2],5),Dt),Ht(this,G,`url(#${Nt})`),O(this,G)}destroy(Bt=!1){Bt&&(O(this,pt)||O(this,G))||(O(this,Rt)&&(O(this,Rt).parentNode.parentNode.remove(),Ht(this,Rt,null)),O(this,Vt)&&(O(this,Vt).clear(),Ht(this,Vt,null)),Ht(this,J,0))}}Vt=new WeakMap,Rt=new WeakMap,Kt=new WeakMap,ee=new WeakMap,he=new WeakMap,fe=new WeakMap,pt=new WeakMap,z=new WeakMap,q=new WeakMap,G=new WeakMap,J=new WeakMap,tt=new WeakSet,Je=function(){return O(this,Vt)||Ht(this,Vt,new Map)},wt=new WeakSet,Qe=function(){if(!O(this,Rt)){const Bt=O(this,ee).createElement("div"),{style:Qt}=Bt;Qt.visibility="hidden",Qt.contain="strict",Qt.width=Qt.height=0,Qt.position="absolute",Qt.top=Qt.left=0,Qt.zIndex=-1;const ce=O(this,ee).createElementNS(ct,"svg");ce.setAttribute("width",0),ce.setAttribute("height",0),Ht(this,Rt,O(this,ee).createElementNS(ct,"defs")),Bt.append(ce),ce.append(O(this,Rt)),O(this,ee).body.append(Bt)}return O(this,Rt)},Wt=new WeakSet,Ni=function(Bt){const Qt=O(this,ee).createElementNS(ct,"feColorMatrix");Qt.setAttribute("type","matrix"),Qt.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),Bt.append(Qt)},Xt=new WeakSet,pi=function(Bt){const Qt=O(this,ee).createElementNS(ct,"filter");return Qt.setAttribute("color-interpolation-filters","sRGB"),Qt.setAttribute("id",Bt),O(this,wt,Qe).append(Qt),Qt},ae=new WeakSet,fi=function(Bt,Qt,ce){const de=O(this,ee).createElementNS(ct,Qt);de.setAttribute("type","discrete"),de.setAttribute("tableValues",ce),Bt.append(de)},me=new WeakSet,ni=function(Bt,Qt,ce,de){const xe=O(this,ee).createElementNS(ct,"feComponentTransfer");de.append(xe),Ft(this,ae,fi).call(this,xe,"feFuncR",Bt),Ft(this,ae,fi).call(this,xe,"feFuncG",Qt),Ft(this,ae,fi).call(this,xe,"feFuncB",ce)},le=new WeakSet,ri=function(Bt){return O(this,wt,Qe).style.color=Bt,at(getComputedStyle(O(this,wt,Qe)).getPropertyValue("color"))},F.DOMFilterFactory=zt;class At extends D.BaseCanvasFactory{constructor({ownerDocument:Ut=globalThis.document}={}){super(),this._document=Ut}_createCanvas(Ut,Bt){const Qt=this._document.createElement("canvas");return Qt.width=Ut,Qt.height=Bt,Qt}}F.DOMCanvasFactory=At;async function gt(te,Ut=!1){if(dt(te,document.baseURI)){const Bt=await fetch(te);if(!Bt.ok)throw new Error(Bt.statusText);return Ut?new Uint8Array(await Bt.arrayBuffer()):(0,U.stringToBytes)(await Bt.text())}return new Promise((Bt,Qt)=>{const ce=new XMLHttpRequest;ce.open("GET",te,!0),Ut&&(ce.responseType="arraybuffer"),ce.onreadystatechange=()=>{if(ce.readyState===XMLHttpRequest.DONE){if(ce.status===200||ce.status===0){let de;if(Ut&&ce.response?de=new Uint8Array(ce.response):!Ut&&ce.responseText&&(de=(0,U.stringToBytes)(ce.responseText)),de){Bt(de);return}}Qt(new Error(ce.statusText))}},ce.send(null)})}class et extends D.BaseCMapReaderFactory{_fetchData(Ut,Bt){return gt(Ut,this.isCompressed).then(Qt=>({cMapData:Qt,compressionType:Bt}))}}F.DOMCMapReaderFactory=et;class vt extends D.BaseStandardFontDataFactory{_fetchData(Ut){return gt(Ut,!0)}}F.DOMStandardFontDataFactory=vt;class Pt extends D.BaseSVGFactory{_createSVG(Ut){return document.createElementNS(ct,Ut)}}F.DOMSVGFactory=Pt;class yt{constructor({viewBox:Ut,scale:Bt,rotation:Qt,offsetX:ce=0,offsetY:de=0,dontFlip:xe=!1}){this.viewBox=Ut,this.scale=Bt,this.rotation=Qt,this.offsetX=ce,this.offsetY=de;const ke=(Ut[2]+Ut[0])/2,Pe=(Ut[3]+Ut[1])/2;let Re,Fe,Te,Oe;switch(Qt%=360,Qt<0&&(Qt+=360),Qt){case 180:Re=-1,Fe=0,Te=0,Oe=1;break;case 90:Re=0,Fe=1,Te=1,Oe=0;break;case 270:Re=0,Fe=-1,Te=-1,Oe=0;break;case 0:Re=1,Fe=0,Te=0,Oe=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}xe&&(Te=-Te,Oe=-Oe);let Yt,Nt,Dt,se;Re===0?(Yt=Math.abs(Pe-Ut[1])*Bt+ce,Nt=Math.abs(ke-Ut[0])*Bt+de,Dt=(Ut[3]-Ut[1])*Bt,se=(Ut[2]-Ut[0])*Bt):(Yt=Math.abs(ke-Ut[0])*Bt+ce,Nt=Math.abs(Pe-Ut[1])*Bt+de,Dt=(Ut[2]-Ut[0])*Bt,se=(Ut[3]-Ut[1])*Bt),this.transform=[Re*Bt,Fe*Bt,Te*Bt,Oe*Bt,Yt-Re*Bt*ke-Te*Bt*Pe,Nt-Fe*Bt*ke-Oe*Bt*Pe],this.width=Dt,this.height=se}get rawDims(){const{viewBox:Ut}=this;return(0,U.shadow)(this,"rawDims",{pageWidth:Ut[2]-Ut[0],pageHeight:Ut[3]-Ut[1],pageX:Ut[0],pageY:Ut[1]})}clone({scale:Ut=this.scale,rotation:Bt=this.rotation,offsetX:Qt=this.offsetX,offsetY:ce=this.offsetY,dontFlip:de=!1}={}){return new yt({viewBox:this.viewBox.slice(),scale:Ut,rotation:Bt,offsetX:Qt,offsetY:ce,dontFlip:de})}convertToViewportPoint(Ut,Bt){return U.Util.applyTransform([Ut,Bt],this.transform)}convertToViewportRectangle(Ut){const Bt=U.Util.applyTransform([Ut[0],Ut[1]],this.transform),Qt=U.Util.applyTransform([Ut[2],Ut[3]],this.transform);return[Bt[0],Bt[1],Qt[0],Qt[1]]}convertToPdfPoint(Ut,Bt){return U.Util.applyInverseTransform([Ut,Bt],this.transform)}}F.PageViewport=yt;class ht extends U.BaseException{constructor(Ut,Bt=0){super(Ut,"RenderingCancelledException"),this.extraDelay=Bt}}F.RenderingCancelledException=ht;function ut(te){const Ut=te.length;let Bt=0;for(;Bt<Ut&&te[Bt].trim()==="";)Bt++;return te.substring(Bt,Bt+5).toLowerCase()==="data:"}function st(te){return typeof te=="string"&&/\.pdf$/i.test(te)}function lt(te,Ut=!1){return Ut||([te]=te.split(/[#?]/,1)),te.substring(te.lastIndexOf("/")+1)}function mt(te,Ut="document.pdf"){if(typeof te!="string")return Ut;if(ut(te))return(0,U.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),Ut;const Bt=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,Qt=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,ce=Bt.exec(te);let de=Qt.exec(ce[1])||Qt.exec(ce[2])||Qt.exec(ce[3]);if(de&&(de=de[0],de.includes("%")))try{de=Qt.exec(decodeURIComponent(de))[0]}catch{}return de||Ut}class _t{constructor(){je(this,"started",Object.create(null));je(this,"times",[])}time(Ut){Ut in this.started&&(0,U.warn)(`Timer is already running for ${Ut}`),this.started[Ut]=Date.now()}timeEnd(Ut){Ut in this.started||(0,U.warn)(`Timer has not been started for ${Ut}`),this.times.push({name:Ut,start:this.started[Ut],end:Date.now()}),delete this.started[Ut]}toString(){const Ut=[];let Bt=0;for(const{name:Qt}of this.times)Bt=Math.max(Qt.length,Bt);for(const{name:Qt,start:ce,end:de}of this.times)Ut.push(`${Qt.padEnd(Bt)} ${de-ce}ms
`);return Ut.join("")}}F.StatTimer=_t;function dt(te,Ut){try{const{protocol:Bt}=Ut?new URL(te,Ut):new URL(te);return Bt==="http:"||Bt==="https:"}catch{return!1}}function Y(te){te.preventDefault()}function Q(te,Ut=!1){return new Promise((Bt,Qt)=>{const ce=document.createElement("script");ce.src=te,ce.onload=function(de){Ut&&ce.remove(),Bt(de)},ce.onerror=function(){Qt(new Error(`Cannot load script at: ${ce.src}`))},(document.head||document.documentElement).append(ce)})}function St(te){console.log("Deprecated API usage: "+te)}let rt;class X{static toDateObject(Ut){if(!Ut||typeof Ut!="string")return null;rt||(rt=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const Bt=rt.exec(Ut);if(!Bt)return null;const Qt=parseInt(Bt[1],10);let ce=parseInt(Bt[2],10);ce=ce>=1&&ce<=12?ce-1:0;let de=parseInt(Bt[3],10);de=de>=1&&de<=31?de:1;let xe=parseInt(Bt[4],10);xe=xe>=0&&xe<=23?xe:0;let ke=parseInt(Bt[5],10);ke=ke>=0&&ke<=59?ke:0;let Pe=parseInt(Bt[6],10);Pe=Pe>=0&&Pe<=59?Pe:0;const Re=Bt[7]||"Z";let Fe=parseInt(Bt[8],10);Fe=Fe>=0&&Fe<=23?Fe:0;let Te=parseInt(Bt[9],10)||0;return Te=Te>=0&&Te<=59?Te:0,Re==="-"?(xe+=Fe,ke+=Te):Re==="+"&&(xe-=Fe,ke-=Te),new Date(Date.UTC(Qt,ce,de,xe,ke,Pe))}}F.PDFDateString=X;function bt(te,{scale:Ut=1,rotation:Bt=0}){const{width:Qt,height:ce}=te.attributes.style,de=[0,0,parseInt(Qt),parseInt(ce)];return new yt({viewBox:de,scale:Ut,rotation:Bt})}function at(te){if(te.startsWith("#")){const Ut=parseInt(te.slice(1),16);return[(Ut&16711680)>>16,(Ut&65280)>>8,Ut&255]}return te.startsWith("rgb(")?te.slice(4,-1).split(",").map(Ut=>parseInt(Ut)):te.startsWith("rgba(")?te.slice(5,-1).split(",").map(Ut=>parseInt(Ut)).slice(0,3):((0,U.warn)(`Not a valid color format: "${te}"`),[0,0,0])}function kt(te){const Ut=document.createElement("span");Ut.style.visibility="hidden",document.body.append(Ut);for(const Bt of te.keys()){Ut.style.color=Bt;const Qt=window.getComputedStyle(Ut).color;te.set(Bt,at(Qt))}Ut.remove()}function Ot(te){const{a:Ut,b:Bt,c:Qt,d:ce,e:de,f:xe}=te.getTransform();return[Ut,Bt,Qt,ce,de,xe]}function ft(te){const{a:Ut,b:Bt,c:Qt,d:ce,e:de,f:xe}=te.getTransform().invertSelf();return[Ut,Bt,Qt,ce,de,xe]}function It(te,Ut,Bt=!1,Qt=!0){if(Ut instanceof yt){const{pageWidth:ce,pageHeight:de}=Ut.rawDims,{style:xe}=te,ke=U.FeatureTest.isCSSRoundSupported,Pe=`var(--scale-factor) * ${ce}px`,Re=`var(--scale-factor) * ${de}px`,Fe=ke?`round(${Pe}, 1px)`:`calc(${Pe})`,Te=ke?`round(${Re}, 1px)`:`calc(${Re})`;!Bt||Ut.rotation%180===0?(xe.width=Fe,xe.height=Te):(xe.width=Te,xe.height=Fe)}Qt&&te.setAttribute("data-main-rotation",Ut.rotation)}},(K,F,B)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.BaseStandardFontDataFactory=F.BaseSVGFactory=F.BaseFilterFactory=F.BaseCanvasFactory=F.BaseCMapReaderFactory=void 0;var D=B(1);class U{constructor(){this.constructor===U&&(0,D.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(et){return"none"}addHCMFilter(et,vt){return"none"}addHighlightHCMFilter(et,vt,Pt,yt){return"none"}destroy(et=!1){}}F.BaseFilterFactory=U;class ct{constructor(){this.constructor===ct&&(0,D.unreachable)("Cannot initialize BaseCanvasFactory.")}create(et,vt){if(et<=0||vt<=0)throw new Error("Invalid canvas size");const Pt=this._createCanvas(et,vt);return{canvas:Pt,context:Pt.getContext("2d")}}reset(et,vt,Pt){if(!et.canvas)throw new Error("Canvas is not specified");if(vt<=0||Pt<=0)throw new Error("Invalid canvas size");et.canvas.width=vt,et.canvas.height=Pt}destroy(et){if(!et.canvas)throw new Error("Canvas is not specified");et.canvas.width=0,et.canvas.height=0,et.canvas=null,et.context=null}_createCanvas(et,vt){(0,D.unreachable)("Abstract method `_createCanvas` called.")}}F.BaseCanvasFactory=ct;class it{constructor({baseUrl:et=null,isCompressed:vt=!0}){this.constructor===it&&(0,D.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=et,this.isCompressed=vt}async fetch({name:et}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!et)throw new Error("CMap name must be specified.");const vt=this.baseUrl+et+(this.isCompressed?".bcmap":""),Pt=this.isCompressed?D.CMapCompressionType.BINARY:D.CMapCompressionType.NONE;return this._fetchData(vt,Pt).catch(yt=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${vt}`)})}_fetchData(et,vt){(0,D.unreachable)("Abstract method `_fetchData` called.")}}F.BaseCMapReaderFactory=it;class zt{constructor({baseUrl:et=null}){this.constructor===zt&&(0,D.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=et}async fetch({filename:et}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!et)throw new Error("Font filename must be specified.");const vt=`${this.baseUrl}${et}`;return this._fetchData(vt).catch(Pt=>{throw new Error(`Unable to load font data at: ${vt}`)})}_fetchData(et){(0,D.unreachable)("Abstract method `_fetchData` called.")}}F.BaseStandardFontDataFactory=zt;class At{constructor(){this.constructor===At&&(0,D.unreachable)("Cannot initialize BaseSVGFactory.")}create(et,vt,Pt=!1){if(et<=0||vt<=0)throw new Error("Invalid SVG dimensions");const yt=this._createSVG("svg:svg");return yt.setAttribute("version","1.1"),Pt||(yt.setAttribute("width",`${et}px`),yt.setAttribute("height",`${vt}px`)),yt.setAttribute("preserveAspectRatio","none"),yt.setAttribute("viewBox",`0 0 ${et} ${vt}`),yt}createElement(et){if(typeof et!="string")throw new Error("Invalid SVG element type");return this._createSVG(et)}_createSVG(et){(0,D.unreachable)("Abstract method `_createSVG` called.")}}F.BaseSVGFactory=At},(K,F,B)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.MurmurHash3_64=void 0;var D=B(1);const U=3285377520,ct=4294901760,it=65535;class zt{constructor(gt){this.h1=gt?gt&4294967295:U,this.h2=gt?gt&4294967295:U}update(gt){let et,vt;if(typeof gt=="string"){et=new Uint8Array(gt.length*2),vt=0;for(let St=0,rt=gt.length;St<rt;St++){const X=gt.charCodeAt(St);X<=255?et[vt++]=X:(et[vt++]=X>>>8,et[vt++]=X&255)}}else if((0,D.isArrayBuffer)(gt))et=gt.slice(),vt=et.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const Pt=vt>>2,yt=vt-Pt*4,ht=new Uint32Array(et.buffer,0,Pt);let ut=0,st=0,lt=this.h1,mt=this.h2;const _t=3432918353,dt=461845907,Y=_t&it,Q=dt&it;for(let St=0;St<Pt;St++)St&1?(ut=ht[St],ut=ut*_t&ct|ut*Y&it,ut=ut<<15|ut>>>17,ut=ut*dt&ct|ut*Q&it,lt^=ut,lt=lt<<13|lt>>>19,lt=lt*5+3864292196):(st=ht[St],st=st*_t&ct|st*Y&it,st=st<<15|st>>>17,st=st*dt&ct|st*Q&it,mt^=st,mt=mt<<13|mt>>>19,mt=mt*5+3864292196);switch(ut=0,yt){case 3:ut^=et[Pt*4+2]<<16;case 2:ut^=et[Pt*4+1]<<8;case 1:ut^=et[Pt*4],ut=ut*_t&ct|ut*Y&it,ut=ut<<15|ut>>>17,ut=ut*dt&ct|ut*Q&it,Pt&1?lt^=ut:mt^=ut}this.h1=lt,this.h2=mt}hexdigest(){let gt=this.h1,et=this.h2;return gt^=et>>>1,gt=gt*3981806797&ct|gt*36045&it,et=et*4283543511&ct|((et<<16|gt>>>16)*2950163797&ct)>>>16,gt^=et>>>1,gt=gt*444984403&ct|gt*60499&it,et=et*3301882366&ct|((et<<16|gt>>>16)*3120437893&ct)>>>16,gt^=et>>>1,(gt>>>0).toString(16).padStart(8,"0")+(et>>>0).toString(16).padStart(8,"0")}}F.MurmurHash3_64=zt},(K,F,B)=>{var it;Object.defineProperty(F,"__esModule",{value:!0}),F.FontLoader=F.FontFaceObject=void 0;var D=B(1);class U{constructor({ownerDocument:At=globalThis.document,styleElement:gt=null}){xt(this,it,new Set);this._document=At,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(At){this.nativeFontFaces.add(At),this._document.fonts.add(At)}removeNativeFontFace(At){this.nativeFontFaces.delete(At),this._document.fonts.delete(At)}insertRule(At){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const gt=this.styleElement.sheet;gt.insertRule(At,gt.cssRules.length)}clear(){for(const At of this.nativeFontFaces)this._document.fonts.delete(At);this.nativeFontFaces.clear(),O(this,it).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(At){if(!(!At||O(this,it).has(At.loadedName))){if((0,D.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:gt,src:et,style:vt}=At,Pt=new FontFace(gt,et,vt);this.addNativeFontFace(Pt);try{await Pt.load(),O(this,it).add(gt)}catch{(0,D.warn)(`Cannot load system font: ${At.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(Pt)}return}(0,D.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(At){if(At.attached||At.missingFile&&!At.systemFontInfo)return;if(At.attached=!0,At.systemFontInfo){await this.loadSystemFont(At.systemFontInfo);return}if(this.isFontLoadingAPISupported){const et=At.createNativeFontFace();if(et){this.addNativeFontFace(et);try{await et.loaded}catch(vt){throw(0,D.warn)(`Failed to load font '${et.family}': '${vt}'.`),At.disableFontFace=!0,vt}}return}const gt=At.createFontFaceRule();if(gt){if(this.insertRule(gt),this.isSyncFontLoadingSupported)return;await new Promise(et=>{const vt=this._queueLoadingCallback(et);this._prepareFontLoadEvent(At,vt)})}}get isFontLoadingAPISupported(){var gt;const At=!!((gt=this._document)!=null&&gt.fonts);return(0,D.shadow)(this,"isFontLoadingAPISupported",At)}get isSyncFontLoadingSupported(){let At=!1;return(D.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(At=!0),(0,D.shadow)(this,"isSyncFontLoadingSupported",At)}_queueLoadingCallback(At){function gt(){for((0,D.assert)(!vt.done,"completeRequest() cannot be called twice."),vt.done=!0;et.length>0&&et[0].done;){const Pt=et.shift();setTimeout(Pt.callback,0)}}const{loadingRequests:et}=this,vt={done:!1,complete:gt,callback:At};return et.push(vt),vt}get _loadTestFont(){const At=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,D.shadow)(this,"_loadTestFont",At)}_prepareFontLoadEvent(At,gt){function et(at,kt){return at.charCodeAt(kt)<<24|at.charCodeAt(kt+1)<<16|at.charCodeAt(kt+2)<<8|at.charCodeAt(kt+3)&255}function vt(at,kt,Ot,ft){const It=at.substring(0,kt),qt=at.substring(kt+Ot);return It+ft+qt}let Pt,yt;const ht=this._document.createElement("canvas");ht.width=1,ht.height=1;const ut=ht.getContext("2d");let st=0;function lt(at,kt){if(++st>30){(0,D.warn)("Load test font never loaded."),kt();return}if(ut.font="30px "+at,ut.fillText(".",0,20),ut.getImageData(0,0,1,1).data[3]>0){kt();return}setTimeout(lt.bind(null,at,kt))}const mt=`lt${Date.now()}${this.loadTestFontId++}`;let _t=this._loadTestFont;_t=vt(_t,976,mt.length,mt);const Y=16,Q=1482184792;let St=et(_t,Y);for(Pt=0,yt=mt.length-3;Pt<yt;Pt+=4)St=St-Q+et(mt,Pt)|0;Pt<mt.length&&(St=St-Q+et(mt+"XXX",Pt)|0),_t=vt(_t,Y,4,(0,D.string32)(St));const rt=`url(data:font/opentype;base64,${btoa(_t)});`,X=`@font-face {font-family:"${mt}";src:${rt}}`;this.insertRule(X);const bt=this._document.createElement("div");bt.style.visibility="hidden",bt.style.width=bt.style.height="10px",bt.style.position="absolute",bt.style.top=bt.style.left="0px";for(const at of[At.loadedName,mt]){const kt=this._document.createElement("span");kt.textContent="Hi",kt.style.fontFamily=at,bt.append(kt)}this._document.body.append(bt),lt(mt,()=>{bt.remove(),gt.complete()})}}it=new WeakMap,F.FontLoader=U;class ct{constructor(At,{isEvalSupported:gt=!0,disableFontFace:et=!1,ignoreErrors:vt=!1,inspectFont:Pt=null}){this.compiledGlyphs=Object.create(null);for(const yt in At)this[yt]=At[yt];this.isEvalSupported=gt!==!1,this.disableFontFace=et===!0,this.ignoreErrors=vt===!0,this._inspectFont=Pt}createNativeFontFace(){var gt;if(!this.data||this.disableFontFace)return null;let At;if(!this.cssFontInfo)At=new FontFace(this.loadedName,this.data,{});else{const et={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(et.style=`oblique ${this.cssFontInfo.italicAngle}deg`),At=new FontFace(this.cssFontInfo.fontFamily,this.data,et)}return(gt=this._inspectFont)==null||gt.call(this,this),At}createFontFaceRule(){var vt;if(!this.data||this.disableFontFace)return null;const At=(0,D.bytesToString)(this.data),gt=`url(data:${this.mimetype};base64,${btoa(At)});`;let et;if(!this.cssFontInfo)et=`@font-face {font-family:"${this.loadedName}";src:${gt}}`;else{let Pt=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(Pt+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),et=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${Pt}src:${gt}}`}return(vt=this._inspectFont)==null||vt.call(this,this,gt),et}getPathGenerator(At,gt){if(this.compiledGlyphs[gt]!==void 0)return this.compiledGlyphs[gt];let et;try{et=At.get(this.loadedName+"_path_"+gt)}catch(vt){if(!this.ignoreErrors)throw vt;return(0,D.warn)(`getPathGenerator - ignoring character: "${vt}".`),this.compiledGlyphs[gt]=function(Pt,yt){}}if(this.isEvalSupported&&D.FeatureTest.isEvalSupported){const vt=[];for(const Pt of et){const yt=Pt.args!==void 0?Pt.args.join(","):"";vt.push("c.",Pt.cmd,"(",yt,`);
`)}return this.compiledGlyphs[gt]=new Function("c","size",vt.join(""))}return this.compiledGlyphs[gt]=function(vt,Pt){for(const yt of et)yt.cmd==="scale"&&(yt.args=[Pt,-Pt]),vt[yt.cmd].apply(vt,yt.args)}}}F.FontFaceObject=ct},(K,F,B)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.NodeStandardFontDataFactory=F.NodeFilterFactory=F.NodeCanvasFactory=F.NodeCMapReaderFactory=void 0;var D=B(7);B(1);const U=function(gt){return new Promise((et,vt)=>{require("fs").readFile(gt,(yt,ht)=>{if(yt||!ht){vt(new Error(yt));return}et(new Uint8Array(ht))})})};class ct extends D.BaseFilterFactory{}F.NodeFilterFactory=ct;class it extends D.BaseCanvasFactory{_createCanvas(et,vt){return require$$0.createCanvas(et,vt)}}F.NodeCanvasFactory=it;class zt extends D.BaseCMapReaderFactory{_fetchData(et,vt){return U(et).then(Pt=>({cMapData:Pt,compressionType:vt}))}}F.NodeCMapReaderFactory=zt;class At extends D.BaseStandardFontDataFactory{_fetchData(et){return U(et)}}F.NodeStandardFontDataFactory=At},(K,F,B)=>{var Rt,Ui,ee,Bi;Object.defineProperty(F,"__esModule",{value:!0}),F.CanvasGraphics=void 0;var D=B(1),U=B(6),ct=B(12),it=B(13);const zt=16,At=100,gt=4096,et=15,vt=10,Pt=1e3,yt=16;function ht(pt,z){if(pt._removeMirroring)throw new Error("Context is already forwarding operations.");pt.__originalSave=pt.save,pt.__originalRestore=pt.restore,pt.__originalRotate=pt.rotate,pt.__originalScale=pt.scale,pt.__originalTranslate=pt.translate,pt.__originalTransform=pt.transform,pt.__originalSetTransform=pt.setTransform,pt.__originalResetTransform=pt.resetTransform,pt.__originalClip=pt.clip,pt.__originalMoveTo=pt.moveTo,pt.__originalLineTo=pt.lineTo,pt.__originalBezierCurveTo=pt.bezierCurveTo,pt.__originalRect=pt.rect,pt.__originalClosePath=pt.closePath,pt.__originalBeginPath=pt.beginPath,pt._removeMirroring=()=>{pt.save=pt.__originalSave,pt.restore=pt.__originalRestore,pt.rotate=pt.__originalRotate,pt.scale=pt.__originalScale,pt.translate=pt.__originalTranslate,pt.transform=pt.__originalTransform,pt.setTransform=pt.__originalSetTransform,pt.resetTransform=pt.__originalResetTransform,pt.clip=pt.__originalClip,pt.moveTo=pt.__originalMoveTo,pt.lineTo=pt.__originalLineTo,pt.bezierCurveTo=pt.__originalBezierCurveTo,pt.rect=pt.__originalRect,pt.closePath=pt.__originalClosePath,pt.beginPath=pt.__originalBeginPath,delete pt._removeMirroring},pt.save=function(){z.save(),this.__originalSave()},pt.restore=function(){z.restore(),this.__originalRestore()},pt.translate=function(G,J){z.translate(G,J),this.__originalTranslate(G,J)},pt.scale=function(G,J){z.scale(G,J),this.__originalScale(G,J)},pt.transform=function(G,J,tt,ot,wt,Tt){z.transform(G,J,tt,ot,wt,Tt),this.__originalTransform(G,J,tt,ot,wt,Tt)},pt.setTransform=function(G,J,tt,ot,wt,Tt){z.setTransform(G,J,tt,ot,wt,Tt),this.__originalSetTransform(G,J,tt,ot,wt,Tt)},pt.resetTransform=function(){z.resetTransform(),this.__originalResetTransform()},pt.rotate=function(G){z.rotate(G),this.__originalRotate(G)},pt.clip=function(G){z.clip(G),this.__originalClip(G)},pt.moveTo=function(q,G){z.moveTo(q,G),this.__originalMoveTo(q,G)},pt.lineTo=function(q,G){z.lineTo(q,G),this.__originalLineTo(q,G)},pt.bezierCurveTo=function(q,G,J,tt,ot,wt){z.bezierCurveTo(q,G,J,tt,ot,wt),this.__originalBezierCurveTo(q,G,J,tt,ot,wt)},pt.rect=function(q,G,J,tt){z.rect(q,G,J,tt),this.__originalRect(q,G,J,tt)},pt.closePath=function(){z.closePath(),this.__originalClosePath()},pt.beginPath=function(){z.beginPath(),this.__originalBeginPath()}}class ut{constructor(z){this.canvasFactory=z,this.cache=Object.create(null)}getCanvas(z,q,G){let J;return this.cache[z]!==void 0?(J=this.cache[z],this.canvasFactory.reset(J,q,G)):(J=this.canvasFactory.create(q,G),this.cache[z]=J),J}delete(z){delete this.cache[z]}clear(){for(const z in this.cache){const q=this.cache[z];this.canvasFactory.destroy(q),delete this.cache[z]}}}function st(pt,z,q,G,J,tt,ot,wt,Tt,Wt){const[jt,Xt,Jt,ae,Zt,me]=(0,U.getCurrentTransform)(pt);if(Xt===0&&Jt===0){const Ae=ot*jt+Zt,te=Math.round(Ae),Ut=wt*ae+me,Bt=Math.round(Ut),Qt=(ot+Tt)*jt+Zt,ce=Math.abs(Math.round(Qt)-te)||1,de=(wt+Wt)*ae+me,xe=Math.abs(Math.round(de)-Bt)||1;return pt.setTransform(Math.sign(jt),0,0,Math.sign(ae),te,Bt),pt.drawImage(z,q,G,J,tt,0,0,ce,xe),pt.setTransform(jt,Xt,Jt,ae,Zt,me),[ce,xe]}if(jt===0&&ae===0){const Ae=wt*Jt+Zt,te=Math.round(Ae),Ut=ot*Xt+me,Bt=Math.round(Ut),Qt=(wt+Wt)*Jt+Zt,ce=Math.abs(Math.round(Qt)-te)||1,de=(ot+Tt)*Xt+me,xe=Math.abs(Math.round(de)-Bt)||1;return pt.setTransform(0,Math.sign(Xt),Math.sign(Jt),0,te,Bt),pt.drawImage(z,q,G,J,tt,0,0,xe,ce),pt.setTransform(jt,Xt,Jt,ae,Zt,me),[xe,ce]}pt.drawImage(z,q,G,J,tt,ot,wt,Tt,Wt);const Ee=Math.hypot(jt,Xt),le=Math.hypot(Jt,ae);return[Ee*Tt,le*Wt]}function lt(pt){const{width:z,height:q}=pt;if(z>Pt||q>Pt)return null;const G=1e3,J=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),tt=z+1;let ot=new Uint8Array(tt*(q+1)),wt,Tt,Wt;const jt=z+7&-8;let Xt=new Uint8Array(jt*q),Jt=0;for(const le of pt.data){let Ae=128;for(;Ae>0;)Xt[Jt++]=le&Ae?0:255,Ae>>=1}let ae=0;for(Jt=0,Xt[Jt]!==0&&(ot[0]=1,++ae),Tt=1;Tt<z;Tt++)Xt[Jt]!==Xt[Jt+1]&&(ot[Tt]=Xt[Jt]?2:1,++ae),Jt++;for(Xt[Jt]!==0&&(ot[Tt]=2,++ae),wt=1;wt<q;wt++){Jt=wt*jt,Wt=wt*tt,Xt[Jt-jt]!==Xt[Jt]&&(ot[Wt]=Xt[Jt]?1:8,++ae);let le=(Xt[Jt]?4:0)+(Xt[Jt-jt]?8:0);for(Tt=1;Tt<z;Tt++)le=(le>>2)+(Xt[Jt+1]?4:0)+(Xt[Jt-jt+1]?8:0),J[le]&&(ot[Wt+Tt]=J[le],++ae),Jt++;if(Xt[Jt-jt]!==Xt[Jt]&&(ot[Wt+Tt]=Xt[Jt]?2:4,++ae),ae>G)return null}for(Jt=jt*(q-1),Wt=wt*tt,Xt[Jt]!==0&&(ot[Wt]=8,++ae),Tt=1;Tt<z;Tt++)Xt[Jt]!==Xt[Jt+1]&&(ot[Wt+Tt]=Xt[Jt]?4:8,++ae),Jt++;if(Xt[Jt]!==0&&(ot[Wt+Tt]=4,++ae),ae>G)return null;const Zt=new Int32Array([0,tt,-1,0,-tt,0,0,0,1]),me=new Path2D;for(wt=0;ae&&wt<=q;wt++){let le=wt*tt;const Ae=le+z;for(;le<Ae&&!ot[le];)le++;if(le===Ae)continue;me.moveTo(le%tt,wt);const te=le;let Ut=ot[le];do{const Bt=Zt[Ut];do le+=Bt;while(!ot[le]);const Qt=ot[le];Qt!==5&&Qt!==10?(Ut=Qt,ot[le]=0):(Ut=Qt&51*Ut>>4,ot[le]&=Ut>>2|Ut<<2),me.lineTo(le%tt,le/tt|0),ot[le]||--ae}while(te!==le);--wt}return Xt=null,ot=null,function(le){le.save(),le.scale(1/z,-1/q),le.translate(0,-q),le.fill(me),le.beginPath(),le.restore()}}class mt{constructor(z,q){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=D.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=D.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=D.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,z,q])}clone(){const z=Object.create(this);return z.clipBox=this.clipBox.slice(),z}setCurrentPoint(z,q){this.x=z,this.y=q}updatePathMinMax(z,q,G){[q,G]=D.Util.applyTransform([q,G],z),this.minX=Math.min(this.minX,q),this.minY=Math.min(this.minY,G),this.maxX=Math.max(this.maxX,q),this.maxY=Math.max(this.maxY,G)}updateRectMinMax(z,q){const G=D.Util.applyTransform(q,z),J=D.Util.applyTransform(q.slice(2),z);this.minX=Math.min(this.minX,G[0],J[0]),this.minY=Math.min(this.minY,G[1],J[1]),this.maxX=Math.max(this.maxX,G[0],J[0]),this.maxY=Math.max(this.maxY,G[1],J[1])}updateScalingPathMinMax(z,q){D.Util.scaleMinMax(z,q),this.minX=Math.min(this.minX,q[0]),this.maxX=Math.max(this.maxX,q[1]),this.minY=Math.min(this.minY,q[2]),this.maxY=Math.max(this.maxY,q[3])}updateCurvePathMinMax(z,q,G,J,tt,ot,wt,Tt,Wt,jt){const Xt=D.Util.bezierBoundingBox(q,G,J,tt,ot,wt,Tt,Wt);if(jt){jt[0]=Math.min(jt[0],Xt[0],Xt[2]),jt[1]=Math.max(jt[1],Xt[0],Xt[2]),jt[2]=Math.min(jt[2],Xt[1],Xt[3]),jt[3]=Math.max(jt[3],Xt[1],Xt[3]);return}this.updateRectMinMax(z,Xt)}getPathBoundingBox(z=ct.PathType.FILL,q=null){const G=[this.minX,this.minY,this.maxX,this.maxY];if(z===ct.PathType.STROKE){q||(0,D.unreachable)("Stroke bounding box must include transform.");const J=D.Util.singularValueDecompose2dScale(q),tt=J[0]*this.lineWidth/2,ot=J[1]*this.lineWidth/2;G[0]-=tt,G[1]-=ot,G[2]+=tt,G[3]+=ot}return G}updateClipFromPath(){const z=D.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(z||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(z){this.clipBox=z,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(z=ct.PathType.FILL,q=null){return D.Util.intersect(this.clipBox,this.getPathBoundingBox(z,q))}}function _t(pt,z){if(typeof ImageData<"u"&&z instanceof ImageData){pt.putImageData(z,0,0);return}const q=z.height,G=z.width,J=q%yt,tt=(q-J)/yt,ot=J===0?tt:tt+1,wt=pt.createImageData(G,yt);let Tt=0,Wt;const jt=z.data,Xt=wt.data;let Jt,ae,Zt,me;if(z.kind===D.ImageKind.GRAYSCALE_1BPP){const Ee=jt.byteLength,le=new Uint32Array(Xt.buffer,0,Xt.byteLength>>2),Ae=le.length,te=G+7>>3,Ut=4294967295,Bt=D.FeatureTest.isLittleEndian?4278190080:255;for(Jt=0;Jt<ot;Jt++){for(Zt=Jt<tt?yt:J,Wt=0,ae=0;ae<Zt;ae++){const Qt=Ee-Tt;let ce=0;const de=Qt>te?G:Qt*8-7,xe=de&-8;let ke=0,Pe=0;for(;ce<xe;ce+=8)Pe=jt[Tt++],le[Wt++]=Pe&128?Ut:Bt,le[Wt++]=Pe&64?Ut:Bt,le[Wt++]=Pe&32?Ut:Bt,le[Wt++]=Pe&16?Ut:Bt,le[Wt++]=Pe&8?Ut:Bt,le[Wt++]=Pe&4?Ut:Bt,le[Wt++]=Pe&2?Ut:Bt,le[Wt++]=Pe&1?Ut:Bt;for(;ce<de;ce++)ke===0&&(Pe=jt[Tt++],ke=128),le[Wt++]=Pe&ke?Ut:Bt,ke>>=1}for(;Wt<Ae;)le[Wt++]=0;pt.putImageData(wt,0,Jt*yt)}}else if(z.kind===D.ImageKind.RGBA_32BPP){for(ae=0,me=G*yt*4,Jt=0;Jt<tt;Jt++)Xt.set(jt.subarray(Tt,Tt+me)),Tt+=me,pt.putImageData(wt,0,ae),ae+=yt;Jt<ot&&(me=G*J*4,Xt.set(jt.subarray(Tt,Tt+me)),pt.putImageData(wt,0,ae))}else if(z.kind===D.ImageKind.RGB_24BPP)for(Zt=yt,me=G*Zt,Jt=0;Jt<ot;Jt++){for(Jt>=tt&&(Zt=J,me=G*Zt),Wt=0,ae=me;ae--;)Xt[Wt++]=jt[Tt++],Xt[Wt++]=jt[Tt++],Xt[Wt++]=jt[Tt++],Xt[Wt++]=255;pt.putImageData(wt,0,Jt*yt)}else throw new Error(`bad image kind: ${z.kind}`)}function dt(pt,z){if(z.bitmap){pt.drawImage(z.bitmap,0,0);return}const q=z.height,G=z.width,J=q%yt,tt=(q-J)/yt,ot=J===0?tt:tt+1,wt=pt.createImageData(G,yt);let Tt=0;const Wt=z.data,jt=wt.data;for(let Xt=0;Xt<ot;Xt++){const Jt=Xt<tt?yt:J;({srcPos:Tt}=(0,it.convertBlackAndWhiteToRGBA)({src:Wt,srcPos:Tt,dest:jt,width:G,height:Jt,nonBlackColor:0})),pt.putImageData(wt,0,Xt*yt)}}function Y(pt,z){const q=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const G of q)pt[G]!==void 0&&(z[G]=pt[G]);pt.setLineDash!==void 0&&(z.setLineDash(pt.getLineDash()),z.lineDashOffset=pt.lineDashOffset)}function Q(pt){if(pt.strokeStyle=pt.fillStyle="#000000",pt.fillRule="nonzero",pt.globalAlpha=1,pt.lineWidth=1,pt.lineCap="butt",pt.lineJoin="miter",pt.miterLimit=10,pt.globalCompositeOperation="source-over",pt.font="10px sans-serif",pt.setLineDash!==void 0&&(pt.setLineDash([]),pt.lineDashOffset=0),!D.isNodeJS){const{filter:z}=pt;z!=="none"&&z!==""&&(pt.filter="none")}}function St(pt,z,q,G){const J=pt.length;for(let tt=3;tt<J;tt+=4){const ot=pt[tt];if(ot===0)pt[tt-3]=z,pt[tt-2]=q,pt[tt-1]=G;else if(ot<255){const wt=255-ot;pt[tt-3]=pt[tt-3]*ot+z*wt>>8,pt[tt-2]=pt[tt-2]*ot+q*wt>>8,pt[tt-1]=pt[tt-1]*ot+G*wt>>8}}}function rt(pt,z,q){const G=pt.length,J=1/255;for(let tt=3;tt<G;tt+=4){const ot=q?q[pt[tt]]:pt[tt];z[tt]=z[tt]*ot*J|0}}function X(pt,z,q){const G=pt.length;for(let J=3;J<G;J+=4){const tt=pt[J-3]*77+pt[J-2]*152+pt[J-1]*28;z[J]=q?z[J]*q[tt>>8]>>8:z[J]*tt>>16}}function bt(pt,z,q,G,J,tt,ot,wt,Tt,Wt,jt){const Xt=!!tt,Jt=Xt?tt[0]:0,ae=Xt?tt[1]:0,Zt=Xt?tt[2]:0,me=J==="Luminosity"?X:rt,le=Math.min(G,Math.ceil(1048576/q));for(let Ae=0;Ae<G;Ae+=le){const te=Math.min(le,G-Ae),Ut=pt.getImageData(wt-Wt,Ae+(Tt-jt),q,te),Bt=z.getImageData(wt,Ae+Tt,q,te);Xt&&St(Ut.data,Jt,ae,Zt),me(Ut.data,Bt.data,ot),z.putImageData(Bt,wt,Ae+Tt)}}function at(pt,z,q,G){const J=G[0],tt=G[1],ot=G[2]-J,wt=G[3]-tt;ot===0||wt===0||(bt(z.context,q,ot,wt,z.subtype,z.backdrop,z.transferMap,J,tt,z.offsetX,z.offsetY),pt.save(),pt.globalAlpha=1,pt.globalCompositeOperation="source-over",pt.setTransform(1,0,0,1,0,0),pt.drawImage(q.canvas,0,0),pt.restore())}function kt(pt,z){const q=D.Util.singularValueDecompose2dScale(pt);q[0]=Math.fround(q[0]),q[1]=Math.fround(q[1]);const G=Math.fround((globalThis.devicePixelRatio||1)*U.PixelsPerInch.PDF_TO_CSS_UNITS);return z!==void 0?z:q[0]<=G||q[1]<=G}const Ot=["butt","round","square"],ft=["miter","round","bevel"],It={},qt={},fe=class fe{constructor(z,q,G,J,tt,{optionalContentConfig:ot,markedContentStack:wt=null},Tt,Wt){xt(this,Rt);xt(this,ee);this.ctx=z,this.current=new mt(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=q,this.objs=G,this.canvasFactory=J,this.filterFactory=tt,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=wt||[],this.optionalContentConfig=ot,this.cachedCanvases=new ut(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=Tt,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=Wt,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(z,q=null){return typeof z=="string"?z.startsWith("g_")?this.commonObjs.get(z):this.objs.get(z):q}beginDrawing({transform:z,viewport:q,transparency:G=!1,background:J=null}){const tt=this.ctx.canvas.width,ot=this.ctx.canvas.height,wt=this.ctx.fillStyle;if(this.ctx.fillStyle=J||"#ffffff",this.ctx.fillRect(0,0,tt,ot),this.ctx.fillStyle=wt,G){const Tt=this.cachedCanvases.getCanvas("transparent",tt,ot);this.compositeCtx=this.ctx,this.transparentCanvas=Tt.canvas,this.ctx=Tt.context,this.ctx.save(),this.ctx.transform(...(0,U.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),Q(this.ctx),z&&(this.ctx.transform(...z),this.outputScaleX=z[0],this.outputScaleY=z[0]),this.ctx.transform(...q.transform),this.viewportScale=q.scale,this.baseTransform=(0,U.getCurrentTransform)(this.ctx)}executeOperatorList(z,q,G,J){const tt=z.argsArray,ot=z.fnArray;let wt=q||0;const Tt=tt.length;if(Tt===wt)return wt;const Wt=Tt-wt>vt&&typeof G=="function",jt=Wt?Date.now()+et:0;let Xt=0;const Jt=this.commonObjs,ae=this.objs;let Zt;for(;;){if(J!==void 0&&wt===J.nextBreakPoint)return J.breakIt(wt,G),wt;if(Zt=ot[wt],Zt!==D.OPS.dependency)this[Zt].apply(this,tt[wt]);else for(const me of tt[wt]){const Ee=me.startsWith("g_")?Jt:ae;if(!Ee.has(me))return Ee.get(me,G),wt}if(wt++,wt===Tt)return wt;if(Wt&&++Xt>vt){if(Date.now()>jt)return G(),wt;Xt=0}}}endDrawing(){Ft(this,Rt,Ui).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const z of this._cachedBitmapsMap.values()){for(const q of z.values())typeof HTMLCanvasElement<"u"&&q instanceof HTMLCanvasElement&&(q.width=q.height=0);z.clear()}this._cachedBitmapsMap.clear(),Ft(this,ee,Bi).call(this)}_scaleImage(z,q){const G=z.width,J=z.height;let tt=Math.max(Math.hypot(q[0],q[1]),1),ot=Math.max(Math.hypot(q[2],q[3]),1),wt=G,Tt=J,Wt="prescale1",jt,Xt;for(;tt>2&&wt>1||ot>2&&Tt>1;){let Jt=wt,ae=Tt;tt>2&&wt>1&&(Jt=wt>=16384?Math.floor(wt/2)-1||1:Math.ceil(wt/2),tt/=wt/Jt),ot>2&&Tt>1&&(ae=Tt>=16384?Math.floor(Tt/2)-1||1:Math.ceil(Tt)/2,ot/=Tt/ae),jt=this.cachedCanvases.getCanvas(Wt,Jt,ae),Xt=jt.context,Xt.clearRect(0,0,Jt,ae),Xt.drawImage(z,0,0,wt,Tt,0,0,Jt,ae),z=jt.canvas,wt=Jt,Tt=ae,Wt=Wt==="prescale1"?"prescale2":"prescale1"}return{img:z,paintWidth:wt,paintHeight:Tt}}_createMaskCanvas(z){const q=this.ctx,{width:G,height:J}=z,tt=this.current.fillColor,ot=this.current.patternFill,wt=(0,U.getCurrentTransform)(q);let Tt,Wt,jt,Xt;if((z.bitmap||z.data)&&z.count>1){const ce=z.bitmap||z.data.buffer;Wt=JSON.stringify(ot?wt:[wt.slice(0,4),tt]),Tt=this._cachedBitmapsMap.get(ce),Tt||(Tt=new Map,this._cachedBitmapsMap.set(ce,Tt));const de=Tt.get(Wt);if(de&&!ot){const xe=Math.round(Math.min(wt[0],wt[2])+wt[4]),ke=Math.round(Math.min(wt[1],wt[3])+wt[5]);return{canvas:de,offsetX:xe,offsetY:ke}}jt=de}jt||(Xt=this.cachedCanvases.getCanvas("maskCanvas",G,J),dt(Xt.context,z));let Jt=D.Util.transform(wt,[1/G,0,0,-1/J,0,0]);Jt=D.Util.transform(Jt,[1,0,0,1,0,-J]);const ae=D.Util.applyTransform([0,0],Jt),Zt=D.Util.applyTransform([G,J],Jt),me=D.Util.normalizeRect([ae[0],ae[1],Zt[0],Zt[1]]),Ee=Math.round(me[2]-me[0])||1,le=Math.round(me[3]-me[1])||1,Ae=this.cachedCanvases.getCanvas("fillCanvas",Ee,le),te=Ae.context,Ut=Math.min(ae[0],Zt[0]),Bt=Math.min(ae[1],Zt[1]);te.translate(-Ut,-Bt),te.transform(...Jt),jt||(jt=this._scaleImage(Xt.canvas,(0,U.getCurrentTransformInverse)(te)),jt=jt.img,Tt&&ot&&Tt.set(Wt,jt)),te.imageSmoothingEnabled=kt((0,U.getCurrentTransform)(te),z.interpolate),st(te,jt,0,0,jt.width,jt.height,0,0,G,J),te.globalCompositeOperation="source-in";const Qt=D.Util.transform((0,U.getCurrentTransformInverse)(te),[1,0,0,1,-Ut,-Bt]);return te.fillStyle=ot?tt.getPattern(q,this,Qt,ct.PathType.FILL):tt,te.fillRect(0,0,G,J),Tt&&!ot&&(this.cachedCanvases.delete("fillCanvas"),Tt.set(Wt,Ae.canvas)),{canvas:Ae.canvas,offsetX:Math.round(Ut),offsetY:Math.round(Bt)}}setLineWidth(z){z!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=z,this.ctx.lineWidth=z}setLineCap(z){this.ctx.lineCap=Ot[z]}setLineJoin(z){this.ctx.lineJoin=ft[z]}setMiterLimit(z){this.ctx.miterLimit=z}setDash(z,q){const G=this.ctx;G.setLineDash!==void 0&&(G.setLineDash(z),G.lineDashOffset=q)}setRenderingIntent(z){}setFlatness(z){}setGState(z){for(const[q,G]of z)switch(q){case"LW":this.setLineWidth(G);break;case"LC":this.setLineCap(G);break;case"LJ":this.setLineJoin(G);break;case"ML":this.setMiterLimit(G);break;case"D":this.setDash(G[0],G[1]);break;case"RI":this.setRenderingIntent(G);break;case"FL":this.setFlatness(G);break;case"Font":this.setFont(G[0],G[1]);break;case"CA":this.current.strokeAlpha=G;break;case"ca":this.current.fillAlpha=G,this.ctx.globalAlpha=G;break;case"BM":this.ctx.globalCompositeOperation=G;break;case"SMask":this.current.activeSMask=G?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(G);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const z=this.inSMaskMode;this.current.activeSMask&&!z?this.beginSMaskMode():!this.current.activeSMask&&z&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const z=this.ctx.canvas.width,q=this.ctx.canvas.height,G="smaskGroupAt"+this.groupLevel,J=this.cachedCanvases.getCanvas(G,z,q);this.suspendedCtx=this.ctx,this.ctx=J.context;const tt=this.ctx;tt.setTransform(...(0,U.getCurrentTransform)(this.suspendedCtx)),Y(this.suspendedCtx,tt),ht(tt,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Y(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(z){if(!this.current.activeSMask)return;z?(z[0]=Math.floor(z[0]),z[1]=Math.floor(z[1]),z[2]=Math.ceil(z[2]),z[3]=Math.ceil(z[3])):z=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const q=this.current.activeSMask,G=this.suspendedCtx;at(G,q,this.ctx,z),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(Y(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const z=this.current;this.stateStack.push(z),this.current=z.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Y(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(z,q,G,J,tt,ot){this.ctx.transform(z,q,G,J,tt,ot),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(z,q,G){const J=this.ctx,tt=this.current;let ot=tt.x,wt=tt.y,Tt,Wt;const jt=(0,U.getCurrentTransform)(J),Xt=jt[0]===0&&jt[3]===0||jt[1]===0&&jt[2]===0,Jt=Xt?G.slice(0):null;for(let ae=0,Zt=0,me=z.length;ae<me;ae++)switch(z[ae]|0){case D.OPS.rectangle:ot=q[Zt++],wt=q[Zt++];const Ee=q[Zt++],le=q[Zt++],Ae=ot+Ee,te=wt+le;J.moveTo(ot,wt),Ee===0||le===0?J.lineTo(Ae,te):(J.lineTo(Ae,wt),J.lineTo(Ae,te),J.lineTo(ot,te)),Xt||tt.updateRectMinMax(jt,[ot,wt,Ae,te]),J.closePath();break;case D.OPS.moveTo:ot=q[Zt++],wt=q[Zt++],J.moveTo(ot,wt),Xt||tt.updatePathMinMax(jt,ot,wt);break;case D.OPS.lineTo:ot=q[Zt++],wt=q[Zt++],J.lineTo(ot,wt),Xt||tt.updatePathMinMax(jt,ot,wt);break;case D.OPS.curveTo:Tt=ot,Wt=wt,ot=q[Zt+4],wt=q[Zt+5],J.bezierCurveTo(q[Zt],q[Zt+1],q[Zt+2],q[Zt+3],ot,wt),tt.updateCurvePathMinMax(jt,Tt,Wt,q[Zt],q[Zt+1],q[Zt+2],q[Zt+3],ot,wt,Jt),Zt+=6;break;case D.OPS.curveTo2:Tt=ot,Wt=wt,J.bezierCurveTo(ot,wt,q[Zt],q[Zt+1],q[Zt+2],q[Zt+3]),tt.updateCurvePathMinMax(jt,Tt,Wt,ot,wt,q[Zt],q[Zt+1],q[Zt+2],q[Zt+3],Jt),ot=q[Zt+2],wt=q[Zt+3],Zt+=4;break;case D.OPS.curveTo3:Tt=ot,Wt=wt,ot=q[Zt+2],wt=q[Zt+3],J.bezierCurveTo(q[Zt],q[Zt+1],ot,wt,ot,wt),tt.updateCurvePathMinMax(jt,Tt,Wt,q[Zt],q[Zt+1],ot,wt,ot,wt,Jt),Zt+=4;break;case D.OPS.closePath:J.closePath();break}Xt&&tt.updateScalingPathMinMax(jt,Jt),tt.setCurrentPoint(ot,wt)}closePath(){this.ctx.closePath()}stroke(z=!0){const q=this.ctx,G=this.current.strokeColor;q.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof G=="object"&&(G!=null&&G.getPattern)?(q.save(),q.strokeStyle=G.getPattern(q,this,(0,U.getCurrentTransformInverse)(q),ct.PathType.STROKE),this.rescaleAndStroke(!1),q.restore()):this.rescaleAndStroke(!0)),z&&this.consumePath(this.current.getClippedPathBoundingBox()),q.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(z=!0){const q=this.ctx,G=this.current.fillColor,J=this.current.patternFill;let tt=!1;J&&(q.save(),q.fillStyle=G.getPattern(q,this,(0,U.getCurrentTransformInverse)(q),ct.PathType.FILL),tt=!0);const ot=this.current.getClippedPathBoundingBox();this.contentVisible&&ot!==null&&(this.pendingEOFill?(q.fill("evenodd"),this.pendingEOFill=!1):q.fill()),tt&&q.restore(),z&&this.consumePath(ot)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=It}eoClip(){this.pendingClip=qt}beginText(){this.current.textMatrix=D.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const z=this.pendingTextPaths,q=this.ctx;if(z===void 0){q.beginPath();return}q.save(),q.beginPath();for(const G of z)q.setTransform(...G.transform),q.translate(G.x,G.y),G.addToPath(q,G.fontSize);q.restore(),q.clip(),q.beginPath(),delete this.pendingTextPaths}setCharSpacing(z){this.current.charSpacing=z}setWordSpacing(z){this.current.wordSpacing=z}setHScale(z){this.current.textHScale=z/100}setLeading(z){this.current.leading=-z}setFont(z,q){var jt;const G=this.commonObjs.get(z),J=this.current;if(!G)throw new Error(`Can't find font for ${z}`);if(J.fontMatrix=G.fontMatrix||D.FONT_IDENTITY_MATRIX,(J.fontMatrix[0]===0||J.fontMatrix[3]===0)&&(0,D.warn)("Invalid font matrix for font "+z),q<0?(q=-q,J.fontDirection=-1):J.fontDirection=1,this.current.font=G,this.current.fontSize=q,G.isType3Font)return;const tt=G.loadedName||"sans-serif",ot=((jt=G.systemFontInfo)==null?void 0:jt.css)||`"${tt}", ${G.fallbackName}`;let wt="normal";G.black?wt="900":G.bold&&(wt="bold");const Tt=G.italic?"italic":"normal";let Wt=q;q<zt?Wt=zt:q>At&&(Wt=At),this.current.fontSizeScale=q/Wt,this.ctx.font=`${Tt} ${wt} ${Wt}px ${ot}`}setTextRenderingMode(z){this.current.textRenderingMode=z}setTextRise(z){this.current.textRise=z}moveText(z,q){this.current.x=this.current.lineX+=z,this.current.y=this.current.lineY+=q}setLeadingMoveText(z,q){this.setLeading(-q),this.moveText(z,q)}setTextMatrix(z,q,G,J,tt,ot){this.current.textMatrix=[z,q,G,J,tt,ot],this.current.textMatrixScale=Math.hypot(z,q),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(z,q,G,J){const tt=this.ctx,ot=this.current,wt=ot.font,Tt=ot.textRenderingMode,Wt=ot.fontSize/ot.fontSizeScale,jt=Tt&D.TextRenderingMode.FILL_STROKE_MASK,Xt=!!(Tt&D.TextRenderingMode.ADD_TO_PATH_FLAG),Jt=ot.patternFill&&!wt.missingFile;let ae;(wt.disableFontFace||Xt||Jt)&&(ae=wt.getPathGenerator(this.commonObjs,z)),wt.disableFontFace||Jt?(tt.save(),tt.translate(q,G),tt.beginPath(),ae(tt,Wt),J&&tt.setTransform(...J),(jt===D.TextRenderingMode.FILL||jt===D.TextRenderingMode.FILL_STROKE)&&tt.fill(),(jt===D.TextRenderingMode.STROKE||jt===D.TextRenderingMode.FILL_STROKE)&&tt.stroke(),tt.restore()):((jt===D.TextRenderingMode.FILL||jt===D.TextRenderingMode.FILL_STROKE)&&tt.fillText(z,q,G),(jt===D.TextRenderingMode.STROKE||jt===D.TextRenderingMode.FILL_STROKE)&&tt.strokeText(z,q,G)),Xt&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,U.getCurrentTransform)(tt),x:q,y:G,fontSize:Wt,addToPath:ae})}get isFontSubpixelAAEnabled(){const{context:z}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);z.scale(1.5,1),z.fillText("I",0,10);const q=z.getImageData(0,0,10,10).data;let G=!1;for(let J=3;J<q.length;J+=4)if(q[J]>0&&q[J]<255){G=!0;break}return(0,D.shadow)(this,"isFontSubpixelAAEnabled",G)}showText(z){const q=this.current,G=q.font;if(G.isType3Font)return this.showType3Text(z);const J=q.fontSize;if(J===0)return;const tt=this.ctx,ot=q.fontSizeScale,wt=q.charSpacing,Tt=q.wordSpacing,Wt=q.fontDirection,jt=q.textHScale*Wt,Xt=z.length,Jt=G.vertical,ae=Jt?1:-1,Zt=G.defaultVMetrics,me=J*q.fontMatrix[0],Ee=q.textRenderingMode===D.TextRenderingMode.FILL&&!G.disableFontFace&&!q.patternFill;tt.save(),tt.transform(...q.textMatrix),tt.translate(q.x,q.y+q.textRise),Wt>0?tt.scale(jt,-1):tt.scale(jt,1);let le;if(q.patternFill){tt.save();const Qt=q.fillColor.getPattern(tt,this,(0,U.getCurrentTransformInverse)(tt),ct.PathType.FILL);le=(0,U.getCurrentTransform)(tt),tt.restore(),tt.fillStyle=Qt}let Ae=q.lineWidth;const te=q.textMatrixScale;if(te===0||Ae===0){const Qt=q.textRenderingMode&D.TextRenderingMode.FILL_STROKE_MASK;(Qt===D.TextRenderingMode.STROKE||Qt===D.TextRenderingMode.FILL_STROKE)&&(Ae=this.getSinglePixelWidth())}else Ae/=te;if(ot!==1&&(tt.scale(ot,ot),Ae/=ot),tt.lineWidth=Ae,G.isInvalidPDFjsFont){const Qt=[];let ce=0;for(const de of z)Qt.push(de.unicode),ce+=de.width;tt.fillText(Qt.join(""),0,0),q.x+=ce*me*jt,tt.restore(),this.compose();return}let Ut=0,Bt;for(Bt=0;Bt<Xt;++Bt){const Qt=z[Bt];if(typeof Qt=="number"){Ut+=ae*Qt*J/1e3;continue}let ce=!1;const de=(Qt.isSpace?Tt:0)+wt,xe=Qt.fontChar,ke=Qt.accent;let Pe,Re,Fe=Qt.width;if(Jt){const Oe=Qt.vmetric||Zt,Yt=-(Qt.vmetric?Oe[1]:Fe*.5)*me,Nt=Oe[2]*me;Fe=Oe?-Oe[0]:Fe,Pe=Yt/ot,Re=(Ut+Nt)/ot}else Pe=Ut/ot,Re=0;if(G.remeasure&&Fe>0){const Oe=tt.measureText(xe).width*1e3/J*ot;if(Fe<Oe&&this.isFontSubpixelAAEnabled){const Yt=Fe/Oe;ce=!0,tt.save(),tt.scale(Yt,1),Pe/=Yt}else Fe!==Oe&&(Pe+=(Fe-Oe)/2e3*J/ot)}if(this.contentVisible&&(Qt.isInFont||G.missingFile)){if(Ee&&!ke)tt.fillText(xe,Pe,Re);else if(this.paintChar(xe,Pe,Re,le),ke){const Oe=Pe+J*ke.offset.x/ot,Yt=Re-J*ke.offset.y/ot;this.paintChar(ke.fontChar,Oe,Yt,le)}}const Te=Jt?Fe*me-de*Wt:Fe*me+de*Wt;Ut+=Te,ce&&tt.restore()}Jt?q.y-=Ut:q.x+=Ut*jt,tt.restore(),this.compose()}showType3Text(z){const q=this.ctx,G=this.current,J=G.font,tt=G.fontSize,ot=G.fontDirection,wt=J.vertical?1:-1,Tt=G.charSpacing,Wt=G.wordSpacing,jt=G.textHScale*ot,Xt=G.fontMatrix||D.FONT_IDENTITY_MATRIX,Jt=z.length,ae=G.textRenderingMode===D.TextRenderingMode.INVISIBLE;let Zt,me,Ee,le;if(!(ae||tt===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,q.save(),q.transform(...G.textMatrix),q.translate(G.x,G.y),q.scale(jt,ot),Zt=0;Zt<Jt;++Zt){if(me=z[Zt],typeof me=="number"){le=wt*me*tt/1e3,this.ctx.translate(le,0),G.x+=le*jt;continue}const Ae=(me.isSpace?Wt:0)+Tt,te=J.charProcOperatorList[me.operatorListId];if(!te){(0,D.warn)(`Type3 character "${me.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=me,this.save(),q.scale(tt,tt),q.transform(...Xt),this.executeOperatorList(te),this.restore()),Ee=D.Util.applyTransform([me.width,0],Xt)[0]*tt+Ae,q.translate(Ee,0),G.x+=Ee*jt}q.restore(),this.processingType3=null}}setCharWidth(z,q){}setCharWidthAndBounds(z,q,G,J,tt,ot){this.ctx.rect(G,J,tt-G,ot-J),this.ctx.clip(),this.endPath()}getColorN_Pattern(z){let q;if(z[0]==="TilingPattern"){const G=z[1],J=this.baseTransform||(0,U.getCurrentTransform)(this.ctx),tt={createCanvasGraphics:ot=>new fe(ot,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};q=new ct.TilingPattern(z,G,this.ctx,tt,J)}else q=this._getPattern(z[1],z[2]);return q}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(z,q,G){const J=D.Util.makeHexColor(z,q,G);this.ctx.strokeStyle=J,this.current.strokeColor=J}setFillRGBColor(z,q,G){const J=D.Util.makeHexColor(z,q,G);this.ctx.fillStyle=J,this.current.fillColor=J,this.current.patternFill=!1}_getPattern(z,q=null){let G;return this.cachedPatterns.has(z)?G=this.cachedPatterns.get(z):(G=(0,ct.getShadingPattern)(this.getObject(z)),this.cachedPatterns.set(z,G)),q&&(G.matrix=q),G}shadingFill(z){if(!this.contentVisible)return;const q=this.ctx;this.save();const G=this._getPattern(z);q.fillStyle=G.getPattern(q,this,(0,U.getCurrentTransformInverse)(q),ct.PathType.SHADING);const J=(0,U.getCurrentTransformInverse)(q);if(J){const{width:tt,height:ot}=q.canvas,[wt,Tt,Wt,jt]=D.Util.getAxialAlignedBoundingBox([0,0,tt,ot],J);this.ctx.fillRect(wt,Tt,Wt-wt,jt-Tt)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,D.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,D.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(z,q){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(z)&&z.length===6&&this.transform(...z),this.baseTransform=(0,U.getCurrentTransform)(this.ctx),q)){const G=q[2]-q[0],J=q[3]-q[1];this.ctx.rect(q[0],q[1],G,J),this.current.updateRectMinMax((0,U.getCurrentTransform)(this.ctx),q),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(z){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const q=this.ctx;z.isolated||(0,D.info)("TODO: Support non-isolated groups."),z.knockout&&(0,D.warn)("Knockout groups not supported.");const G=(0,U.getCurrentTransform)(q);if(z.matrix&&q.transform(...z.matrix),!z.bbox)throw new Error("Bounding box is required.");let J=D.Util.getAxialAlignedBoundingBox(z.bbox,(0,U.getCurrentTransform)(q));const tt=[0,0,q.canvas.width,q.canvas.height];J=D.Util.intersect(J,tt)||[0,0,0,0];const ot=Math.floor(J[0]),wt=Math.floor(J[1]);let Tt=Math.max(Math.ceil(J[2])-ot,1),Wt=Math.max(Math.ceil(J[3])-wt,1),jt=1,Xt=1;Tt>gt&&(jt=Tt/gt,Tt=gt),Wt>gt&&(Xt=Wt/gt,Wt=gt),this.current.startNewPathAndClipBox([0,0,Tt,Wt]);let Jt="groupAt"+this.groupLevel;z.smask&&(Jt+="_smask_"+this.smaskCounter++%2);const ae=this.cachedCanvases.getCanvas(Jt,Tt,Wt),Zt=ae.context;Zt.scale(1/jt,1/Xt),Zt.translate(-ot,-wt),Zt.transform(...G),z.smask?this.smaskStack.push({canvas:ae.canvas,context:Zt,offsetX:ot,offsetY:wt,scaleX:jt,scaleY:Xt,subtype:z.smask.subtype,backdrop:z.smask.backdrop,transferMap:z.smask.transferMap||null,startTransformInverse:null}):(q.setTransform(1,0,0,1,0,0),q.translate(ot,wt),q.scale(jt,Xt),q.save()),Y(q,Zt),this.ctx=Zt,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(q),this.groupLevel++}endGroup(z){if(!this.contentVisible)return;this.groupLevel--;const q=this.ctx,G=this.groupStack.pop();if(this.ctx=G,this.ctx.imageSmoothingEnabled=!1,z.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const J=(0,U.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...J);const tt=D.Util.getAxialAlignedBoundingBox([0,0,q.canvas.width,q.canvas.height],J);this.ctx.drawImage(q.canvas,0,0),this.ctx.restore(),this.compose(tt)}}beginAnnotation(z,q,G,J,tt){if(Ft(this,Rt,Ui).call(this),Q(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(q)&&q.length===4){const ot=q[2]-q[0],wt=q[3]-q[1];if(tt&&this.annotationCanvasMap){G=G.slice(),G[4]-=q[0],G[5]-=q[1],q=q.slice(),q[0]=q[1]=0,q[2]=ot,q[3]=wt;const[Tt,Wt]=D.Util.singularValueDecompose2dScale((0,U.getCurrentTransform)(this.ctx)),{viewportScale:jt}=this,Xt=Math.ceil(ot*this.outputScaleX*jt),Jt=Math.ceil(wt*this.outputScaleY*jt);this.annotationCanvas=this.canvasFactory.create(Xt,Jt);const{canvas:ae,context:Zt}=this.annotationCanvas;this.annotationCanvasMap.set(z,ae),this.annotationCanvas.savedCtx=this.ctx,this.ctx=Zt,this.ctx.save(),this.ctx.setTransform(Tt,0,0,-Wt,0,wt*Wt),Q(this.ctx)}else Q(this.ctx),this.ctx.rect(q[0],q[1],ot,wt),this.ctx.clip(),this.endPath()}this.current=new mt(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...G),this.transform(...J)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),Ft(this,ee,Bi).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(z){if(!this.contentVisible)return;const q=z.count;z=this.getObject(z.data,z),z.count=q;const G=this.ctx,J=this.processingType3;if(J&&(J.compiled===void 0&&(J.compiled=lt(z)),J.compiled)){J.compiled(G);return}const tt=this._createMaskCanvas(z),ot=tt.canvas;G.save(),G.setTransform(1,0,0,1,0,0),G.drawImage(ot,tt.offsetX,tt.offsetY),G.restore(),this.compose()}paintImageMaskXObjectRepeat(z,q,G=0,J=0,tt,ot){if(!this.contentVisible)return;z=this.getObject(z.data,z);const wt=this.ctx;wt.save();const Tt=(0,U.getCurrentTransform)(wt);wt.transform(q,G,J,tt,0,0);const Wt=this._createMaskCanvas(z);wt.setTransform(1,0,0,1,Wt.offsetX-Tt[4],Wt.offsetY-Tt[5]);for(let jt=0,Xt=ot.length;jt<Xt;jt+=2){const Jt=D.Util.transform(Tt,[q,G,J,tt,ot[jt],ot[jt+1]]),[ae,Zt]=D.Util.applyTransform([0,0],Jt);wt.drawImage(Wt.canvas,ae,Zt)}wt.restore(),this.compose()}paintImageMaskXObjectGroup(z){if(!this.contentVisible)return;const q=this.ctx,G=this.current.fillColor,J=this.current.patternFill;for(const tt of z){const{data:ot,width:wt,height:Tt,transform:Wt}=tt,jt=this.cachedCanvases.getCanvas("maskCanvas",wt,Tt),Xt=jt.context;Xt.save();const Jt=this.getObject(ot,tt);dt(Xt,Jt),Xt.globalCompositeOperation="source-in",Xt.fillStyle=J?G.getPattern(Xt,this,(0,U.getCurrentTransformInverse)(q),ct.PathType.FILL):G,Xt.fillRect(0,0,wt,Tt),Xt.restore(),q.save(),q.transform(...Wt),q.scale(1,-1),st(q,jt.canvas,0,0,wt,Tt,0,-1,1,1),q.restore()}this.compose()}paintImageXObject(z){if(!this.contentVisible)return;const q=this.getObject(z);if(!q){(0,D.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(q)}paintImageXObjectRepeat(z,q,G,J){if(!this.contentVisible)return;const tt=this.getObject(z);if(!tt){(0,D.warn)("Dependent image isn't ready yet");return}const ot=tt.width,wt=tt.height,Tt=[];for(let Wt=0,jt=J.length;Wt<jt;Wt+=2)Tt.push({transform:[q,0,0,G,J[Wt],J[Wt+1]],x:0,y:0,w:ot,h:wt});this.paintInlineImageXObjectGroup(tt,Tt)}applyTransferMapsToCanvas(z){return this.current.transferMaps!=="none"&&(z.filter=this.current.transferMaps,z.drawImage(z.canvas,0,0),z.filter="none"),z.canvas}applyTransferMapsToBitmap(z){if(this.current.transferMaps==="none")return z.bitmap;const{bitmap:q,width:G,height:J}=z,tt=this.cachedCanvases.getCanvas("inlineImage",G,J),ot=tt.context;return ot.filter=this.current.transferMaps,ot.drawImage(q,0,0),ot.filter="none",tt.canvas}paintInlineImageXObject(z){if(!this.contentVisible)return;const q=z.width,G=z.height,J=this.ctx;if(this.save(),!D.isNodeJS){const{filter:wt}=J;wt!=="none"&&wt!==""&&(J.filter="none")}J.scale(1/q,-1/G);let tt;if(z.bitmap)tt=this.applyTransferMapsToBitmap(z);else if(typeof HTMLElement=="function"&&z instanceof HTMLElement||!z.data)tt=z;else{const Tt=this.cachedCanvases.getCanvas("inlineImage",q,G).context;_t(Tt,z),tt=this.applyTransferMapsToCanvas(Tt)}const ot=this._scaleImage(tt,(0,U.getCurrentTransformInverse)(J));J.imageSmoothingEnabled=kt((0,U.getCurrentTransform)(J),z.interpolate),st(J,ot.img,0,0,ot.paintWidth,ot.paintHeight,0,-G,q,G),this.compose(),this.restore()}paintInlineImageXObjectGroup(z,q){if(!this.contentVisible)return;const G=this.ctx;let J;if(z.bitmap)J=z.bitmap;else{const tt=z.width,ot=z.height,Tt=this.cachedCanvases.getCanvas("inlineImage",tt,ot).context;_t(Tt,z),J=this.applyTransferMapsToCanvas(Tt)}for(const tt of q)G.save(),G.transform(...tt.transform),G.scale(1,-1),st(G,J,tt.x,tt.y,tt.w,tt.h,0,-1,1,1),G.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(z){}markPointProps(z,q){}beginMarkedContent(z){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(z,q){z==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(q)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(z){const q=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(z);const G=this.ctx;this.pendingClip&&(q||(this.pendingClip===qt?G.clip("evenodd"):G.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),G.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const z=(0,U.getCurrentTransform)(this.ctx);if(z[1]===0&&z[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(z[0]),Math.abs(z[3]));else{const q=Math.abs(z[0]*z[3]-z[2]*z[1]),G=Math.hypot(z[0],z[2]),J=Math.hypot(z[1],z[3]);this._cachedGetSinglePixelWidth=Math.max(G,J)/q}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:z}=this.current,{a:q,b:G,c:J,d:tt}=this.ctx.getTransform();let ot,wt;if(G===0&&J===0){const Tt=Math.abs(q),Wt=Math.abs(tt);if(Tt===Wt)if(z===0)ot=wt=1/Tt;else{const jt=Tt*z;ot=wt=jt<1?1/jt:1}else if(z===0)ot=1/Tt,wt=1/Wt;else{const jt=Tt*z,Xt=Wt*z;ot=jt<1?1/jt:1,wt=Xt<1?1/Xt:1}}else{const Tt=Math.abs(q*tt-G*J),Wt=Math.hypot(q,G),jt=Math.hypot(J,tt);if(z===0)ot=jt/Tt,wt=Wt/Tt;else{const Xt=z*Tt;ot=jt>Xt?jt/Xt:1,wt=Wt>Xt?Wt/Xt:1}}this._cachedScaleForStroking[0]=ot,this._cachedScaleForStroking[1]=wt}return this._cachedScaleForStroking}rescaleAndStroke(z){const{ctx:q}=this,{lineWidth:G}=this.current,[J,tt]=this.getScaleForStroking();if(q.lineWidth=G||1,J===1&&tt===1){q.stroke();return}const ot=q.getLineDash();if(z&&q.save(),q.scale(J,tt),ot.length>0){const wt=Math.max(J,tt);q.setLineDash(ot.map(Tt=>Tt/wt)),q.lineDashOffset/=wt}q.stroke(),z&&q.restore()}isContentVisible(){for(let z=this.markedContentStack.length-1;z>=0;z--)if(!this.markedContentStack[z].visible)return!1;return!0}};Rt=new WeakSet,Ui=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},ee=new WeakSet,Bi=function(){if(this.pageColors){const z=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(z!=="none"){const q=this.ctx.filter;this.ctx.filter=z,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=q}}};let Vt=fe;F.CanvasGraphics=Vt;for(const pt in D.OPS)Vt.prototype[pt]!==void 0&&(Vt.prototype[D.OPS[pt]]=Vt.prototype[pt])},(K,F,B)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.TilingPattern=F.PathType=void 0,F.getShadingPattern=yt;var D=B(1),U=B(6);const ct={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};F.PathType=ct;function it(lt,mt){if(!mt)return;const _t=mt[2]-mt[0],dt=mt[3]-mt[1],Y=new Path2D;Y.rect(mt[0],mt[1],_t,dt),lt.clip(Y)}class zt{constructor(){this.constructor===zt&&(0,D.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,D.unreachable)("Abstract method `getPattern` called.")}}class At extends zt{constructor(mt){super(),this._type=mt[1],this._bbox=mt[2],this._colorStops=mt[3],this._p0=mt[4],this._p1=mt[5],this._r0=mt[6],this._r1=mt[7],this.matrix=null}_createGradient(mt){let _t;this._type==="axial"?_t=mt.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(_t=mt.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const dt of this._colorStops)_t.addColorStop(dt[0],dt[1]);return _t}getPattern(mt,_t,dt,Y){let Q;if(Y===ct.STROKE||Y===ct.FILL){const St=_t.current.getClippedPathBoundingBox(Y,(0,U.getCurrentTransform)(mt))||[0,0,0,0],rt=Math.ceil(St[2]-St[0])||1,X=Math.ceil(St[3]-St[1])||1,bt=_t.cachedCanvases.getCanvas("pattern",rt,X,!0),at=bt.context;at.clearRect(0,0,at.canvas.width,at.canvas.height),at.beginPath(),at.rect(0,0,at.canvas.width,at.canvas.height),at.translate(-St[0],-St[1]),dt=D.Util.transform(dt,[1,0,0,1,St[0],St[1]]),at.transform(..._t.baseTransform),this.matrix&&at.transform(...this.matrix),it(at,this._bbox),at.fillStyle=this._createGradient(at),at.fill(),Q=mt.createPattern(bt.canvas,"no-repeat");const kt=new DOMMatrix(dt);Q.setTransform(kt)}else it(mt,this._bbox),Q=this._createGradient(mt);return Q}}function gt(lt,mt,_t,dt,Y,Q,St,rt){const X=mt.coords,bt=mt.colors,at=lt.data,kt=lt.width*4;let Ot;X[_t+1]>X[dt+1]&&(Ot=_t,_t=dt,dt=Ot,Ot=Q,Q=St,St=Ot),X[dt+1]>X[Y+1]&&(Ot=dt,dt=Y,Y=Ot,Ot=St,St=rt,rt=Ot),X[_t+1]>X[dt+1]&&(Ot=_t,_t=dt,dt=Ot,Ot=Q,Q=St,St=Ot);const ft=(X[_t]+mt.offsetX)*mt.scaleX,It=(X[_t+1]+mt.offsetY)*mt.scaleY,qt=(X[dt]+mt.offsetX)*mt.scaleX,Vt=(X[dt+1]+mt.offsetY)*mt.scaleY,Rt=(X[Y]+mt.offsetX)*mt.scaleX,Kt=(X[Y+1]+mt.offsetY)*mt.scaleY;if(It>=Kt)return;const ee=bt[Q],he=bt[Q+1],fe=bt[Q+2],pt=bt[St],z=bt[St+1],q=bt[St+2],G=bt[rt],J=bt[rt+1],tt=bt[rt+2],ot=Math.round(It),wt=Math.round(Kt);let Tt,Wt,jt,Xt,Jt,ae,Zt,me;for(let Ee=ot;Ee<=wt;Ee++){if(Ee<Vt){const Bt=Ee<It?0:(It-Ee)/(It-Vt);Tt=ft-(ft-qt)*Bt,Wt=ee-(ee-pt)*Bt,jt=he-(he-z)*Bt,Xt=fe-(fe-q)*Bt}else{let Bt;Ee>Kt?Bt=1:Vt===Kt?Bt=0:Bt=(Vt-Ee)/(Vt-Kt),Tt=qt-(qt-Rt)*Bt,Wt=pt-(pt-G)*Bt,jt=z-(z-J)*Bt,Xt=q-(q-tt)*Bt}let le;Ee<It?le=0:Ee>Kt?le=1:le=(It-Ee)/(It-Kt),Jt=ft-(ft-Rt)*le,ae=ee-(ee-G)*le,Zt=he-(he-J)*le,me=fe-(fe-tt)*le;const Ae=Math.round(Math.min(Tt,Jt)),te=Math.round(Math.max(Tt,Jt));let Ut=kt*Ee+Ae*4;for(let Bt=Ae;Bt<=te;Bt++)le=(Tt-Bt)/(Tt-Jt),le<0?le=0:le>1&&(le=1),at[Ut++]=Wt-(Wt-ae)*le|0,at[Ut++]=jt-(jt-Zt)*le|0,at[Ut++]=Xt-(Xt-me)*le|0,at[Ut++]=255}}function et(lt,mt,_t){const dt=mt.coords,Y=mt.colors;let Q,St;switch(mt.type){case"lattice":const rt=mt.verticesPerRow,X=Math.floor(dt.length/rt)-1,bt=rt-1;for(Q=0;Q<X;Q++){let at=Q*rt;for(let kt=0;kt<bt;kt++,at++)gt(lt,_t,dt[at],dt[at+1],dt[at+rt],Y[at],Y[at+1],Y[at+rt]),gt(lt,_t,dt[at+rt+1],dt[at+1],dt[at+rt],Y[at+rt+1],Y[at+1],Y[at+rt])}break;case"triangles":for(Q=0,St=dt.length;Q<St;Q+=3)gt(lt,_t,dt[Q],dt[Q+1],dt[Q+2],Y[Q],Y[Q+1],Y[Q+2]);break;default:throw new Error("illegal figure")}}class vt extends zt{constructor(mt){super(),this._coords=mt[2],this._colors=mt[3],this._figures=mt[4],this._bounds=mt[5],this._bbox=mt[7],this._background=mt[8],this.matrix=null}_createMeshCanvas(mt,_t,dt){const rt=Math.floor(this._bounds[0]),X=Math.floor(this._bounds[1]),bt=Math.ceil(this._bounds[2])-rt,at=Math.ceil(this._bounds[3])-X,kt=Math.min(Math.ceil(Math.abs(bt*mt[0]*1.1)),3e3),Ot=Math.min(Math.ceil(Math.abs(at*mt[1]*1.1)),3e3),ft=bt/kt,It=at/Ot,qt={coords:this._coords,colors:this._colors,offsetX:-rt,offsetY:-X,scaleX:1/ft,scaleY:1/It},Vt=kt+2*2,Rt=Ot+2*2,Kt=dt.getCanvas("mesh",Vt,Rt,!1),ee=Kt.context,he=ee.createImageData(kt,Ot);if(_t){const pt=he.data;for(let z=0,q=pt.length;z<q;z+=4)pt[z]=_t[0],pt[z+1]=_t[1],pt[z+2]=_t[2],pt[z+3]=255}for(const pt of this._figures)et(he,pt,qt);return ee.putImageData(he,2,2),{canvas:Kt.canvas,offsetX:rt-2*ft,offsetY:X-2*It,scaleX:ft,scaleY:It}}getPattern(mt,_t,dt,Y){it(mt,this._bbox);let Q;if(Y===ct.SHADING)Q=D.Util.singularValueDecompose2dScale((0,U.getCurrentTransform)(mt));else if(Q=D.Util.singularValueDecompose2dScale(_t.baseTransform),this.matrix){const rt=D.Util.singularValueDecompose2dScale(this.matrix);Q=[Q[0]*rt[0],Q[1]*rt[1]]}const St=this._createMeshCanvas(Q,Y===ct.SHADING?null:this._background,_t.cachedCanvases);return Y!==ct.SHADING&&(mt.setTransform(..._t.baseTransform),this.matrix&&mt.transform(...this.matrix)),mt.translate(St.offsetX,St.offsetY),mt.scale(St.scaleX,St.scaleY),mt.createPattern(St.canvas,"no-repeat")}}class Pt extends zt{getPattern(){return"hotpink"}}function yt(lt){switch(lt[0]){case"RadialAxial":return new At(lt);case"Mesh":return new vt(lt);case"Dummy":return new Pt}throw new Error(`Unknown IR type: ${lt[0]}`)}const ht={COLORED:1,UNCOLORED:2},st=class st{constructor(mt,_t,dt,Y,Q){this.operatorList=mt[2],this.matrix=mt[3]||[1,0,0,1,0,0],this.bbox=mt[4],this.xstep=mt[5],this.ystep=mt[6],this.paintType=mt[7],this.tilingType=mt[8],this.color=_t,this.ctx=dt,this.canvasGraphicsFactory=Y,this.baseTransform=Q}createPatternCanvas(mt){const _t=this.operatorList,dt=this.bbox,Y=this.xstep,Q=this.ystep,St=this.paintType,rt=this.tilingType,X=this.color,bt=this.canvasGraphicsFactory;(0,D.info)("TilingType: "+rt);const at=dt[0],kt=dt[1],Ot=dt[2],ft=dt[3],It=D.Util.singularValueDecompose2dScale(this.matrix),qt=D.Util.singularValueDecompose2dScale(this.baseTransform),Vt=[It[0]*qt[0],It[1]*qt[1]],Rt=this.getSizeAndScale(Y,this.ctx.canvas.width,Vt[0]),Kt=this.getSizeAndScale(Q,this.ctx.canvas.height,Vt[1]),ee=mt.cachedCanvases.getCanvas("pattern",Rt.size,Kt.size,!0),he=ee.context,fe=bt.createCanvasGraphics(he);fe.groupLevel=mt.groupLevel,this.setFillAndStrokeStyleToContext(fe,St,X);let pt=at,z=kt,q=Ot,G=ft;return at<0&&(pt=0,q+=Math.abs(at)),kt<0&&(z=0,G+=Math.abs(kt)),he.translate(-(Rt.scale*pt),-(Kt.scale*z)),fe.transform(Rt.scale,0,0,Kt.scale,0,0),he.save(),this.clipBbox(fe,pt,z,q,G),fe.baseTransform=(0,U.getCurrentTransform)(fe.ctx),fe.executeOperatorList(_t),fe.endDrawing(),{canvas:ee.canvas,scaleX:Rt.scale,scaleY:Kt.scale,offsetX:pt,offsetY:z}}getSizeAndScale(mt,_t,dt){mt=Math.abs(mt);const Y=Math.max(st.MAX_PATTERN_SIZE,_t);let Q=Math.ceil(mt*dt);return Q>=Y?Q=Y:dt=Q/mt,{scale:dt,size:Q}}clipBbox(mt,_t,dt,Y,Q){const St=Y-_t,rt=Q-dt;mt.ctx.rect(_t,dt,St,rt),mt.current.updateRectMinMax((0,U.getCurrentTransform)(mt.ctx),[_t,dt,Y,Q]),mt.clip(),mt.endPath()}setFillAndStrokeStyleToContext(mt,_t,dt){const Y=mt.ctx,Q=mt.current;switch(_t){case ht.COLORED:const St=this.ctx;Y.fillStyle=St.fillStyle,Y.strokeStyle=St.strokeStyle,Q.fillColor=St.fillStyle,Q.strokeColor=St.strokeStyle;break;case ht.UNCOLORED:const rt=D.Util.makeHexColor(dt[0],dt[1],dt[2]);Y.fillStyle=rt,Y.strokeStyle=rt,Q.fillColor=rt,Q.strokeColor=rt;break;default:throw new D.FormatError(`Unsupported paint type: ${_t}`)}}getPattern(mt,_t,dt,Y){let Q=dt;Y!==ct.SHADING&&(Q=D.Util.transform(Q,_t.baseTransform),this.matrix&&(Q=D.Util.transform(Q,this.matrix)));const St=this.createPatternCanvas(_t);let rt=new DOMMatrix(Q);rt=rt.translate(St.offsetX,St.offsetY),rt=rt.scale(1/St.scaleX,1/St.scaleY);const X=mt.createPattern(St.canvas,"repeat");return X.setTransform(rt),X}};je(st,"MAX_PATTERN_SIZE",3e3);let ut=st;F.TilingPattern=ut},(K,F,B)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.convertBlackAndWhiteToRGBA=ct,F.convertToRGBA=U,F.grayToRGBA=zt;var D=B(1);function U(At){switch(At.kind){case D.ImageKind.GRAYSCALE_1BPP:return ct(At);case D.ImageKind.RGB_24BPP:return it(At)}return null}function ct({src:At,srcPos:gt=0,dest:et,width:vt,height:Pt,nonBlackColor:yt=4294967295,inverseDecode:ht=!1}){const ut=D.FeatureTest.isLittleEndian?4278190080:255,[st,lt]=ht?[yt,ut]:[ut,yt],mt=vt>>3,_t=vt&7,dt=At.length;et=new Uint32Array(et.buffer);let Y=0;for(let Q=0;Q<Pt;Q++){for(const rt=gt+mt;gt<rt;gt++){const X=gt<dt?At[gt]:255;et[Y++]=X&128?lt:st,et[Y++]=X&64?lt:st,et[Y++]=X&32?lt:st,et[Y++]=X&16?lt:st,et[Y++]=X&8?lt:st,et[Y++]=X&4?lt:st,et[Y++]=X&2?lt:st,et[Y++]=X&1?lt:st}if(_t===0)continue;const St=gt<dt?At[gt++]:255;for(let rt=0;rt<_t;rt++)et[Y++]=St&1<<7-rt?lt:st}return{srcPos:gt,destPos:Y}}function it({src:At,srcPos:gt=0,dest:et,destPos:vt=0,width:Pt,height:yt}){let ht=0;const ut=At.length>>2,st=new Uint32Array(At.buffer,gt,ut);if(D.FeatureTest.isLittleEndian){for(;ht<ut-2;ht+=3,vt+=4){const lt=st[ht],mt=st[ht+1],_t=st[ht+2];et[vt]=lt|4278190080,et[vt+1]=lt>>>24|mt<<8|4278190080,et[vt+2]=mt>>>16|_t<<16|4278190080,et[vt+3]=_t>>>8|4278190080}for(let lt=ht*4,mt=At.length;lt<mt;lt+=3)et[vt++]=At[lt]|At[lt+1]<<8|At[lt+2]<<16|4278190080}else{for(;ht<ut-2;ht+=3,vt+=4){const lt=st[ht],mt=st[ht+1],_t=st[ht+2];et[vt]=lt|255,et[vt+1]=lt<<24|mt>>>8|255,et[vt+2]=mt<<16|_t>>>16|255,et[vt+3]=_t<<8|255}for(let lt=ht*4,mt=At.length;lt<mt;lt+=3)et[vt++]=At[lt]<<24|At[lt+1]<<16|At[lt+2]<<8|255}return{srcPos:gt,destPos:vt}}function zt(At,gt){if(D.FeatureTest.isLittleEndian)for(let et=0,vt=At.length;et<vt;et++)gt[et]=At[et]*65793|4278190080;else for(let et=0,vt=At.length;et<vt;et++)gt[et]=At[et]*16843008|255}},(K,F)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.GlobalWorkerOptions=void 0;const B=Object.create(null);F.GlobalWorkerOptions=B,B.workerPort=null,B.workerSrc=""},(K,F,B)=>{var At,_s,et,bs,Pt,gi;Object.defineProperty(F,"__esModule",{value:!0}),F.MessageHandler=void 0;var D=B(1);const U={UNKNOWN:0,DATA:1,ERROR:2},ct={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function it(ht){switch(ht instanceof Error||typeof ht=="object"&&ht!==null||(0,D.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),ht.name){case"AbortException":return new D.AbortException(ht.message);case"MissingPDFException":return new D.MissingPDFException(ht.message);case"PasswordException":return new D.PasswordException(ht.message,ht.code);case"UnexpectedResponseException":return new D.UnexpectedResponseException(ht.message,ht.status);case"UnknownErrorException":return new D.UnknownErrorException(ht.message,ht.details);default:return new D.UnknownErrorException(ht.message,ht.toString())}}class zt{constructor(ut,st,lt){xt(this,At);xt(this,et);xt(this,Pt);this.sourceName=ut,this.targetName=st,this.comObj=lt,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=mt=>{const _t=mt.data;if(_t.targetName!==this.sourceName)return;if(_t.stream){Ft(this,et,bs).call(this,_t);return}if(_t.callback){const Y=_t.callbackId,Q=this.callbackCapabilities[Y];if(!Q)throw new Error(`Cannot resolve callback ${Y}`);if(delete this.callbackCapabilities[Y],_t.callback===U.DATA)Q.resolve(_t.data);else if(_t.callback===U.ERROR)Q.reject(it(_t.reason));else throw new Error("Unexpected callback case");return}const dt=this.actionHandler[_t.action];if(!dt)throw new Error(`Unknown action from worker: ${_t.action}`);if(_t.callbackId){const Y=this.sourceName,Q=_t.sourceName;new Promise(function(St){St(dt(_t.data))}).then(function(St){lt.postMessage({sourceName:Y,targetName:Q,callback:U.DATA,callbackId:_t.callbackId,data:St})},function(St){lt.postMessage({sourceName:Y,targetName:Q,callback:U.ERROR,callbackId:_t.callbackId,reason:it(St)})});return}if(_t.streamId){Ft(this,At,_s).call(this,_t);return}dt(_t.data)},lt.addEventListener("message",this._onComObjOnMessage)}on(ut,st){const lt=this.actionHandler;if(lt[ut])throw new Error(`There is already an actionName called "${ut}"`);lt[ut]=st}send(ut,st,lt){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:ut,data:st},lt)}sendWithPromise(ut,st,lt){const mt=this.callbackId++,_t=new D.PromiseCapability;this.callbackCapabilities[mt]=_t;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:ut,callbackId:mt,data:st},lt)}catch(dt){_t.reject(dt)}return _t.promise}sendWithStream(ut,st,lt,mt){const _t=this.streamId++,dt=this.sourceName,Y=this.targetName,Q=this.comObj;return new ReadableStream({start:St=>{const rt=new D.PromiseCapability;return this.streamControllers[_t]={controller:St,startCall:rt,pullCall:null,cancelCall:null,isClosed:!1},Q.postMessage({sourceName:dt,targetName:Y,action:ut,streamId:_t,data:st,desiredSize:St.desiredSize},mt),rt.promise},pull:St=>{const rt=new D.PromiseCapability;return this.streamControllers[_t].pullCall=rt,Q.postMessage({sourceName:dt,targetName:Y,stream:ct.PULL,streamId:_t,desiredSize:St.desiredSize}),rt.promise},cancel:St=>{(0,D.assert)(St instanceof Error,"cancel must have a valid reason");const rt=new D.PromiseCapability;return this.streamControllers[_t].cancelCall=rt,this.streamControllers[_t].isClosed=!0,Q.postMessage({sourceName:dt,targetName:Y,stream:ct.CANCEL,streamId:_t,reason:it(St)}),rt.promise}},lt)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}At=new WeakSet,_s=function(ut){const st=ut.streamId,lt=this.sourceName,mt=ut.sourceName,_t=this.comObj,dt=this,Y=this.actionHandler[ut.action],Q={enqueue(St,rt=1,X){if(this.isCancelled)return;const bt=this.desiredSize;this.desiredSize-=rt,bt>0&&this.desiredSize<=0&&(this.sinkCapability=new D.PromiseCapability,this.ready=this.sinkCapability.promise),_t.postMessage({sourceName:lt,targetName:mt,stream:ct.ENQUEUE,streamId:st,chunk:St},X)},close(){this.isCancelled||(this.isCancelled=!0,_t.postMessage({sourceName:lt,targetName:mt,stream:ct.CLOSE,streamId:st}),delete dt.streamSinks[st])},error(St){(0,D.assert)(St instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,_t.postMessage({sourceName:lt,targetName:mt,stream:ct.ERROR,streamId:st,reason:it(St)}))},sinkCapability:new D.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:ut.desiredSize,ready:null};Q.sinkCapability.resolve(),Q.ready=Q.sinkCapability.promise,this.streamSinks[st]=Q,new Promise(function(St){St(Y(ut.data,Q))}).then(function(){_t.postMessage({sourceName:lt,targetName:mt,stream:ct.START_COMPLETE,streamId:st,success:!0})},function(St){_t.postMessage({sourceName:lt,targetName:mt,stream:ct.START_COMPLETE,streamId:st,reason:it(St)})})},et=new WeakSet,bs=function(ut){const st=ut.streamId,lt=this.sourceName,mt=ut.sourceName,_t=this.comObj,dt=this.streamControllers[st],Y=this.streamSinks[st];switch(ut.stream){case ct.START_COMPLETE:ut.success?dt.startCall.resolve():dt.startCall.reject(it(ut.reason));break;case ct.PULL_COMPLETE:ut.success?dt.pullCall.resolve():dt.pullCall.reject(it(ut.reason));break;case ct.PULL:if(!Y){_t.postMessage({sourceName:lt,targetName:mt,stream:ct.PULL_COMPLETE,streamId:st,success:!0});break}Y.desiredSize<=0&&ut.desiredSize>0&&Y.sinkCapability.resolve(),Y.desiredSize=ut.desiredSize,new Promise(function(Q){var St;Q((St=Y.onPull)==null?void 0:St.call(Y))}).then(function(){_t.postMessage({sourceName:lt,targetName:mt,stream:ct.PULL_COMPLETE,streamId:st,success:!0})},function(Q){_t.postMessage({sourceName:lt,targetName:mt,stream:ct.PULL_COMPLETE,streamId:st,reason:it(Q)})});break;case ct.ENQUEUE:if((0,D.assert)(dt,"enqueue should have stream controller"),dt.isClosed)break;dt.controller.enqueue(ut.chunk);break;case ct.CLOSE:if((0,D.assert)(dt,"close should have stream controller"),dt.isClosed)break;dt.isClosed=!0,dt.controller.close(),Ft(this,Pt,gi).call(this,dt,st);break;case ct.ERROR:(0,D.assert)(dt,"error should have stream controller"),dt.controller.error(it(ut.reason)),Ft(this,Pt,gi).call(this,dt,st);break;case ct.CANCEL_COMPLETE:ut.success?dt.cancelCall.resolve():dt.cancelCall.reject(it(ut.reason)),Ft(this,Pt,gi).call(this,dt,st);break;case ct.CANCEL:if(!Y)break;new Promise(function(Q){var St;Q((St=Y.onCancel)==null?void 0:St.call(Y,it(ut.reason)))}).then(function(){_t.postMessage({sourceName:lt,targetName:mt,stream:ct.CANCEL_COMPLETE,streamId:st,success:!0})},function(Q){_t.postMessage({sourceName:lt,targetName:mt,stream:ct.CANCEL_COMPLETE,streamId:st,reason:it(Q)})}),Y.sinkCapability.reject(it(ut.reason)),Y.isCancelled=!0,delete this.streamSinks[st];break;default:throw new Error("Unexpected stream case")}},Pt=new WeakSet,gi=async function(ut,st){var lt,mt,_t;await Promise.allSettled([(lt=ut.startCall)==null?void 0:lt.promise,(mt=ut.pullCall)==null?void 0:mt.promise,(_t=ut.cancelCall)==null?void 0:_t.promise]),delete this.streamControllers[st]},F.MessageHandler=zt},(K,F,B)=>{var ct,it;Object.defineProperty(F,"__esModule",{value:!0}),F.Metadata=void 0;var D=B(1);class U{constructor({parsedData:At,rawData:gt}){xt(this,ct,void 0);xt(this,it,void 0);Ht(this,ct,At),Ht(this,it,gt)}getRaw(){return O(this,it)}get(At){return O(this,ct).get(At)??null}getAll(){return(0,D.objectFromMap)(O(this,ct))}has(At){return O(this,ct).has(At)}}ct=new WeakMap,it=new WeakMap,F.Metadata=U},(K,F,B)=>{var At,gt,et,vt,Pt,yt,ji;Object.defineProperty(F,"__esModule",{value:!0}),F.OptionalContentConfig=void 0;var D=B(1),U=B(8);const ct=Symbol("INTERNAL");class it{constructor(st,lt){xt(this,At,!0);this.name=st,this.intent=lt}get visible(){return O(this,At)}_setVisible(st,lt){st!==ct&&(0,D.unreachable)("Internal method `_setVisible` called."),Ht(this,At,lt)}}At=new WeakMap;class zt{constructor(st){xt(this,yt);xt(this,gt,null);xt(this,et,new Map);xt(this,vt,null);xt(this,Pt,null);if(this.name=null,this.creator=null,st!==null){this.name=st.name,this.creator=st.creator,Ht(this,Pt,st.order);for(const lt of st.groups)O(this,et).set(lt.id,new it(lt.name,lt.intent));if(st.baseState==="OFF")for(const lt of O(this,et).values())lt._setVisible(ct,!1);for(const lt of st.on)O(this,et).get(lt)._setVisible(ct,!0);for(const lt of st.off)O(this,et).get(lt)._setVisible(ct,!1);Ht(this,vt,this.getHash())}}isVisible(st){if(O(this,et).size===0)return!0;if(!st)return(0,D.warn)("Optional content group not defined."),!0;if(st.type==="OCG")return O(this,et).has(st.id)?O(this,et).get(st.id).visible:((0,D.warn)(`Optional content group not found: ${st.id}`),!0);if(st.type==="OCMD"){if(st.expression)return Ft(this,yt,ji).call(this,st.expression);if(!st.policy||st.policy==="AnyOn"){for(const lt of st.ids){if(!O(this,et).has(lt))return(0,D.warn)(`Optional content group not found: ${lt}`),!0;if(O(this,et).get(lt).visible)return!0}return!1}else if(st.policy==="AllOn"){for(const lt of st.ids){if(!O(this,et).has(lt))return(0,D.warn)(`Optional content group not found: ${lt}`),!0;if(!O(this,et).get(lt).visible)return!1}return!0}else if(st.policy==="AnyOff"){for(const lt of st.ids){if(!O(this,et).has(lt))return(0,D.warn)(`Optional content group not found: ${lt}`),!0;if(!O(this,et).get(lt).visible)return!0}return!1}else if(st.policy==="AllOff"){for(const lt of st.ids){if(!O(this,et).has(lt))return(0,D.warn)(`Optional content group not found: ${lt}`),!0;if(O(this,et).get(lt).visible)return!1}return!0}return(0,D.warn)(`Unknown optional content policy ${st.policy}.`),!0}return(0,D.warn)(`Unknown group type ${st.type}.`),!0}setVisibility(st,lt=!0){if(!O(this,et).has(st)){(0,D.warn)(`Optional content group not found: ${st}`);return}O(this,et).get(st)._setVisible(ct,!!lt),Ht(this,gt,null)}get hasInitialVisibility(){return O(this,vt)===null||this.getHash()===O(this,vt)}getOrder(){return O(this,et).size?O(this,Pt)?O(this,Pt).slice():[...O(this,et).keys()]:null}getGroups(){return O(this,et).size>0?(0,D.objectFromMap)(O(this,et)):null}getGroup(st){return O(this,et).get(st)||null}getHash(){if(O(this,gt)!==null)return O(this,gt);const st=new U.MurmurHash3_64;for(const[lt,mt]of O(this,et))st.update(`${lt}:${mt.visible}`);return Ht(this,gt,st.hexdigest())}}gt=new WeakMap,et=new WeakMap,vt=new WeakMap,Pt=new WeakMap,yt=new WeakSet,ji=function(st){const lt=st.length;if(lt<2)return!0;const mt=st[0];for(let _t=1;_t<lt;_t++){const dt=st[_t];let Y;if(Array.isArray(dt))Y=Ft(this,yt,ji).call(this,dt);else if(O(this,et).has(dt))Y=O(this,et).get(dt).visible;else return(0,D.warn)(`Optional content group not found: ${dt}`),!0;switch(mt){case"And":if(!Y)return!1;break;case"Or":if(Y)return!0;break;case"Not":return!Y;default:return!0}}return mt==="And"},F.OptionalContentConfig=zt},(K,F,B)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.PDFDataTransportStream=void 0;var D=B(1),U=B(6);class ct{constructor({length:gt,initialData:et,progressiveDone:vt=!1,contentDispositionFilename:Pt=null,disableRange:yt=!1,disableStream:ht=!1},ut){if((0,D.assert)(ut,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=vt,this._contentDispositionFilename=Pt,(et==null?void 0:et.length)>0){const st=et instanceof Uint8Array&&et.byteLength===et.buffer.byteLength?et.buffer:new Uint8Array(et).buffer;this._queuedChunks.push(st)}this._pdfDataRangeTransport=ut,this._isStreamingSupported=!ht,this._isRangeSupported=!yt,this._contentLength=gt,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((st,lt)=>{this._onReceiveData({begin:st,chunk:lt})}),this._pdfDataRangeTransport.addProgressListener((st,lt)=>{this._onProgress({loaded:st,total:lt})}),this._pdfDataRangeTransport.addProgressiveReadListener(st=>{this._onReceiveData({chunk:st})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:gt,chunk:et}){const vt=et instanceof Uint8Array&&et.byteLength===et.buffer.byteLength?et.buffer:new Uint8Array(et).buffer;if(gt===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(vt):this._queuedChunks.push(vt);else{const Pt=this._rangeReaders.some(function(yt){return yt._begin!==gt?!1:(yt._enqueue(vt),!0)});(0,D.assert)(Pt,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var gt;return((gt=this._fullRequestReader)==null?void 0:gt._loaded)??0}_onProgress(gt){var et,vt,Pt,yt;gt.total===void 0?(vt=(et=this._rangeReaders[0])==null?void 0:et.onProgress)==null||vt.call(et,{loaded:gt.loaded}):(yt=(Pt=this._fullRequestReader)==null?void 0:Pt.onProgress)==null||yt.call(Pt,{loaded:gt.loaded,total:gt.total})}_onProgressiveDone(){var gt;(gt=this._fullRequestReader)==null||gt.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(gt){const et=this._rangeReaders.indexOf(gt);et>=0&&this._rangeReaders.splice(et,1)}getFullReader(){(0,D.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const gt=this._queuedChunks;return this._queuedChunks=null,new it(this,gt,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(gt,et){if(et<=this._progressiveDataLength)return null;const vt=new zt(this,gt,et);return this._pdfDataRangeTransport.requestDataRange(gt,et),this._rangeReaders.push(vt),vt}cancelAllRequests(gt){var et;(et=this._fullRequestReader)==null||et.cancel(gt);for(const vt of this._rangeReaders.slice(0))vt.cancel(gt);this._pdfDataRangeTransport.abort()}}F.PDFDataTransportStream=ct;class it{constructor(gt,et,vt=!1,Pt=null){this._stream=gt,this._done=vt||!1,this._filename=(0,U.isPdfFile)(Pt)?Pt:null,this._queuedChunks=et||[],this._loaded=0;for(const yt of this._queuedChunks)this._loaded+=yt.byteLength;this._requests=[],this._headersReady=Promise.resolve(),gt._fullRequestReader=this,this.onProgress=null}_enqueue(gt){this._done||(this._requests.length>0?this._requests.shift().resolve({value:gt,done:!1}):this._queuedChunks.push(gt),this._loaded+=gt.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const gt=new D.PromiseCapability;return this._requests.push(gt),gt.promise}cancel(gt){this._done=!0;for(const et of this._requests)et.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class zt{constructor(gt,et,vt){this._stream=gt,this._begin=et,this._end=vt,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(gt){if(!this._done){if(this._requests.length===0)this._queuedChunk=gt;else{this._requests.shift().resolve({value:gt,done:!1});for(const vt of this._requests)vt.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const et=this._queuedChunk;return this._queuedChunk=null,{value:et,done:!1}}if(this._done)return{value:void 0,done:!0};const gt=new D.PromiseCapability;return this._requests.push(gt),gt.promise}cancel(gt){this._done=!0;for(const et of this._requests)et.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(K,F,B)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.PDFFetchStream=void 0;var D=B(1),U=B(20);function ct(vt,Pt,yt){return{method:"GET",headers:vt,signal:yt.signal,mode:"cors",credentials:Pt?"include":"same-origin",redirect:"follow"}}function it(vt){const Pt=new Headers;for(const yt in vt){const ht=vt[yt];ht!==void 0&&Pt.append(yt,ht)}return Pt}function zt(vt){return vt instanceof Uint8Array?vt.buffer:vt instanceof ArrayBuffer?vt:((0,D.warn)(`getArrayBuffer - unexpected data format: ${vt}`),new Uint8Array(vt).buffer)}class At{constructor(Pt){this.source=Pt,this.isHttp=/^https?:/i.test(Pt.url),this.httpHeaders=this.isHttp&&Pt.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var Pt;return((Pt=this._fullRequestReader)==null?void 0:Pt._loaded)??0}getFullReader(){return(0,D.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new gt(this),this._fullRequestReader}getRangeReader(Pt,yt){if(yt<=this._progressiveDataLength)return null;const ht=new et(this,Pt,yt);return this._rangeRequestReaders.push(ht),ht}cancelAllRequests(Pt){var yt;(yt=this._fullRequestReader)==null||yt.cancel(Pt);for(const ht of this._rangeRequestReaders.slice(0))ht.cancel(Pt)}}F.PDFFetchStream=At;class gt{constructor(Pt){this._stream=Pt,this._reader=null,this._loaded=0,this._filename=null;const yt=Pt.source;this._withCredentials=yt.withCredentials||!1,this._contentLength=yt.length,this._headersCapability=new D.PromiseCapability,this._disableRange=yt.disableRange||!1,this._rangeChunkSize=yt.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!yt.disableStream,this._isRangeSupported=!yt.disableRange,this._headers=it(this._stream.httpHeaders);const ht=yt.url;fetch(ht,ct(this._headers,this._withCredentials,this._abortController)).then(ut=>{if(!(0,U.validateResponseStatus)(ut.status))throw(0,U.createResponseStatusError)(ut.status,ht);this._reader=ut.body.getReader(),this._headersCapability.resolve();const st=_t=>ut.headers.get(_t),{allowRangeRequests:lt,suggestedLength:mt}=(0,U.validateRangeRequestCapabilities)({getResponseHeader:st,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=lt,this._contentLength=mt||this._contentLength,this._filename=(0,U.extractFilenameFromHeader)(st),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new D.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var ht;await this._headersCapability.promise;const{value:Pt,done:yt}=await this._reader.read();return yt?{value:Pt,done:yt}:(this._loaded+=Pt.byteLength,(ht=this.onProgress)==null||ht.call(this,{loaded:this._loaded,total:this._contentLength}),{value:zt(Pt),done:!1})}cancel(Pt){var yt;(yt=this._reader)==null||yt.cancel(Pt),this._abortController.abort()}}class et{constructor(Pt,yt,ht){this._stream=Pt,this._reader=null,this._loaded=0;const ut=Pt.source;this._withCredentials=ut.withCredentials||!1,this._readCapability=new D.PromiseCapability,this._isStreamingSupported=!ut.disableStream,this._abortController=new AbortController,this._headers=it(this._stream.httpHeaders),this._headers.append("Range",`bytes=${yt}-${ht-1}`);const st=ut.url;fetch(st,ct(this._headers,this._withCredentials,this._abortController)).then(lt=>{if(!(0,U.validateResponseStatus)(lt.status))throw(0,U.createResponseStatusError)(lt.status,st);this._readCapability.resolve(),this._reader=lt.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var ht;await this._readCapability.promise;const{value:Pt,done:yt}=await this._reader.read();return yt?{value:Pt,done:yt}:(this._loaded+=Pt.byteLength,(ht=this.onProgress)==null||ht.call(this,{loaded:this._loaded}),{value:zt(Pt),done:!1})}cancel(Pt){var yt;(yt=this._reader)==null||yt.cancel(Pt),this._abortController.abort()}}},(K,F,B)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.createResponseStatusError=At,F.extractFilenameFromHeader=zt,F.validateRangeRequestCapabilities=it,F.validateResponseStatus=gt;var D=B(1),U=B(21),ct=B(6);function it({getResponseHeader:et,isHttp:vt,rangeChunkSize:Pt,disableRange:yt}){const ht={allowRangeRequests:!1,suggestedLength:void 0},ut=parseInt(et("Content-Length"),10);return!Number.isInteger(ut)||(ht.suggestedLength=ut,ut<=2*Pt)||yt||!vt||et("Accept-Ranges")!=="bytes"||(et("Content-Encoding")||"identity")!=="identity"||(ht.allowRangeRequests=!0),ht}function zt(et){const vt=et("Content-Disposition");if(vt){let Pt=(0,U.getFilenameFromContentDispositionHeader)(vt);if(Pt.includes("%"))try{Pt=decodeURIComponent(Pt)}catch{}if((0,ct.isPdfFile)(Pt))return Pt}return null}function At(et,vt){return et===404||et===0&&vt.startsWith("file:")?new D.MissingPDFException('Missing PDF "'+vt+'".'):new D.UnexpectedResponseException(`Unexpected server response (${et}) while retrieving PDF "${vt}".`,et)}function gt(et){return et===200||et===206}},(K,F,B)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.getFilenameFromContentDispositionHeader=U;var D=B(1);function U(ct){let it=!0,zt=At("filename\\*","i").exec(ct);if(zt){zt=zt[1];let ut=Pt(zt);return ut=unescape(ut),ut=yt(ut),ut=ht(ut),et(ut)}if(zt=vt(ct),zt){const ut=ht(zt);return et(ut)}if(zt=At("filename","i").exec(ct),zt){zt=zt[1];let ut=Pt(zt);return ut=ht(ut),et(ut)}function At(ut,st){return new RegExp("(?:^|;)\\s*"+ut+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',st)}function gt(ut,st){if(ut){if(!/^[\x00-\xFF]+$/.test(st))return st;try{const lt=new TextDecoder(ut,{fatal:!0}),mt=(0,D.stringToBytes)(st);st=lt.decode(mt),it=!1}catch{}}return st}function et(ut){return it&&/[\x80-\xff]/.test(ut)&&(ut=gt("utf-8",ut),it&&(ut=gt("iso-8859-1",ut))),ut}function vt(ut){const st=[];let lt;const mt=At("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(lt=mt.exec(ut))!==null;){let[,dt,Y,Q]=lt;if(dt=parseInt(dt,10),dt in st){if(dt===0)break;continue}st[dt]=[Y,Q]}const _t=[];for(let dt=0;dt<st.length&&dt in st;++dt){let[Y,Q]=st[dt];Q=Pt(Q),Y&&(Q=unescape(Q),dt===0&&(Q=yt(Q))),_t.push(Q)}return _t.join("")}function Pt(ut){if(ut.startsWith('"')){const st=ut.slice(1).split('\\"');for(let lt=0;lt<st.length;++lt){const mt=st[lt].indexOf('"');mt!==-1&&(st[lt]=st[lt].slice(0,mt),st.length=lt+1),st[lt]=st[lt].replaceAll(/\\(.)/g,"$1")}ut=st.join('"')}return ut}function yt(ut){const st=ut.indexOf("'");if(st===-1)return ut;const lt=ut.slice(0,st),_t=ut.slice(st+1).replace(/^[^']*'/,"");return gt(lt,_t)}function ht(ut){return!ut.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(ut)?ut:ut.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(st,lt,mt,_t){if(mt==="q"||mt==="Q")return _t=_t.replaceAll("_"," "),_t=_t.replaceAll(/=([0-9a-fA-F]{2})/g,function(dt,Y){return String.fromCharCode(parseInt(Y,16))}),gt(lt,_t);try{_t=atob(_t)}catch{}return gt(lt,_t)})}return""}},(K,F,B)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.PDFNetworkStream=void 0;var D=B(1),U=B(20);const ct=200,it=206;function zt(Pt){const yt=Pt.response;return typeof yt!="string"?yt:(0,D.stringToBytes)(yt).buffer}class At{constructor(yt,ht={}){this.url=yt,this.isHttp=/^https?:/i.test(yt),this.httpHeaders=this.isHttp&&ht.httpHeaders||Object.create(null),this.withCredentials=ht.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(yt,ht,ut){const st={begin:yt,end:ht};for(const lt in ut)st[lt]=ut[lt];return this.request(st)}requestFull(yt){return this.request(yt)}request(yt){const ht=new XMLHttpRequest,ut=this.currXhrId++,st=this.pendingRequests[ut]={xhr:ht};ht.open("GET",this.url),ht.withCredentials=this.withCredentials;for(const lt in this.httpHeaders){const mt=this.httpHeaders[lt];mt!==void 0&&ht.setRequestHeader(lt,mt)}return this.isHttp&&"begin"in yt&&"end"in yt?(ht.setRequestHeader("Range",`bytes=${yt.begin}-${yt.end-1}`),st.expectedStatus=it):st.expectedStatus=ct,ht.responseType="arraybuffer",yt.onError&&(ht.onerror=function(lt){yt.onError(ht.status)}),ht.onreadystatechange=this.onStateChange.bind(this,ut),ht.onprogress=this.onProgress.bind(this,ut),st.onHeadersReceived=yt.onHeadersReceived,st.onDone=yt.onDone,st.onError=yt.onError,st.onProgress=yt.onProgress,ht.send(null),ut}onProgress(yt,ht){var st;const ut=this.pendingRequests[yt];ut&&((st=ut.onProgress)==null||st.call(ut,ht))}onStateChange(yt,ht){var dt,Y,Q;const ut=this.pendingRequests[yt];if(!ut)return;const st=ut.xhr;if(st.readyState>=2&&ut.onHeadersReceived&&(ut.onHeadersReceived(),delete ut.onHeadersReceived),st.readyState!==4||!(yt in this.pendingRequests))return;if(delete this.pendingRequests[yt],st.status===0&&this.isHttp){(dt=ut.onError)==null||dt.call(ut,st.status);return}const lt=st.status||ct;if(!(lt===ct&&ut.expectedStatus===it)&&lt!==ut.expectedStatus){(Y=ut.onError)==null||Y.call(ut,st.status);return}const _t=zt(st);if(lt===it){const St=st.getResponseHeader("Content-Range"),rt=/bytes (\d+)-(\d+)\/(\d+)/.exec(St);ut.onDone({begin:parseInt(rt[1],10),chunk:_t})}else _t?ut.onDone({begin:0,chunk:_t}):(Q=ut.onError)==null||Q.call(ut,st.status)}getRequestXhr(yt){return this.pendingRequests[yt].xhr}isPendingRequest(yt){return yt in this.pendingRequests}abortRequest(yt){const ht=this.pendingRequests[yt].xhr;delete this.pendingRequests[yt],ht.abort()}}class gt{constructor(yt){this._source=yt,this._manager=new At(yt.url,{httpHeaders:yt.httpHeaders,withCredentials:yt.withCredentials}),this._rangeChunkSize=yt.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(yt){const ht=this._rangeRequestReaders.indexOf(yt);ht>=0&&this._rangeRequestReaders.splice(ht,1)}getFullReader(){return(0,D.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new et(this._manager,this._source),this._fullRequestReader}getRangeReader(yt,ht){const ut=new vt(this._manager,yt,ht);return ut.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(ut),ut}cancelAllRequests(yt){var ht;(ht=this._fullRequestReader)==null||ht.cancel(yt);for(const ut of this._rangeRequestReaders.slice(0))ut.cancel(yt)}}F.PDFNetworkStream=gt;class et{constructor(yt,ht){this._manager=yt;const ut={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=ht.url,this._fullRequestId=yt.requestFull(ut),this._headersReceivedCapability=new D.PromiseCapability,this._disableRange=ht.disableRange||!1,this._contentLength=ht.length,this._rangeChunkSize=ht.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const yt=this._fullRequestId,ht=this._manager.getRequestXhr(yt),ut=mt=>ht.getResponseHeader(mt),{allowRangeRequests:st,suggestedLength:lt}=(0,U.validateRangeRequestCapabilities)({getResponseHeader:ut,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});st&&(this._isRangeSupported=!0),this._contentLength=lt||this._contentLength,this._filename=(0,U.extractFilenameFromHeader)(ut),this._isRangeSupported&&this._manager.abortRequest(yt),this._headersReceivedCapability.resolve()}_onDone(yt){if(yt&&(this._requests.length>0?this._requests.shift().resolve({value:yt.chunk,done:!1}):this._cachedChunks.push(yt.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const ht of this._requests)ht.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(yt){this._storedError=(0,U.createResponseStatusError)(yt,this._url),this._headersReceivedCapability.reject(this._storedError);for(const ht of this._requests)ht.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(yt){var ht;(ht=this.onProgress)==null||ht.call(this,{loaded:yt.loaded,total:yt.lengthComputable?yt.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const yt=new D.PromiseCapability;return this._requests.push(yt),yt.promise}cancel(yt){this._done=!0,this._headersReceivedCapability.reject(yt);for(const ht of this._requests)ht.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class vt{constructor(yt,ht,ut){this._manager=yt;const st={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=yt.url,this._requestId=yt.requestRange(ht,ut,st),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var yt;(yt=this.onClosed)==null||yt.call(this,this)}_onDone(yt){const ht=yt.chunk;this._requests.length>0?this._requests.shift().resolve({value:ht,done:!1}):this._queuedChunk=ht,this._done=!0;for(const ut of this._requests)ut.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(yt){this._storedError=(0,U.createResponseStatusError)(yt,this._url);for(const ht of this._requests)ht.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(yt){var ht;this.isStreamingSupported||(ht=this.onProgress)==null||ht.call(this,{loaded:yt.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const ht=this._queuedChunk;return this._queuedChunk=null,{value:ht,done:!1}}if(this._done)return{value:void 0,done:!0};const yt=new D.PromiseCapability;return this._requests.push(yt),yt.promise}cancel(yt){this._done=!0;for(const ht of this._requests)ht.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(K,F,B)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.PDFNodeStream=void 0;var D=B(1),U=B(20);const ct=/^file:\/\/\/[a-zA-Z]:\//;function it(ut){const st=require("url"),lt=st.parse(ut);return lt.protocol==="file:"||lt.host?lt:/^[a-z]:[/\\]/i.test(ut)?st.parse(`file:///${ut}`):(lt.host||(lt.protocol="file:"),lt)}class zt{constructor(st){this.source=st,this.url=it(st.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&st.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var st;return((st=this._fullRequestReader)==null?void 0:st._loaded)??0}getFullReader(){return(0,D.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new yt(this):new vt(this),this._fullRequestReader}getRangeReader(st,lt){if(lt<=this._progressiveDataLength)return null;const mt=this.isFsUrl?new ht(this,st,lt):new Pt(this,st,lt);return this._rangeRequestReaders.push(mt),mt}cancelAllRequests(st){var lt;(lt=this._fullRequestReader)==null||lt.cancel(st);for(const mt of this._rangeRequestReaders.slice(0))mt.cancel(st)}}F.PDFNodeStream=zt;class At{constructor(st){this._url=st.url,this._done=!1,this._storedError=null,this.onProgress=null;const lt=st.source;this._contentLength=lt.length,this._loaded=0,this._filename=null,this._disableRange=lt.disableRange||!1,this._rangeChunkSize=lt.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!lt.disableStream,this._isRangeSupported=!lt.disableRange,this._readableStream=null,this._readCapability=new D.PromiseCapability,this._headersCapability=new D.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var mt;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const st=this._readableStream.read();return st===null?(this._readCapability=new D.PromiseCapability,this.read()):(this._loaded+=st.length,(mt=this.onProgress)==null||mt.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(st).buffer,done:!1})}cancel(st){if(!this._readableStream){this._error(st);return}this._readableStream.destroy(st)}_error(st){this._storedError=st,this._readCapability.resolve()}_setReadableStream(st){this._readableStream=st,st.on("readable",()=>{this._readCapability.resolve()}),st.on("end",()=>{st.destroy(),this._done=!0,this._readCapability.resolve()}),st.on("error",lt=>{this._error(lt)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new D.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class gt{constructor(st){this._url=st.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new D.PromiseCapability;const lt=st.source;this._isStreamingSupported=!lt.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var mt;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const st=this._readableStream.read();return st===null?(this._readCapability=new D.PromiseCapability,this.read()):(this._loaded+=st.length,(mt=this.onProgress)==null||mt.call(this,{loaded:this._loaded}),{value:new Uint8Array(st).buffer,done:!1})}cancel(st){if(!this._readableStream){this._error(st);return}this._readableStream.destroy(st)}_error(st){this._storedError=st,this._readCapability.resolve()}_setReadableStream(st){this._readableStream=st,st.on("readable",()=>{this._readCapability.resolve()}),st.on("end",()=>{st.destroy(),this._done=!0,this._readCapability.resolve()}),st.on("error",lt=>{this._error(lt)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function et(ut,st){return{protocol:ut.protocol,auth:ut.auth,host:ut.hostname,port:ut.port,path:ut.path,method:"GET",headers:st}}class vt extends At{constructor(st){super(st);const lt=mt=>{if(mt.statusCode===404){const Q=new D.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=Q,this._headersCapability.reject(Q);return}this._headersCapability.resolve(),this._setReadableStream(mt);const _t=Q=>this._readableStream.headers[Q.toLowerCase()],{allowRangeRequests:dt,suggestedLength:Y}=(0,U.validateRangeRequestCapabilities)({getResponseHeader:_t,isHttp:st.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=dt,this._contentLength=Y||this._contentLength,this._filename=(0,U.extractFilenameFromHeader)(_t)};if(this._request=null,this._url.protocol==="http:"){const mt=require("http");this._request=mt.request(et(this._url,st.httpHeaders),lt)}else{const mt=require("https");this._request=mt.request(et(this._url,st.httpHeaders),lt)}this._request.on("error",mt=>{this._storedError=mt,this._headersCapability.reject(mt)}),this._request.end()}}class Pt extends gt{constructor(st,lt,mt){super(st),this._httpHeaders={};for(const dt in st.httpHeaders){const Y=st.httpHeaders[dt];Y!==void 0&&(this._httpHeaders[dt]=Y)}this._httpHeaders.Range=`bytes=${lt}-${mt-1}`;const _t=dt=>{if(dt.statusCode===404){const Y=new D.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=Y;return}this._setReadableStream(dt)};if(this._request=null,this._url.protocol==="http:"){const dt=require("http");this._request=dt.request(et(this._url,this._httpHeaders),_t)}else{const dt=require("https");this._request=dt.request(et(this._url,this._httpHeaders),_t)}this._request.on("error",dt=>{this._storedError=dt}),this._request.end()}}class yt extends At{constructor(st){super(st);let lt=decodeURIComponent(this._url.path);ct.test(this._url.href)&&(lt=lt.replace(/^\//,""));const mt=require("fs");mt.lstat(lt,(_t,dt)=>{if(_t){_t.code==="ENOENT"&&(_t=new D.MissingPDFException(`Missing PDF "${lt}".`)),this._storedError=_t,this._headersCapability.reject(_t);return}this._contentLength=dt.size,this._setReadableStream(mt.createReadStream(lt)),this._headersCapability.resolve()})}}class ht extends gt{constructor(st,lt,mt){super(st);let _t=decodeURIComponent(this._url.path);ct.test(this._url.href)&&(_t=_t.replace(/^\//,""));const dt=require("fs");this._setReadableStream(dt.createReadStream(_t,{start:lt,end:mt-1}))}}},(K,F,B)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.SVGGraphics=void 0;var D=B(6),U=B(1);const ct={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},it="http://www.w3.org/XML/1998/namespace",zt="http://www.w3.org/1999/xlink",At=["butt","round","square"],gt=["miter","round","bevel"],et=function(dt,Y="",Q=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!Q)return URL.createObjectURL(new Blob([dt],{type:Y}));const St="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let rt=`data:${Y};base64,`;for(let X=0,bt=dt.length;X<bt;X+=3){const at=dt[X]&255,kt=dt[X+1]&255,Ot=dt[X+2]&255,ft=at>>2,It=(at&3)<<4|kt>>4,qt=X+1<bt?(kt&15)<<2|Ot>>6:64,Vt=X+2<bt?Ot&63:64;rt+=St[ft]+St[It]+St[qt]+St[Vt]}return rt},vt=function(){const dt=new Uint8Array([137,80,78,71,13,10,26,10]),Y=12,Q=new Int32Array(256);for(let Ot=0;Ot<256;Ot++){let ft=Ot;for(let It=0;It<8;It++)ft=ft&1?3988292384^ft>>1&2147483647:ft>>1&2147483647;Q[Ot]=ft}function St(Ot,ft,It){let qt=-1;for(let Vt=ft;Vt<It;Vt++){const Rt=(qt^Ot[Vt])&255,Kt=Q[Rt];qt=qt>>>8^Kt}return qt^-1}function rt(Ot,ft,It,qt){let Vt=qt;const Rt=ft.length;It[Vt]=Rt>>24&255,It[Vt+1]=Rt>>16&255,It[Vt+2]=Rt>>8&255,It[Vt+3]=Rt&255,Vt+=4,It[Vt]=Ot.charCodeAt(0)&255,It[Vt+1]=Ot.charCodeAt(1)&255,It[Vt+2]=Ot.charCodeAt(2)&255,It[Vt+3]=Ot.charCodeAt(3)&255,Vt+=4,It.set(ft,Vt),Vt+=ft.length;const Kt=St(It,qt+4,Vt);It[Vt]=Kt>>24&255,It[Vt+1]=Kt>>16&255,It[Vt+2]=Kt>>8&255,It[Vt+3]=Kt&255}function X(Ot,ft,It){let qt=1,Vt=0;for(let Rt=ft;Rt<It;++Rt)qt=(qt+(Ot[Rt]&255))%65521,Vt=(Vt+qt)%65521;return Vt<<16|qt}function bt(Ot){if(!U.isNodeJS)return at(Ot);try{const ft=parseInt(process.versions.node)>=8?Ot:Buffer.from(Ot),It=require("zlib").deflateSync(ft,{level:9});return It instanceof Uint8Array?It:new Uint8Array(It)}catch(ft){(0,U.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+ft)}return at(Ot)}function at(Ot){let ft=Ot.length;const It=65535,qt=Math.ceil(ft/It),Vt=new Uint8Array(2+ft+qt*5+4);let Rt=0;Vt[Rt++]=120,Vt[Rt++]=156;let Kt=0;for(;ft>It;)Vt[Rt++]=0,Vt[Rt++]=255,Vt[Rt++]=255,Vt[Rt++]=0,Vt[Rt++]=0,Vt.set(Ot.subarray(Kt,Kt+It),Rt),Rt+=It,Kt+=It,ft-=It;Vt[Rt++]=1,Vt[Rt++]=ft&255,Vt[Rt++]=ft>>8&255,Vt[Rt++]=~ft&65535&255,Vt[Rt++]=(~ft&65535)>>8&255,Vt.set(Ot.subarray(Kt),Rt),Rt+=Ot.length-Kt;const ee=X(Ot,0,Ot.length);return Vt[Rt++]=ee>>24&255,Vt[Rt++]=ee>>16&255,Vt[Rt++]=ee>>8&255,Vt[Rt++]=ee&255,Vt}function kt(Ot,ft,It,qt){const Vt=Ot.width,Rt=Ot.height;let Kt,ee,he;const fe=Ot.data;switch(ft){case U.ImageKind.GRAYSCALE_1BPP:ee=0,Kt=1,he=Vt+7>>3;break;case U.ImageKind.RGB_24BPP:ee=2,Kt=8,he=Vt*3;break;case U.ImageKind.RGBA_32BPP:ee=6,Kt=8,he=Vt*4;break;default:throw new Error("invalid format")}const pt=new Uint8Array((1+he)*Rt);let z=0,q=0;for(let Tt=0;Tt<Rt;++Tt)pt[z++]=0,pt.set(fe.subarray(q,q+he),z),q+=he,z+=he;if(ft===U.ImageKind.GRAYSCALE_1BPP&&qt){z=0;for(let Tt=0;Tt<Rt;Tt++){z++;for(let Wt=0;Wt<he;Wt++)pt[z++]^=255}}const G=new Uint8Array([Vt>>24&255,Vt>>16&255,Vt>>8&255,Vt&255,Rt>>24&255,Rt>>16&255,Rt>>8&255,Rt&255,Kt,ee,0,0,0]),J=bt(pt),tt=dt.length+Y*3+G.length+J.length,ot=new Uint8Array(tt);let wt=0;return ot.set(dt,wt),wt+=dt.length,rt("IHDR",G,ot,wt),wt+=Y+G.length,rt("IDATA",J,ot,wt),wt+=Y+J.length,rt("IEND",new Uint8Array(0),ot,wt),et(ot,"image/png",It)}return function(ft,It,qt){const Vt=ft.kind===void 0?U.ImageKind.GRAYSCALE_1BPP:ft.kind;return kt(ft,Vt,It,qt)}}();class Pt{constructor(){this.fontSizeScale=1,this.fontWeight=ct.fontWeight,this.fontSize=0,this.textMatrix=U.IDENTITY_MATRIX,this.fontMatrix=U.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=U.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=ct.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(Y,Q){this.x=Y,this.y=Q}}function yt(dt){let Y=[];const Q=[];for(const St of dt){if(St.fn==="save"){Y.push({fnId:92,fn:"group",items:[]}),Q.push(Y),Y=Y.at(-1).items;continue}St.fn==="restore"?Y=Q.pop():Y.push(St)}return Y}function ht(dt){if(Number.isInteger(dt))return dt.toString();const Y=dt.toFixed(10);let Q=Y.length-1;if(Y[Q]!=="0")return Y;do Q--;while(Y[Q]==="0");return Y.substring(0,Y[Q]==="."?Q:Q+1)}function ut(dt){if(dt[4]===0&&dt[5]===0){if(dt[1]===0&&dt[2]===0)return dt[0]===1&&dt[3]===1?"":`scale(${ht(dt[0])} ${ht(dt[3])})`;if(dt[0]===dt[3]&&dt[1]===-dt[2]){const Y=Math.acos(dt[0])*180/Math.PI;return`rotate(${ht(Y)})`}}else if(dt[0]===1&&dt[1]===0&&dt[2]===0&&dt[3]===1)return`translate(${ht(dt[4])} ${ht(dt[5])})`;return`matrix(${ht(dt[0])} ${ht(dt[1])} ${ht(dt[2])} ${ht(dt[3])} ${ht(dt[4])} ${ht(dt[5])})`}let st=0,lt=0,mt=0;class _t{constructor(Y,Q,St=!1){(0,D.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new D.DOMSVGFactory,this.current=new Pt,this.transformMatrix=U.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=Y,this.objs=Q,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!St,this._operatorIdMapping=[];for(const rt in U.OPS)this._operatorIdMapping[U.OPS[rt]]=rt}getObject(Y,Q=null){return typeof Y=="string"?Y.startsWith("g_")?this.commonObjs.get(Y):this.objs.get(Y):Q}save(){this.transformStack.push(this.transformMatrix);const Y=this.current;this.extraStack.push(Y),this.current=Y.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(Y){this.save(),this.executeOpTree(Y),this.restore()}loadDependencies(Y){const Q=Y.fnArray,St=Y.argsArray;for(let rt=0,X=Q.length;rt<X;rt++)if(Q[rt]===U.OPS.dependency)for(const bt of St[rt]){const at=bt.startsWith("g_")?this.commonObjs:this.objs,kt=new Promise(Ot=>{at.get(bt,Ot)});this.current.dependencies.push(kt)}return Promise.all(this.current.dependencies)}transform(Y,Q,St,rt,X,bt){const at=[Y,Q,St,rt,X,bt];this.transformMatrix=U.Util.transform(this.transformMatrix,at),this.tgrp=null}getSVG(Y,Q){this.viewport=Q;const St=this._initialize(Q);return this.loadDependencies(Y).then(()=>(this.transformMatrix=U.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(Y)),St))}convertOpList(Y){const Q=this._operatorIdMapping,St=Y.argsArray,rt=Y.fnArray,X=[];for(let bt=0,at=rt.length;bt<at;bt++){const kt=rt[bt];X.push({fnId:kt,fn:Q[kt],args:St[bt]})}return yt(X)}executeOpTree(Y){for(const Q of Y){const St=Q.fn,rt=Q.fnId,X=Q.args;switch(rt|0){case U.OPS.beginText:this.beginText();break;case U.OPS.dependency:break;case U.OPS.setLeading:this.setLeading(X);break;case U.OPS.setLeadingMoveText:this.setLeadingMoveText(X[0],X[1]);break;case U.OPS.setFont:this.setFont(X);break;case U.OPS.showText:this.showText(X[0]);break;case U.OPS.showSpacedText:this.showText(X[0]);break;case U.OPS.endText:this.endText();break;case U.OPS.moveText:this.moveText(X[0],X[1]);break;case U.OPS.setCharSpacing:this.setCharSpacing(X[0]);break;case U.OPS.setWordSpacing:this.setWordSpacing(X[0]);break;case U.OPS.setHScale:this.setHScale(X[0]);break;case U.OPS.setTextMatrix:this.setTextMatrix(X[0],X[1],X[2],X[3],X[4],X[5]);break;case U.OPS.setTextRise:this.setTextRise(X[0]);break;case U.OPS.setTextRenderingMode:this.setTextRenderingMode(X[0]);break;case U.OPS.setLineWidth:this.setLineWidth(X[0]);break;case U.OPS.setLineJoin:this.setLineJoin(X[0]);break;case U.OPS.setLineCap:this.setLineCap(X[0]);break;case U.OPS.setMiterLimit:this.setMiterLimit(X[0]);break;case U.OPS.setFillRGBColor:this.setFillRGBColor(X[0],X[1],X[2]);break;case U.OPS.setStrokeRGBColor:this.setStrokeRGBColor(X[0],X[1],X[2]);break;case U.OPS.setStrokeColorN:this.setStrokeColorN(X);break;case U.OPS.setFillColorN:this.setFillColorN(X);break;case U.OPS.shadingFill:this.shadingFill(X[0]);break;case U.OPS.setDash:this.setDash(X[0],X[1]);break;case U.OPS.setRenderingIntent:this.setRenderingIntent(X[0]);break;case U.OPS.setFlatness:this.setFlatness(X[0]);break;case U.OPS.setGState:this.setGState(X[0]);break;case U.OPS.fill:this.fill();break;case U.OPS.eoFill:this.eoFill();break;case U.OPS.stroke:this.stroke();break;case U.OPS.fillStroke:this.fillStroke();break;case U.OPS.eoFillStroke:this.eoFillStroke();break;case U.OPS.clip:this.clip("nonzero");break;case U.OPS.eoClip:this.clip("evenodd");break;case U.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case U.OPS.paintImageXObject:this.paintImageXObject(X[0]);break;case U.OPS.paintInlineImageXObject:this.paintInlineImageXObject(X[0]);break;case U.OPS.paintImageMaskXObject:this.paintImageMaskXObject(X[0]);break;case U.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(X[0],X[1]);break;case U.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case U.OPS.closePath:this.closePath();break;case U.OPS.closeStroke:this.closeStroke();break;case U.OPS.closeFillStroke:this.closeFillStroke();break;case U.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case U.OPS.nextLine:this.nextLine();break;case U.OPS.transform:this.transform(X[0],X[1],X[2],X[3],X[4],X[5]);break;case U.OPS.constructPath:this.constructPath(X[0],X[1]);break;case U.OPS.endPath:this.endPath();break;case 92:this.group(Q.items);break;default:(0,U.warn)(`Unimplemented operator ${St}`);break}}}setWordSpacing(Y){this.current.wordSpacing=Y}setCharSpacing(Y){this.current.charSpacing=Y}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(Y,Q,St,rt,X,bt){const at=this.current;at.textMatrix=at.lineMatrix=[Y,Q,St,rt,X,bt],at.textMatrixScale=Math.hypot(Y,Q),at.x=at.lineX=0,at.y=at.lineY=0,at.xcoords=[],at.ycoords=[],at.tspan=this.svgFactory.createElement("svg:tspan"),at.tspan.setAttributeNS(null,"font-family",at.fontFamily),at.tspan.setAttributeNS(null,"font-size",`${ht(at.fontSize)}px`),at.tspan.setAttributeNS(null,"y",ht(-at.y)),at.txtElement=this.svgFactory.createElement("svg:text"),at.txtElement.append(at.tspan)}beginText(){const Y=this.current;Y.x=Y.lineX=0,Y.y=Y.lineY=0,Y.textMatrix=U.IDENTITY_MATRIX,Y.lineMatrix=U.IDENTITY_MATRIX,Y.textMatrixScale=1,Y.tspan=this.svgFactory.createElement("svg:tspan"),Y.txtElement=this.svgFactory.createElement("svg:text"),Y.txtgrp=this.svgFactory.createElement("svg:g"),Y.xcoords=[],Y.ycoords=[]}moveText(Y,Q){const St=this.current;St.x=St.lineX+=Y,St.y=St.lineY+=Q,St.xcoords=[],St.ycoords=[],St.tspan=this.svgFactory.createElement("svg:tspan"),St.tspan.setAttributeNS(null,"font-family",St.fontFamily),St.tspan.setAttributeNS(null,"font-size",`${ht(St.fontSize)}px`),St.tspan.setAttributeNS(null,"y",ht(-St.y))}showText(Y){const Q=this.current,St=Q.font,rt=Q.fontSize;if(rt===0)return;const X=Q.fontSizeScale,bt=Q.charSpacing,at=Q.wordSpacing,kt=Q.fontDirection,Ot=Q.textHScale*kt,ft=St.vertical,It=ft?1:-1,qt=St.defaultVMetrics,Vt=rt*Q.fontMatrix[0];let Rt=0;for(const he of Y){if(he===null){Rt+=kt*at;continue}else if(typeof he=="number"){Rt+=It*he*rt/1e3;continue}const fe=(he.isSpace?at:0)+bt,pt=he.fontChar;let z,q,G=he.width;if(ft){let tt;const ot=he.vmetric||qt;tt=he.vmetric?ot[1]:G*.5,tt=-tt*Vt;const wt=ot[2]*Vt;G=ot?-ot[0]:G,z=tt/X,q=(Rt+wt)/X}else z=Rt/X,q=0;(he.isInFont||St.missingFile)&&(Q.xcoords.push(Q.x+z),ft&&Q.ycoords.push(-Q.y+q),Q.tspan.textContent+=pt);const J=ft?G*Vt-fe*kt:G*Vt+fe*kt;Rt+=J}Q.tspan.setAttributeNS(null,"x",Q.xcoords.map(ht).join(" ")),ft?Q.tspan.setAttributeNS(null,"y",Q.ycoords.map(ht).join(" ")):Q.tspan.setAttributeNS(null,"y",ht(-Q.y)),ft?Q.y-=Rt:Q.x+=Rt*Ot,Q.tspan.setAttributeNS(null,"font-family",Q.fontFamily),Q.tspan.setAttributeNS(null,"font-size",`${ht(Q.fontSize)}px`),Q.fontStyle!==ct.fontStyle&&Q.tspan.setAttributeNS(null,"font-style",Q.fontStyle),Q.fontWeight!==ct.fontWeight&&Q.tspan.setAttributeNS(null,"font-weight",Q.fontWeight);const Kt=Q.textRenderingMode&U.TextRenderingMode.FILL_STROKE_MASK;if(Kt===U.TextRenderingMode.FILL||Kt===U.TextRenderingMode.FILL_STROKE?(Q.fillColor!==ct.fillColor&&Q.tspan.setAttributeNS(null,"fill",Q.fillColor),Q.fillAlpha<1&&Q.tspan.setAttributeNS(null,"fill-opacity",Q.fillAlpha)):Q.textRenderingMode===U.TextRenderingMode.ADD_TO_PATH?Q.tspan.setAttributeNS(null,"fill","transparent"):Q.tspan.setAttributeNS(null,"fill","none"),Kt===U.TextRenderingMode.STROKE||Kt===U.TextRenderingMode.FILL_STROKE){const he=1/(Q.textMatrixScale||1);this._setStrokeAttributes(Q.tspan,he)}let ee=Q.textMatrix;Q.textRise!==0&&(ee=ee.slice(),ee[5]+=Q.textRise),Q.txtElement.setAttributeNS(null,"transform",`${ut(ee)} scale(${ht(Ot)}, -1)`),Q.txtElement.setAttributeNS(it,"xml:space","preserve"),Q.txtElement.append(Q.tspan),Q.txtgrp.append(Q.txtElement),this._ensureTransformGroup().append(Q.txtElement)}setLeadingMoveText(Y,Q){this.setLeading(-Q),this.moveText(Y,Q)}addFontStyle(Y){if(!Y.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const Q=et(Y.data,Y.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${Y.loadedName}"; src: url(${Q}); }
`}setFont(Y){const Q=this.current,St=this.commonObjs.get(Y[0]);let rt=Y[1];Q.font=St,this.embedFonts&&!St.missingFile&&!this.embeddedFonts[St.loadedName]&&(this.addFontStyle(St),this.embeddedFonts[St.loadedName]=St),Q.fontMatrix=St.fontMatrix||U.FONT_IDENTITY_MATRIX;let X="normal";St.black?X="900":St.bold&&(X="bold");const bt=St.italic?"italic":"normal";rt<0?(rt=-rt,Q.fontDirection=-1):Q.fontDirection=1,Q.fontSize=rt,Q.fontFamily=St.loadedName,Q.fontWeight=X,Q.fontStyle=bt,Q.tspan=this.svgFactory.createElement("svg:tspan"),Q.tspan.setAttributeNS(null,"y",ht(-Q.y)),Q.xcoords=[],Q.ycoords=[]}endText(){var Q;const Y=this.current;Y.textRenderingMode&U.TextRenderingMode.ADD_TO_PATH_FLAG&&((Q=Y.txtElement)!=null&&Q.hasChildNodes())&&(Y.element=Y.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(Y){Y>0&&(this.current.lineWidth=Y)}setLineCap(Y){this.current.lineCap=At[Y]}setLineJoin(Y){this.current.lineJoin=gt[Y]}setMiterLimit(Y){this.current.miterLimit=Y}setStrokeAlpha(Y){this.current.strokeAlpha=Y}setStrokeRGBColor(Y,Q,St){this.current.strokeColor=U.Util.makeHexColor(Y,Q,St)}setFillAlpha(Y){this.current.fillAlpha=Y}setFillRGBColor(Y,Q,St){this.current.fillColor=U.Util.makeHexColor(Y,Q,St),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(Y){this.current.strokeColor=this._makeColorN_Pattern(Y)}setFillColorN(Y){this.current.fillColor=this._makeColorN_Pattern(Y)}shadingFill(Y){const{width:Q,height:St}=this.viewport,rt=U.Util.inverseTransform(this.transformMatrix),[X,bt,at,kt]=U.Util.getAxialAlignedBoundingBox([0,0,Q,St],rt),Ot=this.svgFactory.createElement("svg:rect");Ot.setAttributeNS(null,"x",X),Ot.setAttributeNS(null,"y",bt),Ot.setAttributeNS(null,"width",at-X),Ot.setAttributeNS(null,"height",kt-bt),Ot.setAttributeNS(null,"fill",this._makeShadingPattern(Y)),this.current.fillAlpha<1&&Ot.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(Ot)}_makeColorN_Pattern(Y){return Y[0]==="TilingPattern"?this._makeTilingPattern(Y):this._makeShadingPattern(Y)}_makeTilingPattern(Y){const Q=Y[1],St=Y[2],rt=Y[3]||U.IDENTITY_MATRIX,[X,bt,at,kt]=Y[4],Ot=Y[5],ft=Y[6],It=Y[7],qt=`shading${mt++}`,[Vt,Rt,Kt,ee]=U.Util.normalizeRect([...U.Util.applyTransform([X,bt],rt),...U.Util.applyTransform([at,kt],rt)]),[he,fe]=U.Util.singularValueDecompose2dScale(rt),pt=Ot*he,z=ft*fe,q=this.svgFactory.createElement("svg:pattern");q.setAttributeNS(null,"id",qt),q.setAttributeNS(null,"patternUnits","userSpaceOnUse"),q.setAttributeNS(null,"width",pt),q.setAttributeNS(null,"height",z),q.setAttributeNS(null,"x",`${Vt}`),q.setAttributeNS(null,"y",`${Rt}`);const G=this.svg,J=this.transformMatrix,tt=this.current.fillColor,ot=this.current.strokeColor,wt=this.svgFactory.create(Kt-Vt,ee-Rt);if(this.svg=wt,this.transformMatrix=rt,It===2){const Tt=U.Util.makeHexColor(...Q);this.current.fillColor=Tt,this.current.strokeColor=Tt}return this.executeOpTree(this.convertOpList(St)),this.svg=G,this.transformMatrix=J,this.current.fillColor=tt,this.current.strokeColor=ot,q.append(wt.childNodes[0]),this.defs.append(q),`url(#${qt})`}_makeShadingPattern(Y){switch(typeof Y=="string"&&(Y=this.objs.get(Y)),Y[0]){case"RadialAxial":const Q=`shading${mt++}`,St=Y[3];let rt;switch(Y[1]){case"axial":const X=Y[4],bt=Y[5];rt=this.svgFactory.createElement("svg:linearGradient"),rt.setAttributeNS(null,"id",Q),rt.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),rt.setAttributeNS(null,"x1",X[0]),rt.setAttributeNS(null,"y1",X[1]),rt.setAttributeNS(null,"x2",bt[0]),rt.setAttributeNS(null,"y2",bt[1]);break;case"radial":const at=Y[4],kt=Y[5],Ot=Y[6],ft=Y[7];rt=this.svgFactory.createElement("svg:radialGradient"),rt.setAttributeNS(null,"id",Q),rt.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),rt.setAttributeNS(null,"cx",kt[0]),rt.setAttributeNS(null,"cy",kt[1]),rt.setAttributeNS(null,"r",ft),rt.setAttributeNS(null,"fx",at[0]),rt.setAttributeNS(null,"fy",at[1]),rt.setAttributeNS(null,"fr",Ot);break;default:throw new Error(`Unknown RadialAxial type: ${Y[1]}`)}for(const X of St){const bt=this.svgFactory.createElement("svg:stop");bt.setAttributeNS(null,"offset",X[0]),bt.setAttributeNS(null,"stop-color",X[1]),rt.append(bt)}return this.defs.append(rt),`url(#${Q})`;case"Mesh":return(0,U.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${Y[0]}`)}}setDash(Y,Q){this.current.dashArray=Y,this.current.dashPhase=Q}constructPath(Y,Q){const St=this.current;let rt=St.x,X=St.y,bt=[],at=0;for(const kt of Y)switch(kt|0){case U.OPS.rectangle:rt=Q[at++],X=Q[at++];const Ot=Q[at++],ft=Q[at++],It=rt+Ot,qt=X+ft;bt.push("M",ht(rt),ht(X),"L",ht(It),ht(X),"L",ht(It),ht(qt),"L",ht(rt),ht(qt),"Z");break;case U.OPS.moveTo:rt=Q[at++],X=Q[at++],bt.push("M",ht(rt),ht(X));break;case U.OPS.lineTo:rt=Q[at++],X=Q[at++],bt.push("L",ht(rt),ht(X));break;case U.OPS.curveTo:rt=Q[at+4],X=Q[at+5],bt.push("C",ht(Q[at]),ht(Q[at+1]),ht(Q[at+2]),ht(Q[at+3]),ht(rt),ht(X)),at+=6;break;case U.OPS.curveTo2:bt.push("C",ht(rt),ht(X),ht(Q[at]),ht(Q[at+1]),ht(Q[at+2]),ht(Q[at+3])),rt=Q[at+2],X=Q[at+3],at+=4;break;case U.OPS.curveTo3:rt=Q[at+2],X=Q[at+3],bt.push("C",ht(Q[at]),ht(Q[at+1]),ht(rt),ht(X),ht(rt),ht(X)),at+=4;break;case U.OPS.closePath:bt.push("Z");break}bt=bt.join(" "),St.path&&Y.length>0&&Y[0]!==U.OPS.rectangle&&Y[0]!==U.OPS.moveTo?bt=St.path.getAttributeNS(null,"d")+bt:(St.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(St.path)),St.path.setAttributeNS(null,"d",bt),St.path.setAttributeNS(null,"fill","none"),St.element=St.path,St.setCurrentPoint(rt,X)}endPath(){const Y=this.current;if(Y.path=null,!this.pendingClip)return;if(!Y.element){this.pendingClip=null;return}const Q=`clippath${st++}`,St=this.svgFactory.createElement("svg:clipPath");St.setAttributeNS(null,"id",Q),St.setAttributeNS(null,"transform",ut(this.transformMatrix));const rt=Y.element.cloneNode(!0);if(this.pendingClip==="evenodd"?rt.setAttributeNS(null,"clip-rule","evenodd"):rt.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,St.append(rt),this.defs.append(St),Y.activeClipUrl){Y.clipGroup=null;for(const X of this.extraStack)X.clipGroup=null;St.setAttributeNS(null,"clip-path",Y.activeClipUrl)}Y.activeClipUrl=`url(#${Q})`,this.tgrp=null}clip(Y){this.pendingClip=Y}closePath(){const Y=this.current;if(Y.path){const Q=`${Y.path.getAttributeNS(null,"d")}Z`;Y.path.setAttributeNS(null,"d",Q)}}setLeading(Y){this.current.leading=-Y}setTextRise(Y){this.current.textRise=Y}setTextRenderingMode(Y){this.current.textRenderingMode=Y}setHScale(Y){this.current.textHScale=Y/100}setRenderingIntent(Y){}setFlatness(Y){}setGState(Y){for(const[Q,St]of Y)switch(Q){case"LW":this.setLineWidth(St);break;case"LC":this.setLineCap(St);break;case"LJ":this.setLineJoin(St);break;case"ML":this.setMiterLimit(St);break;case"D":this.setDash(St[0],St[1]);break;case"RI":this.setRenderingIntent(St);break;case"FL":this.setFlatness(St);break;case"Font":this.setFont(St);break;case"CA":this.setStrokeAlpha(St);break;case"ca":this.setFillAlpha(St);break;default:(0,U.warn)(`Unimplemented graphic state operator ${Q}`);break}}fill(){const Y=this.current;Y.element&&(Y.element.setAttributeNS(null,"fill",Y.fillColor),Y.element.setAttributeNS(null,"fill-opacity",Y.fillAlpha),this.endPath())}stroke(){const Y=this.current;Y.element&&(this._setStrokeAttributes(Y.element),Y.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(Y,Q=1){const St=this.current;let rt=St.dashArray;Q!==1&&rt.length>0&&(rt=rt.map(function(X){return Q*X})),Y.setAttributeNS(null,"stroke",St.strokeColor),Y.setAttributeNS(null,"stroke-opacity",St.strokeAlpha),Y.setAttributeNS(null,"stroke-miterlimit",ht(St.miterLimit)),Y.setAttributeNS(null,"stroke-linecap",St.lineCap),Y.setAttributeNS(null,"stroke-linejoin",St.lineJoin),Y.setAttributeNS(null,"stroke-width",ht(Q*St.lineWidth)+"px"),Y.setAttributeNS(null,"stroke-dasharray",rt.map(ht).join(" ")),Y.setAttributeNS(null,"stroke-dashoffset",ht(Q*St.dashPhase)+"px")}eoFill(){var Y;(Y=this.current.element)==null||Y.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var Y;(Y=this.current.element)==null||Y.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const Y=this.svgFactory.createElement("svg:rect");Y.setAttributeNS(null,"x","0"),Y.setAttributeNS(null,"y","0"),Y.setAttributeNS(null,"width","1px"),Y.setAttributeNS(null,"height","1px"),Y.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(Y)}paintImageXObject(Y){const Q=this.getObject(Y);if(!Q){(0,U.warn)(`Dependent image with object ID ${Y} is not ready yet`);return}this.paintInlineImageXObject(Q)}paintInlineImageXObject(Y,Q){const St=Y.width,rt=Y.height,X=vt(Y,this.forceDataSchema,!!Q),bt=this.svgFactory.createElement("svg:rect");bt.setAttributeNS(null,"x","0"),bt.setAttributeNS(null,"y","0"),bt.setAttributeNS(null,"width",ht(St)),bt.setAttributeNS(null,"height",ht(rt)),this.current.element=bt,this.clip("nonzero");const at=this.svgFactory.createElement("svg:image");at.setAttributeNS(zt,"xlink:href",X),at.setAttributeNS(null,"x","0"),at.setAttributeNS(null,"y",ht(-rt)),at.setAttributeNS(null,"width",ht(St)+"px"),at.setAttributeNS(null,"height",ht(rt)+"px"),at.setAttributeNS(null,"transform",`scale(${ht(1/St)} ${ht(-1/rt)})`),Q?Q.append(at):this._ensureTransformGroup().append(at)}paintImageMaskXObject(Y){const Q=this.getObject(Y.data,Y);if(Q.bitmap){(0,U.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const St=this.current,rt=Q.width,X=Q.height,bt=St.fillColor;St.maskId=`mask${lt++}`;const at=this.svgFactory.createElement("svg:mask");at.setAttributeNS(null,"id",St.maskId);const kt=this.svgFactory.createElement("svg:rect");kt.setAttributeNS(null,"x","0"),kt.setAttributeNS(null,"y","0"),kt.setAttributeNS(null,"width",ht(rt)),kt.setAttributeNS(null,"height",ht(X)),kt.setAttributeNS(null,"fill",bt),kt.setAttributeNS(null,"mask",`url(#${St.maskId})`),this.defs.append(at),this._ensureTransformGroup().append(kt),this.paintInlineImageXObject(Q,at)}paintFormXObjectBegin(Y,Q){if(Array.isArray(Y)&&Y.length===6&&this.transform(Y[0],Y[1],Y[2],Y[3],Y[4],Y[5]),Q){const St=Q[2]-Q[0],rt=Q[3]-Q[1],X=this.svgFactory.createElement("svg:rect");X.setAttributeNS(null,"x",Q[0]),X.setAttributeNS(null,"y",Q[1]),X.setAttributeNS(null,"width",ht(St)),X.setAttributeNS(null,"height",ht(rt)),this.current.element=X,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(Y){const Q=this.svgFactory.create(Y.width,Y.height),St=this.svgFactory.createElement("svg:defs");Q.append(St),this.defs=St;const rt=this.svgFactory.createElement("svg:g");return rt.setAttributeNS(null,"transform",ut(Y.transform)),Q.append(rt),this.svg=rt,Q}_ensureClipGroup(){if(!this.current.clipGroup){const Y=this.svgFactory.createElement("svg:g");Y.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(Y),this.current.clipGroup=Y}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",ut(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}F.SVGGraphics=_t},(K,F)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.XfaText=void 0;class B{static textContent(U){const ct=[],it={items:ct,styles:Object.create(null)};function zt(At){var vt;if(!At)return;let gt=null;const et=At.name;if(et==="#text")gt=At.value;else if(B.shouldBuildText(et))(vt=At==null?void 0:At.attributes)!=null&&vt.textContent?gt=At.attributes.textContent:At.value&&(gt=At.value);else return;if(gt!==null&&ct.push({str:gt}),!!At.children)for(const Pt of At.children)zt(Pt)}return zt(U),it}static shouldBuildText(U){return!(U==="textarea"||U==="input"||U==="option"||U==="select")}}F.XfaText=B},(K,F,B)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.TextLayerRenderTask=void 0,F.renderTextLayer=ut,F.updateTextLayer=st;var D=B(1),U=B(6);const ct=1e5,it=30,zt=.8,At=new Map;function gt(lt,mt){let _t;if(mt&&D.FeatureTest.isOffscreenCanvasSupported)_t=new OffscreenCanvas(lt,lt).getContext("2d",{alpha:!1});else{const dt=document.createElement("canvas");dt.width=dt.height=lt,_t=dt.getContext("2d",{alpha:!1})}return _t}function et(lt,mt){const _t=At.get(lt);if(_t)return _t;const dt=gt(it,mt);dt.font=`${it}px ${lt}`;const Y=dt.measureText("");let Q=Y.fontBoundingBoxAscent,St=Math.abs(Y.fontBoundingBoxDescent);if(Q){const X=Q/(Q+St);return At.set(lt,X),dt.canvas.width=dt.canvas.height=0,X}dt.strokeStyle="red",dt.clearRect(0,0,it,it),dt.strokeText("g",0,0);let rt=dt.getImageData(0,0,it,it).data;St=0;for(let X=rt.length-1-3;X>=0;X-=4)if(rt[X]>0){St=Math.ceil(X/4/it);break}dt.clearRect(0,0,it,it),dt.strokeText("A",0,it),rt=dt.getImageData(0,0,it,it).data,Q=0;for(let X=0,bt=rt.length;X<bt;X+=4)if(rt[X]>0){Q=it-Math.floor(X/4/it);break}if(dt.canvas.width=dt.canvas.height=0,Q){const X=Q/(Q+St);return At.set(lt,X),X}return At.set(lt,zt),zt}function vt(lt,mt,_t){const dt=document.createElement("span"),Y={angle:0,canvasWidth:0,hasText:mt.str!=="",hasEOL:mt.hasEOL,fontSize:0};lt._textDivs.push(dt);const Q=D.Util.transform(lt._transform,mt.transform);let St=Math.atan2(Q[1],Q[0]);const rt=_t[mt.fontName];rt.vertical&&(St+=Math.PI/2);const X=Math.hypot(Q[2],Q[3]),bt=X*et(rt.fontFamily,lt._isOffscreenCanvasSupported);let at,kt;St===0?(at=Q[4],kt=Q[5]-bt):(at=Q[4]+bt*Math.sin(St),kt=Q[5]-bt*Math.cos(St));const Ot="calc(var(--scale-factor)*",ft=dt.style;lt._container===lt._rootContainer?(ft.left=`${(100*at/lt._pageWidth).toFixed(2)}%`,ft.top=`${(100*kt/lt._pageHeight).toFixed(2)}%`):(ft.left=`${Ot}${at.toFixed(2)}px)`,ft.top=`${Ot}${kt.toFixed(2)}px)`),ft.fontSize=`${Ot}${X.toFixed(2)}px)`,ft.fontFamily=rt.fontFamily,Y.fontSize=X,dt.setAttribute("role","presentation"),dt.textContent=mt.str,dt.dir=mt.dir,lt._fontInspectorEnabled&&(dt.dataset.fontName=mt.fontName),St!==0&&(Y.angle=St*(180/Math.PI));let It=!1;if(mt.str.length>1)It=!0;else if(mt.str!==" "&&mt.transform[0]!==mt.transform[3]){const qt=Math.abs(mt.transform[0]),Vt=Math.abs(mt.transform[3]);qt!==Vt&&Math.max(qt,Vt)/Math.min(qt,Vt)>1.5&&(It=!0)}It&&(Y.canvasWidth=rt.vertical?mt.height:mt.width),lt._textDivProperties.set(dt,Y),lt._isReadableStream&&lt._layoutText(dt)}function Pt(lt){const{div:mt,scale:_t,properties:dt,ctx:Y,prevFontSize:Q,prevFontFamily:St}=lt,{style:rt}=mt;let X="";if(dt.canvasWidth!==0&&dt.hasText){const{fontFamily:bt}=rt,{canvasWidth:at,fontSize:kt}=dt;(Q!==kt||St!==bt)&&(Y.font=`${kt*_t}px ${bt}`,lt.prevFontSize=kt,lt.prevFontFamily=bt);const{width:Ot}=Y.measureText(mt.textContent);Ot>0&&(X=`scaleX(${at*_t/Ot})`)}dt.angle!==0&&(X=`rotate(${dt.angle}deg) ${X}`),X.length>0&&(rt.transform=X)}function yt(lt){if(lt._canceled)return;const mt=lt._textDivs,_t=lt._capability;if(mt.length>ct){_t.resolve();return}if(!lt._isReadableStream)for(const Y of mt)lt._layoutText(Y);_t.resolve()}class ht{constructor({textContentSource:mt,container:_t,viewport:dt,textDivs:Y,textDivProperties:Q,textContentItemsStr:St,isOffscreenCanvasSupported:rt}){var Ot;this._textContentSource=mt,this._isReadableStream=mt instanceof ReadableStream,this._container=this._rootContainer=_t,this._textDivs=Y||[],this._textContentItemsStr=St||[],this._isOffscreenCanvasSupported=rt,this._fontInspectorEnabled=!!((Ot=globalThis.FontInspector)!=null&&Ot.enabled),this._reader=null,this._textDivProperties=Q||new WeakMap,this._canceled=!1,this._capability=new D.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:dt.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:gt(0,rt)};const{pageWidth:X,pageHeight:bt,pageX:at,pageY:kt}=dt.rawDims;this._transform=[1,0,0,-1,-at,kt+bt],this._pageWidth=X,this._pageHeight=bt,(0,U.setLayerDimensions)(_t,dt),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new D.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new D.AbortException("TextLayer task cancelled."))}_processItems(mt,_t){for(const dt of mt){if(dt.str===void 0){if(dt.type==="beginMarkedContentProps"||dt.type==="beginMarkedContent"){const Y=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),dt.id!==null&&this._container.setAttribute("id",`${dt.id}`),Y.append(this._container)}else dt.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(dt.str),vt(this,dt,_t)}}_layoutText(mt){const _t=this._layoutTextParams.properties=this._textDivProperties.get(mt);if(this._layoutTextParams.div=mt,Pt(this._layoutTextParams),_t.hasText&&this._container.append(mt),_t.hasEOL){const dt=document.createElement("br");dt.setAttribute("role","presentation"),this._container.append(dt)}}_render(){const mt=new D.PromiseCapability;let _t=Object.create(null);if(this._isReadableStream){const dt=()=>{this._reader.read().then(({value:Y,done:Q})=>{if(Q){mt.resolve();return}Object.assign(_t,Y.styles),this._processItems(Y.items,_t),dt()},mt.reject)};this._reader=this._textContentSource.getReader(),dt()}else if(this._textContentSource){const{items:dt,styles:Y}=this._textContentSource;this._processItems(dt,Y),mt.resolve()}else throw new Error('No "textContentSource" parameter specified.');mt.promise.then(()=>{_t=null,yt(this)},this._capability.reject)}}F.TextLayerRenderTask=ht;function ut(lt){!lt.textContentSource&&(lt.textContent||lt.textContentStream)&&((0,U.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),lt.textContentSource=lt.textContent||lt.textContentStream);const{container:mt,viewport:_t}=lt,dt=getComputedStyle(mt),Y=dt.getPropertyValue("visibility"),Q=parseFloat(dt.getPropertyValue("--scale-factor"));Y==="visible"&&(!Q||Math.abs(Q-_t.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const St=new ht(lt);return St._render(),St}function st({container:lt,viewport:mt,textDivs:_t,textDivProperties:dt,isOffscreenCanvasSupported:Y,mustRotate:Q=!0,mustRescale:St=!0}){if(Q&&(0,U.setLayerDimensions)(lt,{rotation:mt.rotation}),St){const rt=gt(0,Y),bt={prevFontSize:null,prevFontFamily:null,div:null,scale:mt.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:rt};for(const at of _t)bt.properties=dt.get(at),bt.div=at,Pt(bt)}}},(K,F,B)=>{var et,vt,Pt,yt,ht,ut,st,lt,mt,_t,dt,Hi,Q,mi,rt,Wi,bt,zi;Object.defineProperty(F,"__esModule",{value:!0}),F.AnnotationEditorLayer=void 0;var D=B(1),U=B(4),ct=B(28),it=B(33),zt=B(6),At=B(34);const kt=class kt{constructor({uiManager:ft,pageIndex:It,div:qt,accessibilityManager:Vt,annotationLayer:Rt,viewport:Kt,l10n:ee}){xt(this,dt);xt(this,Q);xt(this,rt);xt(this,bt);xt(this,et,void 0);xt(this,vt,!1);xt(this,Pt,null);xt(this,yt,this.pointerup.bind(this));xt(this,ht,this.pointerdown.bind(this));xt(this,ut,new Map);xt(this,st,!1);xt(this,lt,!1);xt(this,mt,!1);xt(this,_t,void 0);const he=[ct.FreeTextEditor,it.InkEditor,At.StampEditor];if(!kt._initialized){kt._initialized=!0;for(const fe of he)fe.initialize(ee)}ft.registerEditorTypes(he),Ht(this,_t,ft),this.pageIndex=It,this.div=qt,Ht(this,et,Vt),Ht(this,Pt,Rt),this.viewport=Kt,O(this,_t).addLayer(this)}get isEmpty(){return O(this,ut).size===0}updateToolbar(ft){O(this,_t).updateToolbar(ft)}updateMode(ft=O(this,_t).getMode()){Ft(this,bt,zi).call(this),ft===D.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),ft!==D.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",ft===D.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",ft===D.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",ft===D.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(ft){if(!ft&&O(this,_t).getMode()!==D.AnnotationEditorType.INK)return;if(!ft){for(const qt of O(this,ut).values())if(qt.isEmpty()){qt.setInBackground();return}}Ft(this,Q,mi).call(this,{offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(ft){O(this,_t).setEditingState(ft)}addCommands(ft){O(this,_t).addCommands(ft)}enable(){this.div.style.pointerEvents="auto";const ft=new Set;for(const qt of O(this,ut).values())qt.enableEditing(),qt.annotationElementId&&ft.add(qt.annotationElementId);if(!O(this,Pt))return;const It=O(this,Pt).getEditableAnnotations();for(const qt of It){if(qt.hide(),O(this,_t).isDeletedAnnotationElement(qt.data.id)||ft.has(qt.data.id))continue;const Vt=this.deserialize(qt);Vt&&(this.addOrRebuild(Vt),Vt.enableEditing())}}disable(){var It;Ht(this,mt,!0),this.div.style.pointerEvents="none";const ft=new Set;for(const qt of O(this,ut).values()){if(qt.disableEditing(),!qt.annotationElementId||qt.serialize()!==null){ft.add(qt.annotationElementId);continue}(It=this.getEditableAnnotation(qt.annotationElementId))==null||It.show(),qt.remove()}if(O(this,Pt)){const qt=O(this,Pt).getEditableAnnotations();for(const Vt of qt){const{id:Rt}=Vt.data;ft.has(Rt)||O(this,_t).isDeletedAnnotationElement(Rt)||Vt.show()}}Ft(this,bt,zi).call(this),this.isEmpty&&(this.div.hidden=!0),Ht(this,mt,!1)}getEditableAnnotation(ft){var It;return((It=O(this,Pt))==null?void 0:It.getEditableAnnotation(ft))||null}setActiveEditor(ft){O(this,_t).getActive()!==ft&&O(this,_t).setActiveEditor(ft)}enableClick(){this.div.addEventListener("pointerdown",O(this,ht)),this.div.addEventListener("pointerup",O(this,yt))}disableClick(){this.div.removeEventListener("pointerdown",O(this,ht)),this.div.removeEventListener("pointerup",O(this,yt))}attach(ft){O(this,ut).set(ft.id,ft);const{annotationElementId:It}=ft;It&&O(this,_t).isDeletedAnnotationElement(It)&&O(this,_t).removeDeletedAnnotationElement(ft)}detach(ft){var It;O(this,ut).delete(ft.id),(It=O(this,et))==null||It.removePointerInTextLayer(ft.contentDiv),!O(this,mt)&&ft.annotationElementId&&O(this,_t).addDeletedAnnotationElement(ft)}remove(ft){this.detach(ft),O(this,_t).removeEditor(ft),ft.div.contains(document.activeElement)&&setTimeout(()=>{O(this,_t).focusMainContainer()},0),ft.div.remove(),ft.isAttachedToDOM=!1,O(this,lt)||this.addInkEditorIfNeeded(!1)}changeParent(ft){var It;ft.parent!==this&&(ft.annotationElementId&&(O(this,_t).addDeletedAnnotationElement(ft.annotationElementId),U.AnnotationEditor.deleteAnnotationElement(ft),ft.annotationElementId=null),this.attach(ft),(It=ft.parent)==null||It.detach(ft),ft.setParent(this),ft.div&&ft.isAttachedToDOM&&(ft.div.remove(),this.div.append(ft.div)))}add(ft){if(this.changeParent(ft),O(this,_t).addEditor(ft),this.attach(ft),!ft.isAttachedToDOM){const It=ft.render();this.div.append(It),ft.isAttachedToDOM=!0}ft.fixAndSetPosition(),ft.onceAdded(),O(this,_t).addToAnnotationStorage(ft)}moveEditorInDOM(ft){var qt;if(!ft.isAttachedToDOM)return;const{activeElement:It}=document;ft.div.contains(It)&&(ft._focusEventsAllowed=!1,setTimeout(()=>{ft.div.contains(document.activeElement)?ft._focusEventsAllowed=!0:(ft.div.addEventListener("focusin",()=>{ft._focusEventsAllowed=!0},{once:!0}),It.focus())},0)),ft._structTreeParentId=(qt=O(this,et))==null?void 0:qt.moveElementInDOM(this.div,ft.div,ft.contentDiv,!0)}addOrRebuild(ft){ft.needsToBeRebuilt()?ft.rebuild():this.add(ft)}addUndoableEditor(ft){const It=()=>ft._uiManager.rebuild(ft),qt=()=>{ft.remove()};this.addCommands({cmd:It,undo:qt,mustExec:!1})}getNextId(){return O(this,_t).getId()}pasteEditor(ft,It){O(this,_t).updateToolbar(ft),O(this,_t).updateMode(ft);const{offsetX:qt,offsetY:Vt}=Ft(this,rt,Wi).call(this),Rt=this.getNextId(),Kt=Ft(this,dt,Hi).call(this,{parent:this,id:Rt,x:qt,y:Vt,uiManager:O(this,_t),isCentered:!0,...It});Kt&&this.add(Kt)}deserialize(ft){switch(ft.annotationType??ft.annotationEditorType){case D.AnnotationEditorType.FREETEXT:return ct.FreeTextEditor.deserialize(ft,this,O(this,_t));case D.AnnotationEditorType.INK:return it.InkEditor.deserialize(ft,this,O(this,_t));case D.AnnotationEditorType.STAMP:return At.StampEditor.deserialize(ft,this,O(this,_t))}return null}addNewEditor(){Ft(this,Q,mi).call(this,Ft(this,rt,Wi).call(this),!0)}setSelected(ft){O(this,_t).setSelected(ft)}toggleSelected(ft){O(this,_t).toggleSelected(ft)}isSelected(ft){return O(this,_t).isSelected(ft)}unselect(ft){O(this,_t).unselect(ft)}pointerup(ft){const{isMac:It}=D.FeatureTest.platform;if(!(ft.button!==0||ft.ctrlKey&&It)&&ft.target===this.div&&O(this,st)){if(Ht(this,st,!1),!O(this,vt)){Ht(this,vt,!0);return}if(O(this,_t).getMode()===D.AnnotationEditorType.STAMP){O(this,_t).unselectAll();return}Ft(this,Q,mi).call(this,ft,!1)}}pointerdown(ft){if(O(this,st)){Ht(this,st,!1);return}const{isMac:It}=D.FeatureTest.platform;if(ft.button!==0||ft.ctrlKey&&It||ft.target!==this.div)return;Ht(this,st,!0);const qt=O(this,_t).getActive();Ht(this,vt,!qt||qt.isEmpty())}findNewParent(ft,It,qt){const Vt=O(this,_t).findParent(It,qt);return Vt===null||Vt===this?!1:(Vt.changeParent(ft),!0)}destroy(){var ft,It;((ft=O(this,_t).getActive())==null?void 0:ft.parent)===this&&(O(this,_t).commitOrRemove(),O(this,_t).setActiveEditor(null));for(const qt of O(this,ut).values())(It=O(this,et))==null||It.removePointerInTextLayer(qt.contentDiv),qt.setParent(null),qt.isAttachedToDOM=!1,qt.div.remove();this.div=null,O(this,ut).clear(),O(this,_t).removeLayer(this)}render({viewport:ft}){this.viewport=ft,(0,zt.setLayerDimensions)(this.div,ft);for(const It of O(this,_t).getEditors(this.pageIndex))this.add(It);this.updateMode()}update({viewport:ft}){O(this,_t).commitOrRemove(),this.viewport=ft,(0,zt.setLayerDimensions)(this.div,{rotation:ft.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:ft,pageHeight:It}=this.viewport.rawDims;return[ft,It]}};et=new WeakMap,vt=new WeakMap,Pt=new WeakMap,yt=new WeakMap,ht=new WeakMap,ut=new WeakMap,st=new WeakMap,lt=new WeakMap,mt=new WeakMap,_t=new WeakMap,dt=new WeakSet,Hi=function(ft){switch(O(this,_t).getMode()){case D.AnnotationEditorType.FREETEXT:return new ct.FreeTextEditor(ft);case D.AnnotationEditorType.INK:return new it.InkEditor(ft);case D.AnnotationEditorType.STAMP:return new At.StampEditor(ft)}return null},Q=new WeakSet,mi=function(ft,It){const qt=this.getNextId(),Vt=Ft(this,dt,Hi).call(this,{parent:this,id:qt,x:ft.offsetX,y:ft.offsetY,uiManager:O(this,_t),isCentered:It});return Vt&&this.add(Vt),Vt},rt=new WeakSet,Wi=function(){const{x:ft,y:It,width:qt,height:Vt}=this.div.getBoundingClientRect(),Rt=Math.max(0,ft),Kt=Math.max(0,It),ee=Math.min(window.innerWidth,ft+qt),he=Math.min(window.innerHeight,It+Vt),fe=(Rt+ee)/2-ft,pt=(Kt+he)/2-It,[z,q]=this.viewport.rotation%180===0?[fe,pt]:[pt,fe];return{offsetX:z,offsetY:q}},bt=new WeakSet,zi=function(){Ht(this,lt,!0);for(const ft of O(this,ut).values())ft.isEmpty()&&ft.remove();Ht(this,lt,!1)},je(kt,"_initialized",!1);let gt=kt;F.AnnotationEditorLayer=gt},(K,F,B)=>{var At,gt,et,vt,Pt,yt,ht,ut,st,lt,As,_t,ys,Y,vs,St,ai,X,Gi,at,Ss,Ot,qi;Object.defineProperty(F,"__esModule",{value:!0}),F.FreeTextEditor=void 0;var D=B(1),U=B(5),ct=B(4),it=B(29);const It=class It extends ct.AnnotationEditor{constructor(Rt){super({...Rt,name:"freeTextEditor"});xt(this,lt);xt(this,_t);xt(this,Y);xt(this,St);xt(this,X);xt(this,at);xt(this,Ot);xt(this,At,this.editorDivBlur.bind(this));xt(this,gt,this.editorDivFocus.bind(this));xt(this,et,this.editorDivInput.bind(this));xt(this,vt,this.editorDivKeydown.bind(this));xt(this,Pt,void 0);xt(this,yt,"");xt(this,ht,`${this.id}-editor`);xt(this,ut,void 0);xt(this,st,null);Ht(this,Pt,Rt.color||It._defaultColor||ct.AnnotationEditor._defaultLineColor),Ht(this,ut,Rt.fontSize||It._defaultFontSize)}static get _keyboardManager(){const Rt=It.prototype,Kt=fe=>fe.isEmpty(),ee=U.AnnotationEditorUIManager.TRANSLATE_SMALL,he=U.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,D.shadow)(this,"_keyboardManager",new U.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],Rt.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],Rt.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],Rt._translateEmpty,{args:[-ee,0],checker:Kt}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],Rt._translateEmpty,{args:[-he,0],checker:Kt}],[["ArrowRight","mac+ArrowRight"],Rt._translateEmpty,{args:[ee,0],checker:Kt}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],Rt._translateEmpty,{args:[he,0],checker:Kt}],[["ArrowUp","mac+ArrowUp"],Rt._translateEmpty,{args:[0,-ee],checker:Kt}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],Rt._translateEmpty,{args:[0,-he],checker:Kt}],[["ArrowDown","mac+ArrowDown"],Rt._translateEmpty,{args:[0,ee],checker:Kt}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],Rt._translateEmpty,{args:[0,he],checker:Kt}]]))}static initialize(Rt){ct.AnnotationEditor.initialize(Rt,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const Kt=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(Kt.getPropertyValue("--freetext-padding"))}static updateDefaultParams(Rt,Kt){switch(Rt){case D.AnnotationEditorParamsType.FREETEXT_SIZE:It._defaultFontSize=Kt;break;case D.AnnotationEditorParamsType.FREETEXT_COLOR:It._defaultColor=Kt;break}}updateParams(Rt,Kt){switch(Rt){case D.AnnotationEditorParamsType.FREETEXT_SIZE:Ft(this,lt,As).call(this,Kt);break;case D.AnnotationEditorParamsType.FREETEXT_COLOR:Ft(this,_t,ys).call(this,Kt);break}}static get defaultPropertiesToUpdate(){return[[D.AnnotationEditorParamsType.FREETEXT_SIZE,It._defaultFontSize],[D.AnnotationEditorParamsType.FREETEXT_COLOR,It._defaultColor||ct.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[D.AnnotationEditorParamsType.FREETEXT_SIZE,O(this,ut)],[D.AnnotationEditorParamsType.FREETEXT_COLOR,O(this,Pt)]]}_translateEmpty(Rt,Kt){this._uiManager.translateSelectedEditors(Rt,Kt,!0)}getInitialTranslation(){const Rt=this.parentScale;return[-It._internalPadding*Rt,-(It._internalPadding+O(this,ut))*Rt]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(D.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",O(this,vt)),this.editorDiv.addEventListener("focus",O(this,gt)),this.editorDiv.addEventListener("blur",O(this,At)),this.editorDiv.addEventListener("input",O(this,et)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",O(this,ht)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",O(this,vt)),this.editorDiv.removeEventListener("focus",O(this,gt)),this.editorDiv.removeEventListener("blur",O(this,At)),this.editorDiv.removeEventListener("input",O(this,et)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(Rt){this._focusEventsAllowed&&(super.focusin(Rt),Rt.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var Rt;if(this.width){Ft(this,Ot,qi).call(this);return}this.enableEditMode(),this.editorDiv.focus(),(Rt=this._initialOptions)!=null&&Rt.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const Rt=O(this,yt),Kt=Ht(this,yt,Ft(this,Y,vs).call(this).trimEnd());if(Rt===Kt)return;const ee=he=>{if(Ht(this,yt,he),!he){this.remove();return}Ft(this,X,Gi).call(this),this._uiManager.rebuild(this),Ft(this,St,ai).call(this)};this.addCommands({cmd:()=>{ee(Kt)},undo:()=>{ee(Rt)},mustExec:!1}),Ft(this,St,ai).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(Rt){this.enterInEditMode()}keydown(Rt){Rt.target===this.div&&Rt.key==="Enter"&&(this.enterInEditMode(),Rt.preventDefault())}editorDivKeydown(Rt){It._keyboardManager.exec(this,Rt)}editorDivFocus(Rt){this.isEditing=!0}editorDivBlur(Rt){this.isEditing=!1}editorDivInput(Rt){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let Rt,Kt;this.width&&(Rt=this.x,Kt=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",O(this,ht)),this.enableEditing(),ct.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(he=>{var fe;return(fe=this.editorDiv)==null?void 0:fe.setAttribute("aria-label",he)}),ct.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(he=>{var fe;return(fe=this.editorDiv)==null?void 0:fe.setAttribute("default-content",he)}),this.editorDiv.contentEditable=!0;const{style:ee}=this.editorDiv;if(ee.fontSize=`calc(${O(this,ut)}px * var(--scale-factor))`,ee.color=O(this,Pt),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,U.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[he,fe]=this.parentDimensions;if(this.annotationElementId){const{position:pt}=O(this,st);let[z,q]=this.getInitialTranslation();[z,q]=this.pageTranslationToScreen(z,q);const[G,J]=this.pageDimensions,[tt,ot]=this.pageTranslation;let wt,Tt;switch(this.rotation){case 0:wt=Rt+(pt[0]-tt)/G,Tt=Kt+this.height-(pt[1]-ot)/J;break;case 90:wt=Rt+(pt[0]-tt)/G,Tt=Kt-(pt[1]-ot)/J,[z,q]=[q,-z];break;case 180:wt=Rt-this.width+(pt[0]-tt)/G,Tt=Kt-(pt[1]-ot)/J,[z,q]=[-z,-q];break;case 270:wt=Rt+(pt[0]-tt-this.height*J)/G,Tt=Kt+(pt[1]-ot-this.width*G)/J,[z,q]=[-q,z];break}this.setAt(wt*he,Tt*fe,z,q)}else this.setAt(Rt*he,Kt*fe,this.width*he,this.height*fe);Ft(this,X,Gi).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(Rt,Kt,ee){let he=null;if(Rt instanceof it.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:pt,fontColor:z},rect:q,rotation:G,id:J},textContent:tt,textPosition:ot,parent:{page:{pageNumber:wt}}}=Rt;if(!tt||tt.length===0)return null;he=Rt={annotationType:D.AnnotationEditorType.FREETEXT,color:Array.from(z),fontSize:pt,value:tt.join(`
`),position:ot,pageIndex:wt-1,rect:q,rotation:G,id:J,deleted:!1}}const fe=super.deserialize(Rt,Kt,ee);return Ht(fe,ut,Rt.fontSize),Ht(fe,Pt,D.Util.makeHexColor(...Rt.color)),Ht(fe,yt,Rt.value),fe.annotationElementId=Rt.id||null,Ht(fe,st,he),fe}serialize(Rt=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const Kt=It._internalPadding*this.parentScale,ee=this.getRect(Kt,Kt),he=ct.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:O(this,Pt)),fe={annotationType:D.AnnotationEditorType.FREETEXT,color:he,fontSize:O(this,ut),value:O(this,yt),pageIndex:this.pageIndex,rect:ee,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return Rt?fe:this.annotationElementId&&!Ft(this,at,Ss).call(this,fe)?null:(fe.id=this.annotationElementId,fe)}};At=new WeakMap,gt=new WeakMap,et=new WeakMap,vt=new WeakMap,Pt=new WeakMap,yt=new WeakMap,ht=new WeakMap,ut=new WeakMap,st=new WeakMap,lt=new WeakSet,As=function(Rt){const Kt=he=>{this.editorDiv.style.fontSize=`calc(${he}px * var(--scale-factor))`,this.translate(0,-(he-O(this,ut))*this.parentScale),Ht(this,ut,he),Ft(this,St,ai).call(this)},ee=O(this,ut);this.addCommands({cmd:()=>{Kt(Rt)},undo:()=>{Kt(ee)},mustExec:!0,type:D.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},_t=new WeakSet,ys=function(Rt){const Kt=O(this,Pt);this.addCommands({cmd:()=>{Ht(this,Pt,this.editorDiv.style.color=Rt)},undo:()=>{Ht(this,Pt,this.editorDiv.style.color=Kt)},mustExec:!0,type:D.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Y=new WeakSet,vs=function(){const Rt=this.editorDiv.getElementsByTagName("div");if(Rt.length===0)return this.editorDiv.innerText;const Kt=[];for(const ee of Rt)Kt.push(ee.innerText.replace(/\r\n?|\n/,""));return Kt.join(`
`)},St=new WeakSet,ai=function(){const[Rt,Kt]=this.parentDimensions;let ee;if(this.isAttachedToDOM)ee=this.div.getBoundingClientRect();else{const{currentLayer:he,div:fe}=this,pt=fe.style.display;fe.style.display="hidden",he.div.append(this.div),ee=fe.getBoundingClientRect(),fe.remove(),fe.style.display=pt}this.rotation%180===this.parentRotation%180?(this.width=ee.width/Rt,this.height=ee.height/Kt):(this.width=ee.height/Rt,this.height=ee.width/Kt),this.fixAndSetPosition()},X=new WeakSet,Gi=function(){if(this.editorDiv.replaceChildren(),!!O(this,yt))for(const Rt of O(this,yt).split(`
`)){const Kt=document.createElement("div");Kt.append(Rt?document.createTextNode(Rt):document.createElement("br")),this.editorDiv.append(Kt)}},at=new WeakSet,Ss=function(Rt){const{value:Kt,fontSize:ee,color:he,rect:fe,pageIndex:pt}=O(this,st);return Rt.value!==Kt||Rt.fontSize!==ee||Rt.rect.some((z,q)=>Math.abs(z-fe[q])>=1)||Rt.color.some((z,q)=>z!==he[q])||Rt.pageIndex!==pt},Ot=new WeakSet,qi=function(Rt=!1){if(!this.annotationElementId)return;if(Ft(this,St,ai).call(this),!Rt&&(this.width===0||this.height===0)){setTimeout(()=>Ft(this,Ot,qi).call(this,!0),0);return}const Kt=It._internalPadding*this.parentScale;O(this,st).rect=this.getRect(Kt,Kt)},je(It,"_freeTextDefaultContent",""),je(It,"_internalPadding",0),je(It,"_defaultColor",null),je(It,"_defaultFontSize",10),je(It,"_type","freetext");let zt=It;F.FreeTextEditor=zt},(K,F,B)=>{var q,J,Ye,ot,ws,Tt,Wt,jt,Xt,Jt,ae,Zt,me,Ee,le,Ae,te,Ut,Bt,Qt,ce,de,xe,Es,Pe,_i,Fe,Xi,Oe,Vi,Nt,Dt,se,re,Be,Ue,$t,Yi,ve,ue,Se,we,Cs,ne,Ki;Object.defineProperty(F,"__esModule",{value:!0}),F.StampAnnotationElement=F.InkAnnotationElement=F.FreeTextAnnotationElement=F.AnnotationLayer=void 0;var D=B(1),U=B(6),ct=B(3),it=B(30),zt=B(31),At=B(32);const gt=1e3,et=9,vt=new WeakSet;function Pt(ye){return{width:ye[2]-ye[0],height:ye[3]-ye[1]}}class yt{static create(Et){switch(Et.data.annotationType){case D.AnnotationType.LINK:return new ut(Et);case D.AnnotationType.TEXT:return new st(Et);case D.AnnotationType.WIDGET:switch(Et.data.fieldType){case"Tx":return new mt(Et);case"Btn":return Et.data.radioButton?new Y(Et):Et.data.checkBox?new dt(Et):new Q(Et);case"Ch":return new St(Et);case"Sig":return new _t(Et)}return new lt(Et);case D.AnnotationType.POPUP:return new rt(Et);case D.AnnotationType.FREETEXT:return new bt(Et);case D.AnnotationType.LINE:return new at(Et);case D.AnnotationType.SQUARE:return new kt(Et);case D.AnnotationType.CIRCLE:return new Ot(Et);case D.AnnotationType.POLYLINE:return new ft(Et);case D.AnnotationType.CARET:return new qt(Et);case D.AnnotationType.INK:return new Vt(Et);case D.AnnotationType.POLYGON:return new It(Et);case D.AnnotationType.HIGHLIGHT:return new Rt(Et);case D.AnnotationType.UNDERLINE:return new Kt(Et);case D.AnnotationType.SQUIGGLY:return new ee(Et);case D.AnnotationType.STRIKEOUT:return new he(Et);case D.AnnotationType.STAMP:return new fe(Et);case D.AnnotationType.FILEATTACHMENT:return new pt(Et);default:return new ht(Et)}}}const G=class G{constructor(Et,{isRenderable:W=!1,ignoreBorder:nt=!1,createQuadrilaterals:Ct=!1}={}){xt(this,q,!1);this.isRenderable=W,this.data=Et.data,this.layer=Et.layer,this.linkService=Et.linkService,this.downloadManager=Et.downloadManager,this.imageResourcesPath=Et.imageResourcesPath,this.renderForms=Et.renderForms,this.svgFactory=Et.svgFactory,this.annotationStorage=Et.annotationStorage,this.enableScripting=Et.enableScripting,this.hasJSActions=Et.hasJSActions,this._fieldObjects=Et.fieldObjects,this.parent=Et.parent,W&&(this.container=this._createContainer(nt)),Ct&&this._createQuadrilaterals()}static _hasPopupData({titleObj:Et,contentsObj:W,richText:nt}){return!!(Et!=null&&Et.str||W!=null&&W.str||nt!=null&&nt.str)}get hasPopupData(){return G._hasPopupData(this.data)}_createContainer(Et){const{data:W,parent:{page:nt,viewport:Ct}}=this,Mt=document.createElement("section");Mt.setAttribute("data-annotation-id",W.id),this instanceof lt||(Mt.tabIndex=gt),Mt.style.zIndex=this.parent.zIndex++,this.data.popupRef&&Mt.setAttribute("aria-haspopup","dialog"),W.noRotate&&Mt.classList.add("norotate");const{pageWidth:Lt,pageHeight:Gt,pageX:ie,pageY:ge}=Ct.rawDims;if(!W.rect||this instanceof rt){const{rotation:Ce}=W;return!W.hasOwnCanvas&&Ce!==0&&this.setRotation(Ce,Mt),Mt}const{width:pe,height:Me}=Pt(W.rect),_e=D.Util.normalizeRect([W.rect[0],nt.view[3]-W.rect[1]+nt.view[1],W.rect[2],nt.view[3]-W.rect[3]+nt.view[1]]);if(!Et&&W.borderStyle.width>0){Mt.style.borderWidth=`${W.borderStyle.width}px`;const Ce=W.borderStyle.horizontalCornerRadius,De=W.borderStyle.verticalCornerRadius;if(Ce>0||De>0){const Ne=`calc(${Ce}px * var(--scale-factor)) / calc(${De}px * var(--scale-factor))`;Mt.style.borderRadius=Ne}else if(this instanceof Y){const Ne=`calc(${pe}px * var(--scale-factor)) / calc(${Me}px * var(--scale-factor))`;Mt.style.borderRadius=Ne}switch(W.borderStyle.style){case D.AnnotationBorderStyleType.SOLID:Mt.style.borderStyle="solid";break;case D.AnnotationBorderStyleType.DASHED:Mt.style.borderStyle="dashed";break;case D.AnnotationBorderStyleType.BEVELED:(0,D.warn)("Unimplemented border style: beveled");break;case D.AnnotationBorderStyleType.INSET:(0,D.warn)("Unimplemented border style: inset");break;case D.AnnotationBorderStyleType.UNDERLINE:Mt.style.borderBottomStyle="solid";break}const Le=W.borderColor||null;Le?(Ht(this,q,!0),Mt.style.borderColor=D.Util.makeHexColor(Le[0]|0,Le[1]|0,Le[2]|0)):Mt.style.borderWidth=0}Mt.style.left=`${100*(_e[0]-ie)/Lt}%`,Mt.style.top=`${100*(_e[1]-ge)/Gt}%`;const{rotation:be}=W;return W.hasOwnCanvas||be===0?(Mt.style.width=`${100*pe/Lt}%`,Mt.style.height=`${100*Me/Gt}%`):this.setRotation(be,Mt),Mt}setRotation(Et,W=this.container){if(!this.data.rect)return;const{pageWidth:nt,pageHeight:Ct}=this.parent.viewport.rawDims,{width:Mt,height:Lt}=Pt(this.data.rect);let Gt,ie;Et%180===0?(Gt=100*Mt/nt,ie=100*Lt/Ct):(Gt=100*Lt/nt,ie=100*Mt/Ct),W.style.width=`${Gt}%`,W.style.height=`${ie}%`,W.setAttribute("data-main-rotation",(360-Et)%360)}get _commonActions(){const Et=(W,nt,Ct)=>{const Mt=Ct.detail[W],Lt=Mt[0],Gt=Mt.slice(1);Ct.target.style[nt]=it.ColorConverters[`${Lt}_HTML`](Gt),this.annotationStorage.setValue(this.data.id,{[nt]:it.ColorConverters[`${Lt}_rgb`](Gt)})};return(0,D.shadow)(this,"_commonActions",{display:W=>{const{display:nt}=W.detail,Ct=nt%2===1;this.container.style.visibility=Ct?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:Ct,noPrint:nt===1||nt===2})},print:W=>{this.annotationStorage.setValue(this.data.id,{noPrint:!W.detail.print})},hidden:W=>{const{hidden:nt}=W.detail;this.container.style.visibility=nt?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:nt,noView:nt})},focus:W=>{setTimeout(()=>W.target.focus({preventScroll:!1}),0)},userName:W=>{W.target.title=W.detail.userName},readonly:W=>{W.target.disabled=W.detail.readonly},required:W=>{this._setRequired(W.target,W.detail.required)},bgColor:W=>{Et("bgColor","backgroundColor",W)},fillColor:W=>{Et("fillColor","backgroundColor",W)},fgColor:W=>{Et("fgColor","color",W)},textColor:W=>{Et("textColor","color",W)},borderColor:W=>{Et("borderColor","borderColor",W)},strokeColor:W=>{Et("strokeColor","borderColor",W)},rotation:W=>{const nt=W.detail.rotation;this.setRotation(nt),this.annotationStorage.setValue(this.data.id,{rotation:nt})}})}_dispatchEventFromSandbox(Et,W){const nt=this._commonActions;for(const Ct of Object.keys(W.detail)){const Mt=Et[Ct]||nt[Ct];Mt==null||Mt(W)}}_setDefaultPropertiesFromJS(Et){if(!this.enableScripting)return;const W=this.annotationStorage.getRawValue(this.data.id);if(!W)return;const nt=this._commonActions;for(const[Ct,Mt]of Object.entries(W)){const Lt=nt[Ct];if(Lt){const Gt={detail:{[Ct]:Mt},target:Et};Lt(Gt),delete W[Ct]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:Et}=this.data;if(!Et)return;const[W,nt,Ct,Mt]=this.data.rect;if(Et.length===1){const[,{x:De,y:Le},{x:Ne,y:We}]=Et[0];if(Ct===De&&Mt===Le&&W===Ne&&nt===We)return}const{style:Lt}=this.container;let Gt;if(O(this,q)){const{borderColor:De,borderWidth:Le}=Lt;Lt.borderWidth=0,Gt=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${De}" stroke-width="${Le}">`],this.container.classList.add("hasBorder")}const ie=Ct-W,ge=Mt-nt,{svgFactory:pe}=this,Me=pe.createElement("svg");Me.classList.add("quadrilateralsContainer"),Me.setAttribute("width",0),Me.setAttribute("height",0);const _e=pe.createElement("defs");Me.append(_e);const be=pe.createElement("clipPath"),Ce=`clippath_${this.data.id}`;be.setAttribute("id",Ce),be.setAttribute("clipPathUnits","objectBoundingBox"),_e.append(be);for(const[,{x:De,y:Le},{x:Ne,y:We}]of Et){const He=pe.createElement("rect"),ze=(Ne-W)/ie,Xe=(Mt-Le)/ge,Ve=(De-Ne)/ie,rs=(Le-We)/ge;He.setAttribute("x",ze),He.setAttribute("y",Xe),He.setAttribute("width",Ve),He.setAttribute("height",rs),be.append(He),Gt==null||Gt.push(`<rect vector-effect="non-scaling-stroke" x="${ze}" y="${Xe}" width="${Ve}" height="${rs}"/>`)}O(this,q)&&(Gt.push("</g></svg>')"),Lt.backgroundImage=Gt.join("")),this.container.append(Me),this.container.style.clipPath=`url(#${Ce})`}_createPopup(){const{container:Et,data:W}=this;Et.setAttribute("aria-haspopup","dialog");const nt=new rt({data:{color:W.color,titleObj:W.titleObj,modificationDate:W.modificationDate,contentsObj:W.contentsObj,richText:W.richText,parentRect:W.rect,borderStyle:0,id:`popup_${W.id}`,rotation:W.rotation},parent:this.parent,elements:[this]});this.parent.div.append(nt.render())}render(){(0,D.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(Et,W=null){const nt=[];if(this._fieldObjects){const Ct=this._fieldObjects[Et];if(Ct)for(const{page:Mt,id:Lt,exportValues:Gt}of Ct){if(Mt===-1||Lt===W)continue;const ie=typeof Gt=="string"?Gt:null,ge=document.querySelector(`[data-element-id="${Lt}"]`);if(ge&&!vt.has(ge)){(0,D.warn)(`_getElementsByName - element not allowed: ${Lt}`);continue}nt.push({id:Lt,exportValue:ie,domElement:ge})}return nt}for(const Ct of document.getElementsByName(Et)){const{exportValue:Mt}=Ct,Lt=Ct.getAttribute("data-element-id");Lt!==W&&vt.has(Ct)&&nt.push({id:Lt,exportValue:Mt,domElement:Ct})}return nt}show(){var Et;this.container&&(this.container.hidden=!1),(Et=this.popup)==null||Et.maybeShow()}hide(){var Et;this.container&&(this.container.hidden=!0),(Et=this.popup)==null||Et.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const Et=this.getElementsToTriggerPopup();if(Array.isArray(Et))for(const W of Et)W.classList.add("highlightArea");else Et.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:Et,data:{id:W}}=this;this.container.addEventListener("dblclick",()=>{var nt;(nt=this.linkService.eventBus)==null||nt.dispatch("switchannotationeditormode",{source:this,mode:Et,editId:W})})}};q=new WeakMap;let ht=G;class ut extends ht{constructor(W,nt=null){super(W,{isRenderable:!0,ignoreBorder:!!(nt!=null&&nt.ignoreBorder),createQuadrilaterals:!0});xt(this,J);xt(this,ot);this.isTooltipOnly=W.data.isTooltipOnly}render(){const{data:W,linkService:nt}=this,Ct=document.createElement("a");Ct.setAttribute("data-element-id",W.id);let Mt=!1;return W.url?(nt.addLinkAttributes(Ct,W.url,W.newWindow),Mt=!0):W.action?(this._bindNamedAction(Ct,W.action),Mt=!0):W.attachment?(this._bindAttachment(Ct,W.attachment),Mt=!0):W.setOCGState?(Ft(this,ot,ws).call(this,Ct,W.setOCGState),Mt=!0):W.dest?(this._bindLink(Ct,W.dest),Mt=!0):(W.actions&&(W.actions.Action||W.actions["Mouse Up"]||W.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(Ct,W),Mt=!0),W.resetForm?(this._bindResetFormAction(Ct,W.resetForm),Mt=!0):this.isTooltipOnly&&!Mt&&(this._bindLink(Ct,""),Mt=!0)),this.container.classList.add("linkAnnotation"),Mt&&this.container.append(Ct),this.container}_bindLink(W,nt){W.href=this.linkService.getDestinationHash(nt),W.onclick=()=>(nt&&this.linkService.goToDestination(nt),!1),(nt||nt==="")&&Ft(this,J,Ye).call(this)}_bindNamedAction(W,nt){W.href=this.linkService.getAnchorUrl(""),W.onclick=()=>(this.linkService.executeNamedAction(nt),!1),Ft(this,J,Ye).call(this)}_bindAttachment(W,nt){W.href=this.linkService.getAnchorUrl(""),W.onclick=()=>{var Ct;return(Ct=this.downloadManager)==null||Ct.openOrDownloadData(this.container,nt.content,nt.filename),!1},Ft(this,J,Ye).call(this)}_bindJSAction(W,nt){W.href=this.linkService.getAnchorUrl("");const Ct=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const Mt of Object.keys(nt.actions)){const Lt=Ct.get(Mt);Lt&&(W[Lt]=()=>{var Gt;return(Gt=this.linkService.eventBus)==null||Gt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:nt.id,name:Mt}}),!1})}W.onclick||(W.onclick=()=>!1),Ft(this,J,Ye).call(this)}_bindResetFormAction(W,nt){const Ct=W.onclick;if(Ct||(W.href=this.linkService.getAnchorUrl("")),Ft(this,J,Ye).call(this),!this._fieldObjects){(0,D.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),Ct||(W.onclick=()=>!1);return}W.onclick=()=>{var Me;Ct==null||Ct();const{fields:Mt,refs:Lt,include:Gt}=nt,ie=[];if(Mt.length!==0||Lt.length!==0){const _e=new Set(Lt);for(const be of Mt){const Ce=this._fieldObjects[be]||[];for(const{id:De}of Ce)_e.add(De)}for(const be of Object.values(this._fieldObjects))for(const Ce of be)_e.has(Ce.id)===Gt&&ie.push(Ce)}else for(const _e of Object.values(this._fieldObjects))ie.push(..._e);const ge=this.annotationStorage,pe=[];for(const _e of ie){const{id:be}=_e;switch(pe.push(be),_e.type){case"text":{const De=_e.defaultValue||"";ge.setValue(be,{value:De});break}case"checkbox":case"radiobutton":{const De=_e.defaultValue===_e.exportValues;ge.setValue(be,{value:De});break}case"combobox":case"listbox":{const De=_e.defaultValue||"";ge.setValue(be,{value:De});break}default:continue}const Ce=document.querySelector(`[data-element-id="${be}"]`);if(Ce){if(!vt.has(Ce)){(0,D.warn)(`_bindResetFormAction - element not allowed: ${be}`);continue}}else continue;Ce.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((Me=this.linkService.eventBus)==null||Me.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:pe,name:"ResetForm"}})),!1}}}J=new WeakSet,Ye=function(){this.container.setAttribute("data-internal-link","")},ot=new WeakSet,ws=function(W,nt){W.href=this.linkService.getAnchorUrl(""),W.onclick=()=>(this.linkService.executeSetOCGState(nt),!1),Ft(this,J,Ye).call(this)};class st extends ht{constructor(Et){super(Et,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const Et=document.createElement("img");return Et.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",Et.alt="[{{type}} Annotation]",Et.dataset.l10nId="text_annotation_type",Et.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(Et),this.container}}class lt extends ht{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(Et){var W;this.data.hasOwnCanvas&&(((W=Et.previousSibling)==null?void 0:W.nodeName)==="CANVAS"&&(Et.previousSibling.hidden=!0),Et.hidden=!1)}_getKeyModifier(Et){const{isWin:W,isMac:nt}=D.FeatureTest.platform;return W&&Et.ctrlKey||nt&&Et.metaKey}_setEventListener(Et,W,nt,Ct,Mt){nt.includes("mouse")?Et.addEventListener(nt,Lt=>{var Gt;(Gt=this.linkService.eventBus)==null||Gt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:Ct,value:Mt(Lt),shift:Lt.shiftKey,modifier:this._getKeyModifier(Lt)}})}):Et.addEventListener(nt,Lt=>{var Gt;if(nt==="blur"){if(!W.focused||!Lt.relatedTarget)return;W.focused=!1}else if(nt==="focus"){if(W.focused)return;W.focused=!0}Mt&&((Gt=this.linkService.eventBus)==null||Gt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:Ct,value:Mt(Lt)}}))})}_setEventListeners(Et,W,nt,Ct){var Mt,Lt,Gt;for(const[ie,ge]of nt)(ge==="Action"||(Mt=this.data.actions)!=null&&Mt[ge])&&((ge==="Focus"||ge==="Blur")&&(W||(W={focused:!1})),this._setEventListener(Et,W,ie,ge,Ct),ge==="Focus"&&!((Lt=this.data.actions)!=null&&Lt.Blur)?this._setEventListener(Et,W,"blur","Blur",null):ge==="Blur"&&!((Gt=this.data.actions)!=null&&Gt.Focus)&&this._setEventListener(Et,W,"focus","Focus",null))}_setBackgroundColor(Et){const W=this.data.backgroundColor||null;Et.style.backgroundColor=W===null?"transparent":D.Util.makeHexColor(W[0],W[1],W[2])}_setTextStyle(Et){const W=["left","center","right"],{fontColor:nt}=this.data.defaultAppearanceData,Ct=this.data.defaultAppearanceData.fontSize||et,Mt=Et.style;let Lt;const Gt=2,ie=ge=>Math.round(10*ge)/10;if(this.data.multiLine){const ge=Math.abs(this.data.rect[3]-this.data.rect[1]-Gt),pe=Math.round(ge/(D.LINE_FACTOR*Ct))||1,Me=ge/pe;Lt=Math.min(Ct,ie(Me/D.LINE_FACTOR))}else{const ge=Math.abs(this.data.rect[3]-this.data.rect[1]-Gt);Lt=Math.min(Ct,ie(ge/D.LINE_FACTOR))}Mt.fontSize=`calc(${Lt}px * var(--scale-factor))`,Mt.color=D.Util.makeHexColor(nt[0],nt[1],nt[2]),this.data.textAlignment!==null&&(Mt.textAlign=W[this.data.textAlignment])}_setRequired(Et,W){W?Et.setAttribute("required",!0):Et.removeAttribute("required"),Et.setAttribute("aria-required",W)}}class mt extends lt{constructor(Et){const W=Et.renderForms||!Et.data.hasAppearance&&!!Et.data.fieldValue;super(Et,{isRenderable:W})}setPropertyOnSiblings(Et,W,nt,Ct){const Mt=this.annotationStorage;for(const Lt of this._getElementsByName(Et.name,Et.id))Lt.domElement&&(Lt.domElement[W]=nt),Mt.setValue(Lt.id,{[Ct]:nt})}render(){var Ct,Mt;const Et=this.annotationStorage,W=this.data.id;this.container.classList.add("textWidgetAnnotation");let nt=null;if(this.renderForms){const Lt=Et.getValue(W,{value:this.data.fieldValue});let Gt=Lt.value||"";const ie=Et.getValue(W,{charLimit:this.data.maxLen}).charLimit;ie&&Gt.length>ie&&(Gt=Gt.slice(0,ie));let ge=Lt.formattedValue||((Ct=this.data.textContent)==null?void 0:Ct.join(`
`))||null;ge&&this.data.comb&&(ge=ge.replaceAll(/\s+/g,""));const pe={userValue:Gt,formattedValue:ge,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(nt=document.createElement("textarea"),nt.textContent=ge??Gt,this.data.doNotScroll&&(nt.style.overflowY="hidden")):(nt=document.createElement("input"),nt.type="text",nt.setAttribute("value",ge??Gt),this.data.doNotScroll&&(nt.style.overflowX="hidden")),this.data.hasOwnCanvas&&(nt.hidden=!0),vt.add(nt),nt.setAttribute("data-element-id",W),nt.disabled=this.data.readOnly,nt.name=this.data.fieldName,nt.tabIndex=gt,this._setRequired(nt,this.data.required),ie&&(nt.maxLength=ie),nt.addEventListener("input",_e=>{Et.setValue(W,{value:_e.target.value}),this.setPropertyOnSiblings(nt,"value",_e.target.value,"value"),pe.formattedValue=null}),nt.addEventListener("resetform",_e=>{const be=this.data.defaultFieldValue??"";nt.value=pe.userValue=be,pe.formattedValue=null});let Me=_e=>{const{formattedValue:be}=pe;be!=null&&(_e.target.value=be),_e.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){nt.addEventListener("focus",be=>{if(pe.focused)return;const{target:Ce}=be;pe.userValue&&(Ce.value=pe.userValue),pe.lastCommittedValue=Ce.value,pe.commitKey=1,pe.focused=!0}),nt.addEventListener("updatefromsandbox",be=>{this.showElementAndHideCanvas(be.target);const Ce={value(De){pe.userValue=De.detail.value??"",Et.setValue(W,{value:pe.userValue.toString()}),De.target.value=pe.userValue},formattedValue(De){const{formattedValue:Le}=De.detail;pe.formattedValue=Le,Le!=null&&De.target!==document.activeElement&&(De.target.value=Le),Et.setValue(W,{formattedValue:Le})},selRange(De){De.target.setSelectionRange(...De.detail.selRange)},charLimit:De=>{var He;const{charLimit:Le}=De.detail,{target:Ne}=De;if(Le===0){Ne.removeAttribute("maxLength");return}Ne.setAttribute("maxLength",Le);let We=pe.userValue;!We||We.length<=Le||(We=We.slice(0,Le),Ne.value=pe.userValue=We,Et.setValue(W,{value:We}),(He=this.linkService.eventBus)==null||He.dispatch("dispatcheventinsandbox",{source:this,detail:{id:W,name:"Keystroke",value:We,willCommit:!0,commitKey:1,selStart:Ne.selectionStart,selEnd:Ne.selectionEnd}}))}};this._dispatchEventFromSandbox(Ce,be)}),nt.addEventListener("keydown",be=>{var Le;pe.commitKey=1;let Ce=-1;if(be.key==="Escape"?Ce=0:be.key==="Enter"&&!this.data.multiLine?Ce=2:be.key==="Tab"&&(pe.commitKey=3),Ce===-1)return;const{value:De}=be.target;pe.lastCommittedValue!==De&&(pe.lastCommittedValue=De,pe.userValue=De,(Le=this.linkService.eventBus)==null||Le.dispatch("dispatcheventinsandbox",{source:this,detail:{id:W,name:"Keystroke",value:De,willCommit:!0,commitKey:Ce,selStart:be.target.selectionStart,selEnd:be.target.selectionEnd}}))});const _e=Me;Me=null,nt.addEventListener("blur",be=>{var De;if(!pe.focused||!be.relatedTarget)return;pe.focused=!1;const{value:Ce}=be.target;pe.userValue=Ce,pe.lastCommittedValue!==Ce&&((De=this.linkService.eventBus)==null||De.dispatch("dispatcheventinsandbox",{source:this,detail:{id:W,name:"Keystroke",value:Ce,willCommit:!0,commitKey:pe.commitKey,selStart:be.target.selectionStart,selEnd:be.target.selectionEnd}})),_e(be)}),(Mt=this.data.actions)!=null&&Mt.Keystroke&&nt.addEventListener("beforeinput",be=>{var Xe;pe.lastCommittedValue=null;const{data:Ce,target:De}=be,{value:Le,selectionStart:Ne,selectionEnd:We}=De;let He=Ne,ze=We;switch(be.inputType){case"deleteWordBackward":{const Ve=Le.substring(0,Ne).match(/\w*[^\w]*$/);Ve&&(He-=Ve[0].length);break}case"deleteWordForward":{const Ve=Le.substring(Ne).match(/^[^\w]*\w*/);Ve&&(ze+=Ve[0].length);break}case"deleteContentBackward":Ne===We&&(He-=1);break;case"deleteContentForward":Ne===We&&(ze+=1);break}be.preventDefault(),(Xe=this.linkService.eventBus)==null||Xe.dispatch("dispatcheventinsandbox",{source:this,detail:{id:W,name:"Keystroke",value:Le,change:Ce||"",willCommit:!1,selStart:He,selEnd:ze}})}),this._setEventListeners(nt,pe,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],be=>be.target.value)}if(Me&&nt.addEventListener("blur",Me),this.data.comb){const be=(this.data.rect[2]-this.data.rect[0])/ie;nt.classList.add("comb"),nt.style.letterSpacing=`calc(${be}px * var(--scale-factor) - 1ch)`}}else nt=document.createElement("div"),nt.textContent=this.data.fieldValue,nt.style.verticalAlign="middle",nt.style.display="table-cell";return this._setTextStyle(nt),this._setBackgroundColor(nt),this._setDefaultPropertiesFromJS(nt),this.container.append(nt),this.container}}class _t extends lt{constructor(Et){super(Et,{isRenderable:!!Et.data.hasOwnCanvas})}}class dt extends lt{constructor(Et){super(Et,{isRenderable:Et.renderForms})}render(){const Et=this.annotationStorage,W=this.data,nt=W.id;let Ct=Et.getValue(nt,{value:W.exportValue===W.fieldValue}).value;typeof Ct=="string"&&(Ct=Ct!=="Off",Et.setValue(nt,{value:Ct})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const Mt=document.createElement("input");return vt.add(Mt),Mt.setAttribute("data-element-id",nt),Mt.disabled=W.readOnly,this._setRequired(Mt,this.data.required),Mt.type="checkbox",Mt.name=W.fieldName,Ct&&Mt.setAttribute("checked",!0),Mt.setAttribute("exportValue",W.exportValue),Mt.tabIndex=gt,Mt.addEventListener("change",Lt=>{const{name:Gt,checked:ie}=Lt.target;for(const ge of this._getElementsByName(Gt,nt)){const pe=ie&&ge.exportValue===W.exportValue;ge.domElement&&(ge.domElement.checked=pe),Et.setValue(ge.id,{value:pe})}Et.setValue(nt,{value:ie})}),Mt.addEventListener("resetform",Lt=>{const Gt=W.defaultFieldValue||"Off";Lt.target.checked=Gt===W.exportValue}),this.enableScripting&&this.hasJSActions&&(Mt.addEventListener("updatefromsandbox",Lt=>{const Gt={value(ie){ie.target.checked=ie.detail.value!=="Off",Et.setValue(nt,{value:ie.target.checked})}};this._dispatchEventFromSandbox(Gt,Lt)}),this._setEventListeners(Mt,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Lt=>Lt.target.checked)),this._setBackgroundColor(Mt),this._setDefaultPropertiesFromJS(Mt),this.container.append(Mt),this.container}}class Y extends lt{constructor(Et){super(Et,{isRenderable:Et.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const Et=this.annotationStorage,W=this.data,nt=W.id;let Ct=Et.getValue(nt,{value:W.fieldValue===W.buttonValue}).value;typeof Ct=="string"&&(Ct=Ct!==W.buttonValue,Et.setValue(nt,{value:Ct}));const Mt=document.createElement("input");if(vt.add(Mt),Mt.setAttribute("data-element-id",nt),Mt.disabled=W.readOnly,this._setRequired(Mt,this.data.required),Mt.type="radio",Mt.name=W.fieldName,Ct&&Mt.setAttribute("checked",!0),Mt.tabIndex=gt,Mt.addEventListener("change",Lt=>{const{name:Gt,checked:ie}=Lt.target;for(const ge of this._getElementsByName(Gt,nt))Et.setValue(ge.id,{value:!1});Et.setValue(nt,{value:ie})}),Mt.addEventListener("resetform",Lt=>{const Gt=W.defaultFieldValue;Lt.target.checked=Gt!=null&&Gt===W.buttonValue}),this.enableScripting&&this.hasJSActions){const Lt=W.buttonValue;Mt.addEventListener("updatefromsandbox",Gt=>{const ie={value:ge=>{const pe=Lt===ge.detail.value;for(const Me of this._getElementsByName(ge.target.name)){const _e=pe&&Me.id===nt;Me.domElement&&(Me.domElement.checked=_e),Et.setValue(Me.id,{value:_e})}}};this._dispatchEventFromSandbox(ie,Gt)}),this._setEventListeners(Mt,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Gt=>Gt.target.checked)}return this._setBackgroundColor(Mt),this._setDefaultPropertiesFromJS(Mt),this.container.append(Mt),this.container}}class Q extends ut{constructor(Et){super(Et,{ignoreBorder:Et.data.hasAppearance})}render(){const Et=super.render();Et.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(Et.title=this.data.alternativeText);const W=Et.lastChild;return this.enableScripting&&this.hasJSActions&&W&&(this._setDefaultPropertiesFromJS(W),W.addEventListener("updatefromsandbox",nt=>{this._dispatchEventFromSandbox({},nt)})),Et}}class St extends lt{constructor(Et){super(Et,{isRenderable:Et.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const Et=this.annotationStorage,W=this.data.id,nt=Et.getValue(W,{value:this.data.fieldValue}),Ct=document.createElement("select");vt.add(Ct),Ct.setAttribute("data-element-id",W),Ct.disabled=this.data.readOnly,this._setRequired(Ct,this.data.required),Ct.name=this.data.fieldName,Ct.tabIndex=gt;let Mt=this.data.combo&&this.data.options.length>0;this.data.combo||(Ct.size=this.data.options.length,this.data.multiSelect&&(Ct.multiple=!0)),Ct.addEventListener("resetform",pe=>{const Me=this.data.defaultFieldValue;for(const _e of Ct.options)_e.selected=_e.value===Me});for(const pe of this.data.options){const Me=document.createElement("option");Me.textContent=pe.displayValue,Me.value=pe.exportValue,nt.value.includes(pe.exportValue)&&(Me.setAttribute("selected",!0),Mt=!1),Ct.append(Me)}let Lt=null;if(Mt){const pe=document.createElement("option");pe.value=" ",pe.setAttribute("hidden",!0),pe.setAttribute("selected",!0),Ct.prepend(pe),Lt=()=>{pe.remove(),Ct.removeEventListener("input",Lt),Lt=null},Ct.addEventListener("input",Lt)}const Gt=pe=>{const Me=pe?"value":"textContent",{options:_e,multiple:be}=Ct;return be?Array.prototype.filter.call(_e,Ce=>Ce.selected).map(Ce=>Ce[Me]):_e.selectedIndex===-1?null:_e[_e.selectedIndex][Me]};let ie=Gt(!1);const ge=pe=>{const Me=pe.target.options;return Array.prototype.map.call(Me,_e=>({displayValue:_e.textContent,exportValue:_e.value}))};return this.enableScripting&&this.hasJSActions?(Ct.addEventListener("updatefromsandbox",pe=>{const Me={value(_e){Lt==null||Lt();const be=_e.detail.value,Ce=new Set(Array.isArray(be)?be:[be]);for(const De of Ct.options)De.selected=Ce.has(De.value);Et.setValue(W,{value:Gt(!0)}),ie=Gt(!1)},multipleSelection(_e){Ct.multiple=!0},remove(_e){const be=Ct.options,Ce=_e.detail.remove;be[Ce].selected=!1,Ct.remove(Ce),be.length>0&&Array.prototype.findIndex.call(be,Le=>Le.selected)===-1&&(be[0].selected=!0),Et.setValue(W,{value:Gt(!0),items:ge(_e)}),ie=Gt(!1)},clear(_e){for(;Ct.length!==0;)Ct.remove(0);Et.setValue(W,{value:null,items:[]}),ie=Gt(!1)},insert(_e){const{index:be,displayValue:Ce,exportValue:De}=_e.detail.insert,Le=Ct.children[be],Ne=document.createElement("option");Ne.textContent=Ce,Ne.value=De,Le?Le.before(Ne):Ct.append(Ne),Et.setValue(W,{value:Gt(!0),items:ge(_e)}),ie=Gt(!1)},items(_e){const{items:be}=_e.detail;for(;Ct.length!==0;)Ct.remove(0);for(const Ce of be){const{displayValue:De,exportValue:Le}=Ce,Ne=document.createElement("option");Ne.textContent=De,Ne.value=Le,Ct.append(Ne)}Ct.options.length>0&&(Ct.options[0].selected=!0),Et.setValue(W,{value:Gt(!0),items:ge(_e)}),ie=Gt(!1)},indices(_e){const be=new Set(_e.detail.indices);for(const Ce of _e.target.options)Ce.selected=be.has(Ce.index);Et.setValue(W,{value:Gt(!0)}),ie=Gt(!1)},editable(_e){_e.target.disabled=!_e.detail.editable}};this._dispatchEventFromSandbox(Me,pe)}),Ct.addEventListener("input",pe=>{var _e;const Me=Gt(!0);Et.setValue(W,{value:Me}),pe.preventDefault(),(_e=this.linkService.eventBus)==null||_e.dispatch("dispatcheventinsandbox",{source:this,detail:{id:W,name:"Keystroke",value:ie,changeEx:Me,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(Ct,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],pe=>pe.target.value)):Ct.addEventListener("input",function(pe){Et.setValue(W,{value:Gt(!0)})}),this.data.combo&&this._setTextStyle(Ct),this._setBackgroundColor(Ct),this._setDefaultPropertiesFromJS(Ct),this.container.append(Ct),this.container}}class rt extends ht{constructor(Et){const{data:W,elements:nt}=Et;super(Et,{isRenderable:ht._hasPopupData(W)}),this.elements=nt}render(){this.container.classList.add("popupAnnotation");const Et=new X({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),W=[];for(const nt of this.elements)nt.popup=Et,W.push(nt.data.id),nt.addHighlightArea();return this.container.setAttribute("aria-controls",W.map(nt=>`${D.AnnotationPrefix}${nt}`).join(",")),this.container}}class X{constructor({container:Et,color:W,elements:nt,titleObj:Ct,modificationDate:Mt,contentsObj:Lt,richText:Gt,parent:ie,rect:ge,parentRect:pe,open:Me}){xt(this,xe);xt(this,Pe);xt(this,Fe);xt(this,Oe);xt(this,Tt,null);xt(this,Wt,Ft(this,xe,Es).bind(this));xt(this,jt,Ft(this,Oe,Vi).bind(this));xt(this,Xt,Ft(this,Fe,Xi).bind(this));xt(this,Jt,Ft(this,Pe,_i).bind(this));xt(this,ae,null);xt(this,Zt,null);xt(this,me,null);xt(this,Ee,null);xt(this,le,null);xt(this,Ae,null);xt(this,te,!1);xt(this,Ut,null);xt(this,Bt,null);xt(this,Qt,null);xt(this,ce,null);xt(this,de,!1);var be;Ht(this,Zt,Et),Ht(this,ce,Ct),Ht(this,me,Lt),Ht(this,Qt,Gt),Ht(this,le,ie),Ht(this,ae,W),Ht(this,Bt,ge),Ht(this,Ae,pe),Ht(this,Ee,nt);const _e=U.PDFDateString.toDateObject(Mt);_e&&Ht(this,Tt,ie.l10n.get("annotation_date_string",{date:_e.toLocaleDateString(),time:_e.toLocaleTimeString()})),this.trigger=nt.flatMap(Ce=>Ce.getElementsToTriggerPopup());for(const Ce of this.trigger)Ce.addEventListener("click",O(this,Jt)),Ce.addEventListener("mouseenter",O(this,Xt)),Ce.addEventListener("mouseleave",O(this,jt)),Ce.classList.add("popupTriggerArea");for(const Ce of nt)(be=Ce.container)==null||be.addEventListener("keydown",O(this,Wt));O(this,Zt).hidden=!0,Me&&Ft(this,Pe,_i).call(this)}render(){if(O(this,Ut))return;const{page:{view:Et},viewport:{rawDims:{pageWidth:W,pageHeight:nt,pageX:Ct,pageY:Mt}}}=O(this,le),Lt=Ht(this,Ut,document.createElement("div"));if(Lt.className="popup",O(this,ae)){const He=Lt.style.outlineColor=D.Util.makeHexColor(...O(this,ae));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?Lt.style.backgroundColor=`color-mix(in srgb, ${He} 30%, white)`:Lt.style.backgroundColor=D.Util.makeHexColor(...O(this,ae).map(Xe=>Math.floor(.7*(255-Xe)+Xe)))}const Gt=document.createElement("span");Gt.className="header";const ie=document.createElement("h1");if(Gt.append(ie),{dir:ie.dir,str:ie.textContent}=O(this,ce),Lt.append(Gt),O(this,Tt)){const He=document.createElement("span");He.classList.add("popupDate"),O(this,Tt).then(ze=>{He.textContent=ze}),Gt.append(He)}const ge=O(this,me),pe=O(this,Qt);if(pe!=null&&pe.str&&(!(ge!=null&&ge.str)||ge.str===pe.str))At.XfaLayer.render({xfaHtml:pe.html,intent:"richText",div:Lt}),Lt.lastChild.classList.add("richText","popupContent");else{const He=this._formatContents(ge);Lt.append(He)}let Me=!!O(this,Ae),_e=Me?O(this,Ae):O(this,Bt);for(const He of O(this,Ee))if(!_e||D.Util.intersect(He.data.rect,_e)!==null){_e=He.data.rect,Me=!0;break}const be=D.Util.normalizeRect([_e[0],Et[3]-_e[1]+Et[1],_e[2],Et[3]-_e[3]+Et[1]]),Ce=5,De=Me?_e[2]-_e[0]+Ce:0,Le=be[0]+De,Ne=be[1],{style:We}=O(this,Zt);We.left=`${100*(Le-Ct)/W}%`,We.top=`${100*(Ne-Mt)/nt}%`,O(this,Zt).append(Lt)}_formatContents({str:Et,dir:W}){const nt=document.createElement("p");nt.classList.add("popupContent"),nt.dir=W;const Ct=Et.split(/(?:\r\n?|\n)/);for(let Mt=0,Lt=Ct.length;Mt<Lt;++Mt){const Gt=Ct[Mt];nt.append(document.createTextNode(Gt)),Mt<Lt-1&&nt.append(document.createElement("br"))}return nt}forceHide(){Ht(this,de,this.isVisible),O(this,de)&&(O(this,Zt).hidden=!0)}maybeShow(){O(this,de)&&(Ht(this,de,!1),O(this,Zt).hidden=!1)}get isVisible(){return O(this,Zt).hidden===!1}}Tt=new WeakMap,Wt=new WeakMap,jt=new WeakMap,Xt=new WeakMap,Jt=new WeakMap,ae=new WeakMap,Zt=new WeakMap,me=new WeakMap,Ee=new WeakMap,le=new WeakMap,Ae=new WeakMap,te=new WeakMap,Ut=new WeakMap,Bt=new WeakMap,Qt=new WeakMap,ce=new WeakMap,de=new WeakMap,xe=new WeakSet,Es=function(Et){Et.altKey||Et.shiftKey||Et.ctrlKey||Et.metaKey||(Et.key==="Enter"||Et.key==="Escape"&&O(this,te))&&Ft(this,Pe,_i).call(this)},Pe=new WeakSet,_i=function(){Ht(this,te,!O(this,te)),O(this,te)?(Ft(this,Fe,Xi).call(this),O(this,Zt).addEventListener("click",O(this,Jt)),O(this,Zt).addEventListener("keydown",O(this,Wt))):(Ft(this,Oe,Vi).call(this),O(this,Zt).removeEventListener("click",O(this,Jt)),O(this,Zt).removeEventListener("keydown",O(this,Wt)))},Fe=new WeakSet,Xi=function(){O(this,Ut)||this.render(),this.isVisible?O(this,te)&&O(this,Zt).classList.add("focused"):(O(this,Zt).hidden=!1,O(this,Zt).style.zIndex=parseInt(O(this,Zt).style.zIndex)+1e3)},Oe=new WeakSet,Vi=function(){O(this,Zt).classList.remove("focused"),!(O(this,te)||!this.isVisible)&&(O(this,Zt).hidden=!0,O(this,Zt).style.zIndex=parseInt(O(this,Zt).style.zIndex)-1e3)};class bt extends ht{constructor(Et){super(Et,{isRenderable:!0,ignoreBorder:!0}),this.textContent=Et.data.textContent,this.textPosition=Et.data.textPosition,this.annotationEditorType=D.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const Et=document.createElement("div");Et.classList.add("annotationTextContent"),Et.setAttribute("role","comment");for(const W of this.textContent){const nt=document.createElement("span");nt.textContent=W,Et.append(nt)}this.container.append(Et)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}F.FreeTextAnnotationElement=bt;class at extends ht{constructor(W){super(W,{isRenderable:!0,ignoreBorder:!0});xt(this,Nt,null)}render(){this.container.classList.add("lineAnnotation");const W=this.data,{width:nt,height:Ct}=Pt(W.rect),Mt=this.svgFactory.create(nt,Ct,!0),Lt=Ht(this,Nt,this.svgFactory.createElement("svg:line"));return Lt.setAttribute("x1",W.rect[2]-W.lineCoordinates[0]),Lt.setAttribute("y1",W.rect[3]-W.lineCoordinates[1]),Lt.setAttribute("x2",W.rect[2]-W.lineCoordinates[2]),Lt.setAttribute("y2",W.rect[3]-W.lineCoordinates[3]),Lt.setAttribute("stroke-width",W.borderStyle.width||1),Lt.setAttribute("stroke","transparent"),Lt.setAttribute("fill","transparent"),Mt.append(Lt),this.container.append(Mt),!W.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return O(this,Nt)}addHighlightArea(){this.container.classList.add("highlightArea")}}Nt=new WeakMap;class kt extends ht{constructor(W){super(W,{isRenderable:!0,ignoreBorder:!0});xt(this,Dt,null)}render(){this.container.classList.add("squareAnnotation");const W=this.data,{width:nt,height:Ct}=Pt(W.rect),Mt=this.svgFactory.create(nt,Ct,!0),Lt=W.borderStyle.width,Gt=Ht(this,Dt,this.svgFactory.createElement("svg:rect"));return Gt.setAttribute("x",Lt/2),Gt.setAttribute("y",Lt/2),Gt.setAttribute("width",nt-Lt),Gt.setAttribute("height",Ct-Lt),Gt.setAttribute("stroke-width",Lt||1),Gt.setAttribute("stroke","transparent"),Gt.setAttribute("fill","transparent"),Mt.append(Gt),this.container.append(Mt),!W.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return O(this,Dt)}addHighlightArea(){this.container.classList.add("highlightArea")}}Dt=new WeakMap;class Ot extends ht{constructor(W){super(W,{isRenderable:!0,ignoreBorder:!0});xt(this,se,null)}render(){this.container.classList.add("circleAnnotation");const W=this.data,{width:nt,height:Ct}=Pt(W.rect),Mt=this.svgFactory.create(nt,Ct,!0),Lt=W.borderStyle.width,Gt=Ht(this,se,this.svgFactory.createElement("svg:ellipse"));return Gt.setAttribute("cx",nt/2),Gt.setAttribute("cy",Ct/2),Gt.setAttribute("rx",nt/2-Lt/2),Gt.setAttribute("ry",Ct/2-Lt/2),Gt.setAttribute("stroke-width",Lt||1),Gt.setAttribute("stroke","transparent"),Gt.setAttribute("fill","transparent"),Mt.append(Gt),this.container.append(Mt),!W.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return O(this,se)}addHighlightArea(){this.container.classList.add("highlightArea")}}se=new WeakMap;class ft extends ht{constructor(W){super(W,{isRenderable:!0,ignoreBorder:!0});xt(this,re,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const W=this.data,{width:nt,height:Ct}=Pt(W.rect),Mt=this.svgFactory.create(nt,Ct,!0);let Lt=[];for(const ie of W.vertices){const ge=ie.x-W.rect[0],pe=W.rect[3]-ie.y;Lt.push(ge+","+pe)}Lt=Lt.join(" ");const Gt=Ht(this,re,this.svgFactory.createElement(this.svgElementName));return Gt.setAttribute("points",Lt),Gt.setAttribute("stroke-width",W.borderStyle.width||1),Gt.setAttribute("stroke","transparent"),Gt.setAttribute("fill","transparent"),Mt.append(Gt),this.container.append(Mt),!W.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return O(this,re)}addHighlightArea(){this.container.classList.add("highlightArea")}}re=new WeakMap;class It extends ft{constructor(Et){super(Et),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class qt extends ht{constructor(Et){super(Et,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Vt extends ht{constructor(W){super(W,{isRenderable:!0,ignoreBorder:!0});xt(this,Be,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=D.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const W=this.data,{width:nt,height:Ct}=Pt(W.rect),Mt=this.svgFactory.create(nt,Ct,!0);for(const Lt of W.inkLists){let Gt=[];for(const ge of Lt){const pe=ge.x-W.rect[0],Me=W.rect[3]-ge.y;Gt.push(`${pe},${Me}`)}Gt=Gt.join(" ");const ie=this.svgFactory.createElement(this.svgElementName);O(this,Be).push(ie),ie.setAttribute("points",Gt),ie.setAttribute("stroke-width",W.borderStyle.width||1),ie.setAttribute("stroke","transparent"),ie.setAttribute("fill","transparent"),!W.popupRef&&this.hasPopupData&&this._createPopup(),Mt.append(ie)}return this.container.append(Mt),this.container}getElementsToTriggerPopup(){return O(this,Be)}addHighlightArea(){this.container.classList.add("highlightArea")}}Be=new WeakMap,F.InkAnnotationElement=Vt;class Rt extends ht{constructor(Et){super(Et,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class Kt extends ht{constructor(Et){super(Et,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class ee extends ht{constructor(Et){super(Et,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class he extends ht{constructor(Et){super(Et,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class fe extends ht{constructor(Et){super(Et,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}F.StampAnnotationElement=fe;class pt extends ht{constructor(W){var Mt;super(W,{isRenderable:!0});xt(this,$t);xt(this,Ue,null);const{filename:nt,content:Ct}=this.data.file;this.filename=(0,U.getFilenameFromUrl)(nt,!0),this.content=Ct,(Mt=this.linkService.eventBus)==null||Mt.dispatch("fileattachmentannotation",{source:this,filename:nt,content:Ct})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:W,data:nt}=this;let Ct;nt.hasAppearance||nt.fillAlpha===0?Ct=document.createElement("div"):(Ct=document.createElement("img"),Ct.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(nt.name)?"paperclip":"pushpin"}.svg`,nt.fillAlpha&&nt.fillAlpha<1&&(Ct.style=`filter: opacity(${Math.round(nt.fillAlpha*100)}%);`)),Ct.addEventListener("dblclick",Ft(this,$t,Yi).bind(this)),Ht(this,Ue,Ct);const{isMac:Mt}=D.FeatureTest.platform;return W.addEventListener("keydown",Lt=>{Lt.key==="Enter"&&(Mt?Lt.metaKey:Lt.ctrlKey)&&Ft(this,$t,Yi).call(this)}),!nt.popupRef&&this.hasPopupData?this._createPopup():Ct.classList.add("popupTriggerArea"),W.append(Ct),W}getElementsToTriggerPopup(){return O(this,Ue)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ue=new WeakMap,$t=new WeakSet,Yi=function(){var W;(W=this.downloadManager)==null||W.openOrDownloadData(this.container,this.content,this.filename)};class z{constructor({div:Et,accessibilityManager:W,annotationCanvasMap:nt,l10n:Ct,page:Mt,viewport:Lt}){xt(this,we);xt(this,ne);xt(this,ve,null);xt(this,ue,null);xt(this,Se,new Map);this.div=Et,Ht(this,ve,W),Ht(this,ue,nt),this.l10n=Ct,this.page=Mt,this.viewport=Lt,this.zIndex=0,this.l10n||(this.l10n=zt.NullL10n)}async render(Et){const{annotations:W}=Et,nt=this.div;(0,U.setLayerDimensions)(nt,this.viewport);const Ct=new Map,Mt={data:null,layer:nt,linkService:Et.linkService,downloadManager:Et.downloadManager,imageResourcesPath:Et.imageResourcesPath||"",renderForms:Et.renderForms!==!1,svgFactory:new U.DOMSVGFactory,annotationStorage:Et.annotationStorage||new ct.AnnotationStorage,enableScripting:Et.enableScripting===!0,hasJSActions:Et.hasJSActions,fieldObjects:Et.fieldObjects,parent:this,elements:null};for(const Lt of W){if(Lt.noHTML)continue;const Gt=Lt.annotationType===D.AnnotationType.POPUP;if(Gt){const pe=Ct.get(Lt.id);if(!pe)continue;Mt.elements=pe}else{const{width:pe,height:Me}=Pt(Lt.rect);if(pe<=0||Me<=0)continue}Mt.data=Lt;const ie=yt.create(Mt);if(!ie.isRenderable)continue;if(!Gt&&Lt.popupRef){const pe=Ct.get(Lt.popupRef);pe?pe.push(ie):Ct.set(Lt.popupRef,[ie])}ie.annotationEditorType>0&&O(this,Se).set(ie.data.id,ie);const ge=ie.render();Lt.hidden&&(ge.style.visibility="hidden"),Ft(this,we,Cs).call(this,ge,Lt.id)}Ft(this,ne,Ki).call(this),await this.l10n.translate(nt)}update({viewport:Et}){const W=this.div;this.viewport=Et,(0,U.setLayerDimensions)(W,{rotation:Et.rotation}),Ft(this,ne,Ki).call(this),W.hidden=!1}getEditableAnnotations(){return Array.from(O(this,Se).values())}getEditableAnnotation(Et){return O(this,Se).get(Et)}}ve=new WeakMap,ue=new WeakMap,Se=new WeakMap,we=new WeakSet,Cs=function(Et,W){var Ct;const nt=Et.firstChild||Et;nt.id=`${D.AnnotationPrefix}${W}`,this.div.append(Et),(Ct=O(this,ve))==null||Ct.moveElementInDOM(this.div,Et,nt,!1)},ne=new WeakSet,Ki=function(){if(!O(this,ue))return;const Et=this.div;for(const[W,nt]of O(this,ue)){const Ct=Et.querySelector(`[data-annotation-id="${W}"]`);if(!Ct)continue;const{firstChild:Mt}=Ct;Mt?Mt.nodeName==="CANVAS"?Mt.replaceWith(nt):Mt.before(nt):Ct.append(nt)}O(this,ue).clear()},F.AnnotationLayer=z},(K,F)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.ColorConverters=void 0;function B(ct){return Math.floor(Math.max(0,Math.min(1,ct))*255).toString(16).padStart(2,"0")}function D(ct){return Math.max(0,Math.min(255,255*ct))}class U{static CMYK_G([it,zt,At,gt]){return["G",1-Math.min(1,.3*it+.59*At+.11*zt+gt)]}static G_CMYK([it]){return["CMYK",0,0,0,1-it]}static G_RGB([it]){return["RGB",it,it,it]}static G_rgb([it]){return it=D(it),[it,it,it]}static G_HTML([it]){const zt=B(it);return`#${zt}${zt}${zt}`}static RGB_G([it,zt,At]){return["G",.3*it+.59*zt+.11*At]}static RGB_rgb(it){return it.map(D)}static RGB_HTML(it){return`#${it.map(B).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([it,zt,At,gt]){return["RGB",1-Math.min(1,it+gt),1-Math.min(1,At+gt),1-Math.min(1,zt+gt)]}static CMYK_rgb([it,zt,At,gt]){return[D(1-Math.min(1,it+gt)),D(1-Math.min(1,At+gt)),D(1-Math.min(1,zt+gt))]}static CMYK_HTML(it){const zt=this.CMYK_RGB(it).slice(1);return this.RGB_HTML(zt)}static RGB_CMYK([it,zt,At]){const gt=1-it,et=1-zt,vt=1-At,Pt=Math.min(gt,et,vt);return["CMYK",gt,et,vt,Pt]}}F.ColorConverters=U},(K,F)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.NullL10n=void 0,F.getL10nFallback=D;const B={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};B.print_progress_percent="{{progress}}%";function D(it,zt){switch(it){case"find_match_count":it=`find_match_count[${zt.total===1?"one":"other"}]`;break;case"find_match_count_limit":it=`find_match_count_limit[${zt.limit===1?"one":"other"}]`;break}return B[it]||""}function U(it,zt){return zt?it.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(At,gt)=>gt in zt?zt[gt]:"{{"+gt+"}}"):it}const ct={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(it,zt=null,At=D(it,zt)){return U(At,zt)},async translate(it){}};F.NullL10n=ct},(K,F,B)=>{Object.defineProperty(F,"__esModule",{value:!0}),F.XfaLayer=void 0;var D=B(25);class U{static setupStorage(it,zt,At,gt,et){const vt=gt.getValue(zt,{value:null});switch(At.name){case"textarea":if(vt.value!==null&&(it.textContent=vt.value),et==="print")break;it.addEventListener("input",Pt=>{gt.setValue(zt,{value:Pt.target.value})});break;case"input":if(At.attributes.type==="radio"||At.attributes.type==="checkbox"){if(vt.value===At.attributes.xfaOn?it.setAttribute("checked",!0):vt.value===At.attributes.xfaOff&&it.removeAttribute("checked"),et==="print")break;it.addEventListener("change",Pt=>{gt.setValue(zt,{value:Pt.target.checked?Pt.target.getAttribute("xfaOn"):Pt.target.getAttribute("xfaOff")})})}else{if(vt.value!==null&&it.setAttribute("value",vt.value),et==="print")break;it.addEventListener("input",Pt=>{gt.setValue(zt,{value:Pt.target.value})})}break;case"select":if(vt.value!==null){it.setAttribute("value",vt.value);for(const Pt of At.children)Pt.attributes.value===vt.value?Pt.attributes.selected=!0:Pt.attributes.hasOwnProperty("selected")&&delete Pt.attributes.selected}it.addEventListener("input",Pt=>{const yt=Pt.target.options,ht=yt.selectedIndex===-1?"":yt[yt.selectedIndex].value;gt.setValue(zt,{value:ht})});break}}static setAttributes({html:it,element:zt,storage:At=null,intent:gt,linkService:et}){const{attributes:vt}=zt,Pt=it instanceof HTMLAnchorElement;vt.type==="radio"&&(vt.name=`${vt.name}-${gt}`);for(const[yt,ht]of Object.entries(vt))if(ht!=null)switch(yt){case"class":ht.length&&it.setAttribute(yt,ht.join(" "));break;case"dataId":break;case"id":it.setAttribute("data-element-id",ht);break;case"style":Object.assign(it.style,ht);break;case"textContent":it.textContent=ht;break;default:(!Pt||yt!=="href"&&yt!=="newWindow")&&it.setAttribute(yt,ht)}Pt&&et.addLinkAttributes(it,vt.href,vt.newWindow),At&&vt.dataId&&this.setupStorage(it,vt.dataId,zt,At)}static render(it){var ut;const zt=it.annotationStorage,At=it.linkService,gt=it.xfaHtml,et=it.intent||"display",vt=document.createElement(gt.name);gt.attributes&&this.setAttributes({html:vt,element:gt,intent:et,linkService:At});const Pt=[[gt,-1,vt]],yt=it.div;if(yt.append(vt),it.viewport){const st=`matrix(${it.viewport.transform.join(",")})`;yt.style.transform=st}et!=="richText"&&yt.setAttribute("class","xfaLayer xfaFont");const ht=[];for(;Pt.length>0;){const[st,lt,mt]=Pt.at(-1);if(lt+1===st.children.length){Pt.pop();continue}const _t=st.children[++Pt.at(-1)[1]];if(_t===null)continue;const{name:dt}=_t;if(dt==="#text"){const Q=document.createTextNode(_t.value);ht.push(Q),mt.append(Q);continue}const Y=(ut=_t==null?void 0:_t.attributes)!=null&&ut.xmlns?document.createElementNS(_t.attributes.xmlns,dt):document.createElement(dt);if(mt.append(Y),_t.attributes&&this.setAttributes({html:Y,element:_t,storage:zt,intent:et,linkService:At}),_t.children&&_t.children.length>0)Pt.push([_t,-1,Y]);else if(_t.value){const Q=document.createTextNode(_t.value);D.XfaText.shouldBuildText(dt)&&ht.push(Q),Y.append(Q)}}for(const st of yt.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))st.setAttribute("readOnly",!0);return{textDivs:ht}}static update(it){const zt=`matrix(${it.viewport.transform.join(",")})`;it.div.style.transform=zt,it.div.hidden=!1}}F.XfaLayer=U},(K,F,B)=>{var gt,et,vt,Pt,yt,ht,ut,st,lt,mt,_t,dt,Y,Q,St,xs,X,Ps,at,Ts,Ot,ks,It,Ji,Vt,Ms,Kt,Qi,he,Rs,pt,Fs,q,Ds,J,Os,ot,Is,Tt,qe,jt,Zi,Jt,bi,Zt,Ai,Ee,Ze,Ae,ts,Ut,yi,Qt,Ls,de,es,ke,$s,Re,Ns,Te,is,Yt,vi,Dt,ti;Object.defineProperty(F,"__esModule",{value:!0}),F.InkEditor=void 0;var D=B(1),U=B(4),ct=B(29),it=B(6),zt=B(5);const re=class re extends U.AnnotationEditor{constructor($t){super({...$t,name:"inkEditor"});xt(this,St);xt(this,X);xt(this,at);xt(this,Ot);xt(this,It);xt(this,Vt);xt(this,Kt);xt(this,he);xt(this,pt);xt(this,q);xt(this,J);xt(this,ot);xt(this,Tt);xt(this,jt);xt(this,Jt);xt(this,Zt);xt(this,Ee);xt(this,Ae);xt(this,Ut);xt(this,Re);xt(this,Te);xt(this,Yt);xt(this,Dt);xt(this,gt,0);xt(this,et,0);xt(this,vt,this.canvasPointermove.bind(this));xt(this,Pt,this.canvasPointerleave.bind(this));xt(this,yt,this.canvasPointerup.bind(this));xt(this,ht,this.canvasPointerdown.bind(this));xt(this,ut,new Path2D);xt(this,st,!1);xt(this,lt,!1);xt(this,mt,!1);xt(this,_t,null);xt(this,dt,0);xt(this,Y,0);xt(this,Q,null);this.color=$t.color||null,this.thickness=$t.thickness||null,this.opacity=$t.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize($t){U.AnnotationEditor.initialize($t,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams($t,oe){switch($t){case D.AnnotationEditorParamsType.INK_THICKNESS:re._defaultThickness=oe;break;case D.AnnotationEditorParamsType.INK_COLOR:re._defaultColor=oe;break;case D.AnnotationEditorParamsType.INK_OPACITY:re._defaultOpacity=oe/100;break}}updateParams($t,oe){switch($t){case D.AnnotationEditorParamsType.INK_THICKNESS:Ft(this,St,xs).call(this,oe);break;case D.AnnotationEditorParamsType.INK_COLOR:Ft(this,X,Ps).call(this,oe);break;case D.AnnotationEditorParamsType.INK_OPACITY:Ft(this,at,Ts).call(this,oe);break}}static get defaultPropertiesToUpdate(){return[[D.AnnotationEditorParamsType.INK_THICKNESS,re._defaultThickness],[D.AnnotationEditorParamsType.INK_COLOR,re._defaultColor||U.AnnotationEditor._defaultLineColor],[D.AnnotationEditorParamsType.INK_OPACITY,Math.round(re._defaultOpacity*100)]]}get propertiesToUpdate(){return[[D.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||re._defaultThickness],[D.AnnotationEditorParamsType.INK_COLOR,this.color||re._defaultColor||U.AnnotationEditor._defaultLineColor],[D.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??re._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(Ft(this,Jt,bi).call(this),Ft(this,Zt,Ai).call(this)),this.isAttachedToDOM||(this.parent.add(this),Ft(this,Ee,Ze).call(this)),Ft(this,Dt,ti).call(this)))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,O(this,_t).disconnect(),Ht(this,_t,null),super.remove())}setParent($t){!this.parent&&$t?this._uiManager.removeShouldRescale(this):this.parent&&$t===null&&this._uiManager.addShouldRescale(this),super.setParent($t)}onScaleChanging(){const[$t,oe]=this.parentDimensions,ve=this.width*$t,ue=this.height*oe;this.setDimensions(ve,ue)}enableEditMode(){O(this,st)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",O(this,ht)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",O(this,ht)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){O(this,st)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),Ht(this,st,!0),this.div.classList.add("disabled"),Ft(this,Dt,ti).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin($t){this._focusEventsAllowed&&(super.focusin($t),this.enableEditMode())}canvasPointerdown($t){$t.button!==0||!this.isInEditMode()||O(this,st)||(this.setInForeground(),$t.preventDefault(),$t.type!=="mouse"&&this.div.focus(),Ft(this,Vt,Ms).call(this,$t.offsetX,$t.offsetY))}canvasPointermove($t){$t.preventDefault(),Ft(this,Kt,Qi).call(this,$t.offsetX,$t.offsetY)}canvasPointerup($t){$t.preventDefault(),Ft(this,jt,Zi).call(this,$t)}canvasPointerleave($t){Ft(this,jt,Zi).call(this,$t)}get isResizable(){return!this.isEmpty()&&O(this,st)}render(){if(this.div)return this.div;let $t,oe;this.width&&($t=this.x,oe=this.y),super.render(),U.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then($e=>{var ne;return(ne=this.div)==null?void 0:ne.setAttribute("aria-label",$e)});const[ve,ue,Se,we]=Ft(this,Ot,ks).call(this);if(this.setAt(ve,ue,0,0),this.setDims(Se,we),Ft(this,Jt,bi).call(this),this.width){const[$e,ne]=this.parentDimensions;this.setAspectRatio(this.width*$e,this.height*ne),this.setAt($t*$e,oe*ne,this.width*$e,this.height*ne),Ht(this,mt,!0),Ft(this,Ee,Ze).call(this),this.setDims(this.width*$e,this.height*ne),Ft(this,Tt,qe).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return Ft(this,Zt,Ai).call(this),this.div}setDimensions($t,oe){const ve=Math.round($t),ue=Math.round(oe);if(O(this,dt)===ve&&O(this,Y)===ue)return;Ht(this,dt,ve),Ht(this,Y,ue),this.canvas.style.visibility="hidden";const[Se,we]=this.parentDimensions;this.width=$t/Se,this.height=oe/we,this.fixAndSetPosition(),O(this,st)&&Ft(this,Ae,ts).call(this,$t,oe),Ft(this,Ee,Ze).call(this),Ft(this,Tt,qe).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize($t,oe,ve){var Mt,Lt,Gt;if($t instanceof ct.InkAnnotationElement)return null;const ue=super.deserialize($t,oe,ve);ue.thickness=$t.thickness,ue.color=D.Util.makeHexColor(...$t.color),ue.opacity=$t.opacity;const[Se,we]=ue.pageDimensions,$e=ue.width*Se,ne=ue.height*we,Ie=ue.parentScale,ye=$t.thickness/2;Ht(ue,st,!0),Ht(ue,dt,Math.round($e)),Ht(ue,Y,Math.round(ne));const{paths:Et,rect:W,rotation:nt}=$t;for(let{bezier:ie}of Et){ie=Ft(Mt=re,ke,$s).call(Mt,ie,W,nt);const ge=[];ue.paths.push(ge);let pe=Ie*(ie[0]-ye),Me=Ie*(ie[1]-ye);for(let be=2,Ce=ie.length;be<Ce;be+=6){const De=Ie*(ie[be]-ye),Le=Ie*(ie[be+1]-ye),Ne=Ie*(ie[be+2]-ye),We=Ie*(ie[be+3]-ye),He=Ie*(ie[be+4]-ye),ze=Ie*(ie[be+5]-ye);ge.push([[pe,Me],[De,Le],[Ne,We],[He,ze]]),pe=He,Me=ze}const _e=Ft(this,Qt,Ls).call(this,ge);ue.bezierPath2D.push(_e)}const Ct=Ft(Lt=ue,Te,is).call(Lt);return Ht(ue,et,Math.max(U.AnnotationEditor.MIN_SIZE,Ct[2]-Ct[0])),Ht(ue,gt,Math.max(U.AnnotationEditor.MIN_SIZE,Ct[3]-Ct[1])),Ft(Gt=ue,Ae,ts).call(Gt,$e,ne),ue}serialize(){if(this.isEmpty())return null;const $t=this.getRect(0,0),oe=U.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:D.AnnotationEditorType.INK,color:oe,thickness:this.thickness,opacity:this.opacity,paths:Ft(this,Re,Ns).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,$t),pageIndex:this.pageIndex,rect:$t,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};gt=new WeakMap,et=new WeakMap,vt=new WeakMap,Pt=new WeakMap,yt=new WeakMap,ht=new WeakMap,ut=new WeakMap,st=new WeakMap,lt=new WeakMap,mt=new WeakMap,_t=new WeakMap,dt=new WeakMap,Y=new WeakMap,Q=new WeakMap,St=new WeakSet,xs=function($t){const oe=this.thickness;this.addCommands({cmd:()=>{this.thickness=$t,Ft(this,Dt,ti).call(this)},undo:()=>{this.thickness=oe,Ft(this,Dt,ti).call(this)},mustExec:!0,type:D.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},X=new WeakSet,Ps=function($t){const oe=this.color;this.addCommands({cmd:()=>{this.color=$t,Ft(this,Tt,qe).call(this)},undo:()=>{this.color=oe,Ft(this,Tt,qe).call(this)},mustExec:!0,type:D.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},at=new WeakSet,Ts=function($t){$t/=100;const oe=this.opacity;this.addCommands({cmd:()=>{this.opacity=$t,Ft(this,Tt,qe).call(this)},undo:()=>{this.opacity=oe,Ft(this,Tt,qe).call(this)},mustExec:!0,type:D.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},Ot=new WeakSet,ks=function(){const{parentRotation:$t,parentDimensions:[oe,ve]}=this;switch($t){case 90:return[0,ve,ve,oe];case 180:return[oe,ve,oe,ve];case 270:return[oe,0,ve,oe];default:return[0,0,oe,ve]}},It=new WeakSet,Ji=function(){const{ctx:$t,color:oe,opacity:ve,thickness:ue,parentScale:Se,scaleFactor:we}=this;$t.lineWidth=ue*Se/we,$t.lineCap="round",$t.lineJoin="round",$t.miterLimit=10,$t.strokeStyle=`${oe}${(0,zt.opacityToHex)(ve)}`},Vt=new WeakSet,Ms=function($t,oe){this.canvas.addEventListener("contextmenu",it.noContextMenu),this.canvas.addEventListener("pointerleave",O(this,Pt)),this.canvas.addEventListener("pointermove",O(this,vt)),this.canvas.addEventListener("pointerup",O(this,yt)),this.canvas.removeEventListener("pointerdown",O(this,ht)),this.isEditing=!0,O(this,mt)||(Ht(this,mt,!0),Ft(this,Ee,Ze).call(this),this.thickness||(this.thickness=re._defaultThickness),this.color||(this.color=re._defaultColor||U.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=re._defaultOpacity)),this.currentPath.push([$t,oe]),Ht(this,lt,!1),Ft(this,It,Ji).call(this),Ht(this,Q,()=>{Ft(this,q,Ds).call(this),O(this,Q)&&window.requestAnimationFrame(O(this,Q))}),window.requestAnimationFrame(O(this,Q))},Kt=new WeakSet,Qi=function($t,oe){const[ve,ue]=this.currentPath.at(-1);if(this.currentPath.length>1&&$t===ve&&oe===ue)return;const Se=this.currentPath;let we=O(this,ut);if(Se.push([$t,oe]),Ht(this,lt,!0),Se.length<=2){we.moveTo(...Se[0]),we.lineTo($t,oe);return}Se.length===3&&(Ht(this,ut,we=new Path2D),we.moveTo(...Se[0])),Ft(this,J,Os).call(this,we,...Se.at(-3),...Se.at(-2),$t,oe)},he=new WeakSet,Rs=function(){if(this.currentPath.length===0)return;const $t=this.currentPath.at(-1);O(this,ut).lineTo(...$t)},pt=new WeakSet,Fs=function($t,oe){Ht(this,Q,null),$t=Math.min(Math.max($t,0),this.canvas.width),oe=Math.min(Math.max(oe,0),this.canvas.height),Ft(this,Kt,Qi).call(this,$t,oe),Ft(this,he,Rs).call(this);let ve;if(this.currentPath.length!==1)ve=Ft(this,ot,Is).call(this);else{const ne=[$t,oe];ve=[[ne,ne.slice(),ne.slice(),ne]]}const ue=O(this,ut),Se=this.currentPath;this.currentPath=[],Ht(this,ut,new Path2D);const we=()=>{this.allRawPaths.push(Se),this.paths.push(ve),this.bezierPath2D.push(ue),this.rebuild()},$e=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(Ft(this,Jt,bi).call(this),Ft(this,Zt,Ai).call(this)),Ft(this,Dt,ti).call(this))};this.addCommands({cmd:we,undo:$e,mustExec:!0})},q=new WeakSet,Ds=function(){if(!O(this,lt))return;Ht(this,lt,!1);const $t=Math.ceil(this.thickness*this.parentScale),oe=this.currentPath.slice(-3),ve=oe.map(we=>we[0]),ue=oe.map(we=>we[1]);Math.min(...ve)-$t,Math.max(...ve)+$t,Math.min(...ue)-$t,Math.max(...ue)+$t;const{ctx:Se}=this;Se.save(),Se.clearRect(0,0,this.canvas.width,this.canvas.height);for(const we of this.bezierPath2D)Se.stroke(we);Se.stroke(O(this,ut)),Se.restore()},J=new WeakSet,Os=function($t,oe,ve,ue,Se,we,$e){const ne=(oe+ue)/2,Ie=(ve+Se)/2,ye=(ue+we)/2,Et=(Se+$e)/2;$t.bezierCurveTo(ne+2*(ue-ne)/3,Ie+2*(Se-Ie)/3,ye+2*(ue-ye)/3,Et+2*(Se-Et)/3,ye,Et)},ot=new WeakSet,Is=function(){const $t=this.currentPath;if($t.length<=2)return[[$t[0],$t[0],$t.at(-1),$t.at(-1)]];const oe=[];let ve,[ue,Se]=$t[0];for(ve=1;ve<$t.length-2;ve++){const[W,nt]=$t[ve],[Ct,Mt]=$t[ve+1],Lt=(W+Ct)/2,Gt=(nt+Mt)/2,ie=[ue+2*(W-ue)/3,Se+2*(nt-Se)/3],ge=[Lt+2*(W-Lt)/3,Gt+2*(nt-Gt)/3];oe.push([[ue,Se],ie,ge,[Lt,Gt]]),[ue,Se]=[Lt,Gt]}const[we,$e]=$t[ve],[ne,Ie]=$t[ve+1],ye=[ue+2*(we-ue)/3,Se+2*($e-Se)/3],Et=[ne+2*(we-ne)/3,Ie+2*($e-Ie)/3];return oe.push([[ue,Se],ye,Et,[ne,Ie]]),oe},Tt=new WeakSet,qe=function(){if(this.isEmpty()){Ft(this,Ut,yi).call(this);return}Ft(this,It,Ji).call(this);const{canvas:$t,ctx:oe}=this;oe.setTransform(1,0,0,1,0,0),oe.clearRect(0,0,$t.width,$t.height),Ft(this,Ut,yi).call(this);for(const ve of this.bezierPath2D)oe.stroke(ve)},jt=new WeakSet,Zi=function($t){this.canvas.removeEventListener("pointerleave",O(this,Pt)),this.canvas.removeEventListener("pointermove",O(this,vt)),this.canvas.removeEventListener("pointerup",O(this,yt)),this.canvas.addEventListener("pointerdown",O(this,ht)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",it.noContextMenu)},10),Ft(this,pt,Fs).call(this,$t.offsetX,$t.offsetY),this.addToAnnotationStorage(),this.setInBackground()},Jt=new WeakSet,bi=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",U.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then($t=>{var oe;return(oe=this.canvas)==null?void 0:oe.setAttribute("aria-label",$t)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},Zt=new WeakSet,Ai=function(){Ht(this,_t,new ResizeObserver($t=>{const oe=$t[0].contentRect;oe.width&&oe.height&&this.setDimensions(oe.width,oe.height)})),O(this,_t).observe(this.div)},Ee=new WeakSet,Ze=function(){if(!O(this,mt))return;const[$t,oe]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*$t),this.canvas.height=Math.ceil(this.height*oe),Ft(this,Ut,yi).call(this)},Ae=new WeakSet,ts=function($t,oe){const ve=Ft(this,Yt,vi).call(this),ue=($t-ve)/O(this,et),Se=(oe-ve)/O(this,gt);this.scaleFactor=Math.min(ue,Se)},Ut=new WeakSet,yi=function(){const $t=Ft(this,Yt,vi).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+$t,this.translationY*this.scaleFactor+$t)},Qt=new WeakSet,Ls=function($t){const oe=new Path2D;for(let ve=0,ue=$t.length;ve<ue;ve++){const[Se,we,$e,ne]=$t[ve];ve===0&&oe.moveTo(...Se),oe.bezierCurveTo(we[0],we[1],$e[0],$e[1],ne[0],ne[1])}return oe},de=new WeakSet,es=function($t,oe,ve){const[ue,Se,we,$e]=oe;switch(ve){case 0:for(let ne=0,Ie=$t.length;ne<Ie;ne+=2)$t[ne]+=ue,$t[ne+1]=$e-$t[ne+1];break;case 90:for(let ne=0,Ie=$t.length;ne<Ie;ne+=2){const ye=$t[ne];$t[ne]=$t[ne+1]+ue,$t[ne+1]=ye+Se}break;case 180:for(let ne=0,Ie=$t.length;ne<Ie;ne+=2)$t[ne]=we-$t[ne],$t[ne+1]+=Se;break;case 270:for(let ne=0,Ie=$t.length;ne<Ie;ne+=2){const ye=$t[ne];$t[ne]=we-$t[ne+1],$t[ne+1]=$e-ye}break;default:throw new Error("Invalid rotation")}return $t},ke=new WeakSet,$s=function($t,oe,ve){const[ue,Se,we,$e]=oe;switch(ve){case 0:for(let ne=0,Ie=$t.length;ne<Ie;ne+=2)$t[ne]-=ue,$t[ne+1]=$e-$t[ne+1];break;case 90:for(let ne=0,Ie=$t.length;ne<Ie;ne+=2){const ye=$t[ne];$t[ne]=$t[ne+1]-Se,$t[ne+1]=ye-ue}break;case 180:for(let ne=0,Ie=$t.length;ne<Ie;ne+=2)$t[ne]=we-$t[ne],$t[ne+1]-=Se;break;case 270:for(let ne=0,Ie=$t.length;ne<Ie;ne+=2){const ye=$t[ne];$t[ne]=$e-$t[ne+1],$t[ne+1]=we-ye}break;default:throw new Error("Invalid rotation")}return $t},Re=new WeakSet,Ns=function($t,oe,ve,ue){var Ie,ye;const Se=[],we=this.thickness/2,$e=$t*oe+we,ne=$t*ve+we;for(const Et of this.paths){const W=[],nt=[];for(let Ct=0,Mt=Et.length;Ct<Mt;Ct++){const[Lt,Gt,ie,ge]=Et[Ct],pe=$t*Lt[0]+$e,Me=$t*Lt[1]+ne,_e=$t*Gt[0]+$e,be=$t*Gt[1]+ne,Ce=$t*ie[0]+$e,De=$t*ie[1]+ne,Le=$t*ge[0]+$e,Ne=$t*ge[1]+ne;Ct===0&&(W.push(pe,Me),nt.push(pe,Me)),W.push(_e,be,Ce,De,Le,Ne),nt.push(_e,be),Ct===Mt-1&&nt.push(Le,Ne)}Se.push({bezier:Ft(Ie=re,de,es).call(Ie,W,ue,this.rotation),points:Ft(ye=re,de,es).call(ye,nt,ue,this.rotation)})}return Se},Te=new WeakSet,is=function(){let $t=1/0,oe=-1/0,ve=1/0,ue=-1/0;for(const Se of this.paths)for(const[we,$e,ne,Ie]of Se){const ye=D.Util.bezierBoundingBox(...we,...$e,...ne,...Ie);$t=Math.min($t,ye[0]),ve=Math.min(ve,ye[1]),oe=Math.max(oe,ye[2]),ue=Math.max(ue,ye[3])}return[$t,ve,oe,ue]},Yt=new WeakSet,vi=function(){return O(this,st)?Math.ceil(this.thickness*this.parentScale):0},Dt=new WeakSet,ti=function($t=!1){if(this.isEmpty())return;if(!O(this,st)){Ft(this,Tt,qe).call(this);return}const oe=Ft(this,Te,is).call(this),ve=Ft(this,Yt,vi).call(this);Ht(this,et,Math.max(U.AnnotationEditor.MIN_SIZE,oe[2]-oe[0])),Ht(this,gt,Math.max(U.AnnotationEditor.MIN_SIZE,oe[3]-oe[1]));const ue=Math.ceil(ve+O(this,et)*this.scaleFactor),Se=Math.ceil(ve+O(this,gt)*this.scaleFactor),[we,$e]=this.parentDimensions;this.width=ue/we,this.height=Se/$e,this.setAspectRatio(ue,Se);const ne=this.translationX,Ie=this.translationY;this.translationX=-oe[0],this.translationY=-oe[1],Ft(this,Ee,Ze).call(this),Ft(this,Tt,qe).call(this),Ht(this,dt,ue),Ht(this,Y,Se),this.setDims(ue,Se);const ye=$t?ve/this.scaleFactor/2:0;this.translate(ne-this.translationX-ye,Ie-this.translationY-ye)},xt(re,Qt),xt(re,de),xt(re,ke),je(re,"_defaultColor",null),je(re,"_defaultOpacity",1),je(re,"_defaultThickness",1),je(re,"_type","ink");let At=re;F.InkEditor=At},(K,F,B)=>{var At,gt,et,vt,Pt,yt,ht,ut,st,lt,mt,oi,dt,li,Q,Si,rt,ss,bt,Us,kt,Bs,ft,ns,qt,wi,Rt,js;Object.defineProperty(F,"__esModule",{value:!0}),F.StampEditor=void 0;var D=B(1),U=B(4),ct=B(6),it=B(29);const ee=class ee extends U.AnnotationEditor{constructor(pt){super({...pt,name:"stampEditor"});xt(this,mt);xt(this,dt);xt(this,Q);xt(this,rt);xt(this,bt);xt(this,kt);xt(this,ft);xt(this,qt);xt(this,Rt);xt(this,At,null);xt(this,gt,null);xt(this,et,null);xt(this,vt,null);xt(this,Pt,null);xt(this,yt,null);xt(this,ht,null);xt(this,ut,null);xt(this,st,!1);xt(this,lt,!1);Ht(this,vt,pt.bitmapUrl),Ht(this,Pt,pt.bitmapFile)}static initialize(pt){U.AnnotationEditor.initialize(pt)}static get supportedTypes(){const pt=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,D.shadow)(this,"supportedTypes",pt.map(z=>`image/${z}`))}static get supportedTypesStr(){return(0,D.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(pt){return this.supportedTypes.includes(pt)}static paste(pt,z){z.pasteEditor(D.AnnotationEditorType.STAMP,{bitmapFile:pt.getAsFile()})}remove(){var pt,z;O(this,gt)&&(Ht(this,At,null),this._uiManager.imageManager.deleteId(O(this,gt)),(pt=O(this,yt))==null||pt.remove(),Ht(this,yt,null),(z=O(this,ht))==null||z.disconnect(),Ht(this,ht,null)),super.remove()}rebuild(){if(!this.parent){O(this,gt)&&Ft(this,Q,Si).call(this);return}super.rebuild(),this.div!==null&&(O(this,gt)&&Ft(this,Q,Si).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(O(this,et)||O(this,At)||O(this,vt)||O(this,Pt))}get isResizable(){return!0}render(){if(this.div)return this.div;let pt,z;if(this.width&&(pt=this.x,z=this.y),super.render(),this.div.hidden=!0,O(this,At)?Ft(this,rt,ss).call(this):Ft(this,Q,Si).call(this),this.width){const[q,G]=this.parentDimensions;this.setAt(pt*q,z*G,this.width*q,this.height*G)}return this.div}static deserialize(pt,z,q){if(pt instanceof it.StampAnnotationElement)return null;const G=super.deserialize(pt,z,q),{rect:J,bitmapUrl:tt,bitmapId:ot,isSvg:wt,accessibilityData:Tt}=pt;ot&&q.imageManager.isValidId(ot)?Ht(G,gt,ot):Ht(G,vt,tt),Ht(G,st,wt);const[Wt,jt]=G.pageDimensions;return G.width=(J[2]-J[0])/Wt,G.height=(J[3]-J[1])/jt,Tt&&(G.altTextData=Tt),G}serialize(pt=!1,z=null){if(this.isEmpty())return null;const q={annotationType:D.AnnotationEditorType.STAMP,bitmapId:O(this,gt),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:O(this,st),structTreeParentId:this._structTreeParentId};if(pt)return q.bitmapUrl=Ft(this,qt,wi).call(this,!0),q.accessibilityData=this.altTextData,q;const{decorative:G,altText:J}=this.altTextData;if(!G&&J&&(q.accessibilityData={type:"Figure",alt:J}),z===null)return q;z.stamps||(z.stamps=new Map);const tt=O(this,st)?(q.rect[2]-q.rect[0])*(q.rect[3]-q.rect[1]):null;if(!z.stamps.has(O(this,gt)))z.stamps.set(O(this,gt),{area:tt,serialized:q}),q.bitmap=Ft(this,qt,wi).call(this,!1);else if(O(this,st)){const ot=z.stamps.get(O(this,gt));tt>ot.area&&(ot.area=tt,ot.serialized.bitmap.close(),ot.serialized.bitmap=Ft(this,qt,wi).call(this,!1))}return q}};At=new WeakMap,gt=new WeakMap,et=new WeakMap,vt=new WeakMap,Pt=new WeakMap,yt=new WeakMap,ht=new WeakMap,ut=new WeakMap,st=new WeakMap,lt=new WeakMap,mt=new WeakSet,oi=function(pt,z=!1){if(!pt){this.remove();return}Ht(this,At,pt.bitmap),z||(Ht(this,gt,pt.id),Ht(this,st,pt.isSvg)),Ft(this,rt,ss).call(this)},dt=new WeakSet,li=function(){Ht(this,et,null),this._uiManager.enableWaiting(!1),O(this,yt)&&this.div.focus()},Q=new WeakSet,Si=function(){if(O(this,gt)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(O(this,gt)).then(z=>Ft(this,mt,oi).call(this,z,!0)).finally(()=>Ft(this,dt,li).call(this));return}if(O(this,vt)){const z=O(this,vt);Ht(this,vt,null),this._uiManager.enableWaiting(!0),Ht(this,et,this._uiManager.imageManager.getFromUrl(z).then(q=>Ft(this,mt,oi).call(this,q)).finally(()=>Ft(this,dt,li).call(this)));return}if(O(this,Pt)){const z=O(this,Pt);Ht(this,Pt,null),this._uiManager.enableWaiting(!0),Ht(this,et,this._uiManager.imageManager.getFromFile(z).then(q=>Ft(this,mt,oi).call(this,q)).finally(()=>Ft(this,dt,li).call(this)));return}const pt=document.createElement("input");pt.type="file",pt.accept=ee.supportedTypesStr,Ht(this,et,new Promise(z=>{pt.addEventListener("change",async()=>{if(!pt.files||pt.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const q=await this._uiManager.imageManager.getFromFile(pt.files[0]);Ft(this,mt,oi).call(this,q)}z()}),pt.addEventListener("cancel",()=>{this.remove(),z()})}).finally(()=>Ft(this,dt,li).call(this))),pt.click()},rt=new WeakSet,ss=function(){const{div:pt}=this;let{width:z,height:q}=O(this,At);const[G,J]=this.pageDimensions,tt=.75;if(this.width)z=this.width*G,q=this.height*J;else if(z>tt*G||q>tt*J){const Wt=Math.min(tt*G/z,tt*J/q);z*=Wt,q*=Wt}const[ot,wt]=this.parentDimensions;this.setDims(z*ot/G,q*wt/J),this._uiManager.enableWaiting(!1);const Tt=Ht(this,yt,document.createElement("canvas"));pt.append(Tt),pt.hidden=!1,Ft(this,ft,ns).call(this,z,q),Ft(this,Rt,js).call(this),O(this,lt)||(this.parent.addUndoableEditor(this),Ht(this,lt,!0)),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()},bt=new WeakSet,Us=function(pt,z){var tt;const[q,G]=this.parentDimensions;this.width=pt/q,this.height=z/G,this.setDims(pt,z),(tt=this._initialOptions)!=null&&tt.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,O(this,ut)!==null&&clearTimeout(O(this,ut)),Ht(this,ut,setTimeout(()=>{Ht(this,ut,null),Ft(this,ft,ns).call(this,pt,z)},200))},kt=new WeakSet,Bs=function(pt,z){const{width:q,height:G}=O(this,At);let J=q,tt=G,ot=O(this,At);for(;J>2*pt||tt>2*z;){const wt=J,Tt=tt;J>2*pt&&(J=J>=16384?Math.floor(J/2)-1:Math.ceil(J/2)),tt>2*z&&(tt=tt>=16384?Math.floor(tt/2)-1:Math.ceil(tt/2));const Wt=new OffscreenCanvas(J,tt);Wt.getContext("2d").drawImage(ot,0,0,wt,Tt,0,0,J,tt),ot=Wt.transferToImageBitmap()}return ot},ft=new WeakSet,ns=function(pt,z){pt=Math.ceil(pt),z=Math.ceil(z);const q=O(this,yt);if(!q||q.width===pt&&q.height===z)return;q.width=pt,q.height=z;const G=O(this,st)?O(this,At):Ft(this,kt,Bs).call(this,pt,z),J=q.getContext("2d");J.filter=this._uiManager.hcmFilter,J.drawImage(G,0,0,G.width,G.height,0,0,pt,z)},qt=new WeakSet,wi=function(pt){if(pt){if(O(this,st)){const G=this._uiManager.imageManager.getSvgUrl(O(this,gt));if(G)return G}const z=document.createElement("canvas");return{width:z.width,height:z.height}=O(this,At),z.getContext("2d").drawImage(O(this,At),0,0),z.toDataURL()}if(O(this,st)){const[z,q]=this.pageDimensions,G=Math.round(this.width*z*ct.PixelsPerInch.PDF_TO_CSS_UNITS),J=Math.round(this.height*q*ct.PixelsPerInch.PDF_TO_CSS_UNITS),tt=new OffscreenCanvas(G,J);return tt.getContext("2d").drawImage(O(this,At),0,0,O(this,At).width,O(this,At).height,0,0,G,J),tt.transferToImageBitmap()}return structuredClone(O(this,At))},Rt=new WeakSet,js=function(){Ht(this,ht,new ResizeObserver(pt=>{const z=pt[0].contentRect;z.width&&z.height&&Ft(this,bt,Us).call(this,z.width,z.height)})),O(this,ht).observe(this.div)},je(ee,"_type","stamp");let zt=ee;F.StampEditor=zt}],__webpack_module_cache__={};function __w_pdfjs_require__(K){var F=__webpack_module_cache__[K];if(F!==void 0)return F.exports;var B=__webpack_module_cache__[K]={exports:{}};return __webpack_modules__[K](B,B.exports,__w_pdfjs_require__),B.exports}var __webpack_exports__={};return(()=>{var K=__webpack_exports__;Object.defineProperty(K,"__esModule",{value:!0}),Object.defineProperty(K,"AbortException",{enumerable:!0,get:function(){return F.AbortException}}),Object.defineProperty(K,"AnnotationEditorLayer",{enumerable:!0,get:function(){return ct.AnnotationEditorLayer}}),Object.defineProperty(K,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return F.AnnotationEditorParamsType}}),Object.defineProperty(K,"AnnotationEditorType",{enumerable:!0,get:function(){return F.AnnotationEditorType}}),Object.defineProperty(K,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return it.AnnotationEditorUIManager}}),Object.defineProperty(K,"AnnotationLayer",{enumerable:!0,get:function(){return zt.AnnotationLayer}}),Object.defineProperty(K,"AnnotationMode",{enumerable:!0,get:function(){return F.AnnotationMode}}),Object.defineProperty(K,"CMapCompressionType",{enumerable:!0,get:function(){return F.CMapCompressionType}}),Object.defineProperty(K,"DOMSVGFactory",{enumerable:!0,get:function(){return D.DOMSVGFactory}}),Object.defineProperty(K,"FeatureTest",{enumerable:!0,get:function(){return F.FeatureTest}}),Object.defineProperty(K,"GlobalWorkerOptions",{enumerable:!0,get:function(){return At.GlobalWorkerOptions}}),Object.defineProperty(K,"ImageKind",{enumerable:!0,get:function(){return F.ImageKind}}),Object.defineProperty(K,"InvalidPDFException",{enumerable:!0,get:function(){return F.InvalidPDFException}}),Object.defineProperty(K,"MissingPDFException",{enumerable:!0,get:function(){return F.MissingPDFException}}),Object.defineProperty(K,"OPS",{enumerable:!0,get:function(){return F.OPS}}),Object.defineProperty(K,"PDFDataRangeTransport",{enumerable:!0,get:function(){return B.PDFDataRangeTransport}}),Object.defineProperty(K,"PDFDateString",{enumerable:!0,get:function(){return D.PDFDateString}}),Object.defineProperty(K,"PDFWorker",{enumerable:!0,get:function(){return B.PDFWorker}}),Object.defineProperty(K,"PasswordResponses",{enumerable:!0,get:function(){return F.PasswordResponses}}),Object.defineProperty(K,"PermissionFlag",{enumerable:!0,get:function(){return F.PermissionFlag}}),Object.defineProperty(K,"PixelsPerInch",{enumerable:!0,get:function(){return D.PixelsPerInch}}),Object.defineProperty(K,"PromiseCapability",{enumerable:!0,get:function(){return F.PromiseCapability}}),Object.defineProperty(K,"RenderingCancelledException",{enumerable:!0,get:function(){return D.RenderingCancelledException}}),Object.defineProperty(K,"SVGGraphics",{enumerable:!0,get:function(){return B.SVGGraphics}}),Object.defineProperty(K,"UnexpectedResponseException",{enumerable:!0,get:function(){return F.UnexpectedResponseException}}),Object.defineProperty(K,"Util",{enumerable:!0,get:function(){return F.Util}}),Object.defineProperty(K,"VerbosityLevel",{enumerable:!0,get:function(){return F.VerbosityLevel}}),Object.defineProperty(K,"XfaLayer",{enumerable:!0,get:function(){return gt.XfaLayer}}),Object.defineProperty(K,"build",{enumerable:!0,get:function(){return B.build}}),Object.defineProperty(K,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return F.createValidAbsoluteUrl}}),Object.defineProperty(K,"getDocument",{enumerable:!0,get:function(){return B.getDocument}}),Object.defineProperty(K,"getFilenameFromUrl",{enumerable:!0,get:function(){return D.getFilenameFromUrl}}),Object.defineProperty(K,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return D.getPdfFilenameFromUrl}}),Object.defineProperty(K,"getXfaPageViewport",{enumerable:!0,get:function(){return D.getXfaPageViewport}}),Object.defineProperty(K,"isDataScheme",{enumerable:!0,get:function(){return D.isDataScheme}}),Object.defineProperty(K,"isPdfFile",{enumerable:!0,get:function(){return D.isPdfFile}}),Object.defineProperty(K,"loadScript",{enumerable:!0,get:function(){return D.loadScript}}),Object.defineProperty(K,"noContextMenu",{enumerable:!0,get:function(){return D.noContextMenu}}),Object.defineProperty(K,"normalizeUnicode",{enumerable:!0,get:function(){return F.normalizeUnicode}}),Object.defineProperty(K,"renderTextLayer",{enumerable:!0,get:function(){return U.renderTextLayer}}),Object.defineProperty(K,"setLayerDimensions",{enumerable:!0,get:function(){return D.setLayerDimensions}}),Object.defineProperty(K,"shadow",{enumerable:!0,get:function(){return F.shadow}}),Object.defineProperty(K,"updateTextLayer",{enumerable:!0,get:function(){return U.updateTextLayer}}),Object.defineProperty(K,"version",{enumerable:!0,get:function(){return B.version}});var F=__w_pdfjs_require__(1),B=__w_pdfjs_require__(2),D=__w_pdfjs_require__(6),U=__w_pdfjs_require__(26),ct=__w_pdfjs_require__(27),it=__w_pdfjs_require__(5),zt=__w_pdfjs_require__(29),At=__w_pdfjs_require__(14),gt=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports,__defProp$4=Object.defineProperty,__getOwnPropDesc$4=Object.getOwnPropertyDescriptor,__decorateClass$4=(K,F,B,D)=>{for(var U=D>1?void 0:D?__getOwnPropDesc$4(F,B):F,ct=K.length-1,it;ct>=0;ct--)(it=K[ct])&&(U=(D?it(F,B,U):it(U))||U);return D&&U&&__defProp$4(F,B,U),U};pdfExports.GlobalWorkerOptions.workerSrc="pdf.worker.js";let PDFViewer=class extends s{constructor(){super(...arguments),this.tabIndex=0,this.indicator=0,this._onkeydown=K=>{K.key==="ArrowRight"?(this.position++,this.fireSelectEvent()):K.key==="ArrowLeft"&&(this.position--,this.fireSelectEvent())},this._touchStart={x:0,y:0},this._onTouchStart=K=>{this._touchStart={x:K.touches[0].clientX,y:K.touches[0].clientY}},this._onTouchEnd=K=>{const F=K.changedTouches[0].clientX,B=K.changedTouches[0].clientY,D=50;absoluteDistance(this._touchStart.y,B)>absoluteDistance(this._touchStart.x,F)||(this._touchStart.x-F>D?(this.position++,this.fireSelectEvent()):F-this._touchStart.x>D&&(this.position--,this.fireSelectEvent()))}}render(){return x`
      <slot>
        <p>
          Get your sheet together!
          <br>
          Load a PDF ⬆️
          <br>
          or try <a href="#" @click=${()=>this.load("martin.pdf")}>Bratec Martin</a> example
        </p>
      </slot>
    `}async load(K){this.innerHTML="";const F=window.devicePixelRatio||1,B=await pdfExports.getDocument(K).promise;for(let D=0;D<B.numPages;D++){const U=await B.getPage(D+1),ct=U.getViewport({scale:1}),it=document.createElement("canvas"),zt=it.getContext("2d");it.height=ct.height*F,it.width=ct.width*F,this.appendChild(it),it.onclick=()=>{this.position=D,this.fireSelectEvent()};const At=F!==1?[F,0,0,F,0,0]:void 0;await U.render({canvasContext:zt,viewport:ct,transform:At}).promise}}set position(K){const F=[...this.children];if(K<0||K>=F.length)return;const B=F[K];F.forEach(D=>D.removeAttribute("selected")),B.setAttribute("selected",""),B.scrollIntoView({block:"center"})}get position(){return[...this.children].findIndex(K=>K.hasAttribute("selected"))}connectedCallback(){var K;super.connectedCallback(),this.addEventListener("keydown",this._onkeydown),this.addEventListener("touchstart",this._onTouchStart),this.addEventListener("touchend",this._onTouchEnd),(K=window.ipcRenderer)==null||K.on("page",(F,B)=>{this.position=B})}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("keydown",this._onkeydown),this.removeEventListener("touchstart",this._onTouchStart),this.removeEventListener("touchend",this._onTouchEnd)}fireSelectEvent(){var K;(K=window.ipcRenderer)==null||K.send("page",this.position),this.dispatchEvent(new CustomEvent("select",{detail:this.position}))}};PDFViewer.styles=i$2`
    :host {
      min-height: 50px;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      align-items: center;
      overflow: auto;
      padding: 0.5rem;
      outline: none;
    }
    :host:focus {
      background: var(--theme-color-background-light);
    }
    :host:fullscreen {
      background: black;
    }
    ::slotted(canvas) {
      max-height: 100%;
      max-width: 100%;
    }
    ::slotted(canvas[selected]) {
      box-shadow: 0 0 0 5px var(--theme-color-primary);
    }
    p {
      text-align: center;
    }
  `;__decorateClass$4([n({type:Number})],PDFViewer.prototype,"indicator",2);PDFViewer=__decorateClass$4([t("pdf-viewer")],PDFViewer);var __defProp$3=Object.defineProperty,__getOwnPropDesc$3=Object.getOwnPropertyDescriptor,__decorateClass$3=(K,F,B,D)=>{for(var U=D>1?void 0:D?__getOwnPropDesc$3(F,B):F,ct=K.length-1,it;ct>=0;ct--)(it=K[ct])&&(U=(D?it(F,B,U):it(U))||U);return D&&U&&__defProp$3(F,B,U),U};const storage=localStorage.getItem("recognitionOptions"),recognitionOptions=storage?JSON.parse(storage):{minDistance:7,maxDistance:42,seekStep:2.6,treshold:100},descriptions={minDistance:"Shortest seek distance from current frame.",maxDistance:"Longest seek distance from current frame.",seekStep:"How many frames to add to seek distance when recognizer predicts the same frame as before.",treshold:"How different can current microphone data be compared to a frame from recording to be considered a match. 0 means identical, 255 means completely different."};let RecognitionOptions=class extends s{constructor(){super(...arguments),this.minDistance=recognitionOptions.minDistance,this.maxDistance=recognitionOptions.maxDistance,this.seekStep=recognitionOptions.seekStep,this.treshold=recognitionOptions.treshold}render(){return x`
      <div>
        <label for="minDistance" title=${descriptions.minDistance}>Min Distance</label>
        <input 
          type="number" id="minDistance"
          min="1" max=${this.maxDistance-1}
          .value=${this.minDistance.toString()} 
          @change=${K=>{this.minDistance=Number(K.target.value),this.maxDistance=Math.max(this.minDistance+1,this.maxDistance)}} />
      </div>
      <div>
        <label for="maxDistance" title=${descriptions.maxDistance}>Max Distance</label>
        <input 
          type="number" id="maxDistance" 
          min=${this.minDistance+1}
          .value=${this.maxDistance.toString()}
          @change=${K=>{this.maxDistance=Number(K.target.value),this.minDistance=Math.max(0,Math.min(this.maxDistance-1,this.minDistance))}} />
      </div>
      <div>
        <label for="seekStep" title=${descriptions.seekStep}>Seek Step</label>
        <input 
          type="number" id="seekStep"
          step=".1" min="1"
          .value=${this.seekStep.toString()} 
          @change=${K=>this.seekStep=Number(K.target.value)} />
      </div>
      <div>
        <label for="treshold" title=${descriptions.treshold}>Treshold</label>
        <input 
          type="number" id="treshold" 
          min="0" max="255" 
          .value=${this.treshold.toString()} 
          @input=${K=>this.treshold=Number(K.target.value)} 
        />
      </div>
    `}updated(){localStorage.setItem("recognitionOptions",JSON.stringify({minDistance:this.minDistance,maxDistance:this.maxDistance,seekStep:this.seekStep,treshold:this.treshold}))}};RecognitionOptions.styles=i$2`
    :host {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 1em;
      justify-content: center;
      margin: 0 auto;
    }
    div {
      min-width: 120px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
    }
    input {
      margin: 0.5em 0;
      width: 6ch;
    }

  `;__decorateClass$3([n({type:Number})],RecognitionOptions.prototype,"minDistance",2);__decorateClass$3([n({type:Number})],RecognitionOptions.prototype,"maxDistance",2);__decorateClass$3([n({type:Number})],RecognitionOptions.prototype,"seekStep",2);__decorateClass$3([n({type:Number})],RecognitionOptions.prototype,"treshold",2);RecognitionOptions=__decorateClass$3([t("recognition-options")],RecognitionOptions);var __defProp$2=Object.defineProperty,__getOwnPropDesc$2=Object.getOwnPropertyDescriptor,__decorateClass$2=(K,F,B,D)=>{for(var U=D>1?void 0:D?__getOwnPropDesc$2(F,B):F,ct=K.length-1,it;ct>=0;ct--)(it=K[ct])&&(U=(D?it(F,B,U):it(U))||U);return D&&U&&__defProp$2(F,B,U),U};let markSuggestion=1,MarkingsEditor=class extends s{constructor(){super(...arguments),this.position=0}render(){return this.recording?x`
      <div class="container">
        ${this.recording.markings.map((K,F)=>{const[B,D]=K;return x`
            <div 
              class="mark" 
              style="left: ${B/this.recording.data.length*100}%" 
              @click=${()=>{this.dispatchEvent(new CustomEvent("select",{detail:{position:B,mark:D}}))}} 
              @dblclick=${()=>{this.recording.markings.splice(F,1),this.requestUpdate(),this.fireChangeEvent(),markSuggestion=D}} 
            >${D.toString()}</div>
          `})}
      </div>

      <button 
        @click=${()=>{popup(x`<h3>Create Mark</h3>`,x`<input id="page" type="number" value=${markSuggestion} min="1" max=${this.recording.data.length}>`).then(K=>{if(!K)return;const F=parseInt(K.get("page"));!F||F<1||(markSuggestion=F+1,this.recording.markings.push([this.position,F]),this.recording.markings.sort((B,D)=>B[0]-D[0]),this.requestUpdate(),this.fireChangeEvent())}).catch(()=>{})}} 
      >Add Mark</button> 

      Double tap to remove
    `:null}fireChangeEvent(){this.dispatchEvent(new CustomEvent("change"))}};MarkingsEditor.styles=[buttonStyle,i$2`
      :host {
        display: block;
        text-align: center;
      }
      .container {
        position: relative;
        height: 1rem;
        margin-bottom: .5rem;
      }
      .mark {
        position: absolute;
        transform: translateX(-50%);
        border-radius: 50%;
        background: var(--theme-color-background-light);
        width: 1rem;
        height: 1rem;
        font-size: .7rem;
        line-height: 1rem;
        text-align: center;
        cursor: pointer;
        user-select: none;
      }
      .mark::before {
        content: '';
        position: absolute;
        top: 0;
        left: 50%;
        transform: translate(-50%, -20%) rotate(45deg);
        width: .5rem;
        height: .5rem;
        background: var(--theme-color-background-light);
        z-index: -1;
      }
    `];__decorateClass$2([n({type:Object})],MarkingsEditor.prototype,"recording",2);MarkingsEditor=__decorateClass$2([t("markings-editor")],MarkingsEditor);var __defProp$1=Object.defineProperty,__getOwnPropDesc$1=Object.getOwnPropertyDescriptor,__decorateClass$1=(K,F,B,D)=>{for(var U=D>1?void 0:D?__getOwnPropDesc$1(F,B):F,ct=K.length-1,it;ct>=0;ct--)(it=K[ct])&&(U=(D?it(F,B,U):it(U))||U);return D&&U&&__defProp$1(F,B,U),U};let InputSlider=class extends s{constructor(){super(...arguments),this.value=0,this.min=0,this.max=100,this.step=1}render(){return x`
      <div 
        class="container"
        tabindex="0"
        @mousedown=${this._handleMouse}
        @touchstart=${this._handleTouch}
        @keydown=${this._handleKey}
      >
        <div class="track"></div>
        <div class="thumb" style="left: ${lerp(0,100,rlerp(this.min,this.max,this.value))}%"></div>
      </div>
    `}_handleMouse(K){const F=D=>{D.preventDefault();const U=this.getBoundingClientRect(),ct=(D.clientX-U.left)/U.width,it=lerp(this.min,this.max,ct);this.value=Math.max(this.min,Math.min(this.max,Math.round(it/this.step)*this.step)),this._fireChangeEvent()},B=()=>{document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",B)};F(K),document.addEventListener("mousemove",F),document.addEventListener("mouseup",B)}_handleTouch(K){const F=D=>{const U=this.getBoundingClientRect(),ct=(D.touches[0].clientX-U.left)/U.width,it=lerp(this.min,this.max,ct);this.value=Math.max(this.min,Math.min(this.max,Math.round(it/this.step)*this.step)),this._fireChangeEvent()},B=()=>{document.removeEventListener("touchmove",F),document.removeEventListener("touchend",B),document.removeEventListener("touchcancel",B)};F(K),document.addEventListener("touchmove",F),document.addEventListener("touchend",B),document.addEventListener("touchcancel",B)}_handleKey(K){switch(K.key){case"ArrowLeft":case"ArrowDown":this.value=Math.max(this.min,this.value-this.step),this._fireChangeEvent();break;case"ArrowRight":case"ArrowUp":this.value=Math.min(this.max,this.value+this.step),this._fireChangeEvent();break;case"Home":this.value=this.min,this._fireChangeEvent();break;case"End":this.value=this.max,this._fireChangeEvent();break}}_fireChangeEvent(){this.dispatchEvent(new CustomEvent("change",{detail:this.value}))}};InputSlider.styles=i$2`
    :host {
      display: block;
      width: 100%;
    }
    .container {
      position: relative;
      width: 100%;
      height: 1em;
    }
    .track {
      position: absolute;
      top: 50%;
      left: 0;
      width: 100%;
      height: .1em;
      background: var(--theme-color-background-light);
      transform: translateY(-50%);
      border-radius: .1em;
      pointer-events: none;
      touch-action: none;
    }
    .thumb {
      position: absolute;
      top: 50%;
      left: 0;
      width: .8em;
      height: .8em;
      background: var(--theme-color-primary);
      transform: translate(-50%, -50%);
      border-radius: .5em;
      pointer-events: none;
      touch-action: none;
    }
    .container:focus .thumb {
      width: 1em;
      height: 1em;
    }
  `;__decorateClass$1([n({type:Number})],InputSlider.prototype,"value",2);__decorateClass$1([n({type:Number})],InputSlider.prototype,"min",2);__decorateClass$1([n({type:Number})],InputSlider.prototype,"max",2);__decorateClass$1([n({type:Number})],InputSlider.prototype,"step",2);InputSlider=__decorateClass$1([t("input-slider")],InputSlider);const inputStyle=i$2`
  input {
    background: var(--theme-color-background-light);
    border: none;
    outline: none;
    display: block;
    /* box-sizing: border-box; */
  }

  input[type="range"] {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    margin: .4em 0;
    border-radius: .1em;
    cursor: pointer;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    width: .2em;
    height: .2em;
    border-radius: .1em;
    background: var(--theme-color-primary);
    transform: scale(5);
  }
  input[type="range"]:focus::-webkit-slider-thumb {
    transform: scale(6);
  }

`;class ElectronFile{constructor(F,B){this.name=F,this.path=B}async arrayBuffer(){return await window.ipcRenderer.invoke("file-read",this.path)}async text(){return await window.ipcRenderer.invoke("file-read-text",this.path)}get handle(){return{name:this.name,path:this.path}}}const supported$2=!!window.ipcRenderer,platform$2="electron";async function fileOpen$2(K){if(K!=null&&K.name&&(K!=null&&K.path))return new ElectronFile(K.name,K.path);const F=await window.ipcRenderer.invoke("file-open",K);return new ElectronFile(F.name,F.path)}async function fileSave$2(K,F,B){const D=await K.arrayBuffer();return await window.ipcRenderer.invoke("file-save",D,F,B)}async function getRecent(){return[]}const fsElectron=Object.defineProperty({__proto__:null,ElectronFile,fileOpen:fileOpen$2,fileSave:fileSave$2,getRecent,platform:platform$2,supported:supported$2},Symbol.toStringTag,{value:"Module"}),supported$1=window.showOpenFilePicker&&window.showSaveFilePicker&&window.showDirectoryPicker,platform$1="browser";class BrowserDirectory{constructor(F,B){this.handle=F,this.entries=B}}async function fileOpen$1(K){const F=K instanceof FileSystemFileHandle?K:(await window.showOpenFilePicker(transformOpenOptions(K)))[0];if(!F)throw new Error("File not provided");if(!await verifyPermission(F))throw new Error("Permission denied");const B=await F.getFile();return Object.assign(B,{handle:F})}async function fileSave$1(K,F,B){const D=B||await window.showSaveFilePicker(transformSaveOptions(F));if(!D)throw new Error("File not provided");if(!await verifyPermission(D,!0))throw new Error("Permission denied");console.log("fileHandle",D);const U=await D.createWritable();return await U.write(K),await U.close(),D}async function openDirectory(K){const F=K instanceof FileSystemDirectoryHandle?K:await window.showDirectoryPicker(transformOpenOptions(K));if(!F)throw new Error("Directory not provided");if(!await verifyPermission(F))throw new Error("Permission denied");const B=[];for await(const D of F.values())D.kind==="file"?B.push(await fileOpen$1(D)):B.push(await openDirectory(D));return new BrowserDirectory(F,B)}async function verifyPermission(K,F=!1){const B=F?{mode:"readwrite"}:{};return await K.queryPermission(B)==="granted"||await K.requestPermission(B)==="granted"}function transformOpenOptions(K){return{id:K.id,multiple:!1,excludeAcceptAllOption:!0,types:[{description:K.description,accept:K.accept}]}}function transformSaveOptions(K){return{id:K.id,suggestedName:K.fileName,types:[{description:K.description,accept:K.accept}]}}const fsBrowser=Object.defineProperty({__proto__:null,fileOpen:fileOpen$1,fileSave:fileSave$1,openDirectory,platform:platform$1,supported:supported$1},Symbol.toStringTag,{value:"Module"}),supported=!0,platform="legacy";async function fileOpen(K){const F=document.createElement("input");F.type="file";const B=Object.values(K.accept||{}).flat();F.accept=B.join(",");const D=await new Promise(U=>{F.onchange=()=>{var it;const ct=(it=F.files)==null?void 0:it[0];U(ct)},F.click()});if(!D)throw new Error("File not provided");return D}async function fileSave(K,F){const B=document.createElement("a");B.href=URL.createObjectURL(K),B.download=F.fileName,B.click()}const fsLegacy=Object.defineProperty({__proto__:null,fileOpen,fileSave,platform,supported},Symbol.toStringTag,{value:"Module"}),fs=supported$2?fsElectron:supported$1?fsBrowser:fsLegacy;console.log("fs platform",fs.platform);function promisifyRequest(K){return new Promise((F,B)=>{K.oncomplete=K.onsuccess=()=>F(K.result),K.onabort=K.onerror=()=>B(K.error)})}function createStore(K,F){const B=indexedDB.open(K);B.onupgradeneeded=()=>B.result.createObjectStore(F);const D=promisifyRequest(B);return(U,ct)=>D.then(it=>ct(it.transaction(F,U).objectStore(F)))}let defaultGetStoreFunc;function defaultGetStore(){return defaultGetStoreFunc||(defaultGetStoreFunc=createStore("keyval-store","keyval")),defaultGetStoreFunc}function get(K,F=defaultGetStore()){return F("readonly",B=>promisifyRequest(B.get(K)))}function set(K,F,B=defaultGetStore()){return B("readwrite",D=>(D.put(F,K),promisifyRequest(D.transaction)))}var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass=(K,F,B,D)=>{for(var U=D>1?void 0:D?__getOwnPropDesc(F,B):F,ct=K.length-1,it;ct>=0;ct--)(it=K[ct])&&(U=(D?it(F,B,U):it(U))||U);return D&&U&&__defProp(F,B,U),U};let App=class extends s{constructor(){super(...arguments),this.savedState=!0,this.recentAvailable=!1,this.position=0}render(){return[this.renderHeader(),this.renderViewer(),this.renderRecording(),this.renderPageTurner()]}updated(K){if(K.has("position")){if(this.follower&&(this.follower.position=this.position),!this.scrollable)return;const F=this.scrollable.scrollWidth-this.scrollable.clientWidth,B=this.position/this.recording.data.length;this.scrollable.scrollTo({left:B*F,behavior:"auto"})}}connectedCallback(){var K;super.connectedCallback(),this.findRecent(),(K=window.ipcRenderer)==null||K.on("page-flip",(F,B)=>{console.log(B),this.viewer.position=B})}async findRecent(){this.recentPDF=await get("pdf"),this.recentRecording=await get("recording")}renderHeader(){var K;return x`
      <header>

        <button 
          title="Open PDF" 
          @click=${async()=>{const F=await fs.fileOpen({id:"pdf",accept:{"application/pdf":[".pdf"]}}),B=await F.arrayBuffer();this.viewer.load(B),F.handle&&set("pdf",F.handle)}} 
        >
          📄 Sheet
        </button>

        <button
          ?hidden=${!this.recentPDF} 
          title="Open Recent PDF - ${(K=this.recentPDF)==null?void 0:K.name}" 
          @click=${async()=>{if(!this.recentPDF)return;const B=await(await fs.fileOpen(this.recentPDF)).arrayBuffer();await this.viewer.load(B),this.recentPDF=void 0}} 
        >
          🕒
        </button>

        <button
          title="Fullscreen"
          @click=${()=>{this.viewer.requestFullscreen(),this.viewer.focus()}}
        >
          ↗️
        </button>

      </header>
    `}renderViewer(){return x`
      <pdf-viewer
        @select=${K=>{const F=K.detail;if(!this.recording)return;const B=this.recording.markings.filter(U=>U[1]===F+1);if(B.length===0)return;const D=B.reduce((U,ct)=>Math.abs(ct[0]-this.position)<Math.abs(U[0]-this.position)?ct:U);this.position=D[0]}}
      ></pdf-viewer>
    `}renderRecording(){var K,F;return x`
      <collapsable-container
        id="recording"
        .title=${"Recording"+(this.recordingFile?" - "+this.recordingFile.name.replace(/\.json$/,""):"")}
        .description=${this.savedState?"":"Unsaved changes"}
      >
        <frequency-recorder 
          id="recorder" 
          title="Record" 
          slot="header" 
          @data=${B=>{this.recording.data.push(B.detail)}} 
          @start=${()=>{this.recognizer.stop(),this.recording=new FrequencyRecording}} 
          @stop=${()=>{this.spectrogram.requestUpdate(),this.markings.requestUpdate(),this.savedState=!1,this.recordingFile=void 0,this.recordingElement.setAttribute("open",""),this.position=0}} 
        >
          🎙 New
        </frequency-recorder>

        <button
          title="Open Recording"
          slot="header"
          @click=${async()=>{const B=await fs.fileOpen({id:"recording",accept:{"application/json":[".json"]}});console.log(B);const D=await B.text();this.recordingElement.setAttribute("open",""),B.handle&&(this.recordingFile=B.handle,set("recording",B.handle)),this.recording=FrequencyRecording.import(JSON.parse(D)),this.savedState=!0,this.position=0}}
        >
          📂
        </button>

        <button 
          ?hidden=${!this.recentRecording} 
          title="Open Recent Recording - ${(K=this.recentRecording)==null?void 0:K.name}" 
          slot="header" 
          @click=${async()=>{if(this.recentRecording)try{const B=await fs.fileOpen(this.recentRecording);B.handle&&(this.recordingFile=B.handle);const D=await B.text();this.recordingFile=this.recentRecording,this.recentRecording=void 0,this.recordingElement.setAttribute("open",""),this.recording=FrequencyRecording.import(JSON.parse(D)),this.savedState=!0,this.position=0}catch{this.recentRecording=void 0}}} 
        >
          🕒
        </button>

        <button 
          title="Save Recording" 
          slot="header" 
          ?hidden=${this.savedState} 
          @click=${async()=>{if(!this.recording)return;const B=JSON.stringify(this.recording.export()),D=new Blob([B],{type:"application/json"}),U=await fs.fileSave(D,{id:"recording",fileName:"Recording.json",accept:{"application/json":[".json"]}},this.recordingFile);this.savedState=!0,U&&(this.recordingFile=U,set("recording",U))}} 
        >
          💾
        </button>

        ${this.recording?x`
              <div class="container">
                <div
                  id="scrollable"
                  @mousewheel=${B=>{this.recording&&(B.preventDefault(),this.position=Math.max(0,Math.min(this.recording.data.length,this.position+B.deltaX+B.deltaY)))}}
                >
                  <graph-2d
                    id="spectrogram"
                    .data=${((F=this.recording)==null?void 0:F.data)||[]}
                    @select=${B=>{if(!this.recording)return;const{column:D,row:U}=B.detail;console.log(`Frame: ${D}, Row: ${U}, Value: ${this.recording.data[D][U]}`),this.position=D}}
                  ></graph-2d>

                  <graph-1d id="similarity"></graph-1d>
                </div>

                <input-slider
                  id="position"
                  .max=${this.recording.data.length}
                  .value=${this.position}
                  @change=${B=>{this.recording&&(this.position=B.detail)}}
                ></input-slider>
                
                <markings-editor
                  .recording=${this.recording}
                  .position=${this.position}
                  @select=${B=>{const{position:D}=B.detail;this.position=D}}
                  @change=${()=>{this.recording&&(this.savedState=!1)}}
                ></markings-editor>

              </div>
            `:x`
              <p>Make a recording to use the automatic page turner feature.</p>
            `}

      </collapsable-container>
    `}renderPageTurner(){return x`
      <collapsable-container .title=${"Page Turner"} ?hidden=${!this.recording}>

        <frequency-recorder
          id="recognizer"
          title="Recognize"
          slot="header"
          @data=${K=>{if(!this.follower||!this.recording)return;const{position:F,mark:B,differences:D,over:U}=this.follower.guess(K.detail,this.recognitionOptions);if(U)return this.recognizer.stop();this.position=F||0;const ct=new Uint8Array(this.recording.data.length);D==null||D.forEach((it,zt)=>ct[zt+this.position]=it),this.similarity.data=ct,B&&B!==this.viewer.position+1&&(this.viewer.position=B-1)}}
          @start=${()=>{this.recording&&(this.recorder.stop(),this.follower=this.recording.createFollower(),this.position>=this.recording.data.length-100&&(this.position=0))}}
        >
          🔎 Recognize
        </frequency-recorder>

        <recognition-options></recognition-options>

      </collapsable-container>
    `}};App.styles=[inputStyle,buttonStyle,i$2`
      :host {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100%;
      }

      header {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.5em;
        margin: 10px;
      }

      pdf-viewer {
        flex: 1;
      }

      #position {
        width: 100%;
      }

      #scrollable {
        overflow: hidden;
        border: 1px solid grey;
        background: var(--color-black);
      }

      .container {
        width: min-content;
        max-width: 100%;
        margin: 0 auto;
      }
    `];__decorateClass([e$1("pdf-viewer")],App.prototype,"viewer",2);__decorateClass([e$1("#recording")],App.prototype,"recordingElement",2);__decorateClass([e$1("#recorder")],App.prototype,"recorder",2);__decorateClass([e$1("#scrollable")],App.prototype,"scrollable",2);__decorateClass([e$1("#spectrogram")],App.prototype,"spectrogram",2);__decorateClass([e$1("#similarity")],App.prototype,"similarity",2);__decorateClass([e$1("#position")],App.prototype,"positionSlider",2);__decorateClass([e$1("markings-editor")],App.prototype,"markings",2);__decorateClass([e$1("#recognizer")],App.prototype,"recognizer",2);__decorateClass([e$1("recognition-options")],App.prototype,"recognitionOptions",2);__decorateClass([n({type:Object})],App.prototype,"recording",2);__decorateClass([n({type:Object})],App.prototype,"recordingFile",2);__decorateClass([n({type:Boolean})],App.prototype,"savedState",2);__decorateClass([n({type:Boolean})],App.prototype,"recentAvailable",2);__decorateClass([n({type:Object})],App.prototype,"recentPDF",2);__decorateClass([n({type:Object})],App.prototype,"recentRecording",2);__decorateClass([n({type:Number})],App.prototype,"position",2);App=__decorateClass([t("app-root")],App);
